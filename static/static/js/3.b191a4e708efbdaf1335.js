webpackJsonp([3],{"+I/B":function(t,e){},"1O0Z":function(t,e){},"4jrt":function(t,e,s){t.exports=s.p+"static/img/自由排除.22dcf85.svg"},"90z+":function(t,e){},"94hp":function(t,e,s){t.exports=s.p+"static/img/logo.50b0d33.svg"},B2xp:function(t,e,s){"use strict";var i={data:()=>({showTip:!1,setPsw:""}),methods:{confirmHandle(){this.setPsw?"dyj2017119"!==this.setPsw?this.showTip=!0:this.$emit("confirmBtn"):this.$message.error("密码不能为空")},cancelHandel(){this.setPsw="",this.$emit("cancelBtn")}},props:["title"]},n={render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"set-psw"},[s("div",{staticClass:"header"},[t._v("\n      提示\n      "),s("span",{staticClass:"iconfont",on:{click:t.cancelHandel}})]),t._v(" "),s("p",[t._v(t._s(t.title))]),t._v(" "),s("input",{directives:[{name:"model",rawName:"v-model",value:t.setPsw,expression:"setPsw"}],attrs:{type:"password",placeholder:"请输入授权密码"},domProps:{value:t.setPsw},on:{input:function(e){e.target.composing||(t.setPsw=e.target.value)}}}),t._v(" "),t.showTip?s("div",{staticClass:"icons"},[t._v("密码错误")]):t._e(),t._v(" "),s("div",{staticClass:"footer"},[s("button",{staticClass:"save",on:{click:t.confirmHandle}},[t._v("确定")]),t._v(" "),s("button",{on:{click:t.cancelHandel}},[t._v(t._s(t.$t("confirm.quit")))])])])},staticRenderFns:[]};var a=s("VU/8")(i,n,!1,function(t){s("OvwT")},"data-v-411c5647",null);e.a=a.exports},DsNH:function(t,e){},E82G:function(t,e){},FcKU:function(t,e,s){t.exports=s.p+"static/img/自由排除-d.d759dc1.svg"},"Ga4/":function(t,e){},GaJ7:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s("JCuE"),n=s("aeYY"),a=s("tOHu"),r=s("jyVo"),o={data(){return{count:0,companyid:Object(r.o)().company,userid:this.$route.query.id||Object(r.o)().username,data:null,loaaded:!1,records:[],currentRecord:null,currentPage:1,pagesize:parseInt(localStorage.getItem("pageNum"))||20,filters:{idSearch:"",nameSearch:"",filename:"",state:[],report:[],analy:[],gender:[],samplePart:[],sampleType:[]},sortColumn:"",sortOrder:""}},filters:{fmt:r.i},mounted(){this.getRecords(),document.title=this.$t("title.title"),console.log(Object(r.o)())},computed:{userInfo:()=>Object(r.o)(),tableData(){return(this.records||[]).filter(t=>t.basic.name.toLowerCase().indexOf(this.filters.nameSearch.toLowerCase())>=0).filter(t=>t.basic.caseid.indexOf(this.filters.idSearch)>=0).filter(t=>0==this.filters.state.length||this.filters.state.indexOf(!!t.started)>=0).filter(t=>0==this.filters.gender.length||this.filters.gender.indexOf(t.basic.gender)>=0).filter(t=>0==this.filters.samplePart.length||this.filters.samplePart.indexOf(t.basic.samplePart)>=0).filter(t=>""==this.filters.filename||t.slices.some(t=>t.name.toString().indexOf(this.filters.filename)>=0)).filter(t=>0==this.filters.analy.length||this.filters.analy.indexOf(t.analy)>=0).filter(t=>0==this.filters.report.length||this.filters.report.indexOf(!!t.reports.length)>=0).filter(t=>0==this.filters.sampleType.length||this.filters.sampleType.indexOf(t.basic.sampleType)>=0)},sorted(){return this.tableData.sort((t,e)=>{if(this.sortColumn){var s=0;switch(this.sortColumn){case"update":s=(t.update||"").localeCompare(e.update||"");break;case"slices.length":s=t.slices.length-e.slices.length;break;case"basic.age":s=t.basic.age-e.basic.age}return("descending"==this.sortOrder?-1:1)*s}return new Date(e.update).getTime()-new Date(t.update).getTime()}).slice((this.currentPage-1)*this.pagesize,this.currentPage*this.pagesize)},gender:()=>"en"==window.i18n.locale?{"男":"M","女":"F","其他":"O"}:{"男":"男","女":"女","其他":"其他"}},watch:{filters:{deep:!0,handler(){this.currentPage=1}},tableData(t,e){this.currentPage=Math.min(this.currentPage,Math.ceil(t.length/this.pagesize)),this.currentPage=Math.max(this.currentPage,1)},sorted:function(t,e){this.currentRecord&&t.find(t=>t.id===this.currentRecord.id)||(this.currentRecord=null)}},methods:{async getOne(){let t;for(;;){try{t=await Object(r.b)("check/get")}catch(t){return this.$alert("任务被抢完了,请等几分钟再来"),void this.getRecords()}let e=t.data.companyid,s=t.data.caseid;try{return t=await Object(r.b)("records/get?companyid="+e,{caseid:s}),void(this.data={companyid:e,record:t.data})}catch(t){}}},closeWindow(){this.data=null,this.getRecords()},openWindow(t){this.data={companyid:t.companyid,record:t}},handleSizeChange:function(t){localStorage.pageNum=this.pagesize=t,this.currentPage=1},states(){return[{text:this.$t("caselist.tableheader.states[0]"),value:!0},{text:this.$t("caselist.tableheader.states[1]"),value:!1}]},checkAnaly(t){var e={};return this.records.filter(e=>!!e[t]).map(e=>e[t]).forEach(t=>e[t]=t),Object.keys(e).map(t=>({text:t,value:t})).sort((t,e)=>t.text.localeCompare(e.text))},filterChange(t){Object.assign(this.filters,t)},sortChange({column:t,prop:e,order:s}){this.sortColumn=e,this.sortOrder=s},aggregate(t){var e={};return this.records.map(e=>e.basic[t]).forEach(t=>e[t]=t),Object.keys(e).map(t=>({text:t,value:t})).sort((t,e)=>t.text.localeCompare(e.text))},getRecords(){this.handler&&clearInterval(this.handler);var t=()=>{Object(r.b)("check/queryCount").then(t=>this.count=t.data),Object(r.b)("check/querySingle",{companyid:this.companyid,userid:this.userid}).then(t=>{let e=t.data.sort((t,e)=>new Date(e.update).getTime()-new Date(t.update).getTime())||[],s={};for(let t=e.length-1;t>=0;t--){let i=e[t];s[i.id]?e.splice(t,1):s[i.id]=1}this.records=e.map(t=>({opinion:t.opinion,DNAopinion:t.DNAopinion?t.DNAopinion:"",analy:(t=>"N"==t?"阴性":"P"==t?"阳性":"U"==t?"标本不满意":t||"")(t.analy),attachments:t.attachments,basic:t.basic,id:t.id,repoInfo:t.repoInfo,reports:t.reports,slices:t.slices,slice:t.slice,state:t.stage||2,started:t.started,companyid:t.companyid,update:t.update})),this.currentRecord=this.currentRecord&&t.data.find(t=>t.id==this.currentRecord.id),this.$refs.table&&this.$refs.table.setCurrentRow(this.currentRecord),this.loaaded=!0}).catch(t=>{this.loaaded=!0,console.error(t)})};this.handler=setInterval(t,3e5),t()}},components:{"v-header":i.a,"v-thumbnails":n.a,detail:a.a}},l={render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"container"},[s("header",{staticClass:"header"},[s("v-header",{attrs:{showSign:!1}})],1),t._v(" "),s("div",{staticClass:"center-content"},[s("div",{staticClass:"table-header"},[s("div",{staticClass:"basic-index"},[t._v(t._s(t.$t("caselist.tableheader.cases"))),s("span",[t._v(t._s(this.tableData.length))])]),t._v(" "),this.$route.query.id?t._e():s("div",{staticClass:"button",on:{click:t.getOne}},[t._v("\n            我要复查一张新片子 ("+t._s(t.count)+")\n        ")])]),t._v(" "),s("el-table",{ref:"table",staticClass:"table",attrs:{data:t.sorted,size:"medium","row-class-name":function(t){return t.rowIndex%2?"row1":"row2"},"row-key":"id","current-row-key":null,"header-cell-class-name":"header",height:"calc(100% - 277px)","highlight-current-row":"","empty-text":t.loaaded?t.$t("loading.nodata"):t.$t("loading.loading")},on:{"current-change":function(e){t.currentRecord=e||t.currentRecord},"row-dblclick":function(e){return t.openWindow(e)},"filter-change":t.filterChange,"sort-change":t.sortChange}},[s("el-table-column",{attrs:{label:t.$t("caselist.tableheader.sample"),"min-width":"55"},scopedSlots:t._u([{key:"default",fn:function(e){return[s("el-tooltip",{attrs:{content:e.row.basic.caseid}},[s("span",[t._v(t._s(e.row.basic.caseid))])])]}}])},[s("template",{slot:"header"},[s("input",{directives:[{name:"model",rawName:"v-model",value:t.filters.idSearch,expression:"filters.idSearch"}],staticClass:"name-input",attrs:{placeholder:"样本号"},domProps:{value:t.filters.idSearch},on:{input:function(e){e.target.composing||t.$set(t.filters,"idSearch",e.target.value)}}})])],2),t._v(" "),s("el-table-column",{attrs:{label:t.$t("caselist.tableheader.filename"),"min-width":"60"},scopedSlots:t._u([{key:"default",fn:function(e){return[s("el-tooltip",[s("span",[t._v(t._s(e.row.basic.filename))])])]}}])},[s("template",{slot:"header"},[s("input",{directives:[{name:"model",rawName:"v-model",value:t.filters.filename,expression:"filters.filename"}],staticClass:"name-input",attrs:{placeholder:"切片"},domProps:{value:t.filters.filename},on:{input:function(e){e.target.composing||t.$set(t.filters,"filename",e.target.value)}}})])],2),t._v(" "),s("el-table-column",{attrs:{label:t.$t("caselist.tableheader.name"),"min-width":"55"},scopedSlots:t._u([{key:"default",fn:function(e){return[s("el-tooltip",{attrs:{content:e.row.basic.name}},[s("span",[t._v(t._s(e.row.basic.name))])])]}}])},[s("template",{slot:"header"},[s("input",{directives:[{name:"model",rawName:"v-model",value:t.filters.nameSearch,expression:"filters.nameSearch"}],staticClass:"name-input",attrs:{placeholder:"姓名"},domProps:{value:t.filters.nameSearch},on:{input:function(e){e.target.composing||t.$set(t.filters,"nameSearch",e.target.value)}}})])],2),t._v(" "),s("el-table-column",{attrs:{label:t.$t("caselist.tableheader.sex"),"min-width":"60",filters:[{text:""+t.$t("caselist.tableheader.gender[0]"),value:"男"},{text:""+t.$t("caselist.tableheader.gender[1]"),value:"女"},{text:""+t.$t("caselist.tableheader.gender[2]"),value:"其他"}],"column-key":"gender",prop:"basic.gender"},scopedSlots:t._u([{key:"default",fn:function(e){return[s("a",{attrs:{type:e.row.basic.gender===""+t.$t("caselist.tableheader.gender[0]")?"primary":"success","disable-transitions":""}},[t._v("\n              "+t._s(t.gender[e.row.basic.gender])+"\n            ")])]}}])}),t._v(" "),s("el-table-column",{attrs:{label:t.$t("caselist.tableheader.age"),prop:"basic.age","min-width":"55","sort-method":function(t,e){return t.basic.age-e.basic.age},sortable:""},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v("\n            "+t._s(e.row.basic.age)+"\n          ")]}}])}),t._v(" "),s("el-table-column",{attrs:{label:t.$t("caselist.tableheader.samplePart"),filters:t.aggregate("samplePart"),prop:"basic.samplePart","column-key":"samplePart","min-width":"85"},scopedSlots:t._u([{key:"default",fn:function(e){return[s("el-tooltip",{attrs:{content:e.row.basic.samplePart}},[s("span",[t._v(t._s(e.row.basic.samplePart))])])]}}])}),t._v(" "),s("el-table-column",{attrs:{label:t.$t("caselist.tableheader.sampleType"),"min-width":"85",filters:t.aggregate("sampleType"),prop:"basic.sampleType","column-key":"sampleType"},scopedSlots:t._u([{key:"default",fn:function(e){return[s("el-tooltip",{attrs:{content:e.row.basic.sampleType}},[s("span",[t._v(t._s(e.row.basic.sampleType))])])]}}])}),t._v(" "),s("el-table-column",{attrs:{label:t.$t("caselist.tableheader.sliceNum"),"min-width":"85",prop:"slices.length",sortable:""},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v("\n            "+t._s(e.row.slices.length)+"\n          ")]}}])}),t._v(" "),s("el-table-column",{attrs:{label:t.$t("caselist.tableheader.state"),filters:t.states(),"min-width":"85",prop:"id","column-key":"state"},scopedSlots:t._u([{key:"default",fn:function(e){return[s("el-tooltip",{attrs:{content:t.states().find(function(t){return t.value==!!e.row.started}).text}},[s("span",{staticStyle:{position:"relative","padding-left":"18px"}},[s("i",{staticClass:"circle",class:{"bg-blue":t.states().find(function(t){return t.value==!!e.row.started}).text==t.$t("caselist.tableheader.states[1]")}}),t._v("\n                "+t._s(t.states().find(function(t){return t.value==!!e.row.started}).text)+"\n              ")])])]}}])}),t._v(" "),s("el-table-column",{attrs:{label:t.$t("caselist.tableheader.analy"),filters:t.checkAnaly("analy"),"min-width":"90",prop:"analy","column-key":"analy"},scopedSlots:t._u([{key:"default",fn:function(e){return["阴性"===e.row.analy?s("span",{staticStyle:{color:"green"}},[t._v("\n                "+t._s(e.row.analy)+"\n              ")]):"阳性"===e.row.analy?s("span",{staticStyle:{color:"red"}},[t._v("\n                "+t._s(e.row.analy)+"\n              ")]):s("span",{staticStyle:{color:"yellow"}},[t._v("\n                "+t._s(e.row.analy)+"\n              ")])]}}])}),t._v(" "),s("el-table-column",{attrs:{label:t.$t("caselist.tableheader.updateTime"),"min-width":"90",prop:"update",sortable:""},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v("\n            "+t._s(t._f("fmt")(e.row.update))+"\n          ")]}}])}),t._v(" "),s("el-table-column",{attrs:{label:t.$t("caselist.tableheader.operation"),"min-width":"90"},scopedSlots:t._u([{key:"default",fn:function(e){return[s("el-button",{staticClass:"detail",on:{click:function(s){return t.openWindow(e.row)}}},[t._v(t._s(t.$t("caselist.operation.detail")))])]}}])})],1),t._v(" "),s("div",{staticClass:"message-bar"},[s("div",{staticClass:"message"}),t._v(" "),t.records.length?s("el-pagination",{staticClass:"page",attrs:{"current-page":t.currentPage,"page-sizes":[20,50,100],"page-size":t.pagesize,layout:"sizes, prev, pager, next",total:t.tableData.length},on:{"size-change":t.handleSizeChange,"current-change":function(e){return t.currentPage=e}}}):t._e()],1),t._v(" "),s("v-thumbnails",{key:"thumb"+(t.currentRecord&&t.currentRecord.id),attrs:{record:t.currentRecord&&t.tableData.find(function(e){return e.id==t.currentRecord.id})},on:{click:function(e){return t.openWindow(t.currentRecord,e)}}})],1),t._v(" "),t.data?s("detail",{attrs:{data:t.data,companyid:t.data.companyid},on:{closing:function(e){return t.closeWindow()}}}):t._e()],1)},staticRenderFns:[]};var c=s("VU/8")(o,l,!1,function(t){s("gxuG")},"data-v-33bdc024",null);e.default=c.exports},"I9+T":function(t,e,s){"use strict";s("jyVo");var i={data(){return{basic:this.$props.record.basic,isOpen:!1,checked:"basicMessage",isBig:!1}},methods:{toggleBig:function(){this.isBig=!this.isBig},download(t,e,s){window.location.href=`/aipath/api/files/attachment?caseid=${t}&fileid=${e}&filename=${s}`}},computed:{gender(){let t=window.localStorage.getItem("localeLanguage");return"zh"==t?{"男":"男","女":"女","其他":"其他"}:"en"==t?{"男":"M","女":"F","其他":"O"}:void 0}},props:["record"]},n={render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"container"},[s("div",{staticClass:"open-message",attrs:{title:t.$t("basic.basic")},on:{click:function(e){t.isOpen=!t.isOpen}}}),t._v(" "),t.isOpen?s("div",{class:{"case-bigger":t.isBig,"case-message":!t.isBig}},[s("h1",[s("span",{class:{"cur-checked":"basicMessage"==t.checked},on:{click:function(e){t.checked="basicMessage"}}},[t._v(t._s(t.$t("basic.message")))]),t._v(" "),s("span",{class:{"cur-checked":"attachment"==t.checked},on:{click:function(e){t.checked="attachment"}}},[t._v(t._s(t.$t("basic.attactment")))]),t._v(" "),s("i",{staticClass:"close",on:{click:function(e){t.isOpen=!1}}}),s("i",{staticClass:"scale",class:{"bg-blue":t.isBig},on:{click:function(e){return t.toggleBig()}}})]),t._v(" "),s("div",{staticClass:"message-content"},["attachment"==t.checked?s("div",[s("ul",t._l(t.record.attachments.filter(function(t){return 1==t.state}),function(e){return s("li",{key:e.id},[s("a",{ref:"attachment",refInFor:!0,attrs:{title:e.name},on:{click:function(s){return t.download(t.record.id,e.id,e.name)}}},[t._v(t._s(e.name))])])}),0)]):t._e(),t._v(" "),"basicMessage"==t.checked?s("div",[s("div",{staticClass:"basics"},[s("h1",[t._v(t._s(t.$t("basic.basic")))]),t._v(" "),s("ul",[s("li",[s("dl",[s("dt",[t._v(t._s(t.$t("basic.age")))]),s("dd",[t._v(t._s(t.basic.age))])]),s("dl",[s("dt",[t._v(t._s(t.$t("basic.sex")))]),s("dd",[t._v(t._s(t.gender[t.basic.gender]))])])]),t._v(" "),s("li",[s("dl",{staticStyle:{width:"100%"}},[s("dt",{attrs:{title:t.$t("basic.cancerTypeTitle")}},[t._v(t._s(t.$t("basic.cancerType")))]),s("dd",[t._v(t._s(t.basic.cancerType))])])]),t._v(" "),s("li",[s("dl",{staticStyle:{width:"100%"}},[s("dt",{attrs:{title:t.$t("basic.familyHistoryTitle")}},[t._v(t._s(t.$t("basic.familyHistory")))]),s("dd",[t._v(t._s(t.basic.familyHistory))])])]),t._v(" "),s("li",[s("dl",{staticStyle:{width:"100%"}},[s("dt",{attrs:{title:t.$t("basic.medicalHistoryTitle")}},[t._v(t._s(t.$t("basic.medicalHistory")))]),s("dd",[t._v(t._s(t.basic.medicalHistory))])])])])]),t._v(" "),s("div",{staticClass:"basics"},[s("h1",[t._v(t._s(t.$t("basic.sample")))]),t._v(" "),s("ul",[s("li",[s("dl",{staticStyle:{width:"100%"}},[s("dt",{attrs:{title:t.$t("basic.samplePartTitle")}},[t._v(t._s(t.$t("basic.samplePart")))]),s("dd",[t._v(t._s(t.basic.samplePart))])])]),t._v(" "),s("li",[s("dl",{staticStyle:{width:"100%"}},[s("dt",{attrs:{title:t.$t("basic.sampleTypeTitle")}},[t._v(t._s(t.$t("basic.sampleType")))]),s("dd",[t._v(t._s(t.basic.sampleType))])])]),t._v(" "),s("li",[s("dl",{staticStyle:{width:"100%"}},[s("dt",[t._v(t._s(t.$t("basic.generallySeen")))]),s("dd",[t._v(t._s(t.basic.generallySeen))])])])])])]):t._e()])]):t._e()])},staticRenderFns:[]};var a=s("VU/8")(i,n,!1,function(t){s("l7ju")},"data-v-a17105bc",null);e.a=a.exports},JCuE:function(t,s,i){"use strict";var n=i("jyVo"),a={data:()=>({}),methods:{userInfo:n.o,imgPreview(t){if(window.FileReader)var s=new FileReader;else this.$alert(e.message,{confirmButtonText:this.$t("signature.updateEquipment")});var i=document.getElementById("imageFile").files[0];i.size/1024/1024>5?this.$message.error("文件大小不能超过5MB"):(s.onload=function(t){document.getElementById("preview").src=t.target.result},s.readAsDataURL(i))},upload(){let t=new FormData;t.append("sign",this.$refs.file.files[0]),Object(n.b)("user/updateSign",t),this.$emit("close")},cancleUpload:function(){this.$emit("close")}}},r={render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"sign-bg"},[s("div",{staticClass:"sign-content"},[s("div",{staticClass:"headerFloat"},[t._v("\n      "+t._s(t.$t("signature.title"))+"\n      "),s("span",{staticClass:"iconfont",on:{click:function(e){return t.cancleUpload()}}})]),t._v(" "),s("div",{staticClass:"img-content"},[s("div",{attrs:{id:"uploadimg"}},[s("div",{staticClass:"uploader-list",attrs:{id:"fileList"}},[s("img",{attrs:{id:"preview",src:"/aipath/api/user/sign?id="+t.userInfo().username+"&"+Math.random()}})]),t._v(" "),s("div",{staticClass:"imgPicker have-img"},[s("form",{attrs:{id:"imgFile"}},[t._v("\n            "+t._s(t.$t("signature.changeSignature"))+"\n            "),s("input",{ref:"file",attrs:{type:"file",id:"imageFile",name:"file",accept:"image/jpeg,image/png,image/bmp"},on:{change:function(e){return t.imgPreview(e.currentTarget)}}})])])])]),t._v(" "),s("div",{staticClass:"footer"},[s("button",{on:{click:function(e){return t.cancleUpload()}}},[t._v(t._s(t.$t("confirm.quit")))]),t._v(" "),s("button",{attrs:{id:"ctlBtn"},on:{click:function(e){return t.upload()}}},[t._v(t._s(t.$t("confirm.confirm")))])])])])},staticRenderFns:[]};var o=i("VU/8")(a,r,!1,function(t){i("Ga4/")},"data-v-69f0cfc4",null).exports,l=i("B2xp"),c={data:()=>({user:Object(n.o)(),isChange:!1,home:!1,oldPassword:"",newPassword:"",newPasswordSure:"",reg:/^(?![0-9]+$)(?![a-zA-Z]+$)[0-9A-Za-z]{6,32}$/,showSettingAIParam:!1,showSetting:!1,labelcheck:4,ajustType:"tct",defaultTctThreshold:0,defaultLctThreshold:0,curParam:{},tctParam:{},lctParam:{},dnaParam:{},loading:!1,showTrial:!1,trialTimes:[],analyseThreshold:{},onTrial:0,demoModeValue:"1"==localStorage.getItem("demoMode")||!1,showMsg:!1,showTipTxt:!1,showTips:!1,showSetPsw:!1,showTip:!1,pwsType:"",setPsw:"",electron:window.electron,showBuble:!1,curTime:(new Date).getTime(),remainMemory:0,memoryRoot:null,clearTime:"",pickerOptions:{disabledDate:t=>t.getTime()>Date.now()-864e4},recordCount:0,showMemoryBox:!1,smoothImg:null,smoothValue:.01,all_use:0,correctData:{}}),methods:{changeTab(t){switch(this.ajustType=t,t){case"tct":this.curParam=this.tctParam,this.getAnalyseThreshold();break;case"lct":this.curParam=this.lctParam,this.getAnalyseThreshold();break;case"pdl1":this.getSmoothValue();break;case"dna":this.curParam=this.dnaParam,this.getAnalyseThreshold()}},modifySmoothValue(t){"plus"===t?this.smoothValue<.05?(this.smoothValue+=.01,this.getImg()):this.$message.warning("不能再加了"):this.smoothValue>.01?(this.smoothValue=Number((this.smoothValue-.01).toFixed(2)),this.getImg()):this.$message.warning("不能再减了")},downloadTem(){window.location.href=`/aipath/api/files/downloadTemplate?name=${encodeURIComponent("调参模板.xlsx")}`},imgPreview(t){var e=t.files[0];if(e.size/1024/1024>10)return void this.$message.error("文件大小不能超过10MB");let s=new FormData;s.append("file",e),Object(n.b)("ai/uploadDoc",s).then(t=>{t.code?this.$message.error(t.message):this.getImg(),this.$refs.smoothfile.value=""})},getImg(){Object(n.b)("ai/getFittingCurve",{smooth_value:this.smoothValue}).then(t=>{t.code?this.$message.error(t.message):this.smoothImg=t.img})},resetModelCalibration(){this.$confirm("模型将恢复到初始状态，操作后不可撤回，确定要重置吗？","提示").then(()=>{Object(n.b)("ai/resetModelCalibration").then(t=>{t.code?this.$message.error(t.message):this.$message.success("操作成功")})}).catch(t=>t)},resetSmooth(){Object(n.b)("ai/clearParameter").then(t=>{t.code?this.$message.error(t.message):(this.smoothImg=null,this.smoothValue=.01)})},getSmoothValue(){Object(n.b)("ai/getParameter").then(t=>{t.code?this.$message.error(t.message):(this.smoothImg=t.img,this.smoothValue=t.smooth_value)})},getMemory:()=>new Promise(t=>{Object(n.b)("manage/remainingSpace").then(({data:e})=>{t(e.remainingSpace)})}),timeChange(t){Object(n.b)("manage/recordCount",{closing_date:t}).then(({data:t})=>{this.recordCount=t.recordCount})},clearCase(){this.recordCount?this.$confirm("删除后数据无法恢复，确认继续吗？").then(()=>{Object(n.b)("manage/freeUpSpace",{closing_date:this.clearTime}).then(async()=>{this.remainMemory=await this.getMemory(),this.$emit("updateList"),this.clearTime="",this.recordCount=0,this.showMemoryBox=!1})}).catch(t=>t):this.$message.error("请选择病例")},timing(){this.curTime=(new Date).getTime(),this.user.is_test&&setTimeout(this.timing,864e5)},async openSeting(){"param"===this.pwsType?(this.ajustType="tct",this.tctParam=this.curParam=await this.getThreshold("tct"),this.changeTab("tct"),this.lctParam=await this.getThreshold("lct"),this.dnaParam=await this.getThreshold("dna"),this.showSettingAIParam=!0,this.showSetting=!1,this.showSetPsw=!1,this.setPsw=""):"control"===this.pwsType?(this.showSetting=!1,this.showSetPsw=!1,this.setPsw="",this.electron.remote.getCurrentWindow().toggleDevTools()):this.$message.error("出什么事了")},changeMode(t){console.log("changeMode")},setType(t){this.pwsType=t,this.showSetPsw=!0,this.showMsg=!1},async showTrialMan(){await this.getTrialTimes(),this.home=!1,this.showTrial=!0},getTrialTimes(){Object(n.b)("manage/get_trial_times").then(({data:t})=>{this.onTrial=t.onTrial;let e=JSON.parse(t.model_lis),s=JSON.parse(t.trialTimes);if(this.onTrial){this.trialTimes=[];for(let t in s)e.includes(t)&&this.trialTimes.push({key:t,times:s[t]})}})},settingOpen(){Object(n.b)("ai/getLabel").then(t=>{this.demoModeValue="1"==localStorage.getItem("demoMode")||!1,this.labelcheck=t.data,this.home=!1,this.showSetting=!0})},orcSave(){localStorage.correctData=JSON.stringify(this.correctData),Object(n.b)("ai/modifyLabel",{label:this.labelcheck}).then(t=>{this.demoModeValue?localStorage.setItem("demoMode","1"):localStorage.setItem("demoMode","0"),this.$emit("updateList"),this.$message.success("保存成功"),this.showSetting=!1}).catch(t=>{this.$message.error(t.message)})},async cancel(){this.showSettingAIParam=!1},apply(){this.$confirm('确定应用新参数吗？<span style="color:#f00">正在处理的切片将不受新参数影响。</span>',"提示",{cancelButtonText:"取消",confirmButtonText:"确定",dangerouslyUseHTMLString:!0,type:"warning"}).then(()=>{if("pdl1"!=this.ajustType){this.loading=!0;let t=Object.assign({},this.curParam,{algor_type:this.ajustType,threshold_value:this.curParam.threshold_value/100});Object(n.b)(`manage/saveAiThreshold?companyid=${this.user.company}`,t).then(t=>{this.loading=!1,this.$message.success("应用成功"),this.showSettingAIParam=!1,this.$emit("updateList")}).catch(t=>{this.loading=!1,this.$message.error(t.message)})}else this.loading=!0,Object(n.b)("ai/changeTps",{smooth_value:this.smoothValue,all_use:Number(this.all_use)}).then(t=>{this.loading=!1,this.$message.success("应用成功"),this.showSettingAIParam=!1,this.$emit("updateList")}).catch(t=>{this.loading=!1,this.$message.error(t.message)})}).catch(()=>{this.loading=!1})},seset(){Object(n.b)(`manage/getDefaultAiThreshold?companyid=${this.user.company}`,{algor_type:this.ajustType}).then(t=>{this.$set(this.curParam,"threshold_value",100*t.data),this.getAnalyseThreshold(),this.$message.success("设置成功")}).catch(t=>{this.loading=!1,this.$message.error(t.message)})},getThreshold(t){return new Promise(e=>{Object(n.b)(`manage/getAiThreshold?companyid=${this.user.company}`,{algor_type:t}).then(t=>{e(Object.assign({},t.data,{threshold_value:100*t.data.threshold_value}))}).catch(()=>e({}))})},getAnalyseThreshold(){Object(n.b)("ai/analyseThreshold",{threshold:this.curParam.threshold_value/100,type:this.ajustType,mode:this.curParam.threshold_range?"all":"part"}).then(t=>{this.analyseThreshold=t.data})},barChange(t){this.getAnalyseThreshold()},quit(){this.isStart?this.$alert("高通量运行状态下无法退出登录，请停止高通量后重试。","提示",{confirmButtonText:"确定",callback:t=>{this.home=!1}}):this.$confirm(this.$t("personal.confirmQiut"),{confirmButtonText:this.$t("confirm.confirm"),cancelButtonText:this.$t("confirm.quit"),type:"warning"}).then(()=>{localStorage.setItem("demoMode","0"),document.cookie="jwt=; expires=Thu, 01 Jan 1970 00:00:00 GMT",this.$router.push("/login")}).catch(()=>{this.home=!1})},clearCache(){this.$confirm("确定清除缓存？",{confirmButtonText:this.$t("confirm.confirm"),cancelButtonText:this.$t("confirm.quit"),type:"warning"}).then(()=>{Object(n.b)("files/delJunkFile").then(()=>{this.home=!1})}).catch(()=>{})},shutdown(){this.$confirm("确定关机吗",{confirmButtonText:this.$t("confirm.confirm"),cancelButtonText:this.$t("confirm.quit"),type:"warning"}).then(()=>{Object(n.b)("manage/shutdown").then(t=>{this.$message({message:"服务器将在10秒后关闭,服务不再可用！",type:"warning"})})}).catch(()=>{this.home=!1})},reboot(){this.$confirm("确定重启吗",{confirmButtonText:this.$t("confirm.confirm"),cancelButtonText:this.$t("confirm.quit"),type:"warning"}).then(()=>{Object(n.b)("manage/reboot").then(t=>{this.$message({message:"服务器将在立刻重启,服务不再可用！",type:"warning"})})}).catch(()=>{this.home=!1})},closeSign(){this.$emit("closeSign"),this.home=!1},noBg:function(){this.home=!1},toogleHome:function(){this.home=!this.home},changePsw(){this.isChange=!0,this.home=!1},confirmPsw(){this.oldPassword&&this.newPassword&&this.newPasswordSure&&this.reg.test(this.newPassword)&&this.oldPassword!=this.newPassword&&this.newPasswordSure==this.newPassword&&Object(n.b)("user/updatePassword",{password:this.oldPassword,newPassword:this.newPassword}).then(t=>{this.$alert(this.$t("changepassword.success"),{confirmButtonText:this.$t("confirm.confirm")}),this.isChange=!1,this.home=!1,this.oldPassword="",this.newPassword="",this.newPasswordSure=""}).catch(t=>{1==t.code?this.$alert(this.$t("changepassword.wrong"),{confirmButtonText:this.$t("confirm.confirm")}):3==t.code?this.$alert("旧密码错误",{confirmButtonText:this.$t("confirm.confirm")}):this.$alert(t.message,{confirmButtonText:this.$t("confirm.confirm")})})},qiutPsw(){this.isChange=!1,this.home=!1,this.oldPassword="",this.newPassword="",this.newPasswordSure=""},addImg:function(){this.home=!1,this.$emit("showSign")},backStage(){this.isStart?this.$alert("高通量运行状态下无法进入后台管理，请停止高通量后重试。","提示",{confirmButtonText:"确定",callback:t=>{this.home=!1}}):"sa"==this.user.role?this.$router.push("/manage"):"admin"==this.user.role&&this.$router.push({path:"/admin",query:{data:this.user.company}})}},async created(){this.getAnalyseThreshold(),this.getTrialTimes(),this.timing(),this.remainMemory=await this.getMemory(),this.memoryRoot=setInterval(async()=>{this.remainMemory=await this.getMemory()},3e5),localStorage.correctData?this.correctData=JSON.parse(localStorage.correctData):(this.correctData={x:0,y:0,z:0},localStorage.correctData=JSON.stringify({x:0,y:0,z:0}))},computed:{isNearExpires(){let t=this.user.time_out+" 23:59:59";return new Date(t).getTime()-this.curTime<864e6}},beforeDestroy(){clearTimeout(this.memoryRoot),this.memoryRoot=null},props:["showSign","isStart","config"],components:{"v-sign":o,PswPop:l.a}},h={render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",[s("ul",{staticClass:"conflict"},[s("li",[s("img",{staticStyle:{cursor:"pointer"},attrs:{src:i("94hp"),width:"186",alt:"迪英加"},on:{click:function(e){return t.$router.push("index")}}}),t._v(" "),t.user.is_test&&!t.isNearExpires?s("div",{staticClass:"status",on:{mouseenter:function(e){t.showBuble=!0},mouseleave:function(e){t.showBuble=!1}}},[t._v("试用中")]):t._e(),t._v(" "),t.user.is_test&&t.isNearExpires?s("div",{staticClass:"statusNearExpire",on:{mouseenter:function(e){t.showBuble=!0},mouseleave:function(e){t.showBuble=!1}}},[t._v("试用即将到期，您可拨打400-8910357获取帮助")]):t._e(),t._v(" "),t.showBuble?s("div",{staticClass:"buble"},[t._v("试用到期时间："+t._s(t.user.time_out))]):t._e()]),t._v(" "),s("li",{staticClass:"header-username"},[s("a",{on:{click:function(e){return t.toogleHome()}}},[t._v(t._s(t.user.username+"@"+t.user.company)),s("em")]),t._v(" "),s("div",{staticClass:"stage",on:{click:function(e){t.showMemoryBox=!t.showMemoryBox}}},[s("img",{attrs:{src:i("i1en")}}),t._v("剩余存储   "),s("span",{class:{warnning:t.remainMemory<5}},[t._v(t._s(t.remainMemory)+"%")])]),t._v(" "),t.home?s("div",{staticClass:"home"},[s("ul",[s("li",{on:{click:function(e){return t.changePsw()}}},[t._v(t._s(t.$t("personal.password")))]),t._v(" "),s("li",{on:{click:function(e){return t.addImg()}}},[t._v(t._s(t.$t("personal.signature")))]),t._v(" "),"sa"==t.user.role||"admin"==t.user.role?s("li",{on:{click:t.backStage}},[t._v("后台管理")]):t._e(),t._v(" "),s("li",{on:{click:t.settingOpen}},[t._v("系统设置")]),t._v(" "),t.user.cloud?t._e():s("li",{on:{click:t.shutdown}},[t._v("关闭服务器")]),t._v(" "),t.user.cloud?t._e():s("li",{on:{click:t.reboot}},[t._v("重启服务器")]),t._v(" "),t.onTrial?s("li",{on:{click:t.showTrialMan}},[t._v("试用管理")]):t._e(),t._v(" "),s("li",{on:{click:t.quit}},[t._v(t._s(t.$t("personal.quit")))])])]):t._e()]),t._v(" "),s("br",{staticStyle:{clear:"both"}})]),t._v(" "),t.home?s("div",{staticClass:"home-bg",on:{click:function(e){return t.noBg()}}}):t._e(),t._v(" "),t.showSign?s("v-sign",{on:{close:t.closeSign}}):t._e(),t._v(" "),s("transition",{attrs:{name:"fade"}},[t.isChange?s("div",{staticClass:"delete"},[s("div",{staticClass:"ctn"},[s("div",{staticClass:"header"},[t._v("\n          "+t._s(t.$t("changepassword.title"))+"\n          "),s("span",{staticClass:"iconfont",on:{click:function(e){return t.qiutPsw()}}})]),t._v(" "),s("div",{staticClass:"content-psw"},[s("dl",{staticClass:"p40"},[s("dt",[t._v(t._s(t.$t("changepassword.oldpsw")))]),t._v(" "),s("dd",[s("input",{directives:[{name:"model",rawName:"v-model",value:t.oldPassword,expression:"oldPassword"}],staticClass:"pws-text",attrs:{name:"txtPassword",autocomplete:"off",type:"password"},domProps:{value:t.oldPassword},on:{input:function(e){e.target.composing||(t.oldPassword=e.target.value)}}}),t._v(" "),""==t.oldPassword?s("div",{staticClass:"point"},[t._v(t._s(t.$t("changepassword.remindoldpsw")))]):t._e()])]),t._v(" "),s("dl",{staticClass:"p12"},[s("dt",[t._v(t._s(t.$t("changepassword.newpsw")))]),t._v(" "),s("dd",[s("input",{directives:[{name:"model",rawName:"v-model",value:t.newPassword,expression:"newPassword"}],staticClass:"pws-text",class:{red:t.newPassword&&(t.newPassword==t.oldPassword||!t.reg.test(t.newPassword))},attrs:{name:"txtPassword1",autocomplete:"off",type:"password"},domProps:{value:t.newPassword},on:{input:function(e){e.target.composing||(t.newPassword=e.target.value)}}}),t._v(" "),t.newPassword?t._e():s("div",{staticClass:"point"},[t._v(t._s(t.$t("changepassword.remindnewpsw")))]),t._v(" "),t.newPassword&&!t.reg.test(t.newPassword)?s("div",{staticClass:"point",staticStyle:{color:"#f6472a"}},[t._v(t._s(t.$t("changepassword.remindnewpsw")))]):t._e(),t._v(" "),t.newPassword&&t.reg.test(t.newPassword)&&t.newPassword==t.oldPassword?s("div",{staticClass:"point",staticStyle:{color:"#f6472a"}},[t._v(t._s(t.$t("changepassword.pswconfirm")))]):t._e()])]),t._v(" "),s("dl",{staticClass:"p12"},[s("dt",[t._v(t._s(t.$t("changepassword.confirmpsw")))]),t._v(" "),s("dd",[s("input",{directives:[{name:"model",rawName:"v-model",value:t.newPasswordSure,expression:"newPasswordSure"}],staticClass:"pws-text",class:{red:""!=t.newPasswordSure&&t.newPasswordSure!=t.newPassword},attrs:{name:"txtPassword2",autocomplete:"off",type:"password"},domProps:{value:t.newPasswordSure},on:{input:function(e){e.target.composing||(t.newPasswordSure=e.target.value)}}}),t._v(" "),t.newPasswordSure?t._e():s("div",{staticClass:"point top40"},[t._v(t._s(t.$t("changepassword.remindconfirmpsw")))]),t._v(" "),t.newPasswordSure&&t.newPasswordSure!=t.newPassword?s("div",{staticClass:"point top40",staticStyle:{color:"#f6472a"}},[t._v(t._s(t.$t("changepassword.inconsistentpsw")))]):t._e()])])]),t._v(" "),s("div",{staticClass:"footer"},[s("button",{on:{click:function(e){return t.confirmPsw()}}},[t._v(t._s(t.$t("confirm.confirm")))]),t._v(" "),s("button",{staticClass:"currentSure",on:{click:function(e){return t.qiutPsw()}}},[t._v(t._s(t.$t("confirm.quit")))])])])]):t._e()]),t._v(" "),s("transition",{attrs:{name:"fade"}},[t.showSettingAIParam?s("div",{staticClass:"delete"},[s("div",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticClass:"param",class:{higher:t.curParam.all_use&&"pdl1"!=t.ajustType,"pdl1-box":"pdl1"==t.ajustType},attrs:{"element-loading-text":"参数应用中…为确保数据安全，期间请勿关闭客户端和服务器","element-loading-background":"rgba(0, 0, 0, 0.8)"}},[s("div",{staticClass:"top-header"},[t._v("算法参数设置")]),t._v(" "),s("div",{staticClass:"center-header"},[s("div",{staticClass:"tips"},[t._v("通过调整参数可以改变AI判读倾向。应用成功后，AI将按照新参数标准进行，请谨慎操作！")]),t._v(" "),s("div",{staticClass:"tabs"},[s("div",{staticClass:"tabs-top"},[s("span",{class:{checked:"tct"===t.ajustType},on:{click:function(e){return e.stopPropagation(),t.changeTab("tct")}}},[t._v("TCT")]),t._v(" "),s("span",{class:{checked:"lct"===t.ajustType},on:{click:function(e){return e.stopPropagation(),t.changeTab("lct")}}},[t._v("LCT")]),t._v(" "),s("span",{class:{checked:"pdl1"===t.ajustType},on:{click:function(e){return e.stopPropagation(),t.changeTab("pdl1")}}},[t._v("PDL1")]),t._v(" "),s("span",{class:{checked:"dna"===t.ajustType},on:{click:function(e){return e.stopPropagation(),t.changeTab("dna")}}},[t._v("TBS+DNA")])]),t._v(" "),"pdl1"!=t.ajustType?s("div",[s("div",{staticClass:"tabs-content"},[s("div",{staticClass:"reset",on:{click:t.seset}},[t._v("恢复默认阈值")]),t._v(" "),s("div",{staticClass:"range"},[t._v("\n                  调参范围：\n                  "),s("el-radio",{attrs:{label:0},on:{change:t.getAnalyseThreshold},model:{value:t.curParam.threshold_range,callback:function(e){t.$set(t.curParam,"threshold_range",e)},expression:"curParam.threshold_range"}},[t._v("阴性和ASC-US、ASC-H切片")]),t._v(" "),s("el-radio",{attrs:{label:1},on:{change:t.getAnalyseThreshold},model:{value:t.curParam.threshold_range,callback:function(e){t.$set(t.curParam,"threshold_range",e)},expression:"curParam.threshold_range"}},[t._v("所有类型切片")])],1),t._v(" "),s("div",{staticClass:"block"},[s("div",{staticClass:"word",style:{left:"calc("+t.curParam.threshold_value+"% - 18px)"}},[t._v(t._s(t.curParam.threshold_value/100))]),t._v(" "),s("el-slider",{attrs:{"show-tooltip":!1},on:{change:t.barChange},model:{value:t.curParam.threshold_value,callback:function(e){t.$set(t.curParam,"threshold_value",e)},expression:"curParam.threshold_value"}}),t._v(" "),t.curParam.threshold_range?s("div",{staticClass:"tot long",style:{left:"calc("+t.curParam.threshold_value+"% - 63px)"}},[s("p",[t._v("阴性 "+t._s((100*t.analyseThreshold.ratio.NILM).toFixed(2))+"%")]),t._v(" "),s("p",[t._v("ASC-US "+t._s((100*t.analyseThreshold.ratio["ASC-US"]).toFixed(2))+"%")]),t._v(" "),s("p",[t._v("ASC-H "+t._s((100*t.analyseThreshold.ratio["ASC-H"]).toFixed(2))+"%")]),t._v(" "),s("p",[t._v("AGC "+t._s((100*t.analyseThreshold.ratio.AGC).toFixed(2))+"%")]),t._v(" "),s("p",[t._v("HSIL "+t._s((100*t.analyseThreshold.ratio.HSIL).toFixed(2))+"%")]),t._v(" "),s("p",[t._v("LSIL "+t._s((100*t.analyseThreshold.ratio.LSIL).toFixed(2))+"%")])]):s("div",{staticClass:"tot",style:{left:"calc("+t.curParam.threshold_value+"% - 63px)"}},[s("p",[t._v("阴性 "+t._s((100*t.analyseThreshold.ratio.NILM).toFixed(2))+"%")]),t._v(" "),s("p",[t._v("ASC-US "+t._s((100*t.analyseThreshold.ratio["ASC-US"]).toFixed(2))+"%")]),t._v(" "),s("p",[t._v("ASC-H "+t._s((100*t.analyseThreshold.ratio["ASC-H"]).toFixed(2))+"%")])])],1),t._v(" "),s("div",{staticClass:"end"},[s("span",[t._v(t._s(t.curParam.threshold_range?"阳性检出更多,阴性检出更少":"ASC-US、ASC-H检出更多，阴性检出更少"))]),t._v(" "),s("span",[t._v(t._s(t.curParam.threshold_range?"阳性检出更少,阴性检出更多":"ASC-US、ASC-H检出更少，阴性检出更多"))])])]),t._v(" "),s("div",{staticClass:"tabs-bot"},[s("el-checkbox",{model:{value:t.curParam.all_use,callback:function(e){t.$set(t.curParam,"all_use",e)},expression:"curParam.all_use"}},[t._v("已处理切片也应用新参数")]),t._v(" "),s("span",{staticClass:"sec"},[t._v(t._s("（预计耗时"+t.analyseThreshold.num_slide+"秒，一旦开始无法中断）"))]),t._v(" "),s("p",[t._v("勾选后，原AI结果可能被更改")]),t._v(" "),t.curParam.all_use?s("div",{staticClass:"c-res"},[s("h2",[t._v("应用结果预览：")]),t._v(" "),s("ul",[s("li",[s("h3",[t._v("敏感性："+t._s((100*t.analyseThreshold.sensitivity).toFixed(2))+"%")]),t._v(" "),s("h3",[t._v("敏感性(不含ASC-US)："+t._s((100*t.analyseThreshold.sensitivity_plus).toFixed(2))+"%")]),t._v(" "),s("h3",[t._v("特异性："+t._s((100*t.analyseThreshold.specificity).toFixed(2))+"%")])]),t._v(" "),s("li",[s("h3",[s("span",[t._v("总数（已处理）："+t._s(t.analyseThreshold.count.sum))])]),t._v(" "),s("h3",[t._v("阴性："+t._s(t.analyseThreshold.count.NILM))]),t._v(" "),s("h3",[t._v("HSIL："+t._s(t.analyseThreshold.count.HSIL))]),t._v(" "),s("h3",[t._v("ASC-H："+t._s(t.analyseThreshold.count["ASC-H"]))]),t._v(" "),s("h3",[t._v("LSIL："+t._s(t.analyseThreshold.count.LSIL))]),t._v(" "),s("h3",[t._v("ASC-US："+t._s(t.analyseThreshold.count["ASC-US"]))]),t._v(" "),s("h3",[t._v("AGC："+t._s(t.analyseThreshold.count.AGC))])]),t._v(" "),s("li",[s("h3",[s("span",[t._v("AI漏阳总数："+t._s(t.analyseThreshold.fn.sum))])]),t._v(" "),s("h3",[t._v("HSIL："+t._s(t.analyseThreshold.fn.HSIL))]),t._v(" "),s("h3",[t._v("ASC-H："+t._s(t.analyseThreshold.fn["ASC-H"]))]),t._v(" "),s("h3",[t._v("LSIL："+t._s(t.analyseThreshold.fn.LSIL))]),t._v(" "),s("h3",[t._v("ASC-US："+t._s(t.analyseThreshold.fn["ASC-US"]))]),t._v(" "),s("h3",[t._v("AGC："+t._s(t.analyseThreshold.fn.AGC))])])]),t._v(" "),s("div",{staticStyle:{"padding-top":"12px"}},[s("h4",[t._v("为使预览结果准确，请：1. 等待所有切片完成判读   2. 确保所有切片的"),s("span",{staticClass:"sec"},[t._v("医院标签正确填入复核结果栏")])]),t._v(" "),s("h4",[s("span",{staticClass:"sec"},[t._v("当前已复核总数为"+t._s(t.analyseThreshold.num_manual)+"。")])])])]):t._e()],1)]):s("div",[s("div",{staticClass:"tabs-content"},[s("div",{staticClass:"updown"},[t._v("\n                  拟合曲线\n                  "),t.smoothImg?s("div",{staticClass:"adjust"},[t._v("\n                    平滑度调整：\n                    "),s("button",{on:{click:function(e){return t.modifySmoothValue("plus")}}},[t._v("+")]),t._v(" "),s("button",{on:{click:function(e){return t.modifySmoothValue("reduce")}}},[t._v("-")])]):t._e(),t._v(" "),s("span",{on:{click:t.resetSmooth}},[t._v("恢复默认")]),t._v(" "),s("span",{on:{click:t.downloadTem}},[t._v("下载模版")]),t._v(" "),s("span",{staticClass:"upload-xls"},[t._v("\n                    上传调参依据\n                    "),s("input",{ref:"smoothfile",staticClass:"pdl1-file",attrs:{type:"file",accept:".xlsx,.xls"},on:{change:function(e){return t.imgPreview(e.currentTarget)}}})])]),t._v(" "),s("div",{staticClass:"img-box"},[t.smoothImg?s("img",{attrs:{src:t.smoothImg,alt:""}}):s("div",[s("div",{staticClass:"upload-box"}),t._v(" "),s("p",[t._v("请先上传调参依据")])])])]),t._v(" "),s("div",{staticClass:"tabs-bot"},["pdl1"===t.ajustType?s("el-checkbox",{model:{value:t.all_use,callback:function(e){t.all_use=e},expression:"all_use"}},[t._v("已处理切片也应用新参数")]):s("el-checkbox",{model:{value:t.curParam.all_use,callback:function(e){t.$set(t.curParam,"all_use",e)},expression:"curParam.all_use"}},[t._v("已处理切片也应用新参数")]),t._v(" "),s("span",{staticClass:"sec"},[t._v(t._s("（一旦开始无法中断，仅支持已处理的全场分析结果调参）"))]),t._v(" "),s("p",[t._v("勾选后，原AI结果可能被更改")])],1)])])]),t._v(" "),s("div",{staticClass:"top-footer"},[s("span",{staticClass:"apply",on:{click:function(e){return t.apply()}}},[t._v("应用")]),t._v(" "),s("span",{on:{click:function(e){return t.cancel()}}},[t._v("取消")])])])]):t._e()]),t._v(" "),s("transition",{attrs:{name:"fade"}},[t.showTrial?s("div",{staticClass:"setting trialctn"},[s("div",{staticClass:"header"},[t._v("\n          账号试用中\n          "),s("span",{staticClass:"iconfont",on:{click:function(e){t.showTrial=!1}}})]),t._v(" "),s("div",{staticClass:"trial"},[s("div",{staticClass:"msg"},[t._v("各算法模块有使用次数限制，可用次数耗尽将无法试用。")]),t._v(" "),s("table",[s("tr",[s("th",[t._v("算法模块")]),s("th",[t._v("可用次数")])]),t._v(" "),t._l(t.trialTimes,function(e){return s("tr",{key:e.key},[s("td",[t._v(t._s(e.key))]),s("td",[t._v(t._s(e.times))])])})],2)]),t._v(" "),s("div",{staticClass:"footer"},[s("button",{staticClass:"save",on:{click:function(e){t.showTrial=!1}}},[t._v("关闭")])])]):t._e()]),t._v(" "),s("transition",{attrs:{name:"fade"}},[t.showSetting?s("div",{staticClass:"zhezao"},[s("div",{staticClass:"setting"},[s("div",{staticClass:"header"},[t._v("\n          系统设置\n          "),s("span",{staticClass:"iconfont",on:{click:function(e){t.showSetting=!1}}})]),t._v(" "),s("div",{staticClass:"content-setting"},[s("div",{staticClass:"regn regn-hidden"},[t._v("切片标签识别\n            "),s("img",{attrs:{src:i("XA3p"),alt:""},on:{mouseenter:function(e){t.showMsg=!0},mouseleave:function(e){t.showMsg=!1}}}),t._v(" "),t.showMsg?s("span",[t._v("切片上传后自动识别，识别成功结果将保存为切片编号")]):t._e()]),t._v(" "),s("el-radio-group",{model:{value:t.labelcheck,callback:function(e){t.labelcheck=e},expression:"labelcheck"}},[s("el-radio",{attrs:{label:4}},[t._v("OCR识别")]),t._v(" "),s("el-radio",{attrs:{label:2}},[t._v("识别条形码")]),t._v(" "),s("el-radio",{attrs:{label:3}},[t._v("识别二维码")]),t._v(" "),s("el-radio",{attrs:{label:1}},[t._v("不识别")])],1),t._v(" "),s("div",{staticClass:"regn"},[t._v("演示模式\n            "),s("img",{attrs:{src:i("XA3p"),alt:""},on:{mouseenter:function(e){t.showTipTxt=!0},mouseleave:function(e){t.showTipTxt=!1}}}),t._v(" "),t.showTipTxt?s("span",{staticClass:"tip-txt"},[t._v("演示模式下，病例详情页可最小化，支持多标签切换浏览，但不支持切换病例（上/下一个）。")]):t._e()]),t._v(" "),s("div",{staticClass:"switch-btn"},[s("el-switch",{on:{change:t.changeMode},model:{value:t.demoModeValue,callback:function(e){t.demoModeValue=e},expression:"demoModeValue"}})],1),t._v(" "),t.config&&t.config.zeiss?s("div",[s("div",{staticClass:"regn"},[t._v("载物平台移动补偿\n              "),s("img",{attrs:{src:i("XA3p"),alt:""},on:{mouseenter:function(e){t.showTips=!0},mouseleave:function(e){t.showTips=!1}}}),t._v(" "),t.showTips?s("span",{staticClass:"tip-txt new-tip"},[t._v("当平台移动后的镜下视野与全场图位置有偏差时，可通过配置X Y Z轴偏差值来补偿矫正")]):t._e()]),t._v(" "),s("div",[t._v("\n              X："),s("el-input",{staticClass:"pos-rad",model:{value:t.correctData.x,callback:function(e){t.$set(t.correctData,"x",e)},expression:"correctData.x"}}),t._v("\n              Y："),s("el-input",{staticClass:"pos-rad",model:{value:t.correctData.y,callback:function(e){t.$set(t.correctData,"y",e)},expression:"correctData.y"}}),t._v("\n              Z："),s("el-input",{staticClass:"pos-rad",model:{value:t.correctData.z,callback:function(e){t.$set(t.correctData,"z",e)},expression:"correctData.z"}})],1)]):t._e(),t._v(" "),t.config&&t.config.zeiss?s("div",[s("div",{staticClass:"regn"},[t._v("模型校准")]),t._v(" "),s("div",{staticClass:"btn",on:{click:t.resetModelCalibration}},[t._v("校准重置")])]):t._e(),t._v(" "),s("div",{staticClass:"regn"},[t._v("算法调参")]),t._v(" "),s("div",{staticClass:"btn",on:{click:function(e){return t.setType("param")}}},[t._v("算法参数设置")]),t._v(" "),t.electron?s("div",{staticClass:"regn"},[t._v("控制台")]):t._e(),t._v(" "),t.electron?s("div",{staticClass:"btn",on:{click:function(e){return t.setType("control")}}},[t._v("进入控制台")]):t._e()],1),t._v(" "),s("div",{staticClass:"footer"},[s("button",{staticClass:"save",on:{click:t.orcSave}},[t._v("保存")]),t._v(" "),s("button",{on:{click:function(e){t.showSetting=!1}}},[t._v(t._s(t.$t("confirm.quit")))])])])]):t._e()]),t._v(" "),s("transition",{attrs:{name:"fade"}},[t.showSetPsw?s("PswPop",{attrs:{title:"该功能仅限授权人员访问",setPsw:t.setPsw,showTip:t.showTip},on:{confirmBtn:t.openSeting,cancelBtn:function(e){t.showSetPsw=!1}}}):t._e()],1),t._v(" "),s("transition",{attrs:{name:"fade"}},[t.showMemoryBox?s("div",{staticClass:"zhezao"},[s("div",{staticClass:"setting me-contetn"},[s("div",{staticClass:"header"},[t._v("\n            存储空间管理\n            "),s("span",{staticClass:"iconfont",on:{click:function(e){t.showMemoryBox=!1}}})]),t._v(" "),s("div",{staticClass:"content-setting"},[s("div",{staticClass:"progress"},[s("div",{staticClass:"per"},[s("div",{staticClass:"used-memory",class:{warnning:t.remainMemory<5},style:{width:100-t.remainMemory+"%"}})]),t._v("\n              当前剩余 "),s("span",{class:{warnning:t.remainMemory<5}},[t._v(t._s(t.remainMemory)+"%")]),t._v(" 可用\n            ")]),t._v(" "),s("p",{staticClass:"gray"},[t._v("服务器存储空间不足时将无法上传新的切片，建议删除病例切片腾出空间，也可以拨打客服热线400-8910357申请增加磁盘空间。")]),t._v(" "),s("div",{staticClass:"memorydiv"},[t._v("删除"),s("el-date-picker",{attrs:{type:"date","picker-options":t.pickerOptions},on:{change:t.timeChange},model:{value:t.clearTime,callback:function(e){t.clearTime=e},expression:"clearTime"}}),t._v("之前创建的所有病例（含切片、附件）")],1),t._v(" "),s("div",{staticClass:"memorydiv"},[t._v("共 "+t._s(t.recordCount)+" 条病例")])]),t._v(" "),s("div",{staticClass:"footer"},[s("button",{staticClass:"save",on:{click:t.clearCase}},[t._v("删除")]),t._v(" "),s("button",{on:{click:function(e){t.showMemoryBox=!1}}},[t._v(t._s(t.$t("confirm.quit")))])])])]):t._e()])],1)},staticRenderFns:[]};var u=i("VU/8")(c,h,!1,function(t){i("jLS6")},"data-v-2fcdfb88",null);s.a=u.exports},LC74:function(t,e){"function"==typeof Object.create?t.exports=function(t,e){t.super_=e,t.prototype=Object.create(e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}})}:t.exports=function(t,e){t.super_=e;var s=function(){};s.prototype=e.prototype,t.prototype=new s,t.prototype.constructor=t}},Mk6O:function(t,e,s){var i,n;n=function(t){var e=["N","E","A","D"];function s(t,e){t.super_=e,t.prototype=Object.create(e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}})}function i(t,e){Object.defineProperty(this,"kind",{value:t,enumerable:!0}),e&&e.length&&Object.defineProperty(this,"path",{value:e,enumerable:!0})}function n(t,e,s){n.super_.call(this,"E",t),Object.defineProperty(this,"lhs",{value:e,enumerable:!0}),Object.defineProperty(this,"rhs",{value:s,enumerable:!0})}function a(t,e){a.super_.call(this,"N",t),Object.defineProperty(this,"rhs",{value:e,enumerable:!0})}function r(t,e){r.super_.call(this,"D",t),Object.defineProperty(this,"lhs",{value:e,enumerable:!0})}function o(t,e,s){o.super_.call(this,"A",t),Object.defineProperty(this,"index",{value:e,enumerable:!0}),Object.defineProperty(this,"item",{value:s,enumerable:!0})}function l(t,e,s){var i=t.slice((s||e)+1||t.length);return t.length=e<0?t.length+e:e,t.push.apply(t,i),t}function c(t){var e=typeof t;return"object"!==e?e:t===Math?"math":null===t?"null":Array.isArray(t)?"array":"[object Date]"===Object.prototype.toString.call(t)?"date":"function"==typeof t.toString&&/^\/.*\//.test(t.toString())?"regexp":"object"}function h(t){var e=0;if(0===t.length)return e;for(var s=0;s<t.length;s++){var i=t.charCodeAt(s);e=(e<<5)-e+i,e&=e}return e}function u(t){var e=0,s=c(t);if("array"===s){t.forEach(function(t){e+=u(t)});var i="[type: array, hash: "+e+"]";return e+h(i)}if("object"===s){for(var n in t)if(t.hasOwnProperty(n)){var a="[ type: object, key: "+n+", value hash: "+u(t[n])+"]";e+=h(a)}return e}var r="[ type: "+s+" ; value: "+t+"]";return e+h(r)}function d(t,e,s,i,l,h,p,f){s=s||[],l=l||[],p=p||[];var m=l.slice(0);if(void 0!==h&&null!==h){if(i){if("function"==typeof i&&i(m,h))return;if("object"==typeof i){if(i.prefilter&&i.prefilter(m,h))return;if(i.normalize){var v=i.normalize(m,h,t,e);v&&(t=v[0],e=v[1])}}}m.push(h)}"regexp"===c(t)&&"regexp"===c(e)&&(t=t.toString(),e=e.toString());var g,y,_,w,b=typeof t,x=typeof e,k="undefined"!==b||p&&p.length>0&&p[p.length-1].lhs&&Object.getOwnPropertyDescriptor(p[p.length-1].lhs,h),C="undefined"!==x||p&&p.length>0&&p[p.length-1].rhs&&Object.getOwnPropertyDescriptor(p[p.length-1].rhs,h);if(!k&&C)s.push(new a(m,e));else if(!C&&k)s.push(new r(m,t));else if(c(t)!==c(e))s.push(new n(m,t,e));else if("date"===c(t)&&t-e!=0)s.push(new n(m,t,e));else if("object"===b&&null!==t&&null!==e){for(g=p.length-1;g>-1;--g)if(p[g].lhs===t){w=!0;break}if(w)t!==e&&s.push(new n(m,t,e));else{if(p.push({lhs:t,rhs:e}),Array.isArray(t)){for(f&&(t.sort(function(t,e){return u(t)-u(e)}),e.sort(function(t,e){return u(t)-u(e)})),g=e.length-1,y=t.length-1;g>y;)s.push(new o(m,g,new a(void 0,e[g--])));for(;y>g;)s.push(new o(m,y,new r(void 0,t[y--])));for(;g>=0;--g)d(t[g],e[g],s,i,m,g,p,f)}else{var T=Object.keys(t),P=Object.keys(e);for(g=0;g<T.length;++g)_=T[g],(w=P.indexOf(_))>=0?(d(t[_],e[_],s,i,m,_,p,f),P[w]=null):d(t[_],void 0,s,i,m,_,p,f);for(g=0;g<P.length;++g)(_=P[g])&&d(void 0,e[_],s,i,m,_,p,f)}p.length=p.length-1}}else t!==e&&("number"===b&&isNaN(t)&&isNaN(e)||s.push(new n(m,t,e)))}function p(t,e,s,i,n){var a=[];if(d(t,e,a,i,null,null,null,n),s)for(var r=0;r<a.length;++r)s(a[r]);return a}function f(t,e,s,i){var n=i?function(t){t&&i.push(t)}:void 0,a=p(t,e,n,s);return i||(a.length?a:void 0)}function m(t,s,i){if(void 0===i&&s&&~e.indexOf(s.kind)&&(i=s),t&&i&&i.kind){for(var n=t,a=-1,r=i.path?i.path.length-1:0;++a<r;)void 0===n[i.path[a]]&&(n[i.path[a]]=void 0!==i.path[a+1]&&"number"==typeof i.path[a+1]?[]:{}),n=n[i.path[a]];switch(i.kind){case"A":i.path&&void 0===n[i.path[a]]&&(n[i.path[a]]=[]),function t(e,s,i){if(i.path&&i.path.length){var n,a=e[s],r=i.path.length-1;for(n=0;n<r;n++)a=a[i.path[n]];switch(i.kind){case"A":t(a[i.path[n]],i.index,i.item);break;case"D":delete a[i.path[n]];break;case"E":case"N":a[i.path[n]]=i.rhs}}else switch(i.kind){case"A":t(e[s],i.index,i.item);break;case"D":e=l(e,s);break;case"E":case"N":e[s]=i.rhs}return e}(i.path?n[i.path[a]]:n,i.index,i.item);break;case"D":delete n[i.path[a]];break;case"E":case"N":n[i.path[a]]=i.rhs}}}s(n,i),s(a,i),s(r,i),s(o,i),Object.defineProperties(f,{diff:{value:f,enumerable:!0},orderIndependentDiff:{value:function(t,e,s,i){var n=i?function(t){t&&i.push(t)}:void 0,a=p(t,e,n,s,!0);return i||(a.length?a:void 0)},enumerable:!0},observableDiff:{value:p,enumerable:!0},orderIndependentObservableDiff:{value:function(t,e,s,i,n,a,r){return d(t,e,s,i,n,a,r,!0)},enumerable:!0},orderIndepHash:{value:u,enumerable:!0},applyDiff:{value:function(t,e,s){t&&e&&p(t,e,function(i){s&&!s(t,e,i)||m(t,e,i)})},enumerable:!0},applyChange:{value:m,enumerable:!0},revertChange:{value:function(t,e,s){if(t&&e&&s&&s.kind){var i,n,a=t;for(n=s.path.length-1,i=0;i<n;i++)void 0===a[s.path[i]]&&(a[s.path[i]]={}),a=a[s.path[i]];switch(s.kind){case"A":!function t(e,s,i){if(i.path&&i.path.length){var n,a=e[s],r=i.path.length-1;for(n=0;n<r;n++)a=a[i.path[n]];switch(i.kind){case"A":t(a[i.path[n]],i.index,i.item);break;case"D":case"E":a[i.path[n]]=i.lhs;break;case"N":delete a[i.path[n]]}}else switch(i.kind){case"A":t(e[s],i.index,i.item);break;case"D":case"E":e[s]=i.lhs;break;case"N":e=l(e,s)}return e}(a[s.path[i]],s.index,s.item);break;case"D":case"E":a[s.path[i]]=s.lhs;break;case"N":delete a[s.path[i]]}}},enumerable:!0},isConflict:{value:function(){return"undefined"!=typeof $conflict},enumerable:!0}}),f.DeepDiff=f,t&&(t.DeepDiff=f);return f}(this),void 0===(i=function(){return n}.call(e,s,e,t))||(t.exports=i)},NmLI:function(t,e,s){t.exports=s.p+"static/img/打点.4615a77.svg"},OMJi:function(t,e,s){(function(t,i){var n=/%[sdj%]/g;e.format=function(t){if(!g(t)){for(var e=[],s=0;s<arguments.length;s++)e.push(o(arguments[s]));return e.join(" ")}s=1;for(var i=arguments,a=i.length,r=String(t).replace(n,function(t){if("%%"===t)return"%";if(s>=a)return t;switch(t){case"%s":return String(i[s++]);case"%d":return Number(i[s++]);case"%j":try{return JSON.stringify(i[s++])}catch(t){return"[Circular]"}default:return t}}),l=i[s];s<a;l=i[++s])m(l)||!w(l)?r+=" "+l:r+=" "+o(l);return r},e.deprecate=function(s,n){if(y(t.process))return function(){return e.deprecate(s,n).apply(this,arguments)};if(!0===i.noDeprecation)return s;var a=!1;return function(){if(!a){if(i.throwDeprecation)throw new Error(n);i.traceDeprecation?console.trace(n):console.error(n),a=!0}return s.apply(this,arguments)}};var a,r={};function o(t,s){var i={seen:[],stylize:c};return arguments.length>=3&&(i.depth=arguments[2]),arguments.length>=4&&(i.colors=arguments[3]),f(s)?i.showHidden=s:s&&e._extend(i,s),y(i.showHidden)&&(i.showHidden=!1),y(i.depth)&&(i.depth=2),y(i.colors)&&(i.colors=!1),y(i.customInspect)&&(i.customInspect=!0),i.colors&&(i.stylize=l),h(i,t,i.depth)}function l(t,e){var s=o.styles[e];return s?"["+o.colors[s][0]+"m"+t+"["+o.colors[s][1]+"m":t}function c(t,e){return t}function h(t,s,i){if(t.customInspect&&s&&k(s.inspect)&&s.inspect!==e.inspect&&(!s.constructor||s.constructor.prototype!==s)){var n=s.inspect(i,t);return g(n)||(n=h(t,n,i)),n}var a=function(t,e){if(y(e))return t.stylize("undefined","undefined");if(g(e)){var s="'"+JSON.stringify(e).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return t.stylize(s,"string")}if(v(e))return t.stylize(""+e,"number");if(f(e))return t.stylize(""+e,"boolean");if(m(e))return t.stylize("null","null")}(t,s);if(a)return a;var r=Object.keys(s),o=function(t){var e={};return t.forEach(function(t,s){e[t]=!0}),e}(r);if(t.showHidden&&(r=Object.getOwnPropertyNames(s)),x(s)&&(r.indexOf("message")>=0||r.indexOf("description")>=0))return u(s);if(0===r.length){if(k(s)){var l=s.name?": "+s.name:"";return t.stylize("[Function"+l+"]","special")}if(_(s))return t.stylize(RegExp.prototype.toString.call(s),"regexp");if(b(s))return t.stylize(Date.prototype.toString.call(s),"date");if(x(s))return u(s)}var c,w="",C=!1,T=["{","}"];(p(s)&&(C=!0,T=["[","]"]),k(s))&&(w=" [Function"+(s.name?": "+s.name:"")+"]");return _(s)&&(w=" "+RegExp.prototype.toString.call(s)),b(s)&&(w=" "+Date.prototype.toUTCString.call(s)),x(s)&&(w=" "+u(s)),0!==r.length||C&&0!=s.length?i<0?_(s)?t.stylize(RegExp.prototype.toString.call(s),"regexp"):t.stylize("[Object]","special"):(t.seen.push(s),c=C?function(t,e,s,i,n){for(var a=[],r=0,o=e.length;r<o;++r)$(e,String(r))?a.push(d(t,e,s,i,String(r),!0)):a.push("");return n.forEach(function(n){n.match(/^\d+$/)||a.push(d(t,e,s,i,n,!0))}),a}(t,s,i,o,r):r.map(function(e){return d(t,s,i,o,e,C)}),t.seen.pop(),function(t,e,s){if(t.reduce(function(t,e){return 0,e.indexOf("\n")>=0&&0,t+e.replace(/\u001b\[\d\d?m/g,"").length+1},0)>60)return s[0]+(""===e?"":e+"\n ")+" "+t.join(",\n  ")+" "+s[1];return s[0]+e+" "+t.join(", ")+" "+s[1]}(c,w,T)):T[0]+w+T[1]}function u(t){return"["+Error.prototype.toString.call(t)+"]"}function d(t,e,s,i,n,a){var r,o,l;if((l=Object.getOwnPropertyDescriptor(e,n)||{value:e[n]}).get?o=l.set?t.stylize("[Getter/Setter]","special"):t.stylize("[Getter]","special"):l.set&&(o=t.stylize("[Setter]","special")),$(i,n)||(r="["+n+"]"),o||(t.seen.indexOf(l.value)<0?(o=m(s)?h(t,l.value,null):h(t,l.value,s-1)).indexOf("\n")>-1&&(o=a?o.split("\n").map(function(t){return"  "+t}).join("\n").substr(2):"\n"+o.split("\n").map(function(t){return"   "+t}).join("\n")):o=t.stylize("[Circular]","special")),y(r)){if(a&&n.match(/^\d+$/))return o;(r=JSON.stringify(""+n)).match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(r=r.substr(1,r.length-2),r=t.stylize(r,"name")):(r=r.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),r=t.stylize(r,"string"))}return r+": "+o}function p(t){return Array.isArray(t)}function f(t){return"boolean"==typeof t}function m(t){return null===t}function v(t){return"number"==typeof t}function g(t){return"string"==typeof t}function y(t){return void 0===t}function _(t){return w(t)&&"[object RegExp]"===C(t)}function w(t){return"object"==typeof t&&null!==t}function b(t){return w(t)&&"[object Date]"===C(t)}function x(t){return w(t)&&("[object Error]"===C(t)||t instanceof Error)}function k(t){return"function"==typeof t}function C(t){return Object.prototype.toString.call(t)}function T(t){return t<10?"0"+t.toString(10):t.toString(10)}e.debuglog=function(t){if(y(a)&&(a=Object({NODE_ENV:"production"}).NODE_DEBUG||""),t=t.toUpperCase(),!r[t])if(new RegExp("\\b"+t+"\\b","i").test(a)){var s=i.pid;r[t]=function(){var i=e.format.apply(e,arguments);console.error("%s %d: %s",t,s,i)}}else r[t]=function(){};return r[t]},e.inspect=o,o.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},o.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"},e.isArray=p,e.isBoolean=f,e.isNull=m,e.isNullOrUndefined=function(t){return null==t},e.isNumber=v,e.isString=g,e.isSymbol=function(t){return"symbol"==typeof t},e.isUndefined=y,e.isRegExp=_,e.isObject=w,e.isDate=b,e.isError=x,e.isFunction=k,e.isPrimitive=function(t){return null===t||"boolean"==typeof t||"number"==typeof t||"string"==typeof t||"symbol"==typeof t||void 0===t},e.isBuffer=s("fC4T");var P=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function $(t,e){return Object.prototype.hasOwnProperty.call(t,e)}e.log=function(){var t,s;console.log("%s - %s",(t=new Date,s=[T(t.getHours()),T(t.getMinutes()),T(t.getSeconds())].join(":"),[t.getDate(),P[t.getMonth()],s].join(" ")),e.format.apply(e,arguments))},e.inherits=s("LC74"),e._extend=function(t,e){if(!e||!w(e))return t;for(var s=Object.keys(e),i=s.length;i--;)t[s[i]]=e[s[i]];return t}}).call(e,s("DuR2"),s("W2nU"))},OvwT:function(t,e){},Qar8:function(t,e,s){t.exports=s.p+"static/img/多边形.838184f.svg"},SfvY:function(t,e,s){"use strict";var i,n=s("I9+T"),a=s("k5KV"),r=s.n(a),o=s("jyVo"),l={props:["slice","record","roilist","curRois","centerRegion","penColor","position","content","companyid","showMppGuide","cellArea","showLayer","moveStatus","radius","filled","currentAngle"],data(){return{mpp:this.slice.mppx||.242042,scale:1,fullPage:!1,osd:null,company:this.$props.companyid||Object(o.o)().company,viewport:null,paper:null,selectedTool:"choose",dataMapPath:{},offsetWidth:0,offsetHeight:0,showRoi:!0,saved:!1,showLabel:!0,knew:!1,drawMpp:!1,userMpp:null,deg:0,layers:[null,null,null,null,null,null],showPenTool:!1,pentool:"freepen",scope:null,pointAble:["ki67","er","pr","pdl1","tagging","fish","ki67hot","her2","np","cd30"].includes(this.slice.toolType),reverseAble:!1,showRadius:!1,newRadius:this.radius,segmentsList:[]}},methods:{adjustSegment(){Object.keys(this.curRois).length?this.selectedTool="pickTool":this.$message.warning("请先选择一个调整对象")},toNumber(){this.newRadius=this.newRadius.replace(/[^\.\d]/g,"")},checkTool(t){this.showPenTool=!1,this.pentool=t,this.selectedTool=t},chooseTool(){this.pentool==this.selectedTool&&(this.showPenTool=!this.showPenTool),this.selectedTool=this.pentool},rotate(){this.deg+=90,this.$refs.rotate.style.transform=`rotate(${this.deg}deg)`},drawCell(){this.$emit("closeMppGuide",!0),this.drawMpp=!0,this.selectedTool="rectangle"},convertPoint(t,e){return this.paper.view.viewToProject(new this.paper.Point(t,e))},initOSD(){let t=OpenSeadragon({element:this.$refs.osd,tileSources:{height:this.slice.height,width:this.slice.width,tileSize:1024,getTileUrl:(t,e,s)=>`/aipath/api/files/slice?x=${e}&y=${s}&z=${t}&caseid=${this.record.id}&fileid=${this.slice.id}&companyid=${this.company}&filename=${encodeURIComponent(this.slice.filename||this.slice.name)}`},minZoomLevel:.001,maxZoomLevel:1e4,visibilityRatio:.01,toolbar:this.$refs.hideToolbar,mouseNavEnabled:!1,animationTime:.8,maxImageCacheCount:12,immediately:!0,showNavigator:!0,navigatorPosition:"TOP_LEFT",navigatorAutoFade:!1});this.osd=t,this.viewport=t.viewport,this.$emit("viewer",this.viewport),t.activateImagingHelper(),t.addHandler("open",()=>{this.paper=new paper.PaperScope,this.paper.activate(),this.paper.setup(this.$refs.canvas),this.paper.settings.handleSize=8,this.layers[0]=new this.paper.Layer,this.layers[1]=new this.paper.Layer,this.layers[2]=new this.paper.Layer,this.layers[3]=new this.paper.Layer,this.layers[4]=new this.paper.Layer,this.layers[5]=new this.paper.Layer,this.roilistChange(this.roilist||[],[]),this.resized(),this.position.zoom?this.update(this.position,!0):this.buttonClick("home");let e=null;t.addHandler("update-viewport",()=>{let t=this.slice.width,{x:s,y:i}=this.viewport.getBounds(!0).getCenter();this.paper.view.rotation=this.currentAngle||0,this.paper.view.setCenter(s*t,i*t);let n=this.viewport.getZoom(!0);this.paper.view.zoom=this.viewport.viewportToImageZoom(n),clearTimeout(e),e=setTimeout(()=>{this.getRoi()},400)}),t.addHandler("animation-start",()=>{"pdl1"!=this.slice.toolType&&"np"!=this.slice.toolType||this.$emit("changeMoveStatus","moveStart")}),t.addHandler("animation-finish",()=>{let t=this.slice.width/this.slice.height,e=this.paper.view.getCenter().x/this.slice.width,s=this.paper.view.getCenter().y/this.slice.height/t;this.position.offx.toFixed(10)===e.toFixed(10)&&this.position.offy.toFixed(10)===s.toFixed(10)||this.move(e,s)})}),this.$refs.osd.addEventListener("contextmenu",this.contextmenu),window.addEventListener("resize",this.resize)},getRoi(){if(!this.paper.view)return;let t=parseInt(this.convertPoint(0,0).x),e=parseInt(this.convertPoint(0,0).y);if(this.$refs.osd){let t=this.$refs.osd.querySelector(".openseadragon-canvas").querySelector("canvas");var s=parseInt(this.convertPoint(t.width,t.height).x),i=parseInt(this.convertPoint(t.width,t.height).y)}let n=this.osd.world.getItemAt(0).lastDrawn,a=Math.max(...n.map(t=>t.level));this.$emit("getRoi",{x1:t,x2:s,y1:e,y2:i,z:a}),"pdl1"!=this.slice.toolType&&"np"!=this.slice.toolType||this.$emit("changeMoveStatus","moveEnd")},move(t,e,s){this.$emit("position","number"==typeof t?t:this.position.offx,"number"==typeof e?e:this.position.offy,"number"==typeof s?s:this.position.zoom)},update(t=this.position,e){this.viewport.zoomTo(t.zoom,"",e),this.viewport.panTo({x:t.offx,y:t.offy},e)},resize(){setTimeout(t=>this.resized(this.position.zoom/this.scale),0)},resized(t){this.offsetWidth=this.$refs.osd.offsetWidth,this.offsetHeight=this.$refs.osd.offsetHeight,this.paper.view.viewSize=[this.offsetWidth,this.offsetHeight],this.scale=this.mpp*this.slice.width*Math.min(this.offsetHeight/this.offsetWidth,1)/22e3,this.move(null,null,t?t*this.scale:null),t&&t*this.scale!=this.position.zoom||setTimeout(this.update,80)},navstart(t){if(t.button)return;let e=this.$refs.navigator;var s=t=>{t=c(t),this.move(t.offsetX/e.clientWidth,t.offsetY/e.clientHeight*this.slice.height/this.slice.width)},i=()=>{e.removeEventListener("mousemove",s),e.removeEventListener("touchmove",s),window.removeEventListener("mouseup",i)};e.addEventListener("mousemove",s),e.addEventListener("touchmove",s),window.addEventListener("mouseup",i),s(t)},handleFullScreen(){this.fullPage=!this.fullPage,this.$parent.$parent.fullPage=this.fullPage,this.resize()},buttonClick(t){switch(t){case"zoom-in":this.move(null,null,2*this.position.zoom);break;case"zoom-out":this.move(null,null,this.position.zoom/2);break;case"home":let e=this.slice.width/this.slice.height;this.move(.5,.5/e,Math.min(this.offsetHeight/this.offsetWidth*e,1));break;case"original":this.move(null,null,this.slice.width/this.offsetWidth);break;default:this.move(null,null,t)}},path2data:t=>({x:t.map(t=>t.point.x),y:t.map(t=>t.point.y)}),equal(t,e){if(t.length!==e.length)return!1;for(let s=0;s<t.length;s++)if(t[s].image!==e[s].image)return!1;return!0},roilistChange(t,e){let s={},i={};t.map(t=>{s[t.id]=t}),e.map(t=>{i[t.id]=t});let n=e.filter(t=>!r.a.equals(t,s[t.id])),a=t.filter(t=>!r.a.equals(t,i[t.id]));for(let t of n)this.dataMapPath[t.id]&&!this.curRois[t.id]&&(this.dataMapPath[t.id].text&&(this.dataMapPath[t.id].text.remove(),this.dataMapPath[t.id].rectangle.remove()),this.dataMapPath[t.id].path.remove(),delete this.dataMapPath[t.id]);let o=a.length,l=0,c=200;var h=this;o>0&&function t(){let e=l+c>a.length?a.length:l+c;if(!(l>o)){for(var s=l;s<e;s++)h.newRoi(a[s]);l+=c,t()}}(),this.setLayer(),this.roilist.forEach(t=>{this.showRoi?this.dataMapPath[t.id].path.selected=!!this.curRois[t.id]:this.dataMapPath[t.id].path.selected=!1,"spot"!=t.method&&this.curRois[t.id]&&this.drawArea(t)})},setLayer(){let t=Object.values(this.dataMapPath);var e={};let s=[...new Set(t.map(t=>t.data.mark_type))].map(t=>(e[t]=[],t));t.map(t=>{s.filter(e=>e==t.data.mark_type).length&&e[t.data.mark_type].push(t.path)}),this.layers[0].children=null,this.layers[1].children=e[3],this.layers[2].children=e[1],this.layers[3].children=e[2],this.layers[4].children=e[4],this.layers[5].children=e[5]},spliceArray(t){for(var e=void 0,s=0;s<t.x.length-1;s++){var i=t.x[s+1]-t.x[s],n=(t.y[s+1]-t.y[s])/i;(isNaN(e)&&isNaN(n)||n==e)&&(t.x.splice(s,1),t.y.splice(s,1),s--),e=n}return t},newRoi(t={editable:1,path:{x:[],y:[]}}){t=r.a.clone(t);let e,s={};if(this.paper.activate(),t.path.x.length>4&&(t.path=this.spliceArray(t.path)),e="spot"==t.method?new this.paper.Path.Circle({center:[4===t.path.x.length?t.path.x[1]:t.path.x[0],t.path.y[0]],radius:t.radius,strokeScaling:!1,fillColor:t.fillColor||"rgba(0,0,0,0.001)",strokeColor:t.strokeColor||null,owner:t,strokeWidth:3}):new this.paper.Path({segments:t.path.x.map((e,s)=>({x:e,y:t.path.y[s]})),strokeWidth:t.width||3,fillColor:t.fillColor||("secectMulty"==t.method?"rgba(255,255,255,0.5)":"rgba(0,0,0,0.001)"),strokeColor:t.strokeColor,strokeScaling:!1,owner:t,closed:!0,dashArray:t.dashed?[10,5]:[0,0]}),Object.assign(s,{path:e,dragCenter:!1,dragVertex:!1,dragEdge:!1,resetDragStatus(){this.dragCenter=this.dragVertex=this.dragEdge=!1}}),"freepen"==t.method||"freepenReverse"==t.method){var i=this;s.drag=function(t){this.dragVertex?(this.segment.point.x+=t.x,this.segment.point.y+=t.y,s.text&&(s.text.content=this.content?this.content:"面积:"+Math.round(Math.abs(s.path.area)*Math.pow(i.mpp,2))+"μm²")):this.dragCenter&&(this.path.position.x+=t.x,this.path.position.y+=t.y,s.text&&(s.text.position.x+=t.x,s.text.position.y+=t.y,s.rectangle.position.x+=t.x,s.rectangle.position.y+=t.y))},s.checkPath=function(t,e){if(this.segment=null,this.resetDragStatus(),"segment"==e.type){this.segment=e.segment;let t=e.item;"pickTool"===i.selectedTool&&t.smooth({type:"catmull-rom",factor:.5,from:this.segment.previous.index,to:this.segment.next.index}),this.dragVertex=!0,s.text&&(s.text.content=this.content?this.content:"面积:"+Math.round(Math.abs(s.path.area)*Math.pow(i.mpp,2))+"μm²")}else"fill"==e.type&&(this.dragCenter=!0)}}else if("rectangle"==t.method||"rectangleReverse"==t.method||"secectMulty"==t.method){i=this;s.drag=function(t){let e=(t,e)=>Math.abs(t-e)<1e-4;if(this.dragVertex){let n=this.segment.point.x,a=this.segment.point.y,r=n+t.x,o=a+t.y;this.path.segments.map(t=>{t.point.x=e(t.point.x,n)?r:t.point.x,t.point.y=e(t.point.y,a)?o:t.point.y});let l=this.path.segments[0].point.x<this.path.segments[2].point.x?this.path.segments[0].point.x:this.path.segments[2].point.x,c=this.path.segments[0].point.y<this.path.segments[2].point.y?this.path.segments[0].point.y:this.path.segments[2].point.y;s.text.content=this.content?this.content:"面积:"+Math.round(Math.abs(s.path.area)*Math.pow(i.mpp,2))+"μm²";let h=l!=Math.min.apply(null,s.data.path.x),u=c!=Math.min.apply(null,s.data.path.y);h&&!u&&(s.text.position.x+=t.x,s.rectangle.position.x+=t.x),!h&&u&&(s.text.position.y+=t.y,s.rectangle.position.y+=t.y),h&&u&&(s.text.position.y+=t.y,s.rectangle.position.y+=t.y,s.text.position.x+=t.x,s.rectangle.position.x+=t.x)}else if(this.dragEdge){if(e(this.editPt1.x,this.editPt2.x)&&(this.editPt1.x+=t.x,this.editPt2.x+=t.x,s.text)){s.text.content=this.content?this.content:"面积:"+Math.round(Math.abs(s.path.area)*Math.pow(i.mpp,2))+"μm²";let e=s.path.segments[0].point.x>s.path.segments[2].point.x?s.path.segments[0].point.x:s.path.segments[2].point.x;this.editPt1.x<e&&(s.text.position.x+=t.x,s.rectangle.position.x+=t.x)}if(e(this.editPt1.y,this.editPt2.y)&&(this.editPt1.y+=t.y,this.editPt2.y+=t.y,s.text)){s.text.content=this.content?this.content:"面积:"+Math.round(Math.abs(s.path.area)*Math.pow(i.mpp,2))+"μm²";let e=s.path.segments[0].point.y>s.path.segments[2].point.y?s.path.segments[0].point.y:s.path.segments[2].point.y;this.editPt1.y<e&&(s.text.position.y+=t.y,s.rectangle.position.y+=t.y)}}else this.dragCenter&&(this.path.segments.map(e=>{e.point.x+=t.x,e.point.y+=t.y}),s.text&&(s.text.position.x+=t.x,s.text.position.y+=t.y,s.rectangle.position.x+=t.x,s.rectangle.position.y+=t.y))},s.checkPath=function(t,e){if(this.segment=this.editPt1=this.editPt2=null,this.resetDragStatus(),"segment"==e.type)this.segment=e.segment,this.dragVertex=!0;else if("stroke"==e.type){let t=e.location;this.editPt1=t.curve.point1,this.editPt2=t.curve.point2,this.dragEdge=!0}else"fill"==e.type&&(this.dragCenter=!0)}}else"spot"==t.method&&(s.drag=function(t){this.path.position.x+=t.x,this.path.position.y+=t.y},s.checkPath=function(t,e){this.segment=null,this.resetDragStatus(),"segment"==e.type?(this.segment=e.segment,this.dragVertex=!0):"fill"==e.type&&(this.dragCenter=!0)});return s.data=t,s.path.visible=this.showRoi,s.path.selected=this.showRoi,this.dataMapPath[t.id]=s,s},drawArea(t){this.paper.activate();let e=this.dataMapPath[t.id];e&&e.text&&(e.text.remove(),e.rectangle.remove());let s=Math.min.apply(null,t.path.x.map(t=>t)),i=Math.min.apply(null,t.path.y.map(t=>t));"freepen"!=t.method&&"freepenReverse"!=t.method||(i=Math.min.apply(null,t.path.y.map(t=>t)),s=t.path.x[t.path.y.findIndex(e=>e==Math.min.apply(null,t.path.y.map(t=>t)))]);let n=this.viewport.viewportToImageZoom(this.position.zoom);var a={x:s,y:i-30/n},r={x:s,y:i};e.text=new this.paper.PointText({point:r,content:this.content?this.content:"面积:"+Math.round(Math.abs(e.path.area)*Math.pow(this.mpp,2))+"μm²",fillColor:"white",justification:"center",fontSize:14/n});var o=e.text.bounds.width,l=e.text.bounds.height;e.text.bounds.top-=28/n-l,e.text.bounds.left+=o/2+4/n,e.rectangle=new this.paper.Path.Rectangle(a,o+8/n,24/n,4/n),e.rectangle.fillColor="rgba(0,0,0,0.5)",this.paper.project.activeLayer.addChild(e.text),"freepen"!=t.method&&"freepenReverse"!=t.method||(e.text.bounds.left-=o+12/n,e.rectangle.bounds.left-=e.rectangle.bounds.width+4/n),this.showRoi||(e.text.visible=!1,e.rectangle.visible=!1)},contextmenu(t){let e=this.convertPoint(t.offsetX,t.offsetY),s=this.paper.project.hitTest(e,{stroke:!0,segments:!0,fill:!0}),i=s.item.owner.path,n=Math.max.apply(null,i.x.map(t=>t)),a=Math.max.apply(null,i.y.map(t=>t));"freepen"!=s.item.owner.method&&"freepenReverse"!=s.item.owner.method||(n=Math.max.apply(null,i.x.map(t=>t)),a=i.y[i.x.findIndex(t=>t==Math.max.apply(null,i.x.map(t=>t)))]);let r=this.paper.view.projectToView(new this.paper.Point(n,a));s&&(this.$emit("contextmenu",t,s.item.owner,r),this.selectedTool="choose")},keydown(t){let e=t.key;if("INPUT"!=t.target.nodeName)switch(e){case"ArrowUp":t.ctrlKey||t.metaKey||this.move(null,this.position.offy-.95*this.viewport.getBounds().height);break;case"ArrowDown":t.ctrlKey||t.metaKey||this.move(null,this.position.offy+.95*this.viewport.getBounds().height);break;case"ArrowLeft":t.ctrlKey||t.metaKey||this.move(this.position.offx-.95*this.viewport.getBounds().width);break;case"ArrowRight":t.ctrlKey||t.metaKey||this.move(this.position.offx+.95*this.viewport.getBounds().width);break;case"Escape":this.fullPage&&this.handleFullScreen();break;case"F":case"f":this.selectedTool="freepen",this.pentool="freepen";break;case"R":case"r":this.selectedTool="rectangle",this.pentool="rectangle";break;case"P":case"p":this.selectedTool="dottingTool",this.pentool="dottingTool";break;case" ":this.selectedTool="choose";break;case"=":this.buttonClick("zoom-in");break;case"-":this.buttonClick("zoom-out");break;case"1":this.buttonClick("home");break;case"2":this.buttonClick(2*this.scale);break;case"3":this.buttonClick(4*this.scale);break;case"4":this.buttonClick(10*this.scale);break;case"5":this.buttonClick(20*this.scale);break;case"6":this.buttonClick(40*this.scale);break;case"7":this.buttonClick("original");break;case"8":this.handleFullScreen();break;case"Escape":this.fullPage&&this.handleFullScreen();break;case"A":case"a":if(t.ctrlKey||t.metaKey){t.preventDefault();let e=this.convertPoint(0,0),s=this.convertPoint(this.offsetWidth,this.offsetHeight),i=this.roilist.filter(t=>t.path.x.every(t=>t>e.x&&t<s.x)&&t.path.y.every(t=>t>e.y&&t<s.y));i.length&&this.$emit("curROI",i,!1)}}},wheel(t){if("dottingTool"==this.selectedTool)return;let e=t.wheelDeltaY>0?1.2:1/1.2;var s=this.viewport.pointFromPixel(new OpenSeadragon.Point(t.offsetX,t.offsetY)),i=this.position;this.move((i.offx-s.x)/e+s.x,(i.offy-s.y)/e+s.y,i.zoom*e)},getDistance(t,e){var s=Math.abs(e.pageX-t.pageX),i=Math.abs(e.pageY-t.pageY);return Math.sqrt(s*s+i*i)},isInPolygon(t,e){var s,i,n,a,r=0,o=e.length;for(n=e[0],s=1;s<=o;s++)a=e[s%o],t[0]>Math.min(n[0],a[0])&&t[0]<=Math.max(n[0],a[0])&&t[1]<=Math.max(n[1],a[1])&&n[0]!=a[0]&&(i=(t[0]-n[0])*(a[1]-n[1])/(a[0]-n[0])+n[1],(n[1]==a[1]||t[1]<=i)&&r++),n=a;return r%2!=0},mouseDown(t){this.$refs.osd.querySelector(".openseadragon-canvas").focus(),t.preventDefault(),this.$emit("mousedown");let e=c(t);var s,i,n=t=>{var n=c(t,this.$refs.osd);if(new paper.Point(d.x-n.x,d.y-n.y).length>5&&(p=!0),m)if(t.touches&&2==t.touches.length){let e=this.viewport.deltaPointsFromPixels(new paper.Point((u.touches[0].clientX+u.touches[1].clientX-t.touches[0].clientX-t.touches[1].clientX)/2,(u.touches[0].clientY+u.touches[1].clientY-t.touches[0].clientY-t.touches[1].clientY)/2)),s=Math.hypot(u.touches[0].clientX-u.touches[1].clientX,u.touches[0].clientY-u.touches[1].clientY),i=Math.hypot(t.touches[0].clientX-t.touches[1].clientX,t.touches[0].clientY-t.touches[1].clientY);this.move(this.position.offx+e.x,this.position.offy+e.y,this.position.zoom*i/s)}else{let t=this.viewport.deltaPointsFromPixels(new paper.Point(l.x-n.x,l.y-n.y));this.move(this.position.offx+t.x,this.position.offy+t.y)}else{let t=this.convertPoint(n.x-e.x+e.offsetX,n.y-e.y+e.offsetY);switch(this.selectedTool){case"choose":for(let t in this.curRois){if((a=this.dataMapPath[t]).dragCenter||this.curRoi.owner.id==t)if(0!=this.curRois[t].editable){let t=this.convertPoint(0,0),e=this.convertPoint(n.x-l.x,n.y-l.y);e.x-=t.x,e.y-=t.y,a.drag(e)}else m=!0}break;case"pickTool":for(let t in this.curRois){var a=this.dataMapPath[t];if(this.curRoi&&this.curRoi.owner.id==t){if(this.curRoi.segments.filter(t=>t.point.selected).length<3)return;if(0!=this.curRois[t].editable){let t=this.convertPoint(0,0),e=this.convertPoint(n.x-l.x,n.y-l.y);e.x-=t.x,e.y-=t.y,a.drag(e)}}}break;case"freepen":case"freepenReverse":case"secectMulty":this.curRoi.path.closed=!1,this.curRoi.path.fullySelected=!1,this.curRoi.path.add(t);break;case"rectangle":case"rectangleReverse":{let e=this.curRoi.path.segments[0].point;this.curRoi.path.removeSegments(),this.curRoi.path.addSegments([e,new this.paper.Point(t.x,e.y),t,new this.paper.Point(e.x,t.y)]);break}case"measure":{i&&i.remove(),s&&s.remove(),this.paper.activate(),(i=new this.paper.Path([f,t])).strokeWidth=2,i.strokeScaling=!1,i.strokeColor="#e4141b";let e=new this.paper.Point({x:t.x-f.x,y:t.y-f.y}),n=e.normalize(10/this.paper.view.zoom).rotate(Math.abs(e.angle)>90?90:-90);(s=new this.paper.PointText({point:{x:(t.x+f.x)/2+n.x,y:(f.y+t.y)/2+n.y},content:Math.round(100*e.length*this.mpp)/100+"μm",justification:"center",fontSize:14/this.paper.view.zoom})).rotate(Math.abs(e.angle)>90?180+e.angle:e.angle)}}this.paper.view.draw()}l={x:n.x,y:n.y},u=t},a=!1,r=t=>{if(t.cancelBubble=!0,t.preventDefault(),a=!0,window.removeEventListener("mousemove",n),window.removeEventListener("touchmove",n),window.removeEventListener("mouseup",r),window.removeEventListener("touchend",r),this.$refs.osd.removeEventListener("touchstart",g),t=t.changedTouches?h(t.changedTouches[0],this.$refs.osd):t,p){if(m)return;switch(this.selectedTool){case"freepen":case"rectangle":case"freepenReverse":case"rectangleReverse":this.drawRoi(this.curRoi,t.shiftKey,"removePath");break;case"secectMulty":{let t=this.curRoi.data;t.path=this.path2data(this.curRoi.path.segments);let e=t.path.x.map((e,s)=>[e,t.path.y[s]]),s=this.roilist.filter(t=>t.path.x.some((s,i)=>this.isInPolygon([s,t.path.y[i]],e)));if(this.curRoi.path.remove(),this.curRoi=null,s.length){this.scope={x:t.path.x,y:t.path.y};let e=this.slice.toolType;switch(this.slice.toolType){case"pdl1db":e="human";break;case"fish":e="fishTissue"}Object(o.b)(`slice/selectCount?companyid=${Object(o.o)().company}`,{caseid:this.record.id,fileid:this.slice.id,scope:JSON.stringify(this.scope),template_id:"tagging"==this.slice.toolType?this.slice.templateId:null,ai_type:e}).then(({data:t})=>{this.$message({showClose:!0,message:`已选中${t.select_count}个（可能包含隐藏标注）`,type:"warning",duration:3e3}),this.$emit("curROI",s,!1)}).catch(t=>{this.$alert(t.message,"提示",{confirmTextButtom:"确定"})})}else this.scope=null,this.$emit("curROI",null,!1);this.selectedTool="choose";break}case"choose":{let t=Object.assign({},Object.values(this.curRois)[0]),e=this.path2data(this.dataMapPath[t.id].path.segments),s=("spot"===t.method&&e.x.length>1?e.x[1]:e.x[0])-t.path.x[0],i=e.y[0]-t.path.y[0];this.scope&&(this.scope.offset=[s,i]),Object.values(this.curRois).map(t=>{t.path=this.path2data(this.dataMapPath[t.id].path.segments)}),this.$emit("curROI",Object.values(this.curRois),!1),this.$emit("roiChanged","path"),this.curRoi=null;break}case"pickTool":this.curRoi&&(this.dataMapPath[this.curRoi.owner.id].path.flatten(0),this.segmentsList=[],Object.values(this.curRois).map(t=>{t.path=this.path2data(this.dataMapPath[t.id].path.segments)}),this.$emit("curROI",Object.values(this.curRois),!1),this.$emit("roiChanged","path"),this.curRoi=null);break;case"measure":i.remove(),s.remove(),this.selectedTool="choose"}}else{let s=this.convertPoint(t.offsetX,t.offsetY);if("choose"==this.selectedTool){let e=this.slice.mppx?2:5,i=this.paper.project.hitTest(s,{fill:!0,stroke:!0,segments:!0,tolerance:e});if(i){if(!i.item.owner)return;this.scope=null,"grey"==i.item.owner.strokeColor&&"ki67hot"==this.slice.toolType||this.$emit("curROI",i.item.owner,t.shiftKey),(t={offsetX:t.offsetX,offsetY:t.offsetY,type:t.type}).preventDefault||(t.preventDefault=(t=>0)),t.currentTarget=this.$refs.osd,this.$emit("contextmenu",t,i.item.owner)}else this.scope=null,this.$emit("curROI",null,t.shiftKey,0),this.curROI=null}else if("freepen"==this.selectedTool||"rectangle"==this.selectedTool||"freepenReverse"==this.selectedTool||"rectangleReverse"==this.selectedTool||"secectMulty"==this.selectedTool)delete this.dataMapPath[this.curRoi.id],this.curRoi.path.remove(),this.curRoi=null;else if("point"==this.selectedTool)this.$emit("clickDraw",s);else if("dottingTool"==this.selectedTool)if(this.polygonRoi){let i=this.paper.project.hitTest(s,{stroke:!0,segments:!0,fill:!0,tolerance:this.slice.mppx?2:5});if(i&&"segment"===i.type&&!i.item.closed)return this.polygonRoi.path.closed=!0,this.polygonRoi.path.selected=!0,void this.drawRoi(this.polygonRoi);let n=this.convertPoint(t.x-e.x+e.offsetX,t.y-e.y+e.offsetY);this.polygonRoi.path.closed=!1,this.polygonRoi.path.selected=!0,this.polygonRoi.path.add(n)}else this.polygonRoi=this.newRoi({path:{x:[s.x],y:[s.y]},method:"freepen",strokeColor:"yellow"})}};if(e.button)return;let l={x:e.x,y:e.y},u=t,d=l,p=!1,f=this.convertPoint(e.offsetX,e.offsetY),m=!1;switch(this.selectedTool){case"choose":{let e=this.paper.project.hitTest(f,{fill:!0,stroke:!0,segments:!0,tolerance:this.slice.mppx?2:5}),s=Object.values(this.curRois).map(t=>this.dataMapPath[t.id]);s.some(t=>t.path==(e&&e.item))?(this.curRoi=e.item,s.map(t=>{t.checkPath(null,e)})):t.touches&&("stylus"==t.touches[0].touchType||t.touches[0].force<1)?(this.selectedTool="freepen",this.curRoi=this.newRoi({path:{x:[f.x],y:[f.y]},method:"freepen",strokeColor:this.penColor})):m=!0;break}case"pickTool":{let t=this.paper.project.hitTest(f,{fill:!0,stroke:!0,segments:!0,tolerance:this.slice.mppx?2:5});if(!t.item.owner)return;if(t&&this.curRois[t.item.owner.id]&&"segment"===t.type&&"freepen"===t.item.owner.method&&0!=t.item.owner.editable){let e=t.segment,s=t.item,i=s.segments.filter(t=>t.point.selected).length;if(!this.segmentsList.length&&i<3)e.point.selected=!0,this.segmentsList.push(e);else if(1===this.segmentsList.length&&this.segmentsList[0].index!==e.index){e.point.selected=!0,this.segmentsList.push(e);let t=s.lastSegment.index,i=Math.min(this.segmentsList[0].index,this.segmentsList[1].index),n=Math.max(this.segmentsList[0].index,this.segmentsList[1].index),a=Math.abs(i-n),r=t-a+1,o=new paper.Point((this.segmentsList[0].point.x+this.segmentsList[1].point.x)/2,(this.segmentsList[0].point.y+this.segmentsList[1].point.y)/2);if(r>a){let t=s.segments.slice(i+1,n);for(var v=0;v<t.length;v++)s.removeSegment(t[v].index);s.insert(i+1,o),s.segments[i+1].point.selected=!0}else{let e=s.segments.slice(0,i),a=s.segments.slice(n+1,t+1),r=e.concat(a);for(let t=0;t<r.length;t++)s.removeSegment(r[t].index);s.insert(s.segments.length,o),s.segments[s.segments.length-1].point.selected=!0}this.segmentsList=[];let l=this.paper.project.hitTest(o,{fill:!0,stroke:!0,segments:!0});this.curRoi=l.item,this.dataMapPath[l.item.owner.id].checkPath(null,l)}}break}case"freepen":case"rectangle":case"secectMulty":this.curRoi=this.newRoi({path:{x:[f.x],y:[f.y]},method:this.selectedTool,strokeColor:this.drawMpp?"yellow":"secectMulty"==this.selectedTool?"#E3E9EF":this.penColor});break;case"freepenReverse":case"rectangleReverse":this.curRoi=this.newRoi({path:{x:[f.x],y:[f.y]},method:this.selectedTool,strokeColor:"#E3E9EF",dashed:!0});break;case"point":let e=this.paper.project.hitTest(f,{fill:!0,stroke:!0,segments:!0});this.$emit("parentId",e?e.item.owner.id:null)}window.addEventListener("touchmove",n),window.addEventListener("mousemove",n),window.addEventListener("mouseup",r),window.addEventListener("touchend",r);var g=t=>{a||r(t)};this.$refs.osd.addEventListener("touchstart",g)},dblclick(t){this.$refs.osd.querySelector(".openseadragon-canvas").focus();let e=this.convertPoint(t.offsetX,t.offsetY),s=this.paper.project.hitTest(e,{fill:!0,stroke:!0,segments:!0});s&&"grey"===s.item.owner.strokeColor&&"ki67hot"===this.slice.toolType&&this.$emit("curROI",s.item.owner)},drawRoi(t,e,s){let i=t.data;i.path=this.path2data(t.path.segments),delete this.dataMapPath[t.id],this.drawMpp?(this.userMpp=Math.sqrt((this.cellArea||200)/t.path.area).toFixed(4),"NaN"===this.userMpp||"Infinity"===this.userMpp?(this.$alert("您画的roi太小,请选择矩形工具重新画一个"),t.path.remove(),t=null):(this.mpp=this.userMpp,this.drawMpp=!1,this.knew=!0)):(s&&t.path.remove(),t=null,this.$emit("draw",i,e),this.scope=null),this.selectedTool="choose"},mousemoveNew(t){let e=this.convertPoint(t.offsetX,t.offsetY);i&&i.remove(),"pickTool"!==this.selectedTool&&"choose"!==this.selectedTool||(i=new this.paper.Path.Circle({center:[e.x,e.y],radius:this.slice.mppx?Math.floor(1/this.slice.mppx):5,fillColor:"#f00"}),this.layers[0].children=[i])}},created(){this.curRoi=null,this.polygonRoi=null},mounted(){this.initOSD(),this.$refs.osd.addEventListener("touchstart",this.mouseDown)},beforeDestroy(){window.removeEventListener("resize",this.resize),setTimeout(()=>{this.paper.view.remove(),this.osd.destroy()},800)},watch:{radius(t){this.newRadius=t},position:{handler(t){this.update(t)},deep:!0},selectedTool:{handler(t){switch(t){case"choose":case"pickTool":this.$refs.osd.querySelector(".openseadragon-canvas").style.cursor="pointer";break;case"freepen":case"rectangle":case"measure":case"point":case"freepenReverse":case"rectangleReverse":case"secectMulty":case"dottingTool":this.$refs.osd.querySelector(".openseadragon-canvas").style.cursor="crosshair"}},deep:!0},"position.zoom":function(){setTimeout(t=>{for(let t in this.curRois)"spot"!=this.curRois[t].method&&this.drawArea(this.curRois[t])},90)},showRoi(t){t?this.$emit("changeShowLayer",!0):this.$emit("changeShowLayer",!1);for(let e in this.dataMapPath)this.dataMapPath[e].path.visible=!!t,this.dataMapPath[e].path.selected=this.curRois[e]&&t,this.dataMapPath[e].text&&(this.dataMapPath[e].text.visible=!!t,this.dataMapPath[e].rectangle.visible=!!t)},roilist(t,e){this.roilistChange(t,e),this.polygonRoi=null},centerRegion([t,e,s,i]){let n,a=1.5*(s-t),r=1.5*(i-e),o=this.slice.width,l=(t+s)/2,c=(e+i)/2;n=a/r>this.offsetWidth/this.offsetHeight?o/a:o/r*this.offsetHeight/this.offsetWidth,this.slice.toolType&&(this.slice.toolType.includes("tct")||this.slice.toolType.includes("lct")||"dna"===this.slice.toolType)||"bm"===this.slice.toolType?this.move(l/o,c/o,Math.max(40*this.scale,this.position.zoom)):this.move(l/o,c/o,Math.min(n,this.position.zoom))},curRois(t,e){this.roilist.forEach(e=>{this.showRoi?(this.dataMapPath[e.id].path.selected=!!t[e.id],!t[e.id]||0==t[e.id].editable||3==t[e.id].mark_type&&"grey"==t[e.id].strokeColor||this.paper.project.activeLayer.addChild(this.dataMapPath[e.id].path)):this.dataMapPath[e.id].path.selected=!1,this.dataMapPath[e.id].path.visible=!!this.showRoi});for(let t in this.dataMapPath)this.dataMapPath[t].text&&(this.dataMapPath[t].text.remove(),this.dataMapPath[t].rectangle.remove());for(let e in t)t[e]&&"spot"!=t[e].method&&this.roilist.length&&this.drawArea(t[e]);Object.keys(t).toString()!=Object.keys(e).toString()&&(this.segmentsList=[])}},components:{"v-attactments":n.a}};function c(t,e=t.currentTarget){return t.touches?h(t.touches[0],e):t}function h(t,e){for(var s={x:0,y:0};e.offsetParent;)s.x+=e.offsetLeft,s.y+=e.offsetTop,e=e.offsetParent;return{offsetX:t.clientX-s.x,offsetY:t.clientY-s.y,x:t.clientX,y:t.clientY,shiftKey:t.shiftKey}}var u={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"osd",class:{"fixed-fullpage":t.fullPage},on:{keydown:t.keydown}},[t._t("default"),t._v(" "),i("div",{ref:"osd",staticClass:"osd",on:{mousedown:t.mouseDown,mousewheel:t.wheel,dblclick:t.dblclick}}),t._v(" "),i("div",{staticClass:"btm_left"},[i("div",{staticClass:"zoom-in",attrs:{title:t.$t("analyze.zoomin")},on:{click:function(e){return t.buttonClick("zoom-in")}}}),t._v(" "),i("p",{staticClass:"showzoom",attrs:{title:t.position.zoom/t.scale+"X"}},[t._v(t._s((t.position.zoom/t.scale).toFixed(1))+"X")]),t._v(" "),i("div",{staticClass:"zoom-out",attrs:{title:t.$t("analyze.zoomout")},on:{click:function(e){return t.buttonClick("zoom-out")}}}),t._v(" "),i("div",{ref:"home",staticClass:"home",attrs:{title:t.$t("analyze.home")},on:{click:function(e){return t.buttonClick("home")}}}),t._v(" "),i("div",{attrs:{title:t.$t("analyze.2x")},on:{click:function(e){return t.buttonClick(2*t.scale)}}},[t._v("2X")]),t._v(" "),i("div",{attrs:{title:t.$t("analyze.4x")},on:{click:function(e){return t.buttonClick(4*t.scale)}}},[t._v("4X")]),t._v(" "),i("div",{attrs:{title:t.$t("analyze.10x")},on:{click:function(e){return t.buttonClick(10*t.scale)}}},[t._v("10X")]),t._v(" "),i("div",{attrs:{title:t.$t("analyze.20x")},on:{click:function(e){return t.buttonClick(20*t.scale)}}},[t._v("20X")]),t._v(" "),i("div",{attrs:{title:t.$t("analyze.40x")},on:{click:function(e){return t.buttonClick(40*t.scale)}}},[t._v("40X")]),t._v(" "),i("div",{attrs:{title:t.$t("analyze.original")},on:{click:function(e){return t.buttonClick("original")}}},[t._v("1:1")]),t._v(" "),i("div",{staticClass:"full-page",class:{"exit-full-page":t.fullPage},attrs:{title:t.fullPage?t.$t("analyze.exitfullpage"):t.$t("analyze.fullpage")},on:{click:function(e){return t.handleFullScreen()}}})]),t._v(" "),i("div",{staticClass:"btm",attrs:{tabindex:"0"},on:{click:function(e){t.showPenTool=!1},keydown:t.keydown}},[i("div",{staticClass:"show-roi",class:{bigContent:!t.showRoi},attrs:{title:t.$t("analyze.showRoi")},on:{click:function(e){t.showRoi=!t.showRoi}}}),t._v(" "),"tagging"==t.slice.toolType?i("div",{staticClass:"show-radius",class:{bigContent:t.showRadius},attrs:{title:"设置半径"},on:{click:function(e){t.showRadius=!t.showRadius}}}):t._e(),t._v(" "),t.showRadius?i("div",{staticClass:"radius",on:{click:function(t){t.stopPropagation()}}},[t._v("\n            标注点半径:\n            "),i("el-input",{ref:"radius",staticClass:"small-input",on:{blur:function(e){t.$emit("setRadius",e)}},nativeOn:{keyup:function(e){return t.toNumber(e)}},model:{value:t.newRadius,callback:function(e){t.newRadius=e},expression:"newRadius"}})],1):t._e(),t._v(" "),"tagging"==t.slice.toolType?i("div",{staticClass:"fill",class:{bigContent:!t.filled},attrs:{title:t.filled?"设为空心":"设为实心"},on:{click:function(e){return t.$emit("showBg")}}}):t._e(),t._v(" "),i("div",{staticClass:"secect-multy",class:{bigContent:"secectMulty"==t.selectedTool},attrs:{title:"多选"},on:{click:function(e){t.selectedTool="secectMulty"}}}),t._v(" "),i("div",{class:["freepen"==t.selectedTool||"rectangle"==t.selectedTool||"point"==t.selectedTool||"freepenReverse"==t.selectedTool||"dottingTool"==t.selectedTool||"rectangleReverse"==t.selectedTool?"bigContent":"",t.pentool],on:{click:function(e){return e.stopPropagation(),t.chooseTool(e)}}},[i("span",{staticClass:"triangle",on:{click:function(e){e.stopPropagation(),t.showPenTool=!t.showPenTool}}})]),t._v(" "),i("div",{staticClass:"drag",class:{bigContent:"choose"==t.selectedTool},attrs:{title:t.$t("analyze.choose")},on:{click:function(e){t.selectedTool="choose"}}}),t._v(" "),i("div",{staticClass:"measure-tool",class:{bigContent:"measure"==t.selectedTool},attrs:{title:t.$t("analyze.measure")},on:{click:function(e){t.selectedTool="measure"}}}),t._v(" "),i("div",{staticClass:"pick-tool",class:{bigContent:"pickTool"==t.selectedTool},attrs:{title:"轮廓调整"},on:{click:t.adjustSegment}}),t._v(" "),i("v-attactments",{attrs:{record:t.record}})],1),t._v(" "),i("ul",{directives:[{name:"show",rawName:"v-show",value:t.showPenTool,expression:"showPenTool"}],staticClass:"pens"},[i("li",{class:{"li-bg":"freepen"==t.selectedTool},on:{click:function(e){return t.checkTool("freepen")}}},[i("img",{staticStyle:{left:"12px"},attrs:{src:s("aRHw"),width:"40"}}),t._v("自由ROI")]),t._v(" "),i("li",{class:{"li-bg":"rectangle"==t.selectedTool},on:{click:function(e){return t.checkTool("rectangle")}}},[i("img",{attrs:{src:s("jdSn"),width:"23"}}),t._v("矩形ROI")]),t._v(" "),i("li",{class:{"li-bg":"dottingTool"==t.selectedTool},on:{click:function(e){return t.checkTool("dottingTool")}}},[i("img",{attrs:{src:s("Qar8"),width:"23"}}),t._v("多边形ROI")]),t._v(" "),i("li",{class:{"li-bg":"point"==t.selectedTool,"disable-tool":!t.pointAble},on:{click:function(e){return t.checkTool("point")}}},[t.pointAble?i("span",[i("img",{attrs:{src:s("NmLI"),width:"25"}}),t._v("\n                打点\n            ")]):i("span",{staticClass:"grey"},[i("img",{attrs:{src:s("Tcqk"),width:"25"}}),t._v("\n                打点\n            ")])]),t._v(" "),i("li",{class:{"li-bg":"freepenReverse"==t.selectedTool,"disable-tool":!t.reverseAble},on:{click:function(e){return t.checkTool("freepenReverse")}}},[t.reverseAble?i("span",[i("img",{attrs:{src:s("4jrt"),width:"25"}}),t._v("\n                自由排除区域\n            ")]):i("span",{staticClass:"grey"},[i("img",{attrs:{src:s("FcKU"),width:"21"}}),t._v("\n                自由排除区域\n            ")])]),t._v(" "),i("li",{class:{"li-bg":"rectangleReverse"==t.selectedTool,"disable-tool":!t.reverseAble},on:{click:function(e){return t.checkTool("rectangleReverse")}}},[t.reverseAble?i("span",[i("img",{attrs:{src:s("iEaZ"),width:"25"}}),t._v("\n                矩形排除区域\n            ")]):i("span",{staticClass:"grey"},[i("img",{attrs:{src:s("vhYd"),width:"21"}}),t._v("\n                矩形排除区域\n            ")])])]),t._v(" "),i("div",{ref:"hideToolbar",staticStyle:{display:"none"}}),t._v(" "),i("canvas",{ref:"canvas",staticClass:"canvas"}),t._v(" "),t.saved?i("div",{staticClass:"saved"},[t._v("保存成功")]):t._e(),t._v(" "),t.showLabel?i("img",{ref:"rotate",staticClass:"label",attrs:{title:"点击旋转",src:"/aipath/api/files/getLabel?caseid="+t.record.id+"&fileid="+t.slice.id+"&companyid="+t.company},on:{click:t.rotate,error:function(e){t.showLabel=!1}}}):t._e(),t._v(" "),t.showMppGuide?i("div",{staticClass:"mpp-box"},[i("h2",[t._v("请框选出一个中等大小细胞核。如示例图:")]),t._v(" "),i("img",{attrs:{src:s("T4+n"),alt:"图例"}}),t._v(" "),i("span",{on:{click:function(e){return t.drawCell()}}},[t._v("我知道了")]),t._v(" "),i("div",{staticClass:"closeBtn",on:{click:function(e){return t.$emit("closeMppGuide",!0)}}},[i("img",{attrs:{src:s("YPLu"),alt:"关闭",width:"19"}})])]):t._e(),t._v(" "),t.knew?i("div",{staticClass:"knew"},[i("h2",[t._v("确认开始处理？")]),t._v(" "),i("div",{staticClass:"confirm-buttons"},[i("span",{staticClass:"finishdraw",on:{click:function(e){t.$emit("changeMpp",t.userMpp),t.curRoi.path.remove(),t.curRoi=null,t.knew=!1}}},[t._v("\n            确认")]),t._v(" "),i("span",{on:{click:function(e){t.$emit("changeMpp",!1),t.curRoi.path.remove(),t.curRoi=null,t.knew=!1}}},[t._v("\n            取消")])])]):t._e()],2)},staticRenderFns:[]};var d=s("VU/8")(l,u,!1,function(t){s("c2Ms"),s("90z+")},"data-v-7987d474",null);e.a=d.exports},"T4+n":function(t,e,s){t.exports=s.p+"static/img/图例.cf250fc.jpg"},Tcqk:function(t,e,s){t.exports=s.p+"static/img/打点-d.7dec91a.svg"},XA3p:function(t,e,s){t.exports=s.p+"static/img/提醒.1ae81ce.svg"},YPLu:function(t,e,s){t.exports=s.p+"static/img/关闭.a9102f6.png"},aRHw:function(t,e,s){t.exports=s.p+"static/img/自由笔.d194396.svg"},aeYY:function(t,e,s){"use strict";s("jyVo");var i={data(){return{isActive:null,showLeft:!1,showRight:!0,company:this.record&&this.record.companyid,startIndex:0}},computed:{slideLength(){return Math.min(this.startIndex+10,this.record.slices.length)}},methods:{loadImg(){for(let t=Math.max(0,this.startIndex);t<Math.min(this.record.slices.length,this.slideLength);t++)this.$refs.num[t].style.backgroundImage="url(/aipath/api/files/thumbnail?caseid="+encodeURIComponent(this.record.id)+"&fileid="+this.record.slices[t].id+"&companyid="+this.company+")"},rollover(t){this.isActive=t,this.$refs.num[t].style.left=310*t-39+"px"},rollout(t){this.isActive=null,this.$refs.num[t].style.left=310*t+"px"},goLeft(){var t=this.$refs.inner.style.left.substring(0,this.$refs.inner.style.left.length-2);t&&t<38&&(this.$refs.inner.style.left=this.$refs.inner.offsetLeft+620+"px",t=this.$refs.inner.style.left.substring(0,this.$refs.inner.style.left.length-2),this.startIndex-=4,this.loadImg(),this.showRight=!0),t&&t>0&&(this.$refs.inner.style.left="48px",this.showLeft=!1)},goRight(){var t=this.$refs.inner.style.left.substring(0,this.$refs.inner.style.left.length-2);this.width()+Number(t)>930&&(this.$refs.inner.style.left=this.$refs.inner.offsetLeft-620+"px",t=this.$refs.inner.style.left.substring(0,this.$refs.inner.style.left.length-2),this.startIndex+=4,this.loadImg(),this.showLeft=!0),this.width()+Number(t)<931&&(this.showRight=!1)},width(){return this.record?310*this.record.slices.length:0}},mounted(){this.showRight=this.width()>this.$refs.outer.offsetWidth;document.querySelector(".outer");this.record&&this.record.slices&&this.loadImg()},watch:{"record.slices":function(t){if(t){let t=this.record?310*this.record.slices.length:0;this.showRight=t>this.$refs.outer.offsetWidth}else this.showRight=!1,this.showLeft=!1}},props:["record"]},n={render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{ref:"outer",staticClass:"outer"},[t.record&&t.showLeft?s("div",{staticClass:"left",on:{click:function(e){return t.goLeft()}}}):t._e(),t._v(" "),t.record?s("div",{ref:"inner",staticClass:"inner"},t._l(t.record.slices,function(e,i){return s("div",{key:i,ref:"num",refInFor:!0,staticClass:"images",class:{active:i==t.isActive},style:"left:"+310*i+"px;background-size:contain;",on:{dblclick:function(s){return t.$emit("click",e.id)},mouseover:function(e){return t.rollover(i)},mouseout:function(e){return t.rollout(i)}}},[s("div",[s("p",[t._v(t._s(e.name))]),t._v(" "),e.stain?s("p",[t._v(t._s(e.stain))]):t._e()])])}),0):t._e(),t._v(" "),t.record&&t.showRight?s("div",{staticClass:"right",on:{click:function(e){return t.goRight()}}}):t._e()])},staticRenderFns:[]};var a=s("VU/8")(i,n,!1,function(t){s("DsNH")},"data-v-0e80590e",null);e.a=a.exports},c2Ms:function(t,e){},fC4T:function(t,e){t.exports=function(t){return t&&"object"==typeof t&&"function"==typeof t.copy&&"function"==typeof t.fill&&"function"==typeof t.readUInt8}},gxuG:function(t,e){},i1en:function(t,e,s){t.exports=s.p+"static/img/存储.f7c365f.svg"},iEaZ:function(t,e,s){t.exports=s.p+"static/img/矩形排除.e7e2699.svg"},jLS6:function(t,e){},jdSn:function(t,e,s){t.exports=s.p+"static/img/矩形.2e64410.svg"},k5KV:function(t,e,s){(function(){var e,i,n=[].slice;i=s("rdLu"),s("OMJi").puts,e={isPlainObject:function(t){return null!=(null!=t?t.constructor:void 0)&&"Object"===t.constructor.name},clone:function(t){var s,n,a,r,o;if(i.isArray(t)){for(s=[],r=0,o=t.length;r<o;r++)a=t[r],s.push(e.clone(a));return s}if(e.isPlainObject(t)){for(n in s={},t)a=t[n],s[n]=e.clone(a);return s}return t},equals:function(t,s){var n,a,r,o,l;if(t===s)return!0;if(i.isArray(t)){if(!i.isArray(s)||t.length!==s.length)return!1;for(n=o=0,l=t.length;0<=l?o<l:o>l;n=0<=l?++o:--o)if(!e.equals(t[n],s[n]))return!1;return!0}if(e.isPlainObject(t)){if(r=i.size(t),!e.isPlainObject(s)||r!==i.size(s))return!1;for(a in t)if(!e.equals(t[a],s[a]))return!1;return!0}return!1},extend:function(){var t,s,i,a,r,o;for(t=arguments[0],r=0,o=(a=2<=arguments.length?n.call(arguments,1):[]).length;r<o;r++)for(s in i=a[r])e.isPlainObject(t[s])&&e.isPlainObject(i[s])?e.extend(t[s],i[s]):t[s]=e.clone(i[s]);return t},select:function(t,s,n){var a,r,o,l;if(null==n&&(n=[]),o=[],s(t))o.push({path:n,value:t});else if(i.isObject(t))for(r in t)l=t[r],(a=i.clone(n)).push(r),o=o.concat(e.select(l,s,a));return o},set:function(t,e,s){var n,a,r;for(n=(e=i.clone(e)).pop(),a=0,r=e.length;a<r;a++)t=t[e[a]];return t[n]=s},transform:function(t,s,n){var a,r,o,l,c;if(s(t))return n(t);if(i.isArray(t)){for(r=[],l=0,c=t.length;l<c;l++)o=t[l],r.push(e.transform(o,s,n));return r}if(e.isPlainObject(t)){for(a in r={},t)o=t[a],r[a]=e.transform(o,s,n);return r}return t}},t.exports=e}).call(this)},l7ju:function(t,e){},rdLu:function(t,e,s){(function(){var s=this,i=s._,n={},a=Array.prototype,r=Object.prototype,o=Function.prototype,l=a.push,c=a.slice,h=a.concat,u=r.toString,d=r.hasOwnProperty,p=a.forEach,f=a.map,m=a.reduce,v=a.reduceRight,g=a.filter,y=a.every,_=a.some,w=a.indexOf,b=a.lastIndexOf,x=Array.isArray,k=Object.keys,C=o.bind,T=function(t){return t instanceof T?t:this instanceof T?void(this._wrapped=t):new T(t)};void 0!==t&&t.exports&&(e=t.exports=T),e._=T,T.VERSION="1.4.4";var P=T.each=T.forEach=function(t,e,s){if(null!=t)if(p&&t.forEach===p)t.forEach(e,s);else if(t.length===+t.length){for(var i=0,a=t.length;i<a;i++)if(e.call(s,t[i],i,t)===n)return}else for(var r in t)if(T.has(t,r)&&e.call(s,t[r],r,t)===n)return};T.map=T.collect=function(t,e,s){var i=[];return null==t?i:f&&t.map===f?t.map(e,s):(P(t,function(t,n,a){i[i.length]=e.call(s,t,n,a)}),i)};var $="Reduce of empty array with no initial value";T.reduce=T.foldl=T.inject=function(t,e,s,i){var n=arguments.length>2;if(null==t&&(t=[]),m&&t.reduce===m)return i&&(e=T.bind(e,i)),n?t.reduce(e,s):t.reduce(e);if(P(t,function(t,a,r){n?s=e.call(i,s,t,a,r):(s=t,n=!0)}),!n)throw new TypeError($);return s},T.reduceRight=T.foldr=function(t,e,s,i){var n=arguments.length>2;if(null==t&&(t=[]),v&&t.reduceRight===v)return i&&(e=T.bind(e,i)),n?t.reduceRight(e,s):t.reduceRight(e);var a=t.length;if(a!==+a){var r=T.keys(t);a=r.length}if(P(t,function(o,l,c){l=r?r[--a]:--a,n?s=e.call(i,s,t[l],l,c):(s=t[l],n=!0)}),!n)throw new TypeError($);return s},T.find=T.detect=function(t,e,s){var i;return R(t,function(t,n,a){if(e.call(s,t,n,a))return i=t,!0}),i},T.filter=T.select=function(t,e,s){var i=[];return null==t?i:g&&t.filter===g?t.filter(e,s):(P(t,function(t,n,a){e.call(s,t,n,a)&&(i[i.length]=t)}),i)},T.reject=function(t,e,s){return T.filter(t,function(t,i,n){return!e.call(s,t,i,n)},s)},T.every=T.all=function(t,e,s){e||(e=T.identity);var i=!0;return null==t?i:y&&t.every===y?t.every(e,s):(P(t,function(t,a,r){if(!(i=i&&e.call(s,t,a,r)))return n}),!!i)};var R=T.some=T.any=function(t,e,s){e||(e=T.identity);var i=!1;return null==t?i:_&&t.some===_?t.some(e,s):(P(t,function(t,a,r){if(i||(i=e.call(s,t,a,r)))return n}),!!i)};T.contains=T.include=function(t,e){return null!=t&&(w&&t.indexOf===w?-1!=t.indexOf(e):R(t,function(t){return t===e}))},T.invoke=function(t,e){var s=c.call(arguments,2),i=T.isFunction(e);return T.map(t,function(t){return(i?e:t[e]).apply(t,s)})},T.pluck=function(t,e){return T.map(t,function(t){return t[e]})},T.where=function(t,e,s){return T.isEmpty(e)?s?null:[]:T[s?"find":"filter"](t,function(t){for(var s in e)if(e[s]!==t[s])return!1;return!0})},T.findWhere=function(t,e){return T.where(t,e,!0)},T.max=function(t,e,s){if(!e&&T.isArray(t)&&t[0]===+t[0]&&t.length<65535)return Math.max.apply(Math,t);if(!e&&T.isEmpty(t))return-1/0;var i={computed:-1/0,value:-1/0};return P(t,function(t,n,a){var r=e?e.call(s,t,n,a):t;r>=i.computed&&(i={value:t,computed:r})}),i.value},T.min=function(t,e,s){if(!e&&T.isArray(t)&&t[0]===+t[0]&&t.length<65535)return Math.min.apply(Math,t);if(!e&&T.isEmpty(t))return 1/0;var i={computed:1/0,value:1/0};return P(t,function(t,n,a){var r=e?e.call(s,t,n,a):t;r<i.computed&&(i={value:t,computed:r})}),i.value},T.shuffle=function(t){var e,s=0,i=[];return P(t,function(t){e=T.random(s++),i[s-1]=i[e],i[e]=t}),i};var S=function(t){return T.isFunction(t)?t:function(e){return e[t]}};T.sortBy=function(t,e,s){var i=S(e);return T.pluck(T.map(t,function(t,e,n){return{value:t,index:e,criteria:i.call(s,t,e,n)}}).sort(function(t,e){var s=t.criteria,i=e.criteria;if(s!==i){if(s>i||void 0===s)return 1;if(s<i||void 0===i)return-1}return t.index<e.index?-1:1}),"value")};var O=function(t,e,s,i){var n={},a=S(e||T.identity);return P(t,function(e,r){var o=a.call(s,e,r,t);i(n,o,e)}),n};T.groupBy=function(t,e,s){return O(t,e,s,function(t,e,s){(T.has(t,e)?t[e]:t[e]=[]).push(s)})},T.countBy=function(t,e,s){return O(t,e,s,function(t,e){T.has(t,e)||(t[e]=0),t[e]++})},T.sortedIndex=function(t,e,s,i){for(var n=(s=null==s?T.identity:S(s)).call(i,e),a=0,r=t.length;a<r;){var o=a+r>>>1;s.call(i,t[o])<n?a=o+1:r=o}return a},T.toArray=function(t){return t?T.isArray(t)?c.call(t):t.length===+t.length?T.map(t,T.identity):T.values(t):[]},T.size=function(t){return null==t?0:t.length===+t.length?t.length:T.keys(t).length},T.first=T.head=T.take=function(t,e,s){if(null!=t)return null==e||s?t[0]:c.call(t,0,e)},T.initial=function(t,e,s){return c.call(t,0,t.length-(null==e||s?1:e))},T.last=function(t,e,s){if(null!=t)return null==e||s?t[t.length-1]:c.call(t,Math.max(t.length-e,0))},T.rest=T.tail=T.drop=function(t,e,s){return c.call(t,null==e||s?1:e)},T.compact=function(t){return T.filter(t,T.identity)};var M=function(t,e,s){return P(t,function(t){T.isArray(t)?e?l.apply(s,t):M(t,e,s):s.push(t)}),s};T.flatten=function(t,e){return M(t,e,[])},T.without=function(t){return T.difference(t,c.call(arguments,1))},T.uniq=T.unique=function(t,e,s,i){T.isFunction(e)&&(i=s,s=e,e=!1);var n=s?T.map(t,s,i):t,a=[],r=[];return P(n,function(s,i){(e?i&&r[r.length-1]===s:T.contains(r,s))||(r.push(s),a.push(t[i]))}),a},T.union=function(){return T.uniq(h.apply(a,arguments))},T.intersection=function(t){var e=c.call(arguments,1);return T.filter(T.uniq(t),function(t){return T.every(e,function(e){return T.indexOf(e,t)>=0})})},T.difference=function(t){var e=h.apply(a,c.call(arguments,1));return T.filter(t,function(t){return!T.contains(e,t)})},T.zip=function(){for(var t=c.call(arguments),e=T.max(T.pluck(t,"length")),s=new Array(e),i=0;i<e;i++)s[i]=T.pluck(t,""+i);return s},T.object=function(t,e){if(null==t)return{};for(var s={},i=0,n=t.length;i<n;i++)e?s[t[i]]=e[i]:s[t[i][0]]=t[i][1];return s},T.indexOf=function(t,e,s){if(null==t)return-1;var i=0,n=t.length;if(s){if("number"!=typeof s)return t[i=T.sortedIndex(t,e)]===e?i:-1;i=s<0?Math.max(0,n+s):s}if(w&&t.indexOf===w)return t.indexOf(e,s);for(;i<n;i++)if(t[i]===e)return i;return-1},T.lastIndexOf=function(t,e,s){if(null==t)return-1;var i=null!=s;if(b&&t.lastIndexOf===b)return i?t.lastIndexOf(e,s):t.lastIndexOf(e);for(var n=i?s:t.length;n--;)if(t[n]===e)return n;return-1},T.range=function(t,e,s){arguments.length<=1&&(e=t||0,t=0),s=arguments[2]||1;for(var i=Math.max(Math.ceil((e-t)/s),0),n=0,a=new Array(i);n<i;)a[n++]=t,t+=s;return a},T.bind=function(t,e){if(t.bind===C&&C)return C.apply(t,c.call(arguments,1));var s=c.call(arguments,2);return function(){return t.apply(e,s.concat(c.call(arguments)))}},T.partial=function(t){var e=c.call(arguments,1);return function(){return t.apply(this,e.concat(c.call(arguments)))}},T.bindAll=function(t){var e=c.call(arguments,1);return 0===e.length&&(e=T.functions(t)),P(e,function(e){t[e]=T.bind(t[e],t)}),t},T.memoize=function(t,e){var s={};return e||(e=T.identity),function(){var i=e.apply(this,arguments);return T.has(s,i)?s[i]:s[i]=t.apply(this,arguments)}},T.delay=function(t,e){var s=c.call(arguments,2);return setTimeout(function(){return t.apply(null,s)},e)},T.defer=function(t){return T.delay.apply(T,[t,1].concat(c.call(arguments,1)))},T.throttle=function(t,e){var s,i,n,a,r=0,o=function(){r=new Date,n=null,a=t.apply(s,i)};return function(){var l=new Date,c=e-(l-r);return s=this,i=arguments,c<=0?(clearTimeout(n),n=null,r=l,a=t.apply(s,i)):n||(n=setTimeout(o,c)),a}},T.debounce=function(t,e,s){var i,n;return function(){var a=this,r=arguments,o=s&&!i;return clearTimeout(i),i=setTimeout(function(){i=null,s||(n=t.apply(a,r))},e),o&&(n=t.apply(a,r)),n}},T.once=function(t){var e,s=!1;return function(){return s?e:(s=!0,e=t.apply(this,arguments),t=null,e)}},T.wrap=function(t,e){return function(){var s=[t];return l.apply(s,arguments),e.apply(this,s)}},T.compose=function(){var t=arguments;return function(){for(var e=arguments,s=t.length-1;s>=0;s--)e=[t[s].apply(this,e)];return e[0]}},T.after=function(t,e){return t<=0?e():function(){if(--t<1)return e.apply(this,arguments)}},T.keys=k||function(t){if(t!==Object(t))throw new TypeError("Invalid object");var e=[];for(var s in t)T.has(t,s)&&(e[e.length]=s);return e},T.values=function(t){var e=[];for(var s in t)T.has(t,s)&&e.push(t[s]);return e},T.pairs=function(t){var e=[];for(var s in t)T.has(t,s)&&e.push([s,t[s]]);return e},T.invert=function(t){var e={};for(var s in t)T.has(t,s)&&(e[t[s]]=s);return e},T.functions=T.methods=function(t){var e=[];for(var s in t)T.isFunction(t[s])&&e.push(s);return e.sort()},T.extend=function(t){return P(c.call(arguments,1),function(e){if(e)for(var s in e)t[s]=e[s]}),t},T.pick=function(t){var e={},s=h.apply(a,c.call(arguments,1));return P(s,function(s){s in t&&(e[s]=t[s])}),e},T.omit=function(t){var e={},s=h.apply(a,c.call(arguments,1));for(var i in t)T.contains(s,i)||(e[i]=t[i]);return e},T.defaults=function(t){return P(c.call(arguments,1),function(e){if(e)for(var s in e)null==t[s]&&(t[s]=e[s])}),t},T.clone=function(t){return T.isObject(t)?T.isArray(t)?t.slice():T.extend({},t):t},T.tap=function(t,e){return e(t),t};var j=function(t,e,s,i){if(t===e)return 0!==t||1/t==1/e;if(null==t||null==e)return t===e;t instanceof T&&(t=t._wrapped),e instanceof T&&(e=e._wrapped);var n=u.call(t);if(n!=u.call(e))return!1;switch(n){case"[object String]":return t==String(e);case"[object Number]":return t!=+t?e!=+e:0==t?1/t==1/e:t==+e;case"[object Date]":case"[object Boolean]":return+t==+e;case"[object RegExp]":return t.source==e.source&&t.global==e.global&&t.multiline==e.multiline&&t.ignoreCase==e.ignoreCase}if("object"!=typeof t||"object"!=typeof e)return!1;for(var a=s.length;a--;)if(s[a]==t)return i[a]==e;s.push(t),i.push(e);var r=0,o=!0;if("[object Array]"==n){if(o=(r=t.length)==e.length)for(;r--&&(o=j(t[r],e[r],s,i)););}else{var l=t.constructor,c=e.constructor;if(l!==c&&!(T.isFunction(l)&&l instanceof l&&T.isFunction(c)&&c instanceof c))return!1;for(var h in t)if(T.has(t,h)&&(r++,!(o=T.has(e,h)&&j(t[h],e[h],s,i))))break;if(o){for(h in e)if(T.has(e,h)&&!r--)break;o=!r}}return s.pop(),i.pop(),o};T.isEqual=function(t,e){return j(t,e,[],[])},T.isEmpty=function(t){if(null==t)return!0;if(T.isArray(t)||T.isString(t))return 0===t.length;for(var e in t)if(T.has(t,e))return!1;return!0},T.isElement=function(t){return!(!t||1!==t.nodeType)},T.isArray=x||function(t){return"[object Array]"==u.call(t)},T.isObject=function(t){return t===Object(t)},P(["Arguments","Function","String","Number","Date","RegExp"],function(t){T["is"+t]=function(e){return u.call(e)=="[object "+t+"]"}}),T.isArguments(arguments)||(T.isArguments=function(t){return!(!t||!T.has(t,"callee"))}),T.isFunction=function(t){return"function"==typeof t},T.isFinite=function(t){return isFinite(t)&&!isNaN(parseFloat(t))},T.isNaN=function(t){return T.isNumber(t)&&t!=+t},T.isBoolean=function(t){return!0===t||!1===t||"[object Boolean]"==u.call(t)},T.isNull=function(t){return null===t},T.isUndefined=function(t){return void 0===t},T.has=function(t,e){return d.call(t,e)},T.noConflict=function(){return s._=i,this},T.identity=function(t){return t},T.times=function(t,e,s){for(var i=Array(t),n=0;n<t;n++)i[n]=e.call(s,n);return i},T.random=function(t,e){return null==e&&(e=t,t=0),t+Math.floor(Math.random()*(e-t+1))};var A={escape:{"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","/":"&#x2F;"}};A.unescape=T.invert(A.escape);var I={escape:new RegExp("["+T.keys(A.escape).join("")+"]","g"),unescape:new RegExp("("+T.keys(A.unescape).join("|")+")","g")};T.each(["escape","unescape"],function(t){T[t]=function(e){return null==e?"":(""+e).replace(I[t],function(e){return A[t][e]})}}),T.result=function(t,e){if(null==t)return null;var s=t[e];return T.isFunction(s)?s.call(t):s},T.mixin=function(t){P(T.functions(t),function(e){var s=T[e]=t[e];T.prototype[e]=function(){var t=[this._wrapped];return l.apply(t,arguments),F.call(this,s.apply(T,t))}})};var z=0;T.uniqueId=function(t){var e=++z+"";return t?t+e:e},T.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var E=/(.)^/,L={"'":"'","\\":"\\","\r":"r","\n":"n","\t":"t","\u2028":"u2028","\u2029":"u2029"},D=/\\|'|\r|\n|\t|\u2028|\u2029/g;T.template=function(t,e,s){var i;s=T.defaults({},s,T.templateSettings);var n=new RegExp([(s.escape||E).source,(s.interpolate||E).source,(s.evaluate||E).source].join("|")+"|$","g"),a=0,r="__p+='";t.replace(n,function(e,s,i,n,o){return r+=t.slice(a,o).replace(D,function(t){return"\\"+L[t]}),s&&(r+="'+\n((__t=("+s+"))==null?'':_.escape(__t))+\n'"),i&&(r+="'+\n((__t=("+i+"))==null?'':__t)+\n'"),n&&(r+="';\n"+n+"\n__p+='"),a=o+e.length,e}),r+="';\n",s.variable||(r="with(obj||{}){\n"+r+"}\n"),r="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+r+"return __p;\n";try{i=new Function(s.variable||"obj","_",r)}catch(t){throw t.source=r,t}if(e)return i(e,T);var o=function(t){return i.call(this,t,T)};return o.source="function("+(s.variable||"obj")+"){\n"+r+"}",o},T.chain=function(t){return T(t).chain()};var F=function(t){return this._chain?T(t).chain():t};T.mixin(T),P(["pop","push","reverse","shift","sort","splice","unshift"],function(t){var e=a[t];T.prototype[t]=function(){var s=this._wrapped;return e.apply(s,arguments),"shift"!=t&&"splice"!=t||0!==s.length||delete s[0],F.call(this,s)}}),P(["concat","join","slice"],function(t){var e=a[t];T.prototype[t]=function(){return F.call(this,e.apply(this._wrapped,arguments))}}),T.extend(T.prototype,{chain:function(){return this._chain=!0,this},value:function(){return this._wrapped}})}).call(this)},tOHu:function(t,e,s){"use strict";var i=s("jyVo"),n=s("SfvY"),a={methods:{checkall(){let t=this.roilist.every(t=>!!t.image);this.roilist.forEach(e=>this.$set(e,"image",t?0:1)),this.$emit("closecontextmenu")},del(t){this.$confirm(this.$t("analaysisPanel.delete"),{confirmButtonText:this.$t("confirm.confirm"),cancelButtonText:this.$t("confirm.quit"),type:"warning"}).then(()=>this.$emit("delRoi",t),t=>t)},noEmoji(t){t.target.value=t.target.value.replace(/[^\u0020-\u007E\u00A0-\u00BE\u2E80-\uA4CF\uF900-\uFAFF\uFE30-\uFE4F\uFF00-\uFFEF\u0080-\u009F\u2000-\u201f\u2026\u2022\u20ac\r\n]/g,"")}},props:["roilist","currentRois"],watch:{slices:{handler(t){console.log(t)},deep:!0}}},r={render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"roi"},[s("div",{staticClass:"top"},[s("div",{staticClass:"left"},[s("div",[s("span",{staticClass:"uncheck",class:{checked:!!t.roilist.length&&t.roilist.every(function(t){return!!t.image})},on:{click:t.checkall}}),t._v("\n                ROI\n            ")])]),t._v(" "),s("div",{staticClass:"center"},[t._v("\n            "+t._s(t.$t("slice.remark"))+"\n        ")]),t._v(" "),s("div",{staticClass:"right"},[t._v("\n            "+t._s(t.$t("analyze.opration"))+"\n        ")])]),t._v(" "),s("div",{staticClass:"rois"},t._l(t.roilist,function(e,i){return s("div",{key:i,staticClass:"row",class:{curRoi:t.currentRois[e.id]},on:{click:function(s){t.$emit("curROI",e,s.shiftKey),t.$emit("closecontextmenu")}}},[s("div",{staticClass:"left"},[s("div",[s("span",{staticClass:"uncheck",class:{checked:e.image},on:{click:function(s){s.stopPropagation(),t.$set(e,"image",1-(e.image||0)),t.$emit("closecontextmenu")}}}),t._v("\n                    "+t._s(i+1)+"\n                ")])]),t._v(" "),s("div",{staticClass:"center"},[s("input",{directives:[{name:"model",rawName:"v-model.lazy",value:e.remark,expression:"roi.remark",modifiers:{lazy:!0}}],attrs:{type:"text",placeholder:t.$t("slice.input"),maxlength:"300",title:e.remark},domProps:{value:e.remark},on:{keydown:function(e){if(!e.type.indexOf("key")&&t._k(e.keyCode,"delete",[8,46],e.key,["Backspace","Delete","Del"]))return null;e.stopPropagation()},input:t.noEmoji,change:function(s){return t.$set(e,"remark",s.target.value)}}})]),t._v(" "),s("div",{staticClass:"right"},[s("em",{attrs:{title:t.$t("upload.delete")},on:{click:function(s){return s.stopPropagation(),t.del(e)}}})])])}),0)])},staticRenderFns:[]};var o=s("VU/8")(a,r,!1,function(t){s("uvd6")},"data-v-4066a7c6",null).exports,l={props:["slice","record","companyid"],data(){return{startTime:new Date,loopHandler:0,auto:"one",centerRegion:null,curRois:{},showbutton:!0,radio:null,position:{offx:this.slice.position?this.slice.position.offx:.5,offy:this.slice.position?this.slice.position.offy:.5*this.slice.height/this.slice.width,zoom:this.slice.position?this.slice.position.zoom:null},lineup:null,showMppGuide:!1,drawMpp:null}},computed:{userInfo:()=>Object(i.o)()},methods:{keypress(t){},noEmoji(t){t.target.value=t.target.value.replace(/[^\u0020-\u007E\u00A0-\u00BE\u2E80-\uA4CF\uF900-\uFAFF\uFE30-\uFE4F\uFF00-\uFFEF\u0080-\u009F\u2000-\u201f\u2026\u2022\u20ac\r\n]/g,"")},curROIChange(t,e){var s;t?t.length?s=t:e&&this.curRois[t.id]?(delete this.curRois[t.id],s=[]):s=[t]:s=[],this.curRois=Object.assign({},e&&this.curRois,...s.map(t=>({[t.id]:t})))},roiChanged(){for(var t in this.curRois)this.curRois[t]=Object.assign({},this.curRois[t]);var e=Object.assign({},this.curRois);this.$set(this.slice,"roilist",this.slice.roilist.map(t=>{var s=e[t.id];return s?(delete e[t.id],s):t}).concat(Object.values(e))),this.slice.tct&&(this.slice.tct.result=this.slice.tct.result.filter(t=>!this.curRois[t.id]))},listChangeCurrent(){var t=[].concat.apply([],Object.values(this.curRois).map(t=>t.path.x)),e=[].concat.apply([],Object.values(this.curRois).map(t=>t.path.y));t.length?this.centerRegion=[Math.min.apply(null,t),Math.min.apply(null,e),Math.max.apply(null,t),Math.max.apply(null,e)]:this.centerRegion=null,this.$refs.osd.scope=null},draw(t){t.id=(Math.random()+"").substr(2,6),this.slice.roilist=[...this.slice.roilist,t]},async delCurRoi(t){let e={};t?(e={[t.id]:t},this.curRois[t.id]&&(delete this.curRois[t.id],this.curRois=Object.assign({},this.curRois))):(e=this.curRois,await this.$confirm(this.$t("analaysisPanel.delete"),{confirmButtonText:this.$t("confirm.confirm"),cancelButtonText:this.$t("confirm.quit"),type:"warning"}),this.curRois={}),this.slice.tct&&(this.slice.tct.result=this.slice.tct.result.filter(t=>!e[t.id])),this.slice.roilist=this.slice.roilist.filter(t=>!e[t.id])},getAlgorithmResult(t=this.record.id,e=this.slice.id,s=this.slice.filename){Object(i.b)("ai/getresult?companyid="+this.companyid,{caseid:t,fileid:e,filename:s,type:"tct",other:""}).then(t=>{if(this.lineup=t.data.rank,t.data.done){if(this.showbutton=!0,this.loopHandler=0,this.slice.tct&&0==this.slice.tct.result.length){var e="u";if(-1==t.data.rank){var s=t.data.result.cells&&t.data.result.cells.slice(0,30).map(t=>({id:(Math.random()+"").substr(2,6),path:{x:t.contourPoints.slice(0,-1).map(t=>t[0]),y:t.contourPoints.slice(0,-1).map(t=>t[1])}}));this.$set(this.slice.tct,"result",s);try{e=t.data.result.diagnosis[0].toLowerCase()}catch(t){}}this.$set(this.slice.tct,"diagnosis",{n:"negative",p:"positive",u:"unsure"}[e]||"unsure"),this.$set(this.slice,"type","tct"),this.updateRecord()}}else this.showbutton=!1,this.loopHandler=setTimeout(()=>{this.getAlgorithmResult()},5e3)})},startAnalyze(t=this.record.id,e=this.slice.id,s=this.slice.filename){this.$set(this.slice,"tct",{}),this.$set(this.slice.tct,"result",[]),this.slice.started=!0,this.record.started=!0,this.$set(this.slice.tct,"diagnosis",null),this.showbutton=!1,this.auto="one",Object.values(this.curRois).map(t=>this.slice.roilist.every(e=>t.id!=e.id)&&this.slice.tct.result.every(e=>t.id!=e.id)?delete this.curRois[t.id]:""),Object(i.b)("ai/start?companyid="+this.companyid,{caseid:t,fileid:e,filename:s,type:"tct",other:""}).then(t=>{this.getAlgorithmResult(),this.slice.tct.taskid=t.data.task_id}).catch(t=>console.log(t)),this.updateRecord()},updateRecord(){this.$emit("save","auto")},keydown(t){"Delete"!=t.key&&"Backspace"!=t.key||!Object.keys(this.curRois).length||this.delCurRoi()},async recheck(t){let e={negative:"阴性",positive:"阳性",unsure:"不合格"}[t];await this.$confirm("确定结果为 "+e+" 吗","提示",{confirmButtonText:"确定并关闭",cancelButtonText:"再看看",type:"warning",closeOnClickModal:!1}),this.$set(this.slice.tct,"check",t),await Object(i.b)("ai/edit?companyid="+this.companyid,{caseid:this.record.id,fileid:this.slice.id,filename:this.slice.filename,type:"tct",result:t});try{this.record.companyid||await Object(i.b)("check/save",{companyid:this.companyid,caseid:this.record.id,airesult:this.slice.tct.diagnosis,docresult:t,spent:(new Date-this.startTime)/1e3})}catch(t){return void this.$confirm(t.message,"提示",{confirmButtonText:"确定",type:"warning",showCancelButton:!1,closeOnClickModal:!1,callback:t=>this.$emit("save","close")})}this.record.started=!0,this.record.analy=e,this.$emit("save","close")}},mounted(){this.slice.started&&this.slice.tct&&null===this.slice.tct.diagnosis&&this.getAlgorithmResult(),window.addEventListener("online",()=>{this.showbutton||this.getAlgorithmResult()})},watch:{"slice.id":{handler(){clearTimeout(this.loopHandler),this.loopHandler=0}},drawMpp:{handler(t){t&&(this.$set(this.slice,"mppx",t),this.$set(this.slice,"mppy",t),this.$emit("save","auto"),this.startAnalyze())}}},beforeDestroy(){clearTimeout(this.loopHandler),this.loopHandler=0},components:{"v-dragon":n.a,"v-roi":o}},c={render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"cnt",staticStyle:{width:"100%"},attrs:{tabIndex:0},on:{keydown:t.keydown,keypress:t.keypress}},[s("div",{staticClass:"analyright"},[s("v-dragon",{staticClass:"dragon",attrs:{record:t.record,slice:t.slice,roilist:this.slice.roilist.map(function(t){return Object.assign({method:"rectangle"},t,{color:"yellow"})}).concat((this.slice.tct?this.slice.tct.result:[]).map(function(t){return Object.assign({},t,{color:"red",method:"rectangle",editable:!0,selectable:!1})})),curRois:t.curRois,penColor:"yellow",centerRegion:t.centerRegion,position:t.position,companyid:t.companyid,showMppGuide:t.showMppGuide,cellArea:1962},on:{curROI:t.curROIChange,roiChanged:t.roiChanged,draw:t.draw,delRoi:function(e){return t.delCurRoi(e)},position:function(e,s,i){t.$set(t.position,"offx",e),t.$set(t.position,"offy",s),t.$set(t.position,"zoom",i),t.$set(t.slice,"position",t.position)},closeMppGuide:function(e){t.showMppGuide=!1},changeMpp:function(e){return t.drawMpp=e}}})],1),t._v(" "),s("div",{staticClass:"analylist"},[s("h2",[s("span",{class:"one"==t.auto?"auto":"",on:{click:function(e){t.auto="one"}}},[t._v(t._s(t.$t("analyze.airoi")))]),t._v(" "),s("span",{class:"two"==t.auto?"auto":"",on:{click:function(e){t.auto="two"}}},[t._v(t._s(t.$t("analyze.roi")))]),t._v(" "),t.record.companyid?s("span",{staticClass:"close",on:{click:function(e){return t.$emit("save","close")}}},[t._v("关闭")]):t._e()]),t._v(" "),this.slice.tct&&"one"==t.auto?s("v-roi",{staticClass:"automanualroi",attrs:{roilist:this.slice.tct?this.slice.tct.result:[],currentRois:t.curRois},on:{curROI:function(e,s){return t.curROIChange(e,s)+t.listChangeCurrent()},delRoi:function(e){return t.delCurRoi(e)}}}):t._e(),t._v(" "),"two"==t.auto?s("v-roi",{staticClass:"manualroi",attrs:{roilist:t.slice.roilist,currentRois:t.curRois},on:{curROI:function(e,s){return t.curROIChange(e,s)+t.listChangeCurrent()},delRoi:function(e){return t.delCurRoi(e)}}}):t._e(),t._v(" "),t.showbutton||"one"!=t.auto?t._e():s("div",{staticClass:"loding"},[s("div",{staticClass:"video"},[s("img",{attrs:{src:"/static/video/loading.gif"}}),t._v(" "),0==t.lineup?s("div",{staticClass:"lineup"},[t._v("正在处理...")]):t._e(),t._v(" "),t.lineup>0?s("div",{staticClass:"lineup"},[t._v(t._s(t.$t("slice.lineup"))+" "),s("span",{staticStyle:{color:"#4C9FFA","font-size":"18px","font-weight":"bolder"}},[t._v(t._s(t.lineup))]),t._v(" "+t._s(t.$t("slice.position")))]):t._e()])]),t._v(" "),this.slice.tct||"one"!=t.auto?t._e():s("div",{staticClass:"ifshowtables"},[t._v(t._s(t.$t("slice.noanalysis")))]),t._v(" "),this.slice.tct&&"one"==t.auto?s("div",{staticClass:"tctbtm"},[s("div",{staticClass:"AiResult"},[s("div",[t._v("\n                    "+t._s(t.$t("slice.AiResult"))+"\n                ")]),t._v(" "),s("div",{class:{error:"unsure"==this.slice.tct.diagnosis}},[t._v("\n                    "+t._s({negative:"阴性",positive:"阳性",unsure:"不合格"}[t.slice.tct.check||t.slice.tct.diagnosis])+"\n                    ")])]),t._v(" "),s("div",{staticClass:"confidence"},[s("div",[t._v(t._s(t.$t("slice.confidence")))]),t._v(" "),t._m(0)]),t._v(" "),s("div",{staticClass:"interactive"},[s("div",[t._v("反馈")]),t._v(" "),s("el-radio-group",{staticClass:"radios",attrs:{value:t.slice.tct.check},on:{input:t.recheck}},[s("el-radio",{attrs:{label:"positive"}},[t._v("阳性")]),t._v(" "),s("el-radio",{attrs:{label:"negative"}},[t._v("阴性")]),t._v(" "),s("el-radio",{attrs:{label:"unsure"}},[t._v("不合格")])],1)],1)]):t._e(),t._v(" "),"two"==t.auto?s("div",{staticClass:"opinio"},[s("h1",[t._v("\n                "+t._s(t.$t("analyze.point"))+"\n            ")]),t._v(" "),s("textarea",{directives:[{name:"model",rawName:"v-model",value:t.record.opinion,expression:"record.opinion"}],attrs:{placeholder:t.$t("report.pointremind"),maxlength:"300"},domProps:{value:t.record.opinion},on:{input:[function(e){e.target.composing||t.$set(t.record,"opinion",e.target.value)},t.noEmoji]}})]):t._e()],1)])},staticRenderFns:[function(){var t=this.$createElement,e=this._self._c||t;return e("div",[e("div",[this._v("100%")])])}]};var h=s("VU/8")(l,c,!1,function(t){s("E82G"),s("1O0Z")},"data-v-764b7a1c",null).exports,u={props:["record","companyid"],data(){return{company:this.companyid,currentRoiIndex:"",curAI:null,fullPage:!1,startIndex:0}},computed:{curSlice(){let t=this.record.slices.find(t=>t.id==this.record.slice)||this.record.slices.filter(t=>1==t.state)[0]||null;return t&&(this.curAI=t.toolType||"human",t.roilist=t.roilist||[]),t}},mounted(){},methods:{keydown(t){let e=this.record.slices.filter(t=>1==t.state);if((t.ctrlKey||t.metaKey)&&this.curSlice&&("ArrowUp"==t.key||"ArrowDown"==t.key)){this.$refs.container.focus();let s=e.indexOf(this.curSlice);s=s+t.keyCode-39,s=Math.max(s,0),s=Math.min(s,e.length-1),this.$set(this.record,"slice",e[s].id)}},save(t){this.$emit("save",t)}},watch:{curAI(t){this.curSlice.toolType=t}},components:{tct:h}},d={render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return this.record.slices.filter(function(t){return 1==t.state}).length?s("div",{ref:"container",staticClass:"container",attrs:{tabIndex:1},on:{keydown:t.keydown}},[t.curSlice?s("div",{key:t.curSlice.id,staticClass:"analy"},[s(t.curAI,{tag:"component",attrs:{record:t.record,slice:t.curSlice,companyid:t.company},on:{save:function(e){return t.save(e)}}})],1):t._e()]):t._e()},staticRenderFns:[]};var p=s("VU/8")(u,d,!1,function(t){s("vOVi")},"data-v-7d80b79a",null).exports,f=s("k5KV"),m=s.n(f),v=s("Mk6O"),g=s.n(v),y={props:["data","showBatch","companyid"],data(){if(!this.data.oldRecord){var t=this.data.record.slices.map((t,e)=>t.width?t:Object(i.b)("files/getInfo?companyid="+(this.companyid||Object(i.o)().company),{caseid:this.data.record.id,fileid:t.id}).then(s=>this.$set(this.data.record.slices,e,Object.assign({},t,s.data,{name:t.name}))).catch(t=>1));Promise.all(t).then(t=>this.oldRecord=m.a.clone(this.data.record))}return this.data.record.stage=2,{company:this.companyid||Object(i.o)().company,record:this.data.record,oldRecord:this.data.oldRecord,transition:"",saved:!1}},watch:{"record.stage":function(t,e){this.transition=e<t?"right2left":"left2right"}},methods:{nav(t){this.record.stage=t},prev(){this.nav(this.record.stage-1)},next(){this.nav(this.record.stage+1)},cleanRecord:t=>Object.assign({},t,{slices:t.slices.filter(t=>1==t.state).map(({id:t,name:e,filename:s})=>({id:t,name:e,filename:s})),attachments:t.attachments.filter(t=>1==t.state)}),async save(t){await Promise.all(this.record.slices.filter(t=>1==t.state).filter((t,e)=>{var s=this.oldRecord.slices.find(e=>e.id==t.id);return!s||!m.a.equals(s,t)}).map((t,e)=>Object(i.b)("files/saveInfo?companyid="+this.company,{caseid:this.record.id,fileid:t.id,content:JSON.stringify(t)}).then(t=>{if(!0,0==t.code)return 1;throw"保存切片失败"})));var e=this.cleanRecord(this.record),s=this.cleanRecord(this.oldRecord);g()(s,e)&&await Object(i.b)("records/update?companyid="+this.company,{id:e.id,content:JSON.stringify(e)}),this.oldRecord=this.data.oldRecord=m.a.clone(this.record),t&&"close"==t&&this.$emit("closing")},async onclose(){let t=Object.assign({},this.oldRecord);delete t.stage;let e=Object.assign({},this.record);if(delete e.stage,!m.a.equals(t,e))try{await this.$confirm(this.$t("detail.sureclose"),{confirmButtonText:this.$t("confirm.confirm"),cancelButtonText:this.$t("confirm.quit"),type:"warning"})}catch(t){return}[...this.record.slices,...this.record.attachments].forEach(t=>1!=t.state&&(t.deleted=!0)),this.$emit("closing")}},components:{analyze:p}},_={render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"blackback",attrs:{id:"id"+t.data.id}},[s("div",{staticClass:"body"},[t.oldRecord?s("transition",{attrs:{name:t.transition}},[s(["basic","file","analyze","report"][t.record.stage],{tag:"component",attrs:{showBatch:t.showBatch,record:t.record,companyid:t.company},on:{next:t.next,prev:t.prev,save:t.save}})],1):t._e()],1),t._v(" "),t.saved?s("div",{staticClass:"saved"},[t._v("保存成功")]):t._e()])},staticRenderFns:[]};var w=s("VU/8")(y,_,!1,function(t){s("+I/B")},"data-v-e09ce776",null);e.a=w.exports},uvd6:function(t,e){},vOVi:function(t,e){},vhYd:function(t,e,s){t.exports=s.p+"static/img/矩形排除-d.95f3983.svg"}});