webpackJsonp([6],{"+uoy":function(e,t){},Konr:function(e,t,a){e.exports=a.p+"static/img/edit.4f9db56.svg"},M7z2:function(e,t){},R2h8:function(e,t,a){e.exports=a.p+"static/img/add.90d4e5a.svg"},gVMB:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=a("jyVo"),o={props:["company","type","onTrial","trialTimes"],data(){return{alert:"",aiTypes:this.$t("slice.aiTypes"),pathologyModels:{basicProcessing:["cellseg","center","pdl1db","mutialg"],histopathology:["tagging"],cytopathology:["tct1","tct2","lct1","lct2","pdl1","ki67hot","ki67","er","pr","fish","her2","np","dna","cd30","bm"]},regs:new RegExp('^[^\\\\\\/:：*?？\\"<>|]+$'),trial:Number(this.onTrial),newTrialTimes:this.trialTimes}},methods:{trailChange(e){this.$emit("changeTrial",e)},addCompany(){if(""==this.company.name.trim())return this.alert="组织名称不能为空",setTimeout(()=>this.alert="",3e3),!1;if(!this.regs.test(this.company.name))return!1;let e=Object.assign({},this.newTrialTimes);return Object.keys(e).forEach(t=>{this.company.checkedMOdels.includes(t)||delete e[t],["tct","lct"].includes(t)&&delete e[t]}),Object.values(e).some(e=>""===e)&&this.trial?(this.$message.error("算法次数限制不能为空"),!1):this.company.isTest&&!this.company.endTime?(this.$message.error("试用时间不能为空"),!1):void("add"==this.type?(t={grp_name:this.company.name.trim(),model_lis:JSON.stringify(this.company.checkedMOdels),volume:this.company.volume,remark:this.company.remark,importable:this.company.importable,exportJson:this.company.exportJson,isTest:this.company.isTest,endTime:this.company.endTime,defaultAiThreshold:JSON.stringify({tct:this.company.defaultAiThreshold.tct,lct:this.company.defaultAiThreshold.lct,dna:this.company.defaultAiThreshold.dna}),onTrial:this.trial,trialTimes:JSON.stringify(this.newTrialTimes)},Object(n.b)("manage/add_grp",t).then(e=>{1==e.data.status?this.$emit("close"):-1==e.data.status&&(this.alert="组织名称已存在",setTimeout(()=>this.alert="",3e3))})):"edit"==this.type&&(t={old_grp_name:this.company.oldName,new_grp_name:this.company.name.trim(),model_lis:JSON.stringify(this.company.checkedMOdels),volume:this.company.volume,remark:this.company.remark,id:this.company.id,importable:this.company.importable,exportJson:this.company.exportJson,isTest:this.company.isTest,endTime:this.company.endTime,defaultAiThreshold:JSON.stringify({tct:this.company.defaultAiThreshold.tct,lct:this.company.defaultAiThreshold.lct,dna:this.company.defaultAiThreshold.dna}),onTrial:this.trial,trialTimes:JSON.stringify(this.newTrialTimes)},Object(n.b)("manage/alter_attr",t).then(e=>{1==e.data.status?this.$emit("close"):-1==e.data.status&&(this.alert="组织名称已存在",setTimeout(()=>this.alert="",3e3))}).catch(e=>{console.log(e)})));var t},checkAll(e){let t=e.target.checked;this.company.checkedMOdels=t?Object.keys(this.aiTypes):[]},isContain:(e,t)=>e.every(e=>t.includes(e)),selectModel(e,t){if(e)this.company.checkedMOdels.push(t);else{let e=this.company.checkedMOdels.indexOf(t);this.company.checkedMOdels.splice(e,1),this.newTrialTimes[t]=""}},checkPart(e,t){e?(this.company.checkedMOdels=this.company.checkedMOdels.concat(this.pathologyModels[t]),this.company.checkedMOdels=Array.from(new Set(this.company.checkedMOdels))):this.company.checkedMOdels=this.company.checkedMOdels.filter(e=>!this.pathologyModels[t].includes(e))},isAll(){return this.isContain(this.pathologyModels.basicProcessing,this.company.checkedMOdels)&&this.isContain(this.pathologyModels.histopathology,this.company.checkedMOdels)&&this.isContain(this.pathologyModels.cytopathology,this.company.checkedMOdels)}}},s={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"modal"},[a("div",{staticClass:"box"},[a("div",{staticClass:"title"},[a("span",[e._v(e._s("add"==e.type?"添加组织":"修改组织"))]),e._v(" "),a("div",{staticClass:"close",on:{click:function(t){return e.$emit("close")}}},[e._v("×")])]),e._v(" "),a("div",{staticClass:"edit"},[a("table",[a("tr",[e._m(0),e._v(" "),a("td",{staticClass:"name",staticStyle:{"padding-bottom":"8px"}},[a("input",{directives:[{name:"model",rawName:"v-model",value:e.company.name,expression:"company.name"}],attrs:{type:"text",placeholder:"请输入组织名称",maxlength:"200"},domProps:{value:e.company.name},on:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.addCompany(t)},input:function(t){t.target.composing||e.$set(e.company,"name",t.target.value)}}}),e._v(" "),a("span",{directives:[{name:"show",rawName:"v-show",value:e.alert,expression:"alert"}]},[e._v(e._s(e.alert))]),e._v(" "),a("span",{directives:[{name:"show",rawName:"v-show",value:e.company.name&&!e.regs.test(e.company.name),expression:"company.name&&!regs.test(company.name)"}]},[e._v('组织名称不能包含下列任何字符：\\ / : * ? " < > |')])])]),e._v(" "),a("tr",[a("td",{staticStyle:{"padding-bottom":"4px"},attrs:{align:"right"}},[e._v("导入/出.db文件")]),e._v(" "),a("td",{staticStyle:{"padding-bottom":"4px"}},[a("el-radio",{attrs:{label:0},on:{change:e.trailChange},model:{value:e.company.importable,callback:function(t){e.$set(e.company,"importable",t)},expression:"company.importable"}},[e._v("关闭")]),e._v(" "),a("el-radio",{attrs:{label:1},on:{change:e.trailChange},model:{value:e.company.importable,callback:function(t){e.$set(e.company,"importable",t)},expression:"company.importable"}},[e._v("开启")])],1)]),e._v(" "),a("tr",[a("td",{staticStyle:{"padding-bottom":"4px"},attrs:{align:"right"}},[e._v("导出json")]),e._v(" "),a("td",{staticStyle:{"padding-bottom":"4px"}},[a("el-radio",{attrs:{label:0},on:{change:e.trailChange},model:{value:e.company.exportJson,callback:function(t){e.$set(e.company,"exportJson",t)},expression:"company.exportJson"}},[e._v("关闭")]),e._v(" "),a("el-radio",{attrs:{label:1},on:{change:e.trailChange},model:{value:e.company.exportJson,callback:function(t){e.$set(e.company,"exportJson",t)},expression:"company.exportJson"}},[e._v("开启")])],1)]),e._v(" "),a("tr",[a("td",{staticStyle:{"padding-bottom":"4px"},attrs:{align:"right"}},[e._v("软件试用")]),e._v(" "),a("td",{staticStyle:{"padding-bottom":"4px"}},[a("el-radio",{attrs:{label:0},on:{change:e.trailChange},model:{value:e.company.isTest,callback:function(t){e.$set(e.company,"isTest",t)},expression:"company.isTest"}},[e._v("不试用")]),e._v(" "),a("el-radio",{attrs:{label:1},on:{change:e.trailChange},model:{value:e.company.isTest,callback:function(t){e.$set(e.company,"isTest",t)},expression:"company.isTest"}},[e._v("开启试用，截止日期")]),e._v(" "),e.company.isTest?a("el-date-picker",{attrs:{type:"date",placeholder:"选择日期",format:"yyyy 年 MM 月 dd 日","value-format":"yyyy-MM-dd"},model:{value:e.company.endTime,callback:function(t){e.$set(e.company,"endTime",t)},expression:"company.endTime"}}):e._e()],1)]),e._v(" "),a("tr",[a("td",{staticStyle:{"padding-bottom":"4px"},attrs:{align:"right"}},[e._v("算法试用")]),e._v(" "),a("td",{staticStyle:{"padding-bottom":"4px"}},[a("el-radio",{attrs:{label:0},on:{change:e.trailChange},model:{value:e.trial,callback:function(t){e.trial=t},expression:"trial"}},[e._v("不试用")]),e._v(" "),a("el-radio",{attrs:{label:1},on:{change:e.trailChange},model:{value:e.trial,callback:function(t){e.trial=t},expression:"trial"}},[e._v("算法次数限制")])],1)]),e._v(" "),a("tr",[a("td",{attrs:{align:"right"}},[e._v("选择模块")]),e._v(" "),a("td",{staticStyle:{"white-space":"normal",width:"536px"}},[a("label",{staticStyle:{display:"block"}},[a("input",{attrs:{type:"checkbox",name:"",id:""},domProps:{checked:e.isAll()},on:{change:e.checkAll}}),e._v("全选\n                        ")]),e._v(" "),a("table",{staticClass:"check-group",attrs:{cellspacing:"0"}},[a("tr",[a("td",[a("label",{staticStyle:{display:"block"}},[a("input",{attrs:{type:"checkbox",name:"",id:""},domProps:{checked:e.isContain(e.pathologyModels.basicProcessing,e.company.checkedMOdels)},on:{change:function(t){return e.checkPart(t.target.checked,"basicProcessing")}}}),e._v("图像处理\n                                    ")])]),e._v(" "),a("td",[a("ul",e._l(e.pathologyModels.basicProcessing,function(t,n){return a("li",{key:n},[a("label",{staticStyle:{display:"block"}},[a("input",{attrs:{type:"checkbox",name:"",id:""},domProps:{checked:e.company.checkedMOdels.includes(t)},on:{change:function(a){return e.selectModel(a.target.checked,t)}}}),e._v(e._s(e.aiTypes[t])+"\n                                            ")])])}),0)])]),e._v(" "),a("tr",[a("td",[a("label",{staticStyle:{display:"block"}},[a("input",{attrs:{type:"checkbox",name:"",id:""},domProps:{checked:e.isContain(e.pathologyModels.histopathology,e.company.checkedMOdels)},on:{change:function(t){return e.checkPart(t.target.checked,"histopathology")}}}),e._v("科研\n                                    ")])]),e._v(" "),a("td",[a("ul",e._l(e.pathologyModels.histopathology,function(t,n){return a("li",{key:n},[a("label",{staticStyle:{display:"block"}},[a("input",{attrs:{type:"checkbox",name:"",id:""},domProps:{checked:e.company.checkedMOdels.includes(t)},on:{change:function(a){return e.selectModel(a.target.checked,t)}}}),e._v(e._s(e.aiTypes[t])+"\n                                            ")])])}),0)])]),e._v(" "),a("tr",[a("td",[a("label",{staticStyle:{display:"block"}},[a("input",{attrs:{type:"checkbox",name:"",id:""},domProps:{checked:e.isContain(e.pathologyModels.cytopathology,e.company.checkedMOdels)},on:{change:function(t){return e.checkPart(t.target.checked,"cytopathology")}}}),e._v("AI处理\n                                    ")])]),e._v(" "),a("td",[a("ul",e._l(e.pathologyModels.cytopathology,function(t,n){return a("li",{key:n},[a("label",[a("input",{attrs:{type:"checkbox",name:"",id:""},domProps:{checked:e.company.checkedMOdels.includes(t)},on:{change:function(a){return e.selectModel(a.target.checked,t)}}}),e._v(e._s(e.aiTypes[t])+"\n                                            ")]),e._v(" "),e.company.checkedMOdels.includes(t)&&e.trial?a("input",{directives:[{name:"model",rawName:"v-model",value:e.newTrialTimes[t],expression:"newTrialTimes[item]"}],staticClass:"maininput",domProps:{value:e.newTrialTimes[t]},on:{input:[function(a){a.target.composing||e.$set(e.newTrialTimes,t,a.target.value)},function(a){e.newTrialTimes[t]=e.newTrialTimes[t].replace(/[^\d]/g,"")&&parseInt(e.newTrialTimes[t].replace(/[^\d]/g,""))}]}}):e._e()])}),0)])])])])]),e._v(" "),a("tr",[a("td",{attrs:{align:"right"}},[e._v(e._s(e.$t("backstage.volume")))]),e._v(" "),a("td",{staticClass:"volume"},[a("input",{directives:[{name:"model",rawName:"v-model",value:e.company.volume,expression:"company.volume"}],staticStyle:{"padding-right":"55px"},attrs:{type:"text",placeholder:"请输入容量"},domProps:{value:e.company.volume},on:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.addCompany(t)},input:[function(t){t.target.composing||e.$set(e.company,"volume",t.target.value)},function(t){e.company.volume=e.company.volume.replace(/[^\d.]/g,"")}]}}),e._v(" "),a("span",[e._v("GB")])])]),e._v(" "),a("tr",[a("td",{attrs:{align:"right"}},[e._v("TCT默认阈值")]),e._v(" "),a("td",{staticClass:"volume"},[a("input",{directives:[{name:"model",rawName:"v-model",value:e.company.defaultAiThreshold.tct,expression:"company.defaultAiThreshold.tct"}],staticStyle:{"padding-right":"55px"},attrs:{type:"text",placeholder:"请输入TCT默认阈值"},domProps:{value:e.company.defaultAiThreshold.tct},on:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.addCompany(t)},input:function(t){t.target.composing||e.$set(e.company.defaultAiThreshold,"tct",t.target.value)}}})])]),e._v(" "),a("tr",[a("td",{attrs:{align:"right"}},[e._v("LCT默认阈值")]),e._v(" "),a("td",{staticClass:"volume"},[a("input",{directives:[{name:"model",rawName:"v-model",value:e.company.defaultAiThreshold.lct,expression:"company.defaultAiThreshold.lct"}],staticStyle:{"padding-right":"55px"},attrs:{type:"text",placeholder:"请输入LCT默认阈值"},domProps:{value:e.company.defaultAiThreshold.lct},on:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.addCompany(t)},input:function(t){t.target.composing||e.$set(e.company.defaultAiThreshold,"lct",t.target.value)}}})])]),e._v(" "),a("tr",[a("td",{attrs:{align:"right"}},[e._v("DNA默认阈值")]),e._v(" "),a("td",{staticClass:"volume"},[a("input",{directives:[{name:"model",rawName:"v-model",value:e.company.defaultAiThreshold.dna,expression:"company.defaultAiThreshold.dna"}],staticStyle:{"padding-right":"55px"},attrs:{type:"text",placeholder:"请输入DNA默认阈值"},domProps:{value:e.company.defaultAiThreshold.dna},on:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.addCompany(t)},input:function(t){t.target.composing||e.$set(e.company.defaultAiThreshold,"dna",t.target.value)}}})])]),e._v(" "),a("tr",[a("td",{attrs:{align:"right"}},[e._v("备注")]),e._v(" "),a("td",{staticClass:"remark"},[a("textarea",{directives:[{name:"model",rawName:"v-model",value:e.company.remark,expression:"company.remark"}],attrs:{name:"",id:"",cols:"30",rows:"5",placeholder:"请输入备注信息",maxlength:"100"},domProps:{value:e.company.remark},on:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.addCompany(t)},input:function(t){t.target.composing||e.$set(e.company,"remark",t.target.value)}}}),e._v(" "),a("span",[e._v("备注信息不超过100字")])])])])]),e._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:e.addCompany}},[e._v(e._s(e.$t("backstage.confirm")))]),e._v(" "),a("el-button",{on:{click:function(t){return e.$emit("close")}}},[e._v(e._s(e.$t("backstage.cancel")))])],1)])},staticRenderFns:[function(){var e=this.$createElement,t=this._self._c||e;return t("td",{staticStyle:{"padding-bottom":"8px"},attrs:{align:"right"}},[t("span",{staticStyle:{color:"#FF4B4B"}},[this._v("*")]),this._v("组织名称")])}]};const i={tct:"",lct:"",pdl1:"",ki67:"",er:"",pr:"",fish:"",ki67hot:"",her2:"",dna:""};var l={components:{model:a("VU/8")(o,s,!1,function(e){a("+uoy")},"data-v-256ad2e8",null).exports},data:()=>({company:[],showModel:!1,currentCompany:{oldName:"",name:"",checkedMOdels:[],volume:"",remark:"",id:"",defaultAiThreshold:{tct:.5,lct:.5,dna:.5},importable:0,exportJson:0,isTest:0,endTime:""},companyName:"",onTrial:0,trialTimes:i}),computed:{datas(){return(this.company||[]).filter(e=>(e.name||"").toLowerCase().indexOf(this.companyName.toLowerCase())>=0)}},mounted(){this.getAllCompany()},methods:{getAllCompany(){Object(n.o)().role&&"sa"==Object(n.o)().role?Object(n.b)("manage/get_grp").then(e=>{e.code||(this.company=e.data.sort((e,t)=>(t.create_time||"").localeCompare(e.create_time||"")))}).catch(e=>{console.log(e)}):this.$router.go(-1)},clearData(){this.currentCompany.oldName="",this.currentCompany.name="",this.currentCompany.checkedMOdels=[],this.currentCompany.volume="",this.currentCompany.remark="",this.currentCompany.id="",this.currentCompany.importable=0,this.currentCompany.exportJson=0,this.currentCompany.isTest=0,this.currentCompany.endTime="",this.currentCompany.defaultAiThreshold={tct:.5,lct:.5,dna:.5},this.onTrial=0,this.trialTimes=i},showAdmin(e){this.$router.push({path:"/admin",query:{data:e}})},getOneCompany(e){this.clearData();var t={grp_name:e};Object(n.b)("manage/get_attr",t).then(t=>{this.currentCompany.oldName=e,this.currentCompany.name=e,this.currentCompany.checkedMOdels=JSON.parse(t.data.model_lis),this.currentCompany.defaultAiThreshold=JSON.parse(t.data.defaultAiThreshold),this.currentCompany.volume=t.data.volume,this.currentCompany.remark=t.data.remark,this.currentCompany.id=t.data.id,this.currentCompany.importable=t.data.importable,this.currentCompany.exportJson=t.data.exportJson,this.currentCompany.isTest=t.data.isTest,this.currentCompany.endTime=t.data.endTime,this.onTrial=JSON.parse(t.data.onTrial),this.trialTimes=JSON.parse(t.data.trialTimes)||i,this.showModel="edit"})},deleteCompoany(e){this.$confirm(this.$t("backstage.ifDel")+" "+e+" ?",{confirmButtonText:this.$t("backstage.confirm"),cancelButtonText:this.$t("backstage.cancel"),type:"warning"}).then(()=>{this.$confirm(this.$t("backstage.confirmdel")+" "+e+" ?",{confirmButtonText:this.$t("backstage.confirm"),cancelButtonText:this.$t("backstage.cancel"),type:"warning"}).then(()=>{Object(n.b)("manage/del_grp",{grp_name:e}).then(e=>this.getAllCompany()).catch(t=>{console.log(t),5==t.code&&this.$message({message:`不允许删除${e}组织`,type:"warning"}),6==t.code&&this.$message({message:"该组织数据正在使用，暂无法删除",type:"warning"})})}).catch(()=>{this.$message({type:"info",message:this.$t("backstage.cancelDel")})})}).catch(()=>{this.$message({type:"info",message:this.$t("backstage.cancelDel")})})},close(){this.showModel=!1,this.clearData(),this.getAllCompany()}}},c={render:function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"manage"},[n("div",{staticClass:"header"},[n("h3",[e._v(e._s(this.$t("backstage.system")))]),e._v(" "),n("router-link",{staticClass:"gohome",attrs:{to:"/index"}},[e._v(e._s(e.$t("backstage.homepage")))])],1),e._v(" "),n("div",{staticClass:"content"},[n("div",{staticClass:"title"},[n("div",{staticClass:"fl"},[e._v("\n        组织信息\n        "),n("span",{staticClass:"num"},[e._v(e._s(e.company.length))])]),e._v(" "),n("el-button",{attrs:{type:"primary"},on:{click:function(t){e.showModel="add",e.clearData()}}},[n("img",{attrs:{src:a("R2h8"),width:"11",alt:""}}),e._v("\n           "+e._s(e.$t("backstage.addTissue"))+"\n      ")])],1),e._v(" "),n("el-table",{staticClass:"company",staticStyle:{width:"100%"},attrs:{data:e.datas},on:{"row-dblclick":function(t){return e.showAdmin(t.name)}}},[n("el-table-column",{attrs:{label:e.$t("backstage.organization")},scopedSlots:e._u([{key:"default",fn:function(t){return[n("span",{staticStyle:{color:"#2A9FF6"}},[e._v(e._s(t.row.name))])]}}])},[n("template",{slot:"header"},[n("input",{directives:[{name:"model",rawName:"v-model.trim",value:e.companyName,expression:"companyName",modifiers:{trim:!0}}],staticClass:"namesearch",attrs:{placeholder:"组织"},domProps:{value:e.companyName},on:{input:function(t){t.target.composing||(e.companyName=t.target.value.trim())},blur:function(t){return e.$forceUpdate()}}})])],2),e._v(" "),n("el-table-column",{attrs:{label:e.$t("backstage.volume")},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n          "+e._s(t.row.volume)+"\n          "),n("span",{directives:[{name:"show",rawName:"v-show",value:t.row.volume,expression:"scope.row.volume"}]},[e._v("GB")])]}}])}),e._v(" "),n("el-table-column",{attrs:{sortable:"",prop:"create_time",label:"创建时间"}}),e._v(" "),n("el-table-column",{attrs:{prop:"endTime",label:"截止日期"}}),e._v(" "),n("el-table-column",{attrs:{label:"备注"},scopedSlots:e._u([{key:"default",fn:function(t){return[n("div",{staticStyle:{width:"100%",overflow:"hidden","text-overflow":"ellipsis","white-space":"nowrap"}},[e._v(e._s(t.row.remark?t.row.remark:"—"))])]}}])}),e._v(" "),n("el-table-column",{attrs:{label:e.$t("backstage.operation"),width:"150"},scopedSlots:e._u([{key:"default",fn:function(t){return[n("img",{staticStyle:{cursor:"pointer"},attrs:{src:a("Konr"),alt:""},on:{click:function(a){return a.stopPropagation(),e.getOneCompany(t.row.name)}}}),e._v("  \n          "),n("img",{staticStyle:{cursor:"pointer"},attrs:{src:a("qFMu"),alt:""},on:{click:function(a){return a.stopPropagation(),e.deleteCompoany(t.row.name)}}})]}}])})],1)],1),e._v(" "),n("transition",{attrs:{name:"fade"}},[e.showModel?n("model",{attrs:{type:e.showModel,onTrial:e.onTrial,trialTimes:e.trialTimes,company:e.currentCompany},on:{close:e.close,changeTrial:function(t){return e.onTrial=t}}}):e._e()],1)],1)},staticRenderFns:[]};var r=a("VU/8")(l,c,!1,function(e){a("M7z2"),a("hpkU")},"data-v-846c5f8a",null);t.default=r.exports},hpkU:function(e,t){},qFMu:function(e,t,a){e.exports=a.p+"static/img/delete.468ae5a.svg"}});