webpackJsonp([2],{"+H9z":function(t,e){},"+UnF":function(t,e){},"/yYD":function(t,e){},"/zkq":function(t,e){},"10oS":function(t,e){},"1kz0":function(t,e,i){t.exports=i.p+"static/img/批量上传.1188967.svg"},"2Fjr":function(t,e){},"2XvT":function(t,e){},"2imM":function(t,e){},"3IRH":function(t,e){t.exports=function(t){return t.webpackPolyfill||(t.deprecate=function(){},t.paths=[],t.children||(t.children=[]),Object.defineProperty(t,"loaded",{enumerable:!0,get:function(){return t.l}}),Object.defineProperty(t,"id",{enumerable:!0,get:function(){return t.i}}),t.webpackPolyfill=1),t}},"47Vy":function(t,e){},"4FYi":function(t,e){},"4dxX":function(t,e){},"4jrt":function(t,e,i){t.exports=i.p+"static/img/自由排除.22dcf85.svg"},"5OvG":function(t,e){},"5PgD":function(t,e){},"5dFS":function(t,e){},"5dg9":function(t,e){},"6jY2":function(t,e){},"6zwf":function(t,e){},"7R9Z":function(t,e,i){"use strict";var s=i("jyVo"),n={props:["info","opinions"],data(){return this.info.REG={opinion:this.opinions}},methods:{changeValue(){this.$emit("sendValue",this.opinion)},noEmoji(t){t.target.value=t.target.value.replace(/[^\u0020-\u007E\u00A0-\u00BE\u2E80-\uA4CF\uF900-\uFAFF\uFE30-\uFE4F\uFF00-\uFFEF\u0080-\u009F\u2000-\u201f\u2026\u2022\u20ac\r\n]/g,"")}},watch:{opinions:{immediate:!0,deep:!0,handler(t){this.opinion=t}}}},a={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",[i("div",{staticClass:"opinion"},[i("h4",{staticClass:"title"},[t._v(t._s(t.$t("report.point")))]),t._v(" "),i("div",{staticClass:"opinion-write"},[i("textarea",{directives:[{name:"model",rawName:"v-model",value:t.opinion,expression:"opinion"}],attrs:{spellcheck:"false",name:"",id:"",maxlength:"300",cols:"30",rows:"10",placeholder:t.$t("report.pointremind")},domProps:{value:t.opinion},on:{change:t.changeValue,input:[function(e){e.target.composing||(t.opinion=e.target.value)},t.noEmoji]}})])])])},staticRenderFns:[]};var o=i("VU/8")(n,a,!1,function(t){i("NuEF")},"data-v-bcce32b6",null).exports,r={props:["info","opinions","firstSlice"],data(){return this.info.LCT={isStatisfied:"number"==typeof this.firstSlice.slide_quality?this.firstSlice.slide_quality>0?"1":"0":"",cellNum:"number"==typeof this.firstSlice.cell_num?this.firstSlice.cell_num>5e3?"greater":"less":"",cervicalCanalCells:"",metaplasticCells:"",inflammatoryCells:"",erythrocyte:"",cataplasia:"",intrauterineDevice:"",radiotherapy:"",selectopinion:"",opinion:this.opinions,options:["未见上皮内病变细胞或恶性细胞（NILM）","意义不明确的非典型鳞状细胞（ASC-US）","不除外高级别鳞状上皮内病变细胞的非典型鳞状细胞（ASC-H）","低级别鳞状上皮内病变（LSIL）","高级别鳞状上皮内病变（HSIL）","鳞状细胞癌（SCC）","非典型腺细胞（不能明确意义）","非典型腺细胞（倾向瘤变）","非典型子宫颈管上皮细胞，倾向于肿瘤","颈管原位腺癌（AIS）","腺癌","其他恶性肿瘤"],pathogen:[]}},methods:{changeValue(t){"string"==typeof t&&(this.opinion=t),this.$emit("sendValue",this.opinion)},noEmoji(t){t.target.value=t.target.value.replace(/[^\u0020-\u007E\u00A0-\u00BE\u2E80-\uA4CF\uF900-\uFAFF\uFE30-\uFE4F\uFF00-\uFFEF\u0080-\u009F\u2000-\u201f\u2026\u2022\u20ac\r\n]/g,"")}},mounted(){this.info.LCT.opinion=this.opinions,this.$nextTick(()=>{if(this.firstSlice.alg&&(this.firstSlice.alg.includes("tct")||this.firstSlice.alg.includes("lct")))if(this.firstSlice.check_result){let t=this.firstSlice.check_result.split(" ")[2];this.info.LCT.pathogen=t?t.split(","):[]}else if(this.firstSlice.ai_suggest){let t=this.firstSlice.ai_suggest.split(" ")[2];this.info.LCT.pathogen=t?t.split(","):[]}})},watch:{opinions:{immediate:!0,deep:!0,handler(t){this.opinion=t}}}},l={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",[i("div",{staticClass:"tct"},[i("h4",{staticClass:"title"},[t._v(t._s(t.$t("basic.sample")))]),t._v(" "),i("div",{staticClass:"tct-text"},[i("div",{staticClass:"left"},[i("div",{staticClass:"seption"},[i("div",{staticClass:"line"},[i("span",{staticClass:"weight600"},[t._v("标本满意度:")]),t._v(" "),i("el-radio",{attrs:{label:"1"},model:{value:t.isStatisfied,callback:function(e){t.isStatisfied=e},expression:"isStatisfied"}},[t._v(t._s(t.$t("report.satisfied")))]),t._v(" "),i("el-radio",{attrs:{label:"0"},model:{value:t.isStatisfied,callback:function(e){t.isStatisfied=e},expression:"isStatisfied"}},[t._v(t._s(t.$t("report.notsatisfied")))])],1),t._v(" "),i("div",{staticClass:"line"},[i("span",{staticClass:"weight600"},[t._v("细胞量:")]),t._v(" "),i("el-radio",{attrs:{label:"greater"},model:{value:t.cellNum,callback:function(e){t.cellNum=e},expression:"cellNum"}},[t._v(">5000")]),t._v(" "),i("el-radio",{attrs:{label:"less"},model:{value:t.cellNum,callback:function(e){t.cellNum=e},expression:"cellNum"}},[t._v("≤5000")])],1),t._v(" "),i("div",{staticClass:"line"},[i("span",{staticClass:"weight600"},[t._v("颈管细胞:")]),t._v(" "),i("el-radio",{attrs:{label:"1"},model:{value:t.cervicalCanalCells,callback:function(e){t.cervicalCanalCells=e},expression:"cervicalCanalCells"}},[t._v("有")]),t._v(" "),i("el-radio",{attrs:{label:"0"},model:{value:t.cervicalCanalCells,callback:function(e){t.cervicalCanalCells=e},expression:"cervicalCanalCells"}},[t._v("无")])],1),t._v(" "),i("div",{staticClass:"line"},[i("span",{staticClass:"weight600"},[t._v("化生细胞:")]),t._v(" "),i("el-radio",{attrs:{label:"1"},model:{value:t.metaplasticCells,callback:function(e){t.metaplasticCells=e},expression:"metaplasticCells"}},[t._v("有")]),t._v(" "),i("el-radio",{attrs:{label:"0"},model:{value:t.metaplasticCells,callback:function(e){t.metaplasticCells=e},expression:"metaplasticCells"}},[t._v("无")])],1)]),t._v(" "),i("div",{staticClass:"seption"},[i("div",{staticClass:"line weight600"},[t._v("\n            炎症以及反应性细胞改变\n          ")]),t._v(" "),i("div",{staticClass:"line"},[i("span",{staticClass:"weight600"},[t._v("炎细胞:")]),t._v(" "),i("el-radio",{attrs:{label:"less"},model:{value:t.inflammatoryCells,callback:function(e){t.inflammatoryCells=e},expression:"inflammatoryCells"}},[t._v("少量")]),t._v(" "),i("el-radio",{attrs:{label:"medium"},model:{value:t.inflammatoryCells,callback:function(e){t.inflammatoryCells=e},expression:"inflammatoryCells"}},[t._v("中量")]),t._v(" "),i("el-radio",{attrs:{label:"more"},model:{value:t.inflammatoryCells,callback:function(e){t.inflammatoryCells=e},expression:"inflammatoryCells"}},[t._v("大量")])],1),t._v(" "),i("div",{staticClass:"line"},[i("span",{staticClass:"weight600"},[t._v("红细胞:")]),t._v(" "),i("el-radio",{attrs:{label:"less"},model:{value:t.erythrocyte,callback:function(e){t.erythrocyte=e},expression:"erythrocyte"}},[t._v("少量")]),t._v(" "),i("el-radio",{attrs:{label:"medium"},model:{value:t.erythrocyte,callback:function(e){t.erythrocyte=e},expression:"erythrocyte"}},[t._v("中量")]),t._v(" "),i("el-radio",{attrs:{label:"more"},model:{value:t.erythrocyte,callback:function(e){t.erythrocyte=e},expression:"erythrocyte"}},[t._v("大量")])],1),t._v(" "),i("div",{staticClass:"line"},[i("span",{staticClass:"weight600"},[t._v("细胞萎缩:")]),t._v(" "),i("el-radio",{attrs:{label:"1"},model:{value:t.cataplasia,callback:function(e){t.cataplasia=e},expression:"cataplasia"}},[t._v("有")]),t._v(" "),i("el-radio",{attrs:{label:"0"},model:{value:t.cataplasia,callback:function(e){t.cataplasia=e},expression:"cataplasia"}},[t._v("无")])],1)]),t._v(" "),i("div",{staticClass:"seption"},[i("div",{staticClass:"line"},[i("span",{staticClass:"weight600"},[t._v("宫内节育器:")]),t._v(" "),i("el-radio",{attrs:{label:"1"},model:{value:t.intrauterineDevice,callback:function(e){t.intrauterineDevice=e},expression:"intrauterineDevice"}},[t._v("有")]),t._v(" "),i("el-radio",{attrs:{label:"0"},model:{value:t.intrauterineDevice,callback:function(e){t.intrauterineDevice=e},expression:"intrauterineDevice"}},[t._v("无")])],1),t._v(" "),i("div",{staticClass:"line"},[i("span",{staticClass:"weight600"},[t._v("放疗:")]),t._v(" "),i("el-radio",{attrs:{label:"1"},model:{value:t.radiotherapy,callback:function(e){t.radiotherapy=e},expression:"radiotherapy"}},[t._v("有")]),t._v(" "),i("el-radio",{attrs:{label:"0"},model:{value:t.radiotherapy,callback:function(e){t.radiotherapy=e},expression:"radiotherapy"}},[t._v("无")])],1)])]),t._v(" "),i("div",{staticClass:"right"},[i("div",{staticClass:"line weight600"},[t._v("微生物:")]),t._v(" "),i("el-checkbox-group",{staticStyle:{display:"inline-block"},model:{value:t.pathogen,callback:function(e){t.pathogen=e},expression:"pathogen"}},t._l(t.$t("report.padthogenArr"),function(t,e){return i("el-checkbox",{key:e,attrs:{label:t}})}),1)],1)])]),t._v(" "),i("div",{staticClass:"opinion"},[i("h4",{staticClass:"title"},[t._v("\n      "+t._s(t.$t("report.point"))+"\n       "),i("el-select",{on:{change:t.changeValue},model:{value:t.info.LCT.selectopinion,callback:function(e){t.$set(t.info.LCT,"selectopinion",e)},expression:"info.LCT.selectopinion"}},t._l(this.info.LCT.options,function(t){return i("el-option",{key:t,attrs:{label:t,value:t}})}),1)],1),t._v(" "),i("div",{staticClass:"opinion-write"},[i("textarea",{directives:[{name:"model",rawName:"v-model",value:t.opinion,expression:"opinion"}],attrs:{spellcheck:"false",name:"",id:"",maxlength:"300",cols:"30",rows:"10",placeholder:"诊断意见"},domProps:{value:t.opinion},on:{change:t.changeValue,input:[function(e){e.target.composing||(t.opinion=e.target.value)},t.noEmoji]}})])])])},staticRenderFns:[]};var c=i("VU/8")(r,l,!1,function(t){i("OFy7")},"data-v-3f32ee5e",null).exports,u=i("k5KV"),h=i.n(u),d={props:["info","opinions","esdMessage","record"],data(){return this.info.ESD=29==Object.keys(this.info.ESD).length?this.info.ESD:{locationId:"",operativeMethodId:"",specimenIntegrityId:"",mucosalSize:"",numberofLesions:"",others:"",mucosalWidth:"",mucosalHeight:"",grossType:"",histologicalType:"",histologyGrade:"",lauren:"",invasionDepth:"",wettingPattern:"",astricMucosa:"",isCombinedUlcer:"1",isTumorThrombus:"1",isNerveInvasion:"1",horizontalPMH:"1",verticalPVM:"1",PMH:"",PVM:"",uploadData:new Map,src1:"",src2:"",src3:"",opinion:this.opinions,reportBasicId:this.record.basic.caseid,imgData:{}}},methods:{handleInput(t){t.target.value=t.target.value.match(/^\d*(\.?\d{0,1})/g)[0]||null},changeValue(){this.$emit("sendValue",this.opinion)},noEmoji(t){t.target.value=t.target.value.replace(/[^\u0020-\u007E\u00A0-\u00BE\u2E80-\uA4CF\uF900-\uFAFF\uFE30-\uFE4F\uFF00-\uFFEF\u0080-\u009F\u2000-\u201f\u2026\u2022\u20ac\r\n]/g,"")},cleanRecord:t=>Object.assign({},t,{slices:t.slices.filter(t=>1==t.state).map(({id:t,name:e,filename:i})=>({id:t,name:e,filename:i})),attachments:t.attachments.filter(t=>1==t.state)})},created(){var t=[],e=[];this.esdMessage.filter(t=>-1===t.name.indexOf("痕")&&-1===t.name.indexOf("体")).forEach(e=>{e.roilist.map(t=>{t.filename=e.name}),t=[...t,...e.roilist]}),t.filter(t=>t.hasOwnProperty("esdMessage")).forEach(t=>{e=[...e,...t.esdMessage]});var i=t.filter(t=>"rectangle"===t.method)[0];let n=this.record.slices.filter(t=>-1!=t.filename.indexOf("体"))[0];this.src1="/aipath/api/files/slice?x=0&y=0&z=9&caseid="+this.record.id+"&fileid="+n.id+"&companyid="+Object(s.s)().company+"&filename="+encodeURIComponent(n.filename);var a=this.record.attachments.filter(t=>-1!=t.filename.indexOf("大体病变图"));if(0!=a.length&&(this.src2=`/aipath/api/files/attachment?caseid=${this.record.id}&fileid=${a[0].id}&filename=${a[0].name}`),i){let t=this.record.slices.filter(t=>t.filename===i.filename)[0].id;this.src3="/aipath/api/files/ROI?caseid="+this.record.id+"&fileid="+t+"&filename="+encodeURIComponent(i.filename)+"&roi=[["+Math.min.apply(Math,i.path.x)+","+Math.min.apply(Math,i.path.y)+"],["+Math.max.apply(Math,i.path.x)+","+Math.max.apply(Math,i.path.y)+"]] &roiid=rectangle"+(Math.random()+"").substr(2,6)}e.forEach(t=>{"脉管癌栓"===t.title&&(this.isTumorThrombus="0"),"神经侵犯"===t.title&&(this.isNerveInvasion="0")});var o=0,r=e.map(t=>({title:t.title,length:parseFloat(t.iD)})).reduce(function(t,e){return e.title in t?t[e.title]=t[e.title]+e.length:t[e.title]=e.length,o+=e.length,t},{});if(2===Object.keys(r).length&&"高级别上皮内瘤变（包括原位癌）"in r)this.histologicalType=Object.keys(r).find(t=>"高级别上皮内瘤变（包括原位癌）"!==t);else for(var l in r){if(r[l]/o==1&&"高级别上皮内瘤变（包括原位癌）"===l){this.histologicalType="高级别上皮内瘤变（包括原位癌）";break}if(r[l]/o>=.5){this.histologicalType=l+"";break}if(r[l]/o<.5){this.histologicalType="腺癌混合型";break}}var c=t.filter(t=>t.hasOwnProperty("esdMessage")).map(t=>t.esdMessage),u=[];if(c.forEach(t=>{var e=0;t.forEach(t=>{e+=parseFloat(t.iD)}),u.push(e)}),"高级别上皮内瘤变（包括原位癌）"!==this.histologicalType){var d=h.a.clone(c);d.forEach(t=>{t.map((e,i)=>{"高级别上皮内瘤变（包括原位癌）"===e.title&&t.splice(i,1)})}),u=[],d.forEach(t=>{var e=0;t.forEach(t=>{e+=parseFloat(t.iD)}),u.push(e)})}this.mucosalWidth=(Math.max(...u)/1e3).toFixed(2);var p=[],v=[],g=[];this.record.slices.forEach(t=>{t.measure&&(p=[...p,...t.measure.map(t=>t.length)]),t.level_measure&&(v=[...v,...t.level_measure.map(t=>t.length)]),t.verticl_measure&&(g=[...g,...t.verticl_measure.map(t=>t.length)])}),p.length&&(this.mucosalHeight=(Math.max(...p)/1e3).toFixed(2)),v.length&&(this.PMH=(Math.max(...v)/1e3).toFixed(2)),g.length&&(this.PVM=(Math.max(...g)/1e3).toFixed(2))}},p={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",[i("div",{staticClass:"tct"},[i("h4",{staticClass:"title"},[t._v(t._s(t.$t("basic.cancerTypeTitle")))]),t._v(" "),i("table",[i("tr",[i("td",{attrs:{colspan:"3"}},[i("el-row",[i("el-col",{attrs:{span:3}},[i("div",{staticClass:"weight600"},[t._v(t._s(t.$t("report.location"))+":")])]),t._v(" "),i("el-col",{attrs:{span:21}},[i("div",[i("span",{staticClass:"textDecoration"},[t._v(t._s(t.$t(t.locationId)))]),i("br"),t._v(" "),t._l(t.$t("report.esdLocation"),function(e,s){return i("el-radio",{key:s,attrs:{label:e},model:{value:t.locationId,callback:function(e){t.locationId=e},expression:"locationId"}},[t._v(t._s(e)+"\n                                ")])})],2)])],1)],1)]),t._v(" "),i("tr",[i("td",{attrs:{colspan:"3"}},[i("el-row",[i("el-col",{attrs:{span:3}},[i("div",{staticClass:"weight600"},[t._v(t._s(t.$t("report.operativeMethods"))+":")])]),t._v(" "),i("el-col",{attrs:{span:21}},[i("div",[i("span",{staticClass:"textDecoration"},[t._v(t._s(t.$t(t.operativeMethodId)))]),i("br"),t._v(" "),t._l(t.$t("report.operativeMethod"),function(e,s){return i("el-radio",{key:s,attrs:{label:e},model:{value:t.operativeMethodId,callback:function(e){t.operativeMethodId=e},expression:"operativeMethodId"}},[t._v(t._s(e)+"\n                                ")])})],2)])],1)],1)]),t._v(" "),i("tr",[i("td",{attrs:{colspan:"3"}},[i("el-row",[i("el-col",{attrs:{span:3}},[i("div",{staticClass:"weight600"},[t._v(t._s(t.$t("report.specimenCompleteness"))+":")])]),t._v(" "),i("el-col",{attrs:{span:21}},[i("div",[i("span",{staticClass:"textDecoration"},[t._v(t._s(t.$t(t.specimenIntegrityId)))]),i("br"),t._v(" "),t._l(t.$t("report.specimenIntegrity"),function(e,s){return i("el-radio",{key:s,attrs:{label:e},model:{value:t.specimenIntegrityId,callback:function(e){t.specimenIntegrityId=e},expression:"specimenIntegrityId"}},[t._v(t._s(e)+"\n                                ")])})],2)])],1)],1)]),t._v(" "),i("tr",[i("td",{attrs:{colspan:"3"}},[i("el-row",[i("el-col",{attrs:{span:3}},[i("div",{staticClass:"weight600"},[t._v(t._s(t.$t("report.mucosalSize"))+":")])]),t._v(" "),i("el-col",{attrs:{span:19}},[i("div",[i("input",{directives:[{name:"model",rawName:"v-model",value:t.mucosalSize,expression:"mucosalSize"}],staticClass:"textDecoration",attrs:{type:"text"},domProps:{value:t.mucosalSize},on:{keydown:t.handleInput,input:function(e){e.target.composing||(t.mucosalSize=e.target.value)}}}),t._v(" mm\n                            ")])])],1)],1)]),t._v(" "),i("tr",[i("td",{attrs:{colspan:"3"}},[i("el-row",[i("el-col",{attrs:{span:3}},[i("div",{staticClass:"weight600"},[t._v(t._s(t.$t("report.numberofLesions"))+":")])]),t._v(" "),i("el-col",{attrs:{span:19}},[i("div",[i("input",{directives:[{name:"model",rawName:"v-model",value:t.numberofLesions,expression:"numberofLesions"}],staticClass:"textDecoration",attrs:{type:"text"},domProps:{value:t.numberofLesions},on:{input:function(e){e.target.composing||(t.numberofLesions=e.target.value)}}})])])],1)],1)]),t._v(" "),i("tr",[i("td",{attrs:{colspan:"3"}},[i("el-row",[i("el-col",{attrs:{span:3}},[i("div",{staticClass:"weight600"},[t._v(t._s(t.$t("report.lesionRange"))+":")])]),t._v(" "),i("el-col",{attrs:{span:19}},[i("div",{staticStyle:{"padding-left":"8px"}},[t._v("\n                                宽度"),i("input",{directives:[{name:"model",rawName:"v-model",value:t.mucosalWidth,expression:"mucosalWidth"}],staticClass:"textDecoration",attrs:{type:"text"},domProps:{value:t.mucosalWidth},on:{keydown:t.handleInput,input:function(e){e.target.composing||(t.mucosalWidth=e.target.value)}}}),t._v(" mm\n                                 深度"),i("input",{directives:[{name:"model",rawName:"v-model",value:t.mucosalHeight,expression:"mucosalHeight"}],staticClass:"textDecoration",attrs:{type:"text"},domProps:{value:t.mucosalHeight},on:{keydown:t.handleInput,input:function(e){e.target.composing||(t.mucosalHeight=e.target.value)}}}),t._v(" mm\n                            ")])])],1)],1)]),t._v(" "),i("tr",[i("td",{attrs:{colspan:"3"}},[i("el-row",[i("el-col",{attrs:{span:3}},[i("div",{staticClass:"weight600"},[t._v(t._s(t.$t("report.grossType"))+":")])]),t._v(" "),i("el-col",{attrs:{span:19}},[i("div",[i("span",{staticClass:"textDecoration"},[t._v(t._s(t.$t(t.grossType)))]),i("br"),t._v(" "),t._l(t.$t("report.grossTypes"),function(e,s){return i("el-radio",{key:s,attrs:{label:e},model:{value:t.grossType,callback:function(e){t.grossType=e},expression:"grossType"}},[t._v(t._s(e)+"\n                                ")])})],2)])],1)],1)]),t._v(" "),i("tr",[i("td",{attrs:{colspan:"3"}},[i("el-row",[i("el-col",{attrs:{span:3}},[i("div",{staticClass:"weight600"},[t._v(t._s(t.$t("report.histologicalType"))+":")])]),t._v(" "),i("el-col",{attrs:{span:19}},[i("div",[i("span",{staticClass:"textDecoration",staticStyle:{width:"225px"}},[t._v(t._s(t.$t(t.histologicalType)))]),i("br"),t._v(" "),t._l(t.$t("report.histologicalTypes"),function(e,s){return i("el-radio",{key:s,attrs:{label:e},model:{value:t.histologicalType,callback:function(e){t.histologicalType=e},expression:"histologicalType"}},[t._v(t._s(e)+"\n                                ")])})],2)])],1)],1)]),t._v(" "),i("tr",[i("td",{attrs:{colspan:"3"}},[i("el-row",[i("el-col",{attrs:{span:3}},[i("div",{staticClass:"weight600"},[t._v(t._s(t.$t("report.histologyGrade"))+":")])]),t._v(" "),i("el-col",{attrs:{span:19}},[i("div",[i("span",{staticClass:"textDecoration",staticStyle:{width:"225px"}},[t._v(t._s(t.$t(t.histologyGrade)))]),i("br"),t._v(" "),t._l(t.$t("report.histologyGrades"),function(e,s){return i("el-radio",{key:s,attrs:{label:e},model:{value:t.histologyGrade,callback:function(e){t.histologyGrade=e},expression:"histologyGrade"}},[t._v(t._s(e)+"\n                                ")])})],2)])],1)],1)]),t._v(" "),i("tr",[i("td",{attrs:{colspan:"3"}},[i("el-row",[i("el-col",{attrs:{span:3}},[i("div",{staticClass:"weight600"},[t._v(t._s(t.$t("report.lauren"))+":")])]),t._v(" "),i("el-col",{attrs:{span:19}},[i("div",[i("span",{staticClass:"textDecoration"},[t._v(t._s(t.$t(t.lauren)))]),i("br"),t._v(" "),t._l(t.$t("report.laurens"),function(e,s){return i("el-radio",{key:s,attrs:{label:e},model:{value:t.lauren,callback:function(e){t.lauren=e},expression:"lauren"}},[t._v(t._s(e)+"\n                                ")])})],2)])],1)],1)]),t._v(" "),i("tr",[i("td",{attrs:{colspan:"3"}},[i("el-row",[i("el-col",{attrs:{span:3}},[i("div",{staticClass:"weight600"},[t._v(t._s(t.$t("report.invasionDepth"))+":")])]),t._v(" "),i("el-col",{attrs:{span:19}},[i("div",[i("span",{staticClass:"textDecoration",staticStyle:{width:"225px"}},[t._v(t._s(t.$t(t.invasionDepth)))]),i("br"),t._v(" "),t._l(t.$t("report.invasionDepths"),function(e,s){return i("el-radio",{key:s,attrs:{label:e},model:{value:t.invasionDepth,callback:function(e){t.invasionDepth=e},expression:"invasionDepth"}},[t._v(t._s(e)+"\n                                ")])})],2),t._v(" "),i("span",{staticStyle:{"margin-left":"10px",color:"#E1E1E1"}},[t._v("如垂直切缘（+），则描述：浸润深度（mm）")])])],1)],1)]),t._v(" "),i("tr",[i("td",[i("span",{staticClass:"weight600",staticStyle:{"margin-right":"21px"}},[t._v(t._s(t.$t("report.combinedUlcer"))+":")]),t._v(" "),i("el-radio",{attrs:{label:"1"},model:{value:t.isCombinedUlcer,callback:function(e){t.isCombinedUlcer=e},expression:"isCombinedUlcer"}},[t._v("否")]),t._v(" "),i("el-radio",{attrs:{label:"0"},model:{value:t.isCombinedUlcer,callback:function(e){t.isCombinedUlcer=e},expression:"isCombinedUlcer"}},[t._v("是")])],1)]),t._v(" "),i("tr",[i("td",[i("span",{staticClass:"weight600",staticStyle:{"margin-right":"21px"}},[t._v(t._s(t.$t("report.tumorThrombus"))+":")]),t._v(" "),i("el-radio",{attrs:{label:"1"},model:{value:t.isTumorThrombus,callback:function(e){t.isTumorThrombus=e},expression:"isTumorThrombus"}},[t._v("否")]),t._v(" "),i("el-radio",{attrs:{label:"0"},model:{value:t.isTumorThrombus,callback:function(e){t.isTumorThrombus=e},expression:"isTumorThrombus"}},[t._v("是")])],1)]),t._v(" "),i("tr",[i("td",[i("span",{staticClass:"weight600",staticStyle:{"margin-right":"21px"}},[t._v(t._s(t.$t("report.nerveInvasion"))+":")]),t._v(" "),i("el-radio",{attrs:{label:"1"},model:{value:t.isNerveInvasion,callback:function(e){t.isNerveInvasion=e},expression:"isNerveInvasion"}},[t._v("否")]),t._v(" "),i("el-radio",{attrs:{label:"0"},model:{value:t.isNerveInvasion,callback:function(e){t.isNerveInvasion=e},expression:"isNerveInvasion"}},[t._v("是")])],1)]),t._v(" "),i("tr",[i("td",{attrs:{colspan:"3"}},[i("el-row",[i("el-col",{attrs:{span:3}},[i("div",{staticClass:"weight600"},[t._v(t._s(t.$t("report.wettingPattern"))+":")])]),t._v(" "),i("el-col",{attrs:{span:19}},[i("div",[i("span",{staticClass:"textDecoration",staticStyle:{width:"225px"}},[t._v(t._s(t.$t(t.wettingPattern)))]),i("br"),t._v(" "),t._l(t.$t("report.wettingPatterns"),function(e,s){return i("el-radio",{key:s,attrs:{label:e},model:{value:t.wettingPattern,callback:function(e){t.wettingPattern=e},expression:"wettingPattern"}},[t._v(t._s(e)+"\n                                ")])})],2)])],1)],1)]),t._v(" "),i("tr",[i("td",{attrs:{colspan:"3"}},[i("el-row",[i("el-col",{attrs:{span:3}},[i("div",{staticClass:"weight600"},[t._v(t._s(t.$t("report.astricMucosa"))+":")])]),t._v(" "),i("el-col",{attrs:{span:19}},[i("div",[i("span",{staticClass:"textDecoration",staticStyle:{width:"225px"}},[t._v(t._s(t.$t(t.astricMucosa)))]),i("br"),t._v(" "),t._l(t.$t("report.astricMucosas"),function(e,s){return i("el-radio",{key:s,attrs:{label:e},model:{value:t.astricMucosa,callback:function(e){t.astricMucosa=e},expression:"astricMucosa"}},[t._v(t._s(e)+"\n                                ")])})],2)])],1)],1)]),t._v(" "),i("tr",[i("td",[i("span",{staticClass:"weight600",staticStyle:{"margin-right":"21px"}},[t._v(t._s(t.$t("report.horizontalPMH"))+":")]),t._v(" "),i("el-radio",{attrs:{label:"1"},model:{value:t.horizontalPMH,callback:function(e){t.horizontalPMH=e},expression:"horizontalPMH"}},[t._v(t._s(t.$t("analyze.negative")))]),t._v(" "),i("span",{staticStyle:{"margin-left":"10px"}},[t._v(t._s(t.$t("report.nearestDistance"))+":")]),t._v(" "),i("input",{directives:[{name:"model",rawName:"v-model",value:t.PMH,expression:"PMH"}],staticClass:"textDecoration",staticStyle:{width:"80px"},attrs:{type:"text"},domProps:{value:t.PMH},on:{keydown:t.handleInput,input:function(e){e.target.composing||(t.PMH=e.target.value)}}}),t._v(" mm(+)\n                    "),i("el-radio",{attrs:{label:"0"},model:{value:t.horizontalPMH,callback:function(e){t.horizontalPMH=e},expression:"horizontalPMH"}},[t._v(t._s(t.$t("analyze.positive")))])],1)]),t._v(" "),i("tr",[i("td",[i("span",{staticClass:"weight600",staticStyle:{"margin-right":"21px"}},[t._v(t._s(t.$t("report.verticalPVM"))+":")]),t._v(" "),i("el-radio",{attrs:{label:"1"},model:{value:t.verticalPVM,callback:function(e){t.verticalPVM=e},expression:"verticalPVM"}},[t._v(t._s(t.$t("analyze.negative")))]),t._v(" "),i("span",{staticStyle:{"margin-left":"10px"}},[t._v(t._s(t.$t("report.nearestDistance"))+":")]),t._v(" "),i("input",{directives:[{name:"model",rawName:"v-model",value:t.PVM,expression:"PVM"}],staticClass:"textDecoration",staticStyle:{width:"80px"},attrs:{type:"text"},domProps:{value:t.PVM},on:{keydown:t.handleInput,input:function(e){e.target.composing||(t.PVM=e.target.value)}}}),t._v(" mm(+)\n                    "),i("el-radio",{attrs:{label:"0"},model:{value:t.verticalPVM,callback:function(e){t.verticalPVM=e},expression:"verticalPVM"}},[t._v(t._s(t.$t("analyze.positive")))])],1)]),t._v(" "),i("tr",[i("td",{attrs:{colspan:"3"}},[i("el-row",[i("el-col",{attrs:{span:3}},[i("div",{staticClass:"weight600"},[t._v(t._s(t.$t("report.others"))+":")])]),t._v(" "),i("el-col",{attrs:{span:19}},[i("div",[i("input",{directives:[{name:"model",rawName:"v-model",value:t.others,expression:"others"}],staticClass:"textDecoration",attrs:{type:"text"},domProps:{value:t.others},on:{input:function(e){e.target.composing||(t.others=e.target.value)}}})])])],1)],1)])])]),t._v(" "),i("div",{staticClass:"opinion"},[i("h4",{staticClass:"title"},[t._v(t._s(t.$t("report.remark")))]),t._v(" "),i("div",{staticClass:"opinion-write"},[i("textarea",{directives:[{name:"model",rawName:"v-model",value:t.opinion,expression:"opinion"}],attrs:{spellcheck:"false",name:"",id:"",maxlength:"300",cols:"30",rows:"10",placeholder:"备注"},domProps:{value:t.opinion},on:{change:t.changeValue,input:[function(e){e.target.composing||(t.opinion=e.target.value)},t.noEmoji]}})])]),t._v(" "),i("div",{staticClass:"esdUpload"},[i("div",{staticClass:"esdUploadItem"},[i("div",[t._v("大体原图")]),t._v(" "),""!==t.src1?i("img",{staticClass:"src-slide",attrs:{src:t.src1,alt:""}}):t._e()]),t._v(" "),i("div",{staticClass:"esdUploadItem"},[i("div",[t._v("大体病变图")]),t._v(" "),""!==t.src2?i("img",{staticClass:"src-slide",attrs:{src:t.src2,alt:""}}):t._e()]),t._v(" "),i("div",{staticClass:"esdUploadItem"},[i("div",[t._v("镜下所见")]),t._v(" "),i("img",{staticClass:"src-slide",attrs:{src:t.src3,alt:""}})])])])},staticRenderFns:[]};var v=i("VU/8")(d,p,!1,function(t){i("EIPk")},"data-v-07f99acb",null).exports,g={data:()=>({references:['Lin Yang, Peter Meer and David J. Foran, "Unsupervised analysis of imaged pathology specimens based on robust estimation and color active contour models", IEEE Transaction on Information Technology in Biomedicine (TITB), Vol. 9, No. 1, pp. 475-486, 2005.','Oncel Tuzel, Lin Yang, Peter Meer and David J. Foran, "Classification of hematologic malignancies using texton signatures", Pattern Analysis and Applications (PAA), Vol. 10, No. 4, pp. 277-290, 2007.','Lin Yang, Wenjin Chen, Peter Meer, Gratian Salaru, Viktors Berstis and David J. Foran, "Virtual microscopy and grid-enabled decision support for large scale analysis of imaged pathology specimens", IEEE Transaction on Information Technology in Biomedicine (TITB), Vol. 13, No. 4, pp. 636-644, 2009','Lin Yang, Oncel Tuzel, Wenjin Chen, Peter Meer, Gratian Salaru, Lauri A. Goodell and David J. Foran, "PathMiner: A web-based tool for computer assisted diagnostics in pathology", IEEE Transaction on Information Technology in Biomedicine (TITB). Vol. 13, No. 3, pp. 291-299, 2009','Jianqin Qu, Leiguang Gong and Lin Yang, "A 3D point matching algorithm for affine registration", International Journal of Computer Assisted Radiology and Surgery, Vol. 6, No. 2, pp. 229-236, 2010.','Lin Yang, Bogdan Georgescu, Yefeng Zheng, Wang Yang, Peter Meer and Dorin Comaniciu, "Prediction based collaborative trackers (PCT): A robust and accurate approach toward 3D medical object tracking ", IEEE Transaction on Medical Imaging (TMI), Vol. 30, No. 11, pp. 1921-1932, 2011','David J. Foran , Lin Yang, Wenjin Chen, Jun Hu, Lauri A. Goodell, Michael Reiss, Fusheng Wang, Tahsin Kurc, Tony Pan, Ashish Sharma, and Joel Saltz. "Image miner: Comparative analysis of tissue microarrays using content based image retrieval, high performance computing, and Grid technology", Journal of American Medical Information Association (JAMIA), Vol. 18, No. 4, pp. 403-415, 2011','David J. Foran, Wenjin Chen and Lin Yang, "Automated image interpretation computer-assisted diagnosis", Analytical Cellular Pathology, Vol. 34, No. 6, pp. 279-300, 2011','Xin Qi, Fuyong Xing, David J. Foran and Lin Yang, "Robust segmentation of overlapping cells in histopathology specimens using parallel seed detection and repulsive level set ", IEEE Transaction on Biomedical Engineering (TBME), Vol. 59, No. 3, pp. 754-765, 2012',"Rebekah H. Gensure, David J. Foran, Vincent M. Lee, Vyacheslav M Gendal, Salma K Jabbour, Darren R Carpizo, John L. Nosher, and Lin Yang, “Evaluation of hepatic tumor response to yttrium-90 radioembolization therapy using texture signatures generated from contrast-enhanced CT”, Academic Radiology, Vol. 19, No. 10, pp. 1201-1207, 2012.",'Xin Qi, Fuyong Xing, David J. Foran, Lin Yang, "A Fast, Automatic Segmentation Algorithm for Locating and Delineating Touching Cell Boundaries in Imaged Histopathology ", Journal of Methods in Medical Informatics, Vol. 51, No. 3, pp. 91- 102, 2012',"Xin Qi, Hyunjoo Kim, Fuyong Xing, Manish Parashar, David J. Foran, Lin Yang, “The Analysis of Image Feature Robustness Using CometCloud”, Vol. 3. No. 33, pp. 1-13, Journal of Pathology Informatics, 2012.","Baiyang Liu, Junzhou Huang, Casimir Kulikowski, Lin Yang, “Robust Visual Tracking Using Local Sparse Appearance Model and K-selection”, IEEE Transaction on Pattern Analysis and Machine Intelligence (TPAMI), Vol. 35, No. 12, pp. 2968-2981, 2013.","Joythi Mula, Jonah D. Lee, Fujun Liu, Lin Yang, Charlotte A. Peterson, “Automated Image Analysis of Skeletal Muscle Fiber Cross-sectional Area”, Journal of Applied Physiology (JAP), Vol. 114, No. 1, pp. 148-155, 2013.","Fujun Liu, Abigail L. Mackey, Ratchakrit Srikuea, Karyn Esser, Lin Yang, “Automated Image Segmentation of Hemotoxylin and Eosin Stained Skeletal Muscle Cross-Sections”, Journal of Microscopy, Vol. 253, No. 3, pp. 275-285, 2013","Hai Su, Fuyong Xing, Jonah Lee, Charlotte Peterson, Lin Yang, “Automatic Myonuclear Detection in Isolated Single Muscle Fiber Using Robust Ellipse Fitting and Sparse Optimization”, IEEE/ACM Transaction on Computational Biology and Bioinformatics (TCBB), 14 pages, 2013","Fujun Liu, Christopher S. Fry, Jyothi Mula, Janna R. Jackson, Jonah D. Lee, Charlotte A. Peterson, Lin Yang, “Automated Fiber-type-specific Cross-sectional Area Assessment and Myonuclei Counting in Skeletal Muscle”, Journal of Applied Physiology (JAP), Vol. 115, No. 11, pp. 1714-1724, 2013","Lin Yang, Xin Qi, Fuyong Xing, Tahsin Kurc, Joel Saltz, David J. Foran, “Parallel Content Based Sub-image Retrieval Using Hierarchical Searching”, Bioinformatics, Vol. 30, No. 7, pp. 996-1002, 2014",'Hui Meng, Paul M. L. Janssen, Robert W. Grange, Lin Yang, Alan H. Beggs, Lindsay C. Swanson, Stacy A. Cossette, Alison Frase, Martin K. Childers, Henk Granzier, Emanuela Gussoni, Michael W. Lawlor, "Tissue triage and freezing for models of skeletal muscle disease", Journal of Visualized Experiments (JOVE), No. 89, 2014',"Michael W. Lawlor, Marissa G. Viola, Hui Meng, Rachel V. Edelstein, Fujun Liu, Ke Yang, Elizabeth J. Luna, Alexandra Lerch-Gaggl, Raymond G. Hoffmann, Christopher R. Pierson, Anna Buj-Bello, Jennifer L. Lachey, Scott Pearsall, Lin Yang, Cecilia Hillard, Alan H. Beggs, “Differential Muscle Hypertrophy Is Associated With Satellite Cell Numbers And Akt Pathway Activation Following Activin Type IIB Receptor Inhibition In Mtm1 p.R69C Mice”, American Journal of Pathology, Vol. 184, No. 6, pp. 1831-1842, 2014","Hongyuan Wang, Fuyong Xing, Hai Su, Arnold Stromberg, and Lin Yang, “Novel image markers for non-small cell lung cancer classification and survival prediction”, BMC Bioinformatics, Vol. 19, No. 15, pp. 310-324, 2014.","Xin Qi, Daihou Wang, Ivan Rodero, Javier Diaz-Montes, Rebekah H Gensure, Fuyong Xing, Hua Zhong, Lauri Goodell, Manish Parashar, David J Foran, Lin Yang, “Content-based histopathology image retrieval using CometCloud”, BMC Bioinformatics, Vol. 15, pp. 287-300, 2014",'Sandra Donkervoort, Ying Hu, Tanya Stojkovic, Nicol Voermans, A. Reghan Foley, Meganne E Leach, Jahannaz Dastgir, Veronique Bolduc, Thomas Cullup, Alix de Becdelievre, Lin Yang, Hai Su, Katherine Meilleur, Alice Schindler, Erik-Jan Kamsteeg, Pascale Richard, Russell Butterfield, Thomas L. Winder, Thomas Crawford, Robert B. Weiss, Francesco Muntoni, Valerie Allamand, Carsten G. Bonnemann, "Mosaicism for dominant COLVI mutations as a cause for intra-familial phenotypic variability", Human Mutation, Vol. 36, No. 1, pp. 48-56, 2014','Michael Spencer, Lin Yang, Akosua Adu, Brian S. Finlin, Beibei Zhu, Lindsey R. Shipp, Neda Rasouli, Charlotte A. Peterson, Philip Kern, "Pioglitazone treatment reduces adipose tissue inflammation through reduction of mast cell and macrophage number and by improving vascularity", PLOS ONE, Vol. 9, No. 7, 2014.','Nicolas Wein, Adeline Vulin, Maria Sofia Falzarano, Christina Al-Khalili Szigyarto, Baijayanta Maiti, Andrew Findlay, Kristin H. Heller, Mathias Uhlen, Baskar Bakthavachalu, Sonia Messina, Giuseppe Vita, Chiara Passarelli, Francesca Gualandi, Steve D. Wilton, Louise Rodino-Klapec, Lin Yang, Diane M. Dunn, Daniel Schoenberg, Robert B. Weiss, Michael T. Howard, Alessandra Ferlini, Kevin M. Flanigan, "A novel DMD IRES results in a functional N-truncated dystrophin, providing a potential route to therapy for patients with 5’ mutations", Nature Medicine, Vol. 20, No. 9, pp. 992-1000, 2014.',"Fuyong Xing, Hai Su, Janna Neltner, Lin Yang, “Automatic Ki-67 Counting Using Robust Cell Detection and Online Dictionary Learning”, IEEE Transaction on Biomedical Engineering (TBME), Vol. 61, No. 3, pp. 859-870, 2014",'Christopher S. Fry, Jonah D. Lee, Jyothi Mula, Tyler J. Kirby, Janna R. Jackson, Fujun Liu, Lin Yang, Esther E. Dupont-Versteegden, John J. McCarthy, Charlotte A. Peterson, "Inducible depletion of satellite cells in adult, sedentary mice impairs muscle regenerative capacity without affecting sarcopenia", Nature Medicine, Vol. 21, pp. 76-80, 2015.','Xiaofan Zhang, Fuyong Xing, Hai Su, Lin Yang, Shaoting Zhang, "High throughput histopathology image analysis via robust cell segmentation and hashing", Medical Image Analysis, Vol. 26, No. 1, pp. 306-315, 2015.',"Tahsin Kurc, Xin Qi, Daihou Wang, Fusheng Wang, George Teodoro, Lee Cooper, Michael Nalisnik, Lin Yang, Joel Saltz, David J Foran, “Scalable Analysis of Big Pathology Image Data Cohorts using Efficient Methods and High-Performance Computing Strategies”, BMC Bioinformatics, Vol. 16, No. 399, 2015","Hai Su, Fuyong Xing, Lin Yang, “Robust cell detection of histopathological brain tumor images using sparse reconstruction and adaptive dictionary selection”, IEEE Transaction on Medical Imaging, Vol. 35, No. 6, 2016.","Fuyong Xing, Lin Yang, “An automatic learning-based framework for robust nucleus segmentation”, IEEE Transaction on Medical Imaging, Vol. 35, No. 2, pp. 550-566, 2016.","Fuyong Xing, Lin Yang, “Robust nucleus/cell detection and segmentation for digital pathology and microscopic images: A comprehensive review”, IEEE Reviews in Biomedical Engineering, No. 9, pp. 234-263, 2016.","Xiaoshuang Shi, Zhenhuo Guo, Feiping Nie, Lin Yang, Jane You, and Dacheng Tao, “Two-dimensional whitening reconstruction for enhancing robustness of principle component analysis”, IEEE Transaction on Pattern Analysis and Machine Intelligence, Vol. 38, No. 10, pp. 2130-2136, 2016","Manish Sapkota, Fujun Liu, Yuanpu Xie, Hai Su, Fuyong Xing, Lin Yang, “AIIMD: An integrated framework of automatic idiopathic inflammatory myopathy diagnosis for muscle”, IEEE Journal of Biomedical and Health Informatics, 2017","Yuanpu Xie, Fuyong Xing, Xiaoshuang Shi, Xiaofei Kong, Hai Su, Lin Yang, “Efficient and robust cell detection: A structured regression approach”, Medical Image Analysis, 2017","Xiaoshuang Shi, Fuyong Xing, Kaidi Xu, Yuanpu Xie, Hai Su, Lin Yang, “Supervised graph hashing for histopathology image retrieval and classification”, Medical Image Analysis, Vol. 22, pp. 117-128, 2017","Zizhao Zhang, Fuyong Xing, Xiaoshuang Shi, Lin Yang, “Revisiting Graph Construction for Fast Image Segmentation”, Pattern Recognition (PR), 2018","Yuanpu Xie, Fuyong Xing, Lin Yang, “Deep Voting and Structured Regression for Microscopy Image Analysis” In Deep Learning for Medical Image Analysis (pp. 155-175), 2018",'Xiaoshuang Shi, Manish Sapkota, Fuyong Xing, Fujun Liu, Lei Cui, Lin Yang, "Pairwise based deep ranking hashing for histopathology image classification and retrieval", accepted to Pattern Recognition, 2018',"Xiaoshuang Shi, Fuyong Xing, Jinzheng Cai, Lin Yang, “Self-learning for face clustering”, accepted to Pattern Recognition, 2018",'Lin Yang, Peter Meer and David J. Foran, "Multiple class segmentation using a unified framework over mean-shift patches", Proc. IEEE International Conference on Computer Vision and Pattern Recognition (CVPR), Vol. 1, pp. 1-8, June 2007.','Lin Yang, Wenjin Chen, Peter Meer, Gratian Salaru, Michael D. Feldman and David J. Foran, "High throughput analysis of breast cancer specimens on the Grid", Proc. International Conference on Medical Image Computing and Computer Assisted Intervention (MICCAI), Vol. 10, pp. 617-625, 2007.','Lin Yang, Bogdan Georgescu, Yefeng Zheng, David J. Foran and Dorin Comaniciu. "A fast and accurate tracking algorithm of left ventricles in 3D echocardiography", Proc. International Symposium on Biomedical Imaging (ISBI), Vol. 5, pp. 221-224, 2008.','Lin Yang, Bogdan Georgescu, Yefeng Zheng, Peter Meer and Dorin Comaniciu, "3D Ultrasound tracking of the left ventricle using one-step forward prediction and data fusion of collaborative trackers", Proc. IEEE International Conference on Computer Vision and Pattern Recognition (CVPR), Vol. 1, pp. 1-8, 2008.','Lin Yang, Oncel Tuzel, Peter Meer and David J. Foran, "Automatic image analysis of histopathology specimens using concave vertex graph", Proc. International Conference on Medical Image Computing and Computer Assisted Intervention (MICCAI), Vol. 11, pp. 833-841, 2008.','Hong Zhang, Lin Yang, David J. Foran, John Nosher, Peter Yim, "3D segmentation of the liver using free-form deformation based on boosting and deformation gradients", Proc. IEEE International Symposium on Biomedical Imaging (ISBI), Vol. 1, pp. 494-497, 2009.','David J. Foran, Lin Yang, Oncel Tuzel, Wenjin Chen, Jun Hu, Tahsin Kurc, Renato Ferreira, Joel Saltz, "A caGrid-enabled, learning based image segmentation method for histopathology specimens", Proc. IEEE International Symposium on Biomedical Imaging (ISBI), Vol. 1, pp. 1306-1309, 2009.','Baiyang Liu, Lin Yang, Casimir Kulikowski, Jinghao Zhou, Leiguang Gong, David J. Foran, Salma J. Jabbour and Ning J. Yue. "An adaptive tracking algorithm of lung tumors in fluoroscopy using online learned collaborative trackers ", IEEE International Symposium on Biomedical Imaging (ISBI), Vol. 1, pp. 209-212, 2010','Baiyang Liu, Lin Yang, Junzhou Huang, P. Meer, Leiguang Gong, Casimir Kulikowski, "Robust and fast visual tracking with two stage sparse optimization", European Conference on Computer Vision (ECCV), Vol. 6314, pp. 624-637, 2010','Tahsin Kurc, Patrick Widener, Wenjin Chen, Fusheng Wang, Lin Yang, Jun Hu, Vijay Kumar, Vicky Chu, Lee Cooper, Jun Kong, Ashish Sharma, Tony Pan, Joel Saltz, David Foran, "Grid-enabled, high-performance microscopy image analysis", High Performance Computing (HP) workshop associated with Proc. International Conference on Medical Image Computing and Computer Assisted Intervention (MICCAI), Beijing, China, 2010','Xin Qi, Fuyong Xing, David J. Foran and Lin Yang, "GPU enabled parallel touching cell segmentation using mean shift based seed detection and repulsive level set", High Performance Computing (HP) workshop associated with Proc. International Conference on Medical Image Computing and Computer Assisted Intervention (MICCAI), Beijing, China, 2010','Xin Qi, Hyunjoo Kim, Fuyong Xing, Manish Parashar, David Foran and Lin Yang, "The Analysis of Image Texture Feature Robustness Using CometCloud", High Performance Computing (HP) Workshop associated with Proc. International Conference on Medical Image Computing and Computer Assisted Intervention (MICCAI), Toronto, Canada, 2011','Lin Yang, Hyunjoo Kim, Manish Parashar and David Foran, "High Throughput Landmark Based Image Registration Using Cloud Computing", High Performance Computing (HP) workshop associated with Proc. International Conference on Medical Image Computing and Computer Assisted Intervention (MICCAI), Toronto, Canada, 2011','Baiyang Liu, Junzhou Huang, Casimir Kulikowski, Lin Yang, "Robust tracking using local sparse appearance model and K-Selection", Proc. IEEE International Conference on Computer Vision and Pattern Recognition (CVPR), Vol. 1, pp. 1-8, 2011',"Xin Qi, Fuyong Xing, Meghana Ghadge, Ivan Rodero, Moustafa Abdelbaky, Manish Parashar, Evita Sadimin, David Foran, Lin Yang, “Content-based Image Retrieval on Imaged Peripheral Blood Smear Specimens using High Performance Computation”, Data- and Compute-intensive Clinical and Translation Imaging associated with the International Conference on Medical Image Computing and Computer Assisted Intervention (MICCAI), Nice, France, 2012","Fuyong Xing, Xin Qi, David Foran, Tahsin Kurc, Joel Saltz, Lin Yang, “Content-based Parallel Sub-image Retrieval”, Data- and Compute-intensive Clinical and Translation Imaging associated with the International Conference on Medical Image Computing and Computer Assisted Intervention (MICCAI), Nice, France, 2012","Fuyong Xing, Lin Yang, “Robust non-small cell lung cancer classification using molecular morphological features”, International Symposium on Biomedical Imaging (ISBI), 2013","Hai Su, Fuyong Xing, Jonah Lee, Charlotte Peterson, Lin Yang, “Learning based automatic detection of myonuclei in isolated single skeletal muscle fibers using multi-focus image fusion”, International Symposium on Biomedical Imaging (ISBI), 2013","Fuyong Xing, Lin Yang, “Robust Selection-based Sparse Shape Model for Lung Cancer Image Segmentation”, The 16th International Conference on Medical Image Computing and Computer Assisted Intervention (MICCAI), Nagoya, Japan, 2013","Fuyong Xing, Hai Su, Lin Yang, “An Integrated Framework for Automatic Ki-67 Scoring in Pancreatic Neuroendocrine Tumor”, The 16th International Conference on Medical Image Computing and Computer Assisted Intervention (MICCAI), Nagoya, Japan, 2013","Xin Qi, Daihou Wang, Javier Diaz-Montes, Ivan Rodero, Tony Pan, Abulimit Aji, Lee Cooper, Fuyong Xing, Manish Parashar, David J. Foran, Lin Yang, “Exploring Online Nuclear Segmentation on Large Fluorescence Brain Tumor Images Using CometCloud”, Accepted to the Six High Performance Computing Workshop Associated with The 16th International Conference on Medical Image Computing and Computer Assisted Intervention (MICCAI), Nagoya, Japan, 2013","Daihou Wang, Xin Qi, Manish Parashar, David J. Foran, Lin Yang, “High Throughput Content-based Image Retrieval Using GPGPU”, Accepted to the Six High Performance Computing Workshop Associated with The 16th International Conference on Medical Image Computing and Computer Assisted Intervention (MICCAI), Nagoya, Japan, 2013","Manish Sapkota, Fujun Liu, Lin Yang, “Distributed Content Based Image Retrieval for Skeletal Muscle Images Using Kd-Tree and MapReduce”, Accepted to the Six High Performance Computing Workshop Associated with The 16th International Conference on Medical Image Computing and Computer Assisted Intervention (MICCAI), Nagoya, Japan, 2013","Fujun Liu, Fuyong Xing, Lin Yang, “Robust muscle cell segmentation using region selection with dynamic programming”, Accepted to 2014 International Symposium on Biomedical Imaging (ISBI), 2014","Fujun Liu, Fuyong Xing, Hai Su, Lin Yang, “Touching adipocyte cells decomposition using combinatorial optimization”, Accepted to 2014 International Symposium on Biomedical Imaging (ISBI), 2014","Xiaofan Zhang, Lin Yang, Wei Liu, Hai Su, Shaoting Zhang, “Mining histopathology images via composite hashing and online learning”, Accepted to The 17th International Conference on Medical Image Computing and Computer Assisted Intervention (MICCAI), Boston, MA, U. S. A., 2014","Fuyong Xing, Manish Sapkota, Lin Yang, “Histopathology lung cancer image mining with Kd-tree and MapReduce”, Accepted to the Seventh High Performance Computing Workshop Associated with The 16th International Conference on Medical Image Computing and Computer Assisted Intervention (MICCAI), Boston, MA, U. S. A. 2014","Daihou Wang, Manuel Diaz Granados, Javier Diaz-Montes, Ivan Rodero, Lin Yang, Manish Parashar, David J. Fordan, Xin Qi, “High-throughput Automatic Gleason-grading System for Prostate Histopathology Images using CometCloud”, Accepted to the Seventh High Performance Computing Workshop Associated with The 16th International Conference on Medical Image Computing and Computer Assisted Intervention (MICCAI), Boston, MA, U. S. A. 2014",'Hai Su, Fujun Liu, Yuanpu Xie, Fuyong Xing, Sreenivasan Meyyappan, Lin Yang, "Region segmentation in histopathological breast cancer images using deep convolutional neural network", Accepted to the 2015 International Symposium on Biomedical Imaging (ISBI), 2015','Fuyong Xing, Lin Yang, "Unsupervised shape prior modeling for cell segmentation in neuroendocrine tumor", Accepted to the 2015 International Symposium on Biomedical Imaging (ISBI), 2015','Manish Sapkota, Fuyong Xing, Hai Su, Lin Yang, "Automatic muscle perimysium annotation using deep convolutional neural network", Accepted to the 2015 International Symposium on Biomedical Imaging (ISBI), 2015',"Xiaofan Zhang, Hai Su, Lin Yang, Shaoting Zhang, “Weighted hashing with multiple cues for cell-level analysis of histopathology images”, Accepted to the 2015 International 24th Biennial International Conference on Information Processing in Medical Imaging (IPMI), 2015","Xiaofan Zhang, Hai Su, Lin Yang, Shaoting Zhang, “Scalable analysis of histopathology images via robust cellular segmentation and weighted hashing”, Accepted to the 2015 International Conference on Computer Vision and Patter Recognition (CVPR), 2015","Fuyong Xing, Lin Yang, “Fast Cell Segmentation Using Scalable Sparse Manifold Learning and Affine Transform-approximated Active Contour”, Accepted to The 18th International Conference on Medical Image Computing and Computer Assisted Intervention (MICCAI), Munich, Germany, 8 pages, 2015","Fujun Liu, Fuyong Xing, Zizhao Zhang, Mason Mcgough, Lin Yang, “Robust Muscle Cell Quantification Using Structured Edge Detection and Hierarchical Segmentation”, Accepted to The 18th International Conference on Medical Image Computing and Computer Assisted Intervention (MICCAI), Munich, Germany, 8 pages, 2015","Fujun Liu, Lin Yang, “A Novel Cell Detection Method Using Deep Convolutional Neural Network and Maximum-Weight Independent Set”, Accepted to The 18th International Conference on Medical Image Computing and Computer Assisted Intervention (MICCAI), Munich, Germany, 8 pages, 2015","Yuanpu Xie, Fuyong Xing, Xiangfei Kong, Hai Su, Lin Yang, “Beyond Classification: Structured Regression For Robust Cell Detection Using Convolutional Neural Network”, Accepted to The 18th International Conference on Medical Image Computing and Computer Assisted Intervention (MICCAI), Munich, Germany, 8 pages, 2015","Yuanpu Xie, Xiangfei Kong, Fuyong Xing, Fujun Liu, Hai Su, Lin Yang, “Deep Voting: A Robust Approach Towards Nucleus Localization In Microscopy Images”, Accepted to The 18th International Conference on Medical Image Computing and Computer Assisted Intervention (MICCAI), Munich, Germany, 8 pages, 2015","Hai Su, Fuyong Xing, Xiangfei Kong, Yuanpu Xie, Shaoting Zhang, Lin Yang, “Robust Cell Detection and Segmentation in Histopathological Images using Sparse Reconstruction and Stacked Denoising Autoencoders”, Accepted to The 18th International Conference on Medical Image Computing and Computer Assisted Intervention (MICCAI), Munich, Germany, 8 pages, 2015","Menglin Jiang, Shaoting Zhang, Junzhou Huang, Lin Yang, Dimitris Metaxas, “Joint Kernel-Based Supervised Hashing for Scalable Histopathological Image Analysis”, Accepted to The 18th International Conference on Medical Image Computing and Computer Assisted Intervention (MICCAI), Munich, Germany, 8 pages, 2015",'Yuanpu Xie, Zizhao Zhang, Manish Sapkota, Lin Yang, "Spatial Clockwork Recurrent Neural Network for Muscle Perimysium Segmentation", Accepted to The 19th International Conference on Medical Image Computing and Computer Assisted Intervention (MICCAI), 2016.','Fuyong Xing, Xiaoshuang Shi, Zizhao Zhang, Jinzheng Cai, Yuanpu Xie, Lin Yang, "Transfer Shape Priors Towards High-throughput Microscopy Image Segmentation", Accepted to The 19th International Conference on Medical Image Computing and Computer Assisted Intervention (MICCAI), 2016.','Jinzheng Cai, Le Lu, Qian Yin, Zizhao Zhang, Fuyong Xing, Lin Yang, "Pancreas Segmentation using Graph based Data Fusion with Convolutional Neural Networks", Accepted to The 19th International Conference on Medical Image Computing and Computer Assisted Intervention (MICCAI), 2016.','Zizhao Zhang, Fuyong Xing, Xiaoshuang Shi, Lin Yang, "SemiContour: A semi-supervised learning approach for contour detection", IEEE International Conference on Computer Vision and Pattern Recognition (CVPR), 2016','Xiaoshuang Shi, Fuyong Xing, Jinzheng Cai, Zizhao Zhang, Yuanpu Xie, Lin Yang, "Kernel-based supervised discrete hashing for image retrieval", European Conference on Computer Vision (ECCV), 2016.','Zizhao Zhang, Yuanpu, Xie, Fuyong Xing, Mason Mcgough, Lin Yang, "MDNet: A Semantically and Visually Interpretable Medical Image Diagnosis Network", IEEE Conference on Computer Vision and Pattern Recognition (CVPR), 2017 oral (2.7% acceptance rate)','Zizhao Zhang, Pingjun Chen, Manish Sapkota, Lin Yang, "TandemNet: Distilling Knowledge from Medical Images Using Diagnostic Reports as Optional Semantic References", International Conference on Medical Image Computing and Computer Assisted Intervention (MICCAI), 2017 oral (3.6% acceptance rate)','Xiaoshuang Shi, Fuyong Xing, Kaidi Xu, Manish Sapkota, Lin Yang, "Asymmetric discrete graph hashing", The thirty-first AAAI conference on Artificial Intelligence (AAAI), 2017','Jinzheng Cai, Le Lu, Yuanpu Xie, Fuyong Xing, Lin Yang, "Improving deep pancreas segmentation in CT and MRI image via recurrent neural contextual learning and direct loss function", International Conference on Medical Image Computing and Computer Assisted Intervention (MICCAI), 2017','Xiaoshuang Shi, Fuyong Xing, Yuanpu Xie, Lin Yang, "Cell encoding for histopathology image classification", International Conference on Medical Image Computing and Computer Assisted Intervention (MICCAI), 2017',"Zizhao Zhang*, Yuanpu Xie*, Lin Yang, “Photographic Text-to-Image Synthesis with a Hierarchically-nested Adversarial Network”, International Conference on Computer Vision and Pattern Recognition (CVPR), 2018, Spotlight (~8%) * indicates equal contribution","Zizhao Zhang, Lin Yang, Y. Zheng, “Translating and Segmenting Multimodal Medical Volumes with Cycle- and Shape-Consistency Generative Adversarial Network”, International Conference on Computer Vision and Pattern Recognition (CVPR), 2018",'Mehmet Celenk, Lin Yang, Ganti Kamalakar, Derek J. Bleyle, Sudhir K. Sunkara, Yufei Wang, Philip Prudich, Yuangcui Huang and Qiang Zhou, "Tumor detection in VIVO NIRF imaging", Vol. 5370, SPIE International Symposium on Medical Imaging (SPIE), 2004.','Lin Yang, Jundong Liu, Charles D. Cavanaugh and Lonnie R. Welch, "A robust QoS forecasting algorithm for a dynamic, distributed real-time testbed", Proc. IEEE International Workshop on Computer Architectures for Machine Perception (WCAMP), New Orleans, LA, May, 2003','Lin Yang, Jundong Liu, Charles D. Cavanaugh and Lonnie R. Welch, "A L2E-based QoS forecasting technique for dynamic, distributed real-time systems", Proc. International Conference on Parallel and Distributed Processing Techniques and Applications (PDPTA), 2004.','Dazhang Gu, Lin Yang and Lonnie R. Welch. "A predictive, decentralized load balancing approach", 19th Proc. IEEE International Parallel and Distributed Processing Symposium (IPDPS), Vo1. 1, pp. 101-110, 2005.','Lin Yang and David J. Foran. "A variational framework for partially occluded image segmentation using coarse to fine shape alignment and semi-parametric density approximation", Proc. IEEE International Conference on Image Processing (ICIP), Vol. 1, pp. 78-82, 2007.','Lin Yang, Leiguang Gong, Hong Zhang, John L. Nosher and David J. Foran, "A multicore based parallel image registration method", Proc. International Conference on Engineering in Medicine and Biology Society (EMBS), Vol. 1, pp. 98-101, 2009.','Lin Yang, Leiguang Gong, Hong Zhang, John L. Nosher and David J. Foran, "A parallel point matching algorithm for landmark based image registration using multicore platform", European Conference on Parallel Computing (Euro-par), Vol. 5704, pp. 936-947, 2009.','Hyunjoo Kim, Manish Parashar, David J. Foran and Lin Yang, "Investigating the use of automatic cloudbursts for high-throughput medical image registration", IEEE International Conference on Grid Computing (GRID), Vol. 1, pp. 34-41, 2009.','Fuyong Xing, Baiyang Liu, Xin Qi, David J. Foran and Lin Yang, "Digital tissue microarray classification using sparse reconstruction", SPIE International Symposium on Medical Imaging (SPIE), 2012',"Hai Su, Yong Shen, Fuyong Xing, Xin Qi, Kim M. Hirshfield, Lin Yang, and David J. Foran, “Robust automatic breast cancer staging using a combination of functional genomics and image-omics”, Proc. International Conference on Engineering in Medicine and Biology Society (EMBS), accepted, 5 pages, 2015"]})},f={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",[i("h4",{staticClass:"reference"},[t._v(t._s(t.$t("report.references")))]),t._v(" "),i("ul",t._l(t.references,function(e,s){return i("li",{key:s,staticClass:"refer-items"},[t._v("\n            "+t._s(s+1+".")+t._s(e)+"\n        ")])}),0)])},staticRenderFns:[]};var m=i("VU/8")(g,f,!1,function(t){i("c3E9")},"data-v-8dd6c664",null).exports,_={props:["basic"],computed:{gender:()=>"zh"==i18n.locale?{"男":"男","女":"女","其他":"其他"}:{"男":"M","女":"F","其他":"O"}},methods:{noEmoji(t){t.target.value=t.target.value.replace(/[^\u0020-\u007E\u00A0-\u00BE\u2E80-\uA4CF\uF900-\uFAFF\uFE30-\uFE4F\uFF00-\uFFEF\u0080-\u009F\u2000-\u201f\u2026\u2022\u20ac\r\n]/g,"")}}},y={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"person-info"},[i("h4",{staticClass:"title"},[t._v(t._s(t.$t("basic.basic")))]),t._v(" "),i("table",[i("tr",{attrs:{valign:"top"}},[i("td",{attrs:{width:"35%"}},[i("span",{staticClass:"weight600"},[t._v("姓名：")]),t._v(" "),i("input",{directives:[{name:"model",rawName:"v-model",value:t.basic.name,expression:"basic.name"}],attrs:{type:"text"},domProps:{value:t.basic.name},on:{input:function(e){e.target.composing||t.$set(t.basic,"name",e.target.value)}}})]),t._v(" "),i("td",{attrs:{width:"35%"}},[i("span",{staticClass:"weight600"},[t._v(t._s(t.$t("basic.sex")))]),t._v(" "),i("el-select",{model:{value:t.basic.gender,callback:function(e){t.$set(t.basic,"gender",e)},expression:"basic.gender"}},[i("el-option",{attrs:{label:"男",value:"男"}}),t._v(" "),i("el-option",{attrs:{label:"女",value:"女"}}),t._v(" "),i("el-option",{attrs:{label:"其他",value:"其他"}})],1)],1),t._v(" "),i("td",[i("span",{staticClass:"weight600"},[t._v(t._s(t.$t("basic.age")))]),t._v(" "),i("input",{directives:[{name:"model",rawName:"v-model",value:t.basic.age,expression:"basic.age"}],staticStyle:{width:"100px"},attrs:{type:"text",maxlength:"3"},domProps:{value:t.basic.age},on:{input:[function(e){e.target.composing||t.$set(t.basic,"age",e.target.value)},function(e){t.noEmoji,t.basic.age=t.basic.age.replace(/[^\d]/g,"")&&parseInt(t.basic.age.replace(/[^\d]/g,""))}]}})])]),t._v(" "),i("tr",{attrs:{valign:"top"}},[i("td",[i("span",{staticClass:"weight600"},[t._v(t._s(t.$t("basic.sampleCollectDate")))]),t._v(" "),i("el-date-picker",{attrs:{type:"date","value-format":"yyyy-MM-dd"},model:{value:t.basic.sampleCollectDate,callback:function(e){t.$set(t.basic,"sampleCollectDate",e)},expression:"basic.sampleCollectDate"}})],1),t._v(" "),i("td",[i("span",{staticClass:"weight600"},[t._v("样本号：")]),t._v(" "),i("input",{directives:[{name:"model",rawName:"v-model",value:t.basic.caseid,expression:"basic.caseid"}],staticStyle:{width:"140px"},attrs:{type:"text"},domProps:{value:t.basic.caseid},on:{input:function(e){e.target.composing||t.$set(t.basic,"caseid",e.target.value)}}})]),t._v(" "),i("td",[i("span",{staticClass:"weight600"},[t._v(t._s(t.$t("basic.samplePart")))]),t._v(" "),i("input",{directives:[{name:"model",rawName:"v-model",value:t.basic.samplePart,expression:"basic.samplePart"}],staticStyle:{width:"100px"},attrs:{type:"text"},domProps:{value:t.basic.samplePart},on:{input:function(e){e.target.composing||t.$set(t.basic,"samplePart",e.target.value)}}})])]),t._v(" "),i("tr",{attrs:{valign:"top"}},[i("td",[i("span",{staticClass:"weight600"},[t._v("送检医院：")]),t._v(" "),i("input",{directives:[{name:"model",rawName:"v-model",value:t.basic.inspectionHospital,expression:"basic.inspectionHospital"}],attrs:{type:"text",maxlength:"24"},domProps:{value:t.basic.inspectionHospital},on:{input:function(e){e.target.composing||t.$set(t.basic,"inspectionHospital",e.target.value)}}})]),t._v(" "),i("td",{attrs:{colspan:"2"}},[i("span",{staticClass:"weight600"},[t._v("送检医生：")]),t._v(" "),i("input",{directives:[{name:"model",rawName:"v-model",value:t.basic.inspectionDoctor,expression:"basic.inspectionDoctor"}],attrs:{type:"text"},domProps:{value:t.basic.inspectionDoctor},on:{input:function(e){e.target.composing||t.$set(t.basic,"inspectionDoctor",e.target.value)}}})])]),t._v(" "),i("tr",{attrs:{valign:"top"}},[i("td",{staticStyle:{"padding-top":"10px"},attrs:{colspan:"3"}},[i("span",{staticClass:"weight600",staticStyle:{"vertical-align":"top"}},[t._v(t._s(t.$t("basic.cancerType")))]),t._v(" "),i("textarea",{directives:[{name:"model",rawName:"v-model",value:t.basic.cancerType,expression:"basic.cancerType"}],domProps:{value:t.basic.cancerType},on:{input:function(e){e.target.composing||t.$set(t.basic,"cancerType",e.target.value)}}})])])])])},staticRenderFns:[]};var R=i("VU/8")(_,y,!1,function(t){i("kcF8")},"data-v-2c6b5598",null).exports,b={props:["slices","recordId","type","roishow","modeType"],data:()=>({showRoi:[],dna2List:[],reportTypeMode:window.reportTypeMode}),methods:{stateChange(){this.$emit("roiState")},async editRemark(t,e){e.includes("tct")||e.includes("lct")?await Object(s.e)(this.recordId,t.fileid,e.replace(/[0-9]/g,""),[{id:t.id,remark:t.remark}],null):await Object(s.e)(this.recordId,t.fileid,e,[{id:t.id,remark:t.remark}],null)},checkData(){let t=[...this.slices.dna],e=[];t.length&&(e=t.filter(t=>"dnaIcon"!=t.iconType)),this.showRoi=[...this.slices.human,...e],this.dna2List=e}},watch:{slices:{immediate:!0,deep:!0,handler(t){this.slices=t,"dna"==this.modeType&&this.checkData()}},modeType:{immediate:!0,deep:!0,handler(t){this.modeType=t}}},mounted(){"dna"==this.modeType&&this.checkData()}},C={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"microscope"},[i("h4",{staticClass:"title slice"},[t._v(t._s(t.$t("report.microscope")))]),t._v(" "),t.slices.human&&t.slices.human.length||t.slices.tct&&t.slices.tct.length||t.slices.dna&&t.slices.dna.length?i("button",{staticClass:"showhide",on:{click:t.stateChange}},[t._v(t._s(t.roishow?"展示切片名称":"隐藏切片名称"))]):t._e(),t._v(" "),"dna"!==t.modeType||"double"==t.reportTypeMode?i("div",{staticClass:"slices"},[t.slices.human&&t.slices.human.length?i("div",{staticClass:"card"},[i("p",{staticClass:"result"},[t._v(t._s(t.$t("report.handwork")))]),t._v(" "),i("div",t._l(t.slices.human,function(e,s){return i("div",{key:s,staticClass:"slice-list clearfix"},[i("div",{staticClass:"fleft"},[i("img",{attrs:{src:"/aipath/api/files/ROI?caseid="+t.recordId+"&fileid="+e.fileid+"&filename="+encodeURIComponent(e.filename)+"&roi=[["+Math.min.apply(Math,e.path.x)+","+Math.min.apply(Math,e.path.y)+"],["+Math.max.apply(Math,e.path.x)+","+Math.max.apply(Math,e.path.y)+"]] &roiid="+e.id,alt:""}})]),t._v(" "),t.roishow?t._e():i("div",{staticClass:"slice-name"},[t._v("切片名称："+t._s(e.filename))]),t._v(" "),i("div",{staticClass:"fright"},[i("textarea",{directives:[{name:"model",rawName:"v-model",value:e.remark,expression:"roi.remark"}],attrs:{maxlength:"300",name:"",placeholder:t.$t("report.remarkremind")},domProps:{value:e.remark},on:{blur:function(i){return t.editRemark(e,e.type)},input:function(i){i.target.composing||t.$set(e,"remark",i.target.value)}}})])])}),0)]):t._e(),t._v(" "),"dna"!=t.modeType&&t.slices.tct&&t.slices.tct.length?i("div",{staticClass:"card"},[i("p",{staticClass:"result"},[t._v("AI处理结果")]),t._v(" "),i("div",t._l(t.slices.tct,function(e,s){return i("div",{key:s,staticClass:"slice-list clearfix"},[i("div",{staticClass:"fleft"},[i("img",{attrs:{src:"/aipath/api/files/ROI?caseid="+t.recordId+"&fileid="+e.fileid+"&filename="+encodeURIComponent(e.filename)+"&roi=[["+Math.min.apply(Math,e.path.x)+","+Math.min.apply(Math,e.path.y)+"],["+Math.max.apply(Math,e.path.x)+","+Math.max.apply(Math,e.path.y)+"]] &roiid="+e.id,alt:""}})]),t._v(" "),t.roishow?t._e():i("div",{staticClass:"slice-name"},[t._v("切片名称："+t._s(e.filename))]),t._v(" "),i("div",{staticClass:"fright"},[i("textarea",{directives:[{name:"model",rawName:"v-model",value:e.remark,expression:"roi.remark"}],attrs:{maxlength:"300",name:"",placeholder:t.$t("report.remarkremind")},domProps:{value:e.remark},on:{blur:function(i){return t.editRemark(e,t.type)},input:function(i){i.target.composing||t.$set(e,"remark",i.target.value)}}})])])}),0)]):t._e(),t._v(" "),"dna"==t.modeType&&t.dna2List&&t.dna2List.length?i("div",{staticClass:"card"},[i("p",{staticClass:"result"},[t._v("AI处理结果")]),t._v(" "),i("div",t._l(t.dna2List,function(e,s){return i("div",{key:s,staticClass:"slice-list clearfix"},[i("div",{staticClass:"fleft"},[i("img",{attrs:{src:"/aipath/api/files/ROI?caseid="+t.recordId+"&fileid="+e.fileid+"&filename="+encodeURIComponent(e.filename)+"&roi=[["+Math.min.apply(Math,e.path.x)+","+Math.min.apply(Math,e.path.y)+"],["+Math.max.apply(Math,e.path.x)+","+Math.max.apply(Math,e.path.y)+"]] &roiid="+e.id,alt:""}})]),t._v(" "),t.roishow?t._e():i("div",{staticClass:"slice-name"},[t._v("切片名称："+t._s(e.filename))]),t._v(" "),i("div",{staticClass:"fright"},[i("textarea",{directives:[{name:"model",rawName:"v-model",value:e.remark,expression:"roi.remark"}],attrs:{maxlength:"300",name:"",placeholder:t.$t("report.remarkremind")},domProps:{value:e.remark},on:{blur:function(i){return t.editRemark(e,t.type)},input:function(i){i.target.composing||t.$set(e,"remark",i.target.value)}}})])])}),0)]):t._e()]):i("div",[t.showRoi.length?i("div",{staticClass:"card"},[i("p",{staticClass:"result"},[t._v(t._s(t.slices.human.length?t.$t("report.handwork"):"AI处理结果"))]),t._v(" "),i("div",t._l([t.showRoi[0]],function(e,s){return i("div",{key:s,staticClass:"slice-list clearfix"},[i("div",{staticClass:"fleft"},[i("img",{attrs:{src:"/aipath/api/files/ROI?caseid="+t.recordId+"&fileid="+e.fileid+"&filename="+encodeURIComponent(e.filename)+"&roi=[["+Math.min.apply(Math,e.path.x)+","+Math.min.apply(Math,e.path.y)+"],["+Math.max.apply(Math,e.path.x)+","+Math.max.apply(Math,e.path.y)+"]] &roiid="+e.id,alt:""}})]),t._v(" "),t.roishow?t._e():i("div",{staticClass:"slice-name"},[t._v("切片名称："+t._s(e.filename))]),t._v(" "),i("div",{staticClass:"fright"},[i("textarea",{directives:[{name:"model",rawName:"v-model",value:e.remark,expression:"roi.remark"}],attrs:{maxlength:"300",name:"",placeholder:t.$t("report.remarkremind")},domProps:{value:e.remark},on:{blur:function(i){return t.editRemark(e,t.type)},input:function(i){i.target.composing||t.$set(e,"remark",i.target.value)}}})])])}),0)]):t._e()]),t._v(" "),t.slices.human&&t.slices.human.length||t.slices.tct&&t.slices.tct.length||t.slices.dna&&t.slices.dna.length?t._e():i("div",{staticClass:"qs"},[t._v("\n        请在上一步AI处理和手动处理中，勾选ROI添加镜下视野\n    ")])])},staticRenderFns:[]};var w=i("VU/8")(b,C,!1,function(t){i("Okq1")},"data-v-372f2ed5",null).exports,k={props:["info","opinions","firstSlice","DNAOpinions","dnaCellCount"],data(){let t=this.opinions?this.opinions.split(";"):[];return this.info.DNA={isStatisfied:"number"==typeof this.firstSlice.slide_quality?this.firstSlice.slide_quality>0?"1":"0":"",cellNum:"number"==typeof this.firstSlice.cell_num?this.firstSlice.cell_num>5e3?"greater":"less":"",cervicalCanalCells:"",metaplasticCells:"",inflammatoryCells:"",erythrocyte:"",cataplasia:"",intrauterineDevice:"",radiotherapy:"",selectopinion:"",selectDNAOpinion:"",selectUniteOpinion:"",tbsOpinion:t[0]?t[0]:"",opinion:this.opinions,options:["未见上皮内病变细胞或恶性细胞（NILM）","意义不明确的非典型鳞状细胞（ASC-US）","不除外高级别鳞状上皮内病变细胞的非典型鳞状细胞（ASC-H）","低级别鳞状上皮内病变（LSIL）","高级别鳞状上皮内病变（HSIL）","鳞状细胞癌（SCC）","非典型腺细胞（不能明确意义）","非典型腺细胞（倾向瘤变）","颈管原位腺癌（AIS）","腺癌","其他恶性肿瘤"],DNAOpinion:this.DNAOpinions,DNAOptions:["标本不满意:上皮细胞数目太少","标本不满意","其它","有效检测细胞不足","未见DNA倍体异常细胞","可见少量DNA倍体异常细胞（1-2个）","可见DNA倍体异常细胞（≥3个）","可见少量细胞增生（5%-10%）","可见细胞异常增生（≥10%）","可见异倍体细胞峰"],uniteOpinion:t[1]?t[1]:"",uniteOptions:["请选择","按TBS诊断结果给建议","定期筛查","一个月复查","4~6个月复查","阴道镜检查及活体组织检查或结合临床考虑","颈管搔刮或子宫内膜活检或诊刮"],pathogen:[],pageType:"DNAPage",reportTypeMode:window.reportTypeMode,num_normal:this.dnaCellCount.num_normal,num_abnormal_low:this.dnaCellCount.num_abnormal_low,num_abnormal_high:this.dnaCellCount.num_abnormal_high}},methods:{changeValue(t,e){"opinion"==e?("string"==typeof t&&(this.tbsOpinion=t,this.opinion=this.tbsOpinion+";"+this.uniteOpinion),this.$emit("sendValue",this.tbsOpinion+";"+this.uniteOpinion,e)):"DNAOpinion"==e?("string"==typeof t&&(this.DNAOpinion=t),this.$emit("sendValue",this.DNAOpinion,e)):"uniteOpinion"==e&&("string"==typeof t&&(this.uniteOpinion=t,this.opinion=this.tbsOpinion+";"+this.uniteOpinion),this.$emit("sendValue",this.tbsOpinion+";"+this.uniteOpinion,"opinion"))},noEmoji(t){t.target.value=t.target.value.replace(/[^\u0020-\u007E\u00A0-\u00BE\u2E80-\uA4CF\uF900-\uFAFF\uFE30-\uFE4F\uFF00-\uFFEF\u0080-\u009F\u2000-\u201f\u2026\u2022\u20ac\r\n]/g,"")}},mounted(){this.$nextTick(()=>{if("dna"===this.firstSlice.alg)if(this.firstSlice.check_result){let t=this.firstSlice.check_result.split(";");if(t[0]){let e=t[0].split(" ")[2];this.info.DNA.pathogen=e?e.split(","):[]}else if(this.firstSlice.ai_suggest){let t=this.firstSlice.ai_suggest.split(";");if(t[0]){let e=t[0].split(" ")[2];this.info.DNA.pathogen=e?e.split(","):[]}}}else if(this.firstSlice.ai_suggest){let t=this.firstSlice.ai_suggest.split(";");if(t[0]){let e=t[0].split(" ")[2];this.info.DNA.pathogen=e?e.split(","):[]}}})},watch:{opinions:{immediate:!0,deep:!0,handler(t){let e=t?t.split(";"):[];this.tbsOpinion=e[0]?e[0]:"",this.uniteOpinion=e[1]?e[1]:""}},DNAOpinions:{immediate:!0,deep:!0,handler(t){this.DNAOpinion=t}},dnaCellCount:{immediate:!0,deep:!0,handler(t){this.info.DNA.num_normal=t.num_normal,this.info.DNA.num_abnormal_low=t.num_abnormal_low,this.info.DNA.num_abnormal_high=t.num_abnormal_high}}}},x={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",[i("div",{staticClass:"dna"},[i("h4",{staticClass:"title"},[t._v(t._s(t.$t("basic.sample")))]),t._v(" "),i("div",{staticClass:"tct-text"},[i("div",{staticClass:"left"},[i("div",{staticClass:"seption"},[i("div",{staticClass:"line"},[i("span",{staticClass:"weight600"},[t._v("标本满意度:")]),t._v(" "),i("el-radio",{attrs:{label:"1"},model:{value:t.isStatisfied,callback:function(e){t.isStatisfied=e},expression:"isStatisfied"}},[t._v(t._s(t.$t("report.satisfied")))]),t._v(" "),i("el-radio",{attrs:{label:"0"},model:{value:t.isStatisfied,callback:function(e){t.isStatisfied=e},expression:"isStatisfied"}},[t._v(t._s(t.$t("report.notsatisfied")))])],1),t._v(" "),i("div",{staticClass:"line"},[i("span",{staticClass:"weight600"},[t._v("细胞量:")]),t._v(" "),i("el-radio",{attrs:{label:"greater"},model:{value:t.cellNum,callback:function(e){t.cellNum=e},expression:"cellNum"}},[t._v(">5000")]),t._v(" "),i("el-radio",{attrs:{label:"less"},model:{value:t.cellNum,callback:function(e){t.cellNum=e},expression:"cellNum"}},[t._v("≤5000")])],1),t._v(" "),i("div",{staticClass:"line"},[i("span",{staticClass:"weight600"},[t._v("颈管细胞:")]),t._v(" "),i("el-radio",{attrs:{label:"1"},model:{value:t.cervicalCanalCells,callback:function(e){t.cervicalCanalCells=e},expression:"cervicalCanalCells"}},[t._v("有")]),t._v(" "),i("el-radio",{attrs:{label:"0"},model:{value:t.cervicalCanalCells,callback:function(e){t.cervicalCanalCells=e},expression:"cervicalCanalCells"}},[t._v("无")])],1),t._v(" "),i("div",{staticClass:"line"},[i("span",{staticClass:"weight600"},[t._v("化生细胞:")]),t._v(" "),i("el-radio",{attrs:{label:"1"},model:{value:t.metaplasticCells,callback:function(e){t.metaplasticCells=e},expression:"metaplasticCells"}},[t._v("有")]),t._v(" "),i("el-radio",{attrs:{label:"0"},model:{value:t.metaplasticCells,callback:function(e){t.metaplasticCells=e},expression:"metaplasticCells"}},[t._v("无")])],1)]),t._v(" "),i("div",{staticClass:"seption"},[i("div",{staticClass:"line weight600"},[t._v("\n            炎症以及反应性细胞改变\n          ")]),t._v(" "),i("div",{staticClass:"line"},[i("span",{staticClass:"weight600"},[t._v("炎细胞:")]),t._v(" "),i("el-radio",{attrs:{label:"less"},model:{value:t.inflammatoryCells,callback:function(e){t.inflammatoryCells=e},expression:"inflammatoryCells"}},[t._v("少量")]),t._v(" "),i("el-radio",{attrs:{label:"medium"},model:{value:t.inflammatoryCells,callback:function(e){t.inflammatoryCells=e},expression:"inflammatoryCells"}},[t._v("中量")]),t._v(" "),i("el-radio",{attrs:{label:"more"},model:{value:t.inflammatoryCells,callback:function(e){t.inflammatoryCells=e},expression:"inflammatoryCells"}},[t._v("大量")])],1),t._v(" "),i("div",{staticClass:"line"},[i("span",{staticClass:"weight600"},[t._v("红细胞:")]),t._v(" "),i("el-radio",{attrs:{label:"less"},model:{value:t.erythrocyte,callback:function(e){t.erythrocyte=e},expression:"erythrocyte"}},[t._v("少量")]),t._v(" "),i("el-radio",{attrs:{label:"medium"},model:{value:t.erythrocyte,callback:function(e){t.erythrocyte=e},expression:"erythrocyte"}},[t._v("中量")]),t._v(" "),i("el-radio",{attrs:{label:"more"},model:{value:t.erythrocyte,callback:function(e){t.erythrocyte=e},expression:"erythrocyte"}},[t._v("大量")])],1),t._v(" "),i("div",{staticClass:"line"},[i("span",{staticClass:"weight600"},[t._v("细胞萎缩:")]),t._v(" "),i("el-radio",{attrs:{label:"1"},model:{value:t.cataplasia,callback:function(e){t.cataplasia=e},expression:"cataplasia"}},[t._v("有")]),t._v(" "),i("el-radio",{attrs:{label:"0"},model:{value:t.cataplasia,callback:function(e){t.cataplasia=e},expression:"cataplasia"}},[t._v("无")])],1)]),t._v(" "),i("div",{staticClass:"seption"},[i("div",{staticClass:"line"},[i("span",{staticClass:"weight600"},[t._v("宫内节育器:")]),t._v(" "),i("el-radio",{attrs:{label:"1"},model:{value:t.intrauterineDevice,callback:function(e){t.intrauterineDevice=e},expression:"intrauterineDevice"}},[t._v("有")]),t._v(" "),i("el-radio",{attrs:{label:"0"},model:{value:t.intrauterineDevice,callback:function(e){t.intrauterineDevice=e},expression:"intrauterineDevice"}},[t._v("无")])],1),t._v(" "),i("div",{staticClass:"line"},[i("span",{staticClass:"weight600"},[t._v("放疗:")]),t._v(" "),i("el-radio",{attrs:{label:"1"},model:{value:t.radiotherapy,callback:function(e){t.radiotherapy=e},expression:"radiotherapy"}},[t._v("有")]),t._v(" "),i("el-radio",{attrs:{label:"0"},model:{value:t.radiotherapy,callback:function(e){t.radiotherapy=e},expression:"radiotherapy"}},[t._v("无")])],1)])]),t._v(" "),i("div",{staticClass:"right"},[i("div",{staticClass:"line weight600"},[t._v("微生物:")]),t._v(" "),i("el-checkbox-group",{staticStyle:{display:"inline-block"},model:{value:t.pathogen,callback:function(e){t.pathogen=e},expression:"pathogen"}},t._l(t.$t("report.padthogenArr"),function(t,e){return i("el-checkbox",{key:e,attrs:{label:t}})}),1)],1)])]),t._v(" "),i("div",{staticClass:"opinion"},[i("h4",{staticClass:"title"},[t._v("\n      "+t._s("TBS诊断意见")+"\n       "),i("el-select",{on:{change:function(e){return t.changeValue(e,"opinion")}},model:{value:t.info.DNA.selectopinion,callback:function(e){t.$set(t.info.DNA,"selectopinion",e)},expression:"info.DNA.selectopinion"}},t._l(this.info.DNA.options,function(t){return i("el-option",{key:t,attrs:{label:t,value:t}})}),1)],1),t._v(" "),i("div",{staticClass:"opinion-write"},[i("textarea",{directives:[{name:"model",rawName:"v-model",value:t.tbsOpinion,expression:"tbsOpinion"}],attrs:{spellcheck:"false",name:"",id:"",maxlength:"300",cols:"30",rows:"10",placeholder:"诊断意见"},domProps:{value:t.tbsOpinion},on:{change:function(e){return t.changeValue(e,"opinion")},input:[function(e){e.target.composing||(t.tbsOpinion=e.target.value)},t.noEmoji]}})])]),t._v(" "),i("div",{staticClass:"opinion"},[i("h4",{staticClass:"title"},[t._v("\n      "+t._s("DNA检测意见")+"\n       "),i("el-select",{on:{change:function(e){return t.changeValue(e,"DNAOpinion")}},model:{value:t.info.DNA.selectDNAOpinion,callback:function(e){t.$set(t.info.DNA,"selectDNAOpinion",e)},expression:"info.DNA.selectDNAOpinion"}},t._l(this.info.DNA.DNAOptions,function(t){return i("el-option",{key:t,attrs:{label:t,value:t}})}),1)],1),t._v(" "),i("div",{staticClass:"opinion-write"},[i("textarea",{directives:[{name:"model",rawName:"v-model",value:t.DNAOpinion,expression:"DNAOpinion"}],attrs:{spellcheck:"false",name:"",id:"",maxlength:"300",cols:"30",rows:"10",placeholder:"诊断意见"},domProps:{value:t.DNAOpinion},on:{change:function(e){return t.changeValue(e,"DNAOpinion")},input:[function(e){e.target.composing||(t.DNAOpinion=e.target.value)},t.noEmoji]}})])]),t._v(" "),i("div",{staticClass:"opinion"},[i("h4",{staticClass:"title"},[t._v("\n      "+t._s("联合诊断建议")+"\n       "),i("el-select",{on:{change:function(e){return t.changeValue(e,"uniteOpinion")}},model:{value:t.info.DNA.selectUniteOpinion,callback:function(e){t.$set(t.info.DNA,"selectUniteOpinion",e)},expression:"info.DNA.selectUniteOpinion"}},t._l(this.info.DNA.uniteOptions,function(t){return i("el-option",{key:t,attrs:{label:t,value:t}})}),1)],1),t._v(" "),i("div",{staticClass:"opinion-write"},[i("textarea",{directives:[{name:"model",rawName:"v-model",value:t.uniteOpinion,expression:"uniteOpinion"}],attrs:{spellcheck:"false",name:"",id:"",maxlength:"300",cols:"30",rows:"10",placeholder:"诊断意见"},domProps:{value:t.uniteOpinion},on:{change:function(e){return t.changeValue(e,"uniteOpinion")},input:[function(e){e.target.composing||(t.uniteOpinion=e.target.value)},t.noEmoji]}})])])])},staticRenderFns:[]};var $=i("VU/8")(k,x,!1,function(t){i("2XvT")},"data-v-0c91c47b",null).exports,I=[];I.append=function(t){let e=()=>{var t=I.shift();if(!t)return I.running=!1;I.running=!0,t().then(e).catch(e)};this.push(t),this.running||e()};var O={props:["record","reportType","signed","logoSrc","slices","sign","algType"],components:{"v-reg":o,"v-tct2":c,"v-dna":$,"v-esd":v,"v-reference":m,"v-basic":R,"v-slides":w},data(){return{types:[{key:"REG",value:"REG"},{key:"TCT / LCT",value:"LCT"},{key:"TBS+DNA",value:"DNA"}],uploadData:new Map,img_error:!0,opinion:this.record.opinion,dnaCellCount:{}}},methods:{getValue(t){this.$set(this.record,"opinion",t)},getDNAValue(t,e){"opinion"==e?this.$set(this.record,"opinion",t):"DNAOpinion"==e&&this.$set(this.record,"DNAOpinion",t)},getDNAInfo(){Object(s.b)("report/getDNAInfo",{caseid:this.record.id,fileid:this.record.slice}).then(({data:t})=>{this.dnaCellCount=t})},roiState(){this.$set(this.record,"roishow",!this.record.roishow)},currentTime(){var t=new Date,e=t.getFullYear(),i=t.getMonth()+1,s=t.getDate();return e+"-"+(i<10?"0"+i:i)+"-"+(s<10?"0"+s:s)},addFiles(t){for(let i of t.files){var e=new FileReader;if(e.readAsDataURL(i),i.size/1024/1024>5)return void this.$message.error("文件大小不能超过5MB");e.onload=(t=>{this.$set(this.record,"logo",t.target.result)})}},addSign(t){for(let i of t.files){var e=new FileReader;if(e.readAsDataURL(i),i.size/1024/1024>5)return void this.$message.error("文件大小不能超过5MB");e.onload=(t=>{let e=new FormData;e.append("sign",i),Object(s.b)("user/updateSign",e).then(()=>{this.$emit("changeSign")})})}},async save(t){this.record.update=this.record.update=(new Date).toISOString(),await Object(s.b)("records/update",{id:this.record.id,content:JSON.stringify(this.record)})},imgError(){this.img_error=!1}},mounted(){this.record.hasOwnProperty("report_name")||this.$set(this.record,"report_name",Object(s.s)().company),this.record.hasOwnProperty("report_info")||this.$set(this.record,"report_info","病理检查报告")},watch:{"record.opinion":{immediate:!0,handler(t){this.opinion=t}},"record.DNAOpinion":{immediate:!0,handler(t){this.DNAOpinion=t}},reportType:{immediate:!0,handler(t){"DNA"==t&&this.getDNAInfo()}}}},A={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"father"},[i("div",{staticClass:"content"},[i("div",{staticClass:"header clearfix"},[i("div",{staticClass:"logo-content"},[t.record.logo?i("img",{staticClass:"logo",attrs:{src:t.record.logo,id:"logo",alt:""}}):i("span",[i("em",[t._v("+")]),t._v("上传LOGO")]),t._v(" "),i("input",{staticClass:"choseLogo",attrs:{type:"file",accept:"image/jpeg,image/png,image/bmp"},on:{change:function(e){return t.addFiles(e.currentTarget)}}})]),t._v(" "),i("div",{staticClass:"text"},[t._v("样本号："+t._s(this.record.basic.caseid)+"   "+t._s(t.$t("report.date"))+t._s(t.currentTime())+"\n            ")])]),t._v(" "),i("div",{staticClass:"main"},[i("h3",[i("input",{directives:[{name:"model",rawName:"v-model",value:t.record.report_name,expression:"record.report_name"}],attrs:{type:"text"},domProps:{value:t.record.report_name},on:{input:function(e){e.target.composing||t.$set(t.record,"report_name",e.target.value)}}})]),t._v(" "),i("h3",[i("input",{directives:[{name:"model",rawName:"v-model",value:t.record.report_info,expression:"record.report_info"}],staticClass:"names",attrs:{type:"text"},domProps:{value:t.record.report_info},on:{input:function(e){e.target.composing||t.$set(t.record,"report_info",e.target.value)}}})]),t._v(" "),i("v-basic",{attrs:{basic:t.record.basic}}),t._v(" "),i("div",{staticClass:"options clearfix"},[i("select",{attrs:{name:""},on:{change:function(e){return t.$emit("typeChange",e.target.value)}}},t._l(t.types,function(e,s){return i("option",{key:s,domProps:{selected:e.value==t.reportType,value:e.value}},[t._v(t._s(e.key))])}),0),t._v(" "),"REG"==t.reportType?i("v-reg",{attrs:{info:t.record.reportInfo,opinions:t.opinion},on:{sendValue:t.getValue}}):"LCT"==t.reportType?i("v-tct2",{attrs:{info:t.record.reportInfo,opinions:t.opinion,firstSlice:t.record.slices[0]},on:{sendValue:t.getValue}}):"DNA"==t.reportType?i("v-dna",{attrs:{info:t.record.reportInfo,opinions:t.opinion,DNAOpinions:t.DNAOpinion,firstSlice:t.record.slices[0],dnaCellCount:t.dnaCellCount},on:{sendValue:t.getDNAValue}}):t._e()],1),t._v(" "),i("v-slides",{attrs:{recordId:t.record.id,roishow:t.record.roishow,slices:t.slices,type:t.algType&&t.algType.toLowerCase(),modeType:t.reportType.toLowerCase()},on:{roiState:t.roiState,sliceChangge:function(e){return t.$emit("sliceChangge")}}}),t._v(" "),i("div",{staticClass:"sign clearfix",staticStyle:{width:"260px","box-sizing":"content-box"}},[i("span",[t._v(t._s(t.$t("report.doctor")))]),t._v(" "),i("div",{staticClass:"logo-content sign-content"},[t.signed?t._e():i("span",[i("em",[t._v("+")]),t._v("上传签名")]),t._v(" "),t.signed?i("img",{directives:[{name:"show",rawName:"v-show",value:t.img_error,expression:"img_error"}],staticClass:"signed",attrs:{src:t.sign},on:{error:function(e){return t.imgError()}}}):t._e(),t._v(" "),i("input",{staticClass:"choseLogo",attrs:{type:"file",accept:"image/jpeg,image/png,image/bmp"},on:{change:function(e){return t.addSign(e.currentTarget)}}})])])],1),t._v(" "),i("div",{staticClass:"footer clearfix"},[i("div",{staticClass:"fleft"},[i("p",[t._v(t._s(t.$t("report.bottom")))]),t._v(" "),i("p",[t._v("research use only")])])])])])},staticRenderFns:[]};var M=i("VU/8")(O,A,!1,function(t){i("Db79")},"data-v-0771da43",null);e.a=M.exports},"7iKh":function(t,e,i){"use strict";(function(t){var s=i("7R9Z"),n=i("dbyp"),a=i("jyVo"),o=i("mtWM"),r=i.n(o);let l,c;if(window.electron){let t=window.require;l=t("fs"),c=t("stream")}e.a={props:["record","config"],components:{"v-eidtreport":s.a,"v-viewreport":n.a},data(){return this.record.reportInfo=this.record.reportInfo||{type:"REG",REG:{}},{userInfo:Object(a.s)(),scaleRate:1,reportType:this.record.reportInfo.type,algType:this.record.alg,slices:{dna:[],human:[],lct:[],tct:[]},sign:"/aipath/api/user/sign?id="+Object(a.s)().username+"&"+Math.random(),signed:!1,loading:!1,demoModeValue:"1"===localStorage.getItem("demoMode")||!1}},methods:{createReport(t){let e=window.localStorage.getItem("localeLanguage");return Object(a.b)("report/create",{data:JSON.stringify(this.record),caseid:this.record.id,reportid:t,lang:e})},next(){var t=Math.floor(1e5*Math.random());this.createReport(t).then(e=>this.record.reports.unshift({id:t,doctor:Object(a.s)().username,date:new Date})).then(t=>this.$emit("save"))},prev(){this.$emit("prev")},resize(){this.scaleRate=(window.document.body.clientWidth/2-60)/905},download(){let e=Math.floor(1e5*Math.random()),i=window.localStorage.getItem("localeLanguage");this.loading=!0;let s=this.deepClone(this.record);"DNA"==this.record.reportInfo.type&&(s.reportInfo.DNA.pageType="TBSPage"),Object(a.b)("report/create",{data:JSON.stringify(s),caseid:this.record.id,reportid:e,lang:i}).then(t=>this.record.reports.unshift({id:e,doctor:Object(a.s)().username,date:new Date})).then(async i=>{let s=Object(a.l)(new Date).replace(/\s+/g,"");if(window.electron)r()({headers:{"Content-Type":" application/x-www-form-urlencoded"},method:"get",url:`/aipath/api/report/view?caseid=${this.record.id}&reportid=${e}&time=${s}`,responseType:"blob"}).then(e=>{let i=new Blob([e.data],{type:"application/pdf;charset=utf-8"}),s=new FileReader;s.readAsDataURL(i),s.onload=(e=>{const{dialog:i}=window.remote;let s=this.record.basic.caseid||this.record.basic.name?(this.record.basic.caseid||"")+(this.record.basic.name||""):"report";i.showSaveDialog({defaultPath:`${s}.pdf`,title:"下载报告",filters:[{name:"PDF",extensions:["pdf"]}]}).then(async({filePath:i})=>{if(i){let s=t.from(e.target.result.split("base64,")[1],"base64");const n=new c.PassThrough({allowHalfOpen:!1}),a=new l.createWriteStream(i);a.on("error",t=>{console.log(t),this.$message.error("导出错误，请重试"),this.loading=!1,this.$emit("save")}).on("finish",()=>{"DNA"==this.record.reportInfo.type&&"double"==window.reportTypeMode?this.downloadDNA():(this.loading=!1,this.$emit("save"))}),n.end(s),n.pipe(a)}else this.loading=!1,this.$emit("save")}).catch(t=>{this.loading=!1,this.$emit("save")})})}).catch(t=>this.$alert(t.message));else{"DNA"==this.record.reportInfo.type&&"double"==window.reportTypeMode?this.downloadDNA():(this.loading=!1,this.$emit("save"));var n=document.createElement("a");n.style.display="none";let t=this.record.basic.caseid||this.record.basic.name?(this.record.basic.caseid||"")+(this.record.basic.name||""):"report";n.download=`${t}.pdf`,n.href=`/aipath/api/report/view?caseid=${this.record.id}&reportid=${e}&time=${s}`,document.body.appendChild(n),n.click(),document.body.removeChild(n)}}).catch(t=>{this.loading=!1,this.$alert(t.message)})},downloadDNA(){let e=Math.floor(1e5*Math.random()),i=window.localStorage.getItem("localeLanguage");this.loading=!0;let s=this.deepClone(this.record);s.reportInfo.DNA.pageType="DNAPage",Object(a.b)("report/create",{data:JSON.stringify(s),caseid:this.record.id,reportid:e,lang:i}).then(t=>this.record.reports.unshift({id:e,doctor:Object(a.s)().username,date:new Date})).then(async i=>{let s=Object(a.l)(new Date).replace(/\s+/g,"");if(window.electron)r()({headers:{"Content-Type":" application/x-www-form-urlencoded"},method:"get",url:`/aipath/api/report/view?caseid=${this.record.id}&reportid=${e}&time=${s}`,responseType:"blob"}).then(e=>{let i=new Blob([e.data],{type:"application/pdf;charset=utf-8"}),s=new FileReader;s.readAsDataURL(i),s.onload=(e=>{const{dialog:i}=window.remote;let s=this.record.basic.caseid||this.record.basic.name?(this.record.basic.caseid||"")+(this.record.basic.name||""):"report";i.showSaveDialog({defaultPath:`${s}_DNA.pdf`,title:"下载报告",filters:[{name:"PDF",extensions:["pdf"]}]}).then(async({filePath:i})=>{if(i){let s=t.from(e.target.result.split("base64,")[1],"base64");const n=new c.PassThrough({allowHalfOpen:!1}),a=new l.createWriteStream(i);a.on("error",t=>{console.log(t),this.$message.error("导出错误，请重试"),this.loading=!1,this.$emit("save")}).on("finish",()=>{this.loading=!1,this.$emit("save")}),n.end(s),n.pipe(a)}else this.loading=!1,this.$emit("save")}).catch(t=>{this.loading=!1,this.$emit("save")})})}).catch(t=>this.$alert(t.message));else{this.loading=!1,this.$emit("save");var n=document.createElement("a");n.style.display="none";let t=this.record.basic.caseid||this.record.basic.name?(this.record.basic.caseid||"")+(this.record.basic.name||""):"report";n.download=`${t}_DNA.pdf`,n.href=`/aipath/api/report/view?caseid=${this.record.id}&reportid=${e}&time=${s}`,document.body.appendChild(n),n.click(),document.body.removeChild(n)}}).catch(t=>{this.loading=!1,this.$alert(t.message)})},deepClone(t){let e={},i=JSON.stringify(t);return e=JSON.parse(i)},typeChange(t){this.$set(this.record.reportInfo,"type",t),this.reportType=t,this.record.reportInfo[t]=this.record.reportInfo[t]||{}},getImages(){Object(a.b)("report/getReportROI",{caseid:this.record.id,alg:this.reportType.toLowerCase()}).then(t=>{this.slices=t.data})},hasSign(){Object(a.b)("user/haveSign").then(t=>{this.signed=t.data})},getLogo(){Object(a.b)("records/getLogo").then(t=>{this.$set(this.record,"logo",t.data)})},changeSign(){this.sign="/aipath/api/user/sign?id="+this.userInfo.username+"&"+Math.random(),this.hasSign()}},mounted(){window.addEventListener("resize",this.resize),this.$set(this.record,"roishow",!0),this.resize(),Object(a.b)("records/getReportOpinion ",{caseid:this.record.id}).then(({data:t})=>{t.alg&&(t.alg.includes("tct")||t.alg.includes("lct"))?(this.$set(this.record.reportInfo,"type","LCT"),this.reportType="LCT",this.record.reportInfo.LCT=this.record.reportInfo.LCT||{},this.$set(this.record,"opinion",t.opinion)):"dna"==t.alg&&(this.$set(this.record.reportInfo,"type",t.alg.toUpperCase()),this.reportType=t.alg.toUpperCase(),this.record.reportInfo[this.reportType]=this.record.reportInfo[this.reportType]||{},this.$set(this.record,"opinion",t.opinion),this.$set(this.record,"DNAOpinion",t.DNAOpinion)),this.algType=t.alg,this.getImages(this.reportType)}),this.hasSign(),this.getLogo()},beforeDestroy(){window.removeEventListener("resize",this.resize)}}}).call(e,i("EuP9").Buffer)},"8FSm":function(t,e){},"98Q0":function(t,e){},"9MxB":function(t,e){},AANI:function(t,e){},Ac1S:function(t,e){},BNEt:function(t,e){},BcJf:function(t,e){},CBAI:function(t,e){},CmpE:function(t,e){},DJHp:function(t,e){},Db79:function(t,e){},E7z3:function(t,e,i){"use strict";var s=i("jyVo"),n=i("M4fF"),a=i.n(n);let o;const r={data(){return{curLevel:{},leftRoilist:[],rightRoilist:[],aiFatherRois:[],curRois:{},ki67Anno:null,showMppGuide:!1,drawMpp:null,showbutton:!0,auto:!0,lineup:null,loopHandler:0,centerRegion:null,position:{offx:this.slice.position?this.slice.position.offx:.5,offy:this.slice.position?this.slice.position.offy:.5*this.slice.height/this.slice.width,zoom:this.slice.position?this.slice.position.zoom:null},parentId:null,loading:!1,currentItem:"",newover:"",changeValue:"",changeValue2:"",optionsR:[{value:0,label:"阴性"},{value:1,label:"HSIL"},{value:2,label:"ASC-H"},{value:3,label:"LSIL"},{value:4,label:"ASC-US"},{value:5,label:"AGC"}],optionW:[{value:0,label:"滴虫"},{value:1,label:"霉菌"},{value:2,label:"线索"},{value:3,label:"放线菌"},{value:4,label:"疱疹"}],changeShow:0,showW:!0}},methods:{async getRoi(t){let{x1:e,y1:i,x2:n,y2:a,z:o}=t;this.curLevel={x:[e,n],y:[i,a],z:o},this.leftRoilist=[...await Object(s.n)(this.record.id,this.slice.id,this.curLevel,this.alg)],this.$emit("save","noListUpdate")},reCheck(t){this.$set(this.slice,"check_result",t),this.slice.alg!=this.alg&&(this.$set(this.slice,"alg",this.alg),this.$set(this.slice,"ai_suggest",null)),this.$emit("save")},showMenu(t,e){if((!t.type||t.button)&&(t.preventDefault(),!(0==Object.keys(this.curRois).length||Object.keys(this.curRois).every(t=>t!=e.id)||this.aiFatherRois.some(t=>t.id==e.id)||this.rightRoilist.some(t=>t.id==e.id)))){var i=t.currentTarget,s=t.offsetX,n=t.offsetY,a=i.offsetWidth,o=i.offsetHeight;this.ki67Anno={},this.ki67Anno.hd=s>a/2?"right":"left",this.ki67Anno.vd=n>o/2?"bottom":"top",this.menuPosition={x:s,y:n},this.curRois[e.id]&&(this.labeltree.forEach(t=>{t.id==e.type?this.currentItem=t.id+":"+t.id:t.children&&t.children.forEach(i=>{i.id==e.type&&(this.currentItem=t.id+":"+i.id)})}),this.newover=this.currentItem.substring(0,this.currentItem.lastIndexOf(":")))}},async setAnnotation(t){for(var e in this.ki67Anno=null,this.curRois){let i=this.curRois[e];this.curRois[e]=Object.assign({},i,{type:t,fillColor:this.roiTypeOpitions[t]})}o=t;var i=Object.assign({},this.curRois),n=Object.assign({},n,...Object.values(i).filter(t=>"grey"!=t.strokeColor).map(t=>({[t.id]:t})));this.leftRoilist=this.leftRoilist.map(t=>(n[t.id]&&(t=n[t.id]),t)),this.curRois={},this.loading=!0,await Object(s.e)(this.record.id,this.slice.id,this.alg,Object.values(n).map(e=>({id:e.id,type:t,fillColor:e.fillColor,area_id:e.area_id})),Object.assign({},this.$refs.osd.scope,{color:Object.values(n)[0].fillColor,type:t})),this.loading=!1,this.aiFatherRois=await Object(s.p)(this.record.id,this.slice.id,this.alg),this.leftRoilist=await Object(s.n)(this.record.id,this.slice.id,this.curLevel,this.alg)},isDrawMpp(){this.startAnalyze()},startAnalyze(){this.aiFatherRois.length&&this.aiFatherRois.some(t=>t.aiResult.whole_slide)?this.$confirm("一旦开始，将清空当前的全场图算法结果，确认要开始吗？",{confirmButtonText:this.$t("confirm.confirm"),cancelButtonText:this.$t("confirm.quit"),type:"warning"}).then(async()=>{this.start()}).catch(()=>{}):this.start()},async start(t=this.record.id,e=this.slice.id,i=this.slice.filename){let n=this.aiFatherRois.filter(t=>!t.aiResult.whole_slide).map(t=>({id:t.id,x:t.path.x,y:t.path.y}));this.$set(this.slice,"ai_dict",Object.assign(this.slice.ai_dict,{[this.alg+"Started"]:!0})),this.$set(this.slice,"alg",this.alg),this.$set(this.slice,"ai_suggest",null),this.$set(this.slice,"check_result",null),this.$set(this.slice,"suggest",null),this.showbutton=!1,this.auto=!0,this.aiFatherRois.length&&"fishTissue"!=this.alg&&(this.aiFatherRois.map(t=>t.image=1),await Object(s.e)(t,e,this.alg,this.aiFatherRois.map(t=>({id:t.id,image:t.image})),null)),await Object(s.r)(t,e,i,this.alg,JSON.stringify(n),this.model_type,this.mode.id),this.curRois={},this.leftRoilist=await Object(s.n)(t,e,this.curLevel,this.alg),this.aiFatherRois=await Object(s.p)(t,e,this.alg),Object.values(this.curRois).map(t=>this.leftRoilist.every(e=>t.id!=e.id)?delete this.curRois[t.id]:""),this.getAlgorithmResult()},getAlgorithmResult(t=this.record.id,e=this.slice.id,i=this.slice.filename){let n=this.aiFatherRois.filter(t=>!t.aiResult.whole_slide).map(t=>({id:t.id,x:t.path.x,y:t.path.y}));Object(s.b)("ai/getresult",{caseid:t,fileid:e,filename:i,type:this.alg,other:JSON.stringify(n)}).then(async i=>{console.log("=================>>"),this.lineup=i.data.rank,i.data.done?(this.showbutton=!0,this.loopHandler=0,this.loading=!1,-1==i.data.rank&&(this.leftRoilist=await Object(s.n)(t,e,this.curLevel,this.alg),this.aiFatherRois=await Object(s.p)(t,e,this.alg),"pdl1"===this.alg&&this.getScreenCount()),this.$emit("save","getInfo"),this.$set(this.slice,"ai_dict",Object.assign(this.slice.ai_dict,{[this.alg+"Started"]:!1})),"fishTissue"!=this.alg&&this.$set(this.slice,"ai_suggest",this.ave+"%")):(this.showbutton=!1,this.loopHandler=setTimeout(()=>this.getAlgorithmResult(),5e3))})},curROIChange(t,e){var i;t?t.length?i=t:e&&this.curRois[t.id]?(delete this.curRois[t.id],i=[]):i=[t]:i=[],["tct1","tct2","lct1","lct2"].includes(this.alg)?this.curRois=Object.assign({},e&&this.curRois,...i.map(t=>({[t.id]:t}))):this.curRois=Object.assign({},e&&this.curRois,...i.filter(t=>!t.aiResult||!t.aiResult.whole_slide).map(t=>({[t.id]:t})))},async roiChanged(t,e){let i,n={};i=e?e.map(e=>(e.audio&&(n.audio=e.audio,n.markId=e.id),e.dna_index?{id:e.id,[t]:e[t],area_id:e.area_id,iconType:"dnaIcon",remark:e.remark}:{id:e.id,[t]:e[t],area_id:e.area_id,remark:e.remark})):Object.values(this.curRois).map(e=>(e.audio&&(n.audio=e.audio,n.markId=e.id),{id:e.id,[t]:e[t],area_id:e.area_id,remark:e.remark}));let a="image"==t||"remark"==t?null:this.$refs.osd.scope;a&&a.offset&&(this.curRois={},this.$refs.osd.scope=null),a?this.$message.error("不支持多选移动"):("image"!==t&&"remark"!==t&&(this.loading=!0),console.log("otherData",n),await Object(s.e)(this.record.id,this.slice.id,this.alg,i,a,n),this.loading=!1),["tct1","tct2","lct1","lct2","fishTissue","dna"].includes(this.alg)?this.leftRoilist=await Object(s.n)(this.record.id,this.slice.id,this.curLevel,this.alg):(this.aiFatherRois=await Object(s.p)(this.record.id,this.slice.id,this.alg),this.rightRoilist=await Object(s.p)(this.record.id,this.slice.id),this.leftRoilist=await Object(s.n)(this.record.id,this.slice.id,this.curLevel,this.alg)),this.IsOutFrame()},IsOutFrame(){Object.keys(this.curRois).map(t=>{this.leftRoilist.some(e=>e.id==t)||(delete this.curRois[t],this.curRois=Object.assign({},this.curRois))})},listChangeCurrent(){if(Object.keys(this.curRois).length){var t=[].concat.apply([],Object.values(this.curRois).map(t=>t.path.x)),e=[].concat.apply([],Object.values(this.curRois).map(t=>t.path.y));t.length?this.centerRegion=[Math.min.apply(null,t),Math.min.apply(null,e),Math.max.apply(null,t),Math.max.apply(null,e)]:this.centerRegion=null,this.$refs.osd.scope=null}},async draw(t,e){t.strokeColor="yellow",t.mark_type=1,this.auto&&(t.strokeColor="grey",t.mark_type=3,t.ai_type=this.alg,"ki67hot"!=this.slice.toolType&&(t.editable=0));let i=t.method.includes("Reverse");this.aiFatherRois.some(t=>t.aiResult.whole_slide)&&!i&&this.auto?this.$message({message:"进行roi框选分析之前请先删除全场图分析结果",type:"warning"}):(t.id=await Object(s.h)(this.record.id,this.slice.id,t),t.id&&(this.curROIChange(t,e),this.leftRoilist=[...this.leftRoilist,t],this.rightRoilist=await Object(s.p)(this.record.id,this.slice.id),this.aiFatherRois=await Object(s.p)(this.record.id,this.slice.id,this.alg),this.leftRoilist=await Object(s.n)(this.record.id,this.slice.id,this.curLevel,this.alg),this.IsOutFrame()))},async clickDraw(t,e){if(this.auto){if(!this.showbutton)return void this.$message({message:"计算中不能标注",type:"warning"});let n,a=this.leftRoilist.find(t=>t.id===this.parentId);if((n=this.aiFatherRois.some(t=>t.aiResult.whole_slide)?this.aiFatherRois.find(t=>t.aiResult.whole_slide):this.aiFatherRois.find(t=>t.id===this.parentId))||a&&2==a.mark_type){let r="cd30"===this.alg?4.131514365275448:1/(this.slice.mppx||.242042);if((i={path:{x:[t.x],y:[t.y]},method:"spot",radius:r,area_id:n?n.id:a.area_id,mark_type:2,ai_type:this.alg,type:"number"==typeof o?o:this.defaultType,fillColor:"number"==typeof o?this.roiTypeOpitions[o]:this.defaultColor}).id=await Object(s.h)(this.record.id,this.slice.id,i),!i.id)return;e?Object.assign(this.curRois,{[i.id]:i}):this.curRois={[i.id]:i},this.leftRoilist=[...this.leftRoilist,i],this.aiFatherRois=await Object(s.p)(this.record.id,this.slice.id,this.alg)}else this.$message({message:"只能在处理ROI区域内打点",type:"warning"})}else{var i;if((i={path:{x:[t.x],y:[t.y]},method:"spot",radius:3/(this.slice.mppx||.242042),mark_type:1,fillColor:"yellow"}).id=await Object(s.h)(this.record.id,this.slice.id,i),!i.id)return;this.curROIChange(i,e),this.leftRoilist=[...this.leftRoilist,i],this.rightRoilist=await Object(s.p)(this.record.id,this.slice.id)}},async delCurRoi(t){if(this.showbutton)if(t){for(var e in this.loading=!0,await Object(s.i)(this.record.id,this.slice.id,this.alg,[t.id],null),this.loading=!1,this.curRois)this.curRois[e].area_id==t.id&&(delete this.curRois[e],this.curRois=Object.assign({},this.curRois));this.curRois[t.id]&&(delete this.curRois[t.id],this.curRois=Object.assign({},this.curRois)),3===t.mark_type&&(this.aiFatherRois=await Object(s.p)(this.record.id,this.slice.id,this.alg),this.aiFatherRois.length||(this.$set(this.slice,"check_result",null),this.$set(this.slice,"suggest",null),this.$emit("save"))),1===t.mark_type&&(this.rightRoilist=await Object(s.p)(this.record.id,this.slice.id)),this.leftRoilist=await Object(s.n)(this.record.id,this.slice.id,this.curLevel,this.alg)}else{await this.$confirm(this.$t("analaysisPanel.delete"),{confirmButtonText:this.$t("confirm.confirm"),cancelButtonText:this.$t("confirm.quit"),type:"warning"}).catch(()=>{})&&(this.loading=!0,await Object(s.i)(this.record.id,this.slice.id,this.alg,Object.keys(this.curRois),this.$refs.osd.scope),this.loading=!1,[...new Set(Object.values(this.curRois).map(t=>t.mark_type))].map(async t=>{1===t?this.rightRoilist=await Object(s.p)(this.record.id,this.slice.id):this.aiFatherRois=await Object(s.p)(this.record.id,this.slice.id,this.alg)}),this.curRois={},this.leftRoilist=await Object(s.n)(this.record.id,this.slice.id,this.curLevel,this.alg))}else this.$message.error("处理中无法删除")},canceltesk(){Object(s.b)("ai/revokeTask",{caseid:this.record.id,fileid:this.slice.id,type:this.alg,other:""}).then(async t=>{0==t.code&&(clearTimeout(this.loopHandler),this.loopHandler=0,this.showbutton=!0,this.$set(this.slice,"ai_dict",Object.assign(this.slice.ai_dict,{[this.alg+"Started"]:!1})),this.aiFatherRois.length&&"fishTissue"!=this.alg&&(this.aiFatherRois.map(t=>t.image=0),await Object(s.e)(this.record.id,this.slice.id,this.alg,this.aiFatherRois.map(t=>({id:t.id,image:t.image})),null)))}).catch(t=>console.log(t))},keydown(t){"Delete"!=t.key&&"Backspace"!=t.key||!Object.keys(this.curRois).length||this.delCurRoi()},watchKeyForChange(){document.onkeydown=null,document.onkeydown=(t=>{this.timer&&clearTimeout(this.timer),t.ctrlKey&&t.shiftKey&&t.shiftKey&&"KeyM"==t.code&&(this.changeShow=!this.changeShow),t.ctrlKey&&t.shiftKey&&t.shiftKey&&"KeyO"==t.code&&this.changeQuality(),t.ctrlKey&&t.shiftKey&&t.shiftKey&&"KeyL"==t.code&&(this.showW=!this.showW,this.showW&&this.toogleType(this.showType)),this.timer=setTimeout(()=>{this.changeShow=!1},1e4)})},changeQuality(){const t={mode:1,caseid:this.record.id,fileid:this.slice.id};Object(s.b)("files/save_info",t).then(async t=>{this.$emit("save","getInfo"),this.aiResult=await this.getAiResult()})},async changeAiResult(){const t={mode:2,index1:this.changeValue,index2_list:JSON.stringify(this.changeValue2),caseid:this.record.id,fileid:this.slice.id};Object(s.b)("files/save_info",t).then(async t=>{this.$emit("save","getInfo"),this.aiResult=await this.getAiResult(),this.changeShow=!1})}},async mounted(){this.watchKeyForChange(),this.slice.ai_dict[[this.alg+"Started"]]&&this.getAlgorithmResult(),window.addEventListener("online",()=>{this.showbutton||this.getAlgorithmResult()}),["tct1","tct2","lct1","lct2"].includes(this.alg)||(this.rightRoilist=await Object(s.p)(this.record.id,this.slice.id),this.aiFatherRois=await Object(s.p)(this.record.id,this.slice.id,this.alg))},watch:{"slice.id":{handler(){clearTimeout(this.loopHandler),this.loopHandler=0}},drawMpp:{handler(t){t&&(this.$set(this.slice,"mppx",t),this.$set(this.slice,"mppy",t),this.$emit("save"),this.startAnalyze())}}},computed:{alg(){return"fish"===this.slice.toolType?"fishTissue":this.slice.toolType},userInfo:()=>Object(s.s)()},props:["slice","record","mode"],beforeDestroy(){clearTimeout(this.loopHandler),this.loopHandler=0}};e.a=r;const l={data:()=>({auto:"one",leftRoilist:[],aiRoilist:[],humanRoilist:[],options:["ASC-US","LSIL","ASC-H","HSIL","SCC","AGC","AGC-FN","AIS","ACC"],showType:"HSIL",showHumanType:"HSIL",aiResult:{},humanResult:{},cells:{},docResult:{microbe:[],background:[],tps:[],diagnosis:""},showTips:!1,labeltree:[{id:"阳性",label:"阳性",children:[{id:"ASC-US 单个细胞",label:"ASC-US 单个细胞",children:[{id:"ASC-US 单个细胞;核增大到2.5-3倍",label:"核增大到2.5-3倍"},{id:"ASC-US 单个细胞;核膜不规则",label:"核膜不规则"},{id:"ASC-US 单个细胞;核轻度深染",label:"核轻度深染"},{id:"ASC-US 单个细胞;非典型角化细胞",label:"非典型角化细胞"},{id:"ASC-US 单个细胞;核染色质呈粗颗粒状",label:"核染色质呈粗颗粒状"},{id:"ASC-US 单个细胞;不完全挖空化细胞",label:"不完全挖空化细胞"},{id:"ASC-US 单个细胞;无",label:"无"}]},{id:"ASC-US细胞团",label:"ASC-US细胞团",children:[{id:"ASC-US细胞团;核增大到2.5-3倍",label:"核增大到2.5-3倍"},{id:"ASC-US细胞团;核膜不规则",label:"核膜不规则"},{id:"ASC-US细胞团;核轻度深染",label:"核轻度深染"},{id:"ASC-US细胞团;非典型角化细胞",label:"非典型角化细胞"},{id:"ASC-US细胞团;核染色质呈粗颗粒状",label:"核染色质呈粗颗粒状"},{id:"ASC-US细胞团;不完全挖空化细胞",label:"不完全挖空化细胞"},{id:"ASC-US细胞团;无",label:"无"}]},{id:"ASC-H 单个细胞",label:"ASC-H 单个细胞",children:[{id:"ASC-H 单个细胞;核浆比大",label:"核浆比大"},{id:"ASC-H 单个细胞;核染色质加深",label:"核染色质加深"},{id:"ASC-H 单个细胞;核膜不规则",label:"核膜不规则"},{id:"ASC-H 单个细胞;核染色质呈粗颗粒状",label:"核染色质呈粗颗粒状"},{id:"ASC-H 单个细胞;非典型角化细胞",label:"非典型角化细胞"},{id:"ASC-H 单个细胞;无",label:"无"}]},{id:"ASC-H 细胞团",label:"ASC-H 细胞团",children:[{id:"ASC-H 细胞团;核染色质加深",label:"核染色质加深"},{id:"ASC-H 细胞团;核膜不规则",label:"核膜不规则"},{id:"ASC-H 细胞团;核染色质呈粗颗粒状",label:"核染色质呈粗颗粒状"},{id:"ASC-H 细胞团;细胞的大小形态不一，排列紊乱",label:"细胞的大小形态不一，排列紊乱"},{id:"ASC-H 细胞团;核浆比大",label:"核浆比大"},{id:"ASC-H 细胞团;非典型角化细胞",label:"非典型角化细胞"},{id:"ASC-H 细胞团;无",label:"无"}]},{id:"LSIL 单个细胞",label:"LSIL 单个细胞",children:[{id:"LSIL 单个细胞;核增大大于3倍",label:"核增大大于3倍"},{id:"LSIL 单个细胞;异形双核或多核",label:"异形双核或多核"},{id:"LSIL 单个细胞;核染色质呈粗颗粒状",label:"核染色质呈粗颗粒状"},{id:"LSIL 单个细胞;核膜不规则",label:"核膜不规则"},{id:"LSIL 单个细胞;挖空细胞",label:"挖空细胞"},{id:"LSIL 单个细胞;核染色质加深",label:"核染色质加深"},{id:"LSIL 单个细胞;非典型角化细胞",label:"非典型角化细胞"},{id:"LSIL 单个细胞;无",label:"无"}]},{id:"LSIL细胞团",label:"LSIL细胞团",children:[{id:"LSIL细胞团;核增大大于3倍",label:"核增大大于3倍"},{id:"LSIL细胞团;异形双核或多核",label:"异形双核或多核"},{id:"LSIL细胞团;核染色质呈粗颗粒状",label:"核染色质呈粗颗粒状"},{id:"LSIL细胞团;核膜不规则",label:"核膜不规则"},{id:"LSIL细胞团;挖空细胞",label:"挖空细胞"},{id:"LSIL细胞团;核染色质加深",label:"核染色质加深"},{id:"LSIL细胞团;非典型角化细胞",label:"非典型角化细胞"},{id:"LSIL细胞团;无",label:"无"}]},{id:"HSIL 单个细胞",label:"HSIL 单个细胞",children:[{id:"HSIL 单个细胞;核浆比大",label:"核浆比大"},{id:"HSIL 单个细胞;核膜不规则",label:"核膜不规则"},{id:"HSIL 单个细胞;核染色质呈粗颗粒状",label:"核染色质呈粗颗粒状"},{id:"HSIL 单个细胞;核染色质加深",label:"核染色质加深"},{id:"HSIL 单个细胞;非典型角化细胞",label:"非典型角化细胞"},{id:"HSIL 单个细胞;无",label:"无"}]},{id:"HSIL 细胞团",label:"HSIL 细胞团",children:[{id:"HSIL 细胞团;核浆比大",label:"核浆比大"},{id:"HSIL 细胞团;核膜不规则",label:"核膜不规则"},{id:"HSIL 细胞团;核染色质呈粗颗粒状",label:"核染色质呈粗颗粒状"},{id:"HSIL 细胞团;细胞的大小形态不一，排列紊乱",label:"细胞的大小形态不一，排列紊乱"},{id:"HSIL 细胞团;核染色质加深",label:"核染色质加深"},{id:"HSIL 细胞团;非典型角化细胞",label:"非典型角化细胞"},{id:"HSIL 细胞团;无",label:"无"}]},{id:"AGC 单个细胞",label:"AGC 单个细胞",children:[{id:"AGC 单个细胞;核染色质加深",label:"核染色质加深"},{id:"AGC 单个细胞;核膜不规则",label:"核膜不规则"},{id:"AGC 单个细胞;核位上移",label:"核位上移"},{id:"AGC 单个细胞;核仁增大/多核仁",label:"核仁增大/多核仁"},{id:"AGC 单个细胞;无",label:"无"}]},{id:"AGC 细胞团",label:"AGC 细胞团",children:[{id:"AGC 细胞团;细胞团呈菊形团/羽毛状排列",label:"细胞团呈菊形团/羽毛状排列"},{id:"AGC 细胞团;细胞团呈三维簇团结构",label:"细胞团呈三维簇团结构"},{id:"AGC 细胞团;核染色质加深",label:"核染色质加深"},{id:"AGC 细胞团;核膜不规则",label:"核膜不规则"},{id:"AGC 细胞团;胞浆有空泡",label:"胞浆有空泡"},{id:"AGC 细胞团;核大小不一",label:"核大小不一"},{id:"AGC 细胞团;失去极向，排列紊乱",label:"失去极向，排列紊乱"},{id:"AGC 细胞团;核仁增大/多核仁",label:"核仁增大/多核仁"},{id:"AGC 细胞团;腺腔样排列",label:"腺腔样排列"},{id:"AGC 细胞团;无",label:"无"}]}]},{id:"阴性",label:"阴性",children:[{id:"单个细胞",label:"单个细胞",children:[{id:"单个细胞;鳞状上皮细胞",label:"鳞状上皮细胞"},{id:"单个细胞;腺上皮细胞",label:"腺上皮细胞"},{id:"单个细胞;裸核",label:"裸核"},{id:"单个细胞;化生细胞",label:"化生细胞"},{id:"单个细胞;修复细胞",label:"修复细胞"},{id:"单个细胞;角化细胞",label:"角化细胞"},{id:"单个细胞;萎缩细胞",label:"萎缩细胞"},{id:"单个细胞;子宫内膜细胞",label:"子宫内膜细胞"},{id:"单个细胞;放疗反应细胞",label:"放疗反应细胞"},{id:"单个细胞;IUD",label:"IUD"},{id:"单个细胞;无",label:"无"}]},{id:"细胞团",label:"细胞团",children:[{id:"细胞团;鳞状上皮细胞",label:"鳞状上皮细胞"},{id:"细胞团;腺上皮细胞",label:"腺上皮细胞"},{id:"细胞团;化生细胞",label:"化生细胞"},{id:"细胞团;修复细胞",label:"修复细胞"},{id:"细胞团;萎缩细胞",label:"萎缩细胞"},{id:"细胞团;裸核",label:"裸核"},{id:"单个细胞;子宫内膜细胞",label:"子宫内膜细胞"},{id:"单个细胞;放疗反应细胞",label:"放疗反应细胞"},{id:"单个细胞;IUD",label:"IUD"},{id:"细胞团;无",label:"无"}]}]},{id:"微生物",label:"微生物",children:[{id:"滴虫",label:"滴虫"},{id:"霉菌",label:"霉菌"},{id:"线索",label:"线索"},{id:"放线菌",label:"放线菌"},{id:"疱疹",label:"疱疹"}]},{id:"异物",label:"异物",children:[{id:"絮状杂质",label:"絮状杂质"},{id:"黏液丝",label:"黏液丝"},{id:"细胞折痕",label:"细胞折痕"},{id:"无",label:"无"}]},{id:"炎性细胞",label:"炎性细胞",children:[{id:"单个炎性细胞",label:"单个炎性细胞"},{id:"炎性细胞团",label:"炎性细胞团"}]},{id:"乳酸杆菌",label:"乳酸杆菌"},{id:"不确定",label:"不确定"}],roiTypeOpitions:{HSIL:"#FF8A01","ASC-H":"#FF8A01",LSIL:"#FF8A01","ASC-US":"#FF8A01",AGC:"#FF8A01","阴性":"#039D12","絮状杂质":"#039D12","黏液丝":"#039D12","细胞折痕":"#039D12","滴虫":"#0000FF","霉菌":"#0000FF","线索":"#0000FF","放线菌":"#0000FF","疱疹":"#0000FF","不确定":"yellow","乳酸杆菌":"green"},contextmenuPosition:null,observer:null,remark:null,curModule:"cellresult",clickTimer:null}),methods:{goTocurRoi(t,e){this.curROIChange(t,e),this.listChangeCurrent()},showMenu(t,e,i){if((!t.type||t.button)&&(t.preventDefault(),0!=Object.keys(this.curRois).length&&!Object.keys(this.curRois).every(t=>t!=e.id))){var s=t.currentTarget,n=t.offsetX,a=t.offsetY,o=(s.offsetWidth,s.offsetHeight);if(this.contextmenuPosition={},this.contextmenuPosition.hd="left",this.contextmenuPosition.vd=a>o/2?"bottom":"top",this.menuPosition={x:n,y:a},this.currentItem="",this.curRois[e.id]){if("string"==typeof e.doctorDiagnosis)return;this.labeltree.forEach(t=>{e.doctorDiagnosis&&e.doctorDiagnosis.includes(t.id)?this.currentItem=t.id+":"+[t.id]:t.children&&t.children.forEach(i=>{if(e.doctorDiagnosis&&e.doctorDiagnosis.includes(i.id))this.currentItem=t.id+":"+[i.id];else if(i.children){let s=[];i.children.forEach(n=>{e.doctorDiagnosis&&e.doctorDiagnosis.includes(n.id)&&(s.push(n.id),this.currentItem=t.id+":"+i.id+":"+s)})}})}),this.newover=this.currentItem.substring(0,this.currentItem.lastIndexOf(":"))}}},async setAnnotation(t){this.remark=t,"string"==typeof t&&(this.remark=[t],this.contextmenuPosition=null,this.currentItem="")},setShowType(){let t=this.aiResult.cells,e="HSIL";if(t)return t.HSIL.num?e="HSIL":t["ASC-H"].num?e="ASC-H":t.LSIL.num?e="LSIL":t.ASCUS.num?e="ASCUS":t.AGC.num?e="AGC":t["滴虫"].num?e="滴虫":t["霉菌"].num?e="霉菌":t["线索"].num?e="线索":t["放线菌"].num?e="放线菌":t["疱疹"].num&&(e="疱疹"),e},getRoiColor(){return["单个细胞","细胞团"].includes(this.remark[0].split(";")[0])?"green":["ASC-US 单个细胞","ASC-US细胞团","ASC-H 单个细胞","ASC-H 细胞团","LSIL 单个细胞","LSIL细胞团","HSIL 单个细胞","HSIL 细胞团","AGC 单个细胞","AGC 细胞团"].includes(this.remark[0].split(";")[0])?"orange":["单个炎性细胞","炎性细胞团"].includes(this.remark[0].split(";")[0])?"green":["絮状杂质","黏液丝","细胞折痕","无"].includes(this.remark[0].split(";")[0])?"#039D12":{"滴虫":"#0000FF","霉菌":"#0000FF","线索":"#0000FF","放线菌":"#0000FF","疱疹":"#0000FF","不确定":"yellow","乳酸杆菌":"green"}[this.remark[0]]},async changRoiType(){for(var t in this.curRois){let e=this.curRois[t];if(e.dashed)this.curRois[t]=Object.assign({},e,{strokeColor:this.getRoiColor(),doctorDiagnosis:this.remark});else{let t=Object.assign({},{path:e.path,dashed:1,doctorDiagnosis:this.remark,strokeColor:this.getRoiColor(),ai_type:"human_tl",mark_type:1,method:"rectangle"});await Object(s.h)(this.record.id,this.slice.id,t)}}var e=Object.assign({},this.curRois),i=Object.assign({},i,...Object.values(e).filter(t=>t.dashed).map(t=>({[t.id]:t})));this.curRois={},Object.keys(i).length&&(this.loading=!0,await Object(s.e)(this.record.id,this.slice.id,"human_tl",Object.values(i).map(t=>({id:t.id,strokeColor:t.strokeColor,doctorDiagnosis:t.doctorDiagnosis}))),this.loading=!1),this.leftRoilist=await Object(s.n)(this.record.id,this.slice.id,this.curLevel,this.alg),this.humanResult=await this.getHumanResult(),this.humanRoilist=this.humanResult[this.showHumanType].data,this.remark=null},changeImage(t){this.$set(t,"image",1-(t.image||0)),this.roiChanged("image",[t])},change(t,e){switch("阴性"===t&&(this.docResult.tps=[]),this.docResult[e]=t,e){case"diagnosis":case"tps":case"microbe":case"background":this.check("resetOpinion");break;default:this.check()}},accept(){this.docResult=Object.assign({},{microbe:this.aiResult.microbe,tps:[this.aiResult.diagnosis[1]],diagnosis:this.aiResult.diagnosis[0],background:[]}),this.check("resetOpinion")},clearCheckReslut(){this.$confirm("确认清空复核结果？","提示",{cancelTextButtom:"取消",confirmTextButtom:"确定"}).then(()=>{this.docResult={microbe:[],background:[],tps:[],diagnosis:""},this.check("resetOpinion")}).catch(()=>!1)},check(t){this.$set(this.slice,"check_result",this.docResult.diagnosis+" "+this.docResult.tps.join("+")+" "+this.docResult.microbe.join(",")+" "+this.docResult.background.join(",")),this.$set(this.slice,"alg",this.slice.toolType),this.$emit("save","noListUpdate"+(t||""))},async toogleType(t){this.showType=t,this.aiRoilist=this.aiResult.cells[t].data,this.$nextTick(()=>{let t=this.$refs.aiRoilist;t&&(t.scrollTop=0,t.removeEventListener("scroll",this.scrollHander),t.addEventListener("scroll",this.scrollHander))}),this.startOberserve()},async toogleHumanType(t){this.showHumanType=t,this.humanRoilist=this.humanResult[t].data},async getRoi(t){let{x1:e,y1:i,x2:n,y2:a,z:o}=t;this.curLevel={x:[e,n],y:[i,a],z:o},this.leftRoilist.length||(this.leftRoilist=[...await Object(s.n)(this.record.id,this.slice.id,this.curLevel,this.alg)]),this.leftRoilist=[...await Object(s.n)(this.record.id,this.slice.id,this.curLevel,this.alg)]},async draw(t,e){t.strokeColor="yellow",t.mark_type=1,t.dashed=1,t.ai_type="human_tl",t.doctorDiagnosis="无",t.id=await Object(s.h)(this.record.id,this.slice.id,t),t.id&&(this.curROIChange(t,e),this.leftRoilist=[...this.leftRoilist,t],this.humanResult=await this.getHumanResult(),this.humanRoilist=this.humanResult[this.showHumanType].data,this.IsOutFrame())},async delCurRoi(t){if(t)this.loading=!0,await Object(s.i)(this.record.id,this.slice.id,"human_tl",[t.id],null),this.loading=!1,this.curRois[t.id]&&(delete this.curRois[t.id],this.curRois=Object.assign({},this.curRois)),this.humanResult=await this.getHumanResult(),this.humanRoilist=this.humanResult[this.showHumanType].data,this.leftRoilist=await Object(s.n)(this.record.id,this.slice.id,this.curLevel,this.slice.toolType);else if(await this.$confirm(this.$t("analaysisPanel.delete"),{confirmButtonText:this.$t("confirm.confirm"),cancelButtonText:this.$t("confirm.quit"),type:"warning"}).catch(()=>{})){let t=Object.values(this.curRois).filter(t=>t.dashed).map(t=>t.id);if(!t.length)return;this.loading=!0,await Object(s.i)(this.record.id,this.slice.id,"human_tl",t,this.$refs.osd.scope),this.loading=!1,this.humanResult=await this.getHumanResult(),this.humanRoilist=this.humanResult[this.showHumanType].data,this.curRois={},this.leftRoilist=await Object(s.n)(this.record.id,this.slice.id,this.curLevel,this.slice.toolType)}},getAlgorithmResult(t=this.record.id,e=this.slice.id,i=this.slice.filename){Object(s.b)("ai/getresult",{caseid:t,fileid:e,filename:i,type:this.slice.toolType,other:this.config&&this.config.mode?"cs":""}).then(async i=>{this.lineup=i.data.rank,i.data.done?(this.showbutton=!0,this.loopHandler=0,-1==i.data.rank&&([this.aiResult,this.leftRoilist]=await Promise.all([this.getAiResult(),Object(s.n)(t,e,this.curLevel,this.alg)]),this.showType=this.setShowType(),this.aiRoilist=this.aiResult.cells[this.showType].data,this.cells=this.aiResult.cells,this.$set(this.slice,"ai_suggest",this.aiResult.diagnosis[0]+" "+this.aiResult.diagnosis[1]+" "+this.aiResult.microbe.join(",")),this.$set(this.slice,"cell_num",this.aiResult.cell_num),this.$set(this.slice,"slide_quality",this.aiResult.slide_quality)),this.$emit("save","getInfo"),this.$emit("reAnalyEnd"),this.$set(this.slice,"ai_dict",Object.assign(this.slice.ai_dict,{[this.slice.toolType+"Started"]:!1})),this.startOberserve()):(this.showbutton=!1,this.loopHandler=setTimeout(()=>{this.getAlgorithmResult()},5e3))})},async getAiResult(){return new Promise(t=>{Object(s.b)(`slice/getROIList?companyid=${Object(s.s)().company}`,{caseid:this.record.id,fileid:this.slice.id,ai_type:this.slice.toolType,other:this.config&&this.config.mode?"cs":"",patternId:this.mode&&this.mode.id}).then(({data:e})=>{e.ROIS.length?t(e.ROIS[0].aiResult):t({})}).catch(e=>t({}))})},async getHumanResult(){return new Promise(t=>{Object(s.b)(`slice/getROIList?companyid=${Object(s.s)().company}`,{caseid:this.record.id,fileid:this.slice.id,ai_type:"human_tl",other:this.config&&this.config.mode?"cs":""}).then(({data:e})=>{t(e.ROIS)}).catch(e=>t({}))})},async startAnalyze(t=this.record.id,e=this.slice.id,i=this.slice.filename){this.$set(this.slice,"ai_dict",Object.assign(this.slice.ai_dict,{[this.slice.toolType+"Started"]:!0})),this.$set(this.slice,"alg",this.slice.toolType),this.$set(this.slice,"ai_suggest",null),this.$set(this.slice,"check_result",null),this.$set(this.slice,"suggest",null),this.$set(this.slice,"cell_num",null),this.$set(this.slice,"slide_quality",""),this.removeObserver(),this.showbutton=!1,this.auto="one",await Object(s.r)(t,e,i,this.slice.toolType,this.config&&this.config.mode?"cs":"",null,this.mode.id),this.leftRoilist=await Object(s.n)(this.record.id,this.slice.id,this.curLevel,this.slice.toolType),this.aiResult=await this.getAiResult(),this.humanResult=await this.getHumanResult(),this.aiRoilist=a.a.get(this.aiResult,`cells.${this.showType}.data`)||[],this.humanRoilist=a.a.get(this.humanResult,`${this.showHumanType}.data`)||[],this.$emit("save","getInfo"),Object.values(this.curRois).map(t=>this.leftRoilist.every(e=>t.id!=e.id)?delete this.curRois[t.id]:""),this.getAlgorithmResult()},canceltesk(){Object(s.b)("ai/revokeTask",{caseid:this.record.id,fileid:this.slice.id,type:this.slice.toolType,other:this.config&&this.config.mode?"cs":""}).then(async t=>{0==t.code&&(clearTimeout(this.loopHandler),this.loopHandler=0,this.showbutton=!0,this.$set(this.slice,"ai_dict",Object.assign(this.slice.ai_dict,{[this.slice.toolType+"Started"]:!1})),this.aiResult=await this.getAiResult(),this.cells=this.aiResult.cells)}).catch(t=>console.log(t))},scrollHander(){let t=this.$refs.aiRoilist;t.scrollTop+t.clientHeight==t.scrollHeight&&this.cells[this.showType].num>100?this.showTips=!0:this.showTips=!1},startOberserve(){this.observer&&this.removeObserver(),this.$nextTick(()=>{if(this.aiRoilist.length){document.querySelectorAll(".img-content img").forEach(t=>{this.observer&&this.observer.observe(t)})}})},removeObserver(){document.querySelectorAll(".img-content img").forEach(t=>{this.observer.disconnect(t)})},changeTab(t){this.auto!==t&&(this.auto=t,"one"===t&&this.startOberserve())}},async mounted(){if(this.aiResult=await this.getAiResult(),this.humanResult=await this.getHumanResult(),this.showType=this.setShowType(),this.aiResult.cells&&(this.aiRoilist=this.aiResult.cells[this.showType].data||[],this.cells=this.aiResult.cells),this.humanRoilist=this.humanResult[this.showHumanType].data||[],this.slice.alg===this.slice.toolType&&this.slice.check_result){let t=this.slice.check_result.split(" ");this.docResult={diagnosis:t[0],microbe:t[2]?t[2].split(","):[],tps:t[1]?t[1].split("+"):[],background:t[3]?t[3].split(","):[]}}this.observer=new IntersectionObserver(t=>{t.forEach(t=>{t.intersectionRatio>0&&!t.target.src&&(t.target.src=t.target.dataset.src)})}),this.startOberserve(),this.$nextTick(()=>{let t=this.$refs.aiRoilist;t&&t.removeEventListener("scroll",this.scrollHander),t&&t.addEventListener("scroll",this.scrollHander)})},props:["slice","record","mode"],beforeDestroy(){let t=this.$refs.aiRoilist;t&&t.removeEventListener("scroll",this.scrollHander),this.removeObserver(),this.aiResult=this.humanResult=this.humanRoilist=[]},watch:{contextmenuPosition:{handler(){!this.contextmenuPosition&&this.remark&&this.changRoiType()}}}};e.c=l;const c={data:()=>({auto:"one",leftRoilist:[],aiRoilist:[],humanRoilist:[],options:["ASC-US","LSIL","ASC-H","HSIL","SCC","AGC","AGC-FN","AIS","ACC"],showType:"HSIL",showHumanType:"HSIL",aiResult:{},humanResult:{},cells:{},docResult:{microbe:[],background:[],tps:[],diagnosis:"",dnaResult:"",suggest:""},showTips:!1,labeltree:[{id:"阳性",label:"阳性",children:[{id:"HSIL",label:"HSIL"},{id:"ASC-H",label:"ASC-H"},{id:"LSIL",label:"LSIL"},{id:"ASC-US",label:"ASC-US"},{id:"AGC",label:"AGC"}]},{id:"阴性",label:"阴性"},{id:"微生物",label:"微生物",children:[{id:"滴虫",label:"滴虫"},{id:"霉菌",label:"霉菌"},{id:"线索",label:"线索"},{id:"放线菌",label:"放线菌"},{id:"疱疹",label:"疱疹"}]},{id:"异物",label:"异物"},{id:"不确定",label:"不确定"}],roiTypeOpitions:{HSIL:"#FF8A01","ASC-H":"#FF8A01",LSIL:"#FF8A01","ASC-US":"#FF8A01",AGC:"#FF8A01","阴性":"#039D12","异物":"#039D12","滴虫":"#0000FF","霉菌":"#0000FF","线索":"#0000FF","放线菌":"#0000FF","疱疹":"#0000FF","不确定":"yellow"},contextmenuPosition:null,observer:null,curModule:"cellresult",clickTimer:null}),methods:{goTocurRoi(t,e){this.curROIChange(t,e),this.listChangeCurrent()},showMenu(t,e){if((!t.type||t.button)&&(t.preventDefault(),0!=Object.keys(this.curRois).length&&!Object.keys(this.curRois).every(t=>t!=e.id))){var i=t.currentTarget,s=t.offsetX,n=t.offsetY,a=i.offsetWidth,o=i.offsetHeight;if(this.contextmenuPosition={},this.contextmenuPosition.hd=s>a/2?"right":"left",this.contextmenuPosition.vd=n>o/2?"bottom":"top",this.menuPosition={x:s,y:n},this.curRois[e.id]){let t=this.labeltree.find(t=>t.id==e.doctorDiagnosis),i=this.labeltree.filter(t=>t.children);if(t)this.currentItem=t.id+":"+t.id;else{let t=[];i.forEach(e=>{t.push(e.children.map(t=>Object.assign({},t,{fatherId:e.id})))});let s=t.flat().find(t=>t.id==e.doctorDiagnosis);this.currentItem=s?s.fatherId+":"+e.doctorDiagnosis:e.doctorDiagnosis+":"+e.doctorDiagnosis}this.newover=this.currentItem.substring(0,this.currentItem.lastIndexOf(":"))}}},async setAnnotation(t){for(var e in this.contextmenuPosition=null,this.curRois){let i=this.curRois[e];if(i.dashed)this.curRois[e]=Object.assign({},i,{strokeColor:this.roiTypeOpitions[t],doctorDiagnosis:t});else{let e=Object.assign({},{path:i.path,dashed:1,doctorDiagnosis:t,strokeColor:this.roiTypeOpitions[t],ai_type:"human_tl",mark_type:1,method:"rectangle"});await Object(s.h)(this.record.id,this.slice.id,e)}}var i=Object.assign({},this.curRois),n=Object.assign({},n,...Object.values(i).filter(t=>t.dashed).map(t=>({[t.id]:t})));this.curRois={},Object.keys(n).length&&(this.loading=!0,await Object(s.e)(this.record.id,this.slice.id,"human_tl",Object.values(n).map(t=>({id:t.id,strokeColor:t.strokeColor,doctorDiagnosis:t.doctorDiagnosis}))),this.loading=!1),this.leftRoilist=await Object(s.n)(this.record.id,this.slice.id,this.curLevel,this.alg),this.humanResult=await this.getHumanResult(),this.humanRoilist=this.humanResult[this.showHumanType].data},setShowType(){let t=this.aiResult.cells,e="HSIL";if(t)return t.HSIL.num?e="HSIL":t["ASC-H"].num?e="ASC-H":t.LSIL.num?e="LSIL":t.ASCUS.num?e="ASCUS":t.AGC.num?e="AGC":t["萎缩性改变"].num?e="萎缩性改变":t["修复细胞"].num?e="修复细胞":t["化生细胞"].num?e="化生细胞":t["腺上皮细胞"].num?e="腺上皮细胞":t["炎性细胞"].num?e="炎性细胞":t["滴虫"].num?e="滴虫":t["霉菌"].num?e="霉菌":t["线索"].num?e="线索":t["放线菌"].num?e="放线菌":t["疱疹"].num&&(e="疱疹"),e},changeImage(t){this.$set(t,"image",1-(t.image||0)),this.roiChanged("image",[t])},changeImages(t){let e;e=t.map(t=>(this.$set(t,"image",1-(t.image||0)),t)),this.roiChanged("image",e)},change(t,e){switch("阴性"===t&&(this.docResult.tps=[]),this.docResult[e]=t,e){case"diagnosis":case"tps":case"microbe":case"background":this.check("resetOpinion");break;default:this.check()}},accept(t){"dna"==t?this.docResult.dnaResult=this.aiResult.dna_diagnosis:this.docResult=Object.assign({},{microbe:this.aiResult.microbe,tps:[this.aiResult.diagnosis[1]],diagnosis:this.aiResult.diagnosis[0],background:[],dnaResult:this.docResult.dnaResult,suggest:this.docResult.suggest}),this.check("resetOpinion")},clearCheckReslut(t){this.$confirm("确认清空复核结果？","提示",{cancelTextButtom:"取消",confirmTextButtom:"确定"}).then(()=>{"dna"==t?this.docResult.dnaResult="":this.docResult={microbe:[],background:[],tps:[],diagnosis:"",dnaResult:this.docResult.dnaResult,suggest:""},this.check("resetOpinion")}).catch(()=>!1)},check(t){this.$set(this.slice,"check_result",this.docResult.diagnosis+" "+this.docResult.tps.join("+")+" "+this.docResult.microbe.join(",")+" "+this.docResult.background.join(",")+";"+this.docResult.dnaResult+";"+this.docResult.suggest),this.$set(this.slice,"alg",this.slice.toolType),this.$emit("save","noListUpdate"+(t||""))},async toogleType(t){this.showType=t,this.aiRoilist=this.aiResult.cells[t].data,this.$nextTick(()=>{let t=this.$refs.aiRoilist;t&&(t.scrollTop=0,t.removeEventListener("scroll",this.scrollHander),t.addEventListener("scroll",this.scrollHander))}),this.startOberserve()},async toogleHumanType(t){this.showHumanType=t,this.humanRoilist=this.humanResult[t].data},async getRoi(t){let{x1:e,y1:i,x2:n,y2:a,z:o}=t;this.curLevel={x:[e,n],y:[i,a],z:o},this.leftRoilist.length||(this.leftRoilist=await Object(s.n)(this.record.id,this.slice.id,this.curLevel,this.slice.toolType)),this.leftRoilist=await Object(s.n)(this.record.id,this.slice.id,this.curLevel,this.slice.toolType)},async draw(t,e){t.strokeColor="yellow",t.mark_type=1,t.dashed=1,t.ai_type="human_tl",t.doctorDiagnosis="无",t.id=await Object(s.h)(this.record.id,this.slice.id,t),t.id&&(this.curROIChange(t,e),this.leftRoilist=[...this.leftRoilist,t],this.humanResult=await this.getHumanResult(),this.humanRoilist=this.humanResult[this.showHumanType].data,this.IsOutFrame())},async delCurRoi(t){if(t)this.loading=!0,await Object(s.i)(this.record.id,this.slice.id,"human_tl",[t.id],null),this.loading=!1,this.curRois[t.id]&&(delete this.curRois[t.id],this.curRois=Object.assign({},this.curRois)),this.humanResult=await this.getHumanResult(),this.humanRoilist=this.humanResult[this.showHumanType].data,this.leftRoilist=await Object(s.n)(this.record.id,this.slice.id,this.curLevel,this.slice.toolType);else if(await this.$confirm(this.$t("analaysisPanel.delete"),{confirmButtonText:this.$t("confirm.confirm"),cancelButtonText:this.$t("confirm.quit"),type:"warning"}).catch(()=>{})){let t=Object.values(this.curRois).filter(t=>t.dashed).map(t=>t.id);if(!t.length)return;this.loading=!0,await Object(s.i)(this.record.id,this.slice.id,"human_tl",t,this.$refs.osd.scope),this.loading=!1,this.humanResult=await this.getHumanResult(),this.humanRoilist=this.humanResult[this.showHumanType].data,this.curRois={},this.leftRoilist=await Object(s.n)(this.record.id,this.slice.id,this.curLevel,this.slice.toolType)}},getAlgorithmResult(t=this.record.id,e=this.slice.id,i=this.slice.filename){Object(s.b)("ai/getresult",{caseid:t,fileid:e,filename:i,type:this.slice.toolType,other:this.config&&this.config.mode?"cs":""}).then(async t=>{this.lineup=t.data.rank,t.data.done?(this.showbutton=!0,this.loopHandler=0,-1==t.data.rank&&(this.aiResult=await this.getAiResult(),this.showType=this.setShowType(),this.aiResult.cells&&(this.aiRoilist=this.aiResult.cells[this.showType].data,this.cells=this.aiResult.cells),this.$set(this.slice,"ai_suggest",this.aiResult.diagnosis[0]+" "+this.aiResult.diagnosis[1]+" "+this.aiResult.microbe.join(",")),this.$set(this.slice,"cell_num",this.aiResult.cell_num),this.$set(this.slice,"slide_quality",this.aiResult.slide_quality)),this.$emit("save","getInfo"),this.$set(this.slice,"ai_dict",Object.assign(this.slice.ai_dict,{[this.slice.toolType+"Started"]:!1})),this.startOberserve()):(this.showbutton=!1,this.loopHandler=setTimeout(()=>{this.getAlgorithmResult()},5e3))})},async getAiResult(){return new Promise(t=>{Object(s.b)(`slice/getROIList?companyid=${Object(s.s)().company}`,{caseid:this.record.id,fileid:this.slice.id,ai_type:this.slice.toolType,other:this.config&&this.config.mode?"cs":""}).then(({data:e})=>{e.ROIS.length?t(e.ROIS[0].aiResult):t({})}).catch(e=>t({}))})},async getHumanResult(){return new Promise(t=>{Object(s.b)(`slice/getROIList?companyid=${Object(s.s)().company}`,{caseid:this.record.id,fileid:this.slice.id,ai_type:"human_tl",other:this.config&&this.config.mode?"cs":""}).then(({data:e})=>{t(e.ROIS)}).catch(e=>t({}))})},async startAnalyze(t=this.record.id,e=this.slice.id,i=this.slice.filename){this.$set(this.slice,"ai_dict",Object.assign(this.slice.ai_dict,{[this.slice.toolType+"Started"]:!0})),this.$set(this.slice,"alg",this.slice.toolType),this.$set(this.slice,"ai_suggest",null),this.$set(this.slice,"check_result",null),this.$set(this.slice,"suggest",null),this.$set(this.slice,"cell_num",null),this.$set(this.slice,"slide_quality",""),this.removeObserver(),this.showbutton=!1,this.auto="one",await Object(s.r)(t,e,i,this.slice.toolType,this.config&&this.config.mode?"cs":"",null,this.mode.id),this.leftRoilist=await Object(s.n)(this.record.id,this.slice.id,this.curLevel,this.slice.toolType),this.aiResult=await this.getAiResult(),this.humanResult=await this.getHumanResult(),this.aiResult.cells&&(this.aiRoilist=this.aiResult.cells[this.showType].data||[]),this.humanRoilist=this.humanResult[this.showHumanType].data||[],Object.values(this.curRois).map(t=>this.leftRoilist.every(e=>t.id!=e.id)?delete this.curRois[t.id]:""),this.getAlgorithmResult()},canceltesk(){Object(s.b)("ai/revokeTask",{caseid:this.record.id,fileid:this.slice.id,type:this.slice.toolType,other:this.config&&this.config.mode?"cs":""}).then(async t=>{0==t.code&&(clearTimeout(this.loopHandler),this.loopHandler=0,this.showbutton=!0,this.$set(this.slice,"ai_dict",Object.assign(this.slice.ai_dict,{[this.slice.toolType+"Started"]:!1})),this.aiResult=await this.getAiResult(),this.cells=this.aiResult.cells)}).catch(t=>console.log(t))},scrollHander(){let t=this.$refs.aiRoilist;t.scrollTop+t.clientHeight==t.scrollHeight&&this.cells[this.showType].num>100?this.showTips=!0:this.showTips=!1},startOberserve(){this.observer&&this.removeObserver(),this.$nextTick(()=>{if(this.aiRoilist.length){document.querySelectorAll(".img-content img").forEach(t=>{this.observer.observe(t)})}})},removeObserver(){document.querySelectorAll(".img-content img").forEach(t=>{this.observer.disconnect(t)})},changeTab(t){this.auto!==t&&(this.auto=t,"one"===t&&this.startOberserve())}},async mounted(){if(this.aiResult=await this.getAiResult(),this.humanResult=await this.getHumanResult(),this.showType=this.setShowType(),this.aiResult.cells&&(this.aiRoilist=this.aiResult.cells[this.showType].data||[],this.cells=this.aiResult.cells),this.humanRoilist=this.humanResult[this.showHumanType].data||[],this.slice.alg===this.slice.toolType&&this.slice.check_result){let t=this.slice.check_result.split(";");if(t[0]){let e=t[0].split(" ");this.docResult={diagnosis:e[0],microbe:e[2]?e[2].split(","):[],tps:e[1]?e[1].split("+"):[],background:e[3]?e[3].split(","):[],dnaResult:t[1],suggest:t[2]}}else t[1]&&(this.docResult={microbe:[],background:[],tps:[],diagnosis:"",dnaResult:t[1],suggest:t[2]})}this.observer=new IntersectionObserver(t=>{t.forEach(t=>{t.intersectionRatio>0&&!t.target.src&&(t.target.src=t.target.dataset.src)})}),this.startOberserve(),this.$nextTick(()=>{let t=this.$refs.aiRoilist;t&&t.removeEventListener("scroll",this.scrollHander),t&&t.addEventListener("scroll",this.scrollHander)})},props:["slice","record"],beforeDestroy(){let t=this.$refs.aiRoilist;t&&t.removeEventListener("scroll",this.scrollHander),this.removeObserver()}};e.b=c},EIPk:function(t,e){},EKta:function(t,e,i){"use strict";e.byteLength=function(t){var e=c(t),i=e[0],s=e[1];return 3*(i+s)/4-s},e.toByteArray=function(t){for(var e,i=c(t),s=i[0],o=i[1],r=new a(function(t,e,i){return 3*(e+i)/4-i}(0,s,o)),l=0,u=o>0?s-4:s,h=0;h<u;h+=4)e=n[t.charCodeAt(h)]<<18|n[t.charCodeAt(h+1)]<<12|n[t.charCodeAt(h+2)]<<6|n[t.charCodeAt(h+3)],r[l++]=e>>16&255,r[l++]=e>>8&255,r[l++]=255&e;2===o&&(e=n[t.charCodeAt(h)]<<2|n[t.charCodeAt(h+1)]>>4,r[l++]=255&e);1===o&&(e=n[t.charCodeAt(h)]<<10|n[t.charCodeAt(h+1)]<<4|n[t.charCodeAt(h+2)]>>2,r[l++]=e>>8&255,r[l++]=255&e);return r},e.fromByteArray=function(t){for(var e,i=t.length,n=i%3,a=[],o=0,r=i-n;o<r;o+=16383)a.push(u(t,o,o+16383>r?r:o+16383));1===n?(e=t[i-1],a.push(s[e>>2]+s[e<<4&63]+"==")):2===n&&(e=(t[i-2]<<8)+t[i-1],a.push(s[e>>10]+s[e>>4&63]+s[e<<2&63]+"="));return a.join("")};for(var s=[],n=[],a="undefined"!=typeof Uint8Array?Uint8Array:Array,o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",r=0,l=o.length;r<l;++r)s[r]=o[r],n[o.charCodeAt(r)]=r;function c(t){var e=t.length;if(e%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var i=t.indexOf("=");return-1===i&&(i=e),[i,i===e?0:4-i%4]}function u(t,e,i){for(var n,a,o=[],r=e;r<i;r+=3)n=(t[r]<<16&16711680)+(t[r+1]<<8&65280)+(255&t[r+2]),o.push(s[(a=n)>>18&63]+s[a>>12&63]+s[a>>6&63]+s[63&a]);return o.join("")}n["-".charCodeAt(0)]=62,n["_".charCodeAt(0)]=63},ELz9:function(t,e){},EZ6I:function(t,e){},EuHb:function(t,e){},EuP9:function(t,e,i){"use strict";(function(t){
/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <feross@feross.org> <http://feross.org>
 * @license  MIT
 */
var s=i("EKta"),n=i("ujcs"),a=i("sOR5");function o(){return l.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function r(t,e){if(o()<e)throw new RangeError("Invalid typed array length");return l.TYPED_ARRAY_SUPPORT?(t=new Uint8Array(e)).__proto__=l.prototype:(null===t&&(t=new l(e)),t.length=e),t}function l(t,e,i){if(!(l.TYPED_ARRAY_SUPPORT||this instanceof l))return new l(t,e,i);if("number"==typeof t){if("string"==typeof e)throw new Error("If encoding is specified then the first argument must be a string");return h(this,t)}return c(this,t,e,i)}function c(t,e,i,s){if("number"==typeof e)throw new TypeError('"value" argument must not be a number');return"undefined"!=typeof ArrayBuffer&&e instanceof ArrayBuffer?function(t,e,i,s){if(e.byteLength,i<0||e.byteLength<i)throw new RangeError("'offset' is out of bounds");if(e.byteLength<i+(s||0))throw new RangeError("'length' is out of bounds");e=void 0===i&&void 0===s?new Uint8Array(e):void 0===s?new Uint8Array(e,i):new Uint8Array(e,i,s);l.TYPED_ARRAY_SUPPORT?(t=e).__proto__=l.prototype:t=d(t,e);return t}(t,e,i,s):"string"==typeof e?function(t,e,i){"string"==typeof i&&""!==i||(i="utf8");if(!l.isEncoding(i))throw new TypeError('"encoding" must be a valid string encoding');var s=0|v(e,i),n=(t=r(t,s)).write(e,i);n!==s&&(t=t.slice(0,n));return t}(t,e,i):function(t,e){if(l.isBuffer(e)){var i=0|p(e.length);return 0===(t=r(t,i)).length?t:(e.copy(t,0,0,i),t)}if(e){if("undefined"!=typeof ArrayBuffer&&e.buffer instanceof ArrayBuffer||"length"in e)return"number"!=typeof e.length||(s=e.length)!=s?r(t,0):d(t,e);if("Buffer"===e.type&&a(e.data))return d(t,e.data)}var s;throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}(t,e)}function u(t){if("number"!=typeof t)throw new TypeError('"size" argument must be a number');if(t<0)throw new RangeError('"size" argument must not be negative')}function h(t,e){if(u(e),t=r(t,e<0?0:0|p(e)),!l.TYPED_ARRAY_SUPPORT)for(var i=0;i<e;++i)t[i]=0;return t}function d(t,e){var i=e.length<0?0:0|p(e.length);t=r(t,i);for(var s=0;s<i;s+=1)t[s]=255&e[s];return t}function p(t){if(t>=o())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+o().toString(16)+" bytes");return 0|t}function v(t,e){if(l.isBuffer(t))return t.length;if("undefined"!=typeof ArrayBuffer&&"function"==typeof ArrayBuffer.isView&&(ArrayBuffer.isView(t)||t instanceof ArrayBuffer))return t.byteLength;"string"!=typeof t&&(t=""+t);var i=t.length;if(0===i)return 0;for(var s=!1;;)switch(e){case"ascii":case"latin1":case"binary":return i;case"utf8":case"utf-8":case void 0:return z(t).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*i;case"hex":return i>>>1;case"base64":return N(t).length;default:if(s)return z(t).length;e=(""+e).toLowerCase(),s=!0}}function g(t,e,i){var s=t[e];t[e]=t[i],t[i]=s}function f(t,e,i,s,n){if(0===t.length)return-1;if("string"==typeof i?(s=i,i=0):i>2147483647?i=2147483647:i<-2147483648&&(i=-2147483648),i=+i,isNaN(i)&&(i=n?0:t.length-1),i<0&&(i=t.length+i),i>=t.length){if(n)return-1;i=t.length-1}else if(i<0){if(!n)return-1;i=0}if("string"==typeof e&&(e=l.from(e,s)),l.isBuffer(e))return 0===e.length?-1:m(t,e,i,s,n);if("number"==typeof e)return e&=255,l.TYPED_ARRAY_SUPPORT&&"function"==typeof Uint8Array.prototype.indexOf?n?Uint8Array.prototype.indexOf.call(t,e,i):Uint8Array.prototype.lastIndexOf.call(t,e,i):m(t,[e],i,s,n);throw new TypeError("val must be string, number or Buffer")}function m(t,e,i,s,n){var a,o=1,r=t.length,l=e.length;if(void 0!==s&&("ucs2"===(s=String(s).toLowerCase())||"ucs-2"===s||"utf16le"===s||"utf-16le"===s)){if(t.length<2||e.length<2)return-1;o=2,r/=2,l/=2,i/=2}function c(t,e){return 1===o?t[e]:t.readUInt16BE(e*o)}if(n){var u=-1;for(a=i;a<r;a++)if(c(t,a)===c(e,-1===u?0:a-u)){if(-1===u&&(u=a),a-u+1===l)return u*o}else-1!==u&&(a-=a-u),u=-1}else for(i+l>r&&(i=r-l),a=i;a>=0;a--){for(var h=!0,d=0;d<l;d++)if(c(t,a+d)!==c(e,d)){h=!1;break}if(h)return a}return-1}function _(t,e,i,s){i=Number(i)||0;var n=t.length-i;s?(s=Number(s))>n&&(s=n):s=n;var a=e.length;if(a%2!=0)throw new TypeError("Invalid hex string");s>a/2&&(s=a/2);for(var o=0;o<s;++o){var r=parseInt(e.substr(2*o,2),16);if(isNaN(r))return o;t[i+o]=r}return o}function y(t,e,i,s){return B(z(e,t.length-i),t,i,s)}function R(t,e,i,s){return B(function(t){for(var e=[],i=0;i<t.length;++i)e.push(255&t.charCodeAt(i));return e}(e),t,i,s)}function b(t,e,i,s){return R(t,e,i,s)}function C(t,e,i,s){return B(N(e),t,i,s)}function w(t,e,i,s){return B(function(t,e){for(var i,s,n,a=[],o=0;o<t.length&&!((e-=2)<0);++o)i=t.charCodeAt(o),s=i>>8,n=i%256,a.push(n),a.push(s);return a}(e,t.length-i),t,i,s)}function k(t,e,i){return 0===e&&i===t.length?s.fromByteArray(t):s.fromByteArray(t.slice(e,i))}function x(t,e,i){i=Math.min(t.length,i);for(var s=[],n=e;n<i;){var a,o,r,l,c=t[n],u=null,h=c>239?4:c>223?3:c>191?2:1;if(n+h<=i)switch(h){case 1:c<128&&(u=c);break;case 2:128==(192&(a=t[n+1]))&&(l=(31&c)<<6|63&a)>127&&(u=l);break;case 3:a=t[n+1],o=t[n+2],128==(192&a)&&128==(192&o)&&(l=(15&c)<<12|(63&a)<<6|63&o)>2047&&(l<55296||l>57343)&&(u=l);break;case 4:a=t[n+1],o=t[n+2],r=t[n+3],128==(192&a)&&128==(192&o)&&128==(192&r)&&(l=(15&c)<<18|(63&a)<<12|(63&o)<<6|63&r)>65535&&l<1114112&&(u=l)}null===u?(u=65533,h=1):u>65535&&(u-=65536,s.push(u>>>10&1023|55296),u=56320|1023&u),s.push(u),n+=h}return function(t){var e=t.length;if(e<=$)return String.fromCharCode.apply(String,t);var i="",s=0;for(;s<e;)i+=String.fromCharCode.apply(String,t.slice(s,s+=$));return i}(s)}e.Buffer=l,e.SlowBuffer=function(t){+t!=t&&(t=0);return l.alloc(+t)},e.INSPECT_MAX_BYTES=50,l.TYPED_ARRAY_SUPPORT=void 0!==t.TYPED_ARRAY_SUPPORT?t.TYPED_ARRAY_SUPPORT:function(){try{var t=new Uint8Array(1);return t.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===t.foo()&&"function"==typeof t.subarray&&0===t.subarray(1,1).byteLength}catch(t){return!1}}(),e.kMaxLength=o(),l.poolSize=8192,l._augment=function(t){return t.__proto__=l.prototype,t},l.from=function(t,e,i){return c(null,t,e,i)},l.TYPED_ARRAY_SUPPORT&&(l.prototype.__proto__=Uint8Array.prototype,l.__proto__=Uint8Array,"undefined"!=typeof Symbol&&Symbol.species&&l[Symbol.species]===l&&Object.defineProperty(l,Symbol.species,{value:null,configurable:!0})),l.alloc=function(t,e,i){return function(t,e,i,s){return u(e),e<=0?r(t,e):void 0!==i?"string"==typeof s?r(t,e).fill(i,s):r(t,e).fill(i):r(t,e)}(null,t,e,i)},l.allocUnsafe=function(t){return h(null,t)},l.allocUnsafeSlow=function(t){return h(null,t)},l.isBuffer=function(t){return!(null==t||!t._isBuffer)},l.compare=function(t,e){if(!l.isBuffer(t)||!l.isBuffer(e))throw new TypeError("Arguments must be Buffers");if(t===e)return 0;for(var i=t.length,s=e.length,n=0,a=Math.min(i,s);n<a;++n)if(t[n]!==e[n]){i=t[n],s=e[n];break}return i<s?-1:s<i?1:0},l.isEncoding=function(t){switch(String(t).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},l.concat=function(t,e){if(!a(t))throw new TypeError('"list" argument must be an Array of Buffers');if(0===t.length)return l.alloc(0);var i;if(void 0===e)for(e=0,i=0;i<t.length;++i)e+=t[i].length;var s=l.allocUnsafe(e),n=0;for(i=0;i<t.length;++i){var o=t[i];if(!l.isBuffer(o))throw new TypeError('"list" argument must be an Array of Buffers');o.copy(s,n),n+=o.length}return s},l.byteLength=v,l.prototype._isBuffer=!0,l.prototype.swap16=function(){var t=this.length;if(t%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var e=0;e<t;e+=2)g(this,e,e+1);return this},l.prototype.swap32=function(){var t=this.length;if(t%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var e=0;e<t;e+=4)g(this,e,e+3),g(this,e+1,e+2);return this},l.prototype.swap64=function(){var t=this.length;if(t%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var e=0;e<t;e+=8)g(this,e,e+7),g(this,e+1,e+6),g(this,e+2,e+5),g(this,e+3,e+4);return this},l.prototype.toString=function(){var t=0|this.length;return 0===t?"":0===arguments.length?x(this,0,t):function(t,e,i){var s=!1;if((void 0===e||e<0)&&(e=0),e>this.length)return"";if((void 0===i||i>this.length)&&(i=this.length),i<=0)return"";if((i>>>=0)<=(e>>>=0))return"";for(t||(t="utf8");;)switch(t){case"hex":return A(this,e,i);case"utf8":case"utf-8":return x(this,e,i);case"ascii":return I(this,e,i);case"latin1":case"binary":return O(this,e,i);case"base64":return k(this,e,i);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return M(this,e,i);default:if(s)throw new TypeError("Unknown encoding: "+t);t=(t+"").toLowerCase(),s=!0}}.apply(this,arguments)},l.prototype.equals=function(t){if(!l.isBuffer(t))throw new TypeError("Argument must be a Buffer");return this===t||0===l.compare(this,t)},l.prototype.inspect=function(){var t="",i=e.INSPECT_MAX_BYTES;return this.length>0&&(t=this.toString("hex",0,i).match(/.{2}/g).join(" "),this.length>i&&(t+=" ... ")),"<Buffer "+t+">"},l.prototype.compare=function(t,e,i,s,n){if(!l.isBuffer(t))throw new TypeError("Argument must be a Buffer");if(void 0===e&&(e=0),void 0===i&&(i=t?t.length:0),void 0===s&&(s=0),void 0===n&&(n=this.length),e<0||i>t.length||s<0||n>this.length)throw new RangeError("out of range index");if(s>=n&&e>=i)return 0;if(s>=n)return-1;if(e>=i)return 1;if(e>>>=0,i>>>=0,s>>>=0,n>>>=0,this===t)return 0;for(var a=n-s,o=i-e,r=Math.min(a,o),c=this.slice(s,n),u=t.slice(e,i),h=0;h<r;++h)if(c[h]!==u[h]){a=c[h],o=u[h];break}return a<o?-1:o<a?1:0},l.prototype.includes=function(t,e,i){return-1!==this.indexOf(t,e,i)},l.prototype.indexOf=function(t,e,i){return f(this,t,e,i,!0)},l.prototype.lastIndexOf=function(t,e,i){return f(this,t,e,i,!1)},l.prototype.write=function(t,e,i,s){if(void 0===e)s="utf8",i=this.length,e=0;else if(void 0===i&&"string"==typeof e)s=e,i=this.length,e=0;else{if(!isFinite(e))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");e|=0,isFinite(i)?(i|=0,void 0===s&&(s="utf8")):(s=i,i=void 0)}var n=this.length-e;if((void 0===i||i>n)&&(i=n),t.length>0&&(i<0||e<0)||e>this.length)throw new RangeError("Attempt to write outside buffer bounds");s||(s="utf8");for(var a=!1;;)switch(s){case"hex":return _(this,t,e,i);case"utf8":case"utf-8":return y(this,t,e,i);case"ascii":return R(this,t,e,i);case"latin1":case"binary":return b(this,t,e,i);case"base64":return C(this,t,e,i);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return w(this,t,e,i);default:if(a)throw new TypeError("Unknown encoding: "+s);s=(""+s).toLowerCase(),a=!0}},l.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var $=4096;function I(t,e,i){var s="";i=Math.min(t.length,i);for(var n=e;n<i;++n)s+=String.fromCharCode(127&t[n]);return s}function O(t,e,i){var s="";i=Math.min(t.length,i);for(var n=e;n<i;++n)s+=String.fromCharCode(t[n]);return s}function A(t,e,i){var s=t.length;(!e||e<0)&&(e=0),(!i||i<0||i>s)&&(i=s);for(var n="",a=e;a<i;++a)n+=H(t[a]);return n}function M(t,e,i){for(var s=t.slice(e,i),n="",a=0;a<s.length;a+=2)n+=String.fromCharCode(s[a]+256*s[a+1]);return n}function S(t,e,i){if(t%1!=0||t<0)throw new RangeError("offset is not uint");if(t+e>i)throw new RangeError("Trying to access beyond buffer length")}function T(t,e,i,s,n,a){if(!l.isBuffer(t))throw new TypeError('"buffer" argument must be a Buffer instance');if(e>n||e<a)throw new RangeError('"value" argument is out of bounds');if(i+s>t.length)throw new RangeError("Index out of range")}function F(t,e,i,s){e<0&&(e=65535+e+1);for(var n=0,a=Math.min(t.length-i,2);n<a;++n)t[i+n]=(e&255<<8*(s?n:1-n))>>>8*(s?n:1-n)}function j(t,e,i,s){e<0&&(e=4294967295+e+1);for(var n=0,a=Math.min(t.length-i,4);n<a;++n)t[i+n]=e>>>8*(s?n:3-n)&255}function E(t,e,i,s,n,a){if(i+s>t.length)throw new RangeError("Index out of range");if(i<0)throw new RangeError("Index out of range")}function P(t,e,i,s,a){return a||E(t,0,i,4),n.write(t,e,i,s,23,4),i+4}function D(t,e,i,s,a){return a||E(t,0,i,8),n.write(t,e,i,s,52,8),i+8}l.prototype.slice=function(t,e){var i,s=this.length;if(t=~~t,e=void 0===e?s:~~e,t<0?(t+=s)<0&&(t=0):t>s&&(t=s),e<0?(e+=s)<0&&(e=0):e>s&&(e=s),e<t&&(e=t),l.TYPED_ARRAY_SUPPORT)(i=this.subarray(t,e)).__proto__=l.prototype;else{var n=e-t;i=new l(n,void 0);for(var a=0;a<n;++a)i[a]=this[a+t]}return i},l.prototype.readUIntLE=function(t,e,i){t|=0,e|=0,i||S(t,e,this.length);for(var s=this[t],n=1,a=0;++a<e&&(n*=256);)s+=this[t+a]*n;return s},l.prototype.readUIntBE=function(t,e,i){t|=0,e|=0,i||S(t,e,this.length);for(var s=this[t+--e],n=1;e>0&&(n*=256);)s+=this[t+--e]*n;return s},l.prototype.readUInt8=function(t,e){return e||S(t,1,this.length),this[t]},l.prototype.readUInt16LE=function(t,e){return e||S(t,2,this.length),this[t]|this[t+1]<<8},l.prototype.readUInt16BE=function(t,e){return e||S(t,2,this.length),this[t]<<8|this[t+1]},l.prototype.readUInt32LE=function(t,e){return e||S(t,4,this.length),(this[t]|this[t+1]<<8|this[t+2]<<16)+16777216*this[t+3]},l.prototype.readUInt32BE=function(t,e){return e||S(t,4,this.length),16777216*this[t]+(this[t+1]<<16|this[t+2]<<8|this[t+3])},l.prototype.readIntLE=function(t,e,i){t|=0,e|=0,i||S(t,e,this.length);for(var s=this[t],n=1,a=0;++a<e&&(n*=256);)s+=this[t+a]*n;return s>=(n*=128)&&(s-=Math.pow(2,8*e)),s},l.prototype.readIntBE=function(t,e,i){t|=0,e|=0,i||S(t,e,this.length);for(var s=e,n=1,a=this[t+--s];s>0&&(n*=256);)a+=this[t+--s]*n;return a>=(n*=128)&&(a-=Math.pow(2,8*e)),a},l.prototype.readInt8=function(t,e){return e||S(t,1,this.length),128&this[t]?-1*(255-this[t]+1):this[t]},l.prototype.readInt16LE=function(t,e){e||S(t,2,this.length);var i=this[t]|this[t+1]<<8;return 32768&i?4294901760|i:i},l.prototype.readInt16BE=function(t,e){e||S(t,2,this.length);var i=this[t+1]|this[t]<<8;return 32768&i?4294901760|i:i},l.prototype.readInt32LE=function(t,e){return e||S(t,4,this.length),this[t]|this[t+1]<<8|this[t+2]<<16|this[t+3]<<24},l.prototype.readInt32BE=function(t,e){return e||S(t,4,this.length),this[t]<<24|this[t+1]<<16|this[t+2]<<8|this[t+3]},l.prototype.readFloatLE=function(t,e){return e||S(t,4,this.length),n.read(this,t,!0,23,4)},l.prototype.readFloatBE=function(t,e){return e||S(t,4,this.length),n.read(this,t,!1,23,4)},l.prototype.readDoubleLE=function(t,e){return e||S(t,8,this.length),n.read(this,t,!0,52,8)},l.prototype.readDoubleBE=function(t,e){return e||S(t,8,this.length),n.read(this,t,!1,52,8)},l.prototype.writeUIntLE=function(t,e,i,s){(t=+t,e|=0,i|=0,s)||T(this,t,e,i,Math.pow(2,8*i)-1,0);var n=1,a=0;for(this[e]=255&t;++a<i&&(n*=256);)this[e+a]=t/n&255;return e+i},l.prototype.writeUIntBE=function(t,e,i,s){(t=+t,e|=0,i|=0,s)||T(this,t,e,i,Math.pow(2,8*i)-1,0);var n=i-1,a=1;for(this[e+n]=255&t;--n>=0&&(a*=256);)this[e+n]=t/a&255;return e+i},l.prototype.writeUInt8=function(t,e,i){return t=+t,e|=0,i||T(this,t,e,1,255,0),l.TYPED_ARRAY_SUPPORT||(t=Math.floor(t)),this[e]=255&t,e+1},l.prototype.writeUInt16LE=function(t,e,i){return t=+t,e|=0,i||T(this,t,e,2,65535,0),l.TYPED_ARRAY_SUPPORT?(this[e]=255&t,this[e+1]=t>>>8):F(this,t,e,!0),e+2},l.prototype.writeUInt16BE=function(t,e,i){return t=+t,e|=0,i||T(this,t,e,2,65535,0),l.TYPED_ARRAY_SUPPORT?(this[e]=t>>>8,this[e+1]=255&t):F(this,t,e,!1),e+2},l.prototype.writeUInt32LE=function(t,e,i){return t=+t,e|=0,i||T(this,t,e,4,4294967295,0),l.TYPED_ARRAY_SUPPORT?(this[e+3]=t>>>24,this[e+2]=t>>>16,this[e+1]=t>>>8,this[e]=255&t):j(this,t,e,!0),e+4},l.prototype.writeUInt32BE=function(t,e,i){return t=+t,e|=0,i||T(this,t,e,4,4294967295,0),l.TYPED_ARRAY_SUPPORT?(this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=255&t):j(this,t,e,!1),e+4},l.prototype.writeIntLE=function(t,e,i,s){if(t=+t,e|=0,!s){var n=Math.pow(2,8*i-1);T(this,t,e,i,n-1,-n)}var a=0,o=1,r=0;for(this[e]=255&t;++a<i&&(o*=256);)t<0&&0===r&&0!==this[e+a-1]&&(r=1),this[e+a]=(t/o>>0)-r&255;return e+i},l.prototype.writeIntBE=function(t,e,i,s){if(t=+t,e|=0,!s){var n=Math.pow(2,8*i-1);T(this,t,e,i,n-1,-n)}var a=i-1,o=1,r=0;for(this[e+a]=255&t;--a>=0&&(o*=256);)t<0&&0===r&&0!==this[e+a+1]&&(r=1),this[e+a]=(t/o>>0)-r&255;return e+i},l.prototype.writeInt8=function(t,e,i){return t=+t,e|=0,i||T(this,t,e,1,127,-128),l.TYPED_ARRAY_SUPPORT||(t=Math.floor(t)),t<0&&(t=255+t+1),this[e]=255&t,e+1},l.prototype.writeInt16LE=function(t,e,i){return t=+t,e|=0,i||T(this,t,e,2,32767,-32768),l.TYPED_ARRAY_SUPPORT?(this[e]=255&t,this[e+1]=t>>>8):F(this,t,e,!0),e+2},l.prototype.writeInt16BE=function(t,e,i){return t=+t,e|=0,i||T(this,t,e,2,32767,-32768),l.TYPED_ARRAY_SUPPORT?(this[e]=t>>>8,this[e+1]=255&t):F(this,t,e,!1),e+2},l.prototype.writeInt32LE=function(t,e,i){return t=+t,e|=0,i||T(this,t,e,4,2147483647,-2147483648),l.TYPED_ARRAY_SUPPORT?(this[e]=255&t,this[e+1]=t>>>8,this[e+2]=t>>>16,this[e+3]=t>>>24):j(this,t,e,!0),e+4},l.prototype.writeInt32BE=function(t,e,i){return t=+t,e|=0,i||T(this,t,e,4,2147483647,-2147483648),t<0&&(t=4294967295+t+1),l.TYPED_ARRAY_SUPPORT?(this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=255&t):j(this,t,e,!1),e+4},l.prototype.writeFloatLE=function(t,e,i){return P(this,t,e,!0,i)},l.prototype.writeFloatBE=function(t,e,i){return P(this,t,e,!1,i)},l.prototype.writeDoubleLE=function(t,e,i){return D(this,t,e,!0,i)},l.prototype.writeDoubleBE=function(t,e,i){return D(this,t,e,!1,i)},l.prototype.copy=function(t,e,i,s){if(i||(i=0),s||0===s||(s=this.length),e>=t.length&&(e=t.length),e||(e=0),s>0&&s<i&&(s=i),s===i)return 0;if(0===t.length||0===this.length)return 0;if(e<0)throw new RangeError("targetStart out of bounds");if(i<0||i>=this.length)throw new RangeError("sourceStart out of bounds");if(s<0)throw new RangeError("sourceEnd out of bounds");s>this.length&&(s=this.length),t.length-e<s-i&&(s=t.length-e+i);var n,a=s-i;if(this===t&&i<e&&e<s)for(n=a-1;n>=0;--n)t[n+e]=this[n+i];else if(a<1e3||!l.TYPED_ARRAY_SUPPORT)for(n=0;n<a;++n)t[n+e]=this[n+i];else Uint8Array.prototype.set.call(t,this.subarray(i,i+a),e);return a},l.prototype.fill=function(t,e,i,s){if("string"==typeof t){if("string"==typeof e?(s=e,e=0,i=this.length):"string"==typeof i&&(s=i,i=this.length),1===t.length){var n=t.charCodeAt(0);n<256&&(t=n)}if(void 0!==s&&"string"!=typeof s)throw new TypeError("encoding must be a string");if("string"==typeof s&&!l.isEncoding(s))throw new TypeError("Unknown encoding: "+s)}else"number"==typeof t&&(t&=255);if(e<0||this.length<e||this.length<i)throw new RangeError("Out of range index");if(i<=e)return this;var a;if(e>>>=0,i=void 0===i?this.length:i>>>0,t||(t=0),"number"==typeof t)for(a=e;a<i;++a)this[a]=t;else{var o=l.isBuffer(t)?t:z(new l(t,s).toString()),r=o.length;for(a=0;a<i-e;++a)this[a+e]=o[a%r]}return this};var L=/[^+\/0-9A-Za-z-_]/g;function H(t){return t<16?"0"+t.toString(16):t.toString(16)}function z(t,e){var i;e=e||1/0;for(var s=t.length,n=null,a=[],o=0;o<s;++o){if((i=t.charCodeAt(o))>55295&&i<57344){if(!n){if(i>56319){(e-=3)>-1&&a.push(239,191,189);continue}if(o+1===s){(e-=3)>-1&&a.push(239,191,189);continue}n=i;continue}if(i<56320){(e-=3)>-1&&a.push(239,191,189),n=i;continue}i=65536+(n-55296<<10|i-56320)}else n&&(e-=3)>-1&&a.push(239,191,189);if(n=null,i<128){if((e-=1)<0)break;a.push(i)}else if(i<2048){if((e-=2)<0)break;a.push(i>>6|192,63&i|128)}else if(i<65536){if((e-=3)<0)break;a.push(i>>12|224,i>>6&63|128,63&i|128)}else{if(!(i<1114112))throw new Error("Invalid code point");if((e-=4)<0)break;a.push(i>>18|240,i>>12&63|128,i>>6&63|128,63&i|128)}}return a}function N(t){return s.toByteArray(function(t){if((t=function(t){return t.trim?t.trim():t.replace(/^\s+|\s+$/g,"")}(t).replace(L,"")).length<2)return"";for(;t.length%4!=0;)t+="=";return t}(t))}function B(t,e,i,s){for(var n=0;n<s&&!(n+i>=e.length||n>=t.length);++n)e[n+i]=t[n];return n}}).call(e,i("DuR2"))},F6vc:function(t,e){},FIq8:function(t,e){},FcKU:function(t,e,i){t.exports=i.p+"static/img/自由排除-d.d759dc1.svg"},Fd3u:function(t,e){},Fjyx:function(t,e){},GF12:function(t,e){},GOFS:function(t,e){},GbrN:function(t,e){},Ge5h:function(t,e){},"I9+T":function(t,e,i){"use strict";i("jyVo");var s={data(){return{basic:this.$props.record.basic,isOpen:!1,checked:"basicMessage",isBig:!1}},methods:{toggleBig:function(){this.isBig=!this.isBig},download(t,e,i){window.location.href=`/aipath/api/files/attachment?caseid=${t}&fileid=${e}&filename=${i}`}},computed:{gender(){let t=window.localStorage.getItem("localeLanguage");return"zh"==t?{"男":"男","女":"女","其他":"其他"}:"en"==t?{"男":"M","女":"F","其他":"O"}:void 0}},props:["record"]},n={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"container"},[i("div",{staticClass:"open-message",attrs:{title:t.$t("basic.basic")},on:{click:function(e){t.isOpen=!t.isOpen}}}),t._v(" "),t.isOpen?i("div",{class:{"case-bigger":t.isBig,"case-message":!t.isBig}},[i("h1",[i("span",{class:{"cur-checked":"basicMessage"==t.checked},on:{click:function(e){t.checked="basicMessage"}}},[t._v(t._s(t.$t("basic.message")))]),t._v(" "),i("span",{class:{"cur-checked":"attachment"==t.checked},on:{click:function(e){t.checked="attachment"}}},[t._v(t._s(t.$t("basic.attactment")))]),t._v(" "),i("i",{staticClass:"close",on:{click:function(e){t.isOpen=!1}}}),i("i",{staticClass:"scale",class:{"bg-blue":t.isBig},on:{click:function(e){return t.toggleBig()}}})]),t._v(" "),i("div",{staticClass:"message-content"},["attachment"==t.checked?i("div",[i("ul",t._l(t.record.attachments.filter(function(t){return 1==t.state}),function(e){return i("li",{key:e.id},[i("a",{ref:"attachment",refInFor:!0,attrs:{title:e.name},on:{click:function(i){return t.download(t.record.id,e.id,e.name)}}},[t._v(t._s(e.name))])])}),0)]):t._e(),t._v(" "),"basicMessage"==t.checked?i("div",[i("div",{staticClass:"basics"},[i("h1",[t._v(t._s(t.$t("basic.basic")))]),t._v(" "),i("ul",[i("li",[i("dl",[i("dt",[t._v(t._s(t.$t("basic.age")))]),i("dd",[t._v(t._s(t.basic.age))])]),i("dl",[i("dt",[t._v(t._s(t.$t("basic.sex")))]),i("dd",[t._v(t._s(t.gender[t.basic.gender]))])])]),t._v(" "),i("li",[i("dl",{staticStyle:{width:"100%"}},[i("dt",{attrs:{title:t.$t("basic.cancerTypeTitle")}},[t._v(t._s(t.$t("basic.cancerType")))]),i("dd",[t._v(t._s(t.basic.cancerType))])])]),t._v(" "),i("li",[i("dl",{staticStyle:{width:"100%"}},[i("dt",{attrs:{title:t.$t("basic.familyHistoryTitle")}},[t._v(t._s(t.$t("basic.familyHistory")))]),i("dd",[t._v(t._s(t.basic.familyHistory))])])]),t._v(" "),i("li",[i("dl",{staticStyle:{width:"100%"}},[i("dt",{attrs:{title:t.$t("basic.medicalHistoryTitle")}},[t._v(t._s(t.$t("basic.medicalHistory")))]),i("dd",[t._v(t._s(t.basic.medicalHistory))])])])])]),t._v(" "),i("div",{staticClass:"basics"},[i("h1",[t._v(t._s(t.$t("basic.sample")))]),t._v(" "),i("ul",[i("li",[i("dl",{staticStyle:{width:"100%"}},[i("dt",{attrs:{title:t.$t("basic.samplePartTitle")}},[t._v(t._s(t.$t("basic.samplePart")))]),i("dd",[t._v(t._s(t.basic.samplePart))])])]),t._v(" "),i("li",[i("dl",{staticStyle:{width:"100%"}},[i("dt",{attrs:{title:t.$t("basic.sampleTypeTitle")}},[t._v(t._s(t.$t("basic.sampleType")))]),i("dd",[t._v(t._s(t.basic.sampleType))])])]),t._v(" "),i("li",[i("dl",{staticStyle:{width:"100%"}},[i("dt",[t._v(t._s(t.$t("basic.generallySeen")))]),i("dd",[t._v(t._s(t.basic.generallySeen))])])])])])]):t._e()])]):t._e()])},staticRenderFns:[]};var a=i("VU/8")(s,n,!1,function(t){i("l7ju")},"data-v-a17105bc",null);e.a=a.exports},IaF7:function(t,e){},Ieeo:function(t,e){},IfI9:function(t,e){},JLZf:function(t,e,i){t.exports=i.p+"static/img/图例.cf250fc.jpg"},KHdC:function(t,e){},"Khx+":function(t,e){},L0aG:function(t,e){},LC74:function(t,e){"function"==typeof Object.create?t.exports=function(t,e){t.super_=e,t.prototype=Object.create(e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}})}:t.exports=function(t,e){t.super_=e;var i=function(){};i.prototype=e.prototype,t.prototype=new i,t.prototype.constructor=t}},LkHl:function(t,e){},LtZJ:function(t,e){},M16f:function(t,e){},M4fF:function(t,e,i){(function(t,s){var n;
/**
 * @license
 * Lodash <https://lodash.com/>
 * Copyright JS Foundation and other contributors <https://js.foundation/>
 * Released under MIT license <https://lodash.com/license>
 * Based on Underscore.js 1.8.3 <http://underscorejs.org/LICENSE>
 * Copyright Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
 */(function(){var a,o=200,r="Unsupported core-js use. Try https://npms.io/search?q=ponyfill.",l="Expected a function",c="__lodash_hash_undefined__",u=500,h="__lodash_placeholder__",d=1,p=2,v=4,g=1,f=2,m=1,_=2,y=4,R=8,b=16,C=32,w=64,k=128,x=256,$=512,I=30,O="...",A=800,M=16,S=1,T=2,F=1/0,j=9007199254740991,E=1.7976931348623157e308,P=NaN,D=4294967295,L=D-1,H=D>>>1,z=[["ary",k],["bind",m],["bindKey",_],["curry",R],["curryRight",b],["flip",$],["partial",C],["partialRight",w],["rearg",x]],N="[object Arguments]",B="[object Array]",G="[object AsyncFunction]",U="[object Boolean]",Y="[object Date]",V="[object DOMException]",J="[object Error]",X="[object Function]",W="[object GeneratorFunction]",q="[object Map]",K="[object Number]",Z="[object Null]",Q="[object Object]",tt="[object Proxy]",et="[object RegExp]",it="[object Set]",st="[object String]",nt="[object Symbol]",at="[object Undefined]",ot="[object WeakMap]",rt="[object WeakSet]",lt="[object ArrayBuffer]",ct="[object DataView]",ut="[object Float32Array]",ht="[object Float64Array]",dt="[object Int8Array]",pt="[object Int16Array]",vt="[object Int32Array]",gt="[object Uint8Array]",ft="[object Uint8ClampedArray]",mt="[object Uint16Array]",_t="[object Uint32Array]",yt=/\b__p \+= '';/g,Rt=/\b(__p \+=) '' \+/g,bt=/(__e\(.*?\)|\b__t\)) \+\n'';/g,Ct=/&(?:amp|lt|gt|quot|#39);/g,wt=/[&<>"']/g,kt=RegExp(Ct.source),xt=RegExp(wt.source),$t=/<%-([\s\S]+?)%>/g,It=/<%([\s\S]+?)%>/g,Ot=/<%=([\s\S]+?)%>/g,At=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,Mt=/^\w*$/,St=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,Tt=/[\\^$.*+?()[\]{}|]/g,Ft=RegExp(Tt.source),jt=/^\s+|\s+$/g,Et=/^\s+/,Pt=/\s+$/,Dt=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,Lt=/\{\n\/\* \[wrapped with (.+)\] \*/,Ht=/,? & /,zt=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,Nt=/\\(\\)?/g,Bt=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,Gt=/\w*$/,Ut=/^[-+]0x[0-9a-f]+$/i,Yt=/^0b[01]+$/i,Vt=/^\[object .+?Constructor\]$/,Jt=/^0o[0-7]+$/i,Xt=/^(?:0|[1-9]\d*)$/,Wt=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,qt=/($^)/,Kt=/['\n\r\u2028\u2029\\]/g,Zt="\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff",Qt="\\xac\\xb1\\xd7\\xf7\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf\\u2000-\\u206f \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",te="[\\ud800-\\udfff]",ee="["+Qt+"]",ie="["+Zt+"]",se="\\d+",ne="[\\u2700-\\u27bf]",ae="[a-z\\xdf-\\xf6\\xf8-\\xff]",oe="[^\\ud800-\\udfff"+Qt+se+"\\u2700-\\u27bfa-z\\xdf-\\xf6\\xf8-\\xffA-Z\\xc0-\\xd6\\xd8-\\xde]",re="\\ud83c[\\udffb-\\udfff]",le="[^\\ud800-\\udfff]",ce="(?:\\ud83c[\\udde6-\\uddff]){2}",ue="[\\ud800-\\udbff][\\udc00-\\udfff]",he="[A-Z\\xc0-\\xd6\\xd8-\\xde]",de="(?:"+ae+"|"+oe+")",pe="(?:"+he+"|"+oe+")",ve="(?:"+ie+"|"+re+")"+"?",ge="[\\ufe0e\\ufe0f]?"+ve+("(?:\\u200d(?:"+[le,ce,ue].join("|")+")[\\ufe0e\\ufe0f]?"+ve+")*"),fe="(?:"+[ne,ce,ue].join("|")+")"+ge,me="(?:"+[le+ie+"?",ie,ce,ue,te].join("|")+")",_e=RegExp("['’]","g"),ye=RegExp(ie,"g"),Re=RegExp(re+"(?="+re+")|"+me+ge,"g"),be=RegExp([he+"?"+ae+"+(?:['’](?:d|ll|m|re|s|t|ve))?(?="+[ee,he,"$"].join("|")+")",pe+"+(?:['’](?:D|LL|M|RE|S|T|VE))?(?="+[ee,he+de,"$"].join("|")+")",he+"?"+de+"+(?:['’](?:d|ll|m|re|s|t|ve))?",he+"+(?:['’](?:D|LL|M|RE|S|T|VE))?","\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])","\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",se,fe].join("|"),"g"),Ce=RegExp("[\\u200d\\ud800-\\udfff"+Zt+"\\ufe0e\\ufe0f]"),we=/[a-z][A-Z]|[A-Z]{2,}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,ke=["Array","Buffer","DataView","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Map","Math","Object","Promise","RegExp","Set","String","Symbol","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap","_","clearTimeout","isFinite","parseInt","setTimeout"],xe=-1,$e={};$e[ut]=$e[ht]=$e[dt]=$e[pt]=$e[vt]=$e[gt]=$e[ft]=$e[mt]=$e[_t]=!0,$e[N]=$e[B]=$e[lt]=$e[U]=$e[ct]=$e[Y]=$e[J]=$e[X]=$e[q]=$e[K]=$e[Q]=$e[et]=$e[it]=$e[st]=$e[ot]=!1;var Ie={};Ie[N]=Ie[B]=Ie[lt]=Ie[ct]=Ie[U]=Ie[Y]=Ie[ut]=Ie[ht]=Ie[dt]=Ie[pt]=Ie[vt]=Ie[q]=Ie[K]=Ie[Q]=Ie[et]=Ie[it]=Ie[st]=Ie[nt]=Ie[gt]=Ie[ft]=Ie[mt]=Ie[_t]=!0,Ie[J]=Ie[X]=Ie[ot]=!1;var Oe={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},Ae=parseFloat,Me=parseInt,Se="object"==typeof t&&t&&t.Object===Object&&t,Te="object"==typeof self&&self&&self.Object===Object&&self,Fe=Se||Te||Function("return this")(),je="object"==typeof e&&e&&!e.nodeType&&e,Ee=je&&"object"==typeof s&&s&&!s.nodeType&&s,Pe=Ee&&Ee.exports===je,De=Pe&&Se.process,Le=function(){try{return De&&De.binding&&De.binding("util")}catch(t){}}(),He=Le&&Le.isArrayBuffer,ze=Le&&Le.isDate,Ne=Le&&Le.isMap,Be=Le&&Le.isRegExp,Ge=Le&&Le.isSet,Ue=Le&&Le.isTypedArray;function Ye(t,e,i){switch(i.length){case 0:return t.call(e);case 1:return t.call(e,i[0]);case 2:return t.call(e,i[0],i[1]);case 3:return t.call(e,i[0],i[1],i[2])}return t.apply(e,i)}function Ve(t,e,i,s){for(var n=-1,a=null==t?0:t.length;++n<a;){var o=t[n];e(s,o,i(o),t)}return s}function Je(t,e){for(var i=-1,s=null==t?0:t.length;++i<s&&!1!==e(t[i],i,t););return t}function Xe(t,e){for(var i=null==t?0:t.length;i--&&!1!==e(t[i],i,t););return t}function We(t,e){for(var i=-1,s=null==t?0:t.length;++i<s;)if(!e(t[i],i,t))return!1;return!0}function qe(t,e){for(var i=-1,s=null==t?0:t.length,n=0,a=[];++i<s;){var o=t[i];e(o,i,t)&&(a[n++]=o)}return a}function Ke(t,e){return!!(null==t?0:t.length)&&ri(t,e,0)>-1}function Ze(t,e,i){for(var s=-1,n=null==t?0:t.length;++s<n;)if(i(e,t[s]))return!0;return!1}function Qe(t,e){for(var i=-1,s=null==t?0:t.length,n=Array(s);++i<s;)n[i]=e(t[i],i,t);return n}function ti(t,e){for(var i=-1,s=e.length,n=t.length;++i<s;)t[n+i]=e[i];return t}function ei(t,e,i,s){var n=-1,a=null==t?0:t.length;for(s&&a&&(i=t[++n]);++n<a;)i=e(i,t[n],n,t);return i}function ii(t,e,i,s){var n=null==t?0:t.length;for(s&&n&&(i=t[--n]);n--;)i=e(i,t[n],n,t);return i}function si(t,e){for(var i=-1,s=null==t?0:t.length;++i<s;)if(e(t[i],i,t))return!0;return!1}var ni=hi("length");function ai(t,e,i){var s;return i(t,function(t,i,n){if(e(t,i,n))return s=i,!1}),s}function oi(t,e,i,s){for(var n=t.length,a=i+(s?1:-1);s?a--:++a<n;)if(e(t[a],a,t))return a;return-1}function ri(t,e,i){return e==e?function(t,e,i){var s=i-1,n=t.length;for(;++s<n;)if(t[s]===e)return s;return-1}(t,e,i):oi(t,ci,i)}function li(t,e,i,s){for(var n=i-1,a=t.length;++n<a;)if(s(t[n],e))return n;return-1}function ci(t){return t!=t}function ui(t,e){var i=null==t?0:t.length;return i?vi(t,e)/i:P}function hi(t){return function(e){return null==e?a:e[t]}}function di(t){return function(e){return null==t?a:t[e]}}function pi(t,e,i,s,n){return n(t,function(t,n,a){i=s?(s=!1,t):e(i,t,n,a)}),i}function vi(t,e){for(var i,s=-1,n=t.length;++s<n;){var o=e(t[s]);o!==a&&(i=i===a?o:i+o)}return i}function gi(t,e){for(var i=-1,s=Array(t);++i<t;)s[i]=e(i);return s}function fi(t){return function(e){return t(e)}}function mi(t,e){return Qe(e,function(e){return t[e]})}function _i(t,e){return t.has(e)}function yi(t,e){for(var i=-1,s=t.length;++i<s&&ri(e,t[i],0)>-1;);return i}function Ri(t,e){for(var i=t.length;i--&&ri(e,t[i],0)>-1;);return i}var bi=di({"À":"A","Á":"A","Â":"A","Ã":"A","Ä":"A","Å":"A","à":"a","á":"a","â":"a","ã":"a","ä":"a","å":"a","Ç":"C","ç":"c","Ð":"D","ð":"d","È":"E","É":"E","Ê":"E","Ë":"E","è":"e","é":"e","ê":"e","ë":"e","Ì":"I","Í":"I","Î":"I","Ï":"I","ì":"i","í":"i","î":"i","ï":"i","Ñ":"N","ñ":"n","Ò":"O","Ó":"O","Ô":"O","Õ":"O","Ö":"O","Ø":"O","ò":"o","ó":"o","ô":"o","õ":"o","ö":"o","ø":"o","Ù":"U","Ú":"U","Û":"U","Ü":"U","ù":"u","ú":"u","û":"u","ü":"u","Ý":"Y","ý":"y","ÿ":"y","Æ":"Ae","æ":"ae","Þ":"Th","þ":"th","ß":"ss","Ā":"A","Ă":"A","Ą":"A","ā":"a","ă":"a","ą":"a","Ć":"C","Ĉ":"C","Ċ":"C","Č":"C","ć":"c","ĉ":"c","ċ":"c","č":"c","Ď":"D","Đ":"D","ď":"d","đ":"d","Ē":"E","Ĕ":"E","Ė":"E","Ę":"E","Ě":"E","ē":"e","ĕ":"e","ė":"e","ę":"e","ě":"e","Ĝ":"G","Ğ":"G","Ġ":"G","Ģ":"G","ĝ":"g","ğ":"g","ġ":"g","ģ":"g","Ĥ":"H","Ħ":"H","ĥ":"h","ħ":"h","Ĩ":"I","Ī":"I","Ĭ":"I","Į":"I","İ":"I","ĩ":"i","ī":"i","ĭ":"i","į":"i","ı":"i","Ĵ":"J","ĵ":"j","Ķ":"K","ķ":"k","ĸ":"k","Ĺ":"L","Ļ":"L","Ľ":"L","Ŀ":"L","Ł":"L","ĺ":"l","ļ":"l","ľ":"l","ŀ":"l","ł":"l","Ń":"N","Ņ":"N","Ň":"N","Ŋ":"N","ń":"n","ņ":"n","ň":"n","ŋ":"n","Ō":"O","Ŏ":"O","Ő":"O","ō":"o","ŏ":"o","ő":"o","Ŕ":"R","Ŗ":"R","Ř":"R","ŕ":"r","ŗ":"r","ř":"r","Ś":"S","Ŝ":"S","Ş":"S","Š":"S","ś":"s","ŝ":"s","ş":"s","š":"s","Ţ":"T","Ť":"T","Ŧ":"T","ţ":"t","ť":"t","ŧ":"t","Ũ":"U","Ū":"U","Ŭ":"U","Ů":"U","Ű":"U","Ų":"U","ũ":"u","ū":"u","ŭ":"u","ů":"u","ű":"u","ų":"u","Ŵ":"W","ŵ":"w","Ŷ":"Y","ŷ":"y","Ÿ":"Y","Ź":"Z","Ż":"Z","Ž":"Z","ź":"z","ż":"z","ž":"z","Ĳ":"IJ","ĳ":"ij","Œ":"Oe","œ":"oe","ŉ":"'n","ſ":"s"}),Ci=di({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"});function wi(t){return"\\"+Oe[t]}function ki(t){return Ce.test(t)}function xi(t){var e=-1,i=Array(t.size);return t.forEach(function(t,s){i[++e]=[s,t]}),i}function $i(t,e){return function(i){return t(e(i))}}function Ii(t,e){for(var i=-1,s=t.length,n=0,a=[];++i<s;){var o=t[i];o!==e&&o!==h||(t[i]=h,a[n++]=i)}return a}function Oi(t,e){return"__proto__"==e?a:t[e]}function Ai(t){var e=-1,i=Array(t.size);return t.forEach(function(t){i[++e]=t}),i}function Mi(t){var e=-1,i=Array(t.size);return t.forEach(function(t){i[++e]=[t,t]}),i}function Si(t){return ki(t)?function(t){var e=Re.lastIndex=0;for(;Re.test(t);)++e;return e}(t):ni(t)}function Ti(t){return ki(t)?function(t){return t.match(Re)||[]}(t):function(t){return t.split("")}(t)}var Fi=di({"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"});var ji=function t(e){var i,s=(e=null==e?Fe:ji.defaults(Fe.Object(),e,ji.pick(Fe,ke))).Array,n=e.Date,Zt=e.Error,Qt=e.Function,te=e.Math,ee=e.Object,ie=e.RegExp,se=e.String,ne=e.TypeError,ae=s.prototype,oe=Qt.prototype,re=ee.prototype,le=e["__core-js_shared__"],ce=oe.toString,ue=re.hasOwnProperty,he=0,de=(i=/[^.]+$/.exec(le&&le.keys&&le.keys.IE_PROTO||""))?"Symbol(src)_1."+i:"",pe=re.toString,ve=ce.call(ee),ge=Fe._,fe=ie("^"+ce.call(ue).replace(Tt,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),me=Pe?e.Buffer:a,Re=e.Symbol,Ce=e.Uint8Array,Oe=me?me.allocUnsafe:a,Se=$i(ee.getPrototypeOf,ee),Te=ee.create,je=re.propertyIsEnumerable,Ee=ae.splice,De=Re?Re.isConcatSpreadable:a,Le=Re?Re.iterator:a,ni=Re?Re.toStringTag:a,di=function(){try{var t=Ha(ee,"defineProperty");return t({},"",{}),t}catch(t){}}(),Ei=e.clearTimeout!==Fe.clearTimeout&&e.clearTimeout,Pi=n&&n.now!==Fe.Date.now&&n.now,Di=e.setTimeout!==Fe.setTimeout&&e.setTimeout,Li=te.ceil,Hi=te.floor,zi=ee.getOwnPropertySymbols,Ni=me?me.isBuffer:a,Bi=e.isFinite,Gi=ae.join,Ui=$i(ee.keys,ee),Yi=te.max,Vi=te.min,Ji=n.now,Xi=e.parseInt,Wi=te.random,qi=ae.reverse,Ki=Ha(e,"DataView"),Zi=Ha(e,"Map"),Qi=Ha(e,"Promise"),ts=Ha(e,"Set"),es=Ha(e,"WeakMap"),is=Ha(ee,"create"),ss=es&&new es,ns={},as=uo(Ki),os=uo(Zi),rs=uo(Qi),ls=uo(ts),cs=uo(es),us=Re?Re.prototype:a,hs=us?us.valueOf:a,ds=us?us.toString:a;function ps(t){if(Or(t)&&!mr(t)&&!(t instanceof ms)){if(t instanceof fs)return t;if(ue.call(t,"__wrapped__"))return ho(t)}return new fs(t)}var vs=function(){function t(){}return function(e){if(!Ir(e))return{};if(Te)return Te(e);t.prototype=e;var i=new t;return t.prototype=a,i}}();function gs(){}function fs(t,e){this.__wrapped__=t,this.__actions__=[],this.__chain__=!!e,this.__index__=0,this.__values__=a}function ms(t){this.__wrapped__=t,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=D,this.__views__=[]}function _s(t){var e=-1,i=null==t?0:t.length;for(this.clear();++e<i;){var s=t[e];this.set(s[0],s[1])}}function ys(t){var e=-1,i=null==t?0:t.length;for(this.clear();++e<i;){var s=t[e];this.set(s[0],s[1])}}function Rs(t){var e=-1,i=null==t?0:t.length;for(this.clear();++e<i;){var s=t[e];this.set(s[0],s[1])}}function bs(t){var e=-1,i=null==t?0:t.length;for(this.__data__=new Rs;++e<i;)this.add(t[e])}function Cs(t){var e=this.__data__=new ys(t);this.size=e.size}function ws(t,e){var i=mr(t),s=!i&&fr(t),n=!i&&!s&&br(t),a=!i&&!s&&!n&&Pr(t),o=i||s||n||a,r=o?gi(t.length,se):[],l=r.length;for(var c in t)!e&&!ue.call(t,c)||o&&("length"==c||n&&("offset"==c||"parent"==c)||a&&("buffer"==c||"byteLength"==c||"byteOffset"==c)||Va(c,l))||r.push(c);return r}function ks(t){var e=t.length;return e?t[Cn(0,e-1)]:a}function xs(t,e){return ro(sa(t),js(e,0,t.length))}function $s(t){return ro(sa(t))}function Is(t,e,i){(i===a||pr(t[e],i))&&(i!==a||e in t)||Ts(t,e,i)}function Os(t,e,i){var s=t[e];ue.call(t,e)&&pr(s,i)&&(i!==a||e in t)||Ts(t,e,i)}function As(t,e){for(var i=t.length;i--;)if(pr(t[i][0],e))return i;return-1}function Ms(t,e,i,s){return Hs(t,function(t,n,a){e(s,t,i(t),a)}),s}function Ss(t,e){return t&&na(e,nl(e),t)}function Ts(t,e,i){"__proto__"==e&&di?di(t,e,{configurable:!0,enumerable:!0,value:i,writable:!0}):t[e]=i}function Fs(t,e){for(var i=-1,n=e.length,o=s(n),r=null==t;++i<n;)o[i]=r?a:Qr(t,e[i]);return o}function js(t,e,i){return t==t&&(i!==a&&(t=t<=i?t:i),e!==a&&(t=t>=e?t:e)),t}function Es(t,e,i,s,n,o){var r,l=e&d,c=e&p,u=e&v;if(i&&(r=n?i(t,s,n,o):i(t)),r!==a)return r;if(!Ir(t))return t;var h=mr(t);if(h){if(r=function(t){var e=t.length,i=new t.constructor(e);return e&&"string"==typeof t[0]&&ue.call(t,"index")&&(i.index=t.index,i.input=t.input),i}(t),!l)return sa(t,r)}else{var g=Ba(t),f=g==X||g==W;if(br(t))return Kn(t,l);if(g==Q||g==N||f&&!n){if(r=c||f?{}:Ua(t),!l)return c?function(t,e){return na(t,Na(t),e)}(t,function(t,e){return t&&na(e,al(e),t)}(r,t)):function(t,e){return na(t,za(t),e)}(t,Ss(r,t))}else{if(!Ie[g])return n?t:{};r=function(t,e,i){var s,n,a,o=t.constructor;switch(e){case lt:return Zn(t);case U:case Y:return new o(+t);case ct:return function(t,e){var i=e?Zn(t.buffer):t.buffer;return new t.constructor(i,t.byteOffset,t.byteLength)}(t,i);case ut:case ht:case dt:case pt:case vt:case gt:case ft:case mt:case _t:return Qn(t,i);case q:return new o;case K:case st:return new o(t);case et:return(a=new(n=t).constructor(n.source,Gt.exec(n))).lastIndex=n.lastIndex,a;case it:return new o;case nt:return s=t,hs?ee(hs.call(s)):{}}}(t,g,l)}}o||(o=new Cs);var m=o.get(t);if(m)return m;if(o.set(t,r),Fr(t))return t.forEach(function(s){r.add(Es(s,e,i,s,t,o))}),r;if(Ar(t))return t.forEach(function(s,n){r.set(n,Es(s,e,i,n,t,o))}),r;var _=h?a:(u?c?Ta:Sa:c?al:nl)(t);return Je(_||t,function(s,n){_&&(s=t[n=s]),Os(r,n,Es(s,e,i,n,t,o))}),r}function Ps(t,e,i){var s=i.length;if(null==t)return!s;for(t=ee(t);s--;){var n=i[s],o=e[n],r=t[n];if(r===a&&!(n in t)||!o(r))return!1}return!0}function Ds(t,e,i){if("function"!=typeof t)throw new ne(l);return so(function(){t.apply(a,i)},e)}function Ls(t,e,i,s){var n=-1,a=Ke,r=!0,l=t.length,c=[],u=e.length;if(!l)return c;i&&(e=Qe(e,fi(i))),s?(a=Ze,r=!1):e.length>=o&&(a=_i,r=!1,e=new bs(e));t:for(;++n<l;){var h=t[n],d=null==i?h:i(h);if(h=s||0!==h?h:0,r&&d==d){for(var p=u;p--;)if(e[p]===d)continue t;c.push(h)}else a(e,d,s)||c.push(h)}return c}ps.templateSettings={escape:$t,evaluate:It,interpolate:Ot,variable:"",imports:{_:ps}},ps.prototype=gs.prototype,ps.prototype.constructor=ps,fs.prototype=vs(gs.prototype),fs.prototype.constructor=fs,ms.prototype=vs(gs.prototype),ms.prototype.constructor=ms,_s.prototype.clear=function(){this.__data__=is?is(null):{},this.size=0},_s.prototype.delete=function(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e},_s.prototype.get=function(t){var e=this.__data__;if(is){var i=e[t];return i===c?a:i}return ue.call(e,t)?e[t]:a},_s.prototype.has=function(t){var e=this.__data__;return is?e[t]!==a:ue.call(e,t)},_s.prototype.set=function(t,e){var i=this.__data__;return this.size+=this.has(t)?0:1,i[t]=is&&e===a?c:e,this},ys.prototype.clear=function(){this.__data__=[],this.size=0},ys.prototype.delete=function(t){var e=this.__data__,i=As(e,t);return!(i<0||(i==e.length-1?e.pop():Ee.call(e,i,1),--this.size,0))},ys.prototype.get=function(t){var e=this.__data__,i=As(e,t);return i<0?a:e[i][1]},ys.prototype.has=function(t){return As(this.__data__,t)>-1},ys.prototype.set=function(t,e){var i=this.__data__,s=As(i,t);return s<0?(++this.size,i.push([t,e])):i[s][1]=e,this},Rs.prototype.clear=function(){this.size=0,this.__data__={hash:new _s,map:new(Zi||ys),string:new _s}},Rs.prototype.delete=function(t){var e=Da(this,t).delete(t);return this.size-=e?1:0,e},Rs.prototype.get=function(t){return Da(this,t).get(t)},Rs.prototype.has=function(t){return Da(this,t).has(t)},Rs.prototype.set=function(t,e){var i=Da(this,t),s=i.size;return i.set(t,e),this.size+=i.size==s?0:1,this},bs.prototype.add=bs.prototype.push=function(t){return this.__data__.set(t,c),this},bs.prototype.has=function(t){return this.__data__.has(t)},Cs.prototype.clear=function(){this.__data__=new ys,this.size=0},Cs.prototype.delete=function(t){var e=this.__data__,i=e.delete(t);return this.size=e.size,i},Cs.prototype.get=function(t){return this.__data__.get(t)},Cs.prototype.has=function(t){return this.__data__.has(t)},Cs.prototype.set=function(t,e){var i=this.__data__;if(i instanceof ys){var s=i.__data__;if(!Zi||s.length<o-1)return s.push([t,e]),this.size=++i.size,this;i=this.__data__=new Rs(s)}return i.set(t,e),this.size=i.size,this};var Hs=ra(Js),zs=ra(Xs,!0);function Ns(t,e){var i=!0;return Hs(t,function(t,s,n){return i=!!e(t,s,n)}),i}function Bs(t,e,i){for(var s=-1,n=t.length;++s<n;){var o=t[s],r=e(o);if(null!=r&&(l===a?r==r&&!Er(r):i(r,l)))var l=r,c=o}return c}function Gs(t,e){var i=[];return Hs(t,function(t,s,n){e(t,s,n)&&i.push(t)}),i}function Us(t,e,i,s,n){var a=-1,o=t.length;for(i||(i=Ya),n||(n=[]);++a<o;){var r=t[a];e>0&&i(r)?e>1?Us(r,e-1,i,s,n):ti(n,r):s||(n[n.length]=r)}return n}var Ys=la(),Vs=la(!0);function Js(t,e){return t&&Ys(t,e,nl)}function Xs(t,e){return t&&Vs(t,e,nl)}function Ws(t,e){return qe(e,function(e){return kr(t[e])})}function qs(t,e){for(var i=0,s=(e=Jn(e,t)).length;null!=t&&i<s;)t=t[co(e[i++])];return i&&i==s?t:a}function Ks(t,e,i){var s=e(t);return mr(t)?s:ti(s,i(t))}function Zs(t){return null==t?t===a?at:Z:ni&&ni in ee(t)?function(t){var e=ue.call(t,ni),i=t[ni];try{t[ni]=a;var s=!0}catch(t){}var n=pe.call(t);return s&&(e?t[ni]=i:delete t[ni]),n}(t):function(t){return pe.call(t)}(t)}function Qs(t,e){return t>e}function tn(t,e){return null!=t&&ue.call(t,e)}function en(t,e){return null!=t&&e in ee(t)}function sn(t,e,i){for(var n=i?Ze:Ke,o=t[0].length,r=t.length,l=r,c=s(r),u=1/0,h=[];l--;){var d=t[l];l&&e&&(d=Qe(d,fi(e))),u=Vi(d.length,u),c[l]=!i&&(e||o>=120&&d.length>=120)?new bs(l&&d):a}d=t[0];var p=-1,v=c[0];t:for(;++p<o&&h.length<u;){var g=d[p],f=e?e(g):g;if(g=i||0!==g?g:0,!(v?_i(v,f):n(h,f,i))){for(l=r;--l;){var m=c[l];if(!(m?_i(m,f):n(t[l],f,i)))continue t}v&&v.push(f),h.push(g)}}return h}function nn(t,e,i){var s=null==(t=eo(t,e=Jn(e,t)))?t:t[co(wo(e))];return null==s?a:Ye(s,t,i)}function an(t){return Or(t)&&Zs(t)==N}function on(t,e,i,s,n){return t===e||(null==t||null==e||!Or(t)&&!Or(e)?t!=t&&e!=e:function(t,e,i,s,n,o){var r=mr(t),l=mr(e),c=r?B:Ba(t),u=l?B:Ba(e),h=(c=c==N?Q:c)==Q,d=(u=u==N?Q:u)==Q,p=c==u;if(p&&br(t)){if(!br(e))return!1;r=!0,h=!1}if(p&&!h)return o||(o=new Cs),r||Pr(t)?Aa(t,e,i,s,n,o):function(t,e,i,s,n,a,o){switch(i){case ct:if(t.byteLength!=e.byteLength||t.byteOffset!=e.byteOffset)return!1;t=t.buffer,e=e.buffer;case lt:return!(t.byteLength!=e.byteLength||!a(new Ce(t),new Ce(e)));case U:case Y:case K:return pr(+t,+e);case J:return t.name==e.name&&t.message==e.message;case et:case st:return t==e+"";case q:var r=xi;case it:var l=s&g;if(r||(r=Ai),t.size!=e.size&&!l)return!1;var c=o.get(t);if(c)return c==e;s|=f,o.set(t,e);var u=Aa(r(t),r(e),s,n,a,o);return o.delete(t),u;case nt:if(hs)return hs.call(t)==hs.call(e)}return!1}(t,e,c,i,s,n,o);if(!(i&g)){var v=h&&ue.call(t,"__wrapped__"),m=d&&ue.call(e,"__wrapped__");if(v||m){var _=v?t.value():t,y=m?e.value():e;return o||(o=new Cs),n(_,y,i,s,o)}}return!!p&&(o||(o=new Cs),function(t,e,i,s,n,o){var r=i&g,l=Sa(t),c=l.length,u=Sa(e).length;if(c!=u&&!r)return!1;for(var h=c;h--;){var d=l[h];if(!(r?d in e:ue.call(e,d)))return!1}var p=o.get(t);if(p&&o.get(e))return p==e;var v=!0;o.set(t,e),o.set(e,t);for(var f=r;++h<c;){d=l[h];var m=t[d],_=e[d];if(s)var y=r?s(_,m,d,e,t,o):s(m,_,d,t,e,o);if(!(y===a?m===_||n(m,_,i,s,o):y)){v=!1;break}f||(f="constructor"==d)}if(v&&!f){var R=t.constructor,b=e.constructor;R!=b&&"constructor"in t&&"constructor"in e&&!("function"==typeof R&&R instanceof R&&"function"==typeof b&&b instanceof b)&&(v=!1)}return o.delete(t),o.delete(e),v}(t,e,i,s,n,o))}(t,e,i,s,on,n))}function rn(t,e,i,s){var n=i.length,o=n,r=!s;if(null==t)return!o;for(t=ee(t);n--;){var l=i[n];if(r&&l[2]?l[1]!==t[l[0]]:!(l[0]in t))return!1}for(;++n<o;){var c=(l=i[n])[0],u=t[c],h=l[1];if(r&&l[2]){if(u===a&&!(c in t))return!1}else{var d=new Cs;if(s)var p=s(u,h,c,t,e,d);if(!(p===a?on(h,u,g|f,s,d):p))return!1}}return!0}function ln(t){return!(!Ir(t)||de&&de in t)&&(kr(t)?fe:Vt).test(uo(t))}function cn(t){return"function"==typeof t?t:null==t?Ml:"object"==typeof t?mr(t)?gn(t[0],t[1]):vn(t):Hl(t)}function un(t){if(!Ka(t))return Ui(t);var e=[];for(var i in ee(t))ue.call(t,i)&&"constructor"!=i&&e.push(i);return e}function hn(t){if(!Ir(t))return function(t){var e=[];if(null!=t)for(var i in ee(t))e.push(i);return e}(t);var e=Ka(t),i=[];for(var s in t)("constructor"!=s||!e&&ue.call(t,s))&&i.push(s);return i}function dn(t,e){return t<e}function pn(t,e){var i=-1,n=yr(t)?s(t.length):[];return Hs(t,function(t,s,a){n[++i]=e(t,s,a)}),n}function vn(t){var e=La(t);return 1==e.length&&e[0][2]?Qa(e[0][0],e[0][1]):function(i){return i===t||rn(i,t,e)}}function gn(t,e){return Xa(t)&&Za(e)?Qa(co(t),e):function(i){var s=Qr(i,t);return s===a&&s===e?tl(i,t):on(e,s,g|f)}}function fn(t,e,i,s,n){t!==e&&Ys(e,function(o,r){if(Ir(o))n||(n=new Cs),function(t,e,i,s,n,o,r){var l=Oi(t,i),c=Oi(e,i),u=r.get(c);if(u)Is(t,i,u);else{var h=o?o(l,c,i+"",t,e,r):a,d=h===a;if(d){var p=mr(c),v=!p&&br(c),g=!p&&!v&&Pr(c);h=c,p||v||g?mr(l)?h=l:Rr(l)?h=sa(l):v?(d=!1,h=Kn(c,!0)):g?(d=!1,h=Qn(c,!0)):h=[]:Sr(c)||fr(c)?(h=l,fr(l)?h=Ur(l):(!Ir(l)||s&&kr(l))&&(h=Ua(c))):d=!1}d&&(r.set(c,h),n(h,c,s,o,r),r.delete(c)),Is(t,i,h)}}(t,e,r,i,fn,s,n);else{var l=s?s(Oi(t,r),o,r+"",t,e,n):a;l===a&&(l=o),Is(t,r,l)}},al)}function mn(t,e){var i=t.length;if(i)return Va(e+=e<0?i:0,i)?t[e]:a}function _n(t,e,i){var s=-1;return e=Qe(e.length?e:[Ml],fi(Pa())),function(t,e){var i=t.length;for(t.sort(e);i--;)t[i]=t[i].value;return t}(pn(t,function(t,i,n){return{criteria:Qe(e,function(e){return e(t)}),index:++s,value:t}}),function(t,e){return function(t,e,i){for(var s=-1,n=t.criteria,a=e.criteria,o=n.length,r=i.length;++s<o;){var l=ta(n[s],a[s]);if(l){if(s>=r)return l;var c=i[s];return l*("desc"==c?-1:1)}}return t.index-e.index}(t,e,i)})}function yn(t,e,i){for(var s=-1,n=e.length,a={};++s<n;){var o=e[s],r=qs(t,o);i(r,o)&&In(a,Jn(o,t),r)}return a}function Rn(t,e,i,s){var n=s?li:ri,a=-1,o=e.length,r=t;for(t===e&&(e=sa(e)),i&&(r=Qe(t,fi(i)));++a<o;)for(var l=0,c=e[a],u=i?i(c):c;(l=n(r,u,l,s))>-1;)r!==t&&Ee.call(r,l,1),Ee.call(t,l,1);return t}function bn(t,e){for(var i=t?e.length:0,s=i-1;i--;){var n=e[i];if(i==s||n!==a){var a=n;Va(n)?Ee.call(t,n,1):Hn(t,n)}}return t}function Cn(t,e){return t+Hi(Wi()*(e-t+1))}function wn(t,e){var i="";if(!t||e<1||e>j)return i;do{e%2&&(i+=t),(e=Hi(e/2))&&(t+=t)}while(e);return i}function kn(t,e){return no(to(t,e,Ml),t+"")}function xn(t){return ks(pl(t))}function $n(t,e){var i=pl(t);return ro(i,js(e,0,i.length))}function In(t,e,i,s){if(!Ir(t))return t;for(var n=-1,o=(e=Jn(e,t)).length,r=o-1,l=t;null!=l&&++n<o;){var c=co(e[n]),u=i;if(n!=r){var h=l[c];(u=s?s(h,c,l):a)===a&&(u=Ir(h)?h:Va(e[n+1])?[]:{})}Os(l,c,u),l=l[c]}return t}var On=ss?function(t,e){return ss.set(t,e),t}:Ml,An=di?function(t,e){return di(t,"toString",{configurable:!0,enumerable:!1,value:Il(e),writable:!0})}:Ml;function Mn(t){return ro(pl(t))}function Sn(t,e,i){var n=-1,a=t.length;e<0&&(e=-e>a?0:a+e),(i=i>a?a:i)<0&&(i+=a),a=e>i?0:i-e>>>0,e>>>=0;for(var o=s(a);++n<a;)o[n]=t[n+e];return o}function Tn(t,e){var i;return Hs(t,function(t,s,n){return!(i=e(t,s,n))}),!!i}function Fn(t,e,i){var s=0,n=null==t?s:t.length;if("number"==typeof e&&e==e&&n<=H){for(;s<n;){var a=s+n>>>1,o=t[a];null!==o&&!Er(o)&&(i?o<=e:o<e)?s=a+1:n=a}return n}return jn(t,e,Ml,i)}function jn(t,e,i,s){e=i(e);for(var n=0,o=null==t?0:t.length,r=e!=e,l=null===e,c=Er(e),u=e===a;n<o;){var h=Hi((n+o)/2),d=i(t[h]),p=d!==a,v=null===d,g=d==d,f=Er(d);if(r)var m=s||g;else m=u?g&&(s||p):l?g&&p&&(s||!v):c?g&&p&&!v&&(s||!f):!v&&!f&&(s?d<=e:d<e);m?n=h+1:o=h}return Vi(o,L)}function En(t,e){for(var i=-1,s=t.length,n=0,a=[];++i<s;){var o=t[i],r=e?e(o):o;if(!i||!pr(r,l)){var l=r;a[n++]=0===o?0:o}}return a}function Pn(t){return"number"==typeof t?t:Er(t)?P:+t}function Dn(t){if("string"==typeof t)return t;if(mr(t))return Qe(t,Dn)+"";if(Er(t))return ds?ds.call(t):"";var e=t+"";return"0"==e&&1/t==-F?"-0":e}function Ln(t,e,i){var s=-1,n=Ke,a=t.length,r=!0,l=[],c=l;if(i)r=!1,n=Ze;else if(a>=o){var u=e?null:wa(t);if(u)return Ai(u);r=!1,n=_i,c=new bs}else c=e?[]:l;t:for(;++s<a;){var h=t[s],d=e?e(h):h;if(h=i||0!==h?h:0,r&&d==d){for(var p=c.length;p--;)if(c[p]===d)continue t;e&&c.push(d),l.push(h)}else n(c,d,i)||(c!==l&&c.push(d),l.push(h))}return l}function Hn(t,e){return null==(t=eo(t,e=Jn(e,t)))||delete t[co(wo(e))]}function zn(t,e,i,s){return In(t,e,i(qs(t,e)),s)}function Nn(t,e,i,s){for(var n=t.length,a=s?n:-1;(s?a--:++a<n)&&e(t[a],a,t););return i?Sn(t,s?0:a,s?a+1:n):Sn(t,s?a+1:0,s?n:a)}function Bn(t,e){var i=t;return i instanceof ms&&(i=i.value()),ei(e,function(t,e){return e.func.apply(e.thisArg,ti([t],e.args))},i)}function Gn(t,e,i){var n=t.length;if(n<2)return n?Ln(t[0]):[];for(var a=-1,o=s(n);++a<n;)for(var r=t[a],l=-1;++l<n;)l!=a&&(o[a]=Ls(o[a]||r,t[l],e,i));return Ln(Us(o,1),e,i)}function Un(t,e,i){for(var s=-1,n=t.length,o=e.length,r={};++s<n;){var l=s<o?e[s]:a;i(r,t[s],l)}return r}function Yn(t){return Rr(t)?t:[]}function Vn(t){return"function"==typeof t?t:Ml}function Jn(t,e){return mr(t)?t:Xa(t,e)?[t]:lo(Yr(t))}var Xn=kn;function Wn(t,e,i){var s=t.length;return i=i===a?s:i,!e&&i>=s?t:Sn(t,e,i)}var qn=Ei||function(t){return Fe.clearTimeout(t)};function Kn(t,e){if(e)return t.slice();var i=t.length,s=Oe?Oe(i):new t.constructor(i);return t.copy(s),s}function Zn(t){var e=new t.constructor(t.byteLength);return new Ce(e).set(new Ce(t)),e}function Qn(t,e){var i=e?Zn(t.buffer):t.buffer;return new t.constructor(i,t.byteOffset,t.length)}function ta(t,e){if(t!==e){var i=t!==a,s=null===t,n=t==t,o=Er(t),r=e!==a,l=null===e,c=e==e,u=Er(e);if(!l&&!u&&!o&&t>e||o&&r&&c&&!l&&!u||s&&r&&c||!i&&c||!n)return 1;if(!s&&!o&&!u&&t<e||u&&i&&n&&!s&&!o||l&&i&&n||!r&&n||!c)return-1}return 0}function ea(t,e,i,n){for(var a=-1,o=t.length,r=i.length,l=-1,c=e.length,u=Yi(o-r,0),h=s(c+u),d=!n;++l<c;)h[l]=e[l];for(;++a<r;)(d||a<o)&&(h[i[a]]=t[a]);for(;u--;)h[l++]=t[a++];return h}function ia(t,e,i,n){for(var a=-1,o=t.length,r=-1,l=i.length,c=-1,u=e.length,h=Yi(o-l,0),d=s(h+u),p=!n;++a<h;)d[a]=t[a];for(var v=a;++c<u;)d[v+c]=e[c];for(;++r<l;)(p||a<o)&&(d[v+i[r]]=t[a++]);return d}function sa(t,e){var i=-1,n=t.length;for(e||(e=s(n));++i<n;)e[i]=t[i];return e}function na(t,e,i,s){var n=!i;i||(i={});for(var o=-1,r=e.length;++o<r;){var l=e[o],c=s?s(i[l],t[l],l,i,t):a;c===a&&(c=t[l]),n?Ts(i,l,c):Os(i,l,c)}return i}function aa(t,e){return function(i,s){var n=mr(i)?Ve:Ms,a=e?e():{};return n(i,t,Pa(s,2),a)}}function oa(t){return kn(function(e,i){var s=-1,n=i.length,o=n>1?i[n-1]:a,r=n>2?i[2]:a;for(o=t.length>3&&"function"==typeof o?(n--,o):a,r&&Ja(i[0],i[1],r)&&(o=n<3?a:o,n=1),e=ee(e);++s<n;){var l=i[s];l&&t(e,l,s,o)}return e})}function ra(t,e){return function(i,s){if(null==i)return i;if(!yr(i))return t(i,s);for(var n=i.length,a=e?n:-1,o=ee(i);(e?a--:++a<n)&&!1!==s(o[a],a,o););return i}}function la(t){return function(e,i,s){for(var n=-1,a=ee(e),o=s(e),r=o.length;r--;){var l=o[t?r:++n];if(!1===i(a[l],l,a))break}return e}}function ca(t){return function(e){var i=ki(e=Yr(e))?Ti(e):a,s=i?i[0]:e.charAt(0),n=i?Wn(i,1).join(""):e.slice(1);return s[t]()+n}}function ua(t){return function(e){return ei(kl(fl(e).replace(_e,"")),t,"")}}function ha(t){return function(){var e=arguments;switch(e.length){case 0:return new t;case 1:return new t(e[0]);case 2:return new t(e[0],e[1]);case 3:return new t(e[0],e[1],e[2]);case 4:return new t(e[0],e[1],e[2],e[3]);case 5:return new t(e[0],e[1],e[2],e[3],e[4]);case 6:return new t(e[0],e[1],e[2],e[3],e[4],e[5]);case 7:return new t(e[0],e[1],e[2],e[3],e[4],e[5],e[6])}var i=vs(t.prototype),s=t.apply(i,e);return Ir(s)?s:i}}function da(t){return function(e,i,s){var n=ee(e);if(!yr(e)){var o=Pa(i,3);e=nl(e),i=function(t){return o(n[t],t,n)}}var r=t(e,i,s);return r>-1?n[o?e[r]:r]:a}}function pa(t){return Ma(function(e){var i=e.length,s=i,n=fs.prototype.thru;for(t&&e.reverse();s--;){var o=e[s];if("function"!=typeof o)throw new ne(l);if(n&&!r&&"wrapper"==ja(o))var r=new fs([],!0)}for(s=r?s:i;++s<i;){var c=ja(o=e[s]),u="wrapper"==c?Fa(o):a;r=u&&Wa(u[0])&&u[1]==(k|R|C|x)&&!u[4].length&&1==u[9]?r[ja(u[0])].apply(r,u[3]):1==o.length&&Wa(o)?r[c]():r.thru(o)}return function(){var t=arguments,s=t[0];if(r&&1==t.length&&mr(s))return r.plant(s).value();for(var n=0,a=i?e[n].apply(this,t):s;++n<i;)a=e[n].call(this,a);return a}})}function va(t,e,i,n,o,r,l,c,u,h){var d=e&k,p=e&m,v=e&_,g=e&(R|b),f=e&$,y=v?a:ha(t);return function m(){for(var _=arguments.length,R=s(_),b=_;b--;)R[b]=arguments[b];if(g)var C=Ea(m),w=function(t,e){for(var i=t.length,s=0;i--;)t[i]===e&&++s;return s}(R,C);if(n&&(R=ea(R,n,o,g)),r&&(R=ia(R,r,l,g)),_-=w,g&&_<h){var k=Ii(R,C);return ba(t,e,va,m.placeholder,i,R,k,c,u,h-_)}var x=p?i:this,$=v?x[t]:t;return _=R.length,c?R=function(t,e){for(var i=t.length,s=Vi(e.length,i),n=sa(t);s--;){var o=e[s];t[s]=Va(o,i)?n[o]:a}return t}(R,c):f&&_>1&&R.reverse(),d&&u<_&&(R.length=u),this&&this!==Fe&&this instanceof m&&($=y||ha($)),$.apply(x,R)}}function ga(t,e){return function(i,s){return function(t,e,i,s){return Js(t,function(t,n,a){e(s,i(t),n,a)}),s}(i,t,e(s),{})}}function fa(t,e){return function(i,s){var n;if(i===a&&s===a)return e;if(i!==a&&(n=i),s!==a){if(n===a)return s;"string"==typeof i||"string"==typeof s?(i=Dn(i),s=Dn(s)):(i=Pn(i),s=Pn(s)),n=t(i,s)}return n}}function ma(t){return Ma(function(e){return e=Qe(e,fi(Pa())),kn(function(i){var s=this;return t(e,function(t){return Ye(t,s,i)})})})}function _a(t,e){var i=(e=e===a?" ":Dn(e)).length;if(i<2)return i?wn(e,t):e;var s=wn(e,Li(t/Si(e)));return ki(e)?Wn(Ti(s),0,t).join(""):s.slice(0,t)}function ya(t){return function(e,i,n){return n&&"number"!=typeof n&&Ja(e,i,n)&&(i=n=a),e=zr(e),i===a?(i=e,e=0):i=zr(i),function(t,e,i,n){for(var a=-1,o=Yi(Li((e-t)/(i||1)),0),r=s(o);o--;)r[n?o:++a]=t,t+=i;return r}(e,i,n=n===a?e<i?1:-1:zr(n),t)}}function Ra(t){return function(e,i){return"string"==typeof e&&"string"==typeof i||(e=Gr(e),i=Gr(i)),t(e,i)}}function ba(t,e,i,s,n,o,r,l,c,u){var h=e&R;e|=h?C:w,(e&=~(h?w:C))&y||(e&=~(m|_));var d=[t,e,n,h?o:a,h?r:a,h?a:o,h?a:r,l,c,u],p=i.apply(a,d);return Wa(t)&&io(p,d),p.placeholder=s,ao(p,t,e)}function Ca(t){var e=te[t];return function(t,i){if(t=Gr(t),i=null==i?0:Vi(Nr(i),292)){var s=(Yr(t)+"e").split("e");return+((s=(Yr(e(s[0]+"e"+(+s[1]+i)))+"e").split("e"))[0]+"e"+(+s[1]-i))}return e(t)}}var wa=ts&&1/Ai(new ts([,-0]))[1]==F?function(t){return new ts(t)}:El;function ka(t){return function(e){var i=Ba(e);return i==q?xi(e):i==it?Mi(e):function(t,e){return Qe(e,function(e){return[e,t[e]]})}(e,t(e))}}function xa(t,e,i,n,o,r,c,u){var d=e&_;if(!d&&"function"!=typeof t)throw new ne(l);var p=n?n.length:0;if(p||(e&=~(C|w),n=o=a),c=c===a?c:Yi(Nr(c),0),u=u===a?u:Nr(u),p-=o?o.length:0,e&w){var v=n,g=o;n=o=a}var f=d?a:Fa(t),$=[t,e,i,n,o,v,g,r,c,u];if(f&&function(t,e){var i=t[1],s=e[1],n=i|s,a=n<(m|_|k),o=s==k&&i==R||s==k&&i==x&&t[7].length<=e[8]||s==(k|x)&&e[7].length<=e[8]&&i==R;if(!a&&!o)return t;s&m&&(t[2]=e[2],n|=i&m?0:y);var r=e[3];if(r){var l=t[3];t[3]=l?ea(l,r,e[4]):r,t[4]=l?Ii(t[3],h):e[4]}(r=e[5])&&(l=t[5],t[5]=l?ia(l,r,e[6]):r,t[6]=l?Ii(t[5],h):e[6]),(r=e[7])&&(t[7]=r),s&k&&(t[8]=null==t[8]?e[8]:Vi(t[8],e[8])),null==t[9]&&(t[9]=e[9]),t[0]=e[0],t[1]=n}($,f),t=$[0],e=$[1],i=$[2],n=$[3],o=$[4],!(u=$[9]=$[9]===a?d?0:t.length:Yi($[9]-p,0))&&e&(R|b)&&(e&=~(R|b)),e&&e!=m)I=e==R||e==b?function(t,e,i){var n=ha(t);return function o(){for(var r=arguments.length,l=s(r),c=r,u=Ea(o);c--;)l[c]=arguments[c];var h=r<3&&l[0]!==u&&l[r-1]!==u?[]:Ii(l,u);return(r-=h.length)<i?ba(t,e,va,o.placeholder,a,l,h,a,a,i-r):Ye(this&&this!==Fe&&this instanceof o?n:t,this,l)}}(t,e,u):e!=C&&e!=(m|C)||o.length?va.apply(a,$):function(t,e,i,n){var a=e&m,o=ha(t);return function e(){for(var r=-1,l=arguments.length,c=-1,u=n.length,h=s(u+l),d=this&&this!==Fe&&this instanceof e?o:t;++c<u;)h[c]=n[c];for(;l--;)h[c++]=arguments[++r];return Ye(d,a?i:this,h)}}(t,e,i,n);else var I=function(t,e,i){var s=e&m,n=ha(t);return function e(){return(this&&this!==Fe&&this instanceof e?n:t).apply(s?i:this,arguments)}}(t,e,i);return ao((f?On:io)(I,$),t,e)}function $a(t,e,i,s){return t===a||pr(t,re[i])&&!ue.call(s,i)?e:t}function Ia(t,e,i,s,n,o){return Ir(t)&&Ir(e)&&(o.set(e,t),fn(t,e,a,Ia,o),o.delete(e)),t}function Oa(t){return Sr(t)?a:t}function Aa(t,e,i,s,n,o){var r=i&g,l=t.length,c=e.length;if(l!=c&&!(r&&c>l))return!1;var u=o.get(t);if(u&&o.get(e))return u==e;var h=-1,d=!0,p=i&f?new bs:a;for(o.set(t,e),o.set(e,t);++h<l;){var v=t[h],m=e[h];if(s)var _=r?s(m,v,h,e,t,o):s(v,m,h,t,e,o);if(_!==a){if(_)continue;d=!1;break}if(p){if(!si(e,function(t,e){if(!_i(p,e)&&(v===t||n(v,t,i,s,o)))return p.push(e)})){d=!1;break}}else if(v!==m&&!n(v,m,i,s,o)){d=!1;break}}return o.delete(t),o.delete(e),d}function Ma(t){return no(to(t,a,_o),t+"")}function Sa(t){return Ks(t,nl,za)}function Ta(t){return Ks(t,al,Na)}var Fa=ss?function(t){return ss.get(t)}:El;function ja(t){for(var e=t.name+"",i=ns[e],s=ue.call(ns,e)?i.length:0;s--;){var n=i[s],a=n.func;if(null==a||a==t)return n.name}return e}function Ea(t){return(ue.call(ps,"placeholder")?ps:t).placeholder}function Pa(){var t=ps.iteratee||Sl;return t=t===Sl?cn:t,arguments.length?t(arguments[0],arguments[1]):t}function Da(t,e){var i,s,n=t.__data__;return("string"==(s=typeof(i=e))||"number"==s||"symbol"==s||"boolean"==s?"__proto__"!==i:null===i)?n["string"==typeof e?"string":"hash"]:n.map}function La(t){for(var e=nl(t),i=e.length;i--;){var s=e[i],n=t[s];e[i]=[s,n,Za(n)]}return e}function Ha(t,e){var i=function(t,e){return null==t?a:t[e]}(t,e);return ln(i)?i:a}var za=zi?function(t){return null==t?[]:(t=ee(t),qe(zi(t),function(e){return je.call(t,e)}))}:Bl,Na=zi?function(t){for(var e=[];t;)ti(e,za(t)),t=Se(t);return e}:Bl,Ba=Zs;function Ga(t,e,i){for(var s=-1,n=(e=Jn(e,t)).length,a=!1;++s<n;){var o=co(e[s]);if(!(a=null!=t&&i(t,o)))break;t=t[o]}return a||++s!=n?a:!!(n=null==t?0:t.length)&&$r(n)&&Va(o,n)&&(mr(t)||fr(t))}function Ua(t){return"function"!=typeof t.constructor||Ka(t)?{}:vs(Se(t))}function Ya(t){return mr(t)||fr(t)||!!(De&&t&&t[De])}function Va(t,e){var i=typeof t;return!!(e=null==e?j:e)&&("number"==i||"symbol"!=i&&Xt.test(t))&&t>-1&&t%1==0&&t<e}function Ja(t,e,i){if(!Ir(i))return!1;var s=typeof e;return!!("number"==s?yr(i)&&Va(e,i.length):"string"==s&&e in i)&&pr(i[e],t)}function Xa(t,e){if(mr(t))return!1;var i=typeof t;return!("number"!=i&&"symbol"!=i&&"boolean"!=i&&null!=t&&!Er(t))||Mt.test(t)||!At.test(t)||null!=e&&t in ee(e)}function Wa(t){var e=ja(t),i=ps[e];if("function"!=typeof i||!(e in ms.prototype))return!1;if(t===i)return!0;var s=Fa(i);return!!s&&t===s[0]}(Ki&&Ba(new Ki(new ArrayBuffer(1)))!=ct||Zi&&Ba(new Zi)!=q||Qi&&"[object Promise]"!=Ba(Qi.resolve())||ts&&Ba(new ts)!=it||es&&Ba(new es)!=ot)&&(Ba=function(t){var e=Zs(t),i=e==Q?t.constructor:a,s=i?uo(i):"";if(s)switch(s){case as:return ct;case os:return q;case rs:return"[object Promise]";case ls:return it;case cs:return ot}return e});var qa=le?kr:Gl;function Ka(t){var e=t&&t.constructor;return t===("function"==typeof e&&e.prototype||re)}function Za(t){return t==t&&!Ir(t)}function Qa(t,e){return function(i){return null!=i&&i[t]===e&&(e!==a||t in ee(i))}}function to(t,e,i){return e=Yi(e===a?t.length-1:e,0),function(){for(var n=arguments,a=-1,o=Yi(n.length-e,0),r=s(o);++a<o;)r[a]=n[e+a];a=-1;for(var l=s(e+1);++a<e;)l[a]=n[a];return l[e]=i(r),Ye(t,this,l)}}function eo(t,e){return e.length<2?t:qs(t,Sn(e,0,-1))}var io=oo(On),so=Di||function(t,e){return Fe.setTimeout(t,e)},no=oo(An);function ao(t,e,i){var s=e+"";return no(t,function(t,e){var i=e.length;if(!i)return t;var s=i-1;return e[s]=(i>1?"& ":"")+e[s],e=e.join(i>2?", ":" "),t.replace(Dt,"{\n/* [wrapped with "+e+"] */\n")}(s,function(t,e){return Je(z,function(i){var s="_."+i[0];e&i[1]&&!Ke(t,s)&&t.push(s)}),t.sort()}(function(t){var e=t.match(Lt);return e?e[1].split(Ht):[]}(s),i)))}function oo(t){var e=0,i=0;return function(){var s=Ji(),n=M-(s-i);if(i=s,n>0){if(++e>=A)return arguments[0]}else e=0;return t.apply(a,arguments)}}function ro(t,e){var i=-1,s=t.length,n=s-1;for(e=e===a?s:e;++i<e;){var o=Cn(i,n),r=t[o];t[o]=t[i],t[i]=r}return t.length=e,t}var lo=function(t){var e=rr(t,function(t){return i.size===u&&i.clear(),t}),i=e.cache;return e}(function(t){var e=[];return 46===t.charCodeAt(0)&&e.push(""),t.replace(St,function(t,i,s,n){e.push(s?n.replace(Nt,"$1"):i||t)}),e});function co(t){if("string"==typeof t||Er(t))return t;var e=t+"";return"0"==e&&1/t==-F?"-0":e}function uo(t){if(null!=t){try{return ce.call(t)}catch(t){}try{return t+""}catch(t){}}return""}function ho(t){if(t instanceof ms)return t.clone();var e=new fs(t.__wrapped__,t.__chain__);return e.__actions__=sa(t.__actions__),e.__index__=t.__index__,e.__values__=t.__values__,e}var po=kn(function(t,e){return Rr(t)?Ls(t,Us(e,1,Rr,!0)):[]}),vo=kn(function(t,e){var i=wo(e);return Rr(i)&&(i=a),Rr(t)?Ls(t,Us(e,1,Rr,!0),Pa(i,2)):[]}),go=kn(function(t,e){var i=wo(e);return Rr(i)&&(i=a),Rr(t)?Ls(t,Us(e,1,Rr,!0),a,i):[]});function fo(t,e,i){var s=null==t?0:t.length;if(!s)return-1;var n=null==i?0:Nr(i);return n<0&&(n=Yi(s+n,0)),oi(t,Pa(e,3),n)}function mo(t,e,i){var s=null==t?0:t.length;if(!s)return-1;var n=s-1;return i!==a&&(n=Nr(i),n=i<0?Yi(s+n,0):Vi(n,s-1)),oi(t,Pa(e,3),n,!0)}function _o(t){return null!=t&&t.length?Us(t,1):[]}function yo(t){return t&&t.length?t[0]:a}var Ro=kn(function(t){var e=Qe(t,Yn);return e.length&&e[0]===t[0]?sn(e):[]}),bo=kn(function(t){var e=wo(t),i=Qe(t,Yn);return e===wo(i)?e=a:i.pop(),i.length&&i[0]===t[0]?sn(i,Pa(e,2)):[]}),Co=kn(function(t){var e=wo(t),i=Qe(t,Yn);return(e="function"==typeof e?e:a)&&i.pop(),i.length&&i[0]===t[0]?sn(i,a,e):[]});function wo(t){var e=null==t?0:t.length;return e?t[e-1]:a}var ko=kn(xo);function xo(t,e){return t&&t.length&&e&&e.length?Rn(t,e):t}var $o=Ma(function(t,e){var i=null==t?0:t.length,s=Fs(t,e);return bn(t,Qe(e,function(t){return Va(t,i)?+t:t}).sort(ta)),s});function Io(t){return null==t?t:qi.call(t)}var Oo=kn(function(t){return Ln(Us(t,1,Rr,!0))}),Ao=kn(function(t){var e=wo(t);return Rr(e)&&(e=a),Ln(Us(t,1,Rr,!0),Pa(e,2))}),Mo=kn(function(t){var e=wo(t);return e="function"==typeof e?e:a,Ln(Us(t,1,Rr,!0),a,e)});function So(t){if(!t||!t.length)return[];var e=0;return t=qe(t,function(t){if(Rr(t))return e=Yi(t.length,e),!0}),gi(e,function(e){return Qe(t,hi(e))})}function To(t,e){if(!t||!t.length)return[];var i=So(t);return null==e?i:Qe(i,function(t){return Ye(e,a,t)})}var Fo=kn(function(t,e){return Rr(t)?Ls(t,e):[]}),jo=kn(function(t){return Gn(qe(t,Rr))}),Eo=kn(function(t){var e=wo(t);return Rr(e)&&(e=a),Gn(qe(t,Rr),Pa(e,2))}),Po=kn(function(t){var e=wo(t);return e="function"==typeof e?e:a,Gn(qe(t,Rr),a,e)}),Do=kn(So);var Lo=kn(function(t){var e=t.length,i=e>1?t[e-1]:a;return To(t,i="function"==typeof i?(t.pop(),i):a)});function Ho(t){var e=ps(t);return e.__chain__=!0,e}function zo(t,e){return e(t)}var No=Ma(function(t){var e=t.length,i=e?t[0]:0,s=this.__wrapped__,n=function(e){return Fs(e,t)};return!(e>1||this.__actions__.length)&&s instanceof ms&&Va(i)?((s=s.slice(i,+i+(e?1:0))).__actions__.push({func:zo,args:[n],thisArg:a}),new fs(s,this.__chain__).thru(function(t){return e&&!t.length&&t.push(a),t})):this.thru(n)});var Bo=aa(function(t,e,i){ue.call(t,i)?++t[i]:Ts(t,i,1)});var Go=da(fo),Uo=da(mo);function Yo(t,e){return(mr(t)?Je:Hs)(t,Pa(e,3))}function Vo(t,e){return(mr(t)?Xe:zs)(t,Pa(e,3))}var Jo=aa(function(t,e,i){ue.call(t,i)?t[i].push(e):Ts(t,i,[e])});var Xo=kn(function(t,e,i){var n=-1,a="function"==typeof e,o=yr(t)?s(t.length):[];return Hs(t,function(t){o[++n]=a?Ye(e,t,i):nn(t,e,i)}),o}),Wo=aa(function(t,e,i){Ts(t,i,e)});function qo(t,e){return(mr(t)?Qe:pn)(t,Pa(e,3))}var Ko=aa(function(t,e,i){t[i?0:1].push(e)},function(){return[[],[]]});var Zo=kn(function(t,e){if(null==t)return[];var i=e.length;return i>1&&Ja(t,e[0],e[1])?e=[]:i>2&&Ja(e[0],e[1],e[2])&&(e=[e[0]]),_n(t,Us(e,1),[])}),Qo=Pi||function(){return Fe.Date.now()};function tr(t,e,i){return e=i?a:e,e=t&&null==e?t.length:e,xa(t,k,a,a,a,a,e)}function er(t,e){var i;if("function"!=typeof e)throw new ne(l);return t=Nr(t),function(){return--t>0&&(i=e.apply(this,arguments)),t<=1&&(e=a),i}}var ir=kn(function(t,e,i){var s=m;if(i.length){var n=Ii(i,Ea(ir));s|=C}return xa(t,s,e,i,n)}),sr=kn(function(t,e,i){var s=m|_;if(i.length){var n=Ii(i,Ea(sr));s|=C}return xa(e,s,t,i,n)});function nr(t,e,i){var s,n,o,r,c,u,h=0,d=!1,p=!1,v=!0;if("function"!=typeof t)throw new ne(l);function g(e){var i=s,o=n;return s=n=a,h=e,r=t.apply(o,i)}function f(t){var i=t-u;return u===a||i>=e||i<0||p&&t-h>=o}function m(){var t=Qo();if(f(t))return _(t);c=so(m,function(t){var i=e-(t-u);return p?Vi(i,o-(t-h)):i}(t))}function _(t){return c=a,v&&s?g(t):(s=n=a,r)}function y(){var t=Qo(),i=f(t);if(s=arguments,n=this,u=t,i){if(c===a)return function(t){return h=t,c=so(m,e),d?g(t):r}(u);if(p)return c=so(m,e),g(u)}return c===a&&(c=so(m,e)),r}return e=Gr(e)||0,Ir(i)&&(d=!!i.leading,o=(p="maxWait"in i)?Yi(Gr(i.maxWait)||0,e):o,v="trailing"in i?!!i.trailing:v),y.cancel=function(){c!==a&&qn(c),h=0,s=u=n=c=a},y.flush=function(){return c===a?r:_(Qo())},y}var ar=kn(function(t,e){return Ds(t,1,e)}),or=kn(function(t,e,i){return Ds(t,Gr(e)||0,i)});function rr(t,e){if("function"!=typeof t||null!=e&&"function"!=typeof e)throw new ne(l);var i=function(){var s=arguments,n=e?e.apply(this,s):s[0],a=i.cache;if(a.has(n))return a.get(n);var o=t.apply(this,s);return i.cache=a.set(n,o)||a,o};return i.cache=new(rr.Cache||Rs),i}function lr(t){if("function"!=typeof t)throw new ne(l);return function(){var e=arguments;switch(e.length){case 0:return!t.call(this);case 1:return!t.call(this,e[0]);case 2:return!t.call(this,e[0],e[1]);case 3:return!t.call(this,e[0],e[1],e[2])}return!t.apply(this,e)}}rr.Cache=Rs;var cr=Xn(function(t,e){var i=(e=1==e.length&&mr(e[0])?Qe(e[0],fi(Pa())):Qe(Us(e,1),fi(Pa()))).length;return kn(function(s){for(var n=-1,a=Vi(s.length,i);++n<a;)s[n]=e[n].call(this,s[n]);return Ye(t,this,s)})}),ur=kn(function(t,e){var i=Ii(e,Ea(ur));return xa(t,C,a,e,i)}),hr=kn(function(t,e){var i=Ii(e,Ea(hr));return xa(t,w,a,e,i)}),dr=Ma(function(t,e){return xa(t,x,a,a,a,e)});function pr(t,e){return t===e||t!=t&&e!=e}var vr=Ra(Qs),gr=Ra(function(t,e){return t>=e}),fr=an(function(){return arguments}())?an:function(t){return Or(t)&&ue.call(t,"callee")&&!je.call(t,"callee")},mr=s.isArray,_r=He?fi(He):function(t){return Or(t)&&Zs(t)==lt};function yr(t){return null!=t&&$r(t.length)&&!kr(t)}function Rr(t){return Or(t)&&yr(t)}var br=Ni||Gl,Cr=ze?fi(ze):function(t){return Or(t)&&Zs(t)==Y};function wr(t){if(!Or(t))return!1;var e=Zs(t);return e==J||e==V||"string"==typeof t.message&&"string"==typeof t.name&&!Sr(t)}function kr(t){if(!Ir(t))return!1;var e=Zs(t);return e==X||e==W||e==G||e==tt}function xr(t){return"number"==typeof t&&t==Nr(t)}function $r(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=j}function Ir(t){var e=typeof t;return null!=t&&("object"==e||"function"==e)}function Or(t){return null!=t&&"object"==typeof t}var Ar=Ne?fi(Ne):function(t){return Or(t)&&Ba(t)==q};function Mr(t){return"number"==typeof t||Or(t)&&Zs(t)==K}function Sr(t){if(!Or(t)||Zs(t)!=Q)return!1;var e=Se(t);if(null===e)return!0;var i=ue.call(e,"constructor")&&e.constructor;return"function"==typeof i&&i instanceof i&&ce.call(i)==ve}var Tr=Be?fi(Be):function(t){return Or(t)&&Zs(t)==et};var Fr=Ge?fi(Ge):function(t){return Or(t)&&Ba(t)==it};function jr(t){return"string"==typeof t||!mr(t)&&Or(t)&&Zs(t)==st}function Er(t){return"symbol"==typeof t||Or(t)&&Zs(t)==nt}var Pr=Ue?fi(Ue):function(t){return Or(t)&&$r(t.length)&&!!$e[Zs(t)]};var Dr=Ra(dn),Lr=Ra(function(t,e){return t<=e});function Hr(t){if(!t)return[];if(yr(t))return jr(t)?Ti(t):sa(t);if(Le&&t[Le])return function(t){for(var e,i=[];!(e=t.next()).done;)i.push(e.value);return i}(t[Le]());var e=Ba(t);return(e==q?xi:e==it?Ai:pl)(t)}function zr(t){return t?(t=Gr(t))===F||t===-F?(t<0?-1:1)*E:t==t?t:0:0===t?t:0}function Nr(t){var e=zr(t),i=e%1;return e==e?i?e-i:e:0}function Br(t){return t?js(Nr(t),0,D):0}function Gr(t){if("number"==typeof t)return t;if(Er(t))return P;if(Ir(t)){var e="function"==typeof t.valueOf?t.valueOf():t;t=Ir(e)?e+"":e}if("string"!=typeof t)return 0===t?t:+t;t=t.replace(jt,"");var i=Yt.test(t);return i||Jt.test(t)?Me(t.slice(2),i?2:8):Ut.test(t)?P:+t}function Ur(t){return na(t,al(t))}function Yr(t){return null==t?"":Dn(t)}var Vr=oa(function(t,e){if(Ka(e)||yr(e))na(e,nl(e),t);else for(var i in e)ue.call(e,i)&&Os(t,i,e[i])}),Jr=oa(function(t,e){na(e,al(e),t)}),Xr=oa(function(t,e,i,s){na(e,al(e),t,s)}),Wr=oa(function(t,e,i,s){na(e,nl(e),t,s)}),qr=Ma(Fs);var Kr=kn(function(t,e){t=ee(t);var i=-1,s=e.length,n=s>2?e[2]:a;for(n&&Ja(e[0],e[1],n)&&(s=1);++i<s;)for(var o=e[i],r=al(o),l=-1,c=r.length;++l<c;){var u=r[l],h=t[u];(h===a||pr(h,re[u])&&!ue.call(t,u))&&(t[u]=o[u])}return t}),Zr=kn(function(t){return t.push(a,Ia),Ye(rl,a,t)});function Qr(t,e,i){var s=null==t?a:qs(t,e);return s===a?i:s}function tl(t,e){return null!=t&&Ga(t,e,en)}var el=ga(function(t,e,i){null!=e&&"function"!=typeof e.toString&&(e=pe.call(e)),t[e]=i},Il(Ml)),il=ga(function(t,e,i){null!=e&&"function"!=typeof e.toString&&(e=pe.call(e)),ue.call(t,e)?t[e].push(i):t[e]=[i]},Pa),sl=kn(nn);function nl(t){return yr(t)?ws(t):un(t)}function al(t){return yr(t)?ws(t,!0):hn(t)}var ol=oa(function(t,e,i){fn(t,e,i)}),rl=oa(function(t,e,i,s){fn(t,e,i,s)}),ll=Ma(function(t,e){var i={};if(null==t)return i;var s=!1;e=Qe(e,function(e){return e=Jn(e,t),s||(s=e.length>1),e}),na(t,Ta(t),i),s&&(i=Es(i,d|p|v,Oa));for(var n=e.length;n--;)Hn(i,e[n]);return i});var cl=Ma(function(t,e){return null==t?{}:function(t,e){return yn(t,e,function(e,i){return tl(t,i)})}(t,e)});function ul(t,e){if(null==t)return{};var i=Qe(Ta(t),function(t){return[t]});return e=Pa(e),yn(t,i,function(t,i){return e(t,i[0])})}var hl=ka(nl),dl=ka(al);function pl(t){return null==t?[]:mi(t,nl(t))}var vl=ua(function(t,e,i){return e=e.toLowerCase(),t+(i?gl(e):e)});function gl(t){return wl(Yr(t).toLowerCase())}function fl(t){return(t=Yr(t))&&t.replace(Wt,bi).replace(ye,"")}var ml=ua(function(t,e,i){return t+(i?"-":"")+e.toLowerCase()}),_l=ua(function(t,e,i){return t+(i?" ":"")+e.toLowerCase()}),yl=ca("toLowerCase");var Rl=ua(function(t,e,i){return t+(i?"_":"")+e.toLowerCase()});var bl=ua(function(t,e,i){return t+(i?" ":"")+wl(e)});var Cl=ua(function(t,e,i){return t+(i?" ":"")+e.toUpperCase()}),wl=ca("toUpperCase");function kl(t,e,i){return t=Yr(t),(e=i?a:e)===a?function(t){return we.test(t)}(t)?function(t){return t.match(be)||[]}(t):function(t){return t.match(zt)||[]}(t):t.match(e)||[]}var xl=kn(function(t,e){try{return Ye(t,a,e)}catch(t){return wr(t)?t:new Zt(t)}}),$l=Ma(function(t,e){return Je(e,function(e){e=co(e),Ts(t,e,ir(t[e],t))}),t});function Il(t){return function(){return t}}var Ol=pa(),Al=pa(!0);function Ml(t){return t}function Sl(t){return cn("function"==typeof t?t:Es(t,d))}var Tl=kn(function(t,e){return function(i){return nn(i,t,e)}}),Fl=kn(function(t,e){return function(i){return nn(t,i,e)}});function jl(t,e,i){var s=nl(e),n=Ws(e,s);null!=i||Ir(e)&&(n.length||!s.length)||(i=e,e=t,t=this,n=Ws(e,nl(e)));var a=!(Ir(i)&&"chain"in i&&!i.chain),o=kr(t);return Je(n,function(i){var s=e[i];t[i]=s,o&&(t.prototype[i]=function(){var e=this.__chain__;if(a||e){var i=t(this.__wrapped__);return(i.__actions__=sa(this.__actions__)).push({func:s,args:arguments,thisArg:t}),i.__chain__=e,i}return s.apply(t,ti([this.value()],arguments))})}),t}function El(){}var Pl=ma(Qe),Dl=ma(We),Ll=ma(si);function Hl(t){return Xa(t)?hi(co(t)):function(t){return function(e){return qs(e,t)}}(t)}var zl=ya(),Nl=ya(!0);function Bl(){return[]}function Gl(){return!1}var Ul=fa(function(t,e){return t+e},0),Yl=Ca("ceil"),Vl=fa(function(t,e){return t/e},1),Jl=Ca("floor");var Xl,Wl=fa(function(t,e){return t*e},1),ql=Ca("round"),Kl=fa(function(t,e){return t-e},0);return ps.after=function(t,e){if("function"!=typeof e)throw new ne(l);return t=Nr(t),function(){if(--t<1)return e.apply(this,arguments)}},ps.ary=tr,ps.assign=Vr,ps.assignIn=Jr,ps.assignInWith=Xr,ps.assignWith=Wr,ps.at=qr,ps.before=er,ps.bind=ir,ps.bindAll=$l,ps.bindKey=sr,ps.castArray=function(){if(!arguments.length)return[];var t=arguments[0];return mr(t)?t:[t]},ps.chain=Ho,ps.chunk=function(t,e,i){e=(i?Ja(t,e,i):e===a)?1:Yi(Nr(e),0);var n=null==t?0:t.length;if(!n||e<1)return[];for(var o=0,r=0,l=s(Li(n/e));o<n;)l[r++]=Sn(t,o,o+=e);return l},ps.compact=function(t){for(var e=-1,i=null==t?0:t.length,s=0,n=[];++e<i;){var a=t[e];a&&(n[s++]=a)}return n},ps.concat=function(){var t=arguments.length;if(!t)return[];for(var e=s(t-1),i=arguments[0],n=t;n--;)e[n-1]=arguments[n];return ti(mr(i)?sa(i):[i],Us(e,1))},ps.cond=function(t){var e=null==t?0:t.length,i=Pa();return t=e?Qe(t,function(t){if("function"!=typeof t[1])throw new ne(l);return[i(t[0]),t[1]]}):[],kn(function(i){for(var s=-1;++s<e;){var n=t[s];if(Ye(n[0],this,i))return Ye(n[1],this,i)}})},ps.conforms=function(t){return function(t){var e=nl(t);return function(i){return Ps(i,t,e)}}(Es(t,d))},ps.constant=Il,ps.countBy=Bo,ps.create=function(t,e){var i=vs(t);return null==e?i:Ss(i,e)},ps.curry=function t(e,i,s){var n=xa(e,R,a,a,a,a,a,i=s?a:i);return n.placeholder=t.placeholder,n},ps.curryRight=function t(e,i,s){var n=xa(e,b,a,a,a,a,a,i=s?a:i);return n.placeholder=t.placeholder,n},ps.debounce=nr,ps.defaults=Kr,ps.defaultsDeep=Zr,ps.defer=ar,ps.delay=or,ps.difference=po,ps.differenceBy=vo,ps.differenceWith=go,ps.drop=function(t,e,i){var s=null==t?0:t.length;return s?Sn(t,(e=i||e===a?1:Nr(e))<0?0:e,s):[]},ps.dropRight=function(t,e,i){var s=null==t?0:t.length;return s?Sn(t,0,(e=s-(e=i||e===a?1:Nr(e)))<0?0:e):[]},ps.dropRightWhile=function(t,e){return t&&t.length?Nn(t,Pa(e,3),!0,!0):[]},ps.dropWhile=function(t,e){return t&&t.length?Nn(t,Pa(e,3),!0):[]},ps.fill=function(t,e,i,s){var n=null==t?0:t.length;return n?(i&&"number"!=typeof i&&Ja(t,e,i)&&(i=0,s=n),function(t,e,i,s){var n=t.length;for((i=Nr(i))<0&&(i=-i>n?0:n+i),(s=s===a||s>n?n:Nr(s))<0&&(s+=n),s=i>s?0:Br(s);i<s;)t[i++]=e;return t}(t,e,i,s)):[]},ps.filter=function(t,e){return(mr(t)?qe:Gs)(t,Pa(e,3))},ps.flatMap=function(t,e){return Us(qo(t,e),1)},ps.flatMapDeep=function(t,e){return Us(qo(t,e),F)},ps.flatMapDepth=function(t,e,i){return i=i===a?1:Nr(i),Us(qo(t,e),i)},ps.flatten=_o,ps.flattenDeep=function(t){return null!=t&&t.length?Us(t,F):[]},ps.flattenDepth=function(t,e){return null!=t&&t.length?Us(t,e=e===a?1:Nr(e)):[]},ps.flip=function(t){return xa(t,$)},ps.flow=Ol,ps.flowRight=Al,ps.fromPairs=function(t){for(var e=-1,i=null==t?0:t.length,s={};++e<i;){var n=t[e];s[n[0]]=n[1]}return s},ps.functions=function(t){return null==t?[]:Ws(t,nl(t))},ps.functionsIn=function(t){return null==t?[]:Ws(t,al(t))},ps.groupBy=Jo,ps.initial=function(t){return null!=t&&t.length?Sn(t,0,-1):[]},ps.intersection=Ro,ps.intersectionBy=bo,ps.intersectionWith=Co,ps.invert=el,ps.invertBy=il,ps.invokeMap=Xo,ps.iteratee=Sl,ps.keyBy=Wo,ps.keys=nl,ps.keysIn=al,ps.map=qo,ps.mapKeys=function(t,e){var i={};return e=Pa(e,3),Js(t,function(t,s,n){Ts(i,e(t,s,n),t)}),i},ps.mapValues=function(t,e){var i={};return e=Pa(e,3),Js(t,function(t,s,n){Ts(i,s,e(t,s,n))}),i},ps.matches=function(t){return vn(Es(t,d))},ps.matchesProperty=function(t,e){return gn(t,Es(e,d))},ps.memoize=rr,ps.merge=ol,ps.mergeWith=rl,ps.method=Tl,ps.methodOf=Fl,ps.mixin=jl,ps.negate=lr,ps.nthArg=function(t){return t=Nr(t),kn(function(e){return mn(e,t)})},ps.omit=ll,ps.omitBy=function(t,e){return ul(t,lr(Pa(e)))},ps.once=function(t){return er(2,t)},ps.orderBy=function(t,e,i,s){return null==t?[]:(mr(e)||(e=null==e?[]:[e]),mr(i=s?a:i)||(i=null==i?[]:[i]),_n(t,e,i))},ps.over=Pl,ps.overArgs=cr,ps.overEvery=Dl,ps.overSome=Ll,ps.partial=ur,ps.partialRight=hr,ps.partition=Ko,ps.pick=cl,ps.pickBy=ul,ps.property=Hl,ps.propertyOf=function(t){return function(e){return null==t?a:qs(t,e)}},ps.pull=ko,ps.pullAll=xo,ps.pullAllBy=function(t,e,i){return t&&t.length&&e&&e.length?Rn(t,e,Pa(i,2)):t},ps.pullAllWith=function(t,e,i){return t&&t.length&&e&&e.length?Rn(t,e,a,i):t},ps.pullAt=$o,ps.range=zl,ps.rangeRight=Nl,ps.rearg=dr,ps.reject=function(t,e){return(mr(t)?qe:Gs)(t,lr(Pa(e,3)))},ps.remove=function(t,e){var i=[];if(!t||!t.length)return i;var s=-1,n=[],a=t.length;for(e=Pa(e,3);++s<a;){var o=t[s];e(o,s,t)&&(i.push(o),n.push(s))}return bn(t,n),i},ps.rest=function(t,e){if("function"!=typeof t)throw new ne(l);return kn(t,e=e===a?e:Nr(e))},ps.reverse=Io,ps.sampleSize=function(t,e,i){return e=(i?Ja(t,e,i):e===a)?1:Nr(e),(mr(t)?xs:$n)(t,e)},ps.set=function(t,e,i){return null==t?t:In(t,e,i)},ps.setWith=function(t,e,i,s){return s="function"==typeof s?s:a,null==t?t:In(t,e,i,s)},ps.shuffle=function(t){return(mr(t)?$s:Mn)(t)},ps.slice=function(t,e,i){var s=null==t?0:t.length;return s?(i&&"number"!=typeof i&&Ja(t,e,i)?(e=0,i=s):(e=null==e?0:Nr(e),i=i===a?s:Nr(i)),Sn(t,e,i)):[]},ps.sortBy=Zo,ps.sortedUniq=function(t){return t&&t.length?En(t):[]},ps.sortedUniqBy=function(t,e){return t&&t.length?En(t,Pa(e,2)):[]},ps.split=function(t,e,i){return i&&"number"!=typeof i&&Ja(t,e,i)&&(e=i=a),(i=i===a?D:i>>>0)?(t=Yr(t))&&("string"==typeof e||null!=e&&!Tr(e))&&!(e=Dn(e))&&ki(t)?Wn(Ti(t),0,i):t.split(e,i):[]},ps.spread=function(t,e){if("function"!=typeof t)throw new ne(l);return e=null==e?0:Yi(Nr(e),0),kn(function(i){var s=i[e],n=Wn(i,0,e);return s&&ti(n,s),Ye(t,this,n)})},ps.tail=function(t){var e=null==t?0:t.length;return e?Sn(t,1,e):[]},ps.take=function(t,e,i){return t&&t.length?Sn(t,0,(e=i||e===a?1:Nr(e))<0?0:e):[]},ps.takeRight=function(t,e,i){var s=null==t?0:t.length;return s?Sn(t,(e=s-(e=i||e===a?1:Nr(e)))<0?0:e,s):[]},ps.takeRightWhile=function(t,e){return t&&t.length?Nn(t,Pa(e,3),!1,!0):[]},ps.takeWhile=function(t,e){return t&&t.length?Nn(t,Pa(e,3)):[]},ps.tap=function(t,e){return e(t),t},ps.throttle=function(t,e,i){var s=!0,n=!0;if("function"!=typeof t)throw new ne(l);return Ir(i)&&(s="leading"in i?!!i.leading:s,n="trailing"in i?!!i.trailing:n),nr(t,e,{leading:s,maxWait:e,trailing:n})},ps.thru=zo,ps.toArray=Hr,ps.toPairs=hl,ps.toPairsIn=dl,ps.toPath=function(t){return mr(t)?Qe(t,co):Er(t)?[t]:sa(lo(Yr(t)))},ps.toPlainObject=Ur,ps.transform=function(t,e,i){var s=mr(t),n=s||br(t)||Pr(t);if(e=Pa(e,4),null==i){var a=t&&t.constructor;i=n?s?new a:[]:Ir(t)&&kr(a)?vs(Se(t)):{}}return(n?Je:Js)(t,function(t,s,n){return e(i,t,s,n)}),i},ps.unary=function(t){return tr(t,1)},ps.union=Oo,ps.unionBy=Ao,ps.unionWith=Mo,ps.uniq=function(t){return t&&t.length?Ln(t):[]},ps.uniqBy=function(t,e){return t&&t.length?Ln(t,Pa(e,2)):[]},ps.uniqWith=function(t,e){return e="function"==typeof e?e:a,t&&t.length?Ln(t,a,e):[]},ps.unset=function(t,e){return null==t||Hn(t,e)},ps.unzip=So,ps.unzipWith=To,ps.update=function(t,e,i){return null==t?t:zn(t,e,Vn(i))},ps.updateWith=function(t,e,i,s){return s="function"==typeof s?s:a,null==t?t:zn(t,e,Vn(i),s)},ps.values=pl,ps.valuesIn=function(t){return null==t?[]:mi(t,al(t))},ps.without=Fo,ps.words=kl,ps.wrap=function(t,e){return ur(Vn(e),t)},ps.xor=jo,ps.xorBy=Eo,ps.xorWith=Po,ps.zip=Do,ps.zipObject=function(t,e){return Un(t||[],e||[],Os)},ps.zipObjectDeep=function(t,e){return Un(t||[],e||[],In)},ps.zipWith=Lo,ps.entries=hl,ps.entriesIn=dl,ps.extend=Jr,ps.extendWith=Xr,jl(ps,ps),ps.add=Ul,ps.attempt=xl,ps.camelCase=vl,ps.capitalize=gl,ps.ceil=Yl,ps.clamp=function(t,e,i){return i===a&&(i=e,e=a),i!==a&&(i=(i=Gr(i))==i?i:0),e!==a&&(e=(e=Gr(e))==e?e:0),js(Gr(t),e,i)},ps.clone=function(t){return Es(t,v)},ps.cloneDeep=function(t){return Es(t,d|v)},ps.cloneDeepWith=function(t,e){return Es(t,d|v,e="function"==typeof e?e:a)},ps.cloneWith=function(t,e){return Es(t,v,e="function"==typeof e?e:a)},ps.conformsTo=function(t,e){return null==e||Ps(t,e,nl(e))},ps.deburr=fl,ps.defaultTo=function(t,e){return null==t||t!=t?e:t},ps.divide=Vl,ps.endsWith=function(t,e,i){t=Yr(t),e=Dn(e);var s=t.length,n=i=i===a?s:js(Nr(i),0,s);return(i-=e.length)>=0&&t.slice(i,n)==e},ps.eq=pr,ps.escape=function(t){return(t=Yr(t))&&xt.test(t)?t.replace(wt,Ci):t},ps.escapeRegExp=function(t){return(t=Yr(t))&&Ft.test(t)?t.replace(Tt,"\\$&"):t},ps.every=function(t,e,i){var s=mr(t)?We:Ns;return i&&Ja(t,e,i)&&(e=a),s(t,Pa(e,3))},ps.find=Go,ps.findIndex=fo,ps.findKey=function(t,e){return ai(t,Pa(e,3),Js)},ps.findLast=Uo,ps.findLastIndex=mo,ps.findLastKey=function(t,e){return ai(t,Pa(e,3),Xs)},ps.floor=Jl,ps.forEach=Yo,ps.forEachRight=Vo,ps.forIn=function(t,e){return null==t?t:Ys(t,Pa(e,3),al)},ps.forInRight=function(t,e){return null==t?t:Vs(t,Pa(e,3),al)},ps.forOwn=function(t,e){return t&&Js(t,Pa(e,3))},ps.forOwnRight=function(t,e){return t&&Xs(t,Pa(e,3))},ps.get=Qr,ps.gt=vr,ps.gte=gr,ps.has=function(t,e){return null!=t&&Ga(t,e,tn)},ps.hasIn=tl,ps.head=yo,ps.identity=Ml,ps.includes=function(t,e,i,s){t=yr(t)?t:pl(t),i=i&&!s?Nr(i):0;var n=t.length;return i<0&&(i=Yi(n+i,0)),jr(t)?i<=n&&t.indexOf(e,i)>-1:!!n&&ri(t,e,i)>-1},ps.indexOf=function(t,e,i){var s=null==t?0:t.length;if(!s)return-1;var n=null==i?0:Nr(i);return n<0&&(n=Yi(s+n,0)),ri(t,e,n)},ps.inRange=function(t,e,i){return e=zr(e),i===a?(i=e,e=0):i=zr(i),function(t,e,i){return t>=Vi(e,i)&&t<Yi(e,i)}(t=Gr(t),e,i)},ps.invoke=sl,ps.isArguments=fr,ps.isArray=mr,ps.isArrayBuffer=_r,ps.isArrayLike=yr,ps.isArrayLikeObject=Rr,ps.isBoolean=function(t){return!0===t||!1===t||Or(t)&&Zs(t)==U},ps.isBuffer=br,ps.isDate=Cr,ps.isElement=function(t){return Or(t)&&1===t.nodeType&&!Sr(t)},ps.isEmpty=function(t){if(null==t)return!0;if(yr(t)&&(mr(t)||"string"==typeof t||"function"==typeof t.splice||br(t)||Pr(t)||fr(t)))return!t.length;var e=Ba(t);if(e==q||e==it)return!t.size;if(Ka(t))return!un(t).length;for(var i in t)if(ue.call(t,i))return!1;return!0},ps.isEqual=function(t,e){return on(t,e)},ps.isEqualWith=function(t,e,i){var s=(i="function"==typeof i?i:a)?i(t,e):a;return s===a?on(t,e,a,i):!!s},ps.isError=wr,ps.isFinite=function(t){return"number"==typeof t&&Bi(t)},ps.isFunction=kr,ps.isInteger=xr,ps.isLength=$r,ps.isMap=Ar,ps.isMatch=function(t,e){return t===e||rn(t,e,La(e))},ps.isMatchWith=function(t,e,i){return i="function"==typeof i?i:a,rn(t,e,La(e),i)},ps.isNaN=function(t){return Mr(t)&&t!=+t},ps.isNative=function(t){if(qa(t))throw new Zt(r);return ln(t)},ps.isNil=function(t){return null==t},ps.isNull=function(t){return null===t},ps.isNumber=Mr,ps.isObject=Ir,ps.isObjectLike=Or,ps.isPlainObject=Sr,ps.isRegExp=Tr,ps.isSafeInteger=function(t){return xr(t)&&t>=-j&&t<=j},ps.isSet=Fr,ps.isString=jr,ps.isSymbol=Er,ps.isTypedArray=Pr,ps.isUndefined=function(t){return t===a},ps.isWeakMap=function(t){return Or(t)&&Ba(t)==ot},ps.isWeakSet=function(t){return Or(t)&&Zs(t)==rt},ps.join=function(t,e){return null==t?"":Gi.call(t,e)},ps.kebabCase=ml,ps.last=wo,ps.lastIndexOf=function(t,e,i){var s=null==t?0:t.length;if(!s)return-1;var n=s;return i!==a&&(n=(n=Nr(i))<0?Yi(s+n,0):Vi(n,s-1)),e==e?function(t,e,i){for(var s=i+1;s--;)if(t[s]===e)return s;return s}(t,e,n):oi(t,ci,n,!0)},ps.lowerCase=_l,ps.lowerFirst=yl,ps.lt=Dr,ps.lte=Lr,ps.max=function(t){return t&&t.length?Bs(t,Ml,Qs):a},ps.maxBy=function(t,e){return t&&t.length?Bs(t,Pa(e,2),Qs):a},ps.mean=function(t){return ui(t,Ml)},ps.meanBy=function(t,e){return ui(t,Pa(e,2))},ps.min=function(t){return t&&t.length?Bs(t,Ml,dn):a},ps.minBy=function(t,e){return t&&t.length?Bs(t,Pa(e,2),dn):a},ps.stubArray=Bl,ps.stubFalse=Gl,ps.stubObject=function(){return{}},ps.stubString=function(){return""},ps.stubTrue=function(){return!0},ps.multiply=Wl,ps.nth=function(t,e){return t&&t.length?mn(t,Nr(e)):a},ps.noConflict=function(){return Fe._===this&&(Fe._=ge),this},ps.noop=El,ps.now=Qo,ps.pad=function(t,e,i){t=Yr(t);var s=(e=Nr(e))?Si(t):0;if(!e||s>=e)return t;var n=(e-s)/2;return _a(Hi(n),i)+t+_a(Li(n),i)},ps.padEnd=function(t,e,i){t=Yr(t);var s=(e=Nr(e))?Si(t):0;return e&&s<e?t+_a(e-s,i):t},ps.padStart=function(t,e,i){t=Yr(t);var s=(e=Nr(e))?Si(t):0;return e&&s<e?_a(e-s,i)+t:t},ps.parseInt=function(t,e,i){return i||null==e?e=0:e&&(e=+e),Xi(Yr(t).replace(Et,""),e||0)},ps.random=function(t,e,i){if(i&&"boolean"!=typeof i&&Ja(t,e,i)&&(e=i=a),i===a&&("boolean"==typeof e?(i=e,e=a):"boolean"==typeof t&&(i=t,t=a)),t===a&&e===a?(t=0,e=1):(t=zr(t),e===a?(e=t,t=0):e=zr(e)),t>e){var s=t;t=e,e=s}if(i||t%1||e%1){var n=Wi();return Vi(t+n*(e-t+Ae("1e-"+((n+"").length-1))),e)}return Cn(t,e)},ps.reduce=function(t,e,i){var s=mr(t)?ei:pi,n=arguments.length<3;return s(t,Pa(e,4),i,n,Hs)},ps.reduceRight=function(t,e,i){var s=mr(t)?ii:pi,n=arguments.length<3;return s(t,Pa(e,4),i,n,zs)},ps.repeat=function(t,e,i){return e=(i?Ja(t,e,i):e===a)?1:Nr(e),wn(Yr(t),e)},ps.replace=function(){var t=arguments,e=Yr(t[0]);return t.length<3?e:e.replace(t[1],t[2])},ps.result=function(t,e,i){var s=-1,n=(e=Jn(e,t)).length;for(n||(n=1,t=a);++s<n;){var o=null==t?a:t[co(e[s])];o===a&&(s=n,o=i),t=kr(o)?o.call(t):o}return t},ps.round=ql,ps.runInContext=t,ps.sample=function(t){return(mr(t)?ks:xn)(t)},ps.size=function(t){if(null==t)return 0;if(yr(t))return jr(t)?Si(t):t.length;var e=Ba(t);return e==q||e==it?t.size:un(t).length},ps.snakeCase=Rl,ps.some=function(t,e,i){var s=mr(t)?si:Tn;return i&&Ja(t,e,i)&&(e=a),s(t,Pa(e,3))},ps.sortedIndex=function(t,e){return Fn(t,e)},ps.sortedIndexBy=function(t,e,i){return jn(t,e,Pa(i,2))},ps.sortedIndexOf=function(t,e){var i=null==t?0:t.length;if(i){var s=Fn(t,e);if(s<i&&pr(t[s],e))return s}return-1},ps.sortedLastIndex=function(t,e){return Fn(t,e,!0)},ps.sortedLastIndexBy=function(t,e,i){return jn(t,e,Pa(i,2),!0)},ps.sortedLastIndexOf=function(t,e){if(null!=t&&t.length){var i=Fn(t,e,!0)-1;if(pr(t[i],e))return i}return-1},ps.startCase=bl,ps.startsWith=function(t,e,i){return t=Yr(t),i=null==i?0:js(Nr(i),0,t.length),e=Dn(e),t.slice(i,i+e.length)==e},ps.subtract=Kl,ps.sum=function(t){return t&&t.length?vi(t,Ml):0},ps.sumBy=function(t,e){return t&&t.length?vi(t,Pa(e,2)):0},ps.template=function(t,e,i){var s=ps.templateSettings;i&&Ja(t,e,i)&&(e=a),t=Yr(t),e=Xr({},e,s,$a);var n,o,r=Xr({},e.imports,s.imports,$a),l=nl(r),c=mi(r,l),u=0,h=e.interpolate||qt,d="__p += '",p=ie((e.escape||qt).source+"|"+h.source+"|"+(h===Ot?Bt:qt).source+"|"+(e.evaluate||qt).source+"|$","g"),v="//# sourceURL="+("sourceURL"in e?e.sourceURL:"lodash.templateSources["+ ++xe+"]")+"\n";t.replace(p,function(e,i,s,a,r,l){return s||(s=a),d+=t.slice(u,l).replace(Kt,wi),i&&(n=!0,d+="' +\n__e("+i+") +\n'"),r&&(o=!0,d+="';\n"+r+";\n__p += '"),s&&(d+="' +\n((__t = ("+s+")) == null ? '' : __t) +\n'"),u=l+e.length,e}),d+="';\n";var g=e.variable;g||(d="with (obj) {\n"+d+"\n}\n"),d=(o?d.replace(yt,""):d).replace(Rt,"$1").replace(bt,"$1;"),d="function("+(g||"obj")+") {\n"+(g?"":"obj || (obj = {});\n")+"var __t, __p = ''"+(n?", __e = _.escape":"")+(o?", __j = Array.prototype.join;\nfunction print() { __p += __j.call(arguments, '') }\n":";\n")+d+"return __p\n}";var f=xl(function(){return Qt(l,v+"return "+d).apply(a,c)});if(f.source=d,wr(f))throw f;return f},ps.times=function(t,e){if((t=Nr(t))<1||t>j)return[];var i=D,s=Vi(t,D);e=Pa(e),t-=D;for(var n=gi(s,e);++i<t;)e(i);return n},ps.toFinite=zr,ps.toInteger=Nr,ps.toLength=Br,ps.toLower=function(t){return Yr(t).toLowerCase()},ps.toNumber=Gr,ps.toSafeInteger=function(t){return t?js(Nr(t),-j,j):0===t?t:0},ps.toString=Yr,ps.toUpper=function(t){return Yr(t).toUpperCase()},ps.trim=function(t,e,i){if((t=Yr(t))&&(i||e===a))return t.replace(jt,"");if(!t||!(e=Dn(e)))return t;var s=Ti(t),n=Ti(e);return Wn(s,yi(s,n),Ri(s,n)+1).join("")},ps.trimEnd=function(t,e,i){if((t=Yr(t))&&(i||e===a))return t.replace(Pt,"");if(!t||!(e=Dn(e)))return t;var s=Ti(t);return Wn(s,0,Ri(s,Ti(e))+1).join("")},ps.trimStart=function(t,e,i){if((t=Yr(t))&&(i||e===a))return t.replace(Et,"");if(!t||!(e=Dn(e)))return t;var s=Ti(t);return Wn(s,yi(s,Ti(e))).join("")},ps.truncate=function(t,e){var i=I,s=O;if(Ir(e)){var n="separator"in e?e.separator:n;i="length"in e?Nr(e.length):i,s="omission"in e?Dn(e.omission):s}var o=(t=Yr(t)).length;if(ki(t)){var r=Ti(t);o=r.length}if(i>=o)return t;var l=i-Si(s);if(l<1)return s;var c=r?Wn(r,0,l).join(""):t.slice(0,l);if(n===a)return c+s;if(r&&(l+=c.length-l),Tr(n)){if(t.slice(l).search(n)){var u,h=c;for(n.global||(n=ie(n.source,Yr(Gt.exec(n))+"g")),n.lastIndex=0;u=n.exec(h);)var d=u.index;c=c.slice(0,d===a?l:d)}}else if(t.indexOf(Dn(n),l)!=l){var p=c.lastIndexOf(n);p>-1&&(c=c.slice(0,p))}return c+s},ps.unescape=function(t){return(t=Yr(t))&&kt.test(t)?t.replace(Ct,Fi):t},ps.uniqueId=function(t){var e=++he;return Yr(t)+e},ps.upperCase=Cl,ps.upperFirst=wl,ps.each=Yo,ps.eachRight=Vo,ps.first=yo,jl(ps,(Xl={},Js(ps,function(t,e){ue.call(ps.prototype,e)||(Xl[e]=t)}),Xl),{chain:!1}),ps.VERSION="4.17.5",Je(["bind","bindKey","curry","curryRight","partial","partialRight"],function(t){ps[t].placeholder=ps}),Je(["drop","take"],function(t,e){ms.prototype[t]=function(i){i=i===a?1:Yi(Nr(i),0);var s=this.__filtered__&&!e?new ms(this):this.clone();return s.__filtered__?s.__takeCount__=Vi(i,s.__takeCount__):s.__views__.push({size:Vi(i,D),type:t+(s.__dir__<0?"Right":"")}),s},ms.prototype[t+"Right"]=function(e){return this.reverse()[t](e).reverse()}}),Je(["filter","map","takeWhile"],function(t,e){var i=e+1,s=i==S||3==i;ms.prototype[t]=function(t){var e=this.clone();return e.__iteratees__.push({iteratee:Pa(t,3),type:i}),e.__filtered__=e.__filtered__||s,e}}),Je(["head","last"],function(t,e){var i="take"+(e?"Right":"");ms.prototype[t]=function(){return this[i](1).value()[0]}}),Je(["initial","tail"],function(t,e){var i="drop"+(e?"":"Right");ms.prototype[t]=function(){return this.__filtered__?new ms(this):this[i](1)}}),ms.prototype.compact=function(){return this.filter(Ml)},ms.prototype.find=function(t){return this.filter(t).head()},ms.prototype.findLast=function(t){return this.reverse().find(t)},ms.prototype.invokeMap=kn(function(t,e){return"function"==typeof t?new ms(this):this.map(function(i){return nn(i,t,e)})}),ms.prototype.reject=function(t){return this.filter(lr(Pa(t)))},ms.prototype.slice=function(t,e){t=Nr(t);var i=this;return i.__filtered__&&(t>0||e<0)?new ms(i):(t<0?i=i.takeRight(-t):t&&(i=i.drop(t)),e!==a&&(i=(e=Nr(e))<0?i.dropRight(-e):i.take(e-t)),i)},ms.prototype.takeRightWhile=function(t){return this.reverse().takeWhile(t).reverse()},ms.prototype.toArray=function(){return this.take(D)},Js(ms.prototype,function(t,e){var i=/^(?:filter|find|map|reject)|While$/.test(e),s=/^(?:head|last)$/.test(e),n=ps[s?"take"+("last"==e?"Right":""):e],o=s||/^find/.test(e);n&&(ps.prototype[e]=function(){var e=this.__wrapped__,r=s?[1]:arguments,l=e instanceof ms,c=r[0],u=l||mr(e),h=function(t){var e=n.apply(ps,ti([t],r));return s&&d?e[0]:e};u&&i&&"function"==typeof c&&1!=c.length&&(l=u=!1);var d=this.__chain__,p=!!this.__actions__.length,v=o&&!d,g=l&&!p;if(!o&&u){e=g?e:new ms(this);var f=t.apply(e,r);return f.__actions__.push({func:zo,args:[h],thisArg:a}),new fs(f,d)}return v&&g?t.apply(this,r):(f=this.thru(h),v?s?f.value()[0]:f.value():f)})}),Je(["pop","push","shift","sort","splice","unshift"],function(t){var e=ae[t],i=/^(?:push|sort|unshift)$/.test(t)?"tap":"thru",s=/^(?:pop|shift)$/.test(t);ps.prototype[t]=function(){var t=arguments;if(s&&!this.__chain__){var n=this.value();return e.apply(mr(n)?n:[],t)}return this[i](function(i){return e.apply(mr(i)?i:[],t)})}}),Js(ms.prototype,function(t,e){var i=ps[e];if(i){var s=i.name+"";(ns[s]||(ns[s]=[])).push({name:e,func:i})}}),ns[va(a,_).name]=[{name:"wrapper",func:a}],ms.prototype.clone=function(){var t=new ms(this.__wrapped__);return t.__actions__=sa(this.__actions__),t.__dir__=this.__dir__,t.__filtered__=this.__filtered__,t.__iteratees__=sa(this.__iteratees__),t.__takeCount__=this.__takeCount__,t.__views__=sa(this.__views__),t},ms.prototype.reverse=function(){if(this.__filtered__){var t=new ms(this);t.__dir__=-1,t.__filtered__=!0}else(t=this.clone()).__dir__*=-1;return t},ms.prototype.value=function(){var t=this.__wrapped__.value(),e=this.__dir__,i=mr(t),s=e<0,n=i?t.length:0,a=function(t,e,i){for(var s=-1,n=i.length;++s<n;){var a=i[s],o=a.size;switch(a.type){case"drop":t+=o;break;case"dropRight":e-=o;break;case"take":e=Vi(e,t+o);break;case"takeRight":t=Yi(t,e-o)}}return{start:t,end:e}}(0,n,this.__views__),o=a.start,r=a.end,l=r-o,c=s?r:o-1,u=this.__iteratees__,h=u.length,d=0,p=Vi(l,this.__takeCount__);if(!i||!s&&n==l&&p==l)return Bn(t,this.__actions__);var v=[];t:for(;l--&&d<p;){for(var g=-1,f=t[c+=e];++g<h;){var m=u[g],_=m.iteratee,y=m.type,R=_(f);if(y==T)f=R;else if(!R){if(y==S)continue t;break t}}v[d++]=f}return v},ps.prototype.at=No,ps.prototype.chain=function(){return Ho(this)},ps.prototype.commit=function(){return new fs(this.value(),this.__chain__)},ps.prototype.next=function(){this.__values__===a&&(this.__values__=Hr(this.value()));var t=this.__index__>=this.__values__.length;return{done:t,value:t?a:this.__values__[this.__index__++]}},ps.prototype.plant=function(t){for(var e,i=this;i instanceof gs;){var s=ho(i);s.__index__=0,s.__values__=a,e?n.__wrapped__=s:e=s;var n=s;i=i.__wrapped__}return n.__wrapped__=t,e},ps.prototype.reverse=function(){var t=this.__wrapped__;if(t instanceof ms){var e=t;return this.__actions__.length&&(e=new ms(this)),(e=e.reverse()).__actions__.push({func:zo,args:[Io],thisArg:a}),new fs(e,this.__chain__)}return this.thru(Io)},ps.prototype.toJSON=ps.prototype.valueOf=ps.prototype.value=function(){return Bn(this.__wrapped__,this.__actions__)},ps.prototype.first=ps.prototype.head,Le&&(ps.prototype[Le]=function(){return this}),ps}();Fe._=ji,(n=function(){return ji}.call(e,i,e,s))===a||(s.exports=n)}).call(this)}).call(e,i("DuR2"),i("3IRH")(t))},MLJp:function(t,e){},Mk6O:function(t,e,i){var s,n;n=function(t){var e=["N","E","A","D"];function i(t,e){t.super_=e,t.prototype=Object.create(e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}})}function s(t,e){Object.defineProperty(this,"kind",{value:t,enumerable:!0}),e&&e.length&&Object.defineProperty(this,"path",{value:e,enumerable:!0})}function n(t,e,i){n.super_.call(this,"E",t),Object.defineProperty(this,"lhs",{value:e,enumerable:!0}),Object.defineProperty(this,"rhs",{value:i,enumerable:!0})}function a(t,e){a.super_.call(this,"N",t),Object.defineProperty(this,"rhs",{value:e,enumerable:!0})}function o(t,e){o.super_.call(this,"D",t),Object.defineProperty(this,"lhs",{value:e,enumerable:!0})}function r(t,e,i){r.super_.call(this,"A",t),Object.defineProperty(this,"index",{value:e,enumerable:!0}),Object.defineProperty(this,"item",{value:i,enumerable:!0})}function l(t,e,i){var s=t.slice((i||e)+1||t.length);return t.length=e<0?t.length+e:e,t.push.apply(t,s),t}function c(t){var e=typeof t;return"object"!==e?e:t===Math?"math":null===t?"null":Array.isArray(t)?"array":"[object Date]"===Object.prototype.toString.call(t)?"date":"function"==typeof t.toString&&/^\/.*\//.test(t.toString())?"regexp":"object"}function u(t){var e=0;if(0===t.length)return e;for(var i=0;i<t.length;i++){var s=t.charCodeAt(i);e=(e<<5)-e+s,e&=e}return e}function h(t){var e=0,i=c(t);if("array"===i){t.forEach(function(t){e+=h(t)});var s="[type: array, hash: "+e+"]";return e+u(s)}if("object"===i){for(var n in t)if(t.hasOwnProperty(n)){var a="[ type: object, key: "+n+", value hash: "+h(t[n])+"]";e+=u(a)}return e}var o="[ type: "+i+" ; value: "+t+"]";return e+u(o)}function d(t,e,i,s,l,u,p,v){i=i||[],l=l||[],p=p||[];var g=l.slice(0);if(void 0!==u&&null!==u){if(s){if("function"==typeof s&&s(g,u))return;if("object"==typeof s){if(s.prefilter&&s.prefilter(g,u))return;if(s.normalize){var f=s.normalize(g,u,t,e);f&&(t=f[0],e=f[1])}}}g.push(u)}"regexp"===c(t)&&"regexp"===c(e)&&(t=t.toString(),e=e.toString());var m,_,y,R,b=typeof t,C=typeof e,w="undefined"!==b||p&&p.length>0&&p[p.length-1].lhs&&Object.getOwnPropertyDescriptor(p[p.length-1].lhs,u),k="undefined"!==C||p&&p.length>0&&p[p.length-1].rhs&&Object.getOwnPropertyDescriptor(p[p.length-1].rhs,u);if(!w&&k)i.push(new a(g,e));else if(!k&&w)i.push(new o(g,t));else if(c(t)!==c(e))i.push(new n(g,t,e));else if("date"===c(t)&&t-e!=0)i.push(new n(g,t,e));else if("object"===b&&null!==t&&null!==e){for(m=p.length-1;m>-1;--m)if(p[m].lhs===t){R=!0;break}if(R)t!==e&&i.push(new n(g,t,e));else{if(p.push({lhs:t,rhs:e}),Array.isArray(t)){for(v&&(t.sort(function(t,e){return h(t)-h(e)}),e.sort(function(t,e){return h(t)-h(e)})),m=e.length-1,_=t.length-1;m>_;)i.push(new r(g,m,new a(void 0,e[m--])));for(;_>m;)i.push(new r(g,_,new o(void 0,t[_--])));for(;m>=0;--m)d(t[m],e[m],i,s,g,m,p,v)}else{var x=Object.keys(t),$=Object.keys(e);for(m=0;m<x.length;++m)y=x[m],(R=$.indexOf(y))>=0?(d(t[y],e[y],i,s,g,y,p,v),$[R]=null):d(t[y],void 0,i,s,g,y,p,v);for(m=0;m<$.length;++m)(y=$[m])&&d(void 0,e[y],i,s,g,y,p,v)}p.length=p.length-1}}else t!==e&&("number"===b&&isNaN(t)&&isNaN(e)||i.push(new n(g,t,e)))}function p(t,e,i,s,n){var a=[];if(d(t,e,a,s,null,null,null,n),i)for(var o=0;o<a.length;++o)i(a[o]);return a}function v(t,e,i,s){var n=s?function(t){t&&s.push(t)}:void 0,a=p(t,e,n,i);return s||(a.length?a:void 0)}function g(t,i,s){if(void 0===s&&i&&~e.indexOf(i.kind)&&(s=i),t&&s&&s.kind){for(var n=t,a=-1,o=s.path?s.path.length-1:0;++a<o;)void 0===n[s.path[a]]&&(n[s.path[a]]=void 0!==s.path[a+1]&&"number"==typeof s.path[a+1]?[]:{}),n=n[s.path[a]];switch(s.kind){case"A":s.path&&void 0===n[s.path[a]]&&(n[s.path[a]]=[]),function t(e,i,s){if(s.path&&s.path.length){var n,a=e[i],o=s.path.length-1;for(n=0;n<o;n++)a=a[s.path[n]];switch(s.kind){case"A":t(a[s.path[n]],s.index,s.item);break;case"D":delete a[s.path[n]];break;case"E":case"N":a[s.path[n]]=s.rhs}}else switch(s.kind){case"A":t(e[i],s.index,s.item);break;case"D":e=l(e,i);break;case"E":case"N":e[i]=s.rhs}return e}(s.path?n[s.path[a]]:n,s.index,s.item);break;case"D":delete n[s.path[a]];break;case"E":case"N":n[s.path[a]]=s.rhs}}}i(n,s),i(a,s),i(o,s),i(r,s),Object.defineProperties(v,{diff:{value:v,enumerable:!0},orderIndependentDiff:{value:function(t,e,i,s){var n=s?function(t){t&&s.push(t)}:void 0,a=p(t,e,n,i,!0);return s||(a.length?a:void 0)},enumerable:!0},observableDiff:{value:p,enumerable:!0},orderIndependentObservableDiff:{value:function(t,e,i,s,n,a,o){return d(t,e,i,s,n,a,o,!0)},enumerable:!0},orderIndepHash:{value:h,enumerable:!0},applyDiff:{value:function(t,e,i){t&&e&&p(t,e,function(s){i&&!i(t,e,s)||g(t,e,s)})},enumerable:!0},applyChange:{value:g,enumerable:!0},revertChange:{value:function(t,e,i){if(t&&e&&i&&i.kind){var s,n,a=t;for(n=i.path.length-1,s=0;s<n;s++)void 0===a[i.path[s]]&&(a[i.path[s]]={}),a=a[i.path[s]];switch(i.kind){case"A":!function t(e,i,s){if(s.path&&s.path.length){var n,a=e[i],o=s.path.length-1;for(n=0;n<o;n++)a=a[s.path[n]];switch(s.kind){case"A":t(a[s.path[n]],s.index,s.item);break;case"D":case"E":a[s.path[n]]=s.lhs;break;case"N":delete a[s.path[n]]}}else switch(s.kind){case"A":t(e[i],s.index,s.item);break;case"D":case"E":e[i]=s.lhs;break;case"N":e=l(e,i)}return e}(a[i.path[s]],i.index,i.item);break;case"D":case"E":a[i.path[s]]=i.lhs;break;case"N":delete a[i.path[s]]}}},enumerable:!0},isConflict:{value:function(){return"undefined"!=typeof $conflict},enumerable:!0}}),v.DeepDiff=v,t&&(t.DeepDiff=v);return v}(this),void 0===(s=function(){return n}.call(e,i,e,t))||(t.exports=s)},Mliy:function(t,e){},NN4q:function(t,e){},NmLI:function(t,e,i){t.exports=i.p+"static/img/打点.4615a77.svg"},NuEF:function(t,e){},NxgC:function(t,e){},OBJk:function(t,e){},OFy7:function(t,e){},OMJi:function(t,e,i){(function(t,s){var n=/%[sdj%]/g;e.format=function(t){if(!m(t)){for(var e=[],i=0;i<arguments.length;i++)e.push(r(arguments[i]));return e.join(" ")}i=1;for(var s=arguments,a=s.length,o=String(t).replace(n,function(t){if("%%"===t)return"%";if(i>=a)return t;switch(t){case"%s":return String(s[i++]);case"%d":return Number(s[i++]);case"%j":try{return JSON.stringify(s[i++])}catch(t){return"[Circular]"}default:return t}}),l=s[i];i<a;l=s[++i])g(l)||!R(l)?o+=" "+l:o+=" "+r(l);return o},e.deprecate=function(i,n){if(_(t.process))return function(){return e.deprecate(i,n).apply(this,arguments)};if(!0===s.noDeprecation)return i;var a=!1;return function(){if(!a){if(s.throwDeprecation)throw new Error(n);s.traceDeprecation?console.trace(n):console.error(n),a=!0}return i.apply(this,arguments)}};var a,o={};function r(t,i){var s={seen:[],stylize:c};return arguments.length>=3&&(s.depth=arguments[2]),arguments.length>=4&&(s.colors=arguments[3]),v(i)?s.showHidden=i:i&&e._extend(s,i),_(s.showHidden)&&(s.showHidden=!1),_(s.depth)&&(s.depth=2),_(s.colors)&&(s.colors=!1),_(s.customInspect)&&(s.customInspect=!0),s.colors&&(s.stylize=l),u(s,t,s.depth)}function l(t,e){var i=r.styles[e];return i?"["+r.colors[i][0]+"m"+t+"["+r.colors[i][1]+"m":t}function c(t,e){return t}function u(t,i,s){if(t.customInspect&&i&&w(i.inspect)&&i.inspect!==e.inspect&&(!i.constructor||i.constructor.prototype!==i)){var n=i.inspect(s,t);return m(n)||(n=u(t,n,s)),n}var a=function(t,e){if(_(e))return t.stylize("undefined","undefined");if(m(e)){var i="'"+JSON.stringify(e).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return t.stylize(i,"string")}if(f(e))return t.stylize(""+e,"number");if(v(e))return t.stylize(""+e,"boolean");if(g(e))return t.stylize("null","null")}(t,i);if(a)return a;var o=Object.keys(i),r=function(t){var e={};return t.forEach(function(t,i){e[t]=!0}),e}(o);if(t.showHidden&&(o=Object.getOwnPropertyNames(i)),C(i)&&(o.indexOf("message")>=0||o.indexOf("description")>=0))return h(i);if(0===o.length){if(w(i)){var l=i.name?": "+i.name:"";return t.stylize("[Function"+l+"]","special")}if(y(i))return t.stylize(RegExp.prototype.toString.call(i),"regexp");if(b(i))return t.stylize(Date.prototype.toString.call(i),"date");if(C(i))return h(i)}var c,R="",k=!1,x=["{","}"];(p(i)&&(k=!0,x=["[","]"]),w(i))&&(R=" [Function"+(i.name?": "+i.name:"")+"]");return y(i)&&(R=" "+RegExp.prototype.toString.call(i)),b(i)&&(R=" "+Date.prototype.toUTCString.call(i)),C(i)&&(R=" "+h(i)),0!==o.length||k&&0!=i.length?s<0?y(i)?t.stylize(RegExp.prototype.toString.call(i),"regexp"):t.stylize("[Object]","special"):(t.seen.push(i),c=k?function(t,e,i,s,n){for(var a=[],o=0,r=e.length;o<r;++o)I(e,String(o))?a.push(d(t,e,i,s,String(o),!0)):a.push("");return n.forEach(function(n){n.match(/^\d+$/)||a.push(d(t,e,i,s,n,!0))}),a}(t,i,s,r,o):o.map(function(e){return d(t,i,s,r,e,k)}),t.seen.pop(),function(t,e,i){if(t.reduce(function(t,e){return 0,e.indexOf("\n")>=0&&0,t+e.replace(/\u001b\[\d\d?m/g,"").length+1},0)>60)return i[0]+(""===e?"":e+"\n ")+" "+t.join(",\n  ")+" "+i[1];return i[0]+e+" "+t.join(", ")+" "+i[1]}(c,R,x)):x[0]+R+x[1]}function h(t){return"["+Error.prototype.toString.call(t)+"]"}function d(t,e,i,s,n,a){var o,r,l;if((l=Object.getOwnPropertyDescriptor(e,n)||{value:e[n]}).get?r=l.set?t.stylize("[Getter/Setter]","special"):t.stylize("[Getter]","special"):l.set&&(r=t.stylize("[Setter]","special")),I(s,n)||(o="["+n+"]"),r||(t.seen.indexOf(l.value)<0?(r=g(i)?u(t,l.value,null):u(t,l.value,i-1)).indexOf("\n")>-1&&(r=a?r.split("\n").map(function(t){return"  "+t}).join("\n").substr(2):"\n"+r.split("\n").map(function(t){return"   "+t}).join("\n")):r=t.stylize("[Circular]","special")),_(o)){if(a&&n.match(/^\d+$/))return r;(o=JSON.stringify(""+n)).match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(o=o.substr(1,o.length-2),o=t.stylize(o,"name")):(o=o.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),o=t.stylize(o,"string"))}return o+": "+r}function p(t){return Array.isArray(t)}function v(t){return"boolean"==typeof t}function g(t){return null===t}function f(t){return"number"==typeof t}function m(t){return"string"==typeof t}function _(t){return void 0===t}function y(t){return R(t)&&"[object RegExp]"===k(t)}function R(t){return"object"==typeof t&&null!==t}function b(t){return R(t)&&"[object Date]"===k(t)}function C(t){return R(t)&&("[object Error]"===k(t)||t instanceof Error)}function w(t){return"function"==typeof t}function k(t){return Object.prototype.toString.call(t)}function x(t){return t<10?"0"+t.toString(10):t.toString(10)}e.debuglog=function(t){if(_(a)&&(a=Object({NODE_ENV:"production"}).NODE_DEBUG||""),t=t.toUpperCase(),!o[t])if(new RegExp("\\b"+t+"\\b","i").test(a)){var i=s.pid;o[t]=function(){var s=e.format.apply(e,arguments);console.error("%s %d: %s",t,i,s)}}else o[t]=function(){};return o[t]},e.inspect=r,r.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},r.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"},e.isArray=p,e.isBoolean=v,e.isNull=g,e.isNullOrUndefined=function(t){return null==t},e.isNumber=f,e.isString=m,e.isSymbol=function(t){return"symbol"==typeof t},e.isUndefined=_,e.isRegExp=y,e.isObject=R,e.isDate=b,e.isError=C,e.isFunction=w,e.isPrimitive=function(t){return null===t||"boolean"==typeof t||"number"==typeof t||"string"==typeof t||"symbol"==typeof t||void 0===t},e.isBuffer=i("fC4T");var $=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function I(t,e){return Object.prototype.hasOwnProperty.call(t,e)}e.log=function(){var t,i;console.log("%s - %s",(t=new Date,i=[x(t.getHours()),x(t.getMinutes()),x(t.getSeconds())].join(":"),[t.getDate(),$[t.getMonth()],i].join(" ")),e.format.apply(e,arguments))},e.inherits=i("LC74"),e._extend=function(t,e){if(!e||!R(e))return t;for(var i=Object.keys(e),s=i.length;s--;)t[i[s]]=e[i[s]];return t}}).call(e,i("DuR2"),i("W2nU"))},ObRd:function(t,e){},OhiO:function(t,e){},Okq1:function(t,e){},Oswd:function(t,e){},PQ4l:function(t,e){},PkV4:function(t,e){},"Q+67":function(t,e){},Q0DQ:function(t,e){},Qar8:function(t,e,i){t.exports=i.p+"static/img/多边形.838184f.svg"},RrJT:function(t,e){},RybU:function(t,e){},Rz6f:function(t,e){},SUmV:function(t,e){},"SW+N":function(t,e){},SfvY:function(t,e,i){"use strict";var s,n=i("I9+T"),a=i("k5KV"),o=i.n(a),r=i("jyVo"),l={props:["slice","record","roilist","curRois","centerRegion","penColor","position","content","companyid","showMppGuide","cellArea","showLayer","moveStatus","radius","filled","currentAngle","hiddenPen","hiddenPickTool"],data(){return{mpp:this.slice.mppx||.242042,scale:1,fullPage:!1,osd:null,company:this.$props.companyid||Object(r.s)().company,viewport:null,paper:null,selectedTool:"choose",dataMapPath:{},offsetWidth:0,offsetHeight:0,showRoi:!0,saved:!1,showLabel:!0,knew:!1,drawMpp:!1,userMpp:null,deg:0,layers:[null,null,null,null,null,null],showPenTool:!1,pentool:"freepen",scope:null,pointAble:["ki67","er","pr","pdl1","tagging","fish","ki67hot","her2","np","cd30"].includes(this.slice.toolType),reverseAble:!1,showRadius:!1,newRadius:this.radius,segmentsList:[],areaTimeLoop:null,continueRoi:null}},methods:{adjustSegment(){Object.keys(this.curRois).length?this.selectedTool="pickTool":this.$message.warning("请先选择一个调整对象")},toNumber(){this.newRadius=this.newRadius.replace(/[^\.\d]/g,"")},checkTool(t){this.showPenTool=!1,this.pentool=t,this.selectedTool=t},chooseTool(){this.pentool==this.selectedTool&&(this.showPenTool=!this.showPenTool),this.selectedTool=this.pentool},rotate(){this.deg+=90,this.$refs.rotate.style.transform=`rotate(${this.deg}deg)`},drawCell(){this.$emit("closeMppGuide",!0),this.drawMpp=!0,this.selectedTool="rectangle"},convertPoint(t,e){return this.paper.view.viewToProject(new this.paper.Point(t,e))},initOSD(){let t=OpenSeadragon({element:this.$refs.osd,tileSources:{height:this.slice.height,width:this.slice.width,tileSize:this.slice.tileSize||1024,getTileUrl:(t,e,i)=>`/aipath/api/files/slice?x=${e}&y=${i}&z=${t}&caseid=${this.record.id}&fileid=${this.slice.id}&companyid=${this.company}&filename=${encodeURIComponent(this.slice.filename||this.slice.name)}`},minZoomLevel:.001,maxZoomLevel:1e4,visibilityRatio:.01,toolbar:this.$refs.hideToolbar,mouseNavEnabled:!1,animationTime:.8,maxImageCacheCount:12,immediately:!0,showNavigator:!0,navigatorPosition:"TOP_LEFT",navigatorAutoFade:!1});this.osd=t,this.viewport=t.viewport,this.$emit("viewer",this.viewport),t.activateImagingHelper(),t.addHandler("open",()=>{this.paper=new paper.PaperScope,this.paper.activate(),this.paper.setup(this.$refs.canvas);let e=this.slice.mppx?2:5;this.paper.settings.handleSize=8,this.paper.settings.hitTolerance=e,this.layers[0]=new this.paper.Layer,this.layers[1]=new this.paper.Layer,this.layers[2]=new this.paper.Layer,this.layers[3]=new this.paper.Layer,this.layers[4]=new this.paper.Layer,this.layers[5]=new this.paper.Layer,this.roilistChange(this.roilist||[],[]),this.resized(),this.position.zoom?this.update(this.position,!0):this.buttonClick("home");let i=null;t.addHandler("update-viewport",()=>{let t=this.slice.width,{x:e,y:s}=this.viewport.getBounds(!0).getCenter();this.paper.view.rotation=this.currentAngle||0,this.paper.view.setCenter(e*t,s*t);let n=this.viewport.getZoom(!0);this.paper.view.zoom=this.viewport.viewportToImageZoom(n),clearTimeout(i),i=setTimeout(()=>{this.getRoi()},400)}),t.addHandler("animation-start",()=>{"pdl1"!=this.slice.toolType&&"np"!=this.slice.toolType||this.$emit("changeMoveStatus","moveStart")}),t.addHandler("animation-finish",()=>{let t=this.slice.width/this.slice.height,e=this.paper.view.getCenter().x/this.slice.width,i=this.paper.view.getCenter().y/this.slice.height/t;this.position.offx.toFixed(10)===e.toFixed(10)&&this.position.offy.toFixed(10)===i.toFixed(10)||this.move(e,i)})}),this.$refs.osd.addEventListener("contextmenu",this.contextmenu),window.addEventListener("resize",this.resize)},getRoi(){if(!this.paper.view)return;let t=parseInt(this.convertPoint(0,0).x),e=parseInt(this.convertPoint(0,0).y);if(this.$refs.osd){let t=this.$refs.osd.querySelector(".openseadragon-canvas").querySelector("canvas");var i=parseInt(this.convertPoint(t.width,t.height).x),s=parseInt(this.convertPoint(t.width,t.height).y)}let n=this.osd.world.getItemAt(0).lastDrawn,a=Math.max(...n.map(t=>t.level));this.$emit("getRoi",{x1:t,x2:i,y1:e,y2:s,z:a}),"pdl1"!=this.slice.toolType&&"np"!=this.slice.toolType||this.$emit("changeMoveStatus","moveEnd")},move(t,e,i){this.$emit("position","number"==typeof t?t:this.position.offx,"number"==typeof e?e:this.position.offy,"number"==typeof i?i:this.position.zoom)},update(t=this.position,e){this.viewport.zoomTo(t.zoom,"",e),this.viewport.panTo({x:t.offx,y:t.offy},e)},resize(){setTimeout(t=>this.resized(this.position.zoom/this.scale),0)},resized(t){this.offsetWidth=this.$refs.osd.offsetWidth,this.offsetHeight=this.$refs.osd.offsetHeight,this.paper.view.viewSize=[this.offsetWidth,this.offsetHeight],this.scale=this.mpp*this.slice.width*Math.min(this.offsetHeight/this.offsetWidth,1)/22e3,this.move(null,null,t?t*this.scale:null),t&&t*this.scale!=this.position.zoom||setTimeout(this.update,80)},navstart(t){if(t.button)return;let e=this.$refs.navigator;var i=t=>{t=c(t),this.move(t.offsetX/e.clientWidth,t.offsetY/e.clientHeight*this.slice.height/this.slice.width)},s=()=>{e.removeEventListener("mousemove",i),e.removeEventListener("touchmove",i),window.removeEventListener("mouseup",s)};e.addEventListener("mousemove",i),e.addEventListener("touchmove",i),window.addEventListener("mouseup",s),i(t)},handleFullScreen(){this.fullPage=!this.fullPage,this.$parent.$parent.fullPage=this.fullPage,this.resize()},buttonClick(t){switch(t){case"zoom-in":this.move(null,null,2*this.position.zoom);break;case"zoom-out":this.move(null,null,this.position.zoom/2);break;case"home":let e=this.slice.width/this.slice.height;this.move(.5,.5/e,Math.min(this.offsetHeight/this.offsetWidth*e,1));break;case"original":this.move(null,null,this.slice.width/this.offsetWidth);break;default:this.move(null,null,t)}},path2data:t=>({x:t.map(t=>t.point.x),y:t.map(t=>t.point.y)}),equal(t,e){if(t.length!==e.length)return!1;for(let i=0;i<t.length;i++)if(t[i].image!==e[i].image)return!1;return!0},roilistChange(t,e){let i={},s={};t.map(t=>{i[t.id]=t}),e.map(t=>{s[t.id]=t});let n=e.filter(t=>!o.a.equals(t,i[t.id])),a=t.filter(t=>!o.a.equals(t,s[t.id]));for(let t of n)this.dataMapPath[t.id]&&!this.curRois[t.id]&&(this.dataMapPath[t.id].text&&(this.dataMapPath[t.id].text.remove(),this.dataMapPath[t.id].rectangle.remove()),this.dataMapPath[t.id].path.remove(),delete this.dataMapPath[t.id]);let r=a.length,l=0,c=200;var u=this;r>0&&function t(){let e=l+c>a.length?a.length:l+c;if(!(l>r)){for(var i=l;i<e;i++)u.newRoi(a[i]);l+=c,t()}}(),this.setLayer(),this.roilist.forEach(t=>{this.showRoi?this.dataMapPath[t.id].path.selected=!!this.curRois[t.id]:this.dataMapPath[t.id].path.selected=!1,this.curRois[t.id]&&(clearTimeout(this.areaTimeLoop),this.drawArea(t))})},setLayer(){let t=Object.values(this.dataMapPath);var e={};let i=[...new Set(t.map(t=>t.data.mark_type))].map(t=>(e[t]=[],t));t.map(t=>{i.filter(e=>e==t.data.mark_type).length&&e[t.data.mark_type].push(t.path)}),Object.keys(e).length&&(this.layers[0].children=null,this.layers[1].children=e[3],this.layers[2].children=e[1],this.layers[3].children=e[2],this.layers[4].children=e[4],this.layers[5].children=e[5])},spliceArray(t){for(var e=void 0,i=0;i<t.x.length-1;i++){var s=t.x[i+1]-t.x[i],n=(t.y[i+1]-t.y[i])/s;(isNaN(e)&&isNaN(n)||n==e)&&(t.x.splice(i,1),t.y.splice(i,1),i--),e=n}return t},newRoi(t={editable:1,path:{x:[],y:[]}}){t=o.a.clone(t);let e,i={};if(this.paper.activate(),t.path.x.length>4&&(t.path=this.spliceArray(t.path)),e="spot"==t.method?new this.paper.Path.Circle({center:[4===t.path.x.length?t.path.x[1]:t.path.x[0],t.path.y[0]],radius:t.radius,strokeScaling:!1,fillColor:t.fillColor||"rgba(0,0,0,0.001)",strokeColor:t.strokeColor||null,owner:t,strokeWidth:3}):new this.paper.Path({segments:t.path.x.map((e,i)=>({x:e,y:t.path.y[i]})),strokeWidth:t.width||3,fillColor:t.fillColor||("secectMulty"==t.method?"rgba(255,255,255,0.5)":"rgba(0,0,0,0.001)"),strokeColor:t.strokeColor,strokeScaling:!1,owner:t,closed:!0,dashArray:t.dashed?[10,5]:[0,0]}),Object.assign(i,{path:e,dragCenter:!1,dragVertex:!1,dragEdge:!1,resetDragStatus(){this.dragCenter=this.dragVertex=this.dragEdge=!1}}),"freepen"==t.method||"freepenReverse"==t.method){var s=this;i.drag=function(t){this.dragVertex?(this.segment.point.x+=t.x,this.segment.point.y+=t.y):this.dragCenter&&(this.path.position.x+=t.x,this.path.position.y+=t.y)},i.checkPath=function(t,e){if(this.segment=null,this.resetDragStatus(),"segment"==e.type){this.segment=e.segment;let t=e.item;"pickTool"===s.selectedTool&&t.smooth({type:"catmull-rom",factor:.5,from:this.segment.previous.index,to:this.segment.next.index}),this.dragVertex=!0}else"fill"==e.type&&(this.dragCenter=!0)}}else if("rectangle"==t.method||"rectangleReverse"==t.method||"secectMulty"==t.method){s=this;i.drag=function(t){let e=(t,e)=>Math.abs(t-e)<1e-4;if(this.dragVertex){let i=this.segment.point.x,s=this.segment.point.y,n=i+t.x,a=s+t.y;this.path.segments.map(t=>{t.point.x=e(t.point.x,i)?n:t.point.x,t.point.y=e(t.point.y,s)?a:t.point.y})}else this.dragEdge?(e(this.editPt1.x,this.editPt2.x)&&(this.editPt1.x+=t.x,this.editPt2.x+=t.x),e(this.editPt1.y,this.editPt2.y)&&(this.editPt1.y+=t.y,this.editPt2.y+=t.y)):this.dragCenter&&this.path.segments.map(e=>{e.point.x+=t.x,e.point.y+=t.y})},i.checkPath=function(t,e){if(this.segment=this.editPt1=this.editPt2=null,this.resetDragStatus(),"segment"==e.type)this.segment=e.segment,this.dragVertex=!0;else if("stroke"==e.type){let t=e.location;this.editPt1=t.curve.point1,this.editPt2=t.curve.point2,this.dragEdge=!0}else"fill"==e.type&&(this.dragCenter=!0)}}else"spot"==t.method&&(i.drag=function(t){this.path.position.x+=t.x,this.path.position.y+=t.y,i.text&&(i.text.position.x+=t.x,i.text.position.y+=t.y,i.rectangle.position.x+=t.x,i.rectangle.position.y+=t.y)},i.checkPath=function(t,e){this.segment=null,this.resetDragStatus(),"segment"==e.type?(this.segment=e.segment,this.dragVertex=!0):"fill"==e.type&&(this.dragCenter=!0)});return i.data=t,i.path.visible=this.showRoi,i.path.selected=this.showRoi,this.dataMapPath[t.id]=i,i},drawText(t,e,i){let s=this.viewport.viewportToImageZoom(this.position.zoom);t.text=new this.paper.PointText({point:e,content:i,fillColor:"white",justification:"center",fontSize:14/s});let n={x:t.text.bounds.left-4/s,y:t.text.bounds.top-4/s},a={x:t.text.bounds.right+4/s,y:t.text.bounds.bottom+4/s};t.rectangle=new this.paper.Path.Rectangle(n,a,4/s),t.rectangle.fillColor="rgba(0,0,0,0.5)",this.paper.project.activeLayer.addChild(t.text),this.showRoi||(t.text.visible=!1,t.rectangle.visible=!1)},drawArea(t){this.paper.activate();let e=this.dataMapPath[t.id];e&&e.text&&(e.text.remove(),e.rectangle.remove());let i=this.viewport.viewportToImageZoom(this.position.zoom),s=0,n="";if(t.doctorDiagnosis){let e=t.doctorDiagnosis;Array.isArray(e)?(s=e.length,n=(e=e.map(t=>t.replace(";",">"))).join("\n")):(s=1,n=e.replace(";",">"))}if(t.cell_type){let e=t.cell_type;Array.isArray(e)?(s+=e.length,n+=(e=e.map(t=>t.replace(";",">"))).join("\n")):(s+=1,n+=e.replace(";",">"))}if("spot"==t.method){if(!n)return;let a={x:t.path.x.length>1?t.path.x[1]:t.path.x[0],y:(t.path.y.length>1?t.path.y[1]:t.path.y[0]-t.radius)-16.8*s/i};this.drawText(e,a,n)}else{let a=(t.path.x[0]+t.path.x[1])/2,o=Math.min.apply(null,t.path.y.map(t=>t));"freepen"!=t.method&&"freepenReverse"!=t.method||(o=Math.min.apply(null,t.path.y.map(t=>t)),a=t.path.x[t.path.y.findIndex(e=>e==Math.min.apply(null,t.path.y.map(t=>t)))]);let r="面积:"+Math.round(Math.abs(e.path.area)*Math.pow(this.mpp,2))+"μm²",l={x:a,y:o-(16.8*s+16)/i},c=n?r+"\n"+n:r;this.drawText(e,l,c)}},contextmenu(t){let e=this.convertPoint(t.offsetX,t.offsetY),i=this.paper.project.hitTest(e,{stroke:!0,segments:!0,fill:!0});if(!i)return;let s=i.item.owner.path,n=Math.max.apply(null,s.x.map(t=>t)),a=Math.max.apply(null,s.y.map(t=>t));"freepen"!=i.item.owner.method&&"freepenReverse"!=i.item.owner.method||(n=Math.max.apply(null,s.x.map(t=>t)),a=s.y[s.x.findIndex(t=>t==Math.max.apply(null,s.x.map(t=>t)))]);let o=this.paper.view.projectToView(new this.paper.Point(n,a));i&&(this.$emit("contextmenu",t,i.item.owner,o),this.selectedTool="choose")},keydown(t){let e=t.key;if("INPUT"!=t.target.nodeName)switch(e){case"Enter":if(this.continueRoi){let t=this.continueRoi.data.id;this.drawRoi(this.continueRoi),this.dataMapPath[t].path.remove(),delete this.dataMapPath[t],this.continueRoi=null}break;case"ArrowUp":t.ctrlKey||t.metaKey||this.move(null,this.position.offy-.95*this.viewport.getBounds().height);break;case"ArrowDown":t.ctrlKey||t.metaKey||this.move(null,this.position.offy+.95*this.viewport.getBounds().height);break;case"ArrowLeft":t.ctrlKey||t.metaKey||this.move(this.position.offx-.95*this.viewport.getBounds().width);break;case"ArrowRight":t.ctrlKey||t.metaKey||this.move(this.position.offx+.95*this.viewport.getBounds().width);break;case"Escape":if(this.continueRoi){let t=this.continueRoi.data.id;this.dataMapPath[t].path.remove(),delete this.dataMapPath[t],this.continueRoi=null}else this.fullPage&&this.handleFullScreen();break;case"F":case"f":this.selectedTool="freepen",this.pentool="freepen";break;case"R":case"r":this.selectedTool="rectangle",this.pentool="rectangle";break;case"P":case"p":this.selectedTool="dottingTool",this.pentool="dottingTool";break;case"D":case"d":this.selectedTool="continueTool",this.pentool="continueTool";break;case" ":this.selectedTool="choose";break;case"=":this.buttonClick("zoom-in");break;case"-":this.buttonClick("zoom-out");break;case"1":this.buttonClick("home");break;case"2":this.buttonClick(2*this.scale);break;case"3":this.buttonClick(4*this.scale);break;case"4":this.buttonClick(10*this.scale);break;case"5":this.buttonClick(20*this.scale);break;case"6":this.buttonClick(40*this.scale);break;case"7":this.buttonClick("original");break;case"8":this.handleFullScreen();break;case"Escape":this.fullPage&&this.handleFullScreen();break;case"A":case"a":if(t.ctrlKey||t.metaKey){t.preventDefault();let e=this.convertPoint(0,0),i=this.convertPoint(this.offsetWidth,this.offsetHeight),s=this.roilist.filter(t=>t.path.x.every(t=>t>e.x&&t<i.x)&&t.path.y.every(t=>t>e.y&&t<i.y));s.length&&this.$emit("curROI",s,!1)}}},wheel(t){if("dottingTool"==this.selectedTool)return;let e=t.wheelDeltaY>0?1.2:1/1.2;var i=this.viewport.pointFromPixel(new OpenSeadragon.Point(t.offsetX,t.offsetY)),s=this.position;this.move((s.offx-i.x)/e+i.x,(s.offy-i.y)/e+i.y,s.zoom*e)},getDistance(t,e){var i=Math.abs(e.pageX-t.pageX),s=Math.abs(e.pageY-t.pageY);return Math.sqrt(i*i+s*s)},isInPolygon(t,e){var i,s,n,a,o=0,r=e.length;for(n=e[0],i=1;i<=r;i++)a=e[i%r],t[0]>Math.min(n[0],a[0])&&t[0]<=Math.max(n[0],a[0])&&t[1]<=Math.max(n[1],a[1])&&n[0]!=a[0]&&(s=(t[0]-n[0])*(a[1]-n[1])/(a[0]-n[0])+n[1],(n[1]==a[1]||t[1]<=s)&&o++),n=a;return o%2!=0},mouseDown(t){this.$refs.osd.querySelector(".openseadragon-canvas").focus(),t.preventDefault(),this.$emit("mousedown");let e=c(t);var i,s,n=t=>{var n=c(t,this.$refs.osd);if(new paper.Point(p.x-n.x,p.y-n.y).length>5&&(v=!0),f)if(t.touches&&2==t.touches.length){let e=this.viewport.deltaPointsFromPixels(new paper.Point((d.touches[0].clientX+d.touches[1].clientX-t.touches[0].clientX-t.touches[1].clientX)/2,(d.touches[0].clientY+d.touches[1].clientY-t.touches[0].clientY-t.touches[1].clientY)/2)),i=Math.hypot(d.touches[0].clientX-d.touches[1].clientX,d.touches[0].clientY-d.touches[1].clientY),s=Math.hypot(t.touches[0].clientX-t.touches[1].clientX,t.touches[0].clientY-t.touches[1].clientY);this.move(this.position.offx+e.x,this.position.offy+e.y,this.position.zoom*s/i)}else{let t=this.viewport.deltaPointsFromPixels(new paper.Point(h.x-n.x,h.y-n.y));this.move(this.position.offx+t.x,this.position.offy+t.y)}else{let t=this.convertPoint(n.x-e.x+e.offsetX,n.y-e.y+e.offsetY);switch(this.selectedTool){case"choose":for(let t in this.curRois){var a=this.dataMapPath[t];if(this.curRoi.owner.id==t)if(0!=this.curRois[t].editable)if(a.dragVertex||a.dragEdge||"ki67hot"===this.slice.toolType&&"grey"===this.curRois[t].strokeColor||a.dragCenter&&"spot"===a.data.method){let t=this.convertPoint(0,0),e=this.convertPoint(n.x-h.x,n.y-h.y);e.x-=t.x,e.y-=t.y,a.drag(e)}else f=!0;else f=!0}break;case"pickTool":for(let t in this.curRois){a=this.dataMapPath[t];if(this.curRoi&&this.curRoi.owner.id==t){if(this.curRoi.segments.filter(t=>t.point.selected).length<3)return;if(0!=this.curRois[t].editable){let t=this.convertPoint(0,0),e=this.convertPoint(n.x-h.x,n.y-h.y);e.x-=t.x,e.y-=t.y,a.drag(e)}}}break;case"freepen":case"freepenReverse":case"secectMulty":this.curRoi.path.closed=!1,this.curRoi.path.fullySelected=!1,this.curRoi.path.add(t);break;case"continueTool":{let e=this.continueRoi.path.segments.length,i=this.continueRoi.path.segments[e-1].point,s=Math.sqrt(Math.pow(i.x-t.x,2)+Math.pow(i.y-t.y,2));console.log(s),s>10&&(this.continueRoi.path.closed=!1,this.continueRoi.path.add(t));break}case"rectangle":case"rectangleReverse":{let e=this.curRoi.path.segments[0].point;this.curRoi.path.removeSegments(),this.curRoi.path.addSegments([e,new this.paper.Point(t.x,e.y),t,new this.paper.Point(e.x,t.y)]);break}case"measure":{s&&s.remove(),i&&i.remove(),this.paper.activate(),(s=new this.paper.Path([g,t])).strokeWidth=2,s.strokeScaling=!1,s.strokeColor="#e4141b";let e=new this.paper.Point({x:t.x-g.x,y:t.y-g.y}),n=e.normalize(10/this.paper.view.zoom).rotate(Math.abs(e.angle)>90?90:-90);(i=new this.paper.PointText({point:{x:(t.x+g.x)/2+n.x,y:(g.y+t.y)/2+n.y},content:Math.round(100*e.length*this.mpp)/100+"μm",justification:"center",fontSize:14/this.paper.view.zoom})).rotate(Math.abs(e.angle)>90?180+e.angle:e.angle)}}this.paper.view.draw()}h={x:n.x,y:n.y},d=t},a=!1,l=t=>{if(t.cancelBubble=!0,t.preventDefault(),a=!0,window.removeEventListener("mousemove",n),window.removeEventListener("touchmove",n),window.removeEventListener("mouseup",l),window.removeEventListener("touchend",l),this.$refs.osd.removeEventListener("touchstart",_),t=t.changedTouches?u(t.changedTouches[0],this.$refs.osd):t,v){if(f)return;switch(this.selectedTool){case"freepen":case"rectangle":case"freepenReverse":case"rectangleReverse":this.drawRoi(this.curRoi,t.shiftKey,"removePath");break;case"secectMulty":{let t=this.curRoi.data;t.path=this.path2data(this.curRoi.path.segments);let e=t.path.x.map((e,i)=>[e,t.path.y[i]]),i=this.roilist.filter(t=>t.path.x.some((i,s)=>this.isInPolygon([i,t.path.y[s]],e)));if(this.curRoi.path.remove(),this.curRoi=null,i.length){this.scope={x:t.path.x,y:t.path.y};let e=this.slice.toolType;switch(this.slice.toolType){case"pdl1db":e="human";break;case"fish":e="fishTissue"}Object(r.b)(`slice/selectCount?companyid=${Object(r.s)().company}`,{caseid:this.record.id,fileid:this.slice.id,scope:JSON.stringify(this.scope),template_id:"tagging"==this.slice.toolType?this.slice.templateId:null,ai_type:e}).then(({data:t})=>{this.$message({showClose:!0,message:`已选中${t.select_count}个（可能包含隐藏标注）`,type:"warning",duration:3e3}),this.$emit("curROI",i,!1)}).catch(t=>{this.$alert(t.message,"提示",{confirmTextButtom:"确定"})})}else this.scope=null,this.$emit("curROI",null,!1);this.selectedTool="choose";break}case"choose":{let t=Object.assign({},Object.values(this.curRois)[0]),e=this.path2data(this.dataMapPath[t.id].path.segments),i=("spot"===t.method&&e.x.length>1?e.x[1]:e.x[0])-t.path.x[0],s=e.y[0]-t.path.y[0];this.scope&&(this.scope.offset=[i,s]),Object.values(this.curRois).map(t=>{t.path=this.path2data(this.dataMapPath[t.id].path.segments)}),this.$emit("curROI",Object.values(this.curRois),!1),o.a.equals(t.path,e)||this.$emit("roiChanged","path"),this.curRoi=null;break}case"pickTool":this.curRoi&&(this.dataMapPath[this.curRoi.owner.id].path.flatten(0),this.segmentsList=[],Object.values(this.curRois).map(t=>{t.path=this.path2data(this.dataMapPath[t.id].path.segments)}),this.$emit("curROI",Object.values(this.curRois),!1),this.$emit("roiChanged","path"),this.curRoi=null);break;case"measure":s.remove(),i.remove(),this.selectedTool="choose"}}else{let i=this.convertPoint(t.offsetX,t.offsetY);if("choose"==this.selectedTool){let e=this.getMinRoi(i);if(e){if(!e.item.owner)return;this.scope=null,"grey"==e.item.owner.strokeColor&&"ki67hot"==this.slice.toolType||this.$emit("curROI",e.item.owner,t.shiftKey),(t={offsetX:t.offsetX,offsetY:t.offsetY,type:t.type}).preventDefault||(t.preventDefault=(t=>0)),t.currentTarget=this.$refs.osd,this.$emit("contextmenu",t,e.item.owner)}else this.scope=null,this.$emit("curROI",null,t.shiftKey,0),this.curROI=null}else if("freepen"==this.selectedTool||"rectangle"==this.selectedTool||"freepenReverse"==this.selectedTool||"rectangleReverse"==this.selectedTool||"secectMulty"==this.selectedTool)delete this.dataMapPath[this.curRoi.id],this.curRoi.path.remove(),this.curRoi=null;else if("point"==this.selectedTool)this.$emit("clickDraw",i);else if("dottingTool"==this.selectedTool)if(this.polygonRoi){let i=this.convertPoint(t.x-e.x+e.offsetX,t.y-e.y+e.offsetY),s=this.polygonRoi.path.segments[0].point;if(Math.sqrt(Math.pow(s.x-i.x,2)+Math.pow(s.y-i.y,2))<8)return this.polygonRoi.path.closed=!0,this.polygonRoi.path.selected=!0,void this.drawRoi(this.polygonRoi);this.polygonRoi.path.closed=!1,this.polygonRoi.path.selected=!0,this.polygonRoi.path.add(i)}else this.polygonRoi=this.newRoi({path:{x:[i.x],y:[i.y]},method:"freepen",strokeColor:"yellow"})}if("continueTool"==this.selectedTool){let i=this.convertPoint(t.x-e.x+e.offsetX,t.y-e.y+e.offsetY),s=this.continueRoi.path.segments[0].point,n=Math.sqrt(Math.pow(s.x-i.x,2)+Math.pow(s.y-i.y,2)),a=this.continueRoi.path.segments.length;if(n<8&&a>3){let t=this.continueRoi.data.id;return this.continueRoi.path.closed=!0,this.drawRoi(this.continueRoi),this.dataMapPath[t].path.remove(),delete this.dataMapPath[t],void(this.continueRoi=null)}this.continueRoi.path.add(i),this.continueRoi.path.closed=!1}};if(e.button)return;let h={x:e.x,y:e.y},d=t,p=h,v=!1,g=this.convertPoint(e.offsetX,e.offsetY),f=!1;switch(this.selectedTool){case"choose":{let e=this.getMinRoi(g,"ki67hot"),i=Object.values(this.curRois).map(t=>this.dataMapPath[t.id]);i.some(t=>t.path==(e&&e.item))?(this.curRoi=e.item,i.map(t=>{t.checkPath(null,e)})):t.touches&&("stylus"==t.touches[0].touchType||t.touches[0].force<1)?(this.selectedTool="freepen",this.curRoi=this.newRoi({path:{x:[g.x],y:[g.y]},method:"freepen",strokeColor:this.penColor})):f=!0;break}case"pickTool":{let t=this.paper.project.hitTest(g,{fill:!0,stroke:!0,segments:!0});if(!t||!t.item.owner)return;if(t&&this.curRois[t.item.owner.id]&&"segment"===t.type&&"freepen"===t.item.owner.method&&0!=t.item.owner.editable){let e=t.segment,i=t.item,s=i.segments.filter(t=>t.point.selected).length;if(!this.segmentsList.length&&s<3)e.point.selected=!0,this.segmentsList.push(e);else if(1===this.segmentsList.length&&this.segmentsList[0].index!==e.index){e.point.selected=!0,this.segmentsList.push(e);let t=i.lastSegment.index,s=Math.min(this.segmentsList[0].index,this.segmentsList[1].index),n=Math.max(this.segmentsList[0].index,this.segmentsList[1].index),a=Math.abs(s-n),o=t-a+1,r=new paper.Point((this.segmentsList[0].point.x+this.segmentsList[1].point.x)/2,(this.segmentsList[0].point.y+this.segmentsList[1].point.y)/2);if(o>a){let t=i.segments.slice(s+1,n);for(var m=0;m<t.length;m++)i.removeSegment(t[m].index);i.insert(s+1,r),i.segments[s+1].point.selected=!0}else{let e=i.segments.slice(0,s),a=i.segments.slice(n+1,t+1),o=e.concat(a);for(let t=0;t<o.length;t++)i.removeSegment(o[t].index);i.insert(i.segments.length,r),i.segments[i.segments.length-1].point.selected=!0}this.segmentsList=[];let l=this.paper.project.hitTest(r,{fill:!0,stroke:!0,segments:!0});this.curRoi=l.item,this.dataMapPath[l.item.owner.id].checkPath(null,l)}}break}case"freepen":case"rectangle":case"secectMulty":this.curRoi=this.newRoi({path:{x:[g.x],y:[g.y]},method:this.selectedTool,strokeColor:this.drawMpp?"yellow":"secectMulty"==this.selectedTool?"#E3E9EF":this.penColor});break;case"continueTool":this.continueRoi||(this.continueRoi=this.newRoi({path:{x:[g.x],y:[g.y]},method:"freepen",strokeColor:this.penColor,mark_type:1,id:Math.floor(1e5*Math.random())}),this.curRoi=this.continueRoi);break;case"freepenReverse":case"rectangleReverse":this.curRoi=this.newRoi({path:{x:[g.x],y:[g.y]},method:this.selectedTool,strokeColor:"#E3E9EF",dashed:!0});break;case"point":let e=this.paper.project.hitTest(g,{fill:!0,stroke:!0,segments:!0});this.$emit("parentId",e?e.item.owner.id:null)}window.addEventListener("touchmove",n),window.addEventListener("mousemove",n),window.addEventListener("mouseup",l),window.addEventListener("touchend",l);var _=t=>{a||l(t)};this.$refs.osd.addEventListener("touchstart",_)},getMinRoi(t,e){let i=this.paper.project.hitTestAll(t,{fill:!0,stroke:!0,segments:!0});"ki67hot"!==this.slice.toolType||e||(i=i.filter(t=>"grey"!==t.item.owner.strokeColor));let s=null;if(i.length){let t=i.map(t=>Math.abs(t.item.area)),e=t[0],a=0;for(var n=0;n<t.length;n++)e>t[n]&&(e=t[n],a=n);s=i[a]}return s},dblclick(t){this.$refs.osd.querySelector(".openseadragon-canvas").focus();let e=this.convertPoint(t.offsetX,t.offsetY),i=this.getMinRoi(e,"ki67hot");i&&"grey"===i.item.owner.strokeColor&&"ki67hot"===this.slice.toolType&&this.$emit("curROI",i.item.owner)},drawRoi(t,e,i){let s=t.data;s.path=this.path2data(t.path.segments),delete this.dataMapPath[t.id],this.drawMpp?(this.userMpp=Math.sqrt((this.cellArea||200)/t.path.area).toFixed(4),"NaN"===this.userMpp||"Infinity"===this.userMpp?(this.$alert("您画的roi太小,请选择矩形工具重新画一个"),t.path.remove(),t=null):(this.mpp=this.userMpp,this.drawMpp=!1,this.knew=!0)):(i&&t.path.remove(),t=null,this.$emit("draw",s,e),this.scope=null),this.selectedTool="choose"},calculateAngle(t,e,i,s){var n=180*Math.atan2(s-e,i-t)/Math.PI;return n<0&&n<0?360+n:n},mousemoveNew(t){let e=this.convertPoint(t.offsetX,t.offsetY);s&&s.remove(),"pickTool"!==this.selectedTool&&"choose"!==this.selectedTool||(s=new this.paper.Path.Circle({center:[e.x,e.y],radius:this.slice.mppx?10:20,fillColor:"yellow"}),this.layers[0].children=[s]);var i=this.dataMapPath["1735489060899790848"].path.getIntersections(s);if(i.length){let t=i[0].point.x,s=i[1].point.x,n=i[0].point.y,a=i[1].point.y;const o=(({x:t,y:e},{x:i,y:s})=>{const n=t*i+e*s,a=t*s-e*i;return(Math.atan2(a,n)/Math.PI*180+360)%360})({x:s-e.x,y:a-e.y},{x:t-e.x,y:n-e.y});console.log(o)}}},created(){this.curRoi=null,this.polygonRoi=null},mounted(){this.initOSD(),this.$refs.osd.addEventListener("touchstart",this.mouseDown)},beforeDestroy(){window.removeEventListener("resize",this.resize),setTimeout(()=>{this.paper.view.remove(),this.osd.destroy()},800)},watch:{radius(t){this.newRadius=t},position:{handler(t){this.update(t)},deep:!0},selectedTool:{handler(t){switch(t){case"choose":case"pickTool":this.$refs.osd.querySelector(".openseadragon-canvas").style.cursor="pointer";break;case"freepen":case"rectangle":case"measure":case"point":case"freepenReverse":case"rectangleReverse":case"secectMulty":case"dottingTool":case"continueTool":this.$refs.osd.querySelector(".openseadragon-canvas").style.cursor="crosshair"}},deep:!0},"position.zoom":function(){setTimeout(t=>{for(let t in this.curRois)this.drawArea(this.curRois[t])},90)},showRoi(t){t?this.$emit("changeShowLayer",!0):this.$emit("changeShowLayer",!1);for(let e in this.dataMapPath)this.dataMapPath[e].path.visible=!!t,this.dataMapPath[e].path.selected=this.curRois[e]&&t,this.dataMapPath[e].text&&(this.dataMapPath[e].text.visible=!!t,this.dataMapPath[e].rectangle.visible=!!t)},roilist(t,e){this.roilistChange(t,e),this.polygonRoi=null},centerRegion([t,e,i,s]){let n,a=1.5*(i-t),o=1.5*(s-e),r=this.slice.width,l=(t+i)/2,c=(e+s)/2;n=a/o>this.offsetWidth/this.offsetHeight?r/a:r/o*this.offsetHeight/this.offsetWidth,this.slice.toolType&&(this.slice.toolType.includes("tct")||this.slice.toolType.includes("lct")||"dna"===this.slice.toolType)||"bm"===this.slice.toolType?this.move(l/r,c/r,Math.max(40*this.scale,this.position.zoom)):this.move(l/r,c/r,Math.min(n,this.position.zoom))},curRois(t,e){this.roilist.forEach(e=>{this.showRoi?(this.dataMapPath[e.id].path.selected=!!t[e.id],!t[e.id]||0==t[e.id].editable||3==t[e.id].mark_type&&"grey"==t[e.id].strokeColor||this.paper.project.activeLayer.addChild(this.dataMapPath[e.id].path)):this.dataMapPath[e.id].path.selected=!1,this.dataMapPath[e.id].path.visible=!!this.showRoi});for(let t in this.dataMapPath)this.dataMapPath[t].text&&(this.dataMapPath[t].text.remove(),this.dataMapPath[t].rectangle.remove());for(let e in t)t[e]&&this.roilist.length&&this.drawArea(t[e]);Object.keys(t).toString()!=Object.keys(e).toString()&&(this.segmentsList=[])}},components:{"v-attactments":n.a}};function c(t,e=t.currentTarget){return t.touches?u(t.touches[0],e):t}function u(t,e){for(var i={x:0,y:0};e.offsetParent;)i.x+=e.offsetLeft,i.y+=e.offsetTop,e=e.offsetParent;return{offsetX:t.clientX-i.x,offsetY:t.clientY-i.y,x:t.clientX,y:t.clientY,shiftKey:t.shiftKey}}var h={render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"osd",class:{"fixed-fullpage":t.fullPage},on:{keydown:t.keydown}},[t._t("default"),t._v(" "),s("div",{ref:"osd",staticClass:"osd",on:{mousedown:t.mouseDown,mousewheel:t.wheel,dblclick:t.dblclick}}),t._v(" "),s("div",{staticClass:"btm_left"},[s("div",{staticClass:"zoom-in",attrs:{title:t.$t("analyze.zoomin")},on:{click:function(e){return t.buttonClick("zoom-in")}}}),t._v(" "),s("p",{staticClass:"showzoom",attrs:{title:t.position.zoom/t.scale+"X"}},[t._v(t._s((t.position.zoom/t.scale).toFixed(1))+"X")]),t._v(" "),s("div",{staticClass:"zoom-out",attrs:{title:t.$t("analyze.zoomout")},on:{click:function(e){return t.buttonClick("zoom-out")}}}),t._v(" "),s("div",{ref:"home",staticClass:"home",attrs:{title:t.$t("analyze.home")},on:{click:function(e){return t.buttonClick("home")}}}),t._v(" "),s("div",{attrs:{title:t.$t("analyze.2x")},on:{click:function(e){return t.buttonClick(2*t.scale)}}},[t._v("2X")]),t._v(" "),s("div",{attrs:{title:t.$t("analyze.4x")},on:{click:function(e){return t.buttonClick(4*t.scale)}}},[t._v("4X")]),t._v(" "),s("div",{attrs:{title:t.$t("analyze.10x")},on:{click:function(e){return t.buttonClick(10*t.scale)}}},[t._v("10X")]),t._v(" "),s("div",{attrs:{title:t.$t("analyze.20x")},on:{click:function(e){return t.buttonClick(20*t.scale)}}},[t._v("20X")]),t._v(" "),s("div",{attrs:{title:t.$t("analyze.40x")},on:{click:function(e){return t.buttonClick(40*t.scale)}}},[t._v("40X")]),t._v(" "),s("div",{attrs:{title:t.$t("analyze.original")},on:{click:function(e){return t.buttonClick("original")}}},[t._v("1:1")]),t._v(" "),s("div",{staticClass:"full-page",class:{"exit-full-page":t.fullPage},attrs:{title:t.fullPage?t.$t("analyze.exitfullpage"):t.$t("analyze.fullpage")},on:{click:function(e){return t.handleFullScreen()}}})]),t._v(" "),s("div",{staticClass:"btm",attrs:{tabindex:"0"},on:{click:function(e){t.showPenTool=!1},keydown:t.keydown}},[s("div",{staticClass:"show-roi",class:{bigContent:!t.showRoi},attrs:{title:t.$t("analyze.showRoi")},on:{click:function(e){t.showRoi=!t.showRoi}}}),t._v(" "),"tagging"==t.slice.toolType?s("div",{staticClass:"show-radius",class:{bigContent:t.showRadius},attrs:{title:"设置半径"},on:{click:function(e){t.showRadius=!t.showRadius}}}):t._e(),t._v(" "),t.showRadius?s("div",{staticClass:"radius",on:{click:function(t){t.stopPropagation()}}},[t._v("\n            标注点半径:\n            "),s("el-input",{ref:"radius",staticClass:"small-input",on:{blur:function(e){t.$emit("setRadius",e)}},nativeOn:{keyup:function(e){return t.toNumber(e)}},model:{value:t.newRadius,callback:function(e){t.newRadius=e},expression:"newRadius"}})],1):t._e(),t._v(" "),"tagging"==t.slice.toolType?s("div",{staticClass:"fill",class:{bigContent:!t.filled},attrs:{title:t.filled?"设为空心":"设为实心"},on:{click:function(e){return t.$emit("showBg")}}}):t._e(),t._v(" "),s("div",{staticClass:"secect-multy",class:{bigContent:"secectMulty"==t.selectedTool},attrs:{title:"多选"},on:{click:function(e){t.selectedTool="secectMulty"}}}),t._v(" "),t.hiddenPen?t._e():s("div",{class:["freepen"==t.selectedTool||"rectangle"==t.selectedTool||"point"==t.selectedTool||"freepenReverse"==t.selectedTool||"dottingTool"==t.selectedTool||"continueTool"==t.selectedTool||"rectangleReverse"==t.selectedTool?"bigContent":"",t.pentool],on:{click:function(e){return e.stopPropagation(),t.chooseTool(e)}}},[s("span",{staticClass:"triangle",on:{click:function(e){e.stopPropagation(),t.showPenTool=!t.showPenTool}}})]),t._v(" "),s("div",{staticClass:"drag",class:{bigContent:"choose"==t.selectedTool},attrs:{title:t.$t("analyze.choose")},on:{click:function(e){t.selectedTool="choose"}}}),t._v(" "),s("div",{staticClass:"measure-tool",class:{bigContent:"measure"==t.selectedTool},attrs:{title:t.$t("analyze.measure")},on:{click:function(e){t.selectedTool="measure"}}}),t._v(" "),t.hiddenPickTool?t._e():s("div",{staticClass:"pick-tool",class:{bigContent:"pickTool"==t.selectedTool},attrs:{title:"轮廓调整"},on:{click:t.adjustSegment}}),t._v(" "),s("v-attactments",{attrs:{record:t.record}})],1),t._v(" "),s("ul",{directives:[{name:"show",rawName:"v-show",value:t.showPenTool,expression:"showPenTool"}],staticClass:"pens"},[s("li",{class:{"li-bg":"freepen"==t.selectedTool},on:{click:function(e){return t.checkTool("freepen")}}},[s("img",{staticStyle:{left:"12px"},attrs:{src:i("aRHw"),width:"40"}}),t._v("自由ROI")]),t._v(" "),s("li",{class:{"li-bg":"continueTool"==t.selectedTool},on:{click:function(e){return t.checkTool("continueTool")}}},[s("img",{attrs:{src:i("rxv/"),width:"23"}}),t._v("自由ROI（续标）")]),t._v(" "),s("li",{class:{"li-bg":"rectangle"==t.selectedTool},on:{click:function(e){return t.checkTool("rectangle")}}},[s("img",{attrs:{src:i("jdSn"),width:"23"}}),t._v("矩形ROI")]),t._v(" "),s("li",{class:{"li-bg":"dottingTool"==t.selectedTool},on:{click:function(e){return t.checkTool("dottingTool")}}},[s("img",{attrs:{src:i("Qar8"),width:"23"}}),t._v("多边形ROI")]),t._v(" "),s("li",{class:{"li-bg":"point"==t.selectedTool,"disable-tool":!t.pointAble},on:{click:function(e){return t.checkTool("point")}}},[t.pointAble?s("span",[s("img",{attrs:{src:i("NmLI"),width:"25"}}),t._v("\n                打点\n            ")]):s("span",{staticClass:"grey"},[s("img",{attrs:{src:i("Tcqk"),width:"25"}}),t._v("\n                打点\n            ")])]),t._v(" "),s("li",{class:{"li-bg":"freepenReverse"==t.selectedTool,"disable-tool":!t.reverseAble},on:{click:function(e){return t.checkTool("freepenReverse")}}},[t.reverseAble?s("span",[s("img",{attrs:{src:i("4jrt"),width:"25"}}),t._v("\n                自由排除区域\n            ")]):s("span",{staticClass:"grey"},[s("img",{attrs:{src:i("FcKU"),width:"21"}}),t._v("\n                自由排除区域\n            ")])]),t._v(" "),s("li",{class:{"li-bg":"rectangleReverse"==t.selectedTool,"disable-tool":!t.reverseAble},on:{click:function(e){return t.checkTool("rectangleReverse")}}},[t.reverseAble?s("span",[s("img",{attrs:{src:i("iEaZ"),width:"25"}}),t._v("\n                矩形排除区域\n            ")]):s("span",{staticClass:"grey"},[s("img",{attrs:{src:i("vhYd"),width:"21"}}),t._v("\n                矩形排除区域\n            ")])])]),t._v(" "),s("div",{ref:"hideToolbar",staticStyle:{display:"none"}}),t._v(" "),s("canvas",{ref:"canvas",staticClass:"canvas"}),t._v(" "),t.saved?s("div",{staticClass:"saved"},[t._v("保存成功")]):t._e(),t._v(" "),t.showLabel?s("img",{ref:"rotate",staticClass:"label",attrs:{title:"点击旋转",src:"/aipath/api/files/getLabel?caseid="+t.record.id+"&fileid="+t.slice.id+"&companyid="+t.company},on:{click:t.rotate,error:function(e){t.showLabel=!1}}}):t._e(),t._v(" "),t.showMppGuide?s("div",{staticClass:"mpp-box"},[s("h2",[t._v("请框选出一个中等大小细胞核。如示例图:")]),t._v(" "),s("img",{attrs:{src:i("T4+n"),alt:"图例"}}),t._v(" "),s("span",{on:{click:function(e){return t.drawCell()}}},[t._v("我知道了")]),t._v(" "),s("div",{staticClass:"closeBtn",on:{click:function(e){return t.$emit("closeMppGuide",!0)}}},[s("img",{attrs:{src:i("YPLu"),alt:"关闭",width:"19"}})])]):t._e(),t._v(" "),t.knew?s("div",{staticClass:"knew"},[s("h2",[t._v("确认开始处理？")]),t._v(" "),s("div",{staticClass:"confirm-buttons"},[s("span",{staticClass:"finishdraw",on:{click:function(e){t.$emit("changeMpp",t.userMpp),t.curRoi.path.remove(),t.curRoi=null,t.knew=!1}}},[t._v("\n            确认")]),t._v(" "),s("span",{on:{click:function(e){t.$emit("changeMpp",!1),t.curRoi.path.remove(),t.curRoi=null,t.knew=!1}}},[t._v("\n            取消")])])]):t._e()],2)},staticRenderFns:[]};var d=i("VU/8")(l,h,!1,function(t){i("X92p"),i("V2TN")},"data-v-2957051a",null);e.a=d.exports},SlxH:function(t,e){},SwTe:function(t,e){},"T4+n":function(t,e,i){t.exports=i.p+"static/img/图例.cf250fc.jpg"},TBqe:function(t,e){},Tcqk:function(t,e,i){t.exports=i.p+"static/img/打点-d.7dec91a.svg"},TqFB:function(t,e){},UWzv:function(t,e){},UvJC:function(t,e){},V2TN:function(t,e){},X8rw:function(t,e){},X92p:function(t,e){},Xkiu:function(t,e){},YPDJ:function(t,e){},YPLu:function(t,e,i){t.exports=i.p+"static/img/关闭.a9102f6.png"},YYGD:function(t,e){},"Z1n+":function(t,e){},ZEPr:function(t,e){},Zh6N:function(t,e,i){t.exports=i.p+"static/img/point.95b8c37.png"},ZuMe:function(t,e,i){t.exports=i.p+"static/img/删除.cc459b5.svg"},a0GU:function(t,e){},a733:function(t,e){},aCHr:function(t,e,i){t.exports=i.p+"static/img/logo.50b0d33.svg"},aRHw:function(t,e,i){t.exports=i.p+"static/img/自由笔.d194396.svg"},abTO:function(t,e){},"b+/A":function(t,e){},bBPN:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=i("jyVo"),n={data(){return{basic:this.record.basic,pickerOptions2:{disabledDate:t=>{var e=new Date(this.basic.sampleTime).getTime();return""!=e?Date.now()<t.getTime()||t.getTime()<e-864e5:t.getTime()>Date.now()}},pickerOptions1:{disabledDate:t=>{var e=new Date(this.basic.sampleCollectDate).getTime();return""!=e?t.getTime()>Date.now()||t.getTime()>e:t.getTime()>Date.now()}},demoModeValue:"1"===localStorage.getItem("demoMode")||!1}},mounted(){},methods:{noEmoji(t){t.target.value=t.target.value.replace(/[^\u0020-\u007E\u00A0-\u00BE\u2E80-\uA4CF\uF900-\uFAFF\uFE30-\uFE4F\uFF00-\uFFEF\u0080-\u009F\u2000-\u201f\u2026\u2022\u20ac\r\n]/g,"")},next(){this.$emit("next")}},props:["record"]},a={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"basic"},[i("div",{staticClass:"basic-index"},[i("span",[t._v(t._s(t.$t("basic.basic")))])]),t._v(" "),i("div",{staticClass:"content"},[i("div",{staticClass:"basicInformation"},[i("h4",[t._v(t._s(t.$t("basic.basic")))]),t._v(" "),i("dl",[i("dt",[t._v(t._s(t.$t("basic.name")))]),t._v(" "),i("dd",[i("textarea",{directives:[{name:"model",rawName:"v-model",value:t.basic.name,expression:"basic.name"}],staticClass:"leftinput",attrs:{type:"text",maxlength:"32"},domProps:{value:t.basic.name},on:{input:[function(e){e.target.composing||t.$set(t.basic,"name",e.target.value)},t.noEmoji]}})])]),t._v(" "),i("dl",[i("dt",[t._v(t._s(t.$t("basic.age")))]),t._v(" "),i("dd",[i("textarea",{directives:[{name:"model",rawName:"v-model",value:t.basic.age,expression:"basic.age"}],staticClass:"last",attrs:{type:"text",maxlength:"3"},domProps:{value:t.basic.age},on:{input:[function(e){e.target.composing||t.$set(t.basic,"age",e.target.value)},function(e){t.noEmoji,t.basic.age=t.basic.age.replace(/[^\d]/g,"")&&parseInt(t.basic.age.replace(/[^\d]/g,""))}]}})])]),t._v(" "),i("dl",[i("dt",[t._v(t._s(t.$t("basic.sex")))]),t._v(" "),i("dd",[i("el-radio",{attrs:{label:"男"},model:{value:t.basic.gender,callback:function(e){t.$set(t.basic,"gender",e)},expression:"basic.gender"}},[t._v(t._s(t.$t("basic.gender[0]")))]),t._v(" "),i("el-radio",{attrs:{label:"女"},model:{value:t.basic.gender,callback:function(e){t.$set(t.basic,"gender",e)},expression:"basic.gender"}},[t._v(t._s(t.$t("basic.gender[1]")))]),t._v(" "),i("el-radio",{attrs:{label:"其他"},model:{value:t.basic.gender,callback:function(e){t.$set(t.basic,"gender",e)},expression:"basic.gender"}},[t._v(t._s(t.$t("basic.gender[2]")))])],1)]),t._v(" "),i("dl",[i("dt",[t._v(t._s(t.$t("basic.cancerType")))]),t._v(" "),i("dd",[i("textarea",{directives:[{name:"model",rawName:"v-model",value:t.basic.cancerType,expression:"basic.cancerType"}],staticClass:"cancerType",attrs:{maxlength:"32",placeholder:t.$t("basic.typeRemind")},domProps:{value:t.basic.cancerType},on:{input:[function(e){e.target.composing||t.$set(t.basic,"cancerType",e.target.value)},t.noEmoji]}})])]),t._v(" "),i("dl",[i("dt",[t._v(t._s(t.$t("basic.familyHistory")))]),t._v(" "),i("dd",[i("textarea",{directives:[{name:"model",rawName:"v-model",value:t.basic.familyHistory,expression:"basic.familyHistory"}],staticClass:"familyHistory",attrs:{maxlength:"150"},domProps:{value:t.basic.familyHistory},on:{input:[function(e){e.target.composing||t.$set(t.basic,"familyHistory",e.target.value)},t.noEmoji]}})])]),t._v(" "),i("dl",[i("dt",[t._v(t._s(t.$t("basic.medicalHistory")))]),t._v(" "),i("dd",[i("textarea",{directives:[{name:"model",rawName:"v-model",value:t.basic.medicalHistory,expression:"basic.medicalHistory"}],staticClass:"medicalHistory",attrs:{maxlength:"300"},domProps:{value:t.basic.medicalHistory},on:{input:[function(e){e.target.composing||t.$set(t.basic,"medicalHistory",e.target.value)},t.noEmoji]}})])])]),t._v(" "),i("div",{staticClass:"sampleInformation"},[i("h4",{staticClass:"samples"},[t._v(t._s(t.$t("basic.sample")))]),t._v(" "),i("dl",[i("dt",[t._v(t._s(t.$t("basic.caseid")))]),t._v(" "),i("dd",[i("textarea",{directives:[{name:"model",rawName:"v-model",value:t.basic.caseid,expression:"basic.caseid"}],staticClass:"w360",attrs:{type:"text",maxlength:"45"},domProps:{value:t.basic.caseid},on:{input:[function(e){e.target.composing||t.$set(t.basic,"caseid",e.target.value)},t.noEmoji]}})])]),t._v(" "),i("dl",[i("dt",[t._v(t._s(t.$t("basic.samplePart")))]),t._v(" "),i("dd",[i("textarea",{directives:[{name:"model",rawName:"v-model",value:t.basic.samplePart,expression:"basic.samplePart"}],staticClass:"w360",attrs:{type:"text",maxlength:"45"},domProps:{value:t.basic.samplePart},on:{input:[function(e){e.target.composing||t.$set(t.basic,"samplePart",e.target.value)},t.noEmoji],blur:function(e){t.basic.samplePart=t.basic.samplePart.replace(/\s*/g,"")}}})])]),t._v(" "),i("dl",[i("dt",[t._v(t._s(t.$t("basic.sampleTime")))]),t._v(" "),i("dd",[i("el-date-picker",{attrs:{type:"date",placeholder:t.$t("basic.timeRemind"),"value-format":"yyyy-MM-dd"},model:{value:t.basic.sampleTime,callback:function(e){t.$set(t.basic,"sampleTime",e)},expression:"basic.sampleTime"}})],1)]),t._v(" "),i("dl",[i("dt",[t._v(t._s(t.$t("basic.sampleCollectDate")))]),t._v(" "),i("dd",[i("el-date-picker",{staticStyle:{"margin-right":"0"},attrs:{type:"date",placeholder:t.$t("basic.collectRemind"),"value-format":"yyyy-MM-dd"},model:{value:t.basic.sampleCollectDate,callback:function(e){t.$set(t.basic,"sampleCollectDate",e)},expression:"basic.sampleCollectDate"}})],1)]),t._v(" "),i("dl",[i("dt",[t._v(t._s(t.$t("basic.sampleType")))]),t._v(" "),i("dd",[i("textarea",{directives:[{name:"model",rawName:"v-model",value:t.basic.sampleType,expression:"basic.sampleType"}],staticClass:"w360",attrs:{type:"text",maxlength:"45"},domProps:{value:t.basic.sampleType},on:{input:[function(e){e.target.composing||t.$set(t.basic,"sampleType",e.target.value)},t.noEmoji],blur:function(e){t.basic.sampleType=t.basic.sampleType.replace(/\s*/g,"")}}})])]),t._v(" "),i("dl",[i("dt",[t._v(t._s(t.$t("basic.generallySeen")))]),t._v(" "),i("dd",[i("textarea",{directives:[{name:"model",rawName:"v-model",value:t.basic.generallySeen,expression:"basic.generallySeen"}],staticClass:"generallySeen",staticStyle:{height:"100px"},attrs:{maxlength:"300"},domProps:{value:t.basic.generallySeen},on:{input:[function(e){e.target.composing||t.$set(t.basic,"generallySeen",e.target.value)},t.noEmoji]}})])])])]),t._v(" "),i("div",{staticClass:"footer"},[i("span",{on:{click:function(e){return t.$emit("save","auto")}}},[t._v("保存")]),t._v(" "),t.demoModeValue?t._e():i("span",{on:{click:function(e){return t.$emit("prev")}}},[t._v("上一个")]),t._v(" "),t.demoModeValue?t._e():i("span",{on:{click:function(e){return t.next()}}},[t._v("下一个")])])])},staticRenderFns:[]};var o=i("VU/8")(n,a,!1,function(t){i("TqFB")},"data-v-23196004",null).exports,r=i("tKRC"),l={render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"container"},[s("div",{staticClass:"basic-index"},[s("span",[t._v(t._s(t.$t("detail.files")))])]),t._v(" "),s("div",{staticClass:"slides left"},[s("div",{staticClass:"top"},[s("div",{staticClass:"slides-list"},[t._v("\n        "+t._s(t.$t("upload.slides"))+"\n        "),s("span",[t._v(t._s(this.record.slices.length))])]),t._v(" "),s("div",{staticClass:"new-slide"},[t._v("\n        "+t._s(t.$t("upload.addslice"))+"\n        "),s("input",{attrs:{type:"file",accept:t.uploadType,multiple:""},on:{change:function(e){return t.addFiles(e.currentTarget)}}})])]),t._v(" "),s("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],ref:"sliceTable",staticClass:"table",attrs:{data:t.loadList,size:"medium","element-loading-text":"请稍后...","element-loading-background":"rgba(0, 0, 0, 0.8)","row-class-name":function(t){return t.rowIndex%2?"row1":"row2"},"header-cell-class-name":"header",height:"calc(100% - 58px)"},on:{"row-click":function(e){t.currentRecord=e}}},[s("el-table-column",{attrs:{label:t.$t("upload.name")},scopedSlots:t._u([{key:"default",fn:function(e){return[s("input",{directives:[{name:"model",rawName:"v-model",value:e.row.name,expression:"scope.row.name"}],staticStyle:{background:"rgba(0,0,0,0.2)",border:"none",padding:"5px",width:"95%",overflow:"hidden","text-overflow":"ellipsis","white-space":"nowrap"},attrs:{title:e.row.name},domProps:{value:e.row.name},on:{input:function(i){i.target.composing||t.$set(e.row,"name",i.target.value)}}})]}}])}),t._v(" "),s("el-table-column",{attrs:{label:t.$t("upload.stainTypes"),width:"150"},scopedSlots:t._u([{key:"default",fn:function(e){return[s("el-autocomplete",{attrs:{size:"small",debounce:10,"fetch-suggestions":t.stainTypes,placeholder:t.$t("upload.stainTypes")},on:{blur:function(t){e.row.stain=e.row.stain.replace(/\s*/g,"")}},nativeOn:{input:function(e){return t.noEmoji(e)}},model:{value:e.row.stain,callback:function(i){t.$set(e.row,"stain",i)},expression:"scope.row.stain"}})]}}])}),t._v(" "),s("el-table-column",{attrs:{label:t.$t("upload.total"),"min-width":"120"},scopedSlots:t._u([{key:"default",fn:function(e){return[s("div",{staticClass:"progress"},[s("div",{staticClass:"inner",class:"bg"+e.row.state,style:"width:"+100*(e.row.loaded?e.row.loaded/e.row.total:0)+"%"})]),t._v(" "),s("div",{staticClass:"text"},[t._v(t._s(e.row.loaded?Math.floor(e.row.loaded/e.row.total*100):0)+"%")])]}}])}),t._v(" "),s("el-table-column",{attrs:{"min-width":"160"},scopedSlots:t._u([{key:"default",fn:function(e){return[s("span",{class:"img"+e.row.state},[t._v(t._s(t.$t("upload.states["+e.row.state+"]")))]),t._v(" "),3==e.row.state?s("a",{staticStyle:{"font-size":"12px",color:"#2A9FF6"},on:{click:function(i){return t.upload(e.row)}}},[t._v(t._s(t.$t("upload.reupload")))]):t._e()]}}])},[s("template",{slot:"header"},[t._v("\n          状态\n          "),s("img",{staticStyle:{margin:"1px 0 0 2px",cursor:"pointer",verticalAlign:"top"},attrs:{src:i("1kz0"),alt:"",width:"20",height:"20",title:"重新上传"},on:{click:t.uploadAll}})])],2),t._v(" "),s("el-table-column",{attrs:{label:t.$t("upload.size")},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(t._s(Math.ceil(e.row.total/1e3/1e3))+"MB")]}}])}),t._v(" "),s("el-table-column",{attrs:{label:t.$t("upload.opration"),"min-width":"140"},scopedSlots:t._u([{key:"default",fn:function(e){return[t.userInfo.importable?s("a",{staticClass:"add-db",attrs:{title:"导入DB文件"}},[s("input",{attrs:{type:"file"},on:{change:function(i){return t.addDb(i.currentTarget,e.row)}}})]):t._e(),t._v(" "),t.userInfo.importable?s("a",{staticClass:"add-db ex-db",attrs:{title:"导出DB文件"},on:{click:function(i){return t.exportDb(e.row,"db")}}}):t._e(),t._v(" "),t.userInfo.exportJson?s("a",{staticClass:"add-db ex-db ex-json",attrs:{title:"导出JSON文件"},on:{click:function(i){return t.exportDb(e.row,"json")}}}):t._e(),t._v(" "),s("a",{staticClass:"del",on:{click:function(i){return t.del(e.row)}}},[s("img",{attrs:{src:i("ZuMe"),title:t.$t("upload.delete")}})])]}}])})],1)],1),t._v(" "),s("div",{staticClass:"slides right"},[s("div",{staticClass:"top"},[s("div",{staticClass:"slides-list"},[t._v("\n        "+t._s(t.$t("upload.achment"))+"\n        "),s("span",[t._v(t._s(this.record.attachments.length))])]),t._v(" "),s("div",{staticClass:"new-slide"},[t._v("\n        "+t._s(t.$t("upload.addattachment"))+"\n        "),s("input",{attrs:{type:"file",multiple:""},on:{change:function(e){return t.addFiles(e.currentTarget,"attachment")}}})])]),t._v(" "),s("el-table",{ref:"table",staticClass:"table",attrs:{data:t.record.attachments,size:"medium","row-class-name":function(t){return t.rowIndex%2?"row1":"row2"},"header-cell-class-name":"header",height:"calc(100% - 58px)"},on:{"row-dblclick":function(e){return t.openWindow(e)},"row-click":function(e){t.currentRecord=e}}},[s("el-table-column",{attrs:{label:t.$t("upload.name")},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(t._s(e.row.name))]}}])}),t._v(" "),s("el-table-column",{attrs:{label:t.$t("upload.total"),"min-width":"120"},scopedSlots:t._u([{key:"default",fn:function(e){return[s("div",{staticClass:"progress"},[s("div",{staticClass:"inner",class:"bg"+e.row.state,style:"width:"+e.row.loaded/e.row.total*100+"%"})]),t._v(" "),s("div",{staticClass:"text"},[t._v(t._s(Math.floor(e.row.loaded/e.row.total*100))+"%")])]}}])}),t._v(" "),s("el-table-column",{attrs:{label:t.$t("upload.state"),"min-width":"130"},scopedSlots:t._u([{key:"default",fn:function(e){return[s("span",{class:"img"+e.row.state},[t._v(t._s(t.$t("upload.states["+e.row.state+"]")))]),t._v(" "),3==e.row.state?s("a",{staticStyle:{"font-size":"12px",color:"#2A9FF6"},on:{click:function(i){return t.upload(e.row)}}},[t._v(t._s(t.$t("upload.reupload")))]):t._e()]}}])}),t._v(" "),s("el-table-column",{attrs:{label:t.$t("upload.size")},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(t._s(Math.ceil(e.row.total/1e3/1e3))+"MB")]}}])}),t._v(" "),s("el-table-column",{attrs:{label:t.$t("upload.opration"),"min-width":"80"},scopedSlots:t._u([{key:"default",fn:function(e){return[s("a",{staticClass:"del",on:{click:function(i){return t.del(e.row)}}},[s("img",{attrs:{src:i("ZuMe"),title:t.$t("upload.delete")}})])]}}])})],1)],1),t._v(" "),s("div",{staticClass:"footer"},[s("span",{on:{click:function(e){return t.$emit("save","auto")}}},[t._v("保存")]),t._v(" "),t.demoModeValue?t._e():s("span",{on:{click:function(e){return t.prev()}}},[t._v("上一个")]),t._v(" "),t.demoModeValue?t._e():s("span",{on:{click:function(e){return t.next()}}},[t._v("下一个")])]),t._v(" "),t.alertTitle?s("el-alert",{attrs:{title:t.alertTitle,type:"warning","show-icon":""}}):t._e()],1)},staticRenderFns:[]};var c=function(t){i("Oswd")},u=i("VU/8")(r.a,l,!1,c,"data-v-55cf20ac",null).exports,h={data:()=>({show:!1,model_lis:JSON.parse(Object(s.s)().model_lis)}),methods:{choose(t){"pdl1db"!==this.curAI&&(localStorage.perToolType=this.curAI||"human"),this.$emit("chooseAI",t),this.show=!1},showmodel(t){return!!this.model_lis.some(e=>e==t)}},mounted(){},watch:{closeAi(){this.show=!1}},props:["curAI","closeAi"]},d={render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",[t.show?s("div",{staticClass:"algorithm"},[s("div",{staticClass:"Aibox"},[s("div",{staticClass:"basicProcessing normal"},[s("h4",[t._v("图像处理")]),t._v(" "),s("ul",[s("li",{on:{click:function(e){return e.stopPropagation(),t.choose("human")}}},[s("div",{class:{active:"human"==t.curAI,human:!0}}),t._v(" "),s("span",[t._v(t._s(t.$t("slice.aiTypes.human")))])]),t._v(" "),t._l(["cellseg","center","pdl1db"],function(e){return s("li",{key:e,on:{click:function(i){i.stopPropagation(),t.showmodel(e)&&t.choose(e)}}},[s("div",{class:[t.curAI==e?"active":"",t.showmodel(e)?"":"disabled",e]}),t._v(" "),s("span",[t._v(t._s(t.$t("slice.aiTypes."+e)))])])})],2),t._v(" "),s("h4",[t._v(t._s(t.$t("algorithm.scientific")))]),t._v(" "),s("ul",t._l(["tagging"],function(e){return s("li",{key:e,on:{click:function(i){i.stopPropagation(),t.showmodel(e)&&t.choose(e)}}},[s("div",{class:[t.curAI==e?"active":"",t.showmodel(e)?"":"disabled",e]}),t._v(" "),s("span",[t._v(t._s(t.$t("slice.aiTypes."+e)))])])}),0),t._v(" "),s("h4",[t._v("AI处理")]),t._v(" "),s("ul",t._l(["tct1","tct2","lct1","lct2","pdl1","ki67","ki67hot","er","pr","fish","her2","np","dna","cd30","bm"],function(e){return s("li",{key:e,on:{click:function(i){i.stopPropagation(),t.showmodel(e)&&t.choose(e)}}},[s("div",{class:[t.curAI==e?"active":"",t.showmodel(e)?"":"disabled",e]}),t._v(" "),s("span",[t._v(t._s(t.$t("slice.aiTypes."+e)))])])}),0)])])]):t._e(),t._v(" "),s("div",{staticClass:"showList",on:{click:function(e){e.stopPropagation(),t.show=!t.show}}},[t._v("\n        "+t._s(this.$t("slice.aiTypes."+this.curAI))+"\n        "),s("img",{staticClass:"showpoints",class:{show:t.show},attrs:{src:i("Zh6N"),alt:""}})])])},staticRenderFns:[]};var p=i("VU/8")(h,d,!1,function(t){i("NN4q")},"data-v-275f13ba",null).exports,v=i("SfvY"),g={methods:{changeImage(t){this.$set(t,"image",1-(t.image||0)),this.$emit("closecontextmenu"),this.$emit("roiChanged","image",[t])},checkall(){if(!this.roilist.length)return;let t=this.roilist.every(t=>!!t.image);this.roilist.forEach(e=>this.$set(e,"image",t?0:1)),this.$emit("roiChanged","image",this.roilist),this.$emit("closecontextmenu")},del(t){this.$confirm(this.$t("analaysisPanel.delete"),{confirmButtonText:this.$t("confirm.confirm"),cancelButtonText:this.$t("confirm.quit"),type:"warning"}).then(()=>this.$emit("delRoi",t),t=>t)},noEmoji(t){t.target.value=t.target.value.replace(/[^\u0020-\u007E\u00A0-\u00BE\u2E80-\uA4CF\uF900-\uFAFF\uFE30-\uFE4F\uFF00-\uFFEF\u0080-\u009F\u2000-\u201f\u2026\u2022\u20ac\r\n]/g,"")}},props:["roilist","currentRois","forbidden"]},f={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"roi"},[i("div",{staticClass:"top"},[i("div",{staticClass:"left"},[i("div",[i("span",{staticClass:"uncheck",class:{checked:!!t.roilist.length&&t.roilist.every(function(t){return!!t.image})},on:{click:t.checkall}}),t._v("\n                ROI\n            ")])]),t._v(" "),i("div",{staticClass:"center"},[t._v("\n            "+t._s(t.$t("slice.remark"))+"\n        ")]),t._v(" "),i("div",{staticClass:"right"},[t._v("\n            "+t._s(t.$t("analyze.opration"))+"\n        ")])]),t._v(" "),i("div",{staticClass:"rois"},t._l(t.roilist,function(e,s){return i("div",{key:s,staticClass:"row",class:{curRoi:t.currentRois[e.id]},on:{click:function(i){t.$emit("curROI",e,i.shiftKey),t.$emit("closecontextmenu")}}},[i("div",{staticClass:"left"},[i("div",{attrs:{title:"勾选后将放入报告"}},[i("span",{staticClass:"uncheck",class:{checked:e.image},on:{click:function(i){return i.stopPropagation(),t.changeImage(e)}}}),t._v("\n                    "+t._s(s+1)+"\n                ")])]),t._v(" "),i("div",{staticClass:"center"},[i("input",{directives:[{name:"model",rawName:"v-model.lazy",value:e.remark,expression:"roi.remark",modifiers:{lazy:!0}}],attrs:{type:"text",disabled:t.forbidden,placeholder:t.$t("slice.input"),maxlength:"300",title:e.remark},domProps:{value:e.remark},on:{keydown:function(e){if(!e.type.indexOf("key")&&t._k(e.keyCode,"delete",[8,46],e.key,["Backspace","Delete","Del"]))return null;e.stopPropagation()},input:t.noEmoji,blur:function(i){return t.$emit("roiChanged","remark",[e])},change:function(i){return t.$set(e,"remark",i.target.value)}}})]),t._v(" "),i("div",{staticClass:"right"},[i("em",{attrs:{title:t.$t("upload.delete")},on:{click:function(i){return i.stopPropagation(),t.del(e)}}})])])}),0)])},staticRenderFns:[]};var m=i("VU/8")(g,f,!1,function(t){i("+UnF")},"data-v-2efa1ccc",null).exports,_={data(){return{centerRegion:null,curRois:{},position:{offx:this.slice.position?this.slice.position.offx:.5,offy:this.slice.position?this.slice.position.offy:.5*this.slice.height/this.slice.width,zoom:this.slice.position?this.slice.position.zoom:null},curLevel:{},leftRoilist:[],rightRoilist:[],loading:!1}},methods:{async getRoi(t){let{x1:e,y1:i,x2:n,y2:a,z:o}=t;this.curLevel={x:[e,n],y:[i,a],z:o},this.leftRoilist=await Object(s.n)(this.record.id,this.slice.id,this.curLevel),this.$emit("save","noListUpdate")},curROIChange(t,e){var i;t?t.length?i=t:e&&this.curRois[t.id]?(delete this.curRois[t.id],i=[]):i=[t]:i=[],this.curRois=Object.assign({},e&&this.curRois||{},...i.map(t=>({[t.id]:t})))},async roiChanged(t,e){let i;i=e?e.map(e=>({id:e.id,[t]:e[t]})):Object.values(this.curRois).map(e=>({id:e.id,[t]:e[t]}));let n="image"==t||"remark"==t?null:this.$refs.osd.scope;n&&n.offset&&(this.curRois={},this.$refs.osd.scope=null),n?this.$message.error("不支持多选移动"):(this.loading=!0,await Object(s.e)(this.record.id,this.slice.id,"human",i,n),this.loading=!1),Object.keys(this.curRois).map(t=>{this.leftRoilist.some(e=>e.id==t)||(delete this.curRois[t],this.curRois=Object.assign({},this.curRois))}),this.leftRoilist=await Object(s.n)(this.record.id,this.slice.id,this.curLevel)},listChangeCurrent(){var t=[].concat.apply([],Object.values(this.curRois).map(t=>t.path.x)),e=[].concat.apply([],Object.values(this.curRois).map(t=>t.path.y));t.length?this.centerRegion=[Math.min.apply(null,t),Math.min.apply(null,e),Math.max.apply(null,t),Math.max.apply(null,e)]:this.centerRegion=null,this.$refs.osd.scope=null},async draw(t,e){t.strokeColor="yellow",t.mark_type=1,t.id=await Object(s.h)(this.record.id,this.slice.id,t),t.id&&(this.leftRoilist=[...this.leftRoilist,t],this.leftRoilist=await Object(s.n)(this.record.id,this.slice.id,this.curLevel),this.rightRoilist=await Object(s.p)(this.record.id,this.slice.id),this.curROIChange(t,e))},async clickDraw(t,e){var i={path:{x:[t.x],y:[t.y]},method:"spot",radius:3/(this.slice.mppx||.242042),mark_type:1,fillColor:"yellow"};i.id=await Object(s.h)(this.record.id,this.slice.id,i),i.id&&(this.leftRoilist=[...this.leftRoilist,i],this.leftRoilist=await Object(s.n)(this.record.id,this.slice.id,this.curLevel),this.rightRoilist=await Object(s.p)(this.record.id,this.slice.id),this.curROIChange(i,e))},async delCurRoi(t){t?(this.loading=!0,await Object(s.i)(this.record.id,this.slice.id,"human",[t.id],null),this.loading=!1,this.curRois[t.id]&&(delete this.curRois[t.id],this.curRois=Object.assign({},this.curRois)),this.leftRoilist=await Object(s.n)(this.record.id,this.slice.id,this.curLevel),this.rightRoilist=await Object(s.p)(this.record.id,this.slice.id)):await this.$confirm(this.$t("analaysisPanel.delete"),{confirmButtonText:this.$t("confirm.confirm"),cancelButtonText:this.$t("confirm.quit"),type:"warning"}).catch(()=>{})&&(this.loading=!0,await Object(s.i)(this.record.id,this.slice.id,"human",Object.keys(this.curRois).map(t=>t),this.$refs.osd.scope),this.loading=!1,this.curRois={},this.leftRoilist=await Object(s.n)(this.record.id,this.slice.id,this.curLevel),this.rightRoilist=await Object(s.p)(this.record.id,this.slice.id))},keydown(t){"Delete"!=t.key&&"Backspace"!=t.key||!Object.keys(this.curRois).length||this.delCurRoi()}},async mounted(){this.rightRoilist=await Object(s.p)(this.record.id,this.slice.id)},props:["slice","record"],components:{"v-dragon":v.a,"v-roi":m}},y={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"cnt",attrs:{tabIndex:0},on:{keydown:t.keydown}},[i("div",{staticClass:"analyright"},[i("v-dragon",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],ref:"osd",staticClass:"dragon",attrs:{record:t.record,slice:t.slice,roilist:t.leftRoilist,curRois:t.curRois,centerRegion:t.centerRegion,position:t.position,penColor:"yellow","element-loading-text":"处理中，请耐心等待","element-loading-spinner":"el-icon-loading","element-loading-background":"rgba(0, 0, 0, 0.5)"},on:{curROI:t.curROIChange,roiChanged:t.roiChanged,draw:t.draw,clickDraw:t.clickDraw,delRoi:function(e){return t.delCurRoi(e)},position:function(e,i,s){t.$set(t.position,"offx",e),t.$set(t.position,"offy",i),t.$set(t.position,"zoom",s),t.$set(t.slice,"position",t.position)},getRoi:t.getRoi}})],1),t._v(" "),i("div",{staticClass:"analylist"},[i("v-roi",{attrs:{roilist:t.rightRoilist,currentRois:t.curRois},on:{curROI:function(e,i){return t.curROIChange(e,i)+t.listChangeCurrent()},delRoi:function(e){return t.delCurRoi(e)},roiChanged:t.roiChanged}})],1)])},staticRenderFns:[]};var R=i("VU/8")(_,y,!1,function(t){i("10oS")},"data-v-586a9853",null).exports,b=i("qbzz"),C={render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"osd",class:{"fixed-fullpage":t.fullPage},on:{keydown:t.keydown}},[t._t("default"),t._v(" "),s("div",{ref:"osd",staticClass:"osd",on:{mousemove:t.mouseMove,mousedown:t.mouseDown,mousewheel:t.wheel,contextmenu:t.contextmenuDisplay}}),t._v(" "),s("div",{staticClass:"btm_left"},[s("div",{staticClass:"zoom-in",attrs:{title:t.$t("analyze.zoomin")},on:{click:function(e){return t.buttonClick("zoom-in")}}}),t._v(" "),s("p",{staticClass:"showzoom",attrs:{title:t.position.zoom/t.scale+"X"}},[t._v(t._s((t.position.zoom/t.scale).toFixed(1))+"X")]),t._v(" "),s("div",{staticClass:"zoom-out",attrs:{title:t.$t("analyze.zoomout")},on:{click:function(e){return t.buttonClick("zoom-out")}}}),t._v(" "),s("div",{ref:"home",staticClass:"home",attrs:{title:t.$t("analyze.home")},on:{click:function(e){return t.buttonClick("home")}}}),t._v(" "),s("div",{attrs:{title:t.$t("analyze.2x")},on:{click:function(e){return t.buttonClick(2*t.scale)}}},[t._v("2X")]),t._v(" "),s("div",{attrs:{title:t.$t("analyze.4x")},on:{click:function(e){return t.buttonClick(4*t.scale)}}},[t._v("4X")]),t._v(" "),s("div",{attrs:{title:t.$t("analyze.10x")},on:{click:function(e){return t.buttonClick(10*t.scale)}}},[t._v("10X")]),t._v(" "),s("div",{attrs:{title:t.$t("analyze.20x")},on:{click:function(e){return t.buttonClick(20*t.scale)}}},[t._v("20X")]),t._v(" "),s("div",{attrs:{title:t.$t("analyze.40x")},on:{click:function(e){return t.buttonClick(40*t.scale)}}},[t._v("40X")]),t._v(" "),s("div",{attrs:{title:t.$t("analyze.original")},on:{click:function(e){return t.buttonClick("original")}}},[t._v("1:1")]),t._v(" "),s("div",{staticClass:"full-page",class:{"exit-full-page":t.fullPage},attrs:{title:t.fullPage?t.$t("analyze.exitfullpage"):t.$t("analyze.fullpage")},on:{click:function(e){return t.handleFullScreen()}}})]),t._v(" "),s("div",{staticClass:"btm"},[t.sliceType?s("div",{staticClass:"freepen",class:{bigContent:"freepen"==t.selectedTool},attrs:{title:t.$t("analyze.circlepen")},on:{click:function(e){t.selectedTool="freepen"}}}):t._e(),t._v(" "),s("div",{staticClass:"drag",class:{bigContent:"choose"==t.selectedTool},attrs:{title:t.$t("analyze.choose")},on:{click:function(e){t.selectedTool="choose"}}}),t._v(" "),t.sliceType?s("div",{staticClass:"measure",class:{bigContent:"measure"==t.selectedTool},attrs:{title:t.$t("analyze.measuredepth")},on:{click:function(e){t.selectedTool="measure"}}}):t._e(),t._v(" "),t.sliceType?s("div",{staticClass:"level_measure",class:{bigContent:"level_measure"==t.selectedTool},attrs:{title:t.$t("analyze.measurepMH")},on:{click:function(e){t.selectedTool="level_measure"}}}):t._e(),t._v(" "),t.sliceType?s("div",{staticClass:"verticl_measure",class:{bigContent:"verticl_measure"==t.selectedTool},attrs:{title:t.$t("analyze.measurepVM")},on:{click:function(e){t.selectedTool="verticl_measure"}}}):t._e(),t._v(" "),-1!==this.slice.filename.indexOf("痕")?s("div",{staticClass:"signpen",class:{bigContent:"signpen"==t.selectedTool},attrs:{title:t.$t("analyze.signpen")},on:{click:function(e){t.selectedTool="signpen"}}}):t._e(),t._v(" "),t.sliceType?s("div",{staticClass:"circlepen",class:{bigContent:"circlepen"==t.selectedTool},attrs:{title:t.$t("analyze.freepen")},on:{click:function(e){t.selectedTool="circlepen"}}}):t._e(),t._v(" "),-1!==this.slice.filename.indexOf("痕")?s("div",{staticClass:"translate",class:{bigContent:"translate"==t.selectedTool},attrs:{title:t.$t("analyze.translate")},on:{click:function(e){t.selectedTool="translate"}}}):t._e(),t._v(" "),-1!==this.slice.filename.indexOf("体")?s("div",{staticClass:"crosscurve",class:{bigContent:"crosscurve"==t.selectedTool},attrs:{title:t.$t("analyze.crosscurve")},on:{click:function(e){t.selectedTool="crosscurve"}}}):t._e(),t._v(" "),s("v-attactments",{attrs:{record:t.record}})],1),t._v(" "),s("div",{ref:"circleOpt",staticClass:"circle_option"},[s("span",{attrs:{id:"pointed"}}),t._v(" "),s("div",{attrs:{title:"高级别上皮内瘤变（包括原位癌）"},on:{click:t.setCircleCol}},[s("i",{staticClass:"intraepithelial_neo",staticStyle:{background:"#FF2400"},attrs:{title:"高级别上皮内瘤变（包括原位癌）"}}),t._v("高级别上皮内瘤变（包括原位癌）\n        ")]),t._v(" "),s("div",{attrs:{title:"腺癌混合型"},on:{click:t.setCircleCol}},[s("i",{staticClass:"adenocarcinoma_mix",staticStyle:{background:"#FC00FF"},attrs:{title:"腺癌混合型"}}),t._v("腺癌混合型\n        ")]),t._v(" "),s("div",{attrs:{title:"管状腺癌"},on:{click:t.setCircleCol}},[s("i",{staticClass:"tubular_ade",staticStyle:{background:"#FF9F38"},attrs:{title:"管状腺癌"}}),t._v("管状腺癌\n        ")]),t._v(" "),s("div",{attrs:{title:"乳头状腺癌"},on:{click:t.setCircleCol}},[s("i",{staticClass:"papillary_ade",staticStyle:{background:"#F9E219"},attrs:{title:"乳头状腺癌"}}),t._v("乳头状腺癌\n        ")]),t._v(" "),s("div",{attrs:{title:"粘液腺癌"},on:{click:t.setCircleCol}},[s("i",{staticClass:"mucinous_ade",staticStyle:{background:"#59F659"},attrs:{title:"粘液腺癌"}}),t._v("粘液腺癌\n        ")]),t._v(" "),s("div",{attrs:{title:"印戒细胞癌"},on:{click:t.setCircleCol}},[s("i",{staticClass:"signet_ring",staticStyle:{background:"#B799FF"},attrs:{title:"印戒细胞癌"}}),t._v("印戒细胞癌\n        ")]),t._v(" "),s("div",{attrs:{title:"脉管癌栓"},on:{click:t.setCircleCol}},[s("i",{staticClass:"vascular_tumor",staticStyle:{background:"#3EAFDD"},attrs:{title:"脉管癌栓"}}),t._v("脉管癌栓\n        ")]),t._v(" "),s("div",{attrs:{title:"神经侵犯"},on:{click:t.setCircleCol}},[s("i",{staticClass:"nerve_invasion",staticStyle:{background:"#4682D7"},attrs:{title:"神经侵犯"}}),t._v("神经侵犯\n        ")]),t._v(" "),s("div",{attrs:{title:"其他"},on:{click:t.setCircleCol}},[s("i",{staticClass:"other_ade",staticStyle:{background:"#44414D"},attrs:{title:"其他"}}),t._v("其他\n        ")])]),t._v(" "),t.showScreenshot?s("div",{staticClass:"screenshot",on:{click:function(e){return t.screenshot(e)}}},[t._v("采图")]):t._e(),t._v(" "),-1!==this.slice.filename.indexOf("痕")?s("div",{staticClass:"mapping",on:{click:function(e){return t.mapping()}}},[t._v("映射")]):t._e(),t._v(" "),t.mapAgain?s("div",{staticClass:"mapping",on:{click:function(e){return t.mappAgain()}}},[t._v("重新映射")]):t._e(),t._v(" "),t.mapAgain?s("div",{staticClass:"esdscreenshot",on:{click:function(e){return t.esdscreenshot(e)}}},[t._v("采图")]):t._e(),t._v(" "),s("div",{ref:"hideToolbar",staticStyle:{display:"none"}}),t._v(" "),s("canvas",{ref:"canvas",staticClass:"canvas"}),t._v(" "),s("div",{ref:"navigator",staticClass:"navigator",style:{"background-image":"url(/aipath/api/files/thumbnail?caseid="+encodeURIComponent(t.record.id)+"&fileid="+t.slice.id+"&companyid="+t.company+")",width:150*Math.min(this.slice.width/this.slice.height,1)+"px",height:150*Math.min(this.slice.height/this.slice.width,1)+"px"}},[s("div",{staticClass:"focus",style:{"margin-left":100*t.position.offx+"%","margin-top":100*t.position.offy+"%",width:100/this.position.zoom+"%",height:this.offsetHeight/this.offsetWidth/this.slice.height*this.slice.width*100/this.position.zoom+"%"}})]),t._v(" "),t.saved?s("div",{staticClass:"saved"},[t._v("保存成功")]):t._e(),t._v(" "),t.showLabel?s("img",{ref:"rotate",staticClass:"label",attrs:{title:"点击旋转",src:"/aipath/api/files/getLabel?caseid="+t.record.id+"&fileid="+t.slice.id},on:{click:t.rotate}}):t._e(),t._v(" "),t.showMppGuide?s("div",{staticClass:"mpp-box"},[s("h2",[t._v("请框选出一个中等大小细胞核。如示例图:")]),t._v(" "),s("img",{attrs:{src:i("JLZf"),alt:"图例"}}),t._v(" "),s("span",{on:{click:function(e){return t.drawCell()}}},[t._v("我知道了")]),t._v(" "),s("div",{staticClass:"closeBtn",on:{click:function(e){return t.$emit("closeMppGuide",!0)}}},[s("img",{attrs:{src:i("k8Nx"),alt:"关闭",width:"19"}})])]):t._e(),t._v(" "),t.knew?s("div",{staticClass:"knew"},[s("h2",[t._v("确认开始处理？")]),t._v(" "),s("div",{staticClass:"confirm-buttons"},[s("span",{staticClass:"finishdraw",on:{click:function(e){t.$emit("changeMpp",t.userMpp),t.curRoi.path.remove(),t.curRoi=null,t.knew=!1}}},[t._v("\n            确认")]),t._v(" "),s("span",{on:{click:function(e){t.$emit("changeMpp",!1),t.curRoi.path.remove(),t.curRoi=null,t.knew=!1}}},[t._v("\n            取消")])])]):t._e()],2)},staticRenderFns:[]};var w=function(t){i("Ge5h"),i("CmpE")},k=i("VU/8")(b.a,C,!1,w,"data-v-24b44663",null).exports,x={data(){return{isShow:-1===this.slice.filename.indexOf("痕"),isDaTi:-1===this.slice.filename.indexOf("体"),esdRoiList:[],esdSliceList:[],inputValue:""}},methods:{checkall(){let t=this.roilist.every(t=>!!t.image);this.roilist.forEach(e=>this.$set(e,"image",t?0:1)),this.$emit("closecontextmenu")},del(t){this.$confirm(this.$t("analaysisPanel.delete"),{confirmButtonText:this.$t("confirm.confirm"),cancelButtonText:this.$t("confirm.quit"),type:"warning"}).then(()=>this.$emit("delRoi",t),t=>t)},noEmoji(t){t.target.value=t.target.value.replace(/[^\u0020-\u007E\u00A0-\u00BE\u2E80-\uA4CF\uF900-\uFAFF\uFE30-\uFE4F\uFF00-\uFFEF\u0080-\u009F\u2000-\u201f\u2026\u2022\u20ac\r\n]/g,"")},inputKeydown(t,e){this.inputValue=e},inputBlur(t,e,i){""===e.toString().trim()&&(this.roilist[i].name=this.inputValue)},inputBlur2(t,e,i){""===e.toString().trim()&&(this.esdSliceList[i].name=this.inputValue)},selectRoi(t){var e,i=[];this.record.slices.filter(t=>-1===t.name.indexOf("痕")&&-1===t.name.indexOf("体")).forEach(t=>{i=[...i,...t.roilist]}),e=i.filter(t=>"rectangle"===t.method),0!==t.image&&void 0!==t.image||0===e.length?(this.$set(t,"image",1-(t.image||0)),this.$emit("closecontextmenu"),this.$emit("chooseSFB",{flag:t.image,id:t.id})):this.$message({message:"已经选择了镜下所见图，请检查",type:"warning"})}},props:["roilist","currentRois","slice","record"],watch:{slices:{handler(t){console.log(t)},deep:!0}},mounted(){this.esdRoiList=this.roilist.filter(t=>"circlepen"===t.method),this.esdSliceList=this.roilist.filter(t=>"freepen"===t.method)},beforeUpdate(){this.esdRoiList=this.roilist.filter(t=>"circlepen"===t.method),this.esdSliceList=this.roilist.filter(t=>"freepen"===t.method)}},$={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"roi"},[t.isDaTi?i("div",{directives:[{name:"show",rawName:"v-show",value:!t.isShow,expression:"!isShow"}]},[i("div",{staticClass:"topMark"},[t._m(0),t._v(" "),i("div",{staticClass:"center"},[t._v("\n                "+t._s(t.$t("slice.cutName"))+"\n            ")]),t._v(" "),i("div",{staticClass:"center"},[t._v("\n                "+t._s(t.$t("slice.cutRemark"))+"\n            ")]),t._v(" "),i("div",{staticClass:"center"},[t._v("\n                "+t._s(t.$t("slice.lesionRemark"))+"\n            ")]),t._v(" "),i("div",{staticClass:"right"},[t._v("\n                "+t._s(t.$t("analyze.opration"))+"\n            ")])]),t._v(" "),i("div",{staticClass:"rois"},t._l(t.roilist,function(e,s){return i("div",{key:s,staticClass:"row",class:{curRoi:t.currentRois[e.id]},on:{click:function(i){t.$emit("curROI",e,i.shiftKey),t.$emit("closecontextmenu")}}},[t._m(1,!0),t._v(" "),i("div",{staticClass:"center"},[i("input",{directives:[{name:"model",rawName:"v-model",value:e.name,expression:"roi.name"}],attrs:{type:"text",placeholder:t.$t("slice.input"),maxlength:"300",title:e.name},domProps:{value:e.name},on:{blur:function(i){return t.inputBlur(i,e.name,s)},keydown:[function(i){return t.inputKeydown(i,e.name)},function(e){if(!e.type.indexOf("key")&&t._k(e.keyCode,"delete",[8,46],e.key,["Backspace","Delete","Del"]))return null;e.stopPropagation()}],input:[function(i){i.target.composing||t.$set(e,"name",i.target.value)},t.noEmoji]}})]),t._v(" "),i("div",{staticClass:"center"},[i("input",{directives:[{name:"model",rawName:"v-model.lazy",value:e.shearRemark,expression:"roi.shearRemark",modifiers:{lazy:!0}}],attrs:{type:"text",placeholder:t.$t("slice.input"),maxlength:"300",title:e.shearRemark},domProps:{value:e.shearRemark},on:{keydown:function(e){if(!e.type.indexOf("key")&&t._k(e.keyCode,"delete",[8,46],e.key,["Backspace","Delete","Del"]))return null;e.stopPropagation()},input:t.noEmoji,change:function(i){return t.$set(e,"shearRemark",i.target.value)}}})]),t._v(" "),i("div",{staticClass:"center"},[i("input",{directives:[{name:"model",rawName:"v-model.lazy",value:e.lesionRemark,expression:"roi.lesionRemark",modifiers:{lazy:!0}}],attrs:{type:"text",placeholder:t.$t("slice.input"),maxlength:"300",title:e.lesionRemark},domProps:{value:e.lesionRemark},on:{keydown:function(e){if(!e.type.indexOf("key")&&t._k(e.keyCode,"delete",[8,46],e.key,["Backspace","Delete","Del"]))return null;e.stopPropagation()},input:t.noEmoji,change:function(i){return t.$set(e,"lesionRemark",i.target.value)}}})]),t._v(" "),i("div",{staticClass:"right"},[i("em",{attrs:{title:t.$t("upload.delete")},on:{click:function(i){return i.stopPropagation(),t.del(e)}}})])])}),0)]):t._e(),t._v(" "),t.isDaTi?i("div",{directives:[{name:"show",rawName:"v-show",value:t.isShow,expression:"isShow"}]},[i("div",{staticClass:"topSlice"},[t._m(2),t._v(" "),i("div",{staticClass:"center"},[t._v("\n                "+t._s(t.$t("slice.tissueStrip"))+"\n            ")]),t._v(" "),i("div",{staticClass:"center"},[t._v("\n                "+t._s(t.$t("slice.regionalRemark"))+"\n            ")]),t._v(" "),i("div",{staticClass:"center"},[t._v("\n                "+t._s(t.$t("slice.lesionNumber"))+"\n            ")]),t._v(" "),i("div",{staticClass:"center"},[t._v("\n                "+t._s(t.$t("slice.lesionRemark"))+"\n            ")]),t._v(" "),i("div",{staticClass:"right"},[t._v("\n                "+t._s(t.$t("analyze.opration"))+"\n            ")])]),t._v(" "),i("div",{staticClass:"rois"},t._l(t.esdSliceList,function(e,s){return i("div",{key:s},[i("div",{staticClass:"row",class:{curRoi:t.currentRois[e.id]},on:{click:function(i){t.$emit("curROI",e,i.shiftKey),t.$emit("closecontextmenu")}}},[t._m(3,!0),t._v(" "),i("div",{staticClass:"center"},[i("input",{directives:[{name:"model",rawName:"v-model",value:e.name,expression:"roi.name"}],attrs:{type:"text",placeholder:t.$t("slice.input"),maxlength:"300",title:e.name},domProps:{value:e.name},on:{blur:function(i){return t.inputBlur2(i,e.name,s)},keydown:[function(i){return t.inputKeydown(i,e.name)},function(e){if(!e.type.indexOf("key")&&t._k(e.keyCode,"delete",[8,46],e.key,["Backspace","Delete","Del"]))return null;e.stopPropagation()}],input:[function(i){i.target.composing||t.$set(e,"name",i.target.value)},t.noEmoji]}})]),t._v(" "),i("div",{staticClass:"center"},[i("input",{directives:[{name:"model",rawName:"v-model.lazy",value:e.tD,expression:"roi.tD",modifiers:{lazy:!0}}],attrs:{type:"text",placeholder:t.$t("slice.input"),maxlength:"300",title:e.tD,disabled:"disabled"},domProps:{value:e.tD},on:{keydown:function(e){if(!e.type.indexOf("key")&&t._k(e.keyCode,"delete",[8,46],e.key,["Backspace","Delete","Del"]))return null;e.stopPropagation()},input:t.noEmoji,change:function(i){return t.$set(e,"tD",i.target.value)}}})]),t._v(" "),i("div",{staticClass:"center"}),t._v(" "),i("div",{staticClass:"center"}),t._v(" "),i("div",{staticClass:"right"},[i("em",{attrs:{title:t.$t("upload.delete")},on:{click:function(i){return i.stopPropagation(),t.del(e)}}})])]),t._v(" "),t._l(e.esdMessage,function(e,s){return i("div",{key:s,staticClass:"row",class:{curRoi:t.currentRois[e.id]},on:{click:function(i){t.$emit("curROI",t.esdRoiList.find(function(t){return t.id==e.id}),i.shiftKey),t.$emit("closecontextmenu")}}},[i("div",{staticClass:"left"},[i("div",[i("span",{staticClass:"uncheck",class:{checked:e.image},on:{click:function(i){return i.stopPropagation(),t.selectRoi(e)}}})])]),t._v(" "),i("div",{staticClass:"center"}),t._v(" "),i("div",{staticClass:"center"}),t._v(" "),i("div",{staticClass:"center"},[i("input",{directives:[{name:"model",rawName:"v-model.lazy",value:e.name,expression:"esd.name",modifiers:{lazy:!0}}],attrs:{type:"text",placeholder:t.$t("slice.input"),maxlength:"300",title:e.name},domProps:{value:e.name},on:{keydown:function(e){if(!e.type.indexOf("key")&&t._k(e.keyCode,"delete",[8,46],e.key,["Backspace","Delete","Del"]))return null;e.stopPropagation()},input:t.noEmoji,change:function(i){return t.$set(e,"name",i.target.value)}}})]),t._v(" "),i("div",{staticClass:"center"},[i("input",{directives:[{name:"model",rawName:"v-model.lazy",value:e.iD,expression:"esd.iD",modifiers:{lazy:!0}}],attrs:{type:"text",placeholder:t.$t("slice.input"),maxlength:"300",title:e.iD,disabled:"disabled"},domProps:{value:e.iD},on:{keydown:function(e){if(!e.type.indexOf("key")&&t._k(e.keyCode,"delete",[8,46],e.key,["Backspace","Delete","Del"]))return null;e.stopPropagation()},input:t.noEmoji,change:function(i){return t.$set(e,"iD",i.target.value)}}})]),t._v(" "),i("div",{staticClass:"right"},[i("em",{attrs:{title:t.$t("upload.delete")},on:{click:function(i){i.stopPropagation(),t.del(t.esdRoiList.find(function(t){return t.id==e.id}))}}})])])})],2)}),0)]):t._e()])},staticRenderFns:[function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"left"},[e("div")])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"left"},[e("div")])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"left"},[e("div")])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"left"},[e("div")])}]};var I=i("VU/8")(x,$,!1,function(t){i("Q+67")},"data-v-2e684d87",null).exports,O=(i("OMJi"),{data(){return{centerRegion:null,curRois:{},position:{offx:this.slice.position?this.slice.position.offx:.5,offy:this.slice.position?this.slice.position.offy:.5*this.slice.height/this.slice.width,zoom:this.slice.position?this.slice.position.zoom:null}}},methods:{importJson(t){var e=this.$refs.importJson;e.onchange=(()=>{var t=new FileReader;t.readAsText(e.files[0],"UTF-8"),t.onload=(e=>{var i=JSON.parse(t.result);if(!i||!i.roilist||!i.roilist.length)return this.$alert("没有roi list");this.slice.roilist=i.roilist&&i.roilist.map(t=>({id:(Math.random()+"").substr(2,6),path:t.path,remark:t.remark,method:t.path.x.length>5?"freepen":"rectangle"}))})}),e.click()},noEmoji(t){t.target.value=t.target.value.replace(/[^\u0020-\u007E\u00A0-\u00BE\u2E80-\uA4CF\uF900-\uFAFF\uFE30-\uFE4F\uFF00-\uFFEF\u0080-\u009F\u2000-\u201f\u2026\u2022\u20ac\r\n]/g,"")},curROIChange(t,e){var i;t?t.length?i=t:e&&this.curRois[t.id]?(delete this.curRois[t.id],i=[]):i=[t]:i=[],this.curRois=Object.assign({},e&&this.curRois||{},...i.map(t=>({[t.id]:t}))),this.slice.roilist.forEach(t=>{this.curRois[t.id]&&this.$set(t,"path",this.curRois[t.id].path)})},listChangeCurrent(){var t=[].concat.apply([],Object.values(this.curRois).map(t=>t.path.x)),e=[].concat.apply([],Object.values(this.curRois).map(t=>t.path.y));t.length?this.centerRegion=[Math.min.apply(null,t),Math.min.apply(null,e),Math.max.apply(null,t),Math.max.apply(null,e)]:this.centerRegion=null},changeEsdRoiColoe(t,e,i){this.slice.roilist.forEach(s=>{s.id===i&&(s.color=t),"freepen"==s.method&&s.esdMessage&&s.esdMessage.forEach(s=>{s.id==i&&(s.color=t,s.title=e)})})},draw(t){"rectangle"!==t.method&&(t.id=(Math.random()+"").substr(2,6)),this.slice.roilist=[...this.slice.roilist,t]},addMeasure(t,e,i){this.slice[i]?this.slice[i].push({length:t,id:e}):this.slice[i]=[{length:t,id:e}]},addEsdMes(t,e){this.slice.roilist.forEach(i=>{i.id===t&&"freepen"===i.method&&(i.esdMessage?i.esdMessage.push(e):this.$set(i,"esdMessage",[e]))})},clickDraw(t,e){var i=60,s=t.x,n=t.y,a={id:(Math.random()+"").substr(2,6),path:{x:[s-i,s+i,s+i,s-i],y:[n-i,n-i,n+i,n+i]},width:3,method:"rectangle"};this.slice.roilist=[...this.slice.roilist,a],this.curROIChange(a,e)},addSignLineArr(t){this.record.signLineArr=t},reverseRoi(t){if(t&&this.slice.roilist.map(e=>{e.id===t.id&&(e.path.x.reverse(),e.path.y.reverse())}),this.record.signLineArr){for(var e in this.record.signLineArr)this.record.signLineArr[e].forEach(t=>{t.remove()});this.$refs.esdDargon.mapping()}},chooseSFB(t){this.$refs.esdDargon.chooseSFB(t)},async delCurRoi(t){if(t){if("circlepen"===t.method){for(var e=0;e<this.slice.roilist.length;e++)"freepen"===this.slice.roilist[e].method&&(this.slice.roilist[e].esdMessage=this.slice.roilist[e].esdMessage.filter(e=>e.id!==t.id));var i=this.slice.roilist.find(e=>e.id==="rectangle"+t.id);i&&(this.slice.roilist=this.slice.roilist.filter(t=>t.id!=i.id))}"freepen"===t.method&&t.esdMessage&&0!==t.esdMessage.length&&t.esdMessage.forEach(t=>{for(var e=0;e<this.slice.roilist.length;e++)if(this.slice.roilist[e].id==t.id){this.slice.roilist.splice(e,1);var i=this.slice.roilist.find(e=>e.id==="rectangle"+t.id);i&&(this.slice.roilist=this.slice.roilist.filter(t=>t.id!=i.id))}}),"signpen"===t.method&&this.record.signLineArr&&this.record.signLineArr[t.id]&&this.record.signLineArr[t.id].forEach(t=>{t.remove()}),"measure"===t.method&&(this.slice.measure=this.slice.measure.filter(e=>e.id!=t.id)),"level_measure"===t.method&&(this.slice.level_measure=this.slice.level_measure.filter(e=>e.id!=t.id)),"verticl_measure"===t.method&&(this.slice.verticl_measure=this.slice.verticl_measure.filter(e=>e.id!=t.id)),this.slice.roilist=this.slice.roilist.filter(e=>e.id!=t.id),this.curRois[t.id]&&(delete this.curRois[t.id],this.curRois=Object.assign({},this.curRois))}else{await this.$confirm(this.$t("analaysisPanel.delete"),{confirmButtonText:this.$t("confirm.confirm"),cancelButtonText:this.$t("confirm.quit"),type:"warning"}).catch(()=>{})&&(this.slice.roilist=this.slice.roilist.filter(t=>!this.curRois[t.id]),this.curRois={})}},async keydown(t){"Delete"!=t.key&&"Backspace"!=t.key||!Object.keys(this.curRois).length||await this.$confirm(this.$t("analaysisPanel.delete"),{confirmButtonText:this.$t("confirm.confirm"),cancelButtonText:this.$t("confirm.quit"),type:"warning"}).catch(()=>{})&&this.slice.roilist.filter(t=>this.curRois[t.id]).forEach(t=>{this.delCurRoi(t)})}},mounted(){},props:["slice","record"],components:{"v-dragon":k,"v-roi":I}}),A={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"cnt",attrs:{tabIndex:0},on:{keydown:t.keydown,keypress:function(e){return(e.type.indexOf("key")||9===e.keyCode)&&e.ctrlKey?t.importJson(e):null}}},[i("div",{staticClass:"analyright"},[i("v-dragon",{ref:"esdDargon",staticClass:"dragon",attrs:{record:t.record,slice:t.slice,roilist:t.slice.roilist.map(function(t){return Object.assign({},t)}),curRois:t.curRois,centerRegion:t.centerRegion,position:t.position},on:{curROI:t.curROIChange,draw:t.draw,addMeasure:t.addMeasure,changeEsdRoiColoe:t.changeEsdRoiColoe,addEsdMes:t.addEsdMes,clickDraw:t.clickDraw,delRoi:function(e){return t.delCurRoi(e)},reverseRoi:function(e){return t.reverseRoi(e)},addSignLineArr:function(e){return t.addSignLineArr(e)},position:function(e,i,s){t.$set(t.position,"offx",e),t.$set(t.position,"offy",i),t.$set(t.position,"zoom",s),t.$set(t.slice,"position",t.position)}}})],1),t._v(" "),i("div",{staticClass:"analylist"},[i("h2",[i("span",{staticClass:"noauto"},[t._v(t._s(t.$t("analyze.roi")))])]),t._v(" "),i("v-roi",{attrs:{record:t.record,roilist:t.slice.roilist,currentRois:t.curRois,slice:t.slice},on:{curROI:function(e,i){return t.curROIChange(e,i)+t.listChangeCurrent()},delRoi:function(e){return t.delCurRoi(e)},chooseSFB:function(e){return t.chooseSFB(e)}}}),t._v(" "),i("div",{staticClass:"opinio"},[i("h1",[t._v("\n                "+t._s(t.$t("report.remark"))+"\n            ")]),t._v(" "),i("textarea",{directives:[{name:"model",rawName:"v-model",value:t.record.opinion,expression:"record.opinion"}],attrs:{placeholder:t.$t("report.pointremind"),maxlength:"300"},domProps:{value:t.record.opinion},on:{input:[function(e){e.target.composing||t.$set(t.record,"opinion",e.target.value)},t.noEmoji]}})])],1),t._v(" "),i("input",{ref:"importJson",staticStyle:{visibility:"hidden"},attrs:{type:"file"}})])},staticRenderFns:[]};var M=i("VU/8")(O,A,!1,function(t){i("4FYi")},"data-v-fbcb1d3a",null).exports,S={data(){return{loopHandler:0,auto:!0,centerRegion:null,curRois:{},showbutton:!0,position:{offx:this.slice.position?this.slice.position.offx:.5,offy:this.slice.position?this.slice.position.offy:.5*this.slice.height/this.slice.width,zoom:this.slice.position?this.slice.position.zoom:null},lineup:null,totalArea:"",showMppGuide:!1,drawMpp:null,parentId:"",leftRoilist:[],rightRoilist:[],cellsegList:[]}},methods:{async getRoi(t){let{x1:e,y1:i,x2:n,y2:a,z:o}=t;this.curLevel={x:[e,n],y:[i,a],z:o},this.leftRoilist=[...await Object(s.n)(this.record.id,this.slice.id,this.curLevel,"cellseg")]},async roiChanged(t,e){let i;i=e?e.map(e=>({id:e.id,[t]:e[t],area_id:e.area_id})):Object.values(this.curRois).map(e=>({id:e.id,[t]:e[t],area_id:e.area_id})),await Object(s.e)(this.record.id,this.slice.id,this.slice.toolType,i,this.$refs.osd.scope),this.aiFatherRois=await Object(s.p)(this.record.id,this.slice.id,"cellseg"),this.rightRoilist=await Object(s.p)(this.record.id,this.slice.id),this.leftRoilist=await Object(s.n)(this.record.id,this.slice.id,this.curLevel,"cellseg"),Object.keys(this.curRois).map(t=>{this.leftRoilist.some(e=>e.id==t)||(delete this.curRois[t],this.curRois=Object.assign({},this.curRois))})},exponentialToNormal:t=>t.split("e")[0]+"*10^"+t.split("e")[1].replace("+",""),isDrawMpp(){/\.(png|jpg|jpeg|tiff|tif|bmp)$/.test(this.slice.filename)?this.showMppGuide=!0:this.startAnalyze()},noEmoji(t){t.target.value=t.target.value.replace(/[^\u0020-\u007E\u00A0-\u00BE\u2E80-\uA4CF\uF900-\uFAFF\uFE30-\uFE4F\uFF00-\uFFEF\u0080-\u009F\u2000-\u201f\u2026\u2022\u20ac\r\n]/g,"")},curROIChange(t,e){var i;!t||"grey"==t.color&&this.totalArea>1e5?(i=[],this.totalArea=0):t.length?i=t:e&&this.curRois[t.id]?(delete this.curRois[t.id],i=[]):i=[t],this.curRois=Object.assign({},e&&this.curRois,...i.map(t=>"red"==t.color||"grey"==t.color?{[t.id]:Object.assign({},t,{editable:!1})}:{[t.id]:t})),this.slice.roilist.forEach(t=>{this.curRois[t.id]&&this.$set(t,"path",this.curRois[t.id].path)})},listChangeCurrent(){var t=[].concat.apply([],Object.values(this.curRois).map(t=>t.path.x)),e=[].concat.apply([],Object.values(this.curRois).map(t=>t.path.y));t.length?this.centerRegion=[Math.min.apply(null,t),Math.min.apply(null,e),Math.max.apply(null,t),Math.max.apply(null,e)]:this.centerRegion=null},getArea(t){if(t.area)return t.area;for(var e=0,i=0;i<t.x.length-2;i++){if(i+2<t.x.length)var s=[t.x[0],t.y[0]],n=[t.x[i+1],t.y[i+1]],a=[t.x[i+2],t.y[i+2]];e+=(Math.abs(s[0]*n[1])+Math.abs(n[0]*a[1])+Math.abs(a[0]*s[1])-Math.abs(s[0]*a[1])-Math.abs(n[0]*s[1])-Math.abs(a[0]*n[1]))/2}return t.area=Math.round(Math.abs(e)*Math.pow(this.slice.mppx||.242042,2))},draw(t){this.totalArea=this.getArea(t.path);for(var e=0;e<this.slice.cellseg.result.length;e++)this.totalArea+=this.getArea(this.slice.cellseg.result[e].path);if(t.id=(Math.random()+"").substr(2,6),"freepen"===t.method&&(t.simplify=2),this.auto){if(this.totalArea>1e5)return void this.$message({message:"ROI总面积不能大于0.1mm²",type:"warning"});this.slice.cellseg.result?this.slice.cellseg.result=[...this.slice.cellseg.result,t]:(this.slice.cellseg.result=[],this.slice.cellseg.result=[...this.slice.cellseg.result,t])}else this.slice.roilist=[...this.slice.roilist,t]},async delCurRoi(t){this.showbutton?t?(await Object(s.i)(this.record.id,this.slice.id,this.slice.toolType,[t.id],this.$refs.osd.scope),this.curRois[t.id]&&(delete this.curRois[t.id],this.curRois=Object.assign({},this.curRois)),1===t.mark_type&&(this.rightRoilist=await Object(s.p)(this.record.id,this.slice.id)),this.leftRoilist=await Object(s.n)(this.record.id,this.slice.id,this.curLevel,"cellseg")):await this.$confirm(this.$t("analaysisPanel.delete"),{confirmButtonText:this.$t("confirm.confirm"),cancelButtonText:this.$t("confirm.quit"),type:"warning"}).catch(()=>{})&&(await Object(s.i)(this.record.id,this.slice.id,this.slice.toolType,Object.keys(this.curRois),this.$refs.osd.scope),[...new Set(Object.values(this.curRois).map(t=>t.mark_type))].map(async t=>{1===t?this.rightRoilist=await Object(s.p)(this.record.id,this.slice.id):this.aiFatherRois=await Object(s.p)(this.record.id,this.slice.id,"cellseg")}),this.curRois={},this.leftRoilist=await Object(s.n)(this.record.id,this.slice.id,this.curLevel,"cellseg")):this.$message.error("处理中无法删除")},getAlgorithmResult(t=this.record.id,e=this.slice.id,i=this.slice.filename){Object(s.b)("ai/getresult",{caseid:t,fileid:e,filename:i,type:"cellseg",other:JSON.stringify((this.slice.cellseg.result?this.slice.cellseg.result:[]).map(t=>({id:t.id,x:t.path.x,y:t.path.y})))}).then(t=>{if(this.lineup=t.data.rank,t.data.done){if(this.showbutton=!0,this.loopHandler=0,this.$set(this.slice,"type","cellseg"),-1!=t.data.rank)this.slice.cellseg.diagnosis=this.flag="error";else{Object.keys(t.data.result).filter(t=>!this.slice.cellseg.result.find(e=>e.id==t)).map(e=>delete t.data.result[e]);var e=Object.values(t.data.result).map((e,i)=>e.map(e=>e.fatherid=Object.keys(t.data.result)[i]))&&[...[].concat(...Object.values(t.data.result))].map(t=>({path:t,id:(Math.random()+"").substr(2,8),editable:!1,fatherid:t.fatherid}));this.$set(this.slice.cellseg,"airesult",e),this.$set(this.slice.cellseg,"diagnosis",1)}this.updateRecord()}else this.showbutton=!1,this.loopHandler=setTimeout(()=>this.getAlgorithmResult(),5e3)})},async startAnalyze(t=this.record.id,e=this.slice.id,i=this.slice.filename){this.slice.cellseg.result&&0!=this.slice.cellseg.result.length?(this.$set(this.slice.cellseg,"airesult",[]),this.$set(this.slice.cellseg,"diagnosis",null),this.slice.started=!0,this.record.started=!0,this.showbutton=!1,this.auto=!0,Object.values(this.curRois).map(t=>this.slice.roilist.every(e=>t.id!=e.id)&&this.slice.cellseg.airesult.every(e=>t.id!=e.id)?delete this.curRois[t.id]:""),await Object(s.r)(t,e,i,"cellseg",JSON.stringify(this.slice.cellseg.result.map(t=>({id:t.id,x:t.path.x,y:t.path.y})))),this.getAlgorithmResult()):this.$message({message:"请先绘制ROI,再进行处理",type:"warning"})},canceltesk(){Object(s.b)("ai/revokeTask",{caseid:this.record.id,fileid:this.slice.id,type:"cellseg",other:""}).then(t=>{0==t.code&&(clearTimeout(this.loopHandler),this.loopHandler=0,this.showbutton=!0,this.slice.started=!1,this.record.started=!1,this.updateRecord())}).catch(t=>console.log(t))},updateRecord(){this.$emit("save","auto")},keydown(t){"Delete"!=t.key&&"Backspace"!=t.key||!Object.keys(this.curRois).length||this.delCurRoi()}},beforeMount(){this.slice.cellseg||this.$set(this.slice,"cellseg",{})},async mounted(){this.slice.started&&this.slice.cellseg&&null===this.slice.cellseg.diagnosis&&this.getAlgorithmResult(),window.addEventListener("online",()=>{this.showbutton||this.getAlgorithmResult()}),this.rightRoilist=await Object(s.p)(this.record.id,this.slice.id),this.cellsegList=await Object(s.p)(this.record.id,this.slice.id,"cellseg")},beforeDestroy(){clearTimeout(this.loopHandler),this.loopHandler=0},watch:{"slice.id":{handler(){clearTimeout(this.loopHandler),this.loopHandler=0}},drawMpp:{handler(t){t&&(this.$set(this.slice,"mppx",t),this.$set(this.slice,"mppy",t),this.$emit("save","auto"),this.startAnalyze())}}},props:["slice","record"],components:{"v-dragon":v.a,"v-roi":m}},T={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"cnt",attrs:{tabIndex:0},on:{keydown:t.keydown}},[i("div",{staticClass:"analyright"},[i("v-dragon",{staticClass:"dragon",attrs:{record:t.record,slice:t.slice,roilist:t.leftRoilist,curRois:t.curRois,penColor:t.auto?"grey":"yellow",centerRegion:t.centerRegion,position:t.position,showMppGuide:t.showMppGuide,cellArea:116},on:{curROI:t.curROIChange,draw:t.draw,delRoi:function(e){return t.delCurRoi(e)},position:function(e,i,s){t.$set(t.position,"offx",e),t.$set(t.position,"offy",i),t.$set(t.position,"zoom",s),t.$set(t.slice,"position",t.position)},closeMppGuide:function(e){t.showMppGuide=!1},changeMpp:function(e){return t.drawMpp=e},getRoi:t.getRoi,roiChanged:t.roiChanged,parentId:function(e){return t.parentId=e}}}),t._v(" "),t.showbutton?i("button",{on:{click:function(e){return t.isDrawMpp()}}},[t._v(t._s(t.$t("slice.start")))]):t._e()],1),t._v(" "),i("div",{staticClass:"analylist"},[i("h2",[i("span",{class:t.auto?"auto":"",on:{click:function(e){t.auto=!0}}},[t._v(t._s(t.$t("analyze.airoi")))]),t._v(" "),i("span",{class:t.auto?"":"noauto",on:{click:function(e){t.auto=!1}}},[t._v(t._s(t.$t("analyze.roi")))])]),t._v(" "),t.auto&&this.slice.cellseg?i("v-roi",{staticClass:"automanualroi",attrs:{roilist:t.cellsegList,currentRois:t.curRois},on:{curROI:function(e,i){return t.curROIChange(e,i)+t.listChangeCurrent()},delRoi:function(e){return t.delCurRoi(e)}}}):t._e(),t._v(" "),t.auto?t._e():i("v-roi",{staticClass:"manualroi",attrs:{roilist:t.rightRoilist,currentRois:t.curRois},on:{curROI:function(e,i){return t.curROIChange(e,i)+t.listChangeCurrent()},delRoi:function(e){return t.delCurRoi(e)},roiChanged:t.roiChanged}}),t._v(" "),!t.showbutton&&t.auto?i("div",{staticClass:"loding"},[i("div",{staticClass:"video"},[i("img",{attrs:{src:"/static/video/loading.gif"}}),t._v(" "),0==t.lineup?i("div",{staticClass:"lineup"},[t._v("正在处理...")]):t._e(),t._v(" "),t.lineup>0?i("div",{staticClass:"lineup"},[t._v(t._s(t.$t("slice.lineup"))+" "),i("span",{staticStyle:{color:"#4C9FFA","font-size":"18px","font-weight":"bolder"}},[t._v(t._s(t.lineup))]),t._v(" "+t._s(t.$t("slice.position")))]):t._e()]),t._v(" "),i("div",{staticClass:"cancel",on:{click:t.canceltesk}},[t._v(t._s(t.$t("slice.cancelTasks")))])]):t._e(),t._v(" "),!this.slice.cellseg&&t.auto?i("div",{staticClass:"ifshowtables"},[t._v(t._s(t.$t("slice.noanalysis")))]):t._e(),t._v(" "),0==t.auto?i("div",{staticClass:"opinio"},[i("h1",[t._v("\n                "+t._s(t.$t("analyze.point"))+"\n            ")]),t._v(" "),i("textarea",{directives:[{name:"model",rawName:"v-model",value:t.record.opinion,expression:"record.opinion"}],attrs:{placeholder:t.$t("report.pointremind"),maxlength:"300"},domProps:{value:t.record.opinion},on:{input:[function(e){e.target.composing||t.$set(t.record,"opinion",e.target.value)},t.noEmoji]}})]):t._e()],1)])},staticRenderFns:[]};var F=i("VU/8")(S,T,!1,function(t){i("F6vc")},"data-v-7a1c2d94",null).exports,j={data:()=>({}),methods:{changeImage(t){this.$set(t,"image",1-(t.image||0)),this.$emit("roiChanged","image",[t])},checkall(){if(!this.ROIS.length)return;let t=this.ROIS.every(t=>!!t.image),e=this.ROIS.map(e=>{return{id:e.id,image:t?0:1}});this.$emit("roiChanged","image",e)},del(t){this.$confirm(this.$t("analaysisPanel.delete"),{confirmButtonText:this.$t("confirm.confirm"),cancelButtonText:this.$t("confirm.quit"),type:"warning"}).then(()=>{this.$emit("delRoi",t)},()=>{})}},props:["ROIS","currentRois","slice","ave"]},E={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"ki67rois"},[t.ROIS.length?t._e():i("div",{staticClass:"ifshowtables"},[t._v(t._s(t.$t("slice.noanalysis")))]),t._v(" "),t.ROIS?i("div",{staticClass:"table"},[i("div",{staticClass:"top"},[i("div",{staticClass:"left"},[i("div",[i("span",{staticClass:"uncheck",class:{checked:t.ROIS.every(function(t){return!!t.image})},on:{click:t.checkall}}),t._v("\n                    ROI\n                ")])]),t._v(" "),i("div",{staticClass:"center"},[t._v(t._s(t.$t("slice.total")))]),t._v(" "),i("div",[t._v(t._s(t.$t("slice.deleted")))])]),t._v(" "),i("div",{staticClass:"rois"},t._l(t.ROIS,function(e,s){return i("div",{key:s,staticClass:"row",class:{curRoi:t.currentRois[e.id]},on:{click:function(i){return t.$emit("curROI",e,i.shiftKey)}}},[i("div",{staticClass:"left"},[i("div",[i("span",{staticClass:"uncheck",class:{checked:e.image},on:{click:function(i){return i.stopPropagation(),t.changeImage(e)}}}),t._v("\n                        "+t._s(s+1)+"\n                    ")])]),t._v(" "),i("div",{staticClass:"center"},[t._v(t._s(e.aiResult.total))]),t._v(" "),i("div",[i("em",{attrs:{title:t.$t("upload.delete")},on:{click:function(i){return i.stopPropagation(),t.del(e)}}})])])}),0)]):t._e(),t._v(" "),t.ROIS?i("div",{staticClass:"ki67btm"},[t._v("总数：\n        "),i("span",[t._v("\n            "+t._s(t.ROIS.filter(function(t){return t.image}).map(function(t){return t.aiResult.total}).reduce(function(t,e){return t+e},0))+"\n        ")])]):t._e()])},staticRenderFns:[]};var P=i("VU/8")(j,E,!1,function(t){i("KHdC"),i("bPZ+")},null,null).exports;var D={data(){return{loopHandler:0,auto:!0,centerRegion:null,curRois:{},showbutton:!0,position:{offx:this.slice.position?this.slice.position.offx:.5,offy:this.slice.position?this.slice.position.offy:.5*this.slice.height/this.slice.width,zoom:this.slice.position?this.slice.position.zoom:null},lineup:null,showMppGuide:!1,drawMpp:null,parentId:null,curLevel:{},leftRoilist:[],rightRoilist:[],aiFatherRois:[],loading:!1}},methods:{async getRoi(t){let{x1:e,y1:i,x2:n,y2:a,z:o}=t;this.curLevel={x:[e,n],y:[i,a],z:o},this.leftRoilist=[...await Object(s.n)(this.record.id,this.slice.id,this.curLevel,"celldet")]},isDrawMpp(){/\.(png|jpg|jpeg|tiff|tif|bmp)$/.test(this.slice.filename)?this.showMppGuide=!0:this.startAnalyze()},curROIChange(t,e){var i;t?t.length?i=t:e&&this.curRois[t.id]?(delete this.curRois[t.id],i=[]):i=[t]:i=[],this.curRois=Object.assign({},e&&this.curRois,...i.filter(t=>!t.aiResult||!t.aiResult.whole_slide).map(t=>"grey"==t.strokeColor?{[t.id]:Object.assign({},t,{editable:0})}:{[t.id]:t}))},async roiChanged(t,e){let i;i=e?e.map(e=>({id:e.id,[t]:e[t],area_id:e.area_id})):Object.values(this.curRois).map(e=>({id:e.id,[t]:e[t],area_id:e.area_id}));let n="image"==t||"remark"==t?null:this.$refs.osd.scope;n&&n.offset&&(this.curRois={},this.$refs.osd.scope=null),n?this.$message.error("不支持多选移动"):await Object(s.e)(this.record.id,this.slice.id,"celldet",i,n),this.aiFatherRois=await Object(s.p)(this.record.id,this.slice.id,"celldet"),this.rightRoilist=await Object(s.p)(this.record.id,this.slice.id),this.leftRoilist=await Object(s.n)(this.record.id,this.slice.id,this.curLevel,"celldet"),Object.keys(this.curRois).map(t=>{this.leftRoilist.some(e=>e.id==t)||(delete this.curRois[t],this.curRois=Object.assign({},this.curRois))})},listChangeCurrent(){if(Object.keys(this.curRois).length){var t=[].concat.apply([],Object.values(this.curRois).map(t=>t.path.x)),e=[].concat.apply([],Object.values(this.curRois).map(t=>t.path.y));t.length?this.centerRegion=[Math.min.apply(null,t),Math.min.apply(null,e),Math.max.apply(null,t),Math.max.apply(null,e)]:this.centerRegion=null,this.$refs.osd.scope=null}},async draw(t,e){t.strokeColor="yellow",t.mark_type=1,this.auto&&(t.strokeColor="grey",t.mark_type=3,t.ai_type="celldet",t.editable=0),t.id=await Object(s.h)(this.record.id,this.slice.id,t),t.id&&(this.curROIChange(t,e),this.leftRoilist=[...this.leftRoilist,t],this.rightRoilist=await Object(s.p)(this.record.id,this.slice.id),this.aiFatherRois=await Object(s.p)(this.record.id,this.slice.id,"celldet"),this.leftRoilist=await Object(s.n)(this.record.id,this.slice.id,this.curLevel,"celldet"),Object.keys(this.curRois).map(t=>{this.leftRoilist.some(e=>e.id==t)||(delete this.curRois[t],this.curRois=Object.assign({},this.curRois))}))},async delCurRoi(t){if(this.showbutton)if(t){for(var e in this.loading=!0,await Object(s.i)(this.record.id,this.slice.id,"celldet",[t.id],null),this.loading=!1,this.curRois)this.curRois[e].area_id==t.id&&(delete this.curRois[e],this.curRois=Object.assign({},this.curRois));this.curRois[t.id]&&(delete this.curRois[t.id],this.curRois=Object.assign({},this.curRois)),3===t.mark_type&&(this.aiFatherRois=await Object(s.p)(this.record.id,this.slice.id,"celldet")),1===t.mark_type&&(this.rightRoilist=await Object(s.p)(this.record.id,this.slice.id)),this.leftRoilist=await Object(s.n)(this.record.id,this.slice.id,this.curLevel,"celldet")}else{await this.$confirm(this.$t("analaysisPanel.delete"),{confirmButtonText:this.$t("confirm.confirm"),cancelButtonText:this.$t("confirm.quit"),type:"warning"}).catch(()=>{})&&(this.loading=!0,await Object(s.i)(this.record.id,this.slice.id,"celldet",Object.keys(this.curRois),this.$refs.osd.scope),this.loading=!1,[...new Set(Object.values(this.curRois).map(t=>t.mark_type))].map(async t=>{1===t?this.rightRoilist=await Object(s.p)(this.record.id,this.slice.id):this.aiFatherRois=await Object(s.p)(this.record.id,this.slice.id,"celldet")}),this.curRois={},this.leftRoilist=await Object(s.n)(this.record.id,this.slice.id,this.curLevel,"celldet"))}else this.$message.error("处理中无法删除")},getAlgorithmResult(t=this.record.id,e=this.slice.id,i=this.slice.filename){let n=this.aiFatherRois.filter(t=>!t.aiResult.whole_slide).map(t=>({id:t.id,x:t.path.x,y:t.path.y}));Object(s.b)("ai/getresult",{caseid:t,fileid:e,filename:i,type:"celldet",other:JSON.stringify(n)}).then(async t=>{this.lineup=t.data.rank,t.data.done?(this.showbutton=!0,this.loopHandler=0,-1==t.data.rank&&(this.leftRoilist=await Object(s.n)(this.record.id,this.slice.id,this.curLevel,"celldet"),this.aiFatherRois=await Object(s.p)(this.record.id,this.slice.id,"celldet")),this.$set(this.slice,"ai_dict",Object.assign(this.slice.ai_dict,{celldetStarted:!1}))):(this.showbutton=!1,this.loopHandler=setTimeout(()=>this.getAlgorithmResult(),5e3))})},startAnalyze(){this.aiFatherRois.length&&this.aiFatherRois.some(t=>t.aiResult.whole_slide)?this.$confirm("一旦开始，将清空当前的全场图算法结果，确认要开始吗？",{confirmButtonText:this.$t("confirm.confirm"),cancelButtonText:this.$t("confirm.quit"),type:"warning"}).then(async()=>{let t=this.aiFatherRois.filter(t=>t.aiResult.whole_slide).map(t=>t.id);this.loading=!0,await Object(s.i)(this.record.id,this.slice.id,"celldet",t,this.$refs.osd.scope),this.loading=!1,this.aiFatherRois=await Object(s.p)(this.record.id,this.slice.id,"celldet"),this.start()}).catch(()=>{}):this.start()},async start(t=this.record.id,e=this.slice.id,i=this.slice.filename){let n=this.aiFatherRois.filter(t=>!t.aiResult.whole_slide).map(t=>({id:t.id,x:t.path.x,y:t.path.y}));this.$set(this.slice,"ai_dict",Object.assign(this.slice.ai_dict,{celldetStarted:!0})),this.showbutton=!1,this.auto=!0,this.aiFatherRois.map(t=>t.image=1),await Object(s.e)(this.record.id,this.slice.id,"celldet",this.aiFatherRois.map(t=>({id:t.id,image:t.image})),null),await Object(s.r)(t,e,i,"celldet",JSON.stringify(n)),this.curRois={},this.leftRoilist=await Object(s.n)(this.record.id,this.slice.id,this.curLevel,"celldet"),this.aiFatherRois=await Object(s.p)(this.record.id,this.slice.id,"celldet"),Object.values(this.curRois).map(t=>this.leftRoilist.every(e=>t.id!=e.id)?delete this.curRois[t.id]:""),this.getAlgorithmResult()},canceltesk(){Object(s.b)("ai/revokeTask",{caseid:this.record.id,fileid:this.slice.id,type:"celldet",other:""}).then(async t=>{0==t.code&&(clearTimeout(this.loopHandler),this.loopHandler=0,this.showbutton=!0,this.$set(this.slice,"ai_dict",Object.assign(this.slice.ai_dict,{celldetStarted:!1})),this.aiFatherRois.map(t=>t.image=0),await Object(s.e)(this.record.id,this.slice.id,"celldet",this.aiFatherRois.map(t=>({id:t.id,image:t.image})),null))}).catch(t=>console.log(t))},updateRecord(){this.$emit("save")},keydown(t){"Delete"!=t.key&&"Backspace"!=t.key||!Object.keys(this.curRois).length||this.delCurRoi()}},async mounted(){this.slice.ai_dict.celldetStarted&&this.getAlgorithmResult(),window.addEventListener("online",()=>{this.showbutton||this.getAlgorithmResult()}),this.rightRoilist=await Object(s.p)(this.record.id,this.slice.id),this.aiFatherRois=await Object(s.p)(this.record.id,this.slice.id,"celldet")},beforeDestroy(){clearTimeout(this.loopHandler),this.loopHandler=0},watch:{"slice.id":{handler(){clearTimeout(this.loopHandler),this.loopHandler=0}},drawMpp:{handler(t){t&&(this.$set(this.slice,"mppx",t),this.$set(this.slice,"mppy",t),this.$emit("save"),this.startAnalyze())}}},computed:{getCommonAnnotation(){var t=Object.values(this.curRois);return t[0]&&t.every(t=>t.jgResult)&&t.every(e=>e.jgResult==t[0].jgResult)?t[0].jgResult.split(",")[0]:""}},props:["slice","record"],components:{"v-dragon":v.a,"v-analyroi":P,"v-roi":m}},L={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"cnt",attrs:{tabIndex:0},on:{keydown:t.keydown}},[i("div",{staticClass:"analyright"},[i("v-dragon",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],ref:"osd",staticClass:"dragon",attrs:{record:t.record,slice:t.slice,roilist:t.leftRoilist,curRois:t.curRois,penColor:t.auto?"grey":"yellow",centerRegion:t.centerRegion,position:t.position,showMppGuide:t.showMppGuide,cellArea:110,"element-loading-text":"处理中，请耐心等待","element-loading-spinner":"el-icon-loading","element-loading-background":"rgba(0, 0, 0, 0.5)"},on:{curROI:t.curROIChange,draw:t.draw,delRoi:function(e){return t.delCurRoi(e)},position:function(e,i,s){t.$set(t.position,"offx",e),t.$set(t.position,"offy",i),t.$set(t.position,"zoom",s),t.$set(t.slice,"position",t.position)},closeMppGuide:function(e){t.showMppGuide=!1},changeMpp:function(e){return t.drawMpp=e},getRoi:t.getRoi,roiChanged:t.roiChanged,parentId:function(e){return t.parentId=e}}}),t._v(" "),t.showbutton?i("button",{on:{click:function(e){return t.isDrawMpp()}}},[t._v(t._s(t.$t("slice.start")))]):t._e()],1),t._v(" "),i("div",{staticClass:"analylist"},[i("div",{staticClass:"quality"},[t._m(0),t._v(" "),i("div",{staticClass:"quality-detail"},[i("p",{staticStyle:{width:"50%",margin:"0"}},[t._v("清 晰 度："+t._s(t.slice.clarity?(100*t.slice.clarity).toFixed(2)+"%":"-"))]),t._v(" "),i("p",{staticStyle:{width:"50%",margin:"0"}},[t._v("扫描倍数："+t._s(t.slice.objective_rate||"-"))])])]),t._v(" "),i("h2",[i("span",{class:t.auto?"auto":"",on:{click:function(e){t.auto=!0}}},[t._v("AI处理")]),t._v(" "),i("span",{class:t.auto?"":"noauto",on:{click:function(e){t.auto=!1}}},[t._v("手动处理")])]),t._v(" "),t.auto?i("v-analyroi",{staticClass:"table",attrs:{slice:t.slice,ROIS:t.aiFatherRois,currentRois:t.curRois},on:{curROI:function(e,i){return t.curROIChange(e,i)+t.listChangeCurrent()},delRoi:function(e){return t.delCurRoi(e)},roiChanged:t.roiChanged}}):t._e(),t._v(" "),t.auto?t._e():i("v-roi",{staticClass:"manualroi",attrs:{roilist:t.rightRoilist,currentRois:t.curRois},on:{curROI:function(e,i){return t.curROIChange(e,i)+t.listChangeCurrent()},delRoi:function(e){return t.delCurRoi(e)},roiChanged:t.roiChanged}}),t._v(" "),!t.showbutton&&t.auto?i("div",{staticClass:"loding"},[i("div",{staticClass:"video"},[i("img",{attrs:{src:"/static/video/loading.gif"}}),t._v(" "),0==t.lineup?i("div",{staticClass:"lineup"},[t._v("正在处理...")]):t._e(),t._v(" "),t.lineup>0?i("div",{staticClass:"lineup"},[t._v(t._s(t.$t("slice.lineup"))+" "),i("span",{staticStyle:{color:"#4C9FFA","font-size":"18px","font-weight":"bolder"}},[t._v(t._s(t.lineup))]),t._v(" "+t._s(t.$t("slice.position")))]):t._e()]),t._v(" "),i("div",{staticClass:"cancel",on:{click:t.canceltesk}},[t._v(t._s(t.$t("slice.cancelTasks")))])]):t._e()],1)])},staticRenderFns:[function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"title"},[e("span",[this._v("AI质控")])])}]};var H=i("VU/8")(D,L,!1,function(t){i("5dg9")},"data-v-02572dec",null).exports,z={data(){return{company:Object(s.s)().company,locked:!0,centerRegion:null,curRois:{},slice2:this.record.slices.find(t=>t.id==this.slice.id2),curLevel:{},leftRoilist:[],rightRoilist:[],loading:!1,showRotateSet:!1,defaultRotate:0,currentAngle:0}},computed:{getCommonAnnotation(){var t=Object.values(this.curRois);return t[0]&&t.every(e=>e.jgResult==t[0].jgResult)?t[0].jgResult:""}},methods:{closeRotateSet(){this.showRotateSet=!1},lockOrnot(){!this.locked||this.showRotateSet?this.showRotateSet=!this.showRotateSet:this.$message.error("请先解锁")},rotate(t){this.locked?this.$message.error("请先解锁"):(this.currentAngle=t,this.$refs.osd2.viewport.setRotation(t),Object(s.b)("files/alterAngle",{caseid:this.record.id,fileid:this.slice2.id,currentAngle:this.currentAngle}).then(t=>{t.code&&this.$message.error(t.msg)}))},async getRoi(t){let{x1:e,y1:i,x2:n,y2:a,z:o}=t;this.curLevel={x:[e,n],y:[i,a],z:o},this.leftRoilist=await Object(s.n)(this.record.id,this.slice.id,this.curLevel),this.$emit("save","noListUpdate")},setPosition(t,e,i,s){var[n,a]=1==s?[this.slice.position,this.slice.position2]:[this.slice.position2,this.slice.position];if(this.locked&&n&&a&&n.zoom){var o=a.zoom/n.zoom;if(1==s){let s=(t-n.offx)*Math.cos(this.currentAngle*(Math.PI/180))/o,r=(e-n.offy)*Math.cos(this.currentAngle*(Math.PI/180))/o;Object.assign(a,{offx:s+(e-n.offy)*Math.sin(this.currentAngle*(Math.PI/180))+a.offx,offy:r+(n.offx-t)*Math.sin(this.currentAngle*(Math.PI/180))+a.offy,zoom:i*o})}else{let s=(t-n.offx)*Math.cos(this.currentAngle*(Math.PI/180))/o,r=(e-n.offy)*Math.cos(this.currentAngle*(Math.PI/180))/o;Object.assign(a,{offx:s-(e-n.offy)*Math.sin(this.currentAngle*(Math.PI/180))+a.offx,offy:r-(n.offx-t)*Math.sin(this.currentAngle*(Math.PI/180))+a.offy,zoom:i*o})}}Object.assign(n,{offx:t,offy:e,zoom:i})},showSlide(t){this.slice.id2=t,this.slice2=this.record.slices.find(e=>e.id==t);var{offx:e,offy:i,zoom:s}=this.slice.position;this.$set(this.slice,"position2",{offx:e,offy:i,zoom:s}),this.setAngle()},setAngle(){Object(s.b)("files/getAngle",{caseid:this.record.id,fileid:this.slice2.id}).then(t=>{t.code?this.$message.error(t.msg):(this.defaultRotate=t.data.aiAngle,this.currentAngle=t.data.currentAngle,this.$refs.osd2.viewport.setRotation(this.currentAngle))})},noEmoji(t){t.target.value=t.target.value.replace(/[^\u0020-\u007E\u00A0-\u00BE\u2E80-\uA4CF\uF900-\uFAFF\uFE30-\uFE4F\uFF00-\uFFEF\u0080-\u009F\u2000-\u201f\u2026\u2022\u20ac\r\n]/g,"")},curROIChange(t,e){var i;t?t.length?i=t:e&&this.curRois[t.id]?(delete this.curRois[t.id],i=[]):i=[t]:i=[],this.curRois=Object.assign({},e&&this.curRois||{},...i.map(t=>({[t.id]:t})))},async roiChanged(t,e){let i;i=e?e.map(e=>({id:e.id,[t]:e[t]})):Object.values(this.curRois).map(e=>({id:e.id,[t]:e[t]}));let n="image"==t||"remark"==t?null:this.$refs.osd.scope;n&&n.offset&&(this.curRois={},this.$refs.osd.scope=null),n?this.$message.error("不支持多选移动"):(this.loading=!0,await Object(s.e)(this.record.id,this.slice.id,"human",i,n),this.loading=!1),Object.keys(this.curRois).map(t=>{this.leftRoilist.some(e=>e.id==t)||(delete this.curRois[t],this.curRois=Object.assign({},this.curRois))}),this.leftRoilist=await Object(s.n)(this.record.id,this.slice.id,this.curLevel)},listChangeCurrent(){var t=[].concat.apply([],Object.values(this.curRois).map(t=>t.path.x)),e=[].concat.apply([],Object.values(this.curRois).map(t=>t.path.y));t.length?this.centerRegion=[Math.min.apply(null,t),Math.min.apply(null,e),Math.max.apply(null,t),Math.max.apply(null,e)]:this.centerRegion=null,this.$refs.osd.scope=null},async draw(t,e){t.strokeColor="yellow",t.mark_type=1,t.id=await Object(s.h)(this.record.id,this.slice.id,t),t.id&&(this.leftRoilist=[...this.leftRoilist,t],this.leftRoilist=await Object(s.n)(this.record.id,this.slice.id,this.curLevel),this.rightRoilist=await Object(s.p)(this.record.id,this.slice.id),this.curROIChange(t,e))},async clickDraw(t,e){var i={path:{x:[t.x],y:[t.y]},method:"spot",radius:3/(this.slice.mppx||.242042),mark_type:1,fillColor:"yellow"};i.id=await Object(s.h)(this.record.id,this.slice.id,i),i.id&&(this.leftRoilist=[...this.leftRoilist,i],this.leftRoilist=await Object(s.n)(this.record.id,this.slice.id,this.curLevel),this.rightRoilist=await Object(s.p)(this.record.id,this.slice.id),this.curROIChange(i,e))},async delCurRoi(t){t?(this.loading=!0,await Object(s.i)(this.record.id,this.slice.id,"human",[t.id],this.$refs.osd.scope),this.loading=!1,this.curRois[t.id]&&(delete this.curRois[t.id],this.curRois=Object.assign({},this.curRois)),this.leftRoilist=await Object(s.n)(this.record.id,this.slice.id,this.curLevel),this.rightRoilist=await Object(s.p)(this.record.id,this.slice.id)):await this.$confirm(this.$t("analaysisPanel.delete"),{confirmButtonText:this.$t("confirm.confirm"),cancelButtonText:this.$t("confirm.quit"),type:"warning"}).catch(()=>{})&&(this.loading=!0,await Object(s.i)(this.record.id,this.slice.id,"human",Object.keys(this.curRois).map(t=>t),this.$refs.osd.scope),this.loading=!1,this.curRois={},this.leftRoilist=await Object(s.n)(this.record.id,this.slice.id,this.curLevel),this.rightRoilist=await Object(s.p)(this.record.id,this.slice.id))},keydown(t){"Delete"!=t.key&&"Backspace"!=t.key||!Object.keys(this.curRois).length||this.delCurRoi()}},watch:{},async mounted(){this.rightRoilist=await Object(s.p)(this.record.id,this.slice.id),document.addEventListener("click",this.closeRotateSet),this.slice2&&this.setAngle()},beforeDestroy(){document.removeEventListener("click",this.closeRotateSet)},props:["slice","record"],components:{"v-dragon":v.a,"v-roi":m}},N={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"cnt",attrs:{tabIndex:0},on:{keydown:t.keydown}},[i("div",{ref:"doubleScreen",staticClass:"analyright"},[i("div",{staticClass:"left-list"},[i("v-dragon",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],ref:"osd",staticClass:"dragon",attrs:{record:t.record,slice:t.slice,roilist:t.leftRoilist,curRois:t.curRois,centerRegion:t.centerRegion,position:t.slice.position,penColor:"yellow","element-loading-text":"处理中，请耐心等待","element-loading-spinner":"el-icon-loading","element-loading-background":"rgba(0, 0, 0, 0.5)"},on:{curROI:t.curROIChange,roiChanged:t.roiChanged,draw:t.draw,clickDraw:t.clickDraw,delRoi:function(e){return t.delCurRoi(e)},position:function(e,i,s){return t.setPosition(e,i,s,1)},getRoi:t.getRoi}})],1),t._v(" "),i("div",{staticClass:"left-list right-list"},[t.slice2?t._e():i("ul",{staticClass:"img-list"},[t._l(t.record.slices.filter(function(t){return t.width}),function(e){return i("li",{key:e.id,style:"background-image:url(/aipath/api/files/thumbnail?caseid="+encodeURIComponent(t.record.id)+"&fileid="+e.id+"&companyid="+t.company+");",on:{click:function(i){return t.showSlide(e.id)}}},[i("p",{attrs:{title:e.name}},[t._v(t._s(e.name))])])}),t._v(" "),i("li",{staticClass:"itemempty"}),t._v(" "),i("li",{staticClass:"itemempty"}),t._v(" "),i("li",{staticClass:"itemempty"})],2),t._v(" "),t.slice2?i("v-dragon",{ref:"osd2",staticClass:"dragon",attrs:{record:t.record,slice:t.slice2,roilist:t.leftRoilist,currentAngle:t.currentAngle,curRois:t.curRois,centerRegion:t.centerRegion,position:t.slice.position2,penColor:"yellow"},on:{curROI:t.curROIChange,draw:t.draw,roiChanged:t.roiChanged,clickDraw:t.clickDraw,delRoi:function(e){return t.delCurRoi(e)},position:function(e,i,s){return t.setPosition(e,i,s,2)},getRoi:t.getRoi}},[i("div",{staticClass:"rotare-slide",on:{click:function(e){return e.stopPropagation(),t.lockOrnot(e)}}},[i("div",{staticClass:"img",class:{checked:t.showRotateSet}}),t._v(" "),t.showRotateSet?i("div",{staticClass:"rotate-set",on:{click:function(t){t.stopPropagation()}}},[i("h2",[t._v("图像旋转")]),t._v(" "),i("div",{staticClass:"slide-set"},[i("el-slider",{attrs:{"show-tooltip":!1,max:360},on:{change:function(e){return t.rotate(e)}},model:{value:t.currentAngle,callback:function(e){t.currentAngle=e},expression:"currentAngle"}}),t._v(" "),i("div",{staticClass:"rotate-value"},[i("div",{staticClass:"simble",on:{click:function(e){return t.rotate(t.currentAngle-1)}}},[t._v("-")]),t._v(" "),i("div",{staticClass:"ankle"},[t._v(t._s(t.currentAngle)+"°")]),t._v(" "),i("div",{staticClass:"simble",on:{click:function(e){return t.rotate(t.currentAngle+1)}}},[t._v("+")])]),t._v(" "),i("div",{staticClass:"slide-reset",on:{click:function(e){return t.rotate(t.defaultRotate)}}},[t._v("复位")])],1)]):t._e()])]):t._e(),t._v(" "),t.slice2?i("div",{staticClass:"goback",on:{click:function(e){t.slice2=null,t.curRois={}}}},[t._v("重选切片")]):t._e()],1),t._v(" "),i("div",{staticClass:"locked",class:{unlock:!t.locked},attrs:{title:t.locked?"解锁":"锁定"},on:{click:function(e){t.locked=!t.locked}}})]),t._v(" "),i("div",{staticClass:"analylist"},[i("h2",[i("span",{staticClass:"noauto"},[t._v(t._s(t.$t("analyze.roi")))])]),t._v(" "),i("v-roi",{staticClass:"manualroi",attrs:{roilist:t.rightRoilist,currentRois:t.curRois},on:{curROI:function(e,i){return t.curROIChange(e,i)+t.listChangeCurrent()},delRoi:function(e){return t.delCurRoi(e)},roiChanged:t.roiChanged}})],1)])},staticRenderFns:[]};var B=i("VU/8")(z,N,!1,function(t){i("zV1N")},"data-v-1dc2ea88",null).exports,G=i("E7z3"),U={name:"v-menus",props:["menus","currentItem","pos","newover"],data(){var t={position:{},over:this.newover.substring(0,this.newover.indexOf(":"))||this.newover,curWidth:0};return this.pos&&"top"==this.pos.vd?t.position.top=0:this.pos&&"bottom"==this.pos.vd&&(t.position.bottom=0),this.pos&&"left"==this.pos.hd?t.position.left=0:this.pos&&"right"==this.pos.hd&&(t.position.right=0),t},methods:{mouseOver(t){this.over=t}},updated(){this.curWidth=this.$refs[this.over].clientWidth+5},watch:{over:{immediate:!0,handler(){this.$nextTick(()=>{this.curWidth=this.$refs[this.over].clientWidth+5})}}},components:{"v-menus":V}},Y={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{ref:t.over,staticClass:"container",style:t.position},t._l(t.menus,function(e,s){return i("div",{key:s,staticClass:"item",class:t.over==e.id?"active":"",on:{mouseover:function(i){return t.mouseOver(e.id)},mousedown:function(t){return t.stopPropagation(),t},click:function(i){i.stopPropagation(),(!e.children||!e.children.length)&&t.$emit("chosen",e.id)}}},[t.currentItem&&t.currentItem.split(":")[0]==e.id?i("span",{staticClass:"left"}):t._e(),t._v("\n        "+t._s(e.label)+"\n        "),e.id==t.over&&e.children?i("v-menus",{key:s,style:{transform:"translate("+("left"==t.pos.hd?t.curWidth+"px":-t.curWidth+"px")+",0"},attrs:{newover:t.currentItem&&t.currentItem.split(":").length>2?t.currentItem.substring(t.currentItem.indexOf(":")+1):t.currentItem.split(":")[0],menus:e.children,currentItem:t.currentItem&&t.currentItem.split(":").slice(1).join(":"),pos:t.pos},on:{chosen:function(e){return t.$emit("chosen",e)}}}):t._e(),t._v(" "),e.children&&e.children.length?i("span",{staticClass:"right"}):t._e()],1)}),0)},staticRenderFns:[]};var V=i("VU/8")(U,Y,!1,function(t){i("wsMQ")},"data-v-732ccfa8",null).exports,J={name:"v-menus",props:["menus","currentItem","pos","newover"],data(){var t={position:{},over:this.newover.substring(0,this.newover.indexOf(":"))||this.newover,curWidth:0,curTop:0,checked:this.currentItem?this.currentItem.split(","):[]};return this.pos&&"top"==this.pos.vd?t.position.top=0:this.pos&&"bottom"==this.pos.vd&&(t.position.top=0),this.pos&&"left"==this.pos.hd?t.position.left=0:this.pos&&"right"==this.pos.hd&&(t.position.right=0),t},methods:{mouseOver(t){this.over=t},checkHandel(t){const e=t.split(";")[0];t.includes(";")?(this.checked.includes(t)?this.checked=this.checked.filter(e=>e!=t):this.checked.push(t),this.checked=this.checked.filter(t=>0==t.indexOf(e)),this.$emit("chosen",this.checked)):this.$emit("chosen",t)}},updated(){this.curWidth=this.$refs[this.over].clientWidth+5;let t=this.$refs[this.over].querySelector(".active").offsetTop;this.curTop=t},watch:{over:{immediate:!0,handler(){this.$nextTick(()=>{this.curWidth=this.$refs[this.over].clientWidth+5})}}},components:{"v-menus":V}},X={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{ref:t.over,staticClass:"container",style:t.position},t._l(t.menus,function(e,s){return i("div",{key:s,staticClass:"item",class:{active:t.over==e.id},on:{mouseover:function(i){return t.mouseOver(e.id)},mousedown:function(t){return t.stopPropagation(),t},click:function(i){i.stopPropagation(),(!e.children||!e.children.length)&&t.checkHandel(e.id)}}},[t.checked.includes(e.id)?i("span",{staticClass:"left"}):t._e(),t._v(" "),t._v("\n        "+t._s(e.label)+"\n        "),e.id==t.over&&e.children?i("v-menus",{key:s,style:{transform:"translate("+("left"==t.pos.hd?t.curWidth+"px":-t.curWidth+"px")+",-"+t.curTop+"px"},attrs:{newover:t.currentItem&&t.currentItem.split(":").length>2?t.currentItem.substring(t.currentItem.indexOf(":")+1):t.currentItem.split(":")[0],menus:e.children,currentItem:t.currentItem&&t.currentItem.split(":").slice(1).join(":"),pos:t.pos},on:{chosen:function(e){return t.$emit("chosen",e)}}}):t._e(),t._v(" "),e.children&&e.children.length?i("span",{staticClass:"right"}):t._e()],1)}),0)},staticRenderFns:[]};var W=i("VU/8")(J,X,!1,function(t){i("L0aG")},"data-v-d16e37b4",null).exports,q={mixins:[G.a,G.c],props:["slice","record","config"],components:{"v-dragon":v.a,"v-roi":m,"v-menus":W}},K={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"cnt",staticStyle:{width:"100%"},attrs:{tabIndex:0},on:{keydown:t.keydown,mousewheel:function(e){t.contextmenuPosition=null},mousedown:function(e){t.contextmenuPosition=null}}},[i("div",{staticClass:"analyright"},[i("v-dragon",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],ref:"osd",staticClass:"dragon",attrs:{record:t.record,slice:t.slice,roilist:[].concat(t.leftRoilist),curRois:t.curRois,penColor:"yellow",centerRegion:t.centerRegion,position:t.position,showMppGuide:t.showMppGuide,cellArea:1962,"element-loading-text":"处理中，请耐心等待","element-loading-spinner":"el-icon-loading","element-loading-background":"rgba(0, 0, 0, 0.5)"},on:{curROI:t.curROIChange,roiChanged:t.roiChanged,draw:t.draw,delRoi:function(e){return t.delCurRoi(e)},position:function(e,i,s){t.$set(t.position,"offx",e),t.$set(t.position,"offy",i),t.$set(t.position,"zoom",s),t.$set(t.slice,"position",t.position)},contextmenu:function(e,i,s){return t.showMenu(e,i,s)},closeMppGuide:function(e){t.showMppGuide=!1},changeMpp:function(e){return t.drawMpp=e},getRoi:t.getRoi}},[t.contextmenuPosition?i("div",{staticStyle:{position:"absolute"},style:{left:t.menuPosition.x+"px",top:t.menuPosition.y+"px"}},[i("v-menus",{attrs:{pos:t.contextmenuPosition,menus:t.labeltree,currentItem:t.currentItem,newover:t.newover},on:{chosen:function(e){return t.setAnnotation(e)}}})],1):t._e()]),t._v(" "),t.showbutton?i("button",{on:{click:function(e){return t.isDrawMpp()}}},[t._v(t._s(t.$t("slice.start")))]):t._e()],1),t._v(" "),i("div",{staticClass:"analylist"},[i("div",{staticClass:"quality"},[t._m(0),t._v(" "),i("div",{staticClass:"quality-detail"},[i("p",[t._v("切片质量："),i("em",[t._v(t._s({1:"合格",0:"不合格"}[t.aiResult.slide_quality]||"-"))])]),t._v(" "),i("p",[t._v("清 晰 度："+t._s(t.slice.clarity?(100*t.slice.clarity).toFixed(2)+"%":"-"))]),t._v(" "),i("p",[t._v("扫描倍数："+t._s(t.slice.objective_rate||"-"))]),t._v(" "),i("p",[t._v("细 胞 量："+t._s("number"==typeof t.aiResult.cell_num?t.aiResult.cell_num:"-"))])])]),t._v(" "),i("div",{staticClass:"quality q-center",style:{height:"two"==t.auto?"calc(100% - 110px)":t.aiResult.diagnosis&&t.aiResult.diagnosis.length&&!t.aiResult.aiNotCompleted?"calc(100% - 290px)":"calc(100% - 110px)"}},[i("div",{staticClass:"title"},[i("span",{class:"one"==t.auto?"auto":"",on:{click:function(e){return t.changeTab("one")}}},[t._v("AI处理")]),t._v(" "),i("span",{class:"two"==t.auto?"auto":"",on:{click:function(e){return t.changeTab("two")}}},[t._v("手工标注")])]),t._v(" "),t.aiResult.diagnosis&&!t.aiResult.aiNotCompleted&&"one"==t.auto?i("div",{staticClass:"noroi"},[Object.keys(t.cells).length?i("div",{staticClass:"quality-detail short"},[i("p",{class:{checked:"HSIL"==t.showType},on:{click:function(e){return t.toogleType("HSIL")}}},[i("span",[t._v(t._s("阴性"==t.aiResult.diagnosis[0]?"可疑1":"HSIL"))]),t._v(t._s(t.cells.HSIL.num))]),t._v(" "),i("p",{class:{checked:"滴虫"==t.showType},on:{click:function(e){return t.toogleType("滴虫")}}},[i("span",[t._v("滴虫")]),t._v(t._s(t.showW?t.cells["滴虫"].num:0))]),t._v(" "),i("p",{class:{checked:"ASC-H"==t.showType},on:{click:function(e){return t.toogleType("ASC-H")}}},[i("span",[t._v(t._s("阴性"==t.aiResult.diagnosis[0]?"可疑2":"ASC-H"))]),t._v(t._s(t.cells["ASC-H"].num))]),t._v(" "),i("p",{class:{checked:"霉菌"==t.showType},on:{click:function(e){return t.toogleType("霉菌")}}},[i("span",[t._v("霉菌")]),t._v(t._s(t.showW?t.cells["霉菌"].num:0))]),t._v(" "),i("p",{class:{checked:"LSIL"==t.showType},on:{click:function(e){return t.toogleType("LSIL")}}},[i("span",[t._v(t._s("阴性"==t.aiResult.diagnosis[0]?"可疑3":"LSIL"))]),t._v(t._s(t.cells.LSIL.num))]),t._v(" "),i("p",{class:{checked:"线索"==t.showType},on:{click:function(e){return t.toogleType("线索")}}},[i("span",[t._v("线索")]),t._v(t._s(t.showW?t.cells["线索"].num:0))]),t._v(" "),i("p",{class:{checked:"ASCUS"==t.showType},on:{click:function(e){return t.toogleType("ASCUS")}}},[i("span",[t._v(t._s("阴性"==t.aiResult.diagnosis[0]?"可疑4":"ASC-US"))]),t._v(t._s(t.cells.ASCUS.num))]),t._v(" "),i("p",{class:{checked:"放线菌"==t.showType},on:{click:function(e){return t.toogleType("放线菌")}}},[i("span",[t._v("放线菌")]),t._v(t._s(t.showW?t.cells["放线菌"].num:0))]),t._v(" "),i("p",{class:{checked:"AGC"==t.showType},on:{click:function(e){return t.toogleType("AGC")}}},[i("span",[t._v(t._s("阴性"==t.aiResult.diagnosis[0]?"可疑5":"AGC"))]),t._v(t._s(t.cells.AGC.num))]),t._v(" "),i("p",{class:{checked:"疱疹"==t.showType},on:{click:function(e){return t.toogleType("疱疹")}}},[i("span",[t._v("疱疹")]),t._v(t._s(t.showW?t.cells["疱疹"].num:0))])]):t._e(),t._v(" "),i("div",{staticClass:"list-container"},[("滴虫霉菌线索放线菌疱疹".includes(t.showType)?t.aiRoilist.length&&t.showW:t.aiRoilist.length)?i("div",{staticClass:"list"},[i("div",{ref:"aiRoilist",staticClass:"roi-container"},[i("p",[t._v("ROI勾选后将带入报告。")]),t._v(" "),t._l(t.aiRoilist,function(e){return i("div",{key:e.id,staticClass:"img-content",class:{"check-img":t.curRois[e.id]},on:{click:function(i){return t.goTocurRoi(e,i.shiftKey)}}},[i("img",{attrs:{"data-src":"/aipath/api/files/ROI?caseid="+t.record.id+"&fileid="+t.slice.id+"&filename="+encodeURIComponent(t.slice.filename)+"&roi=[["+Math.min.apply(Math,e.path.x)+","+Math.min.apply(Math,e.path.y)+"],["+Math.max.apply(Math,e.path.x)+","+Math.max.apply(Math,e.path.y)+"]] &roiid="+e.id,alt:""}}),t._v(" "),i("span",{class:{blue:e.image},on:{click:function(i){return i.stopPropagation(),t.changeImage(e)}}})])})],2),t._v(" "),t.showTips?i("div",{staticClass:"viewpop"},[t._v("只展示置信度最高的前100个视野")]):t._e()]):i("h3",[t._v("处理结果为空～")])])]):t._e(),t._v(" "),"two"==t.auto?i("div",{staticClass:"noroi manunal"},[i("div",{staticClass:"quality-detail short"},[i("p",{class:{checked:"HSIL"==t.showHumanType},on:{click:function(e){return t.toogleHumanType("HSIL")}}},[i("span",[t._v("HSIL")]),t._v(t._s(t.humanResult.HSIL.data.length))]),t._v(" "),i("p",{class:{checked:"滴虫"==t.showHumanType},on:{click:function(e){return t.toogleHumanType("滴虫")}}},[i("span",[t._v("滴虫")]),t._v(t._s(t.humanResult["滴虫"].data.length))]),t._v(" "),i("p",{class:{checked:"ASC-H"==t.showHumanType},on:{click:function(e){return t.toogleHumanType("ASC-H")}}},[i("span",[t._v("ASC-H")]),t._v(t._s(t.humanResult["ASC-H"].data.length))]),t._v(" "),i("p",{class:{checked:"霉菌"==t.showHumanType},on:{click:function(e){return t.toogleHumanType("霉菌")}}},[i("span",[t._v("霉菌")]),t._v(t._s(t.humanResult["霉菌"].data.length))]),t._v(" "),i("p",{class:{checked:"LSIL"==t.showHumanType},on:{click:function(e){return t.toogleHumanType("LSIL")}}},[i("span",[t._v("LSIL")]),t._v(t._s(t.humanResult.LSIL.data.length))]),t._v(" "),i("p",{class:{checked:"线索"==t.showHumanType},on:{click:function(e){return t.toogleHumanType("线索")}}},[i("span",[t._v("线索")]),t._v(t._s(t.humanResult["线索"].data.length))]),t._v(" "),i("p",{class:{checked:"ASC-US"==t.showHumanType},on:{click:function(e){return t.toogleHumanType("ASC-US")}}},[i("span",[t._v("ASC-US")]),t._v(t._s(t.humanResult["ASC-US"].data.length))]),t._v(" "),i("p",{class:{checked:"放线菌"==t.showHumanType},on:{click:function(e){return t.toogleHumanType("放线菌")}}},[i("span",[t._v("放线菌")]),t._v(t._s(t.humanResult["放线菌"].data.length))]),t._v(" "),i("p",{class:{checked:"AGC"==t.showHumanType},on:{click:function(e){return t.toogleHumanType("AGC")}}},[i("span",[t._v("AGC")]),t._v(t._s(t.humanResult.AGC.data.length))]),t._v(" "),i("p",{class:{checked:"疱疹"==t.showHumanType},on:{click:function(e){return t.toogleHumanType("疱疹")}}},[i("span",[t._v("疱疹")]),t._v(t._s(t.humanResult["疱疹"].data.length))]),t._v(" "),i("p",{class:{checked:"阴性"==t.showHumanType},on:{click:function(e){return t.toogleHumanType("阴性")}}},[i("span",[t._v("阴性")]),t._v(t._s(t.humanResult["阴性"].data.length))]),t._v(" "),i("p",{class:{checked:"异物"==t.showHumanType},on:{click:function(e){return t.toogleHumanType("异物")}}},[i("span",[t._v("异物")]),t._v(t._s(t.humanResult["异物"].data.length))]),t._v(" "),i("p",{class:{checked:"无"==t.showHumanType},on:{click:function(e){return t.toogleHumanType("无")}}},[i("span",[t._v("无")]),t._v(t._s(t.humanResult["无"].data.length))]),t._v(" "),i("p",{class:{checked:"不确定"==t.showHumanType},on:{click:function(e){return t.toogleHumanType("不确定")}}},[i("span",[t._v("不确定")]),t._v(t._s(t.humanResult["不确定"].data.length))])]),t._v(" "),i("div",{staticClass:"quality-detail short only"},[i("p",{class:{checked:"AI假阴"==t.showHumanType},on:{click:function(e){return t.toogleHumanType("AI假阴")}}},[i("span",[t._v("AI假阴")]),t._v(t._s(t.humanResult["AI假阴"].data.length))]),t._v(" "),i("p",{class:{checked:"AI假阳"==t.showHumanType},on:{click:function(e){return t.toogleHumanType("AI假阳")}}},[i("span",[t._v("AI假阳")]),t._v(t._s(t.humanResult["AI假阳"].data.length))])]),t._v(" "),i("v-roi",{staticClass:"checkroi",attrs:{roilist:t.humanRoilist,currentRois:t.curRois,forbidden:!0},on:{curROI:function(e,i){return t.curROIChange(e,i)+t.listChangeCurrent()},delRoi:function(e){return t.delCurRoi(e)},roiChanged:t.roiChanged}})],1):t._e()]),t._v(" "),"one"==t.auto&&t.aiResult.diagnosis&&t.aiResult.diagnosis.length&&!t.aiResult.aiNotCompleted?i("div",[i("div",{staticClass:"advice"},[t._v("\n                AI建议："),i("i",{style:{"font-style":"normal",color:"阴性"==t.aiResult.diagnosis[0]?"#17DE6B":"阳性"==t.aiResult.diagnosis[0]?"#F23030":"#fff"}},[t._v(t._s(t.aiResult.diagnosis[0]+" "+t.aiResult.diagnosis[1]))]),t._v(" "),i("span",{attrs:{title:t.aiResult.microbe.join(",")}},[t._v("微生物提示："+t._s(t.showW?t.aiResult.microbe.join(","):""))])]),t._v(" "),i("div",{staticClass:"quality"},[i("div",{staticClass:"title"},[i("span",[t._v("医生复核")]),t._v(" "),i("div",{staticClass:"accept",on:{click:t.accept}},[t._v("采纳AI建议")]),t._v(" "),i("div",{staticClass:"accept",staticStyle:{width:"45px"},on:{click:t.clearCheckReslut}},[t._v("清空")])]),t._v(" "),i("div",{staticClass:"quality-detail"},[i("div",{staticClass:"result",class:{"result-2":t.changeShow}},[t._v("\n                        诊断结果:\n                        "),i("el-radio",{staticClass:"pos",attrs:{label:"阴性"},on:{change:function(e){return t.change(e,"diagnosis")}},model:{value:t.docResult.diagnosis,callback:function(e){t.$set(t.docResult,"diagnosis",e)},expression:"docResult.diagnosis"}},[t._v("阴性")]),t._v(" "),i("el-radio",{staticClass:"neg",attrs:{label:"阳性"},on:{change:function(e){return t.change(e,"diagnosis")}},model:{value:t.docResult.diagnosis,callback:function(e){t.$set(t.docResult,"diagnosis",e)},expression:"docResult.diagnosis"}},[t._v("阳性")]),t._v(" "),"阳性"==t.docResult.diagnosis?i("el-select",{attrs:{"popper-class":"hpf",placeholder:"请选择",multiple:"","collapse-tags":""},on:{change:function(e){return t.change(e,"tps")}},model:{value:t.docResult.tps,callback:function(e){t.$set(t.docResult,"tps",e)},expression:"docResult.tps"}},t._l(t.options,function(e){return i("el-option",{key:e,attrs:{label:e,value:e}},[i("span",{staticClass:"checkbox-icon"}),t._v(" "),i("span",{staticStyle:{"margin-left":"15px",lineHeight:"40px"}},[t._v(t._s(e))])])}),1):t._e(),t._v(" "),i("el-radio",{attrs:{label:"不确定"},on:{change:function(e){return t.change(e,"diagnosis")}},model:{value:t.docResult.diagnosis,callback:function(e){t.$set(t.docResult,"diagnosis",e)},expression:"docResult.diagnosis"}},[t._v("不确定")]),t._v(" "),t.changeShow?i("div",{staticClass:"c-r"},[i("el-select",{attrs:{placeholder:"请选择"},model:{value:t.changeValue,callback:function(e){t.changeValue=e},expression:"changeValue"}},t._l(t.optionsR,function(t){return i("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})}),1),t._v(" "),i("el-select",{attrs:{multiple:"",placeholder:"请选择"},model:{value:t.changeValue2,callback:function(e){t.changeValue2=e},expression:"changeValue2"}},t._l(t.optionW,function(e){return i("el-option",{key:e.value,attrs:{label:e.label,value:e.value}},[i("span",{staticClass:"checkbox-icon"}),t._v(" "),i("span",{staticStyle:{"margin-left":"15px",lineHeight:"40px"}},[t._v(t._s(e.label))])])}),1),t._v(" "),i("el-button",{staticClass:"confirm-btn",attrs:{size:"small"},on:{click:t.changeAiResult}},[t._v("确定")])],1):t._e()],1),t._v(" "),i("div",{staticClass:"result"},[t._v("\n                        微生物提示:\n                        "),i("el-checkbox-group",{on:{change:function(e){return t.change(e,"microbe")}},model:{value:t.docResult.microbe,callback:function(e){t.$set(t.docResult,"microbe",e)},expression:"docResult.microbe"}},[i("el-checkbox",{attrs:{label:"滴虫"}}),t._v(" "),i("el-checkbox",{attrs:{label:"霉菌"}}),t._v(" "),i("el-checkbox",{attrs:{label:"线索"}}),t._v(" "),i("el-checkbox",{attrs:{label:"放线菌"}}),t._v(" "),i("el-checkbox",{attrs:{label:"疱疹"}})],1)],1),t._v(" "),i("div",{staticClass:"result"},[t._v("\n                        切片背景:\n                        "),i("el-checkbox-group",{on:{change:function(e){return t.change(e,"background")}},model:{value:t.docResult.background,callback:function(e){t.$set(t.docResult,"background",e)},expression:"docResult.background"}},[i("el-checkbox",{attrs:{label:"萎缩"}}),t._v(" "),i("el-checkbox",{attrs:{label:"炎症"}}),t._v(" "),i("el-checkbox",{attrs:{label:"修复"}}),t._v(" "),i("el-checkbox",{attrs:{label:"出血"}}),t._v(" "),i("el-checkbox",{attrs:{label:"化生"}})],1)],1)])])]):t._e(),t._v(" "),t.aiResult.aiNotCompleted&&"one"==t.auto&&t.showbutton?i("div",{staticClass:"ifshowtables"},[t._v(t._s(t.$t("slice.noanalysis")))]):t._e(),t._v(" "),t.showbutton||"one"!=t.auto?t._e():i("div",{staticClass:"loding"},[i("div",{staticClass:"video"},[i("img",{attrs:{src:"/static/video/loading.gif"}}),t._v(" "),0==t.lineup?i("div",{staticClass:"lineup"},[t._v("正在处理...")]):t._e(),t._v(" "),t.lineup>0?i("div",{staticClass:"lineup"},[t._v(t._s(t.$t("slice.lineup"))+" "),i("span",{staticStyle:{color:"#4C9FFA","font-size":"18px","font-weight":"bolder"}},[t._v(t._s(t.lineup))]),t._v(" "+t._s(t.$t("slice.position")))]):t._e()]),t._v(" "),i("div",{staticClass:"cancel",on:{click:function(e){return t.canceltesk()}}},[t._v(t._s(t.$t("slice.cancelTasks")))])])])])},staticRenderFns:[function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"title"},[e("span",[this._v("AI质控")])])}]};var Z=i("VU/8")(q,K,!1,function(t){i("gbAu"),i("Ieeo")},"data-v-d8bb68b6",null).exports,Q={props:{dnaAiResult:{type:Object,default:function(){return{controlIOD:""}}},record:{type:Object,default:function(){return{id:""}}},slice:{type:Object,default:function(){return{id:""}}},curRois:{type:Object,default:function(){return{}}},docDNAResult:{type:Object,default:()=>{}}},data(){return{showTips:!0,checkValue:"",options:["标本不满意:上皮细胞数目太少","标本不满意","其它","有效检测细胞不足","未见DNA倍体异常细胞","可见少量DNA倍体异常细胞（1-2个）","可见DNA倍体异常细胞（≥3个）","可见少量细胞增生（5%-10%）","可见细胞异常增生（≥10%）","可见异倍体细胞峰"],currentRoi:{},dnaCheckResult:this.$props.docDNAResult.dnaResult,showBig:!1}},methods:{showBigPic(t){console.log(t)},checkAll(){let t=this.dnaAiRoilist.filter(t=>!t.image);this.$emit("changeImages",t)},reverseCheck(){this.$emit("changeImages",this.dnaAiRoilist)},changeImage(t){this.$emit("changeImage",t)},curROIChange(t){this.currentRoi=t,this.$emit("curROIChange",t,!1)},listChangeCurrent(){this.$emit("listChangeCurrent")},accept(){this.$emit("accept","dna")},clearCheckReslut(){this.$emit("clearCheckReslut","dna")},change(t,e){this.$emit("change",t,e)}},mounted(){let t=this.dnaAiRoilist.filter(t=>this.curRois[t.id]);this.currentRoi=t.length?t[0]:{}},computed:{dnaAiRoilist(){return this.$props.dnaAiResult.nuclei||[]}},watch:{docDNAResult:{immediate:!0,deep:!0,handler(t){this.docDNAResult=t,this.dnaCheckResult=this.docDNAResult.dnaResult}},curRois:{immediate:!0,deep:!0,handler(t){let e=this.dnaAiRoilist.filter(t=>this.curRois[t.id]);this.currentRoi=e.length?e[0]:{}}}}},tt={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"dna-content"},[t.dnaAiResult.dna_diagnosis?i("div",{staticClass:"quality height100"},[i("div",{staticClass:"quality"},[t._m(0),t._v(" "),i("div",{staticClass:"quality-pic"},[i("div",{staticClass:"pic-main"},[i("img",{staticClass:"img1",attrs:{src:"/aipath/api/files/getImage?caseid="+t.record.id+"&fileid="+t.slice.id+"&filename="+encodeURIComponent(t.slice.filename)+"&type=histplot&date="+(new Date).getTime(),alt:""},on:{click:function(e){return e.stopPropagation(),t.showBigPic("histplot")}}})]),t._v(" "),i("div",{staticClass:"pic-main pic-main1"},[i("img",{staticClass:"img2",attrs:{src:"/aipath/api/files/getImage?caseid="+t.record.id+"&fileid="+t.slice.id+"&filename="+encodeURIComponent(t.slice.filename)+"&type=scatterplot&date="+(new Date).getTime(),alt:""},on:{click:function(e){return e.stopPropagation(),t.showBigPic("scatterplot")}}})]),t._v(" "),i("div",{staticClass:"data-count",staticStyle:{color:"rgb(112,182,3)"}},[t._v("\n\t\t\t\t\t\t正常二倍体细胞: "+t._s(t.dnaAiResult.num_normal)+"\n\t\t\t\t\t")]),t._v(" "),i("div",{staticClass:"data-count",staticStyle:{color:"rgb(245,154,35)"}},[t._v("\n\t\t\t\t\t\t增生细胞: "+t._s(t.dnaAiResult.num_abnormal_low)+"\n\t\t\t\t\t")]),t._v(" "),i("div",{staticClass:"data-count",staticStyle:{color:"rgb(217,0,27)"}},[t._v("\n\t\t\t\t\t\t多倍体细胞: "+t._s(t.dnaAiResult.num_abnormal_high-t.dnaAiRoilist.filter(function(t){return!t.image&&t.dna_index>=2.5}).length)+"\n\t\t\t\t\t")]),t._v(" "),i("div",{staticClass:"data-count"},[t._v("\n\t\t\t\t\t\t上皮细胞: "+t._s(t.dnaAiResult.num_normal+t.dnaAiResult.num_abnormal_low+t.dnaAiResult.num_abnormal_high)+"\n\t\t\t\t\t")])])]),t._v(" "),i("div",{staticClass:"list-container"},[t.dnaAiRoilist&&t.dnaAiRoilist.length?i("div",{staticClass:"list"},[i("div",{staticClass:"list-container-head"},[i("div",{staticClass:"list-container-head-txt"},[t._v("\n\t\t\t\t\t\t\t前30个已勾选细胞核将带入报告。\n\t\t\t\t\t\t")]),t._v(" "),i("div",{staticClass:"list-container-btn"},[i("div",{staticClass:"container-btn",attrs:{"data-value":"all"},on:{click:function(e){return e.stopPropagation(),t.checkAll(e)}}},[t._v("\n\t\t\t\t\t\t\t\t全选\n\t\t\t\t\t\t\t")]),t._v(" "),i("div",{staticClass:"container-btn",attrs:{"data-value":"empty"},on:{click:function(e){return e.stopPropagation(),t.reverseCheck(e)}}},[t._v("\n\t\t\t\t\t\t\t\t反选\n\t\t\t\t\t\t\t")])])]),t._v(" "),i("div",{ref:"dnaAiRoilist",staticClass:"roi-container"},t._l(t.dnaAiRoilist,function(e){return i("div",{key:e.id,staticClass:"img-content",class:{"check-img":t.curRois[e.id]},on:{click:function(i){return t.$emit("goTocurRoi",e,!1)}}},[i("img",{attrs:{src:"/aipath/api/files/ROI?caseid="+t.record.id+"&fileid="+t.slice.id+"&filename="+encodeURIComponent(t.slice.filename)+"&roi=[["+Math.min.apply(Math,e.path.x)+","+Math.min.apply(Math,e.path.y)+"],["+Math.max.apply(Math,e.path.x)+","+Math.max.apply(Math,e.path.y)+"]] &roiid="+e.id,alt:""}}),t._v(" "),i("div",{staticClass:"roi-percent",class:{"red-color":e.dna_index-0>=2.5}},[t._v(t._s(e.dna_index))]),t._v(" "),i("span",{class:{blue:e.image},on:{click:function(i){return i.stopPropagation(),t.changeImage(e)}}})])}),0),t._v(" "),i("div",{staticClass:"cells-result"},[i("p",[i("span",[t._v("核面积：")]),i("em",[t._v(t._s(t.currentRoi.area?t.currentRoi.area+"um²":"-"))])]),t._v(" "),i("p",[i("span",[t._v("光密度：")]),i("em",[t._v(t._s(t.currentRoi.dna_amount||"-"))])])])]):t._e()]),t._v(" "),i("div",{staticClass:"advice"},[t._v("\n\t\t\t\tAI建议：\n\t\t\t\t"),i("span",{attrs:{title:"未见DNA倍体异常细胞"}},[t._v(t._s(t.dnaAiResult.dna_diagnosis)+" ")])]),t._v(" "),i("div",{staticClass:"quality"},[i("div",{staticClass:"title"},[i("span",[t._v("医生复核")]),t._v(" "),i("div",{staticClass:"accept",on:{click:t.accept}},[t._v("采纳AI建议")]),t._v(" "),i("div",{staticClass:"accept",staticStyle:{width:"45px"},on:{click:t.clearCheckReslut}},[t._v("\n\t\t\t\t\t\t清空\n\t\t\t\t\t")])]),t._v(" "),i("div",{staticClass:"quality-detail",staticStyle:{borderbottom:"1px solid #424242"}},[i("div",{staticClass:"result"},[t._v("\n\t\t\t\t\t\t诊断结果:\n\t\t\t\t\t\t"),i("el-select",{attrs:{"popper-class":"hpf",placeholder:"请选择","collapse-tags":""},on:{change:function(e){return t.change(e,"dnaResult")}},model:{value:t.dnaCheckResult,callback:function(e){t.dnaCheckResult=e},expression:"dnaCheckResult"}},t._l(t.options,function(t){return i("el-option",{key:t,attrs:{label:t,value:t}})}),1)],1)])])]):i("div",{staticClass:"no-result"},[t._v(t._s(t.$t("slice.noanalysis")))])])},staticRenderFns:[function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"title"},[e("span",[this._v("细胞数量分布")]),this._v(" "),e("span",[this._v("核面积分布")])])}]};var et=i("VU/8")(Q,tt,!1,function(t){i("xpBU")},"data-v-b89be4d4",null).exports,it={mixins:[G.a,G.b],props:["slice","record","config"],components:{"v-dragon":v.a,"v-roi":m,"v-menus":V,"v-dnaresult":et},mounted(){},methods:{changeModule(t){let e=t.target.getAttribute("data-value");switch(e){case"cellresult":case"dnaresult":this.curModule=e}}}},st={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"cnt",staticStyle:{width:"100%"},attrs:{tabIndex:0},on:{keydown:t.keydown,mousewheel:function(e){t.contextmenuPosition=null},mousedown:function(e){t.contextmenuPosition=null}}},[i("div",{staticClass:"analyright"},[i("v-dragon",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],ref:"osd",staticClass:"dragon",attrs:{record:t.record,slice:t.slice,roilist:[].concat(t.leftRoilist),curRois:t.curRois,penColor:"yellow",centerRegion:t.centerRegion,position:t.position,showMppGuide:t.showMppGuide,cellArea:1962,"element-loading-text":"处理中，请耐心等待","element-loading-spinner":"el-icon-loading","element-loading-background":"rgba(0, 0, 0, 0.5)"},on:{curROI:t.curROIChange,roiChanged:t.roiChanged,draw:t.draw,delRoi:function(e){return t.delCurRoi(e)},position:function(e,i,s){t.$set(t.position,"offx",e),t.$set(t.position,"offy",i),t.$set(t.position,"zoom",s),t.$set(t.slice,"position",t.position)},contextmenu:function(e,i){return t.showMenu(e,i)},closeMppGuide:function(e){t.showMppGuide=!1},changeMpp:function(e){return t.drawMpp=e},getRoi:t.getRoi}},[t.contextmenuPosition?i("div",{staticStyle:{position:"absolute"},style:{left:t.menuPosition.x+"px",top:t.menuPosition.y+"px"}},[i("v-menus",{attrs:{pos:t.contextmenuPosition,menus:t.labeltree,currentItem:t.currentItem,newover:t.newover},on:{chosen:function(e){return t.setAnnotation(e)}}})],1):t._e()]),t._v(" "),t.showbutton?i("button",{on:{click:function(e){t.curModule="cellresult",t.isDrawMpp()}}},[t._v("\n\t\t\t\t"+t._s(t.$t("slice.start"))+"\n\t\t\t")]):t._e()],1),t._v(" "),i("div",{staticClass:"analylist"},[i("ul",{staticClass:"tab-class-content",on:{click:function(e){return t.changeModule(e)}}},[i("li",{class:{"cur-module":"cellresult"==t.curModule},attrs:{"data-value":"cellresult"}},[t._v("\n\t\t\t\t\t宫颈细胞学\n\t\t\t\t")]),t._v(" "),i("li",{class:{"cur-module":"dnaresult"==t.curModule},attrs:{"data-value":"dnaresult"}},[t._v("\n\t\t\t\t\tDNA倍体\n\t\t\t\t")])]),t._v(" "),"dnaresult"==t.curModule?i("v-dnaresult",{attrs:{dnaAiResult:t.aiResult,docDNAResult:t.docResult,record:t.record,slice:t.slice,curRois:t.curRois},on:{changeImage:t.changeImage,changeImages:t.changeImages,curROIChange:t.curROIChange,listChangeCurrent:t.listChangeCurrent,accept:t.accept,clearCheckReslut:t.clearCheckReslut,change:function(e,i){return t.change(e,i)},goTocurRoi:t.goTocurRoi}}):i("div",{staticClass:"dna-tbs"},[i("div",{staticClass:"quality"},[i("div",{staticClass:"title"},[i("span",[t._v("AI质控")])]),t._v(" "),i("div",{staticClass:"quality-detail"},[i("p",[t._v("切片质量："),i("em",[t._v(t._s({1:"合格",0:"不合格"}[t.aiResult.slide_quality]||"-"))])]),t._v(" "),i("p",[t._v("清 晰 度："+t._s(t.slice.clarity?(100*t.slice.clarity).toFixed(2)+"%":"-"))]),t._v(" "),i("p",[t._v("扫描倍数："+t._s(t.slice.objective_rate||"-"))]),t._v(" "),i("p",[t._v("细 胞 量："+t._s("number"==typeof t.aiResult.cell_num?t.aiResult.cell_num:"-"))])])]),t._v(" "),i("div",{staticClass:"quality q-center",style:{height:"two"==t.auto?"calc(100% - 110px)":t.aiResult.diagnosis&&t.aiResult.diagnosis.length&&!t.aiResult.aiNotCompleted?"calc(100% - 289px)":"calc(100% - 110px)"}},[i("div",{staticClass:"title"},[i("span",{class:"one"==t.auto?"auto":"",on:{click:function(e){return t.changeTab("one")}}},[t._v("AI处理")]),t._v(" "),i("span",{class:"two"==t.auto?"auto":"",on:{click:function(e){return t.changeTab("two")}}},[t._v("手工标注")])]),t._v(" "),t.aiResult.diagnosis&&!t.aiResult.aiNotCompleted&&"one"==t.auto?i("div",{staticClass:"noroi"},[Object.keys(t.cells).length?i("div",{staticClass:"quality-detail short"},[i("p",{class:{checked:"HSIL"==t.showType},on:{click:function(e){return t.toogleType("HSIL")}}},[i("span",[t._v(t._s("阴性"==t.aiResult.diagnosis[0]?"可疑1":"HSIL"))]),t._v(t._s(t.cells.HSIL.num)+"\n\t\t\t\t\t\t\t")]),t._v(" "),i("p",{class:{checked:"滴虫"==t.showType},on:{click:function(e){return t.toogleType("滴虫")}}},[i("span",[t._v("滴虫")]),t._v(t._s(t.showW?t.cells["滴虫"].num:0)+"\n\t\t\t\t\t\t\t")]),t._v(" "),i("p",{class:{checked:"ASC-H"==t.showType},on:{click:function(e){return t.toogleType("ASC-H")}}},[i("span",[t._v(t._s("阴性"==t.aiResult.diagnosis[0]?"可疑2":"ASC-H"))]),t._v(t._s(t.cells["ASC-H"].num)+"\n\t\t\t\t\t\t\t")]),t._v(" "),i("p",{class:{checked:"霉菌"==t.showType},on:{click:function(e){return t.toogleType("霉菌")}}},[i("span",[t._v("霉菌")]),t._v(t._s(t.showW?t.cells["霉菌"].num:0)+"\n\t\t\t\t\t\t\t")]),t._v(" "),i("p",{class:{checked:"LSIL"==t.showType},on:{click:function(e){return t.toogleType("LSIL")}}},[i("span",[t._v(t._s("阴性"==t.aiResult.diagnosis[0]?"可疑3":"LSIL"))]),t._v(t._s(t.cells.LSIL.num)+"\n\t\t\t\t\t\t\t")]),t._v(" "),i("p",{class:{checked:"线索"==t.showType},on:{click:function(e){return t.toogleType("线索")}}},[i("span",[t._v("线索")]),t._v(t._s(t.showW?t.cells["线索"].num:0)+"\n\t\t\t\t\t\t\t")]),t._v(" "),i("p",{class:{checked:"ASCUS"==t.showType},on:{click:function(e){return t.toogleType("ASCUS")}}},[i("span",[t._v(t._s("阴性"==t.aiResult.diagnosis[0]?"可疑4":"ASC-US"))]),t._v(t._s(t.cells.ASCUS.num)+"\n\t\t\t\t\t\t\t")]),t._v(" "),i("p",{class:{checked:"放线菌"==t.showType},on:{click:function(e){return t.toogleType("放线菌")}}},[i("span",[t._v("放线菌")]),t._v(t._s(t.showW?t.cells["放线菌"].num:0)+"\n\t\t\t\t\t\t\t")]),t._v(" "),i("p",{class:{checked:"AGC"==t.showType},on:{click:function(e){return t.toogleType("AGC")}}},[i("span",[t._v(t._s("阴性"==t.aiResult.diagnosis[0]?"可疑5":"AGC"))]),t._v(t._s(t.cells.AGC.num)+"\n\t\t\t\t\t\t\t")]),t._v(" "),i("p",{class:{checked:"疱疹"==t.showType},on:{click:function(e){return t.toogleType("疱疹")}}},[i("span",[t._v("疱疹")]),t._v(t._s(t.showW?t.cells["疱疹"].num:0)+"\n\t\t\t\t\t\t\t")])]):t._e(),t._v(" "),i("div",{staticClass:"list-container"},[("滴虫霉菌线索放线菌疱疹".includes(t.showType)?t.aiRoilist.length&&t.showW:t.aiRoilist.length)?i("div",{staticClass:"list"},[i("div",{ref:"aiRoilist",staticClass:"roi-container"},[i("p",[t._v("ROI勾选后将带入报告。")]),t._v(" "),t._l(t.aiRoilist,function(e){return i("div",{key:e.id,staticClass:"img-content",class:{"check-img":t.curRois[e.id]},on:{click:function(i){return t.goTocurRoi(e,i.shiftKey)}}},[i("img",{attrs:{src:"/aipath/api/files/ROI?caseid="+t.record.id+"&fileid="+t.slice.id+"&filename="+encodeURIComponent(t.slice.filename)+"&roi=[["+Math.min.apply(Math,e.path.x)+","+Math.min.apply(Math,e.path.y)+"],["+Math.max.apply(Math,e.path.x)+","+Math.max.apply(Math,e.path.y)+"]] &roiid="+e.id,alt:""}}),t._v(" "),i("span",{class:{blue:e.image},on:{click:function(i){return i.stopPropagation(),t.changeImage(e)}}})])})],2),t._v(" "),t.showTips?i("div",{staticClass:"viewpop"},[t._v("\n\t\t\t\t\t\t\t\t\t只展示置信度最高的前100个视野\n\t\t\t\t\t\t\t\t")]):t._e()]):i("h3",[t._v("处理结果为空～")])])]):t._e(),t._v(" "),"two"==t.auto?i("div",{staticClass:"noroi manunal"},[i("div",{staticClass:"quality-detail short"},[i("p",{class:{checked:"HSIL"==t.showHumanType},on:{click:function(e){return t.toogleHumanType("HSIL")}}},[i("span",[t._v("HSIL")]),t._v(t._s(t.humanResult.HSIL.data.length)+"\n\t\t\t\t\t\t\t")]),t._v(" "),i("p",{class:{checked:"滴虫"==t.showHumanType},on:{click:function(e){return t.toogleHumanType("滴虫")}}},[i("span",[t._v("滴虫")]),t._v(t._s(t.humanResult["滴虫"].data.length)+"\n\t\t\t\t\t\t\t")]),t._v(" "),i("p",{class:{checked:"ASC-H"==t.showHumanType},on:{click:function(e){return t.toogleHumanType("ASC-H")}}},[i("span",[t._v("ASC-H")]),t._v(t._s(t.humanResult["ASC-H"].data.length)+"\n\t\t\t\t\t\t\t")]),t._v(" "),i("p",{class:{checked:"霉菌"==t.showHumanType},on:{click:function(e){return t.toogleHumanType("霉菌")}}},[i("span",[t._v("霉菌")]),t._v(t._s(t.humanResult["霉菌"].data.length)+"\n\t\t\t\t\t\t\t")]),t._v(" "),i("p",{class:{checked:"LSIL"==t.showHumanType},on:{click:function(e){return t.toogleHumanType("LSIL")}}},[i("span",[t._v("LSIL")]),t._v(t._s(t.humanResult.LSIL.data.length)+"\n\t\t\t\t\t\t\t")]),t._v(" "),i("p",{class:{checked:"线索"==t.showHumanType},on:{click:function(e){return t.toogleHumanType("线索")}}},[i("span",[t._v("线索")]),t._v(t._s(t.humanResult["线索"].data.length)+"\n\t\t\t\t\t\t\t")]),t._v(" "),i("p",{class:{checked:"ASC-US"==t.showHumanType},on:{click:function(e){return t.toogleHumanType("ASC-US")}}},[i("span",[t._v("ASC-US")]),t._v(t._s(t.humanResult["ASC-US"].data.length)+"\n\t\t\t\t\t\t\t")]),t._v(" "),i("p",{class:{checked:"放线菌"==t.showHumanType},on:{click:function(e){return t.toogleHumanType("放线菌")}}},[i("span",[t._v("放线菌")]),t._v(t._s(t.humanResult["放线菌"].data.length)+"\n\t\t\t\t\t\t\t")]),t._v(" "),i("p",{class:{checked:"AGC"==t.showHumanType},on:{click:function(e){return t.toogleHumanType("AGC")}}},[i("span",[t._v("AGC")]),t._v(t._s(t.humanResult.AGC.data.length)+"\n\t\t\t\t\t\t\t")]),t._v(" "),i("p",{class:{checked:"疱疹"==t.showHumanType},on:{click:function(e){return t.toogleHumanType("疱疹")}}},[i("span",[t._v("疱疹")]),t._v(t._s(t.humanResult["疱疹"].data.length)+"\n\t\t\t\t\t\t\t")]),t._v(" "),i("p",{class:{checked:"阴性"==t.showHumanType},on:{click:function(e){return t.toogleHumanType("阴性")}}},[i("span",[t._v("阴性")]),t._v(t._s(t.humanResult["阴性"].data.length)+"\n\t\t\t\t\t\t\t")]),t._v(" "),i("p",{class:{checked:"异物"==t.showHumanType},on:{click:function(e){return t.toogleHumanType("异物")}}},[i("span",[t._v("异物")]),t._v(t._s(t.humanResult["异物"].data.length)+"\n\t\t\t\t\t\t\t")]),t._v(" "),i("p",{class:{checked:"无"==t.showHumanType},on:{click:function(e){return t.toogleHumanType("无")}}},[i("span",[t._v("无")]),t._v(t._s(t.humanResult["无"].data.length)+"\n\t\t\t\t\t\t\t")]),t._v(" "),i("p",{class:{checked:"不确定"==t.showHumanType},on:{click:function(e){return t.toogleHumanType("不确定")}}},[i("span",[t._v("不确定")]),t._v(t._s(t.humanResult["不确定"]&&t.humanResult["不确定"].data.length)+"\n\t\t\t\t\t\t\t")])]),t._v(" "),i("div",{staticClass:"quality-detail short only"},[i("p",{class:{checked:"AI假阴"==t.showHumanType},on:{click:function(e){return t.toogleHumanType("AI假阴")}}},[i("span",[t._v("AI假阴")]),t._v(t._s(t.humanResult["AI假阴"].data.length)+"\n\t\t\t\t\t\t\t")]),t._v(" "),i("p",{class:{checked:"AI假阳"==t.showHumanType},on:{click:function(e){return t.toogleHumanType("AI假阳")}}},[i("span",[t._v("AI假阳")]),t._v(t._s(t.humanResult["AI假阳"].data.length)+"\n\t\t\t\t\t\t\t")])]),t._v(" "),i("v-roi",{staticClass:"checkroi",attrs:{roilist:t.humanRoilist,currentRois:t.curRois,forbidden:!0},on:{curROI:function(e,i){return t.curROIChange(e,i)+t.listChangeCurrent()},delRoi:function(e){return t.delCurRoi(e)},roiChanged:t.roiChanged}})],1):t._e()]),t._v(" "),"one"==t.auto&&t.aiResult.diagnosis&&t.aiResult.diagnosis.length&&!t.aiResult.aiNotCompleted?i("div",[i("div",{staticClass:"advice"},[t._v("\n\t\t\t\t\t\tAI建议："),i("i",{style:{"font-style":"normal",color:"阴性"==t.aiResult.diagnosis[0]?"#17DE6B":"阳性"==t.aiResult.diagnosis[0]?"#F23030":"#fff"}},[t._v(t._s(t.aiResult.diagnosis[0]+" "+t.aiResult.diagnosis[1]))]),t._v(" "),i("span",{attrs:{title:t.aiResult.microbe.join(",")}},[t._v("微生物提示："+t._s(t.showW?t.aiResult.microbe.join(","):""))])]),t._v(" "),i("div",{staticClass:"quality"},[i("div",{staticClass:"title"},[i("span",[t._v("医生复核")]),t._v(" "),i("div",{staticClass:"accept",on:{click:t.accept}},[t._v("采纳AI建议")]),t._v(" "),i("div",{staticClass:"accept",staticStyle:{width:"45px"},on:{click:t.clearCheckReslut}},[t._v("\n\t\t\t\t\t\t\t\t清空\n\t\t\t\t\t\t\t")])]),t._v(" "),i("div",{staticClass:"quality-detail"},[i("div",{staticClass:"result",class:{"result-2":t.changeShow}},[t._v("\n\t\t\t\t\t\t\t\t诊断结果:\n\t\t\t\t\t\t\t\t"),i("el-radio",{staticClass:"pos",attrs:{label:"阴性"},on:{change:function(e){return t.change(e,"diagnosis")}},model:{value:t.docResult.diagnosis,callback:function(e){t.$set(t.docResult,"diagnosis",e)},expression:"docResult.diagnosis"}},[t._v("阴性")]),t._v(" "),i("el-radio",{staticClass:"neg",attrs:{label:"阳性"},on:{change:function(e){return t.change(e,"diagnosis")}},model:{value:t.docResult.diagnosis,callback:function(e){t.$set(t.docResult,"diagnosis",e)},expression:"docResult.diagnosis"}},[t._v("阳性")]),t._v(" "),"阳性"==t.docResult.diagnosis?i("el-select",{attrs:{"popper-class":"hpf",placeholder:"请选择",multiple:"","collapse-tags":""},on:{change:function(e){return t.change(e,"tps")}},model:{value:t.docResult.tps,callback:function(e){t.$set(t.docResult,"tps",e)},expression:"docResult.tps"}},t._l(t.options,function(e){return i("el-option",{key:e,attrs:{label:e,value:e}},[i("span",{staticClass:"checkbox-icon"}),t._v(" "),i("span",{staticStyle:{"margin-left":"15px"}},[t._v(t._s(e))])])}),1):t._e(),t._v(" "),i("el-radio",{attrs:{label:"不确定"},on:{change:function(e){return t.change(e,"diagnosis")}},model:{value:t.docResult.diagnosis,callback:function(e){t.$set(t.docResult,"diagnosis",e)},expression:"docResult.diagnosis"}},[t._v("不确定")]),t._v(" "),t.changeShow?i("div",{staticClass:"c-r"},[i("el-select",{attrs:{placeholder:"请选择"},model:{value:t.changeValue,callback:function(e){t.changeValue=e},expression:"changeValue"}},t._l(t.optionsR,function(t){return i("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})}),1),t._v(" "),i("el-select",{attrs:{"popper-class":"hpf",multiple:"",placeholder:"请选择"},model:{value:t.changeValue2,callback:function(e){t.changeValue2=e},expression:"changeValue2"}},t._l(t.optionW,function(e){return i("el-option",{key:e.value,attrs:{label:e.label,value:e.value}},[i("span",{staticClass:"checkbox-icon"}),t._v(" "),i("span",{staticStyle:{"margin-left":"15px"}},[t._v(t._s(e.label))])])}),1),t._v(" "),i("el-button",{staticClass:"confirm-btn",attrs:{size:"small"},on:{click:t.changeAiResult}},[t._v("确定")])],1):t._e()],1),t._v(" "),i("div",{staticClass:"result"},[t._v("\n\t\t\t\t\t\t\t\t微生物提示:\n\t\t\t\t\t\t\t\t"),i("el-checkbox-group",{on:{change:function(e){return t.change(e,"microbe")}},model:{value:t.docResult.microbe,callback:function(e){t.$set(t.docResult,"microbe",e)},expression:"docResult.microbe"}},[i("el-checkbox",{attrs:{label:"滴虫"}}),t._v(" "),i("el-checkbox",{attrs:{label:"霉菌"}}),t._v(" "),i("el-checkbox",{attrs:{label:"线索"}}),t._v(" "),i("el-checkbox",{attrs:{label:"放线菌"}}),t._v(" "),i("el-checkbox",{attrs:{label:"疱疹"}})],1)],1),t._v(" "),i("div",{staticClass:"result"},[t._v("\n\t\t\t\t\t\t\t\t切片背景:\n\t\t\t\t\t\t\t\t"),i("el-checkbox-group",{on:{change:function(e){return t.change(e,"background")}},model:{value:t.docResult.background,callback:function(e){t.$set(t.docResult,"background",e)},expression:"docResult.background"}},[i("el-checkbox",{attrs:{label:"萎缩"}}),t._v(" "),i("el-checkbox",{attrs:{label:"炎症"}}),t._v(" "),i("el-checkbox",{attrs:{label:"修复"}}),t._v(" "),i("el-checkbox",{attrs:{label:"出血"}}),t._v(" "),i("el-checkbox",{attrs:{label:"化生"}})],1)],1)])])]):t._e(),t._v(" "),t.aiResult.diagnosis&&t.aiResult.diagnosis.length&&t.aiResult.diagnosis[0]||"one"!=t.auto||!t.showbutton?t._e():i("div",{staticClass:"ifshowtables"},[t._v("\n\t\t\t\t\t"+t._s(t.$t("slice.noanalysis"))+"\n\t\t\t\t")]),t._v(" "),t.showbutton||"one"!=t.auto?t._e():i("div",{staticClass:"loding"},[i("div",{staticClass:"video"},[i("img",{attrs:{src:"/static/video/loading.gif"}}),t._v(" "),0==t.lineup?i("div",{staticClass:"lineup"},[t._v("正在处理...")]):t._e(),t._v(" "),t.lineup>0?i("div",{staticClass:"lineup"},[t._v("\n\t\t\t\t\t\t\t"+t._s(t.$t("slice.lineup"))+" "),i("span",{staticStyle:{color:"#4c9ffa","font-size":"18px","font-weight":"bolder"}},[t._v(t._s(t.lineup))]),t._v(" "+t._s(t.$t("slice.position"))+"\n\t\t\t\t\t\t")]):t._e()]),t._v(" "),i("div",{staticClass:"cancel",on:{click:function(e){return t.canceltesk()}}},[t._v("\n\t\t\t\t\t\t"+t._s(t.$t("slice.cancelTasks"))+"\n\t\t\t\t\t")])])])],1)])},staticRenderFns:[]};var nt=i("VU/8")(it,st,!1,function(t){i("+H9z"),i("M16f")},"data-v-312faa1c",null).exports,at={data(){return{checkResult:this.slice.alg===this.slice.toolType&&this.slice.check_result.slice(0,this.slice.check_result.length-1)||null}},methods:{changeResult(t){this.checkResult=t,this.$emit("acceptAI",t)},changeImage(t){this.$set(t,"image",1-(t.image||0)),this.$emit("roiChanged","image",[t])},checkall(){if(!this.ROIS.length)return;let t=this.ROIS.every(t=>!!t.image),e=this.ROIS.map(e=>{return{id:e.id,image:t?0:1}});this.$emit("roiChanged","image",e)},del(t){this.$confirm(this.$t("analaysisPanel.delete"),{confirmButtonText:this.$t("confirm.confirm"),cancelButtonText:this.$t("confirm.quit"),type:"warning"}).then(()=>{this.$emit("delRoi",t)},()=>{})}},props:["ROIS","currentRois","slice","ave"]},ot={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"ki67arearois"},[t.ROIS?i("div",{staticClass:"table"},[i("div",{staticClass:"top"},[i("div",{staticClass:"left"},[i("div",[i("span",{staticClass:"uncheck",class:{checked:t.ROIS.every(function(t){return!!t.image})},on:{click:t.checkall}}),t._v("\n                    ROI\n                ")])]),t._v(" "),i("div",[t._v("阳性肿瘤")]),t._v(" "),i("div",[t._v(t._s(t.$t("slice.total")))]),t._v(" "),i("div",[t._v(t._s(t.$t("slice.index")))]),t._v(" "),i("div",[t._v(t._s(t.$t("slice.deleted")))])]),t._v(" "),i("div",{staticClass:"rois"},t._l(t.ROIS,function(e,s){return i("div",{key:s,staticClass:"row",class:{curRoi:t.currentRois[e.id]},on:{click:function(i){t.$emit("curROI",e,i.shiftKey),t.$emit("closecontextmenu")}}},[i("div",{staticClass:"left"},[i("div",[i("span",{staticClass:"uncheck",class:{checked:e.image},on:{click:function(i){return i.stopPropagation(),t.changeImage(e)}}}),t._v("\n                        "+t._s(s+1)+"\n                    ")])]),t._v(" "),i("div",[t._v(t._s(e.aiResult.pos_tumor))]),t._v(" "),i("div",[t._v(t._s(e.aiResult.total))]),t._v(" "),i("div",[t._v(t._s((100*e.aiResult.index).toFixed(2)+"%"))]),t._v(" "),i("div",[i("em",{attrs:{title:t.$t("upload.delete")},on:{click:function(i){return i.stopPropagation(),t.del(e)}}})])])}),0)]):t._e(),t._v(" "),t.ROIS?i("div",{staticClass:"areabtm"},[i("div",{staticClass:"result",staticStyle:{color:"red"}},[i("div",[t._v("\n                阳性肿瘤细胞\n            ")]),t._v(" "),i("div",[t._v("\n                "+t._s(t.ROIS.filter(function(t){return t.image}).map(function(t){return t.aiResult.pos_tumor}).reduce(function(t,e){return t+e},0))+"\n            ")])]),t._v(" "),i("div",{staticClass:"result",staticStyle:{color:"green"}},[i("div",[t._v("\n                阴性肿瘤细胞\n            ")]),t._v(" "),i("div",[t._v("\n                "+t._s(t.ROIS.filter(function(t){return t.image}).map(function(t){return t.aiResult.neg_tumor}).reduce(function(t,e){return t+e},0))+"\n            ")])]),t._v(" "),i("div",{staticClass:"result",staticStyle:{color:"#C280FF"}},[i("div",[t._v("\n                非肿瘤细胞\n            ")]),t._v(" "),i("div",[t._v("\n                "+t._s(t.ROIS.filter(function(t){return t.image}).map(function(t){return t.aiResult.normal_cell}).reduce(function(t,e){return t+e},0))+"\n            ")])]),t._v(" "),i("div",{staticClass:"result"},[i("div",[t._v("\n                综合指数\n            ")]),t._v(" "),i("div",[t._v("\n                "+t._s(t.ave)+"%\n            ")])])]):t._e(),t._v(" "),i("div",{staticClass:"recheck"},[i("div",{staticClass:"doc-check"},[i("i",[t._v("医生复核")]),t._v(" "),i("span",{on:{click:function(e){return t.changeResult("")}}},[t._v("清空")]),t._v(" "),i("span",{on:{click:function(e){return t.changeResult(t.ave)}}},[t._v("采纳AI建议")])]),t._v(" "),i("div",{staticClass:"check-result"},[t._v("指数"),i("input",{directives:[{name:"model",rawName:"v-model",value:t.checkResult,expression:"checkResult"}],domProps:{value:t.checkResult},on:{blur:function(e){return t.changeResult(t.checkResult)},input:function(e){e.target.composing||(t.checkResult=e.target.value)}}}),t._v("%")])])])},staticRenderFns:[]};var rt=i("VU/8")(at,ot,!1,function(t){i("SwTe"),i("nxrE")},null,null).exports,lt={data:()=>({roiTypeOpitions:{0:"green",1:"red",2:"#C280FF"},defaultColor:"red",defaultType:1,labeltree:[{id:1,label:"阳性肿瘤"},{id:0,label:"阴性肿瘤"},{id:2,label:"非肿瘤"}]}),computed:{ave(){return(this.aiFatherRois.filter(t=>t.image).map(t=>t.aiResult.pos_tumor).reduce((t,e)=>t+e,0)/(this.aiFatherRois.filter(t=>t.image).map(t=>t.aiResult.total).reduce((t,e)=>t+e,0)||1)*100).toFixed(2)}},props:["slice","record"],components:{"v-dragon":v.a,"v-analyroi":rt,"v-roi":m,"v-menus":V},mixins:[G.a]},ct={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"cnt",attrs:{tabIndex:0},on:{keydown:t.keydown}},[i("div",{staticClass:"analyright",on:{mousewheel:function(e){t.ki67Anno=null},mousedown:function(e){t.ki67Anno=null}}},[i("v-dragon",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],ref:"osd",staticClass:"dragon",attrs:{record:t.record,slice:t.slice,roilist:t.leftRoilist,curRois:t.curRois,penColor:t.auto?"grey":"yellow",centerRegion:t.centerRegion,position:t.position,showMppGuide:t.showMppGuide,cellArea:110,"element-loading-text":"处理中，请耐心等待","element-loading-spinner":"el-icon-loading","element-loading-background":"rgba(0, 0, 0, 0.5)"},on:{curROI:t.curROIChange,draw:t.draw,delRoi:function(e){return t.delCurRoi(e)},position:function(e,i,s){t.$set(t.position,"offx",e),t.$set(t.position,"offy",i),t.$set(t.position,"zoom",s),t.$set(t.slice,"position",t.position)},closeMppGuide:function(e){t.showMppGuide=!1},changeMpp:function(e){return t.drawMpp=e},clickDraw:t.clickDraw,getRoi:function(e){return t.getRoi(e)},roiChanged:t.roiChanged,parentId:function(e){return t.parentId=e},contextmenu:function(e,i){return t.showMenu(e,i)}}},[t.ki67Anno?i("div",{staticStyle:{position:"absolute"},style:{left:t.menuPosition.x+"px",top:t.menuPosition.y+"px"}},[i("v-menus",{attrs:{pos:t.ki67Anno,menus:t.labeltree,currentItem:t.currentItem,newover:t.newover},on:{chosen:function(e){return t.setAnnotation(e)}}})],1):t._e()]),t._v(" "),t.showbutton?i("button",{on:{click:function(e){return t.isDrawMpp()}}},[t._v(t._s(t.$t("slice.start")))]):t._e()],1),t._v(" "),i("div",{staticClass:"analylist"},[i("div",{staticClass:"quality"},[t._m(0),t._v(" "),i("div",{staticClass:"quality-detail"},[i("p",{staticStyle:{width:"50%",margin:"0"}},[t._v("清 晰 度："+t._s(t.slice.clarity?(100*t.slice.clarity).toFixed(2)+"%":"-"))]),t._v(" "),i("p",{staticStyle:{width:"50%",margin:"0"}},[t._v("扫描倍数："+t._s(t.slice.objective_rate||"-"))])])]),t._v(" "),i("h2",[i("span",{class:t.auto?"auto":"",on:{click:function(e){t.auto=!0}}},[t._v("AI处理")]),t._v(" "),i("span",{class:t.auto?"":"noauto",on:{click:function(e){t.auto=!1}}},[t._v("手动处理")])]),t._v(" "),t.auto?i("v-analyroi",{staticClass:"table",attrs:{slice:t.slice,ROIS:t.aiFatherRois,ave:t.ave,currentRois:t.curRois},on:{curROI:function(e,i){return t.curROIChange(e,i)+t.listChangeCurrent()},delRoi:function(e){return t.delCurRoi(e)},roiChanged:t.roiChanged,acceptAI:function(e){return t.reCheck(e?e+"%":"")},closecontextmenu:function(e){t.ki67Anno=null}}}):t._e(),t._v(" "),t.auto?t._e():i("v-roi",{staticClass:"manualroi",attrs:{roilist:t.rightRoilist,currentRois:t.curRois},on:{curROI:function(e,i){return t.curROIChange(e,i)+t.listChangeCurrent()},delRoi:function(e){return t.delCurRoi(e)},roiChanged:t.roiChanged}}),t._v(" "),!t.showbutton&&t.auto?i("div",{staticClass:"loding"},[i("div",{staticClass:"video"},[i("img",{attrs:{src:"/static/video/loading.gif"}}),t._v(" "),0==t.lineup?i("div",{staticClass:"lineup"},[t._v("正在处理...")]):t._e(),t._v(" "),t.lineup>0?i("div",{staticClass:"lineup"},[t._v(t._s(t.$t("slice.lineup"))+" "),i("span",{staticStyle:{color:"#4C9FFA","font-size":"18px","font-weight":"bolder"}},[t._v(t._s(t.lineup))]),t._v(" "+t._s(t.$t("slice.position")))]):t._e()]),t._v(" "),i("div",{staticClass:"cancel",on:{click:t.canceltesk}},[t._v(t._s(t.$t("slice.cancelTasks")))])]):t._e()],1)])},staticRenderFns:[function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"title"},[e("span",[this._v("AI质控")])])}]};var ut=i("VU/8")(lt,ct,!1,function(t){i("BNEt")},"data-v-5660a7fa",null).exports,ht={data(){return{checkResult:this.slice.alg===this.slice.toolType&&this.slice.check_result.slice(0,this.slice.check_result.length-1)||null}},methods:{changeResult(t){this.checkResult=t,this.$emit("acceptAI",t)},changeImage(t){this.$set(t,"image",1-(t.image||0)),this.$emit("roiChanged","image",[t])},checkall(){if(!this.ROIS.length)return;let t=this.ROIS.every(t=>!!t.image),e=this.ROIS.map(e=>{return{id:e.id,image:t?0:1}});this.$emit("roiChanged","image",e)},del(t){this.$confirm(this.$t("analaysisPanel.delete"),{confirmButtonText:this.$t("confirm.confirm"),cancelButtonText:this.$t("confirm.quit"),type:"warning"}).then(()=>{this.$emit("delRoi",t)},()=>{})}},props:["ROIS","currentRois","slice","ave"]},dt={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"ki67hotrois"},[t.ROIS?i("div",{staticClass:"table"},[i("div",{staticClass:"top"},[i("div",{staticClass:"left"},[i("div",[i("span",{staticClass:"uncheck",class:{checked:t.ROIS.every(function(t){return!!t.image})},on:{click:t.checkall}}),t._v("\n                    ROI\n                ")])]),t._v(" "),i("div",[t._v("阳性肿瘤")]),t._v(" "),i("div",[t._v(t._s(t.$t("slice.total")))]),t._v(" "),i("div",[t._v(t._s(t.$t("slice.index")))]),t._v(" "),i("div",[t._v(t._s(t.$t("slice.deleted")))])]),t._v(" "),i("div",{staticClass:"rois"},t._l(t.ROIS,function(e,s){return i("div",{key:s,staticClass:"row",class:{curRoi:t.currentRois[e.id]},on:{click:function(i){t.$emit("curROI",e,i.shiftKey),t.$emit("closecontextmenu")}}},[i("div",{staticClass:"left"},[i("div",[i("span",{staticClass:"uncheck",class:{checked:e.image},on:{click:function(i){return i.stopPropagation(),t.changeImage(e)}}}),t._v("\n                        "+t._s(s+1)+"\n                    ")])]),t._v(" "),i("div",[t._v(t._s(e.aiResult.pos_tumor))]),t._v(" "),i("div",[t._v(t._s(e.aiResult.total))]),t._v(" "),i("div",[t._v(t._s((100*e.aiResult.index).toFixed(2)+"%"))]),t._v(" "),i("div",[i("em",{attrs:{title:t.$t("upload.delete")},on:{click:function(i){return i.stopPropagation(),t.del(e)}}})])])}),0)]):t._e(),t._v(" "),t.ROIS?i("div",{staticClass:"areabtm"},[i("div",{staticClass:"result",staticStyle:{color:"red"}},[i("div",[t._v("\n                阳性肿瘤细胞\n            ")]),t._v(" "),i("div",[t._v("\n                "+t._s(t.ROIS.filter(function(t){return t.image}).map(function(t){return t.aiResult.pos_tumor}).reduce(function(t,e){return t+e},0))+"\n            ")])]),t._v(" "),i("div",{staticClass:"result",staticStyle:{color:"green"}},[i("div",[t._v("\n                阴性肿瘤细胞\n            ")]),t._v(" "),i("div",[t._v("\n                "+t._s(t.ROIS.filter(function(t){return t.image}).map(function(t){return t.aiResult.neg_tumor}).reduce(function(t,e){return t+e},0))+"\n            ")])]),t._v(" "),i("div",{staticClass:"result",staticStyle:{color:"#C280FF"}},[i("div",[t._v("\n                非肿瘤细胞\n            ")]),t._v(" "),i("div",[t._v("\n                "+t._s(t.ROIS.filter(function(t){return t.image}).map(function(t){return t.aiResult.normal_cell}).reduce(function(t,e){return t+e},0))+"\n            ")])]),t._v(" "),i("div",{staticClass:"result"},[i("div",[t._v("\n                综合指数\n            ")]),t._v(" "),i("div",[t._v("\n                "+t._s(t.ave)+"%\n            ")])])]):t._e(),t._v(" "),i("div",{staticClass:"recheck"},[i("div",{staticClass:"doc-check"},[i("i",[t._v("医生复核")]),t._v(" "),i("span",{on:{click:function(e){return t.changeResult("")}}},[t._v("清空")]),t._v(" "),i("span",{on:{click:function(e){return t.changeResult(t.ave)}}},[t._v("采纳AI建议")])]),t._v(" "),i("div",{staticClass:"check-result"},[t._v("指数"),i("input",{directives:[{name:"model",rawName:"v-model",value:t.checkResult,expression:"checkResult"}],domProps:{value:t.checkResult},on:{blur:function(e){return t.changeResult(t.checkResult)},input:function(e){e.target.composing||(t.checkResult=e.target.value)}}}),t._v("%")])])])},staticRenderFns:[]};var pt=i("VU/8")(ht,dt,!1,function(t){i("CBAI"),i("ObRd")},null,null).exports,vt={data:()=>({labeltree:[{id:1,label:"阳性肿瘤"},{id:0,label:"阴性肿瘤"},{id:2,label:"非肿瘤"}],roiTypeOpitions:{0:"green",1:"red",2:"#C280FF"},defaultColor:"red",defaultType:1,moveRois:{}}),methods:{moveRoi(t,e){var i;t?t.length?i=t:e&&this.moveRois[t.id]?(delete this.curRois[t.id],i=[]):i=[t]:i=[],this.moveRois=Object.assign({},e&&this.moveRois,...i.filter(t=>!t.aiResult||!t.aiResult.whole_slide).map(t=>({[t.id]:t}))),this.curRois={}},moveToCenter(){if(Object.keys(this.moveRois).length){var t=[].concat.apply([],Object.values(this.moveRois).map(t=>t.path.x)),e=[].concat.apply([],Object.values(this.moveRois).map(t=>t.path.y));t.length?this.centerRegion=[Math.min.apply(null,t),Math.min.apply(null,e),Math.max.apply(null,t),Math.max.apply(null,e)]:this.centerRegion=null,this.$refs.osd.scope=null}}},computed:{ave(){return(this.aiFatherRois.filter(t=>t.image).map(t=>t.aiResult.pos_tumor).reduce((t,e)=>t+e,0)/(this.aiFatherRois.filter(t=>t.image).map(t=>t.aiResult.total).reduce((t,e)=>t+e,0)||1)*100).toFixed(2)}},props:["slice","record"],components:{"v-dragon":v.a,"v-analyroi":pt,"v-roi":m,"v-menus":V},mixins:[G.a]},gt={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"cnt",attrs:{tabIndex:0},on:{keydown:t.keydown}},[i("div",{staticClass:"analyright",on:{mousewheel:function(e){t.ki67Anno=null},mousedown:function(e){t.ki67Anno=null}}},[i("v-dragon",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],ref:"osd",staticClass:"dragon",attrs:{record:t.record,slice:t.slice,roilist:t.leftRoilist,curRois:t.curRois,penColor:t.auto?"grey":"yellow",centerRegion:t.centerRegion,position:t.position,showMppGuide:t.showMppGuide,cellArea:110,"element-loading-text":"处理中，请耐心等待","element-loading-spinner":"el-icon-loading","element-loading-background":"rgba(0, 0, 0, 0.5)"},on:{curROI:t.curROIChange,draw:t.draw,delRoi:function(e){return t.delCurRoi(e)},position:function(e,i,s){t.$set(t.position,"offx",e),t.$set(t.position,"offy",i),t.$set(t.position,"zoom",s),t.$set(t.slice,"position",t.position)},closeMppGuide:function(e){t.showMppGuide=!1},changeMpp:function(e){return t.drawMpp=e},clickDraw:t.clickDraw,getRoi:function(e){return t.getRoi(e)},roiChanged:t.roiChanged,parentId:function(e){return t.parentId=e},contextmenu:function(e,i){return t.showMenu(e,i)}}},[t.ki67Anno?i("div",{staticStyle:{position:"absolute"},style:{left:t.menuPosition.x+"px",top:t.menuPosition.y+"px"}},[i("v-menus",{attrs:{pos:t.ki67Anno,menus:t.labeltree,currentItem:t.currentItem,newover:t.newover},on:{chosen:function(e){return t.setAnnotation(e)}}})],1):t._e()]),t._v(" "),t.showbutton?i("button",{on:{click:function(e){return t.isDrawMpp()}}},[t._v(t._s(t.$t("slice.start")))]):t._e()],1),t._v(" "),i("div",{staticClass:"analylist"},[i("div",{staticClass:"quality"},[t._m(0),t._v(" "),i("div",{staticClass:"quality-detail"},[i("p",{staticStyle:{width:"50%",margin:"0"}},[t._v("清 晰 度："+t._s(t.slice.clarity?(100*t.slice.clarity).toFixed(2)+"%":"-"))]),t._v(" "),i("p",{staticStyle:{width:"50%",margin:"0"}},[t._v("扫描倍数："+t._s(t.slice.objective_rate||"-"))])])]),t._v(" "),i("h2",[i("span",{class:t.auto?"auto":"",on:{click:function(e){t.auto=!0}}},[t._v("AI处理")]),t._v(" "),i("span",{class:t.auto?"":"noauto",on:{click:function(e){t.auto=!1}}},[t._v("手动处理")])]),t._v(" "),t.auto?i("v-analyroi",{attrs:{slice:t.slice,ROIS:t.aiFatherRois,ave:t.ave,currentRois:t.moveRois},on:{curROI:function(e,i){return t.moveRoi(e,i)+t.moveToCenter()},delRoi:function(e){return t.delCurRoi(e)},roiChanged:t.roiChanged,acceptAI:function(e){return t.reCheck(e?e+"%":"")},closecontextmenu:function(e){t.ki67Anno=null}}}):t._e(),t._v(" "),t.auto?t._e():i("v-roi",{staticClass:"manualroi",attrs:{roilist:t.rightRoilist,currentRois:t.curRois},on:{curROI:function(e,i){return t.curROIChange(e,i)+t.listChangeCurrent()},delRoi:function(e){return t.delCurRoi(e)},roiChanged:t.roiChanged}}),t._v(" "),!t.showbutton&&t.auto?i("div",{staticClass:"loding"},[i("div",{staticClass:"video"},[i("img",{attrs:{src:"/static/video/loading.gif"}}),t._v(" "),0==t.lineup?i("div",{staticClass:"lineup"},[t._v("正在处理...")]):t._e(),t._v(" "),t.lineup>0?i("div",{staticClass:"lineup"},[t._v(t._s(t.$t("slice.lineup"))+" "),i("span",{staticStyle:{color:"#4C9FFA","font-size":"18px","font-weight":"bolder"}},[t._v(t._s(t.lineup))]),t._v(" "+t._s(t.$t("slice.position")))]):t._e()]),t._v(" "),i("div",{staticClass:"cancel",on:{click:t.canceltesk}},[t._v(t._s(t.$t("slice.cancelTasks")))])]):t._e()],1)])},staticRenderFns:[function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"title"},[e("span",[this._v("AI质控")])])}]};var ft=i("VU/8")(vt,gt,!1,function(t){i("RybU")},"data-v-15058b02",null).exports,mt={data:()=>({}),methods:{getCount(t,e){return this.sRois[t.id]?this.sRois[t.id].filter(t=>t.type==e).length:0},checkall(){let t=this.ROIS.every(t=>!!t.image);this.ROIS.forEach(e=>this.$set(e,"image",!t)),this.$emit("closecontextmenu")},change(t,e,i){this.$emit("closecontextmenu"),this.$set(t,"image",i)},del(t){this.$emit("closecontextmenu"),this.$confirm(this.$t("analaysisPanel.delete"),{confirmButtonText:this.$t("confirm.confirm"),cancelButtonText:this.$t("confirm.quit"),type:"warning"}).then(()=>{this.$emit("delRoi",t)},()=>{})}},props:["showbutton","ROIS","currentRois","sRois","slice"]},_t={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"tctrois"},[t.ROIS?t._e():i("div",{staticClass:"ifshowtables"},[t._v(t._s(t.$t("slice.noanalysis")))]),t._v(" "),t.ROIS?i("div",{staticClass:"table"},[i("div",{staticClass:"top"},[i("div",{staticClass:"left"},[i("div",[i("span",{staticClass:"uncheck",class:{checked:t.ROIS.every(function(t){return!!t.image})},on:{click:t.checkall}}),t._v("\n                    ROI\n                ")])]),t._v(" "),i("div",[t._v(t._s(t.$t("slice.heterogeneousRegion")))]),t._v(" "),i("div",[t._v(t._s(t.$t("slice.total")))]),t._v(" "),i("div",[t._v(t._s(t.$t("slice.index")))]),t._v(" "),i("div",[t._v(t._s(t.$t("slice.deleted")))])]),t._v(" "),i("div",{staticClass:"rois"},t._l(t.ROIS,function(e,s){return i("div",{key:s,staticClass:"row",class:{curRoi:t.currentRois[e.id]},on:{click:function(i){t.$emit("closecontextmenu"),t.$emit("curROI",e,i.shiftKey)}}},[i("div",{staticClass:"left"},[i("div",[i("span",{staticClass:"uncheck",class:{checked:e.image},on:{click:function(i){i.stopPropagation(),t.change(e,"image",1-(e.image||0))}}}),t._v("\n                        "+t._s(s+1)+"\n                    ")])]),t._v(" "),i("div",[t._v(t._s(t.getCount(e,3)||"0"))]),t._v(" "),i("div",[t._v(t._s(t.getCount(e,1)+t.getCount(e,3)||"0"))]),t._v(" "),i("div",[t._v(t._s((t.getCount(e,3)/(t.getCount(e,1)+t.getCount(e,3)||1)*100).toFixed(1)+"%"))]),t._v(" "),i("div",[i("em",{attrs:{title:t.$t("upload.delete")},on:{click:function(i){return i.stopPropagation(),t.del(e)}}})])])}),0)]):t._e(),t._v(" "),t.ROIS?i("div",{staticClass:"tctbtm"},[i("div",{staticClass:"AiResult"},[i("div",[t._v("\n                "+t._s(t.$t("slice.AiResult"))+"\n            ")]),t._v(" "),i("div",{class:{error:"error"==t.slice.ki67.diagnosis}},[t._v("\n                "+t._s((t.ROIS.filter(function(t){return t.image}).map(function(e){return t.getCount(e,3)}).reduce(function(t,e){return t+e},0)/(t.ROIS.filter(function(t){return t.image}).map(function(e){return t.getCount(e,1)+t.getCount(e,3)}).reduce(function(t,e){return t+e},0)||1)*100).toFixed(1)+"%")+"\n            ")])]),t._v(" "),i("div",{staticClass:"confidence"},[i("div",[t._v(t._s(t.$t("slice.confidence")))]),t._v(" "),i("div",["error"!=t.slice.ki67.diagnosis&&null!=t.slice.ki67.diagnosis?i("div",[t._v("100"),i("span",[t._v("%")])]):t._e(),t._v(" "),"error"==t.slice.ki67.diagnosis?i("div",[t._v("0")]):t._e()])]),t._v(" "),i("div",{staticClass:"interactive"},[i("div",[t._v(t._s(t.$t("slice.interaction")))]),t._v(" "),i("el-radio-group",{staticClass:"radios",model:{value:t.slice.ki67.computer,callback:function(e){t.$set(t.slice.ki67,"computer",e)},expression:"slice.ki67.computer"}},[i("el-radio",{attrs:{label:!0}},[t._v("YES")]),t._v(" "),i("el-radio",{attrs:{label:!1}},[t._v("NO")]),t._v(" "),i("el-radio",{attrs:{label:"unsure"}},[t._v("UNSURE")])],1)],1)]):t._e()])},staticRenderFns:[]};var yt=i("VU/8")(mt,_t,!1,function(t){i("bw5Q"),i("EZ6I")},null,null).exports,Rt={name:"v-menus",props:["menus","currentItem","pos","newover"],data(){var t={position:{},over:this.newover};return this.pos&&"top"==this.pos.vd?t.position.top=0:this.pos&&"bottom"==this.pos.vd&&(t.position.bottom=0),this.pos&&"left"==this.pos.hd?t.position.left=0:this.pos&&"right"==this.pos.hd&&(t.position.right=0),t},methods:{mouseOver(t){this.over=t}},mounted(){},computed:{curWidth:()=>document.querySelector(".ms").clientWidth+5},components:{"v-menus":Ct}},bt={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"container ms",style:t.position},t._l(t.menus,function(e,s){return i("div",{key:s,staticClass:"item",class:t.over==e.id?"active":"",on:{mouseover:function(i){return t.mouseOver(e.id)},mousedown:function(t){return t.stopPropagation(),t},click:function(i){i.stopPropagation(),!e.children&&t.$emit("chosen",[e.id,e.label])}}},[t.currentItem&&t.currentItem.split(":")[0]==e.id?i("span",{staticClass:"left",attrs:{id:t.currentItem,menuid:e.id}}):t._e(),t._v("\n        "+t._s(e.label)+"\n        "),e.id==t.over&&e.children?i("v-menus",{key:s,style:{transform:"translate("+("left"==t.pos.hd?t.curWidth+"px":-t.curWidth+"px")+",0"},attrs:{menus:e.children,newover:t.currentItem.split(":")[0],currentItem:t.currentItem&&t.currentItem.split(":")[1]+":",pos:t.pos},on:{chosen:function(i){return t.$emit("chosen",e.id+":"+i)}}}):t._e(),t._v(" "),e.children?i("span",{staticClass:"right"}):t._e()],1)}),0)},staticRenderFns:[]};var Ct=i("VU/8")(Rt,bt,!1,function(t){i("Ac1S")},"data-v-29485a13",null).exports;let wt;var kt={data(){return{loopHandler:0,result:{},auto:!1,centerRegion:null,curRois:{},showbutton:!0,ki67Anno:null,labeltree:[{id:"ki67negativetumorregion",label:"阴性肿瘤区域"},{id:"ki67negativelymphregion",label:"阴性淋巴区域"},{id:"ki67positiontumorregion",label:"阳性肿瘤区域"},{id:"ki67positionlymphregion",label:"阳性淋巴区域"},{id:"mucousnecrosisregion",label:"粘液坏死区域"},{id:"interstitialregion",label:"间质区域"},{id:"normalbreastregion",label:"正常乳腺区域"},{id:"ki67regionnone",label:"其它"},{id:"下载Roi",label:"下载Roi"}],position:{offx:this.slice.position?this.slice.position.offx:.5,offy:this.slice.position?this.slice.position.offy:.5*this.slice.height/this.slice.width,zoom:this.slice.position?this.slice.position.zoom:null},lineup:null,addAnnRoi:!1,menuPosition:{},totalArea:"",showMppGuide:!1,drawMpp:null}},computed:{getCommonAnnotation(){var t=Object.values(this.curRois);return t[0]&&t.every(t=>t.jgResult)&&t.every(e=>e.jgResult==t[0].jgResult)?t[0].jgResult.split(",")[0]:""}},methods:{isDrawMpp(){/\.(png|jpg|jpeg|tiff|tif|bmp)$/.test(this.slice.filename)?this.showMppGuide=!0:this.startAnalyze()},mouseDown(t){this.ki67Anno=null},checkjgResult:t=>(""+t).split(",")[0],noEmoji(t){t.target.value=t.target.value.replace(/[^\u0020-\u007E\u00A0-\u00BE\u2E80-\uA4CF\uF900-\uFAFF\uFE30-\uFE4F\uFF00-\uFFEF\u0080-\u009F\u2000-\u201f\u2026\u2022\u20ac\r\n]/g,"")},curROIChange(t,e){var i;!t||"grey"==t.color&&this.totalArea>5e5?(i=[],this.totalArea=0):t.length?i=t:e&&this.curRois[t.id]?(delete this.curRois[t.id],i=[]):i=[t],this.curRois=Object.assign({},e&&this.curRois,...i.map(t=>"grey"==t.color?{[t.id]:Object.assign({},t,{editable:!1})}:{[t.id]:t}))},listChangeCurrent(){var t=[].concat.apply([],Object.values(this.curRois).map(t=>t.path.x)),e=[].concat.apply([],Object.values(this.curRois).map(t=>t.path.y));t.length?this.centerRegion=[Math.min.apply(null,t),Math.min.apply(null,e),Math.max.apply(null,t),Math.max.apply(null,e)]:this.centerRegion=null},getArea(t){for(var e=0,i=0;i<t.x.length-2;i++){if(i+2<t.x.length)var s=[t.x[0],t.y[0]],n=[t.x[i+1],t.y[i+1]],a=[t.x[i+2],t.y[i+2]];e+=(Math.abs(s[0]*n[1])+Math.abs(n[0]*a[1])+Math.abs(a[0]*s[1])-Math.abs(s[0]*a[1])-Math.abs(n[0]*s[1])-Math.abs(a[0]*n[1]))/2}return e=Math.round(Math.abs(e)*Math.pow(this.slice.mppx||.242042,2))},draw(t){this.totalArea=this.getArea(t.path);for(var e=0;e<this.slice.ki67.result.length;e++)this.totalArea+=this.getArea(this.slice.ki67.result[e].path);if(this.auto){if(t.id=(Math.random()+"").substr(2,6),"freepen"===t.method&&(t.simplify=5),this.totalArea>5e5)return void this.$message({message:"ROI总面积不能大于0.5mm²",type:"warning"});t=Object.assign({},t,{image:""});var i=[...this.slice.ki67.result,t];this.$set(this.slice.ki67,"result",i)}else t.id=(Math.random()+"").substr(2,9),"freepen"===t.method&&(t.simplify=2),this.slice.roilist=[...this.slice.roilist,t]},clearSimplify(t){this.$set(this.slice,"roilist",this.slice.roilist.map(e=>(e.id===t.id&&(e.path.x=t.x,e.path.y=t.y,e.simplify&&delete e.simplify),e))),this.$set(this.slice.ki67,"result",this.slice.ki67.result.map(e=>(e.id===t.id&&(e.path.x=t.x,e.path.y=t.y,e.simplify&&delete e.simplify),e)))},async delCurRoi(t){let e={};for(var i of(t?(e={[t.id]:t},this.curRois[t.id]&&(delete this.curRois[t.id],this.curRois=Object.assign({},this.curRois))):(e=this.curRois,await this.$confirm(this.$t("analaysisPanel.delete"),{confirmButtonText:this.$t("confirm.confirm"),cancelButtonText:this.$t("confirm.quit"),type:"warning"}),this.curRois={}),Object.keys(e)))console.log(i),6==i.length?(this.slice.ki67.result=this.slice.ki67.result.filter(t=>t.id!=i),delete this.slice.ki67.airesult[i]):this.slice.ki67.result.map(t=>{void 0!=this.slice.ki67.airesult[t.id]&&(this.slice.ki67.airesult[t.id]=this.slice.ki67.airesult[t.id].filter(t=>!e[t.id]))});this.slice.roilist=this.slice.roilist.filter(t=>!e[t.id])},roiChanged(){for(var t in this.curRois)this.curRois[t]=Object.assign({},this.curRois[t]);var e=Object.assign({},this.curRois),i=Object.assign({},i,...Object.values(e).filter(t=>"grey"!=t.color).map(t=>({[t.id]:t})));this.$set(this.slice,"roilist",this.slice.roilist.map(t=>{var e=i[t.id];return e?(delete i[t.id],e):t}).concat(Object.values(i))),this.slice.ki67.result.map(t=>{this.slice.ki67.airesult[t.id]=(this.slice.ki67.airesult[t.id]||[]).filter(t=>!i[t.id])})},setAnnotation(t){if(this.ki67Anno=null,"下载Roi"!=t[0]){var e;for(var i in e="string"!=typeof t?t[0]+","+t[1]:t,this.curRois){let t=this.curRois[i];this.curRois[i]=Object.assign({},t,{jgResult:e,remark:e.split(",")[e.split(",").length-1]})}wt=e;var s=Object.assign({},this.curRois),n=Object.assign({},n,...Object.values(s).filter(t=>"grey"!=t.color).map(t=>({[t.id]:t})));this.$set(this.slice,"roilist",this.slice.roilist.map(t=>{var e=n[t.id];return e?(delete n[t.id],e):t}).concat(Object.values(n))),this.slice.ki67.result.map(t=>{this.slice.ki67.airesult[t.id]=(this.slice.ki67.airesult[t.id]||[]).filter(t=>!n[t.id])}),this.curRois={}}else{let t=Object.values(this.curRois)[0].path,e={};if(t.x.length<=4)e[0]=[],e[1]=[],e[0].push(t.x[0]),e[0].push(t.y[0]),e[1].push(t.x[2]),e[1].push(t.y[2]);else{e[0]=[],e[1]=[];var a=Math.max.apply(Math,t.x),o=Math.min.apply(Math,t.x),r=Math.max.apply(Math,t.y),l=Math.min.apply(Math,t.y);e[0].push(o),e[0].push(l),e[1].push(a),e[1].push(r)}window.open("/aipath/api/files/screenshot?caseid="+this.record.id+"&fileid="+this.slice.id+"&filename="+encodeURIComponent(this.slice.filename)+"&roi=[["+e[0][0]+","+e[0][1]+"],["+e[1][0]+","+e[1][1]+"]] &roiid="+Object.keys(this.curRois)[0])}},showMenu(t,e){if((!t.type||t.button)&&(t.preventDefault(),0!=Object.keys(this.curRois).length&&!Object.keys(this.curRois).every(t=>t!=e.id)&&!this.slice.ki67.result.some(t=>t.id==e.id))){var i=t.currentTarget,s=t.offsetX,n=t.offsetY,a=i.offsetWidth,o=i.offsetHeight;this.ki67Anno={},this.ki67Anno.hd=s>a/2?"right":"left",this.ki67Anno.vd=n>o/2?"bottom":"top",this.menuPosition={x:s,y:n}}},getAlgorithmResult(t=this.record.id,e=this.slice.id,i=this.slice.filename){Object(s.b)("ai/getresult",{caseid:t,fileid:e,filename:i,type:"ki67",other:JSON.stringify(this.slice.ki67.result.map(t=>({id:t.id,x:t.path.x,y:t.path.y})))}).then(t=>{this.lineup=t.data.rank,t.data.done?(this.showbutton=!0,this.loopHandler=0,this.$set(this.slice,"type","ki67"),-1!=t.data.rank?(this.flag="error",this.$set(this.slice.ki67,"diagnosis","error")):(Object.keys(t.data.result).filter(t=>!this.slice.ki67.result.find(e=>e.id==t)).map(e=>delete t.data.result[e]),this.slice.ki67.airesult=t.data.result,[].concat.apply([],Object.values(this.slice.ki67.airesult)).forEach(t=>t.id=(""+Math.random()).substr(2,8)),this.$set(this.slice.ki67,"diagnosis",1)),this.updateRecord()):(this.showbutton=!1,this.loopHandler=setTimeout(()=>this.getAlgorithmResult(),5e3))})},startAnalyze(t=this.record.id,e=this.slice.id,i=this.slice.filename){0!=this.slice.ki67.result.length?(this.$set(this.slice.ki67,"airesult",{}),this.$set(this.slice.ki67,"diagnosis",null),this.slice.started=!0,this.record.started=!0,this.showbutton=!1,this.auto=!0,this.slice.ki67.result.map(t=>t.image=!0),Object.values(this.curRois).map(t=>this.slice.roilist.every(e=>t.id!=e.id)&&this.slice.ki67.result.every(e=>t.id!=e.id)?delete this.curRois[t.id]:""),Object(s.b)("ai/start",{caseid:t,fileid:e,filename:i,type:"ki67",other:JSON.stringify(this.slice.ki67.result.map(t=>({id:t.id,x:t.path.x,y:t.path.y})))}).then(t=>{this.getAlgorithmResult()}).catch(t=>console.log(t)),this.updateRecord()):this.$message({message:"请先绘制ROI,再进行处理",type:"warning"})},updateRecord(){this.$emit("save","auto")},canceltesk(){Object(s.b)("ai/revokeTask",{caseid:this.record.id,fileid:this.slice.id,type:"ki67",other:""}).then(t=>{0==t.code&&(clearTimeout(this.loopHandler),this.loopHandler=0,this.showbutton=!0,this.slice.started=!1,this.record.started=!1,this.slice.ki67.result.map(t=>t.image=!1),this.updateRecord())}).catch(t=>console.log(t))},keydown(t){"Delete"!=t.key&&"Backspace"!=t.key||!Object.keys(this.curRois).length||this.delCurRoi()}},beforeMount(){this.slice.ki67||(this.$set(this.slice,"ki67",{}),this.$set(this.slice.ki67,"result",[]),this.$set(this.slice.ki67,"airesult",{})),this.slice.ki67&&!this.slice.ki67.airesult&&this.$set(this.slice.ki67,"airesult",{});let t=[];this.slice.roilist.forEach(e=>{const i=t.findIndex(t=>e.id===t.id);-1!==i?t[i].value=t[i].value+e.value:t.push(e)}),this.slice.roilist=t,this.$emit("save","auto")},mounted(){this.slice.started&&this.slice.ki67&&null===this.slice.ki67.diagnosis&&this.getAlgorithmResult(),window.addEventListener("online",()=>{this.showbutton||this.getAlgorithmResult()})},beforeDestroy(){clearTimeout(this.loopHandler),this.loopHandler=0},watch:{"slice.id":{handler(){clearTimeout(this.loopHandler),this.loopHandler=0}},"slice.roilist":{handler(t){t.filter(t=>!!t.jgResult).length>1500&&(this.addAnnRoi=!0,setTimeout(()=>this.addAnnRoi=!1,2500),Object.values(this.curRois).map(t=>delete this.curRois[t.id]),t.pop())}},drawMpp:{handler(t){t&&(this.$set(this.slice,"mppx",t),this.$set(this.slice,"mppy",t),this.$emit("save","auto"),this.startAnalyze())}}},props:["slice","record"],components:{"v-menus":Ct,"v-dragon":v.a,"v-analyroi":yt,"v-roi":m}},xt={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"cnt"},[i("div",{staticClass:"analyright",attrs:{tabIndex:0},on:{mousewheel:function(e){t.ki67Anno=null},keydown:t.keydown}},[i("v-dragon",{staticClass:"dragon",attrs:{record:t.record,slice:t.slice,roilist:(this.slice.ki67?this.slice.ki67.result:[]).map(function(t){return Object.assign({method:"rectangle"},t,{editable:!1,color:"grey"})}).concat((this.slice.ki67?[].concat.apply([],Object.values(this.slice.ki67.airesult)):[]).map(function(t){return{id:t.id,path:{x:t.x,y:t.y},color:{0:"purple",1:"green",2:"yellow",3:"red"}[t.type],method:"rectangle",editable:!0,selectable:!1,width:1}}),this.slice.roilist.map(function(e){return Object.assign({method:"rectangle"},e,{color:{ki67positiontumorregion:"red",ki67negativetumorregion:"green",ki67negativelymphregion:"purple",ki67positionlymphregion:"blue",interstitialregion:"orange",normalbreastregion:"pink",mucousnecrosisregion:"#000",ki67regionnone:"#11e6e6"}[t.checkjgResult(e.jgResult)]||"yellow"})})),curRois:t.curRois,penColor:t.auto?"grey":"yellow",centerRegion:t.centerRegion,position:t.position,showMppGuide:t.showMppGuide,cellArea:116},on:{curROI:t.curROIChange,draw:t.draw,delRoi:function(e){return t.delCurRoi(e)},contextmenu:function(e,i){return t.showMenu(e,i)},roiChanged:t.roiChanged,mousedown:t.mouseDown,position:function(e,i,s){t.$set(t.position,"offx",e),t.$set(t.position,"offy",i),t.$set(t.position,"zoom",s),t.$set(t.slice,"position",t.position)},closeMppGuide:function(e){t.showMppGuide=!1},changeMpp:function(e){return t.drawMpp=e},clearSimplify:t.clearSimplify}},[t.ki67Anno?i("div",{staticStyle:{position:"absolute"},style:{left:t.menuPosition.x+"px",top:t.menuPosition.y+"px"}},[i("v-menus",{attrs:{pos:t.ki67Anno,menus:t.labeltree,currentItem:t.getCommonAnnotation},on:{chosen:t.setAnnotation}})],1):t._e(),t._v(" "),t.addAnnRoi?i("div",{staticClass:"addannroi"},[t._v("标注roi数量不能超出1500个")]):t._e()]),t._v(" "),t.showbutton?i("button",{on:{click:function(e){return t.isDrawMpp()}}},[t._v(t._s(t.$t("slice.start")))]):t._e()],1),t._v(" "),i("div",{staticClass:"analylist",on:{click:function(e){t.ki67Anno=null}}},[i("h2",[i("span",{class:t.auto?"auto":"",on:{click:function(e){t.auto=!0}}},[t._v(t._s(t.$t("analyze.airoi")))]),t._v(" "),i("span",{class:t.auto?"":"noauto",on:{click:function(e){t.auto=!1}}},[t._v(t._s(t.$t("analyze.roi")))])]),t._v(" "),t.auto?i("v-analyroi",{staticClass:"table ki67table",attrs:{ROIS:this.slice.ki67?this.slice.ki67.result:[],sRois:this.slice.ki67?this.slice.ki67.airesult:{},slice:t.slice,showbutton:t.showbutton,currentRois:t.curRois},on:{curROI:function(e,i){return t.curROIChange(e,i)+t.listChangeCurrent()},delRoi:function(e){return t.delCurRoi(e)},closecontextmenu:function(e){t.ki67Anno=null}}}):t._e(),t._v(" "),t.auto?t._e():i("v-roi",{staticClass:"manualroi",attrs:{roilist:t.slice.roilist,currentRois:t.curRois},on:{curROI:function(e,i){return t.curROIChange(e,i)+t.listChangeCurrent()},delRoi:function(e){return t.delCurRoi(e)}}}),t._v(" "),!t.showbutton&&t.auto?i("div",{staticClass:"loding"},[i("div",{staticClass:"video"},[i("img",{attrs:{src:"/static/video/loading.gif"}}),t._v(" "),0==t.lineup?i("div",{staticClass:"lineup"},[t._v("正在处理...")]):t._e(),t._v(" "),t.lineup>0?i("div",{staticClass:"lineup"},[t._v(t._s(t.$t("slice.lineup"))+" "),i("span",{staticStyle:{color:"#4C9FFA","font-size":"18px","font-weight":"bolder"}},[t._v(t._s(t.lineup))]),t._v(" "+t._s(t.$t("slice.position")))]):t._e()]),t._v(" "),i("div",{staticClass:"cancel",on:{click:t.canceltesk}},[t._v(t._s(t.$t("slice.cancelTasks")))])]):t._e(),t._v(" "),0==t.auto?i("div",{staticClass:"opinio"},[i("h1",[t._v("\n                "+t._s(t.$t("analyze.point"))+"\n            ")]),t._v(" "),i("textarea",{directives:[{name:"model",rawName:"v-model",value:t.record.opinion,expression:"record.opinion"}],attrs:{placeholder:t.$t("report.pointremind"),maxlength:"300"},domProps:{value:t.record.opinion},on:{input:[function(e){e.target.composing||t.$set(t.record,"opinion",e.target.value)},t.noEmoji]}})]):t._e()],1)])},staticRenderFns:[]};var $t=i("VU/8")(kt,xt,!1,function(t){i("Fjyx")},"data-v-ce699528",null).exports,It={data(){return{centerRegion:null,curRois:{},roilist:[],labeltree:[{id:"阳性肿瘤区域",label:"阳性肿瘤区域"},{id:"阴性肿瘤区域",label:"阴性肿瘤区域"},{id:"组织细胞区域",label:"组织细胞区域"},{id:"淋巴细胞区域",label:"淋巴细胞区域"},{id:"坏死细胞区域",label:"坏死细胞区域"},{id:"免疫细胞区域",label:"免疫细胞区域"},{id:"不确定",label:"不确定"}],pdl1Anno:null,position:{offx:this.slice.position?this.slice.position.offx:.5,offy:this.slice.position?this.slice.position.offy:.5*this.slice.height/this.slice.width,zoom:this.slice.position?this.slice.position.zoom:null},menuPosition:{}}},computed:{getCommonAnnotation(){var t=Object.values(this.curRois);return t[0]&&t.every(t=>t.jgResult)&&t.every(e=>e.jgResult==t[0].jgResult)?t[0].jgResult.split(",")[0]:""}},methods:{mouseDown(t){this.pdl1Anno=null},noEmoji(t){t.target.value=t.target.value.replace(/[^\u0020-\u007E\u00A0-\u00BE\u2E80-\uA4CF\uF900-\uFAFF\uFE30-\uFE4F\uFF00-\uFFEF\u0080-\u009F\u2000-\u201f\u2026\u2022\u20ac\r\n]/g,"")},curROIChange(t,e){var i;t?t.length?i=t:e&&this.curRois[t.id]?(delete this.curRois[t.id],i=[]):i=[t]:i=[],this.curRois=Object.assign({},e&&this.curRois||{},...i.map(t=>({[t.id]:t}))),this.slice.roilist.forEach(t=>{this.curRois[t.id]&&this.$set(t,"path",this.curRois[t.id].path)})},listChangeCurrent(){var t=[].concat.apply([],Object.values(this.curRois).map(t=>t.path.x)),e=[].concat.apply([],Object.values(this.curRois).map(t=>t.path.y));t.length?this.centerRegion=[Math.min.apply(null,t),Math.min.apply(null,e),Math.max.apply(null,t),Math.max.apply(null,e)]:this.centerRegion=null},draw(t){t.id=(Math.random()+"").substr(2,9),"freepen"===t.method&&(t.simplify=5),this.slice.roilist=[...this.slice.roilist,t]},clearSimplify(t){this.$set(this.slice,"roilist",this.slice.roilist.map(e=>(e.id===t.id&&(e.path.x=t.x,e.path.y=t.y,e.simplify&&delete e.simplify),e)))},async delCurRoi(t){t?(this.slice.roilist=this.slice.roilist.filter(e=>e.id!=t.id),this.curRois[t.id]&&(delete this.curRois[t.id],this.curRois=Object.assign({},this.curRois))):await this.$confirm(this.$t("analaysisPanel.delete"),{confirmButtonText:this.$t("confirm.confirm"),cancelButtonText:this.$t("confirm.quit"),type:"warning"}).catch(()=>{})&&(this.slice.roilist=this.slice.roilist.filter(t=>!this.curRois[t.id]),this.curRois={});this.pdl1Anno=null},setAnnotation(t){var e;for(var i in e="string"!=typeof t?t[0]+","+t[1]:t,this.pdl1Anno=null,this.curRois){let t=this.curRois[i];this.curRois[i]=Object.assign({},t,{jgResult:e,remark:e.split(",")[e.split(",").length-1]})}var s=Object.assign({},this.curRois);this.$set(this.slice,"roilist",this.slice.roilist.map(t=>{var e=s[t.id];return e?(delete s[t.id],e):t}).concat(Object.values(s)))},checkjgResult:t=>t.jgResult?t.jgResult.split(",")[1]:"",showMenu(t,e){if((!t.type||t.button)&&(t.preventDefault(),0!=Object.keys(this.curRois).length&&!Object.keys(this.curRois).every(t=>t!=e.id))){var i=t.currentTarget,s=t.offsetX,n=t.offsetY,a=i.offsetWidth,o=i.offsetHeight;this.pdl1Anno={},this.pdl1Anno.hd=s>a/2?"right":"left",this.pdl1Anno.vd=n>o/2?"bottom":"top",this.menuPosition={x:s,y:n}}},keydown(t){"Delete"!=t.key&&"Backspace"!=t.key||!Object.keys(this.curRois).length||this.delCurRoi()}},props:["slice","record"],components:{"v-menus":Ct,"v-dragon":v.a,"v-roi":m}},Ot={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"cnt",attrs:{tabIndex:0},on:{keydown:t.keydown}},[i("div",{staticClass:"analyright",on:{mousewheel:function(e){t.pdl1Anno=null}}},[i("v-dragon",{staticClass:"dragon",attrs:{record:t.record,slice:t.slice,roilist:this.slice.roilist.map(function(e){return Object.assign({method:"rectangle",color:"yellow"},e,{color:{"阳性肿瘤区域":"red","阴性肿瘤区域":"yellow","组织细胞区域":"green","淋巴细胞区域":"purple","坏死细胞区域":"#666","免疫细胞区域":"orange","不确定":"#ec18a4"}[t.checkjgResult(e)]})}),curRois:t.curRois,centerRegion:t.centerRegion,position:t.position},on:{curROI:t.curROIChange,draw:t.draw,contextmenu:function(e,i){return t.showMenu(e,i)},delRoi:function(e){return t.delCurRoi(e)},mousedown:t.mouseDown,position:function(e,i,s){t.$set(t.position,"offx",e),t.$set(t.position,"offy",i),t.$set(t.position,"zoom",s),t.$set(t.slice,"position",t.position)},clearSimplify:t.clearSimplify}},[t.pdl1Anno?i("div",{staticStyle:{position:"absolute"},style:{left:t.menuPosition.x+5+"px",top:t.menuPosition.y+5+"px"}},[i("v-menus",{attrs:{pos:t.pdl1Anno,menus:t.labeltree,currentItem:t.getCommonAnnotation},on:{chosen:t.setAnnotation}})],1):t._e()])],1),t._v(" "),i("div",{staticClass:"analylist",on:{click:function(e){t.pdl1Anno=null}}},[i("h2",[i("span",{staticClass:"noauto"},[t._v(t._s(t.$t("analyze.roi")))])]),t._v(" "),i("v-roi",{staticClass:"manualroi",attrs:{roilist:t.slice.roilist,currentRois:t.curRois},on:{curROI:function(e,i){return t.curROIChange(e,i)+t.listChangeCurrent()},delRoi:function(e){return t.delCurRoi(e)},closecontextmenu:function(e){t.pdl1Anno=null}}}),t._v(" "),i("div",{staticClass:"opinio"},[i("h1",[t._v("\n                "+t._s(t.$t("analyze.point"))+"\n            ")]),t._v(" "),i("textarea",{directives:[{name:"model",rawName:"v-model",value:t.record.opinion,expression:"record.opinion"}],attrs:{placeholder:t.$t("report.pointremind"),maxlength:"300"},domProps:{value:t.record.opinion},on:{input:[function(e){e.target.composing||t.$set(t.record,"opinion",e.target.value)},t.noEmoji]}})])],1)])},staticRenderFns:[]};var At=i("VU/8")(It,Ot,!1,function(t){i("X8rw")},"data-v-a7e0e85e",null).exports;let Mt;var St={data(){return{centerRegion:null,curRois:{},roilist:[],labeltree:[{id:"阳性肿瘤细胞",label:"阳性肿瘤细胞"},{id:"阴性肿瘤细胞",label:"阴性肿瘤细胞"},{id:"阳性组织细胞",label:"阳性组织细胞"},{id:"阴性组织细胞",label:"阴性组织细胞"},{id:"阳性淋巴细胞",label:"阳性淋巴细胞"},{id:"阴性淋巴细胞",label:"阴性淋巴细胞"},{id:"纤维间质细胞",label:"纤维间质细胞"},{id:"其他难以区分的阳性免疫细胞",label:"其他难以区分的阳性免疫细胞"},{id:"其他难以区分的阴性免疫细胞",label:"其他难以区分的阴性免疫细胞"},{id:"正常肺泡细胞",label:"正常肺泡细胞"},{id:"碳末沉渣",label:"碳末沉渣"},{id:"软骨细胞",label:"软骨细胞"}],pdl1Anno:null,position:{offx:this.slice.position?this.slice.position.offx:.5,offy:this.slice.position?this.slice.position.offy:.5*this.slice.height/this.slice.width,zoom:this.slice.position?this.slice.position.zoom:null},menuPosition:{}}},computed:{getCommonAnnotation(){var t=Object.values(this.curRois);return t[0]&&t.every(t=>t.jgResult)&&t.every(e=>e.jgResult==t[0].jgResult)?t[0].jgResult.split(",")[0]:""}},methods:{clickDraw(t,e){var i,s=t.x,n=t.y;i=void 0!=Mt?{id:(Math.random()+"").substr(2,9),path:{x:[s],y:[n]},method:"spot",radius:8,remark:Mt.split(",")[1],jgResult:Mt.split(",")[0]}:{id:(Math.random()+"").substr(2,9),path:{x:[s],y:[n]},method:"spot",radius:8},this.slice.roilist=[...this.slice.roilist,i],e?Object.assign(this.curRois,{[i.id]:i}):this.curRois={[i.id]:i}},checkjgResult:t=>(""+t).split(",")[0],mouseDown(t){this.pdl1Anno=null},noEmoji(t){t.target.value=t.target.value.replace(/[^\u0020-\u007E\u00A0-\u00BE\u2E80-\uA4CF\uF900-\uFAFF\uFE30-\uFE4F\uFF00-\uFFEF\u0080-\u009F\u2000-\u201f\u2026\u2022\u20ac\r\n]/g,"")},curROIChange(t,e){var i;t?t.length?i=t:e&&this.curRois[t.id]?(delete this.curRois[t.id],i=[]):i=[t]:i=[],this.curRois=Object.assign({},e&&this.curRois||{},...i.map(t=>({[t.id]:t}))),this.slice.roilist.forEach(t=>{this.curRois[t.id]&&this.$set(t,"path",this.curRois[t.id].path)})},listChangeCurrent(){var t=[].concat.apply([],Object.values(this.curRois).map(t=>t.path.x)),e=[].concat.apply([],Object.values(this.curRois).map(t=>t.path.y));t.length?this.centerRegion=[Math.min.apply(null,t),Math.min.apply(null,e),Math.max.apply(null,t),Math.max.apply(null,e)]:this.centerRegion=null},draw(t){t.id=(Math.random()+"").substr(2,9),"freepen"===t.method&&(t.simplify=1),this.slice.roilist=[...this.slice.roilist,t]},clearSimplify(t){this.$set(this.slice,"roilist",this.slice.roilist.map(e=>(e.id===t.id&&(e.path.x=t.x,e.path.y=t.y,e.simplify&&delete e.simplify),e)))},async delCurRoi(t){t?(this.slice.roilist=this.slice.roilist.filter(e=>e.id!=t.id),this.curRois[t.id]&&(delete this.curRois[t.id],this.curRois=Object.assign({},this.curRois))):await this.$confirm(this.$t("analaysisPanel.delete"),{confirmButtonText:this.$t("confirm.confirm"),cancelButtonText:this.$t("confirm.quit"),type:"warning"}).catch(()=>{})&&(this.slice.roilist=this.slice.roilist.filter(t=>!this.curRois[t.id]),this.curRois={});this.pdl1Anno=null},setAnnotation(t){var e;for(var i in e="string"!=typeof t?t[0]+","+t[1]:t,this.pdl1Anno=null,this.curRois){let t=this.curRois[i];this.curRois[i]=Object.assign({},t,{jgResult:e,remark:e.split(",")[e.split(",").length-1]})}Mt=e;var s=Object.assign({},this.curRois);this.$set(this.slice,"roilist",this.slice.roilist.map(t=>{var e=s[t.id];return e?(delete s[t.id],e):t}).concat(Object.values(s)))},showMenu(t,e){if((!t.type||t.button)&&(t.preventDefault(),0!=Object.keys(this.curRois).length&&!Object.keys(this.curRois).every(t=>t!=e.id))){var i=t.currentTarget,s=t.offsetX,n=t.offsetY,a=i.offsetWidth,o=i.offsetHeight;this.pdl1Anno={},this.pdl1Anno.hd=s>a/2?"right":"left",this.pdl1Anno.vd=n>o/2?"bottom":"top",this.menuPosition={x:s,y:n}}},keydown(t){"Delete"!=t.key&&"Backspace"!=t.key||!Object.keys(this.curRois).length||this.delCurRoi()}},beforeMount(){let t=[];this.slice.roilist.forEach(e=>{const i=t.findIndex(t=>e.id===t.id);-1!==i?t[i].value=t[i].value+e.value:t.push(e)}),this.slice.roilist=t},props:["slice","record"],components:{"v-menus":Ct,"v-dragon":v.a,"v-roi":m}},Tt={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"cnt",attrs:{tabIndex:0},on:{keydown:t.keydown}},[i("div",{staticClass:"analyright",on:{mousewheel:function(e){t.pdl1Anno=null}}},[i("v-dragon",{staticClass:"dragon",attrs:{record:t.record,slice:t.slice,roilist:this.slice.roilist.map(function(e){return Object.assign({method:"rectangle",color:"yellow"},e,{color:{"阳性肿瘤细胞":"#fd0002","阴性肿瘤细胞":"#92d14c","阳性组织细胞":"#ffc000","阴性组织细胞":"#04b1fd","阳性淋巴细胞":"#fdff01","阴性淋巴细胞":"#006fc3","纤维间质细胞":"#fec2cc","其他难以区分的阳性免疫细胞":"#fb21fc","其他难以区分的阴性免疫细胞":"#7c7a7b","正常肺泡细胞":"#722fa0","碳末沉渣":"#029c90","软骨细胞":"#010103"}[t.checkjgResult(e.jgResult)]||"yellow"})}),curRois:t.curRois,centerRegion:t.centerRegion,position:t.position},on:{curROI:t.curROIChange,draw:t.draw,contextmenu:function(e,i){return t.showMenu(e,i)},clickDraw:t.clickDraw,delRoi:function(e){return t.delCurRoi(e)},mousedown:t.mouseDown,position:function(e,i,s){t.$set(t.position,"offx",e),t.$set(t.position,"offy",i),t.$set(t.position,"zoom",s),t.$set(t.slice,"position",t.position)},clearSimplify:t.clearSimplify}},[t.pdl1Anno?i("div",{staticStyle:{position:"absolute"},style:{left:t.menuPosition.x+"px",top:t.menuPosition.y+"px"}},[i("v-menus",{attrs:{pos:t.pdl1Anno,menus:t.labeltree,currentItem:t.getCommonAnnotation},on:{chosen:t.setAnnotation}})],1):t._e()])],1),t._v(" "),i("div",{staticClass:"analylist",on:{click:function(e){t.pdl1Anno=null}}},[i("h2",[i("span",{staticClass:"noauto"},[t._v(t._s(t.$t("analyze.roi")))])]),t._v(" "),i("v-roi",{staticClass:"manualroi",attrs:{roilist:t.slice.roilist,currentRois:t.curRois},on:{curROI:function(e,i){return t.curROIChange(e,i)+t.listChangeCurrent()},delRoi:function(e){return t.delCurRoi(e)},closecontextmenu:function(e){t.pdl1Anno=null}}}),t._v(" "),i("div",{staticClass:"opinio"},[i("h1",[t._v("\n                "+t._s(t.$t("analyze.point"))+"\n            ")]),t._v(" "),i("textarea",{directives:[{name:"model",rawName:"v-model",value:t.record.opinion,expression:"record.opinion"}],attrs:{placeholder:t.$t("report.pointremind"),maxlength:"300"},domProps:{value:t.record.opinion},on:{input:[function(e){e.target.composing||t.$set(t.record,"opinion",e.target.value)},t.noEmoji]}})])],1)])},staticRenderFns:[]};var Ft=i("VU/8")(St,Tt,!1,function(t){i("iHgs")},"data-v-e2b06bce",null).exports,jt={data(){return{centerRegion:null,curRois:{},roilist:[],labeltree:[{id:"negativetimor",label:"阴性肿瘤"},{id:"negativeUnsuer",label:"阴性其他"},{id:"positiontumor",label:"阳性肿瘤"},{id:"positionUnsuer",label:"阳性其他"},{id:"none",label:"无"}],pathAnno:null,showbutton:!0,position:{offx:this.slice.position?this.slice.position.offx:.5,offy:this.slice.position?this.slice.position.offy:.5*this.slice.height/this.slice.width,zoom:this.slice.position?this.slice.position.zoom:null}}},computed:{getCommonAnnotation(){var t=Object.values(this.curRois);return t[0]&&t.every(e=>e.jgResult==t[0].jgResult)?t[0].jgResult:""}},methods:{mouseDown(t){this.pathAnno=null},noEmoji(t){t.target.value=t.target.value.replace(/[^\u0020-\u007E\u00A0-\u00BE\u2E80-\uA4CF\uF900-\uFAFF\uFE30-\uFE4F\uFF00-\uFFEF\u0080-\u009F\u2000-\u201f\u2026\u2022\u20ac\r\n]/g,"")},curROIChange(t,e){var i;t?t.length?i=t:e&&this.curRois[t.id]?(delete this.curRois[t.id],i=[]):i=[t]:i=[],this.curRois=Object.assign({},e&&this.curRois||{},...i.map(t=>({[t.id]:t}))),this.slice.roilist.forEach(t=>{this.curRois[t.id]&&this.$set(t,"path",this.curRois[t.id].path)})},listChangeCurrent(){var t=[].concat.apply([],Object.values(this.curRois).map(t=>t.path.x)),e=[].concat.apply([],Object.values(this.curRois).map(t=>t.path.y));t.length?this.centerRegion=[Math.min.apply(null,t),Math.min.apply(null,e),Math.max.apply(null,t),Math.max.apply(null,e)]:this.centerRegion=null},draw(t){t.id=(Math.random()+"").substr(2,9),"freepen"===t.method&&(t.simplify=5),this.slice.roilist=[...this.slice.roilist,t]},clearSimplify(t){this.$set(this.slice,"roilist",this.slice.roilist.map(e=>(e.id===t.id&&(e.path.x=t.x,e.path.y=t.y,e.simplify&&delete e.simplify),e)))},clickDraw(t,e){var i=60,s=t.x,n=t.y,a={id:(Math.random()+"").substr(2,9),path:{x:[s-i,s+i,s+i,s-i],y:[n-i,n-i,n+i,n+i]},width:3,method:"rectangle"};this.slice.roilist=[...this.slice.roilist,a],this.curROIChange(a,e)},async delCurRoi(t){t?(this.slice.roilist=this.slice.roilist.filter(e=>e.id!=t.id),this.curRois[t.id]&&(delete this.curRois[t.id],this.curRois=Object.assign({},this.curRois))):await this.$confirm(this.$t("analaysisPanel.delete"),{confirmButtonText:this.$t("confirm.confirm"),cancelButtonText:this.$t("confirm.quit"),type:"warning"}).catch(()=>{})&&(this.slice.roilist=this.slice.roilist.filter(t=>!this.curRois[t.id]),this.curRois={})},setAnnotation(t){for(var e in this.pathAnno=null,this.curRois){let i=this.curRois[e];this.curRois[e]=Object.assign({},i,{jgResult:t,remark:t.split(":")[1]||t})}var i=Object.assign({},this.curRois);this.$set(this.slice,"roilist",this.slice.roilist.map(t=>{var e=i[t.id];return e?(delete i[t.id],e):t}).concat(Object.values(i)))},showMenu(t,e){if((!t.type||t.button)&&(t.preventDefault(),0!=Object.keys(this.curRois).length&&!Object.keys(this.curRois).every(t=>t!=e.id))){var i=t.currentTarget,s=t.offsetX,n=t.offsetY,a=i.offsetWidth,o=i.offsetHeight;this.pathAnno={},s>a/2?this.pathAnno.right=a-s+"px":this.pathAnno.left=s+"px",n>o/2?this.pathAnno.bottom=o-n+"px":this.pathAnno.top=n+"px"}},startAnalyze(){this.showbutton=!1},keydown(t){"Delete"!=t.key&&"Backspace"!=t.key||!Object.keys(this.curRois).length||this.delCurRoi()}},mounted(){},props:["slice","record"],components:{"v-menus":Ct,"v-dragon":v.a,"v-roi":m}},Et={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"cnt",attrs:{tabIndex:0},on:{keydown:t.keydown}},[i("div",{staticClass:"analyright",on:{mousewheel:function(e){t.pathAnno=null}}},[i("v-dragon",{staticClass:"dragon",attrs:{record:t.record,slice:t.slice,roilist:this.slice.roilist.map(function(t){return Object.assign({method:"rectangle"},t,{color:"yellow"})}),curRois:t.curRois,centerRegion:t.centerRegion,position:t.position},on:{curROI:t.curROIChange,draw:t.draw,clickDraw:t.clickDraw,contextmenu:function(e,i){return t.showMenu(e,i)},delRoi:function(e){return t.delCurRoi(e)},mousedown:t.mouseDown,position:function(e,i,s){t.$set(t.position,"offx",e),t.$set(t.position,"offy",i),t.$set(t.position,"zoom",s),t.$set(t.slice,"position",t.position)},clearSimplify:t.clearSimplify}},[t.pathAnno?i("div",{staticStyle:{position:"absolute",width:"200px","min-height":"36px",background:"white","z-index":"9"},style:t.pathAnno},[i("v-menus",{attrs:{menus:t.labeltree,currentItem:t.getCommonAnnotation},on:{chosen:t.setAnnotation}})],1):t._e()]),t._v(" "),t.showbutton?i("button",{on:{click:function(e){return t.isDrawMpp()}}},[t._v(t._s(t.$t("slice.start")))]):t._e()],1),t._v(" "),i("div",{staticClass:"analylist",on:{click:function(e){t.pathAnno=null}}},[i("h2",[i("span",{staticClass:"noauto"},[t._v(t._s(t.$t("analyze.roi")))])]),t._v(" "),i("v-roi",{staticClass:"manualroi",attrs:{roilist:t.slice.roilist,currentRois:t.curRois},on:{curROI:function(e,i){return t.curROIChange(e,i)+t.listChangeCurrent()},delRoi:function(e){return t.delCurRoi(e)},closecontextmenu:function(e){t.pathAnno=null}}}),t._v(" "),i("div",{staticClass:"opinio"},[i("h1",[t._v("\n                "+t._s(t.$t("analyze.point"))+"\n            ")]),t._v(" "),i("textarea",{directives:[{name:"model",rawName:"v-model",value:t.record.opinion,expression:"record.opinion"}],attrs:{placeholder:t.$t("report.pointremind"),maxlength:"300"},domProps:{value:t.record.opinion},on:{input:[function(e){e.target.composing||t.$set(t.record,"opinion",e.target.value)},t.noEmoji]}})])],1)])},staticRenderFns:[]};var Pt=i("VU/8")(jt,Et,!1,function(t){i("vAZQ")},"data-v-6ca1b034",null).exports,Dt={data(){return{loopHandler:0,auto:!0,centerRegion:null,curRois:{},showbutton:!0,position:{offx:this.slice.position?this.slice.position.offx:.5,offy:this.slice.position?this.slice.position.offy:.5*this.slice.height/this.slice.width,zoom:this.slice.position?this.slice.position.zoom:null},lineup:null,showMppGuide:!1,drawMpp:null}},methods:{isDrawMpp(){/\.(png|jpg|jpeg|tiff|tif|bmp)$/.test(this.slice.filename)?this.showMppGuide=!0:this.startAnalyze()},curROIChange(t,e){var i;t?t.length?i=t:e&&this.curRois[t.id]?(delete this.curRois[t.id],i=[]):i=[t]:i=[],this.curRois=Object.assign({},e&&this.curRois,...i.map(t=>"red"==t.color?{[t.id]:Object.assign({},t,{editable:!1})}:{[t.id]:t})),this.slice.roilist.forEach(t=>{this.curRois[t.id]&&this.$set(t,"path",this.curRois[t.id].path)})},noEmoji(t){t.target.value=t.target.value.replace(/[^\u0020-\u007E\u00A0-\u00BE\u2E80-\uA4CF\uF900-\uFAFF\uFE30-\uFE4F\uFF00-\uFFEF\u0080-\u009F\u2000-\u201f\u2026\u2022\u20ac\r\n]/g,"")},listChangeCurrent(){var t=[].concat.apply([],Object.values(this.curRois).map(t=>t.path.x)),e=[].concat.apply([],Object.values(this.curRois).map(t=>t.path.y));t.length?this.centerRegion=[Math.min.apply(null,t),Math.min.apply(null,e),Math.max.apply(null,t),Math.max.apply(null,e)]:this.centerRegion=null},draw(t){t.id=(Math.random()+"").substr(2,9),this.slice.roilist=[...this.slice.roilist,t]},async delCurRoi(t){let e={};t?(e={[t.id]:t},this.curRois[t.id]&&(delete this.curRois[t.id],this.curRois=Object.assign({},this.curRois))):(e=this.curRois,await this.$confirm(this.$t("analaysisPanel.delete"),{confirmButtonText:this.$t("confirm.confirm"),cancelButtonText:this.$t("confirm.quit"),type:"warning"}),this.curRois={}),this.slice.thyroid&&(this.slice.thyroid.result=this.slice.thyroid.result.filter(t=>!e[t.id])),this.slice.roilist=this.slice.roilist.filter(t=>!e[t.id])},getAlgorithmResult(t=this.record.id,e=this.slice.id,i=this.slice.filename){Object(s.b)("ai/getresult",{caseid:t,fileid:e,filename:i,type:"thyroid",other:""}).then(t=>{if(this.lineup=t.data.rank,t.data.done){if(this.showbutton=!0,this.loopHandler=0,this.slice.thyroid&&0==this.slice.thyroid.result.length){if(-1==t.data.rank)if(0==Object.keys(t.data.result).length)this.$set(this.slice.thyroid,"diagnosis","U");else{var e,i=t.data.result.cnts_desp&&t.data.result.cnts_desp.slice(0,t.data.result.cnts_desp.length).map(t=>({id:(Math.random()+"").substr(2),editable:!1,path:{x:t.cnt.map(t=>t[0]),y:t.cnt.map(t=>t[1])}}));e="Benign"==t.data.result.flag?"N":"Malignant"==t.data.result.flag?"P":"U",this.$set(this.slice.thyroid,"result",i),this.$set(this.slice.thyroid,"diagnosis",e)}else this.$set(this.slice.thyroid,"diagnosis","U");this.$set(this.slice,"type","thyroid"),this.updateRecord()}}else this.showbutton=!1,this.loopHandler=setTimeout(()=>this.getAlgorithmResult(),5e3)})},startAnalyze(t=this.record.id,e=this.slice.id,i=this.slice.filename){this.$set(this.slice,"thyroid",{}),this.$set(this.slice.thyroid,"result",[]),this.$set(this.slice.thyroid,"diagnosis",null),this.slice.started=!0,this.record.started=!0,this.showbutton=!1,this.auto=!0,Object.values(this.curRois).map(t=>this.slice.roilist.every(e=>t.id!=e.id)&&this.slice.thyroid.result.every(e=>t.id!=e.id)?delete this.curRois[t.id]:""),Object(s.b)("ai/start",{caseid:t,fileid:e,filename:i,type:"thyroid",other:""}).then(t=>{this.getAlgorithmResult()}).catch(t=>console.log(t)),this.updateRecord()},canceltesk(){Object(s.b)("ai/revokeTask",{caseid:this.record.id,fileid:this.slice.id,type:"thyroid",other:""}).then(t=>{0==t.code&&(clearTimeout(this.loopHandler),this.loopHandler=0,this.showbutton=!0,this.slice.started=!1,this.record.started=!1,this.updateRecord())}).catch(t=>console.log(t))},updateRecord(){this.$emit("save","auto")},keydown(t){"Delete"!=t.key&&"Backspace"!=t.key||!Object.keys(this.curRois).length||this.delCurRoi()}},mounted(){this.slice.started&&this.slice.thyroid&&null===this.slice.thyroid.diagnosis&&this.getAlgorithmResult(),window.addEventListener("online",()=>{this.showbutton||this.getAlgorithmResult()})},watch:{"slice.id":{handler(){clearTimeout(this.loopHandler),this.loopHandler=0}},drawMpp:{handler(t){t&&(this.$set(this.slice,"mppx",t),this.$set(this.slice,"mppy",t),this.$emit("save","auto"),this.startAnalyze())}}},beforeDestroy(){clearTimeout(this.loopHandler),this.loopHandler=0},props:["slice","record"],components:{"v-dragon":v.a,"v-roi":m}},Lt={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"cnt",attrs:{tabIndex:0},on:{keydown:t.keydown}},[i("div",{staticClass:"analyright"},[i("v-dragon",{staticClass:"dragon",attrs:{record:t.record,slice:t.slice,roilist:this.slice.roilist.map(function(t){return Object.assign({method:"rectangle"},t,{color:"yellow"})}).concat((this.slice.thyroid?this.slice.thyroid.result:[]).map(function(t){return Object.assign({},t,{color:"red",method:"rectangle",editable:!1})})),curRois:t.curRois,penColor:"yellow",centerRegion:t.centerRegion,position:t.position,showMppGuide:t.showMppGuide},on:{curROI:t.curROIChange,draw:t.draw,delRoi:function(e){return t.delCurRoi(e)},position:function(e,i,s){t.$set(t.position,"offx",e),t.$set(t.position,"offy",i),t.$set(t.position,"zoom",s),t.$set(t.slice,"position",t.position)},closeMppGuide:function(e){t.showMppGuide=!1},changeMpp:function(e){return t.drawMpp=e}}}),t._v(" "),t.showbutton?i("button",{on:{click:function(e){return t.isDrawMpp()}}},[t._v(t._s(t.$t("slice.start")))]):t._e()],1),t._v(" "),i("div",{staticClass:"analylist"},[i("h2",[i("span",{class:t.auto?"auto":"",on:{click:function(e){t.auto=!0}}},[t._v(t._s(t.$t("analyze.airoi")))]),t._v(" "),i("span",{class:t.auto?"":"noauto",on:{click:function(e){t.auto=!1}}},[t._v(t._s(t.$t("analyze.roi")))])]),t._v(" "),t.auto&&t.slice.thyroid?i("v-roi",{staticClass:"automanualroi",attrs:{roilist:this.slice.thyroid?this.slice.thyroid.result:[],currentRois:t.curRois},on:{curROI:function(e,i){return t.curROIChange(e,i)+t.listChangeCurrent()},delRoi:function(e){return t.delCurRoi(e)}}}):t._e(),t._v(" "),t.auto?t._e():i("v-roi",{staticClass:"manualroi",attrs:{roilist:t.slice.roilist,currentRois:t.curRois},on:{curROI:function(e,i){return t.curROIChange(e,i)+t.listChangeCurrent()},delRoi:function(e){return t.delCurRoi(e)}}}),t._v(" "),!t.showbutton&&t.auto?i("div",{staticClass:"loding"},[i("div",{staticClass:"video"},[i("img",{attrs:{src:"/static/video/loading.gif"}}),t._v(" "),0==t.lineup?i("div",{staticClass:"lineup"},[t._v("正在处理...")]):t._e(),t._v(" "),t.lineup>0?i("div",{staticClass:"lineup"},[t._v(t._s(t.$t("slice.lineup"))+" "),i("span",{staticStyle:{color:"#4C9FFA","font-size":"18px","font-weight":"bolder"}},[t._v(t._s(t.lineup))]),t._v(" "+t._s(t.$t("slice.position")))]):t._e()]),t._v(" "),i("div",{staticClass:"cancel",on:{click:t.canceltesk}},[t._v(t._s(t.$t("slice.cancelTasks")))])]):t._e(),t._v(" "),!t.slice.thyroid&&t.auto?i("div",{staticClass:"ifshowtables"},[t._v(t._s(t.$t("slice.noanalysis")))]):t._e(),t._v(" "),t.slice.thyroid&&t.auto?i("div",{staticClass:"tctbtm"},[i("div",{staticClass:"AiResult"},[i("div",[t._v("\n                    "+t._s(t.$t("slice.AiResult"))+"\n                ")]),t._v(" "),i("div",{class:{error:"error"==this.slice.thyroid.diagnosis}},[t._v("\n                    "+t._s(this.slice.thyroid.diagnosis)+"\n                ")])]),t._v(" "),i("div",{staticClass:"confidence"},[i("div",[t._v(t._s(t.$t("slice.confidence")))]),t._v(" "),t._m(0)]),t._v(" "),i("div",{staticClass:"interactive"},[i("div",[t._v(t._s(t.$t("slice.interaction")))]),t._v(" "),i("el-radio-group",{staticClass:"radios",model:{value:t.slice.thyroid.computer,callback:function(e){t.$set(t.slice.thyroid,"computer",e)},expression:"slice.thyroid.computer"}},[i("el-radio",{attrs:{label:!0}},[t._v("YES")]),t._v(" "),i("el-radio",{attrs:{label:!1}},[t._v("NO")]),t._v(" "),i("el-radio",{attrs:{label:"unsure"}},[t._v("UNSURE")])],1)],1)]):t._e(),t._v(" "),0==t.auto?i("div",{staticClass:"opinio"},[i("h1",[t._v("\n                "+t._s(t.$t("analyze.point"))+"\n            ")]),t._v(" "),i("textarea",{directives:[{name:"model",rawName:"v-model",value:t.record.opinion,expression:"record.opinion"}],attrs:{placeholder:t.$t("report.pointremind"),maxlength:"300"},domProps:{value:t.record.opinion},on:{input:[function(e){e.target.composing||t.$set(t.record,"opinion",e.target.value)},t.noEmoji]}})]):t._e()],1)])},staticRenderFns:[function(){var t=this.$createElement,e=this._self._c||t;return e("div",[e("div",[this._v("100%")])])}]};var Ht=i("VU/8")(Dt,Lt,!1,function(t){i("MLJp"),i("5PgD")},"data-v-f4ef6f9c",null).exports,zt={data(){return{loopHandler:0,auto:!0,centerRegion:null,curRois:{},showbutton:!0,position:{offx:this.slice.position?this.slice.position.offx:.5,offy:this.slice.position?this.slice.position.offy:.5*this.slice.height/this.slice.width,zoom:this.slice.position?this.slice.position.zoom:null},lineup:null,showMppGuide:!1,drawMpp:null}},filters:{showdiagnosis(t){if(void 0!=t)switch(t){case"Benign":return"N";case"Malignant":return"P";case"Unsure":return"U";case"PreCancer":return"A";default:return"U"}}},methods:{isDrawMpp(){/\.(png|jpg|jpeg|tiff|tif|bmp)$/.test(this.slice.filename)?this.showMppGuide=!0:this.startAnalyze()},listChangeCurrent(){var t=[].concat.apply([],Object.values(this.curRois).map(t=>t.path.x)),e=[].concat.apply([],Object.values(this.curRois).map(t=>t.path.y));t.length?this.centerRegion=[Math.min.apply(null,t),Math.min.apply(null,e),Math.max.apply(null,t),Math.max.apply(null,e)]:this.centerRegion=null},noEmoji(t){t.target.value=t.target.value.replace(/[^\u0020-\u007E\u00A0-\u00BE\u2E80-\uA4CF\uF900-\uFAFF\uFE30-\uFE4F\uFF00-\uFFEF\u0080-\u009F\u2000-\u201f\u2026\u2022\u20ac\r\n]/g,"")},curROIChange(t,e){var i;t?t.length?i=t:e&&this.curRois[t.id]?(delete this.curRois[t.id],i=[]):i=[t]:i=[],this.curRois=Object.assign({},e&&this.curRois,...i.map(t=>({[t.id]:t}))),this.slice.roilist.forEach(t=>{this.curRois[t.id]&&this.$set(t,"path",this.curRois[t.id].path)})},draw(t){t.id=(Math.random()+"").substr(2,6),this.slice.roilist=[...this.slice.roilist,t]},async delCurRoi(t){let e={};t?(e={[t.id]:t},this.curRois[t.id]&&(delete this.curRois[t.id],this.curRois=Object.assign({},this.curRois))):(e=this.curRois,await this.$confirm(this.$t("analaysisPanel.delete"),{confirmButtonText:this.$t("confirm.confirm"),cancelButtonText:this.$t("confirm.quit"),type:"warning"}),this.curRois={}),this.slice.roilist=this.slice.roilist.filter(t=>!e[t.id])},getAlgorithmResult(t=this.record.id,e=this.slice.id,i=this.slice.filename){Object(s.b)("ai/getresult",{caseid:t,fileid:e,filename:i,type:"mucosa",other:""}).then(t=>{this.lineup=t.data.rank,t.data.done?(this.showbutton=!0,this.loopHandler=0,this.slice.mucosa&&(this.$set(this.slice,"type","mucosa"),this.$set(this.slice.mucosa,"diagnosis",t.data.result.flag),this.updateRecord())):(this.showbutton=!1,this.loopHandler=setTimeout(()=>this.getAlgorithmResult(),5e3))})},startAnalyze(t=this.record.id,e=this.slice.id,i=this.slice.filename){this.slice.mucosa={},this.$set(this.slice.mucosa,"diagnosis",null),this.slice.started=!0,this.record.started=!0,this.showbutton=!1,this.auto=!0,Object(s.b)("ai/start",{caseid:t,fileid:e,filename:i,type:"mucosa",other:""}).then(t=>{this.getAlgorithmResult()}).catch(t=>console.log(t)),this.updateRecord()},canceltesk(){Object(s.b)("ai/revokeTask",{caseid:this.record.id,fileid:this.slice.id,type:"mucosa",other:""}).then(t=>{0==t.code&&(clearTimeout(this.loopHandler),this.loopHandler=0,this.showbutton=!0,this.slice.started=!1,this.record.started=!1,this.updateRecord())}).catch(t=>console.log(t))},updateRecord(){this.$emit("save","auto")},keydown(t){"Delete"!=t.key&&"Backspace"!=t.key||!Object.keys(this.curRois).length||this.delCurRoi()}},mounted(){this.slice.started&&this.slice.mucosa&&null===this.slice.mucosa.diagnosis&&this.getAlgorithmResult(),window.addEventListener("online",()=>{this.showbutton||this.getAlgorithmResult()})},beforeDestroy(){clearTimeout(this.loopHandler),this.loopHandler=0},watch:{"slice.id":{handler(){clearTimeout(this.loopHandler),this.loopHandler=0}},drawMpp:{handler(t){t&&(this.$set(this.slice,"mppx",t),this.$set(this.slice,"mppy",t),this.$emit("save","auto"),this.startAnalyze())}}},props:["slice","record"],components:{"v-dragon":v.a,"v-roi":m}},Nt={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"cnt"},[i("div",{staticClass:"analyright",attrs:{tabIndex:0},on:{keydown:t.keydown}},[i("v-dragon",{staticClass:"dragon",attrs:{record:t.record,slice:t.slice,roilist:[].concat(this.slice.roilist.map(function(t){return Object.assign({method:"rectangle"},t,{color:"yellow"})})),curRois:t.curRois,penColor:"yellow",centerRegion:t.centerRegion,position:t.position,showMppGuide:t.showMppGuide},on:{curROI:t.curROIChange,draw:t.draw,delRoi:function(e){return t.delCurRoi(e)},position:function(e,i,s){t.$set(t.position,"offx",e),t.$set(t.position,"offy",i),t.$set(t.position,"zoom",s),t.$set(t.slice,"position",t.position)},closeMppGuide:function(e){t.showMppGuide=!1},changeMpp:function(e){return t.drawMpp=e}}}),t._v(" "),t.showbutton?i("button",{on:{click:function(e){return t.isDrawMpp()}}},[t._v(t._s(t.$t("slice.start")))]):t._e()],1),t._v(" "),i("div",{staticClass:"analylist"},[i("h2",[i("span",{class:1==t.auto?"auto":"",on:{click:function(e){t.auto=!0}}},[t._v(t._s(t.$t("analyze.airoi")))]),t._v(" "),i("span",{class:0==t.auto?"noauto":"",on:{click:function(e){t.auto=!1}}},[t._v(t._s(t.$t("analyze.roi")))])]),t._v(" "),t.auto&&this.slice.mucosa?i("v-roi",{staticClass:"automanualroi",attrs:{roilist:[],currentRois:t.curRois},on:{curROI:function(e,i){return t.curROIChange(e,i)+t.listChangeCurrent()},delRoi:function(e){return t.delCurRoi(e)}}}):t._e(),t._v(" "),t.auto?t._e():i("v-roi",{staticClass:"manualroi",attrs:{roilist:t.slice.roilist,currentRois:t.curRois},on:{curROI:function(e,i){return t.curROIChange(e,i)+t.listChangeCurrent()},delRoi:function(e){return t.delCurRoi(e)}}}),t._v(" "),!t.showbutton&&t.auto?i("div",{staticClass:"loding"},[i("div",{staticClass:"video"},[i("img",{attrs:{src:"/static/video/loading.gif"}}),t._v(" "),0==t.lineup?i("div",{staticClass:"lineup"},[t._v("正在处理...")]):t._e(),t._v(" "),t.lineup>0?i("div",{staticClass:"lineup"},[t._v(t._s(t.$t("slice.lineup"))+" "),i("span",{staticStyle:{color:"#4C9FFA","font-size":"18px","font-weight":"bolder"}},[t._v(t._s(t.lineup))]),t._v(" "+t._s(t.$t("slice.position")))]):t._e()]),t._v(" "),i("div",{staticClass:"cancel",on:{click:t.canceltesk}},[t._v(t._s(t.$t("slice.cancelTasks")))])]):t._e(),t._v(" "),!t.slice.mucosa&&t.auto?i("div",{staticClass:"ifshowtables"},[t._v(t._s(t.$t("slice.noanalysis")))]):t._e(),t._v(" "),t.slice.mucosa&&t.auto?i("div",{staticClass:"tctbtm"},[i("div",{staticClass:"AiResult"},[i("div",[t._v("\n                    "+t._s(t.$t("slice.AiResult"))+"\n                ")]),t._v(" "),i("div",{class:{error:"error"==this.slice.mucosa.diagnosis}},[t._v("\n                    "+t._s(t._f("showdiagnosis")(this.slice.mucosa.diagnosis))+"\n                ")])]),t._v(" "),i("div",{staticClass:"confidence"},[i("div",[t._v(t._s(t.$t("slice.confidence")))]),t._v(" "),t._m(0)]),t._v(" "),i("div",{staticClass:"interactive"},[i("div",[t._v(t._s(t.$t("slice.interaction")))]),t._v(" "),i("el-radio-group",{staticClass:"radios",model:{value:t.slice.company,callback:function(e){t.$set(t.slice,"company",e)},expression:"slice.company"}},[i("el-radio",{attrs:{label:!0}},[t._v("YES")]),t._v(" "),i("el-radio",{attrs:{label:!1}},[t._v("NO")]),t._v(" "),i("el-radio",{attrs:{label:"unsure"}},[t._v("UNSURE")])],1)],1)]):t._e(),t._v(" "),0==t.auto?i("div",{staticClass:"opinio"},[i("h1",[t._v("\n                "+t._s(t.$t("analyze.point"))+"\n            ")]),t._v(" "),i("textarea",{directives:[{name:"model",rawName:"v-model",value:t.record.opinion,expression:"record.opinion"}],attrs:{placeholder:t.$t("report.pointremind"),maxlength:"300"},domProps:{value:t.record.opinion},on:{input:[function(e){e.target.composing||t.$set(t.record,"opinion",e.target.value)},t.noEmoji]}})]):t._e()],1)])},staticRenderFns:[function(){var t=this.$createElement,e=this._self._c||t;return e("div",[e("div",[this._v("100%")])])}]};var Bt=i("VU/8")(zt,Nt,!1,function(t){i("5OvG"),i("yCbK")},"data-v-9e1a0f28",null).exports,Gt={data(){return{loopHandler:0,auto:"one",centerRegion:null,curRois:{},showbutton:!0,radio:null,position:{offx:this.slice.position?this.slice.position.offx:.5,offy:this.slice.position?this.slice.position.offy:.5*this.slice.height/this.slice.width,zoom:this.slice.position?this.slice.position.zoom:null},lineup:null,showMppGuide:!1,drawMpp:null}},methods:{isDrawMpp(){/\.(png|jpg|jpeg|tiff|tif|bmp)$/.test(this.slice.filename)?this.showMppGuide=!0:this.startAnalyze()},keypress(t){if(t.ctrlKey&&"KeyB"==t.code){let t=window.prompt("人工结果？");this.record.analy=this.slice.tct.diagnosis=t}},noEmoji(t){t.target.value=t.target.value.replace(/[^\u0020-\u007E\u00A0-\u00BE\u2E80-\uA4CF\uF900-\uFAFF\uFE30-\uFE4F\uFF00-\uFFEF\u0080-\u009F\u2000-\u201f\u2026\u2022\u20ac\r\n]/g,"")},curROIChange(t,e){var i;t?t.length?i=t:e&&this.curRois[t.id]?(delete this.curRois[t.id],i=[]):i=[t]:i=[],this.curRois=Object.assign({},e&&this.curRois,...i.map(t=>({[t.id]:t})))},roiChanged(){for(var t in this.curRois)this.curRois[t]=Object.assign({},this.curRois[t]);var e=Object.assign({},this.curRois);this.$set(this.slice,"roilist",this.slice.roilist.map(t=>{var i=e[t.id];return i?(delete e[t.id],i):t}).concat(Object.values(e))),this.slice.tct&&(this.slice.tct.result=this.slice.tct.result.filter(t=>!this.curRois[t.id]))},listChangeCurrent(){var t=[].concat.apply([],Object.values(this.curRois).map(t=>t.path.x)),e=[].concat.apply([],Object.values(this.curRois).map(t=>t.path.y));t.length?this.centerRegion=[Math.min.apply(null,t),Math.min.apply(null,e),Math.max.apply(null,t),Math.max.apply(null,e)]:this.centerRegion=null},draw(t){t.id=(Math.random()+"").substr(2,6),this.slice.roilist=[...this.slice.roilist,t]},async delCurRoi(t){let e={};t?(e={[t.id]:t},this.curRois[t.id]&&(delete this.curRois[t.id],this.curRois=Object.assign({},this.curRois))):(e=this.curRois,await this.$confirm(this.$t("analaysisPanel.delete"),{confirmButtonText:this.$t("confirm.confirm"),cancelButtonText:this.$t("confirm.quit"),type:"warning"}),this.curRois={}),this.slice.tct&&(this.slice.tct.result=this.slice.tct.result.filter(t=>!e[t.id])),this.slice.roilist=this.slice.roilist.filter(t=>!e[t.id])},getAlgorithmResult(t=this.record.id,e=this.slice.id,i=this.slice.filename){Object(s.b)("ai/getresult",{caseid:t,fileid:e,filename:i,type:"tct",other:""}).then(t=>{if(this.lineup=t.data.rank,t.data.done){if(this.showbutton=!0,this.loopHandler=0,this.slice.tct&&0==this.slice.tct.result.length){if(-1==t.data.rank)if(0==Object.keys(t.data.result).length)this.$set(this.slice.tct,"diagnosis","U");else{var e,i=t.data.result.cells&&t.data.result.cells.slice(0,30).map(t=>({id:(Math.random()+"").substr(2,6),path:{x:t.contourPoints.slice(0,-1).map(t=>t[0]),y:t.contourPoints.slice(0,-1).map(t=>t[1])}}));this.$set(this.slice.tct,"result",i);try{e=t.data.result.diagnosis[0].toLowerCase()}catch(t){}e={n:"阴性",p:"阳性",u:"不确定"}[e]||"不满意",this.$set(this.slice.tct,"diagnosis",e)}else this.$set(this.slice.tct,"diagnosis","U");this.$set(this.slice,"type","tct"),this.updateRecord()}}else this.showbutton=!1,this.loopHandler=setTimeout(()=>{this.getAlgorithmResult()},5e3)})},startAnalyze(t=this.record.id,e=this.slice.id,i=this.slice.filename){this.$set(this.slice,"tct",{}),this.$set(this.slice.tct,"result",[]),this.slice.started=!0,this.record.started=!0,this.$set(this.slice.tct,"diagnosis",null),this.showbutton=!1,this.auto="one",Object.values(this.curRois).map(t=>this.slice.roilist.every(e=>t.id!=e.id)&&this.slice.tct.result.every(e=>t.id!=e.id)?delete this.curRois[t.id]:""),Object(s.b)("ai/start",{caseid:t,fileid:e,filename:i,type:"tct",other:""}).then(t=>{this.getAlgorithmResult()}).catch(t=>console.log(t)),this.updateRecord()},canceltesk(){Object(s.b)("ai/revokeTask",{caseid:this.record.id,fileid:this.slice.id,type:"tct"}).then(t=>{0==t.code&&(clearTimeout(this.loopHandler),this.loopHandler=0,this.showbutton=!0,this.slice.started=!1,this.record.started=!1,this.updateRecord())}).catch(t=>console.log(t))},updateRecord(){this.$emit("save","auto")},keydown(t){"Delete"!=t.key&&"Backspace"!=t.key||!Object.keys(this.curRois).length||this.delCurRoi()}},mounted(){this.slice.started&&this.slice.tct&&null===this.slice.tct.diagnosis&&this.getAlgorithmResult(),window.addEventListener("online",()=>{this.showbutton||this.getAlgorithmResult()})},watch:{"slice.id":{handler(){clearTimeout(this.loopHandler),this.loopHandler=0}},"slice.tct.computer":{async handler(t){await Object(s.b)("ai/edit",{caseid:this.record.id,fileid:this.slice.id,filename:this.slice.filename,type:"tct",result:t}),this.slice.tct.diagnosis={negative:"阴性",positive:"阳性",unsure:"不确定"}[t],this.$emit("save","auto")}},drawMpp:{handler(t){t&&(this.$set(this.slice,"mppx",t),this.$set(this.slice,"mppy",t),this.$emit("save","auto"),this.startAnalyze())}}},beforeDestroy(){clearTimeout(this.loopHandler),this.loopHandler=0},props:["slice","record"],components:{"v-dragon":v.a,"v-roi":m}},Ut={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"cnt",staticStyle:{width:"100%"},attrs:{tabIndex:0},on:{keydown:t.keydown,keypress:t.keypress}},[i("div",{staticClass:"analyright"},[i("v-dragon",{staticClass:"dragon",attrs:{record:t.record,slice:t.slice,roilist:this.slice.roilist.map(function(t){return Object.assign({method:"rectangle"},t,{color:"yellow"})}).concat((this.slice.tct?this.slice.tct.result:[]).map(function(t){return Object.assign({},t,{color:"red",method:"rectangle",editable:!0,selectable:!1})})),curRois:t.curRois,penColor:"yellow",centerRegion:t.centerRegion,position:t.position,showMppGuide:t.showMppGuide},on:{curROI:t.curROIChange,roiChanged:t.roiChanged,draw:t.draw,delRoi:function(e){return t.delCurRoi(e)},position:function(e,i,s){t.$set(t.position,"offx",e),t.$set(t.position,"offy",i),t.$set(t.position,"zoom",s),t.$set(t.slice,"position",t.position)},closeMppGuide:function(e){t.showMppGuide=!1},changeMpp:function(e){return t.drawMpp=e}}}),t._v(" "),t.showbutton?i("button",{on:{click:function(e){return t.isDrawMpp()}}},[t._v(t._s(t.$t("slice.start")))]):t._e()],1),t._v(" "),i("div",{staticClass:"analylist"},[i("h2",[i("span",{class:"one"==t.auto?"auto":"",on:{click:function(e){t.auto="one"}}},[t._v(t._s(t.$t("analyze.airoi")))]),t._v(" "),i("span",{class:"two"==t.auto?"auto":"",on:{click:function(e){t.auto="two"}}},[t._v(t._s(t.$t("analyze.roi")))])]),t._v(" "),this.slice.tct&&"one"==t.auto?i("v-roi",{staticClass:"automanualroi",attrs:{roilist:this.slice.tct?this.slice.tct.result:[],currentRois:t.curRois},on:{curROI:function(e,i){return t.curROIChange(e,i)+t.listChangeCurrent()},delRoi:function(e){return t.delCurRoi(e)}}}):t._e(),t._v(" "),"two"==t.auto?i("v-roi",{staticClass:"manualroi",attrs:{roilist:t.slice.roilist,currentRois:t.curRois},on:{curROI:function(e,i){return t.curROIChange(e,i)+t.listChangeCurrent()},delRoi:function(e){return t.delCurRoi(e)}}}):t._e(),t._v(" "),t.showbutton||"one"!=t.auto?t._e():i("div",{staticClass:"loding"},[i("div",{staticClass:"video"},[i("img",{attrs:{src:"/static/video/loading.gif"}}),t._v(" "),0==t.lineup?i("div",{staticClass:"lineup"},[t._v("正在处理...")]):t._e(),t._v(" "),t.lineup>0?i("div",{staticClass:"lineup"},[t._v(t._s(t.$t("slice.lineup"))+" "),i("span",{staticStyle:{color:"#4C9FFA","font-size":"18px","font-weight":"bolder"}},[t._v(t._s(t.lineup))]),t._v(" "+t._s(t.$t("slice.position")))]):t._e()]),t._v(" "),i("div",{staticClass:"cancel",on:{click:t.canceltesk}},[t._v(t._s(t.$t("slice.cancelTasks")))])]),t._v(" "),this.slice.tct||"one"!=t.auto?t._e():i("div",{staticClass:"ifshowtables"},[t._v(t._s(t.$t("slice.noanalysis")))]),t._v(" "),this.slice.tct&&"one"==t.auto?i("div",{staticClass:"tctbtm"},[i("div",{staticClass:"AiResult"},[i("div",[t._v("\n                    "+t._s(t.$t("slice.AiResult"))+"\n                ")]),t._v(" "),i("div",{class:{error:"error"==this.slice.tct.diagnosis}},[i("input",{directives:[{name:"model",rawName:"v-model",value:t.slice.tct.diagnosis,expression:"slice.tct.diagnosis"}],attrs:{type:"text"},domProps:{value:t.slice.tct.diagnosis},on:{input:function(e){e.target.composing||t.$set(t.slice.tct,"diagnosis",e.target.value)}}})])]),t._v(" "),i("div",{staticClass:"confidence"},[i("div",[t._v(t._s(t.$t("slice.confidence")))]),t._v(" "),t._m(0)]),t._v(" "),i("div",{staticClass:"interactive"},[i("div",[t._v(t._s(t.$t("slice.interaction")))]),t._v(" "),i("el-radio-group",{staticClass:"radios",model:{value:t.slice.tct.computer,callback:function(e){t.$set(t.slice.tct,"computer",e)},expression:"slice.tct.computer"}},[i("el-radio",{attrs:{label:"positive"}},[t._v("阳性")]),t._v(" "),i("el-radio",{attrs:{label:"negative"}},[t._v("阴性")]),t._v(" "),i("el-radio",{attrs:{label:"unsure"}},[t._v("不确定")])],1)],1)]):t._e(),t._v(" "),"two"==t.auto?i("div",{staticClass:"opinio"},[i("h1",[t._v("\n                "+t._s(t.$t("analyze.point"))+"\n            ")]),t._v(" "),i("textarea",{directives:[{name:"model",rawName:"v-model",value:t.record.opinion,expression:"record.opinion"}],attrs:{placeholder:t.$t("report.pointremind"),maxlength:"300"},domProps:{value:t.record.opinion},on:{input:[function(e){e.target.composing||t.$set(t.record,"opinion",e.target.value)},t.noEmoji]}})]):t._e()],1)])},staticRenderFns:[function(){var t=this.$createElement,e=this._self._c||t;return e("div",[e("div",[this._v("100%")])])}]};var Yt=i("VU/8")(Gt,Ut,!1,function(t){i("NxgC"),i("YPDJ")},"data-v-85173226",null).exports,Vt={data(){return{loopHandler:0,auto:!0,centerRegion:null,curRois:{},showbutton:!0,position:{offx:this.slice.position?this.slice.position.offx:.5,offy:this.slice.position?this.slice.position.offy:.5*this.slice.height/this.slice.width,zoom:this.slice.position?this.slice.position.zoom:null},lineup:null,showMppGuide:!1,drawMpp:null}},methods:{isDrawMpp(){/\.(png|jpg|jpeg|tiff|tif|bmp)$/.test(this.slice.filename)?this.showMppGuide=!0:this.startAnalyze()},curROIChange(t,e){var i;t?t.length?i=t:e&&this.curRois[t.id]?(delete this.curRois[t.id],i=[]):i=[t]:i=[],this.curRois=Object.assign({},e&&this.curRois,...i.map(t=>"black"==t.color?{[t.id]:Object.assign({},t,{editable:!1})}:{[t.id]:t})),this.slice.roilist.forEach(t=>{this.curRois[t.id]&&this.$set(t,"path",this.curRois[t.id].path)})},noEmoji(t){t.target.value=t.target.value.replace(/[^\u0020-\u007E\u00A0-\u00BE\u2E80-\uA4CF\uF900-\uFAFF\uFE30-\uFE4F\uFF00-\uFFEF\u0080-\u009F\u2000-\u201f\u2026\u2022\u20ac\r\n]/g,"")},listChangeCurrent(){var t=[].concat.apply([],Object.values(this.curRois).map(t=>t.path.x)),e=[].concat.apply([],Object.values(this.curRois).map(t=>t.path.y));t.length?this.centerRegion=[Math.min.apply(null,t),Math.min.apply(null,e),Math.max.apply(null,t),Math.max.apply(null,e)]:this.centerRegion=null},draw(t){t.id=(Math.random()+"").substr(2,9),this.slice.roilist=[...this.slice.roilist,t]},async delCurRoi(t){let e={};t?(e={[t.id]:t},this.curRois[t.id]&&(delete this.curRois[t.id],this.curRois=Object.assign({},this.curRois))):(e=this.curRois,await this.$confirm(this.$t("analaysisPanel.delete"),{confirmButtonText:this.$t("confirm.confirm"),cancelButtonText:this.$t("confirm.quit"),type:"warning"}),this.curRois={}),this.slice.embolus&&(this.slice.embolus.result=this.slice.embolus.result.filter(t=>!e[t.id])),this.slice.roilist=this.slice.roilist.filter(t=>!e[t.id])},getAlgorithmResult(t=this.record.id,e=this.slice.id,i=this.slice.filename){Object(s.b)("ai/getresult",{caseid:t,fileid:e,filename:i,type:"embolus",other:""}).then(t=>{if(this.lineup=t.data.rank,t.data.done){if(this.showbutton=!0,this.loopHandler=0,this.slice.embolus&&0==this.slice.embolus.result.length){var e;if(-1==t.data.rank)if(0==Object.keys(t.data.result).length)this.$set(this.slice.embolus,"diagnosis",0);else e=t.data.result[-1]&&t.data.result[-1].map(t=>({id:(Math.random()+"").substr(2,8),path:{x:t.x,y:t.y}})),this.$set(this.slice.embolus,"result",e),this.$set(this.slice.embolus,"diagnosis",e.length);else this.$set(this.slice.embolus,"diagnosis",0);this.$set(this.slice,"type","embolus")}this.updateRecord()}else this.showbutton=!1,this.loopHandler=setTimeout(()=>{this.getAlgorithmResult()},5e3)})},startAnalyze(t=this.record.id,e=this.slice.id,i=this.slice.filename){this.$set(this.slice,"embolus",{}),this.$set(this.slice.embolus,"result",[]),this.$set(this.slice.embolus,"diagnosis",null),this.slice.started=!0,this.record.started=!0,this.auto=!0,this.showbutton=!1,Object.values(this.curRois).map(t=>this.slice.roilist.every(e=>t.id!=e.id)&&this.slice.embolus.result.every(e=>t.id!=e.id)?delete this.curRois[t.id]:""),Object(s.b)("ai/start",{caseid:t,fileid:e,filename:i,type:"embolus",other:""}).then(t=>{this.getAlgorithmResult()}).catch(t=>console.log(t)),this.updateRecord()},canceltesk(){Object(s.b)("ai/revokeTask",{caseid:this.record.id,fileid:this.slice.id,type:"embolus",other:""}).then(t=>{0==t.code&&(clearTimeout(this.loopHandler),this.loopHandler=0,this.showbutton=!0,this.slice.started=!1,this.record.started=!1,this.updateRecord())}).catch(t=>console.log(t))},updateRecord(){this.$emit("save","auto")},keydown(t){"Delete"!=t.key&&"Backspace"!=t.key||!Object.keys(this.curRois).length||this.delCurRoi()}},mounted(){this.slice.started&&this.slice.embolus&&null===this.slice.embolus.diagnosis&&this.getAlgorithmResult(),window.addEventListener("online",()=>{this.showbutton||this.getAlgorithmResult()})},watch:{"slice.id":{handler(){clearTimeout(this.loopHandler),this.loopHandler=0}},drawMpp:{handler(t){t&&(this.$set(this.slice,"mppx",t),this.$set(this.slice,"mppy",t),this.$emit("save","auto"),this.startAnalyze())}}},beforeDestroy(){clearTimeout(this.loopHandler),this.loopHandler=0},props:["slice","record"],components:{"v-dragon":v.a,"v-roi":m}},Jt={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"cnt",attrs:{tabIndex:0},on:{keydown:t.keydown}},[i("div",{staticClass:"analyright"},[i("v-dragon",{staticClass:"dragon",attrs:{record:t.record,slice:t.slice,roilist:this.slice.roilist.map(function(t){return Object.assign({method:"rectangle"},t,{color:"yellow"})}).concat((this.slice.embolus?this.slice.embolus.result:[]).map(function(t){return Object.assign({},t,{color:"red",method:"rectangle",editable:!1,selectable:!1})})),curRois:t.curRois,penColor:"yellow",centerRegion:t.centerRegion,position:t.position,showMppGuide:t.showMppGuide},on:{curROI:t.curROIChange,draw:t.draw,delRoi:function(e){return t.delCurRoi(e)},position:function(e,i,s){t.$set(t.position,"offx",e),t.$set(t.position,"offy",i),t.$set(t.position,"zoom",s),t.$set(t.slice,"position",t.position)},closeMppGuide:function(e){t.showMppGuide=!1},changeMpp:function(e){return t.drawMpp=e}}}),t._v(" "),t.showbutton?i("button",{on:{click:function(e){return t.isDrawMpp()}}},[t._v(t._s(t.$t("slice.start")))]):t._e()],1),t._v(" "),i("div",{staticClass:"analylist"},[i("h2",[i("span",{class:t.auto?"auto":"",on:{click:function(e){t.auto=!0}}},[t._v(t._s(t.$t("analyze.airoi")))]),t._v(" "),i("span",{class:t.auto?"":"noauto",on:{click:function(e){t.auto=!1}}},[t._v(t._s(t.$t("analyze.roi")))])]),t._v(" "),t.slice.embolus&&t.auto?i("v-roi",{staticClass:"automanualroi",attrs:{roilist:this.slice.embolus?this.slice.embolus.result:[],currentRois:t.curRois},on:{curROI:function(e,i){return t.curROIChange(e,i)+t.listChangeCurrent()},delRoi:function(e){return t.delCurRoi(e)}}}):t._e(),t._v(" "),t.auto?t._e():i("v-roi",{staticClass:"manualroi",attrs:{roilist:t.slice.roilist,currentRois:t.curRois},on:{curROI:function(e,i){return t.curROIChange(e,i)+t.listChangeCurrent()},delRoi:function(e){return t.delCurRoi(e)}}}),t._v(" "),!t.showbutton&&t.auto?i("div",{staticClass:"loding"},[i("div",{staticClass:"video"},[i("img",{attrs:{src:"/static/video/loading.gif"}}),t._v(" "),0==t.lineup?i("div",{staticClass:"lineup"},[t._v("正在处理...")]):t._e(),t._v(" "),t.lineup>0?i("div",{staticClass:"lineup"},[t._v(t._s(t.$t("slice.lineup"))+" "),i("span",{staticStyle:{color:"#4C9FFA","font-size":"18px","font-weight":"bolder"}},[t._v(t._s(t.lineup))]),t._v(" "+t._s(t.$t("slice.position")))]):t._e()]),t._v(" "),i("div",{staticClass:"cancel",on:{click:t.canceltesk}},[t._v(t._s(t.$t("slice.cancelTasks")))])]):t._e(),t._v(" "),!this.slice.embolus&&t.auto?i("div",{staticClass:"ifshowtables"},[t._v(t._s(t.$t("slice.noanalysis")))]):t._e(),t._v(" "),t.slice.embolus&&t.auto?i("div",{staticClass:"tctbtm"},[i("div",{staticClass:"AiResult"},[i("div",[t._v("\n                    "+t._s(t.$t("slice.AiResult"))+"\n                ")]),t._v(" "),i("div",{class:{error:"error"==this.slice.embolus.diagnosis}},[t._v("\n                    "+t._s(this.slice.embolus.result.length||0)+"\n                ")])]),t._v(" "),i("div",{staticClass:"confidence"},[i("div",[t._v(t._s(t.$t("slice.confidence")))]),t._v(" "),i("div",["error"!=t.slice.embolus.diagnosis&&null!=t.slice.embolus.diagnosis?i("div",[t._v("100"),i("span",[t._v("%")])]):t._e(),t._v(" "),"error"==t.slice.embolus.diagnosis?i("div",[t._v("0")]):t._e()])]),t._v(" "),i("div",{staticClass:"interactive"},[i("div",[t._v(t._s(t.$t("slice.interaction")))]),t._v(" "),i("el-radio-group",{staticClass:"radios",model:{value:t.slice.embolus.computer,callback:function(e){t.$set(t.slice.embolus,"computer",e)},expression:"slice.embolus.computer"}},[i("el-radio",{attrs:{label:!0}},[t._v("YES")]),t._v(" "),i("el-radio",{attrs:{label:!1}},[t._v("NO")]),t._v(" "),i("el-radio",{attrs:{label:"unsure"}},[t._v("UNSURE")])],1)],1)]):t._e(),t._v(" "),0==t.auto?i("div",{staticClass:"opinio"},[i("h1",[t._v("\n                "+t._s(t.$t("analyze.point"))+"\n            ")]),t._v(" "),i("textarea",{directives:[{name:"model",rawName:"v-model",value:t.record.opinion,expression:"record.opinion"}],attrs:{placeholder:t.$t("report.pointremind"),maxlength:"300"},domProps:{value:t.record.opinion},on:{input:[function(e){e.target.composing||t.$set(t.record,"opinion",e.target.value)},t.noEmoji]}})]):t._e()],1)])},staticRenderFns:[]};var Xt=i("VU/8")(Vt,Jt,!1,function(t){i("quzU"),i("w55B")},"data-v-f17c85da",null).exports,Wt={data:()=>({options:[{value:"",label:"0 HPF"},{value:"选项1",label:"5 HPF"},{value:"选项2",label:"10 HPF"},{value:"选项3",label:"50 HPF"}],value:"",hpf:0,warningHpf:!1,warningWords:""}),methods:{getArea(t){for(var e=0,i=0;i<t.path.x.length-2;i++){if(i+2<t.path.x.length)var s=[t.path.x[0],t.path.y[0]],n=[t.path.x[i+1],t.path.y[i+1]],a=[t.path.x[i+2],t.path.y[i+2]];e+=(Math.abs(s[0]*n[1])+Math.abs(n[0]*a[1])+Math.abs(a[0]*s[1])-Math.abs(s[0]*a[1])-Math.abs(n[0]*s[1])-Math.abs(a[0]*n[1]))/2}return e=(Math.round(Math.abs(e)*Math.pow(this.slice.mppx||.242042,2))/1e6).toFixed(2)},getCount(t){return this.sRois[t.id]?this.sRois[t.id].length:0},checkall(){let t=this.ROIS.every(t=>!!t.image);this.ROIS.forEach(e=>this.$set(e,"image",!t))},change(t,e,i){this.$set(t,"image",i)},del(t){this.$confirm(this.$t("analaysisPanel.delete"),{confirmButtonText:this.$t("confirm.confirm"),cancelButtonText:this.$t("confirm.quit"),type:"warning"}).then(()=>{this.$emit("delRoi",t)},()=>{})}},updated(){var t=this.ROIS.filter(t=>!!t.image).map(t=>this.getArea(t)).reduce((t,e)=>Number(t)+Number(e),0)/.192;t<Object.values(this.options.filter(t=>t.value==this.value)[0])[1].split(" ")[0]&&(this.value=t>=10&&t<50?"选项2":t>=5&&t<10?"选项1":"")},watch:{value(t){var e=this.ROIS.filter(t=>!!t.image).map(t=>this.getArea(t)).reduce((t,e)=>Number(t)+Number(e),0)/.192;this.hpf=Object.values(this.options.filter(e=>e.value==t)[0])[1].split(" ")[0],this.ROIS.every(t=>1!=t.image)||this.ROIS.every(t=>0==t.image)?(this.warningWords="请勾选ROI计算",this.value="",this.warningHpf=!0,setTimeout(()=>{this.warningHpf=!1},3e3)):e<this.hpf&&(this.warningWords="ROI面积必须大于你选的5、10或50个高倍视野总面积时才能换算",this.warningHpf=!0,setTimeout(()=>{this.warningHpf=!1},3e3),this.value="")}},props:["ROIS","currentRois","sRois","slice"]},qt={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"mitroi"},[t.ROIS?t._e():i("div",{staticClass:"ifshowtables"},[t._v(t._s(t.$t("slice.noanalysis")))]),t._v(" "),t.ROIS?i("div",{staticClass:"table"},[i("div",{staticClass:"top"},[i("div",{staticClass:"left"},[i("div",[i("span",{staticClass:"uncheck",class:{checked:t.ROIS.every(function(t){return!!t.image})},on:{click:t.checkall}}),t._v("\n                    ROI\n                ")])]),t._v(" "),i("div",[t._v("个数")]),t._v(" "),t._m(0),t._v(" "),i("div",[t._v("HPF")]),t._v(" "),i("div",[t._v(t._s(t.$t("slice.deleted")))])]),t._v(" "),i("div",{staticClass:"rois"},t._l(t.ROIS,function(e,s){return i("div",{key:s,staticClass:"row",class:{curRoi:t.currentRois[e.id]},on:{click:function(i){return t.$emit("curROI",e,i.shiftKey)}}},[i("div",{staticClass:"left"},[i("div",[i("span",{staticClass:"uncheck",class:{checked:e.image},on:{click:function(i){i.stopPropagation(),t.change(e,"image",1-(e.image||0))}}}),t._v("\n                        "+t._s(s+1)+"\n                    ")])]),t._v(" "),i("div",[t._v(t._s(t.getCount(e)||0))]),t._v(" "),i("div",{staticStyle:{width:"40%"}},[t._v(t._s(t.getArea(e)))]),t._v(" "),i("div",[t._v(t._s((t.getArea(e)/.192).toFixed(2)))]),t._v(" "),i("div",[i("em",{attrs:{title:t.$t("upload.delete")},on:{click:function(i){return i.stopPropagation(),t.del(e)}}})])])}),0)]):t._e(),t._v(" "),t.ROIS?i("div",{staticClass:"nuclearbtm"},[i("div",{staticClass:"nuclear "},[i("div",{staticClass:"AiResulttop"},[i("span",[t._v("总个数:"+t._s(t.ROIS.filter(function(t){return!!t.image}).map(function(e){return t.getCount(e)}).reduce(function(t,e){return t+e},0)))]),t._v(" "),i("span",[t._v("总面积:"+t._s(t.ROIS.filter(function(t){return!!t.image}).map(function(e){return t.getArea(e)}).reduce(function(t,e){return Number(t)+Number(e)},0).toFixed(2))+"mm"),i("sup",[t._v("2")])]),t._v(" "),i("span",[t._v("总HPF:"+t._s((t.ROIS.filter(function(t){return!!t.image}).map(function(e){return t.getArea(e)}).reduce(function(t,e){return Number(t)+Number(e)},0)/.192).toFixed(2)))])]),t._v(" "),i("div",{staticClass:"about"},[t._v("\n                相当于  "+t._s((t.ROIS.filter(function(t){return!!t.image}).map(function(e){return t.getCount(e)}).reduce(function(t,e){return t+e},0)/(t.ROIS.filter(function(t){return!!t.image}).map(function(e){return t.getArea(e)}).reduce(function(t,e){return Number(t)+Number(e)},0)/.192)*t.hpf||0).toFixed(2))+"\n                      /  \n                    "),i("el-select",{attrs:{"popper-class":"hpf",placeholder:"请选择"},model:{value:t.value,callback:function(e){t.value=e},expression:"value"}},t._l(t.options,function(t){return i("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})}),1)],1)]),t._v(" "),i("div",{staticClass:"confidence"},[i("div",[t._v(t._s(t.$t("slice.confidence")))]),t._v(" "),i("div",["error"!=t.slice.mitosis.diagnosis&&null!=t.slice.mitosis.diagnosis?i("div",[t._v("100"),i("span",[t._v("%")])]):t._e(),t._v(" "),"error"==t.slice.mitosis.diagnosis?i("div",[t._v("0")]):t._e()])]),t._v(" "),i("div",{staticClass:"interactive"},[i("div",[t._v(t._s(t.$t("slice.interaction")))]),t._v(" "),i("el-radio-group",{staticClass:"radios",model:{value:t.slice.mitosis.computer,callback:function(e){t.$set(t.slice.mitosis,"computer",e)},expression:"slice.mitosis .computer"}},[i("el-radio",{attrs:{label:!0}},[t._v("YES")]),t._v(" "),i("el-radio",{attrs:{label:!1}},[t._v("NO")]),t._v(" "),i("el-radio",{attrs:{label:"unsure"}},[t._v("UNSURE")])],1)],1)]):t._e(),t._v(" "),i("transition",{attrs:{name:"fade"}},[t.warningHpf?i("div",{staticClass:"warninghpf"},[t._v("\n            "+t._s(t.warningWords)+"\n        ")]):t._e()])],1)},staticRenderFns:[function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticStyle:{width:"40%"}},[this._v("面积( "),e("span",[this._v("mm"),e("sup",[this._v("2")])]),this._v(" )")])}]};var Kt=i("VU/8")(Wt,qt,!1,function(t){i("IfI9"),i("xG4u")},null,null).exports,Zt={data(){return{loopHandler:0,auto:!0,centerRegion:null,curRois:{},showbutton:!0,position:{offx:this.slice.position?this.slice.position.offx:.5,offy:this.slice.position?this.slice.position.offy:.5*this.slice.height/this.slice.width,zoom:this.slice.position?this.slice.position.zoom:null},lineup:null,showMppGuide:!1,drawMpp:null}},methods:{isDrawMpp(){/\.(png|jpg|jpeg|tiff|tif|bmp)$/.test(this.slice.filename)?this.showMppGuide=!0:this.startAnalyze()},noEmoji(t){t.target.value=t.target.value.replace(/[^\u0020-\u007E\u00A0-\u00BE\u2E80-\uA4CF\uF900-\uFAFF\uFE30-\uFE4F\uFF00-\uFFEF\u0080-\u009F\u2000-\u201f\u2026\u2022\u20ac\r\n]/g,"")},curROIChange(t,e){var i,s=[].concat(...Object.values(this.slice.mitosis.airesult));t&&s.some(e=>e.id==t.id)||(t?t.length?i=t:e&&this.curRois[t.id]?(delete this.curRois[t.id],i=[]):i=[t]:i=[],this.curRois=Object.assign({},e&&this.curRois,...i.map(t=>"grey"==t.color?{[t.id]:Object.assign({},t,{editable:!1})}:{[t.id]:t})),this.slice.roilist.forEach(t=>{this.curRois[t.id]&&this.$set(t,"path",this.curRois[t.id].path)}))},listChangeCurrent(){var t=[].concat.apply([],Object.values(this.curRois).map(t=>t.path.x)),e=[].concat.apply([],Object.values(this.curRois).map(t=>t.path.y));t.length?this.centerRegion=[Math.min.apply(null,t),Math.min.apply(null,e),Math.max.apply(null,t),Math.max.apply(null,e)]:this.centerRegion=null},draw(t){if(t.id=(Math.random()+"").substr(2,6),this.auto){t=Object.assign({},t,{image:""});var e=[...this.slice.mitosis.result,t];this.$set(this.slice.mitosis,"result",e)}else this.slice.roilist=[...this.slice.roilist,t]},async delCurRoi(t){let e={};for(var i of(t?(e={[t.id]:t},this.curRois[t.id]&&(delete this.curRois[t.id],this.curRois=Object.assign({},this.curRois))):(e=this.curRois,await this.$confirm(this.$t("analaysisPanel.delete"),{confirmButtonText:this.$t("confirm.confirm"),cancelButtonText:this.$t("confirm.quit"),type:"warning"}),this.curRois={}),Object.keys(e)))6==i.length?(this.slice.mitosis.result=this.slice.mitosis.result.filter(t=>t.id!=i),delete this.slice.mitosis.airesult[i]):this.slice.mitosis.result.map(t=>{void 0!=this.slice.mitosis.airesult[t.id]&&(this.slice.mitosis.airesult[t.id]=this.slice.mitosis.airesult[t.id].filter(t=>!e[t.id]))});this.slice.roilist=this.slice.roilist.filter(t=>!e[t.id])},getAlgorithmResult(t=this.record.id,e=this.slice.id,i=this.slice.filename){Object(s.b)("ai/getresult",{caseid:t,fileid:e,filename:i,type:"mitosis",other:JSON.stringify(this.slice.mitosis.result.map(t=>({id:t.id,x:t.path.x,y:t.path.y})))}).then(t=>{this.lineup=t.data.rank,t.data.done?(this.showbutton=!0,this.loopHandler=0,this.$set(this.slice,"type","mitosis"),-1!=t.data.rank?this.slice.mitosis.diagnosis=this.flag="error":(Object.keys(t.data.result).filter(t=>!this.slice.mitosis.result.find(e=>e.id==t)).map(e=>delete t.data.result[e]),this.slice.mitosis.airesult=t.data.result,[].concat.apply([],Object.values(this.slice.mitosis.airesult)).forEach(t=>t.id=(""+Math.random()).substr(2,8)),this.$set(this.slice.mitosis,"diagnosis",1)),this.updateRecord()):(this.showbutton=!1,this.loopHandler=setTimeout(()=>this.getAlgorithmResult(),5e3))})},startAnalyze(t=this.record.id,e=this.slice.id,i=this.slice.filename){0!=this.slice.mitosis.result.length?(this.$set(this.slice.mitosis,"airesult",{}),this.$set(this.slice.mitosis,"diagnosis",null),this.slice.started=!0,this.record.started=!0,this.showbutton=!1,this.auto=!0,this.slice.mitosis.result.map(t=>t.image=!0),Object(s.b)("ai/start",{caseid:t,fileid:e,filename:i,type:"mitosis",other:JSON.stringify(this.slice.mitosis.result.map(t=>({id:t.id,x:t.path.x,y:t.path.y})))}).then(t=>{this.getAlgorithmResult()}).catch(t=>console.log(t)),this.updateRecord()):this.$message({message:"请先绘制ROI,再进行处理",type:"warning"})},canceltesk(){Object(s.b)("ai/revokeTask",{caseid:this.record.id,fileid:this.slice.id,type:"mitosis",other:""}).then(t=>{0==t.code&&(clearTimeout(this.loopHandler),this.loopHandler=0,this.showbutton=!0,this.slice.started=!1,this.record.started=!1,this.slice.mitosis.result.map(t=>t.image=!1),this.updateRecord())}).catch(t=>console.log(t))},updateRecord(){this.$emit("save","auto")},keydown(t){"Delete"!=t.key&&"Backspace"!=t.key||!Object.keys(this.curRois).length||this.delCurRoi()}},beforeMount(){this.slice.mitosis||(this.$set(this.slice,"mitosis",{}),this.$set(this.slice.mitosis,"result",[]),this.$set(this.slice.mitosis,"airesult",{})),this.slice.mitosis&&!this.slice.mitosis.airesult&&this.$set(this.slice.mitosis,"airesult",{})},mounted(){this.slice.started&&this.slice.mitosis&&null===this.slice.mitosis.diagnosis&&this.getAlgorithmResult(),window.addEventListener("online",()=>{this.showbutton||this.getAlgorithmResult()})},beforeDestroy(){clearTimeout(this.loopHandler),this.loopHandler=0},watch:{"slice.id":{handler(){clearTimeout(this.loopHandler),this.loopHandler=0}},drawMpp:{handler(t){t&&(this.$set(this.slice,"mppx",t),this.$set(this.slice,"mppy",t),this.$emit("save","auto"),this.startAnalyze())}}},props:["slice","record"],components:{"v-dragon":v.a,"v-analyroi":Kt,"v-roi":m}},Qt={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"cnt",attrs:{tabIndex:0},on:{keydown:t.keydown}},[i("div",{staticClass:"analyright"},[i("v-dragon",{staticClass:"dragon",attrs:{record:t.record,slice:t.slice,roilist:(this.slice.mitosis?[].concat.apply([],Object.values(this.slice.mitosis.airesult)):[]).map(function(t){return{id:t.id,path:{x:t.x,y:t.y},color:"#00ff00",method:"rectangle",editable:!1,selectable:!1,width:3}}).concat(this.slice.roilist.map(function(t){return Object.assign({method:"rectangle"},t,{color:"yellow"})}),(this.slice.mitosis?this.slice.mitosis.result:[]).map(function(t){return Object.assign({method:"rectangle"},t,{editable:!1,selectable:!1,color:"grey"})})),curRois:t.curRois,penColor:t.auto?"grey":"yellow",centerRegion:t.centerRegion,position:t.position,showMppGuide:t.showMppGuide},on:{curROI:t.curROIChange,draw:t.draw,delRoi:function(e){return t.delCurRoi(e)},position:function(e,i,s){t.$set(t.position,"offx",e),t.$set(t.position,"offy",i),t.$set(t.position,"zoom",s),t.$set(t.slice,"position",t.position)},closeMppGuide:function(e){t.showMppGuide=!1},changeMpp:function(e){return t.drawMpp=e}}}),t._v(" "),t.showbutton?i("button",{on:{click:function(e){return t.isDrawMpp()}}},[t._v(t._s(t.$t("slice.start")))]):t._e()],1),t._v(" "),i("div",{staticClass:"analylist"},[i("h2",[i("span",{class:t.auto?"auto":"",on:{click:function(e){t.auto=!0}}},[t._v(t._s(t.$t("analyze.airoi")))]),t._v(" "),i("span",{class:t.auto?"":"noauto",on:{click:function(e){t.auto=!1}}},[t._v(t._s(t.$t("analyze.roi")))])]),t._v(" "),t.auto?i("v-analyroi",{staticClass:"table ki67table",attrs:{slice:t.slice,ROIS:this.slice.mitosis?this.slice.mitosis.result:[],sRois:this.slice.mitosis?this.slice.mitosis.airesult:{},currentRois:t.curRois},on:{curROI:function(e,i){return t.curROIChange(e,i)+t.listChangeCurrent()},delRoi:function(e){return t.delCurRoi(e)}}}):t._e(),t._v(" "),t.auto?t._e():i("v-roi",{staticClass:"manualroi",attrs:{roilist:t.slice.roilist,currentRois:t.curRois},on:{curROI:function(e,i){return t.curROIChange(e,i)+t.listChangeCurrent()},delRoi:function(e){return t.delCurRoi(e)}}}),t._v(" "),!t.showbutton&&t.auto?i("div",{staticClass:"loding"},[i("div",{staticClass:"video"},[i("img",{attrs:{src:"/static/video/loading.gif"}}),t._v(" "),0==t.lineup?i("div",{staticClass:"lineup"},[t._v("正在处理...")]):t._e(),t._v(" "),t.lineup>0?i("div",{staticClass:"lineup"},[t._v(t._s(t.$t("slice.lineup"))+" "),i("span",{staticStyle:{color:"#4C9FFA","font-size":"18px","font-weight":"bolder"}},[t._v(t._s(t.lineup))]),t._v(" "+t._s(t.$t("slice.position")))]):t._e()]),t._v(" "),i("div",{staticClass:"cancel",on:{click:t.canceltesk}},[t._v(t._s(t.$t("slice.cancelTasks")))])]):t._e(),t._v(" "),0==t.auto?i("div",{staticClass:"opinio"},[i("h1",[t._v("\n                "+t._s(t.$t("analyze.point"))+"\n            ")]),t._v(" "),i("textarea",{directives:[{name:"model",rawName:"v-model",value:t.record.opinion,expression:"record.opinion"}],attrs:{placeholder:t.$t("report.pointremind"),maxlength:"300"},domProps:{value:t.record.opinion},on:{input:[function(e){e.target.composing||t.$set(t.record,"opinion",e.target.value)},t.noEmoji]}})]):t._e()],1)])},staticRenderFns:[]};var te=i("VU/8")(Zt,Qt,!1,function(t){i("ogye")},"data-v-391668c2",null).exports,ee={data(){return{loopHandler:0,auto:!0,centerRegion:null,curRois:{},showbutton:!0,position:{offx:this.slice.position?this.slice.position.offx:.5,offy:this.slice.position?this.slice.position.offy:.5*this.slice.height/this.slice.width,zoom:this.slice.position?this.slice.position.zoom:null},lineup:null,showMppGuide:!1,drawMpp:null}},methods:{isDrawMpp(){/\.(png|jpg|jpeg|tiff|tif|bmp)$/.test(this.slice.filename)?this.showMppGuide=!0:this.startAnalyze()},curROIChange(t,e){var i;t?t.length?i=t:e&&this.curRois[t.id]?(delete this.curRois[t.id],i=[]):i=[t]:i=[],this.curRois=Object.assign({},e&&this.curRois,...i.map(t=>"black"==t.color?{[t.id]:Object.assign({},t,{editable:!1})}:{[t.id]:t})),this.slice.roilist.forEach(t=>{this.curRois[t.id]&&this.$set(t,"path",this.curRois[t.id].path)})},noEmoji(t){t.target.value=t.target.value.replace(/[^\u0020-\u007E\u00A0-\u00BE\u2E80-\uA4CF\uF900-\uFAFF\uFE30-\uFE4F\uFF00-\uFFEF\u0080-\u009F\u2000-\u201f\u2026\u2022\u20ac\r\n]/g,"")},listChangeCurrent(){var t=[].concat.apply([],Object.values(this.curRois).map(t=>t.path.x)),e=[].concat.apply([],Object.values(this.curRois).map(t=>t.path.y));t.length?this.centerRegion=[Math.min.apply(null,t),Math.min.apply(null,e),Math.max.apply(null,t),Math.max.apply(null,e)]:this.centerRegion=null},draw(t){t.id=(Math.random()+"").substr(2,6),this.slice.roilist=[...this.slice.roilist,t]},async delCurRoi(t){let e={};t?(e={[t.id]:t},this.curRois[t.id]&&(delete this.curRois[t.id],this.curRois=Object.assign({},this.curRois))):(e=this.curRois,await this.$confirm(this.$t("analaysisPanel.delete"),{confirmButtonText:this.$t("confirm.confirm"),cancelButtonText:this.$t("confirm.quit"),type:"warning"}),this.curRois={}),this.slice.kidney&&(this.slice.kidney.result=this.slice.kidney.result.filter(t=>!e[t.id])),this.slice.roilist=this.slice.roilist.filter(t=>!e[t.id])},getAlgorithmResult(t=this.record.id,e=this.slice.id,i=this.slice.filename){Object(s.b)("ai/getresult",{caseid:t,fileid:e,filename:i,type:"embolus",other:""}).then(t=>{if(this.lineup=t.data.rank,t.data.done){if(this.showbutton=!0,this.loopHandler=0,this.slice.kidney&&0==this.slice.kidney.result.length){var e;if(-1==t.data.rank)if(0==Object.keys(t.data.result).length)this.$set(this.slice.kidney,"diagnosis",0);else e=t.data.result[-1]&&t.data.result[-1].map(t=>({id:(Math.random()+"").substr(2,8),path:{x:t.x,y:t.y}})),this.$set(this.slice.kidney,"result",e),this.$set(this.slice.kidney,"diagnosis",e.length);else this.$set(this.slice.kidney,"diagnosis",0);this.$set(this.slice,"type","kidney")}this.updateRecord()}else this.showbutton=!1,this.loopHandler=setTimeout(()=>{this.getAlgorithmResult()},5e3)})},startAnalyze(t=this.record.id,e=this.slice.id,i=this.slice.filename){this.$set(this.slice,"kidney",{}),this.$set(this.slice.kidney,"result",[]),this.$set(this.slice.kidney,"diagnosis",null),this.slice.started=!0,this.record.started=!0,this.auto=!0,this.showbutton=!1,Object.values(this.curRois).map(t=>this.slice.roilist.every(e=>t.id!=e.id)&&this.slice.kidney.result.every(e=>t.id!=e.id)?delete this.curRois[t.id]:""),Object(s.b)("ai/start",{caseid:t,fileid:e,filename:i,type:"embolus",other:""}).then(t=>{this.getAlgorithmResult()}).catch(t=>console.log(t)),this.updateRecord()},canceltesk(){Object(s.b)("ai/revokeTask",{caseid:this.record.id,fileid:this.slice.id,type:"embolus",other:""}).then(t=>{0==t.code&&(clearTimeout(this.loopHandler),this.loopHandler=0,this.showbutton=!0,this.slice.started=!1,this.record.started=!1,this.updateRecord())}).catch(t=>console.log(t))},updateRecord(){this.$emit("save","auto")},keydown(t){"Delete"!=t.key&&"Backspace"!=t.key||!Object.keys(this.curRois).length||this.delCurRoi()}},mounted(){this.slice.started&&this.slice.kidney&&null===this.slice.kidney.diagnosis&&this.getAlgorithmResult(),window.addEventListener("online",()=>{this.showbutton||this.getAlgorithmResult()})},watch:{"slice.id":{handler(){clearTimeout(this.loopHandler),this.loopHandler=0}},drawMpp:{handler(t){t&&(this.$set(this.slice,"mppx",t),this.$set(this.slice,"mppy",t),this.$emit("save","auto"),this.startAnalyze())}}},beforeDestroy(){clearTimeout(this.loopHandler),this.loopHandler=0},props:["slice","record"],components:{"v-dragon":v.a,"v-roi":m}},ie={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"cnt",attrs:{tabIndex:0},on:{keydown:t.keydown}},[i("div",{staticClass:"analyright"},[i("v-dragon",{staticClass:"dragon",attrs:{record:t.record,slice:t.slice,roilist:this.slice.roilist.map(function(t){return Object.assign({method:"rectangle"},t,{color:"yellow"})}).concat((this.slice.kidney?this.slice.kidney.result:[]).map(function(t){return Object.assign({},t,{color:"red",method:"rectangle",editable:!1,selectable:!1})})),curRois:t.curRois,penColor:"yellow",centerRegion:t.centerRegion,position:t.position,showMppGuide:t.showMppGuide},on:{curROI:t.curROIChange,draw:t.draw,delRoi:function(e){return t.delCurRoi(e)},position:function(e,i,s){t.$set(t.position,"offx",e),t.$set(t.position,"offy",i),t.$set(t.position,"zoom",s),t.$set(t.slice,"position",t.position)},closeMppGuide:function(e){t.showMppGuide=!1},changeMpp:function(e){return t.drawMpp=e}}}),t._v(" "),t.showbutton?i("button",{on:{click:function(e){return t.isDrawMpp()}}},[t._v(t._s(t.$t("slice.start")))]):t._e()],1),t._v(" "),i("div",{staticClass:"analylist"},[i("h2",[i("span",{class:t.auto?"auto":"",on:{click:function(e){t.auto=!0}}},[t._v(t._s(t.$t("analyze.airoi")))]),t._v(" "),i("span",{class:t.auto?"":"noauto",on:{click:function(e){t.auto=!1}}},[t._v(t._s(t.$t("analyze.roi")))])]),t._v(" "),t.slice.kidney&&t.auto?i("v-roi",{staticClass:"automanualroi",attrs:{roilist:this.slice.kidney?this.slice.kidney.result:[],currentRois:t.curRois},on:{curROI:function(e,i){return t.curROIChange(e,i)+t.listChangeCurrent()},delRoi:function(e){return t.delCurRoi(e)}}}):t._e(),t._v(" "),t.auto?t._e():i("v-roi",{staticClass:"manualroi",attrs:{roilist:t.slice.roilist,currentRois:t.curRois},on:{curROI:function(e,i){return t.curROIChange(e,i)+t.listChangeCurrent()},delRoi:function(e){return t.delCurRoi(e)}}}),t._v(" "),!t.showbutton&&t.auto?i("div",{staticClass:"loding"},[i("div",{staticClass:"video"},[i("img",{attrs:{src:"/static/video/loading.gif"}}),t._v(" "),0==t.lineup?i("div",{staticClass:"lineup"},[t._v("正在处理...")]):t._e(),t._v(" "),t.lineup>0?i("div",{staticClass:"lineup"},[t._v(t._s(t.$t("slice.lineup"))+" "),i("span",{staticStyle:{color:"#4C9FFA","font-size":"18px","font-weight":"bolder"}},[t._v(t._s(t.lineup))]),t._v(" "+t._s(t.$t("slice.position")))]):t._e()]),t._v(" "),i("div",{staticClass:"cancel",on:{click:t.canceltesk}},[t._v(t._s(t.$t("slice.cancelTasks")))])]):t._e(),t._v(" "),!this.slice.kidney&&t.auto?i("div",{staticClass:"ifshowtables"},[t._v(t._s(t.$t("slice.noanalysis")))]):t._e(),t._v(" "),t.slice.kidney&&t.auto?i("div",{staticClass:"tctbtm"},[i("div",{staticClass:"AiResult"},[i("div",[t._v("\n                    "+t._s(t.$t("slice.AiResult"))+"\n                ")]),t._v(" "),i("div",{class:{error:"error"==this.slice.kidney.diagnosis}},[t._v("\n                    "+t._s(this.slice.kidney.result.length||0)+"\n                ")])]),t._v(" "),i("div",{staticClass:"confidence"},[i("div",[t._v(t._s(t.$t("slice.confidence")))]),t._v(" "),i("div",["error"!=t.slice.kidney.diagnosis&&null!=t.slice.kidney.diagnosis?i("div",[t._v("100"),i("span",[t._v("%")])]):t._e(),t._v(" "),"error"==t.slice.kidney.diagnosis?i("div",[t._v("0")]):t._e()])]),t._v(" "),i("div",{staticClass:"interactive"},[i("div",[t._v(t._s(t.$t("slice.interaction")))]),t._v(" "),i("el-radio-group",{staticClass:"radios",model:{value:t.slice.kidney.computer,callback:function(e){t.$set(t.slice.kidney,"computer",e)},expression:"slice.kidney.computer"}},[i("el-radio",{attrs:{label:!0}},[t._v("YES")]),t._v(" "),i("el-radio",{attrs:{label:!1}},[t._v("NO")]),t._v(" "),i("el-radio",{attrs:{label:"unsure"}},[t._v("UNSURE")])],1)],1)]):t._e(),t._v(" "),0==t.auto?i("div",{staticClass:"opinio"},[i("h1",[t._v("\n                "+t._s(t.$t("analyze.point"))+"\n            ")]),t._v(" "),i("textarea",{directives:[{name:"model",rawName:"v-model",value:t.record.opinion,expression:"record.opinion"}],attrs:{placeholder:t.$t("report.pointremind"),maxlength:"300"},domProps:{value:t.record.opinion},on:{input:[function(e){e.target.composing||t.$set(t.record,"opinion",e.target.value)},t.noEmoji]}})]):t._e()],1)])},staticRenderFns:[]};var se=i("VU/8")(ee,ie,!1,function(t){i("uowx"),i("SUmV")},"data-v-59c2eb30",null).exports,ne={data(){return{loopHandler:0,auto:!0,centerRegion:null,curRois:{},showbutton:!0,position:{offx:this.slice.position?this.slice.position.offx:.5,offy:this.slice.position?this.slice.position.offy:.5*this.slice.height/this.slice.width,zoom:this.slice.position?this.slice.position.zoom:null},lineup:null,showMppGuide:!1,drawMpp:null}},methods:{isDrawMpp(){/\.(png|jpg|jpeg|tiff|tif|bmp)$/.test(this.slice.filename)?this.showMppGuide=!0:this.startAnalyze()},curROIChange(t,e){var i;t?t.length?i=t:e&&this.curRois[t.id]?(delete this.curRois[t.id],i=[]):i=[t]:i=[],this.curRois=Object.assign({},e&&this.curRois,...i.map(t=>"black"==t.color?{[t.id]:Object.assign({},t,{editable:!1})}:{[t.id]:t})),this.slice.roilist.forEach(t=>{this.curRois[t.id]&&this.$set(t,"path",this.curRois[t.id].path)})},noEmoji(t){t.target.value=t.target.value.replace(/[^\u0020-\u007E\u00A0-\u00BE\u2E80-\uA4CF\uF900-\uFAFF\uFE30-\uFE4F\uFF00-\uFFEF\u0080-\u009F\u2000-\u201f\u2026\u2022\u20ac\r\n]/g,"")},listChangeCurrent(){var t=[].concat.apply([],Object.values(this.curRois).map(t=>t.path.x)),e=[].concat.apply([],Object.values(this.curRois).map(t=>t.path.y));t.length?this.centerRegion=[Math.min.apply(null,t),Math.min.apply(null,e),Math.max.apply(null,t),Math.max.apply(null,e)]:this.centerRegion=null},draw(t){t.id=(Math.random()+"").substr(2,6),"freepen"===t.method&&"yellow"===t.color&&(t.simplify=10),this.slice.roilist=[...this.slice.roilist,t]},async delCurRoi(t){let e={};t?(e={[t.id]:t},this.curRois[t.id]&&(delete this.curRois[t.id],this.curRois=Object.assign({},this.curRois))):(e=this.curRois,await this.$confirm(this.$t("analaysisPanel.delete"),{confirmButtonText:this.$t("confirm.confirm"),cancelButtonText:this.$t("confirm.quit"),type:"warning"}),this.curRois={}),this.slice.bacillus&&(this.slice.bacillus.result=this.slice.bacillus.result.filter(t=>!e[t.id])),this.slice.roilist=this.slice.roilist.filter(t=>!e[t.id])},getAlgorithmResult(t=this.record.id,e=this.slice.id,i=this.slice.filename){Object(s.b)("ai/getresult",{caseid:t,fileid:e,filename:i,type:"embolus",other:""}).then(t=>{if(this.lineup=t.data.rank,t.data.done){if(this.showbutton=!0,this.loopHandler=0,this.slice.bacillus&&0==this.slice.bacillus.result.length){var e;if(-1==t.data.rank)if(0==Object.keys(t.data.result).length)this.$set(this.slice.bacillus,"diagnosis",0);else e=t.data.result[-1]&&t.data.result[-1].map(t=>({id:(Math.random()+"").substr(2,8),path:{x:t.x,y:t.y}})),this.$set(this.slice.bacillus,"result",e),this.$set(this.slice.bacillus,"diagnosis",e.length);else this.$set(this.slice.bacillus,"diagnosis",0);this.$set(this.slice,"type","embolus")}this.updateRecord()}else this.showbutton=!1,this.loopHandler=setTimeout(()=>{this.getAlgorithmResult()},5e3)})},startAnalyze(t=this.record.id,e=this.slice.id,i=this.slice.filename){this.$set(this.slice,"bacillus",{}),this.$set(this.slice.bacillus,"result",[]),this.$set(this.slice.bacillus,"diagnosis",null),this.slice.started=!0,this.record.started=!0,this.auto=!0,this.showbutton=!1,Object.values(this.curRois).map(t=>this.slice.roilist.every(e=>t.id!=e.id)&&this.slice.bacillus.result.every(e=>t.id!=e.id)?delete this.curRois[t.id]:""),Object(s.b)("ai/start",{caseid:t,fileid:e,filename:i,type:"embolus",other:""}).then(t=>this.getAlgorithmResult()).catch(t=>console.log(t)),this.updateRecord()},canceltesk(){Object(s.b)("ai/revokeTask",{caseid:this.record.id,fileid:this.slice.id,type:"embolus"}).then(t=>{0==t.code&&(clearTimeout(this.loopHandler),this.loopHandler=0,this.showbutton=!0,this.slice.started=!1,this.record.started=!1,this.updateRecord())}).catch(t=>console.log(t))},updateRecord(){this.$emit("save","auto")},keydown(t){"Delete"!=t.key&&"Backspace"!=t.key||!Object.keys(this.curRois).length||this.delCurRoi()}},mounted(){this.slice.started&&this.slice.bacillus&&null===this.slice.bacillus.diagnosis&&this.getAlgorithmResult(),window.addEventListener("online",()=>{this.showbutton||this.getAlgorithmResult()})},watch:{"slice.id":{handler(){clearTimeout(this.loopHandler),this.loopHandler=0}},drawMpp:{handler(t){t&&(this.$set(this.slice,"mppx",t),this.$set(this.slice,"mppy",t),this.$emit("save","auto"),this.startAnalyze())}}},beforeDestroy(){clearTimeout(this.loopHandler),this.loopHandler=0},props:["slice","record"],components:{"v-dragon":v.a,"v-roi":m}},ae={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"cnt",attrs:{tabIndex:0},on:{keydown:t.keydown}},[i("div",{staticClass:"analyright"},[i("v-dragon",{staticClass:"dragon",attrs:{record:t.record,slice:t.slice,roilist:this.slice.roilist.map(function(t){return Object.assign({method:"rectangle"},t,{color:"yellow"})}).concat((this.slice.bacillus?this.slice.bacillus.result:[]).map(function(t){return Object.assign({},t,{color:"red",method:"rectangle",editable:!1,selectable:!1})})),curRois:t.curRois,penColor:"yellow",centerRegion:t.centerRegion,position:t.position,showMppGuide:t.showMppGuide},on:{curROI:t.curROIChange,draw:t.draw,delRoi:function(e){return t.delCurRoi(e)},position:function(e,i,s){t.$set(t.position,"offx",e),t.$set(t.position,"offy",i),t.$set(t.position,"zoom",s),t.$set(t.slice,"position",t.position)},closeMppGuide:function(e){t.showMppGuide=!1},changeMpp:function(e){return t.drawMpp=e}}}),t._v(" "),t.showbutton?i("button",{on:{click:function(e){return t.isDrawMpp()}}},[t._v(t._s(t.$t("slice.start")))]):t._e()],1),t._v(" "),i("div",{staticClass:"analylist"},[i("h2",[i("span",{class:t.auto?"auto":"",on:{click:function(e){t.auto=!0}}},[t._v(t._s(t.$t("analyze.airoi")))]),t._v(" "),i("span",{class:t.auto?"":"noauto",on:{click:function(e){t.auto=!1}}},[t._v(t._s(t.$t("analyze.roi")))])]),t._v(" "),t.slice.bacillus&&t.auto?i("v-roi",{staticClass:"automanualroi",attrs:{roilist:this.slice.bacillus?this.slice.bacillus.result:[],currentRois:t.curRois},on:{curROI:function(e,i){return t.curROIChange(e,i)+t.listChangeCurrent()},delRoi:function(e){return t.delCurRoi(e)}}}):t._e(),t._v(" "),t.auto?t._e():i("v-roi",{staticClass:"manualroi",attrs:{roilist:t.slice.roilist,currentRois:t.curRois},on:{curROI:function(e,i){return t.curROIChange(e,i)+t.listChangeCurrent()},delRoi:function(e){return t.delCurRoi(e)}}}),t._v(" "),!t.showbutton&&t.auto?i("div",{staticClass:"loding"},[i("div",{staticClass:"video"},[i("img",{attrs:{src:"/static/video/loading.gif"}}),t._v(" "),0==t.lineup?i("div",{staticClass:"lineup"},[t._v("正在处理...")]):t._e(),t._v(" "),t.lineup>0?i("div",{staticClass:"lineup"},[t._v(t._s(t.$t("slice.lineup"))+" "),i("span",{staticStyle:{color:"#4C9FFA","font-size":"18px","font-weight":"bolder"}},[t._v(t._s(t.lineup))]),t._v(" "+t._s(t.$t("slice.position")))]):t._e()]),t._v(" "),i("div",{staticClass:"cancel",on:{click:t.canceltesk}},[t._v(t._s(t.$t("slice.cancelTasks")))])]):t._e(),t._v(" "),!this.slice.bacillus&&t.auto?i("div",{staticClass:"ifshowtables"},[t._v(t._s(t.$t("slice.noanalysis")))]):t._e(),t._v(" "),t.slice.bacillus&&t.auto?i("div",{staticClass:"tctbtm"},[i("div",{staticClass:"AiResult"},[i("div",[t._v("\n                    "+t._s(t.$t("slice.AiResult"))+"\n                ")]),t._v(" "),i("div",{class:{error:"error"==this.slice.bacillus.diagnosis}},[t._v("\n                    "+t._s(this.slice.bacillus.result.length||0)+"\n                ")])]),t._v(" "),i("div",{staticClass:"confidence"},[i("div",[t._v(t._s(t.$t("slice.confidence")))]),t._v(" "),i("div",["error"!=t.slice.bacillus.diagnosis&&null!=t.slice.bacillus.diagnosis?i("div",[t._v("100"),i("span",[t._v("%")])]):t._e(),t._v(" "),"error"==t.slice.bacillus.diagnosis?i("div",[t._v("0")]):t._e()])]),t._v(" "),i("div",{staticClass:"interactive"},[i("div",[t._v(t._s(t.$t("slice.interaction")))]),t._v(" "),i("el-radio-group",{staticClass:"radios",model:{value:t.slice.bacillus.computer,callback:function(e){t.$set(t.slice.bacillus,"computer",e)},expression:"slice.bacillus.computer"}},[i("el-radio",{attrs:{label:!0}},[t._v("YES")]),t._v(" "),i("el-radio",{attrs:{label:!1}},[t._v("NO")]),t._v(" "),i("el-radio",{attrs:{label:"unsure"}},[t._v("UNSURE")])],1)],1)]):t._e(),t._v(" "),0==t.auto?i("div",{staticClass:"opinio"},[i("h1",[t._v("\n                "+t._s(t.$t("analyze.point"))+"\n            ")]),t._v(" "),i("textarea",{directives:[{name:"model",rawName:"v-model",value:t.record.opinion,expression:"record.opinion"}],attrs:{placeholder:t.$t("report.pointremind"),maxlength:"300"},domProps:{value:t.record.opinion},on:{input:[function(e){e.target.composing||t.$set(t.record,"opinion",e.target.value)},t.noEmoji]}})]):t._e()],1)])},staticRenderFns:[]};var oe=i("VU/8")(ne,ae,!1,function(t){i("98Q0"),i("OBJk")},"data-v-05834e1e",null).exports,re={data:()=>({}),methods:{getCount(t,e){return this.sRois[t.id]?this.sRois[t.id].filter(t=>t.type==e).length:0},checkall(){this.$emit("closecontextmenu");let t=this.ROIS.every(t=>!!t.image);this.ROIS.forEach(e=>this.$set(e,"image",!t))},change(t,e,i){this.$emit("closecontextmenu"),this.$set(t,"image",i)},del(t){this.$confirm(this.$t("analaysisPanel.delete"),{confirmButtonText:this.$t("confirm.confirm"),cancelButtonText:this.$t("confirm.quit"),type:"warning"}).then(()=>{this.$emit("delRoi",t)},()=>{})}},props:["ROIS","currentRois","sRois","slice"]},le={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"tctrois"},[t.ROIS?t._e():i("div",{staticClass:"ifshowtables"},[t._v(t._s(t.$t("slice.noanalysis")))]),t._v(" "),t.ROIS?i("div",{staticClass:"table"},[i("div",{staticClass:"top"},[i("div",{staticClass:"left"},[i("div",[i("span",{staticClass:"uncheck",class:{checked:t.ROIS.every(function(t){return!!t.image})},on:{click:t.checkall}}),t._v("\n                    ROI\n                ")])]),t._v(" "),i("div",[t._v(t._s(t.$t("slice.heterogeneousRegion")))]),t._v(" "),i("div",[t._v(t._s(t.$t("slice.total")))]),t._v(" "),i("div",[t._v(t._s(t.$t("slice.index")))]),t._v(" "),i("div",[t._v(t._s(t.$t("slice.deleted")))])]),t._v(" "),i("div",{staticClass:"rois"},t._l(t.ROIS,function(e,s){return i("div",{key:s,staticClass:"row",class:{curRoi:t.currentRois[e.id]},on:{click:function(i){t.$emit("closecontextmenu"),t.$emit("curROI",e,i.shiftKey)}}},[i("div",{staticClass:"left"},[i("div",[i("span",{staticClass:"uncheck",class:{checked:e.image},on:{click:function(i){i.stopPropagation(),t.change(e,"image",1-(e.image||0))}}}),t._v("\n                        "+t._s(s+1)+"\n                    ")])]),t._v(" "),i("div",[t._v(t._s(t.getCount(e,2)||"0"))]),t._v(" "),i("div",[t._v(t._s(t.getCount(e,1)+t.getCount(e,2)||"0"))]),t._v(" "),i("div",[t._v(t._s((t.getCount(e,2)/(t.getCount(e,1)+t.getCount(e,2)||1)*100).toFixed(1)+"%"))]),t._v(" "),i("div",[i("em",{attrs:{title:t.$t("upload.delete")},on:{click:function(i){return i.stopPropagation(),t.del(e)}}})])])}),0)]):t._e(),t._v(" "),t.ROIS?i("div",{staticClass:"tctbtm"},[i("div",{staticClass:"AiResult"},[i("div",[t._v("\n                "+t._s(t.$t("slice.AiResult"))+"\n            ")]),t._v(" "),i("div",{class:{error:"error"==this.slice.er.diagnosis}},[t._v("\n                "+t._s((this.ROIS.filter(function(t){return t.image}).map(function(e){return t.getCount(e,2)}).reduce(function(t,e){return t+e},0)/(this.ROIS.filter(function(t){return t.image}).map(function(e){return t.getCount(e,1)+t.getCount(e,2)}).reduce(function(t,e){return t+e},0)||1)*100).toFixed(1)+"%")+"\n            ")])]),t._v(" "),i("div",{staticClass:"confidence"},[i("div",[t._v(t._s(t.$t("slice.confidence")))]),t._v(" "),i("div",["error"!=t.slice.er.diagnosis&&null!=t.slice.er.diagnosis?i("div",[t._v("100"),i("span",[t._v("%")])]):t._e(),t._v(" "),"error"==t.slice.er.diagnosis?i("div",[t._v("0")]):t._e()])]),t._v(" "),i("div",{staticClass:"interactive"},[i("div",[t._v(t._s(t.$t("slice.interaction")))]),t._v(" "),i("el-radio-group",{staticClass:"radios",model:{value:t.slice.er.computer,callback:function(e){t.$set(t.slice.er,"computer",e)},expression:"slice.er.computer"}},[i("el-radio",{attrs:{label:!0}},[t._v("YES")]),t._v(" "),i("el-radio",{attrs:{label:!1}},[t._v("NO")]),t._v(" "),i("el-radio",{attrs:{label:"unsure"}},[t._v("UNSURE")])],1)],1)]):t._e()])},staticRenderFns:[]};var ce=i("VU/8")(re,le,!1,function(t){i("2Fjr"),i("zvCs")},null,null).exports,ue={data(){return{loopHandler:0,result:{},auto:!1,centerRegion:null,curRois:{},showbutton:!0,er_prAnno:null,labeltree:[{id:"prnegativetumor",label:"阴性肿瘤"},{id:"prnegativenormal",label:"阴性正常"},{id:"prpositiontumor",label:"阳性肿瘤"}],position:{offx:this.slice.position?this.slice.position.offx:.5,offy:this.slice.position?this.slice.position.offy:.5*this.slice.height/this.slice.width,zoom:this.slice.position?this.slice.position.zoom:null},lineup:null,addAnnRoi:!1,menuPosition:{},totalArea:"",showMppGuide:!1,drawMpp:null}},computed:{getCommonAnnotation(){var t=Object.values(this.curRois);return t[0]&&t.every(t=>t.jgResult)&&t.every(e=>e.jgResult==t[0].jgResult)?t[0].jgResult.split(",")[0]:""}},methods:{isDrawMpp(){/\.(png|jpg|jpeg|tiff|tif|bmp)$/.test(this.slice.filename)?this.showMppGuide=!0:this.startAnalyze()},mouseDown(t){this.er_prAnno=null},checkjgResult:t=>(""+t).split(",")[0],noEmoji(t){t.target.value=t.target.value.replace(/[^\u0020-\u007E\u00A0-\u00BE\u2E80-\uA4CF\uF900-\uFAFF\uFE30-\uFE4F\uFF00-\uFFEF\u0080-\u009F\u2000-\u201f\u2026\u2022\u20ac\r\n]/g,"")},curROIChange(t,e){var i;!t||"grey"==t.color&&this.totalArea>5e5?(i=[],this.totalArea=0):t.length?i=t:e&&this.curRois[t.id]?(delete this.curRois[t.id],i=[]):i=[t],this.curRois=Object.assign({},e&&this.curRois,...i.map(t=>"grey"==t.color?{[t.id]:Object.assign({},t,{editable:!1})}:{[t.id]:t}))},listChangeCurrent(){var t=[].concat.apply([],Object.values(this.curRois).map(t=>t.path.x)),e=[].concat.apply([],Object.values(this.curRois).map(t=>t.path.y));t.length?this.centerRegion=[Math.min.apply(null,t),Math.min.apply(null,e),Math.max.apply(null,t),Math.max.apply(null,e)]:this.centerRegion=null},clickDraw(t,e){var i=10,s=t.x,n=t.y,a={id:(Math.random()+"").substr(2,6),path:{x:[s-i,s+i,s+i,s-i],y:[n-i,n-i,n+i,n+i]},width:2,method:"rectangle"};this.slice.roilist=[...this.slice.roilist,a],e?Object.assign(this.curRois,{[a.id]:a}):this.curRois={[a.id]:a}},getArea(t){for(var e=0,i=0;i<t.x.length-2;i++){if(i+2<t.x.length)var s=[t.x[0],t.y[0]],n=[t.x[i+1],t.y[i+1]],a=[t.x[i+2],t.y[i+2]];e+=(Math.abs(s[0]*n[1])+Math.abs(n[0]*a[1])+Math.abs(a[0]*s[1])-Math.abs(s[0]*a[1])-Math.abs(n[0]*s[1])-Math.abs(a[0]*n[1]))/2}return e=Math.round(Math.abs(e)*Math.pow(this.slice.mppx||.242042,2))},draw(t){this.totalArea=this.getArea(t.path);for(var e=0;e<this.slice.er.result.length;e++)this.totalArea+=this.getArea(this.slice.er.result[e].path);if(t.id=(Math.random()+"").substr(2,6),"freepen"===t.method&&(t.simplify=5),this.auto){if(this.totalArea>5e5)return void this.$message({message:"ROI总面积不能大于0.5mm²",type:"warning"});t=Object.assign({},t,{image:""});var i=[...this.slice.er.result,t];this.$set(this.slice.er,"result",i)}else this.slice.roilist=[...this.slice.roilist,t]},clearSimplify(t){this.$set(this.slice,"roilist",this.slice.roilist.map(e=>(e.id===t.id&&(e.path.x=t.x,e.path.y=t.y,e.simplify&&delete e.simplify),e))),this.$set(this.slice.ki67,"result",this.slice.er.result.map(e=>(e.id===t.id&&(e.path.x=t.x,e.path.y=t.y,e.simplify&&delete e.simplify),e)))},async delCurRoi(t){let e={};for(var i of(t?(e={[t.id]:t},this.curRois[t.id]&&(delete this.curRois[t.id],this.curRois=Object.assign({},this.curRois))):(e=this.curRois,await this.$confirm(this.$t("analaysisPanel.delete"),{confirmButtonText:this.$t("confirm.confirm"),cancelButtonText:this.$t("confirm.quit"),type:"warning"}),this.curRois={}),Object.keys(e)))6==i.length?(this.slice.er.result=this.slice.er.result.filter(t=>t.id!=i),delete this.slice.er.airesult[i]):this.slice.er.result.map(t=>{void 0!=this.slice.er.airesult[t.id]&&(this.slice.er.airesult[t.id]=this.slice.er.airesult[t.id].filter(t=>!e[t.id]))});this.slice.roilist=this.slice.roilist.filter(t=>!e[t.id]),this.er_prAnno=!1},roiChanged(){for(var t in this.curRois)this.curRois[t]=Object.assign({},this.curRois[t]);var e=Object.assign({},this.curRois),i=Object.assign({},i,...Object.values(e).filter(t=>"grey"!=t.color).map(t=>({[t.id]:t})));this.$set(this.slice,"roilist",this.slice.roilist.map(t=>{var e=i[t.id];return e?(delete i[t.id],e):t}).concat(Object.values(i))),this.slice.er.result.map(t=>{this.slice.er.airesult[t.id]=(this.slice.er.airesult[t.id]||[]).filter(t=>!i[t.id])})},setAnnotation(t){var e;for(var i in this.er_prAnno=null,e="string"!=typeof t?t[0]+","+t[1]:t,this.curRois){let t=this.curRois[i];this.curRois[i]=Object.assign({},t,{jgResult:e,remark:e.split(",")[e.split(",").length-1]})}var s=Object.assign({},this.curRois),n=Object.assign({},n,...Object.values(s).filter(t=>"grey"!=t.color).map(t=>({[t.id]:t})));this.$set(this.slice,"roilist",this.slice.roilist.map(t=>{var e=n[t.id];return e?(delete n[t.id],e):t}).concat(Object.values(n))),this.slice.er.result.map(t=>{this.slice.er.airesult[t.id]=(this.slice.er.airesult[t.id]||[]).filter(t=>!n[t.id])})},showMenu(t,e){if((!t.type||t.button)&&(t.preventDefault(),0!=Object.keys(this.curRois).length&&!Object.keys(this.curRois).every(t=>t!=e.id)&&!this.slice.er.result.some(t=>t.id==e.id))){var i=t.currentTarget,s=t.offsetX,n=t.offsetY,a=i.offsetWidth,o=i.offsetHeight;this.er_prAnno={},this.er_prAnno.hd=s>a/2?"right":"left",this.er_prAnno.vd=n>o/2?"bottom":"top",this.menuPosition={x:s,y:n}}},getAlgorithmResult(t=this.record.id,e=this.slice.id,i=this.slice.filename){Object(s.b)("ai/getresult",{caseid:t,fileid:e,filename:i,type:"er",other:JSON.stringify(this.slice.er.result.map(t=>({id:t.id,x:t.path.x,y:t.path.y})))}).then(t=>{this.lineup=t.data.rank,t.data.done?(this.showbutton=!0,this.loopHandler=0,-1!=t.data.rank?(this.flag="error",this.$set(this.slice.er,"diagnosis","error")):(Object.keys(t.data.result).filter(t=>!this.slice.er.result.find(e=>e.id==t)).map(e=>delete t.data.result[e]),this.slice.er.airesult=t.data.result,[].concat.apply([],Object.values(this.slice.er.airesult)).forEach(t=>t.id=(""+Math.random()).substr(2,8)),this.$set(this.slice.er,"diagnosis",1)),this.$set(this.slice,"type","er"),this.updateRecord()):(this.showbutton=!1,this.loopHandler=setTimeout(()=>this.getAlgorithmResult(),5e3))})},startAnalyze(t=this.record.id,e=this.slice.id,i=this.slice.filename){0!=this.slice.er.result.length?(this.$set(this.slice.er,"airesult",{}),this.$set(this.slice.er,"diagnosis",null),this.slice.started=!0,this.record.started=!0,this.showbutton=!1,this.auto=!0,this.slice.er.result.map(t=>t.image=!0),Object.values(this.curRois).map(t=>this.slice.roilist.every(e=>t.id!=e.id)&&this.slice.er.result.every(e=>t.id!=e.id)?delete this.curRois[t.id]:""),Object(s.b)("ai/start",{caseid:t,fileid:e,filename:i,type:"er",other:JSON.stringify(this.slice.er.result.map(t=>({id:t.id,x:t.path.x,y:t.path.y})))}).then(t=>{this.getAlgorithmResult()}).catch(t=>console.log(t)),this.updateRecord()):this.$message({message:"请先绘制ROI,再进行处理",type:"warning"})},canceltesk(){Object(s.b)("ai/revokeTask",{caseid:this.record.id,fileid:this.slice.id,type:"er",other:""}).then(t=>{0==t.code&&(clearTimeout(this.loopHandler),this.loopHandler=0,this.showbutton=!0,this.slice.started=!1,this.record.started=!1,this.slice.er.result.map(t=>t.image=!1),this.updateRecord())}).catch(t=>console.log(t))},updateRecord(){this.$emit("save","auto")},keydown(t){"Delete"!=t.key&&"Backspace"!=t.key||!Object.keys(this.curRois).length||this.delCurRoi()}},beforeMount(){this.slice.er||(this.$set(this.slice,"er",{}),this.$set(this.slice.er,"result",[]),this.$set(this.slice.er,"airesult",{})),this.slice.er&&!this.slice.er.airesult&&this.$set(this.slice.er,"airesult",{})},mounted(){this.slice.started&&this.slice.er&&null===this.slice.er.diagnosis&&this.getAlgorithmResult(),window.addEventListener("online",()=>{this.showbutton||this.getAlgorithmResult()})},beforeDestroy(){clearTimeout(this.loopHandler),this.loopHandler=0},watch:{"slice.id":{handler(){clearTimeout(this.loopHandler),this.loopHandler=0}},"slice.roilist":{handler(t){t.length>300&&(this.addAnnRoi=!0,setTimeout(()=>this.addAnnRoi=!1,2500),Object.values(this.curRois).map(t=>delete this.curRois[t.id]),t.pop())}},drawMpp:{handler(t){t&&(this.$set(this.slice,"mppx",t),this.$set(this.slice,"mppy",t),this.$emit("save","auto"),this.startAnalyze())}}},props:["slice","record"],components:{"v-dragon":v.a,"v-analyroi":ce,"v-roi":m,"v-menus":Ct}},he={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"cnt"},[i("div",{staticClass:"analyright",attrs:{tabIndex:0},on:{mousewheel:function(e){t.er_prAnno=null},keydown:t.keydown}},[i("v-dragon",{staticClass:"dragon",attrs:{record:t.record,slice:t.slice,roilist:(this.slice.er?this.slice.er.result:[]).map(function(t){return Object.assign({method:"rectangle"},t,{editable:!1,selectable:!1,color:"grey"})}).concat((this.slice.er?[].concat.apply([],Object.values(this.slice.er.airesult)):[]).map(function(t){return{id:t.id,path:{x:t.x,y:t.y},color:{0:"purple",1:"green",2:"red"}[t.type],method:"rectangle",editable:!0,selectable:!1,width:1}}),this.slice.roilist.map(function(e){return Object.assign({method:"rectangle"},e,{color:{prnegativetumor:"green",prnegativenormal:"purple",prpositiontumor:"red"}[t.checkjgResult(e.jgResult)]||"yellow"})})),curRois:t.curRois,penColor:t.auto?"grey":"yellow",centerRegion:t.centerRegion,position:t.position,showMppGuide:t.showMppGuide},on:{curROI:t.curROIChange,draw:t.draw,delRoi:function(e){return t.delCurRoi(e)},contextmenu:function(e,i){return t.showMenu(e,i)},clickDraw:t.clickDraw,roiChanged:t.roiChanged,mousedown:t.mouseDown,position:function(e,i,s){t.$set(t.position,"offx",e),t.$set(t.position,"offy",i),t.$set(t.position,"zoom",s),t.$set(t.slice,"position",t.position)},closeMppGuide:function(e){t.showMppGuide=!1},changeMpp:function(e){return t.drawMpp=e},clearSimplify:t.clearSimplify}},[t.er_prAnno?i("div",{staticStyle:{position:"absolute"},style:{left:t.menuPosition.x+5+"px",top:t.menuPosition.y+5+"px"}},[i("v-menus",{attrs:{pos:t.er_prAnno,menus:t.labeltree,currentItem:t.getCommonAnnotation},on:{chosen:t.setAnnotation}})],1):t._e(),t._v(" "),t.addAnnRoi?i("div",{staticClass:"addannroi"},[t._v("标注roi数量不能超出300个")]):t._e()]),t._v(" "),t.showbutton?i("button",{on:{click:function(e){return t.isDrawMpp()}}},[t._v(t._s(t.$t("slice.start")))]):t._e()],1),t._v(" "),i("div",{staticClass:"analylist",on:{click:function(e){t.er_prAnno=null}}},[i("h2",[i("span",{class:t.auto?"auto":"",on:{click:function(e){t.auto=!0}}},[t._v(t._s(t.$t("analyze.airoi")))]),t._v(" "),i("span",{class:t.auto?"":"noauto",on:{click:function(e){t.auto=!1}}},[t._v(t._s(t.$t("analyze.roi")))])]),t._v(" "),t.auto?i("v-analyroi",{staticClass:"table",attrs:{slice:t.slice,ROIS:this.slice.er?this.slice.er.result:[],sRois:this.slice.er?this.slice.er.airesult:{},currentRois:t.curRois},on:{curROI:function(e,i){return t.curROIChange(e,i)+t.listChangeCurrent()},delRoi:function(e){return t.delCurRoi(e)},closecontextmenu:function(e){t.er_prAnno=null}}}):t._e(),t._v(" "),t.auto?t._e():i("v-roi",{staticClass:"manualroi",attrs:{roilist:t.slice.roilist,currentRois:t.curRois},on:{curROI:function(e,i){return t.curROIChange(e,i)+t.listChangeCurrent()},delRoi:function(e){return t.delCurRoi(e)}}}),t._v(" "),!t.showbutton&&t.auto?i("div",{staticClass:"loding"},[i("div",{staticClass:"video"},[i("img",{attrs:{src:"/static/video/loading.gif"}}),t._v(" "),0==t.lineup?i("div",{staticClass:"lineup"},[t._v("正在处理...")]):t._e(),t._v(" "),t.lineup>0?i("div",{staticClass:"lineup"},[t._v(t._s(t.$t("slice.lineup"))+" "),i("span",{staticStyle:{color:"#4C9FFA","font-size":"18px","font-weight":"bolder"}},[t._v(t._s(t.lineup))]),t._v(" "+t._s(t.$t("slice.position")))]):t._e()]),t._v(" "),i("div",{staticClass:"cancel",on:{click:t.canceltesk}},[t._v(t._s(t.$t("slice.cancelTasks")))])]):t._e(),t._v(" "),0==t.auto?i("div",{staticClass:"opinio"},[i("h1",[t._v("\n                "+t._s(t.$t("analyze.point"))+"\n            ")]),t._v(" "),i("textarea",{directives:[{name:"model",rawName:"v-model",value:t.record.opinion,expression:"record.opinion"}],attrs:{placeholder:t.$t("report.pointremind"),maxlength:"300"},domProps:{value:t.record.opinion},on:{input:[function(e){e.target.composing||t.$set(t.record,"opinion",e.target.value)},t.noEmoji]}})]):t._e()],1)])},staticRenderFns:[]};var de=i("VU/8")(ue,he,!1,function(t){i("rp/m")},"data-v-54fdf962",null).exports,pe={data:()=>({}),methods:{getCount(t,e){return this.sRois[t.id]?this.sRois[t.id].filter(t=>t.type==e).length:0},checkall(){this.$emit("closecontextmenu");let t=this.ROIS.every(t=>!!t.image);this.ROIS.forEach(e=>this.$set(e,"image",!t))},change(t,e,i){this.$emit("closecontextmenu"),this.$set(t,"image",i)},del(t){this.$confirm(this.$t("analaysisPanel.delete"),{confirmButtonText:this.$t("confirm.confirm"),cancelButtonText:this.$t("confirm.quit"),type:"warning"}).then(()=>{this.$emit("delRoi",t)},()=>{})}},props:["ROIS","currentRois","sRois","slice"]},ve={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"tctrois"},[t.ROIS?t._e():i("div",{staticClass:"ifshowtables"},[t._v(t._s(t.$t("slice.noanalysis")))]),t._v(" "),t.ROIS?i("div",{staticClass:"table"},[i("div",{staticClass:"top"},[i("div",{staticClass:"left"},[i("div",[i("span",{staticClass:"uncheck",class:{checked:t.ROIS.every(function(t){return!!t.image})},on:{click:t.checkall}}),t._v("\n                    ROI\n                ")])]),t._v(" "),i("div",[t._v(t._s(t.$t("slice.heterogeneousRegion")))]),t._v(" "),i("div",[t._v(t._s(t.$t("slice.total")))]),t._v(" "),i("div",[t._v(t._s(t.$t("slice.index")))]),t._v(" "),i("div",[t._v(t._s(t.$t("slice.deleted")))])]),t._v(" "),i("div",{staticClass:"rois"},t._l(t.ROIS,function(e,s){return i("div",{key:s,staticClass:"row",class:{curRoi:t.currentRois[e.id]},on:{click:function(i){t.$emit("closecontextmenu"),t.$emit("curROI",e,i.shiftKey)}}},[i("div",{staticClass:"left"},[i("div",[i("span",{staticClass:"uncheck",class:{checked:e.image},on:{click:function(i){i.stopPropagation(),t.change(e,"image",1-(e.image||0))}}}),t._v("\n                        "+t._s(s+1)+"\n                    ")])]),t._v(" "),i("div",[t._v(t._s(t.getCount(e,2)||"0"))]),t._v(" "),i("div",[t._v(t._s(t.getCount(e,1)+t.getCount(e,2)||"0"))]),t._v(" "),i("div",[t._v(t._s((t.getCount(e,2)/(t.getCount(e,1)+t.getCount(e,2)||1)*100).toFixed(1)+"%"))]),t._v(" "),i("div",[i("em",{attrs:{title:t.$t("upload.delete")},on:{click:function(i){return i.stopPropagation(),t.del(e)}}})])])}),0)]):t._e(),t._v(" "),t.ROIS?i("div",{staticClass:"tctbtm"},[i("div",{staticClass:"AiResult"},[i("div",[t._v("\n                "+t._s(t.$t("slice.AiResult"))+"\n            ")]),t._v(" "),i("div",{class:{error:"error"==this.slice.pr.diagnosis}},[t._v("\n                "+t._s((this.ROIS.filter(function(t){return t.image}).map(function(e){return t.getCount(e,2)}).reduce(function(t,e){return t+e},0)/(this.ROIS.filter(function(t){return t.image}).map(function(e){return t.getCount(e,1)+t.getCount(e,2)}).reduce(function(t,e){return t+e},0)||1)*100).toFixed(1)+"%")+"\n            ")])]),t._v(" "),i("div",{staticClass:"confidence"},[i("div",[t._v(t._s(t.$t("slice.confidence")))]),t._v(" "),i("div",["error"!=t.slice.pr.diagnosis&&null!=t.slice.pr.diagnosis?i("div",[t._v("100"),i("span",[t._v("%")])]):t._e(),t._v(" "),"error"==t.slice.pr.diagnosis?i("div",[t._v("0")]):t._e()])]),t._v(" "),i("div",{staticClass:"interactive"},[i("div",[t._v(t._s(t.$t("slice.interaction")))]),t._v(" "),i("el-radio-group",{staticClass:"radios",model:{value:t.slice.pr.computer,callback:function(e){t.$set(t.slice.pr,"computer",e)},expression:"slice.pr.computer"}},[i("el-radio",{attrs:{label:!0}},[t._v("YES")]),t._v(" "),i("el-radio",{attrs:{label:!1}},[t._v("NO")]),t._v(" "),i("el-radio",{attrs:{label:"unsure"}},[t._v("UNSURE")])],1)],1)]):t._e()])},staticRenderFns:[]};var ge=i("VU/8")(pe,ve,!1,function(t){i("pHcL"),i("ZEPr")},null,null).exports,fe={data(){return{loopHandler:0,result:{},auto:!1,centerRegion:null,curRois:{},showbutton:!0,er_prAnno:null,labeltree:[{id:"prnegativetumor",label:"阴性肿瘤"},{id:"prnegativenormal",label:"阴性正常"},{id:"prpositiontumor",label:"阳性肿瘤"}],position:{offx:this.slice.position?this.slice.position.offx:.5,offy:this.slice.position?this.slice.position.offy:.5*this.slice.height/this.slice.width,zoom:this.slice.position?this.slice.position.zoom:null},lineup:null,addAnnRoi:!1,menuPosition:{},totalArea:"",showMppGuide:!1,drawMpp:null}},computed:{getCommonAnnotation(){var t=Object.values(this.curRois);return t[0]&&t.every(t=>t.jgResult)&&t.every(e=>e.jgResult==t[0].jgResult)?t[0].jgResult.split(",")[0]:""}},methods:{isDrawMpp(){/\.(png|jpg|jpeg|tiff|tif|bmp)$/.test(this.slice.filename)?this.showMppGuide=!0:this.startAnalyze()},mouseDown(t){this.er_prAnno=null},checkjgResult:t=>(""+t).split(",")[0],noEmoji(t){t.target.value=t.target.value.replace(/[^\u0020-\u007E\u00A0-\u00BE\u2E80-\uA4CF\uF900-\uFAFF\uFE30-\uFE4F\uFF00-\uFFEF\u0080-\u009F\u2000-\u201f\u2026\u2022\u20ac\r\n]/g,"")},curROIChange(t,e){var i;!t||"grey"==t.color&&this.totalArea>5e5?(i=[],this.totalArea=0):t.length?i=t:e&&this.curRois[t.id]?(delete this.curRois[t.id],i=[]):i=[t],this.curRois=Object.assign({},e&&this.curRois,...i.map(t=>"grey"==t.color?{[t.id]:Object.assign({},t,{editable:!1})}:{[t.id]:t}))},listChangeCurrent(){var t=[].concat.apply([],Object.values(this.curRois).map(t=>t.path.x)),e=[].concat.apply([],Object.values(this.curRois).map(t=>t.path.y));t.length?this.centerRegion=[Math.min.apply(null,t),Math.min.apply(null,e),Math.max.apply(null,t),Math.max.apply(null,e)]:this.centerRegion=null},clickDraw(t,e){var i=10,s=t.x,n=t.y,a={id:(Math.random()+"").substr(2,6),path:{x:[s-i,s+i,s+i,s-i],y:[n-i,n-i,n+i,n+i]},width:2,method:"rectangle"};this.slice.roilist=[...this.slice.roilist,a],e?Object.assign(this.curRois,{[a.id]:a}):this.curRois={[a.id]:a}},getArea(t){for(var e=0,i=0;i<t.x.length-2;i++){if(i+2<t.x.length)var s=[t.x[0],t.y[0]],n=[t.x[i+1],t.y[i+1]],a=[t.x[i+2],t.y[i+2]];e+=(Math.abs(s[0]*n[1])+Math.abs(n[0]*a[1])+Math.abs(a[0]*s[1])-Math.abs(s[0]*a[1])-Math.abs(n[0]*s[1])-Math.abs(a[0]*n[1]))/2}return e=Math.round(Math.abs(e)*Math.pow(this.slice.mppx||.242042,2))},draw(t){this.totalArea=this.getArea(t.path);for(var e=0;e<this.slice.pr.result.length;e++)this.totalArea+=this.getArea(this.slice.pr.result[e].path);if(t.id=(Math.random()+"").substr(2,6),"freepen"===t.method&&(t.simplify=5),this.auto){if(this.totalArea>5e5)return void this.$message({message:"ROI总面积不能大于0.5mm²",type:"warning"});t=Object.assign({},t,{image:""});var i=[...this.slice.pr.result,t];this.$set(this.slice.pr,"result",i)}else this.slice.roilist=[...this.slice.roilist,t]},clearSimplify(t){this.$set(this.slice,"roilist",this.slice.roilist.map(e=>(e.id===t.id&&(e.path.x=t.x,e.path.y=t.y,e.simplify&&delete e.simplify),e))),this.$set(this.slice.pr,"result",this.slice.ki67.pr.map(e=>(e.id===t.id&&(e.path.x=t.x,e.path.y=t.y,e.simplify&&delete e.simplify),e)))},async delCurRoi(t){let e={};for(var i of(t?(e={[t.id]:t},this.curRois[t.id]&&(delete this.curRois[t.id],this.curRois=Object.assign({},this.curRois))):(e=this.curRois,await this.$confirm(this.$t("analaysisPanel.delete"),{confirmButtonText:this.$t("confirm.confirm"),cancelButtonText:this.$t("confirm.quit"),type:"warning"}),this.curRois={}),Object.keys(e)))6==i.length?(this.slice.pr.result=this.slice.pr.result.filter(t=>t.id!=i),delete this.slice.pr.airesult[i]):this.slice.pr.result.map(t=>{void 0!=this.slice.pr.airesult[t.id]&&(this.slice.pr.airesult[t.id]=this.slice.pr.airesult[t.id].filter(t=>!e[t.id]))});this.slice.roilist=this.slice.roilist.filter(t=>!e[t.id]),this.er_prAnno=!1},roiChanged(){for(var t in this.curRois)this.curRois[t]=Object.assign({},this.curRois[t]);var e=Object.assign({},this.curRois),i=Object.assign({},i,...Object.values(e).filter(t=>"grey"!=t.color).map(t=>({[t.id]:t})));this.$set(this.slice,"roilist",this.slice.roilist.map(t=>{var e=i[t.id];return e?(delete i[t.id],e):t}).concat(Object.values(i))),this.slice.pr.result.map(t=>{this.slice.pr.airesult[t.id]=(this.slice.pr.airesult[t.id]||[]).filter(t=>!i[t.id])})},setAnnotation(t){var e;for(var i in this.er_prAnno=null,e="string"!=typeof t?t[0]+","+t[1]:t,this.curRois){let t=this.curRois[i];this.curRois[i]=Object.assign({},t,{jgResult:e,remark:e.split(",")[e.split(",").length-1]})}var s=Object.assign({},this.curRois),n=Object.assign({},n,...Object.values(s).filter(t=>"grey"!=t.color).map(t=>({[t.id]:t})));this.$set(this.slice,"roilist",this.slice.roilist.map(t=>{var e=n[t.id];return e?(delete n[t.id],e):t}).concat(Object.values(n))),this.slice.pr.result.map(t=>{this.slice.pr.airesult[t.id]=(this.slice.pr.airesult[t.id]||[]).filter(t=>!n[t.id])})},showMenu(t,e){if((!t.type||t.button)&&(t.preventDefault(),0!=Object.keys(this.curRois).length&&!Object.keys(this.curRois).every(t=>t!=e.id)&&!this.slice.pr.result.some(t=>t.id==e.id))){var i=t.currentTarget,s=t.offsetX,n=t.offsetY,a=i.offsetWidth,o=i.offsetHeight;this.er_prAnno={},this.er_prAnno.hd=s>a/2?"right":"left",this.er_prAnno.vd=n>o/2?"bottom":"top",this.menuPosition={x:s,y:n}}},getAlgorithmResult(t=this.record.id,e=this.slice.id,i=this.slice.filename){Object(s.b)("ai/getresult",{caseid:t,fileid:e,filename:i,type:"pr",other:JSON.stringify(this.slice.pr.result.map(t=>({id:t.id,x:t.path.x,y:t.path.y})))}).then(t=>{this.lineup=t.data.rank,t.data.done?(this.showbutton=!0,this.loopHandler=0,-1!=t.data.rank?(this.flag="error",this.$set(this.slice.pr,"diagnosis","error")):(Object.keys(t.data.result).filter(t=>!this.slice.pr.result.find(e=>e.id==t)).map(e=>delete t.data.result[e]),this.slice.pr.airesult=t.data.result,[].concat.apply([],Object.values(this.slice.pr.airesult)).forEach(t=>t.id=(""+Math.random()).substr(2,8)),this.$set(this.slice.pr,"diagnosis",1)),this.$set(this.slice,"type","pr"),this.updateRecord()):(this.showbutton=!1,this.loopHandler=setTimeout(()=>this.getAlgorithmResult(),5e3))})},startAnalyze(t=this.record.id,e=this.slice.id,i=this.slice.filename){0!=this.slice.pr.result.length?(this.$set(this.slice.pr,"airesult",{}),this.$set(this.slice.pr,"diagnosis",null),this.slice.started=!0,this.record.started=!0,this.showbutton=!1,this.auto=!0,this.slice.pr.result.map(t=>t.image=!0),Object.values(this.curRois).map(t=>this.slice.roilist.every(e=>t.id!=e.id)&&this.slice.pr.result.every(e=>t.id!=e.id)?delete this.curRois[t.id]:""),Object(s.b)("ai/start",{caseid:t,fileid:e,filename:i,type:"pr",other:JSON.stringify(this.slice.pr.result.map(t=>({id:t.id,x:t.path.x,y:t.path.y})))}).then(t=>{this.getAlgorithmResult()}).catch(t=>console.log(t)),this.updateRecord()):this.$message({message:"请先绘制ROI,再进行处理",type:"warning"})},canceltesk(){Object(s.b)("ai/revokeTask",{caseid:this.record.id,fileid:this.slice.id,type:"or",other:""}).then(t=>{0==t.code&&(clearTimeout(this.loopHandler),this.loopHandler=0,this.showbutton=!0,this.slice.started=!1,this.record.started=!1,this.slice.pr.result.map(t=>t.image=!1),this.updateRecord())}).catch(t=>console.log(t))},updateRecord(){this.$emit("save","auto")},keydown(t){"Delete"!=t.key&&"Backspace"!=t.key||!Object.keys(this.curRois).length||this.delCurRoi()}},beforeMount(){this.slice.pr||(this.$set(this.slice,"pr",{}),this.$set(this.slice.pr,"result",[]),this.$set(this.slice.pr,"airesult",{})),this.slice.pr&&!this.slice.pr.airesult&&this.$set(this.slice.pr,"airesult",{})},mounted(){this.slice.started&&this.slice.pr&&null===this.slice.pr.diagnosis&&this.getAlgorithmResult(),window.addEventListener("online",()=>{this.showbutton||this.getAlgorithmResult()})},beforeDestroy(){clearTimeout(this.loopHandler),this.loopHandler=0},watch:{"slice.id":{handler(){clearTimeout(this.loopHandler),this.loopHandler=0}},"slice.roilist":{handler(t){t.length>300&&(this.addAnnRoi=!0,setTimeout(()=>this.addAnnRoi=!1,2500),Object.values(this.curRois).map(t=>delete this.curRois[t.id]),t.pop())}},drawMpp:{handler(t){t&&(this.$set(this.slice,"mppx",t),this.$set(this.slice,"mppy",t),this.$emit("save","auto"),this.startAnalyze())}}},props:["slice","record"],components:{"v-dragon":v.a,"v-analyroi":ge,"v-roi":m,"v-menus":Ct}},me={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"cnt",attrs:{tabIndex:0},on:{keydown:t.keydown}},[i("div",{staticClass:"analyright",on:{mousewheel:function(e){t.er_prAnno=null}}},[i("v-dragon",{staticClass:"dragon",attrs:{record:t.record,slice:t.slice,roilist:(this.slice.pr?this.slice.pr.result:[]).map(function(t){return Object.assign({method:"rectangle"},t,{editable:!1,selectable:!1,color:"grey"})}).concat((this.slice.pr?[].concat.apply([],Object.values(this.slice.pr.airesult)):[]).map(function(t){return{id:t.id,path:{x:t.x,y:t.y},color:{0:"purple",1:"green",2:"red"}[t.type],method:"rectangle",editable:!0,selectable:!1,width:1}}),this.slice.roilist.map(function(e){return Object.assign({method:"rectangle"},e,{color:{prnegativetumor:"green",prnegativenormal:"purple",prpositiontumor:"red"}[t.checkjgResult(e.jgResult)]||"yellow"})})),curRois:t.curRois,penColor:t.auto?"grey":"yellow",centerRegion:t.centerRegion,position:t.position,showMppGuide:t.showMppGuide},on:{curROI:t.curROIChange,draw:t.draw,delRoi:function(e){return t.delCurRoi(e)},contextmenu:function(e,i){return t.showMenu(e,i)},clickDraw:t.clickDraw,roiChanged:t.roiChanged,mousedown:t.mouseDown,position:function(e,i,s){t.$set(t.position,"offx",e),t.$set(t.position,"offy",i),t.$set(t.position,"zoom",s),t.$set(t.slice,"position",t.position)},closeMppGuide:function(e){t.showMppGuide=!1},changeMpp:function(e){return t.drawMpp=e},clearSimplify:t.clearSimplify}},[t.er_prAnno?i("div",{staticStyle:{position:"absolute"},style:{left:t.menuPosition.x+5+"px",top:t.menuPosition.y+5+"px"}},[i("v-menus",{attrs:{pos:t.er_prAnno,menus:t.labeltree,currentItem:t.getCommonAnnotation},on:{chosen:t.setAnnotation}})],1):t._e(),t._v(" "),t.addAnnRoi?i("div",{staticClass:"addannroi"},[t._v("标注roi数量不能超出300个")]):t._e()]),t._v(" "),t.showbutton?i("button",{on:{click:function(e){return t.isDrawMpp()}}},[t._v(t._s(t.$t("slice.start")))]):t._e()],1),t._v(" "),i("div",{staticClass:"analylist",on:{click:function(e){t.er_prAnno=null}}},[i("h2",[i("span",{class:t.auto?"auto":"",on:{click:function(e){t.auto=!0}}},[t._v(t._s(t.$t("analyze.airoi")))]),t._v(" "),i("span",{class:t.auto?"":"noauto",on:{click:function(e){t.auto=!1}}},[t._v(t._s(t.$t("analyze.roi")))])]),t._v(" "),t.auto?i("v-analyroi",{staticClass:"table",attrs:{slice:t.slice,ROIS:this.slice.pr?this.slice.pr.result:[],sRois:this.slice.pr?this.slice.pr.airesult:{},currentRois:t.curRois},on:{curROI:function(e,i){return t.curROIChange(e,i)+t.listChangeCurrent()},delRoi:function(e){return t.delCurRoi(e)},closecontextmenu:function(e){t.er_prAnno=null}}}):t._e(),t._v(" "),t.auto?t._e():i("v-roi",{staticClass:"manualroi",attrs:{roilist:t.slice.roilist,currentRois:t.curRois},on:{curROI:function(e,i){return t.curROIChange(e,i)+t.listChangeCurrent()},delRoi:function(e){return t.delCurRoi(e)}}}),t._v(" "),!t.showbutton&&t.auto?i("div",{staticClass:"loding"},[i("div",{staticClass:"video"},[i("img",{attrs:{src:"/static/video/loading.gif"}}),t._v(" "),0==t.lineup?i("div",{staticClass:"lineup"},[t._v("正在处理...")]):t._e(),t._v(" "),t.lineup>0?i("div",{staticClass:"lineup"},[t._v(t._s(t.$t("slice.lineup"))+" "),i("span",{staticStyle:{color:"#4C9FFA","font-size":"18px","font-weight":"bolder"}},[t._v(t._s(t.lineup))]),t._v(" "+t._s(t.$t("slice.position")))]):t._e()]),t._v(" "),i("div",{staticClass:"cancel",on:{click:t.canceltesk}},[t._v(t._s(t.$t("slice.cancelTasks")))])]):t._e(),t._v(" "),0==t.auto?i("div",{staticClass:"opinio"},[i("h1",[t._v("\n                "+t._s(t.$t("analyze.point"))+"\n            ")]),t._v(" "),i("textarea",{directives:[{name:"model",rawName:"v-model",value:t.record.opinion,expression:"record.opinion"}],attrs:{placeholder:t.$t("report.pointremind"),maxlength:"300"},domProps:{value:t.record.opinion},on:{input:[function(e){e.target.composing||t.$set(t.record,"opinion",e.target.value)},t.noEmoji]}})]):t._e()],1)])},staticRenderFns:[]};var _e=i("VU/8")(fe,me,!1,function(t){i("Rz6f")},"data-v-7d90d0be",null).exports,ye={data:()=>({}),methods:{getCount(t,e){return this.sRois[t.id]?this.sRois[t.id].filter(t=>t.type==e).length:0},checkall(){let t=this.ROIS.every(t=>!!t.image);this.ROIS.forEach(e=>this.$set(e,"image",!t))},change(t,e,i){this.$set(t,"image",i)},del(t){this.$confirm(this.$t("analaysisPanel.delete"),{confirmButtonText:this.$t("confirm.confirm"),cancelButtonText:this.$t("confirm.quit"),type:"warning"}).then(()=>{this.$emit("delRoi",t)},()=>{})}},props:["ROIS","currentRois","sRois","slice"]},Re={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"ck56-tctrois"},[t.ROIS.length?t._e():i("div",{staticClass:"ifshowtables"},[t._v(t._s(t.$t("slice.noanalysis")))]),t._v(" "),t.ROIS?i("div",{staticClass:"table"},[i("div",{staticClass:"top"},[i("div",{staticClass:"left"},[i("div",[i("span",{staticClass:"uncheck",class:{checked:t.ROIS.every(function(t){return!!t.image})},on:{click:t.checkall}}),t._v("\n                    ROI\n                ")])]),t._v(" "),i("div",[t._v(t._s(t.$t("slice.heterogeneousRegion")))]),t._v(" "),i("div",[t._v(t._s(t.$t("slice.total")))]),t._v(" "),i("div",[t._v(t._s(t.$t("slice.index")))]),t._v(" "),i("div",[t._v(t._s(t.$t("slice.deleted")))])]),t._v(" "),i("div",{staticClass:"rois"},t._l(t.ROIS,function(e,s){return i("div",{key:s,staticClass:"row",class:{curRoi:t.currentRois[e.id]},on:{click:function(i){return t.$emit("curROI",e,i.shiftKey)}}},[i("div",{staticClass:"left"},[i("div",[i("span",{staticClass:"uncheck",class:{checked:e.image},on:{click:function(i){i.stopPropagation(),t.change(e,"image",1-(e.image||0))}}}),t._v("\n                        "+t._s(s+1)+"\n                    ")])]),t._v(" "),i("div",[t._v(t._s(t.getCount(e,3)||"0"))]),t._v(" "),i("div",[t._v(t._s(t.getCount(e,1)+t.getCount(e,3)||"0"))]),t._v(" "),i("div",[t._v(t._s((t.getCount(e,3)/(t.getCount(e,1)+t.getCount(e,3)||1)*100).toFixed(1)+"%"))]),t._v(" "),i("div",[i("em",{attrs:{title:t.$t("upload.delete")},on:{click:function(i){return i.stopPropagation(),t.del(e)}}})])])}),0)]):t._e(),t._v(" "),t.ROIS?i("div",{staticClass:"tctbtm"},[i("div",{staticClass:"AiResult"},[i("div",[t._v("\n                "+t._s(t.$t("slice.AiResult"))+"\n            ")]),t._v(" "),i("div",{class:{error:"error"==t.slice.ck56.diagnosis}},[t._v("\n                "+t._s((t.ROIS.filter(function(t){return t.image}).map(function(e){return t.getCount(e,3)}).reduce(function(t,e){return t+e},0)/(t.ROIS.filter(function(t){return t.image}).map(function(e){return t.getCount(e,1)+t.getCount(e,3)}).reduce(function(t,e){return t+e},0)||1)*100).toFixed(1)+"%")+"\n            ")])]),t._v(" "),i("div",{staticClass:"confidence"},[i("div",[t._v(t._s(t.$t("slice.confidence")))]),t._v(" "),i("div",["error"!=t.slice.ck56.diagnosis&&null!=t.slice.ck56.diagnosis?i("div",[t._v("100"),i("span",[t._v("%")])]):t._e(),t._v(" "),"error"==t.slice.ck56.diagnosis?i("div",[t._v("0")]):t._e()])]),t._v(" "),i("div",{staticClass:"interactive"},[i("div",[t._v(t._s(t.$t("slice.interaction")))]),t._v(" "),i("el-radio-group",{staticClass:"radios",model:{value:t.slice.ck56.computer,callback:function(e){t.$set(t.slice.ck56,"computer",e)},expression:"slice.ck56.computer"}},[i("el-radio",{attrs:{label:!0}},[t._v("YES")]),t._v(" "),i("el-radio",{attrs:{label:!1}},[t._v("NO")]),t._v(" "),i("el-radio",{attrs:{label:"unsure"}},[t._v("UNSURE")])],1)],1)]):t._e()])},staticRenderFns:[]};var be=i("VU/8")(ye,Re,!1,function(t){i("odF9"),i("2imM")},null,null).exports,Ce={data(){return{loopHandler:0,auto:!0,centerRegion:null,curRois:{},showbutton:!0,position:{offx:this.slice.position?this.slice.position.offx:.5,offy:this.slice.position?this.slice.position.offy:.5*this.slice.height/this.slice.width,zoom:this.slice.position?this.slice.position.zoom:null},lineup:null,totalArea:"",showMppGuide:!1,drawMpp:null}},methods:{isDrawMpp(){/\.(png|jpg|jpeg|tiff|tif|bmp)$/.test(this.slice.filename)?this.showMppGuide=!0:this.startAnalyze()},noEmoji(t){t.target.value=t.target.value.replace(/[^\u0020-\u007E\u00A0-\u00BE\u2E80-\uA4CF\uF900-\uFAFF\uFE30-\uFE4F\uFF00-\uFFEF\u0080-\u009F\u2000-\u201f\u2026\u2022\u20ac\r\n]/g,"")},curROIChange(t,e){var i;!t||"grey"==t.color&&this.totalArea>5e5?(i=[],this.totalArea=0):t.length?i=t:e&&this.curRois[t.id]?(delete this.curRois[t.id],i=[]):i=[t],this.curRois=Object.assign({},e&&this.curRois,...i.map(t=>"grey"==t.color?{[t.id]:Object.assign({},t,{editable:!1})}:{[t.id]:t})),this.slice.roilist.forEach(t=>{this.curRois[t.id]&&this.$set(t,"path",this.curRois[t.id].path)})},listChangeCurrent(){var t=[].concat.apply([],Object.values(this.curRois).map(t=>t.path.x)),e=[].concat.apply([],Object.values(this.curRois).map(t=>t.path.y));t.length?this.centerRegion=[Math.min.apply(null,t),Math.min.apply(null,e),Math.max.apply(null,t),Math.max.apply(null,e)]:this.centerRegion=null},getArea(t){for(var e=0,i=0;i<t.x.length-2;i++){if(i+2<t.x.length)var s=[t.x[0],t.y[0]],n=[t.x[i+1],t.y[i+1]],a=[t.x[i+2],t.y[i+2]];e+=(Math.abs(s[0]*n[1])+Math.abs(n[0]*a[1])+Math.abs(a[0]*s[1])-Math.abs(s[0]*a[1])-Math.abs(n[0]*s[1])-Math.abs(a[0]*n[1]))/2}return e=Math.round(Math.abs(e)*Math.pow(this.slice.mppx||.242042,2))},draw(t){this.totalArea=this.getArea(t.path);for(var e=0;e<this.slice.ck56.result.length;e++)this.totalArea+=this.getArea(this.slice.ck56.result[e].path);if(t.id=(Math.random()+"").substr(2,6),this.auto){if(this.totalArea>5e5)return void this.$message({message:"ROI总面积不能大于0.5mm²",type:"warning"});t=Object.assign({},t,{image:""});var i=[...this.slice.ck56.result,t];this.$set(this.slice.ck56,"result",i)}else this.slice.roilist=[...this.slice.roilist,t]},async delCurRoi(t){let e={};for(var i of(t?(e={[t.id]:t},this.curRois[t.id]&&(delete this.curRois[t.id],this.curRois=Object.assign({},this.curRois))):(e=this.curRois,await this.$confirm(this.$t("analaysisPanel.delete"),{confirmButtonText:this.$t("confirm.confirm"),cancelButtonText:this.$t("confirm.quit"),type:"warning"}),this.curRois={}),Object.keys(e)))6==i.length?(this.slice.ck56.result=this.slice.ck56.result.filter(t=>t.id!=i),delete this.slice.ck56.airesult[i]):this.slice.ck56.result.map(t=>{void 0!=this.slice.ck56.airesult[t.id]&&(this.slice.ck56.airesult[t.id]=this.slice.ck56.airesult[t.id].filter(t=>!e[t.id]))});this.slice.roilist=this.slice.roilist.filter(t=>!e[t.id])},getAlgorithmResult(t=this.record.id,e=this.slice.id,i=this.slice.filename){Object(s.b)("ai/getresult",{caseid:t,fileid:e,filename:i,type:"ck56",other:JSON.stringify(this.slice.ck56.result.map(t=>({id:t.id,x:t.path.x,y:t.path.y})))}).then(t=>{this.lineup=t.data.rank,t.data.done?(this.showbutton=!0,this.loopHandler=0,this.$set(this.slice,"type","ck56"),-1!=t.data.rank?(this.flag="error",this.$set(this.slice.ck56,"diagnosis","error")):(Object.keys(t.data.result).filter(t=>!this.slice.ck56.result.find(e=>e.id==t)).map(e=>delete t.data.result[e]),this.slice.ck56.airesult=t.data.result,[].concat.apply([],Object.values(this.slice.ck56.airesult)).forEach(t=>t.id=(""+Math.random()).substr(2,8)),this.$set(this.slice.ck56,"diagnosis",1)),this.updateRecord()):(this.showbutton=!1,this.loopHandler=setTimeout(()=>this.getAlgorithmResult(),5e3))})},startAnalyze(t=this.record.id,e=this.slice.id,i=this.slice.filename){0!=this.slice.ck56.result.length?(this.$set(this.slice.ck56,"airesult",{}),this.$set(this.slice.ck56,"diagnosis",null),this.slice.started=!0,this.record.started=!0,this.showbutton=!1,this.auto=!0,this.slice.ck56.result.map(t=>t.image=!0),Object(s.b)("ai/start",{caseid:t,fileid:e,filename:i,type:"ck56",other:JSON.stringify(this.slice.ck56.result.map(t=>({id:t.id,x:t.path.x,y:t.path.y})))}).then(t=>{this.getAlgorithmResult()}).catch(t=>console.log(t)),this.updateRecord()):this.$message({message:"请先绘制ROI,再进行处理",type:"warning"})},canceltesk(){Object(s.b)("ai/revokeTask",{caseid:this.record.id,fileid:this.slice.id,type:"ck56",other:""}).then(t=>{0==t.code&&(clearTimeout(this.loopHandler),this.loopHandler=0,this.showbutton=!0,this.slice.started=!1,this.record.started=!1,this.slice.ck56.result.map(t=>t.image=!1),this.updateRecord())}).catch(t=>console.log(t))},updateRecord(){this.$emit("save","auto")},keydown(t){"Delete"!=t.key&&"Backspace"!=t.key||!Object.keys(this.curRois).length||this.delCurRoi()}},beforeMount(){this.slice.ck56||(this.$set(this.slice,"ck56",{}),this.$set(this.slice.ck56,"result",[]),this.$set(this.slice.ck56,"airesult",{})),this.slice.ck56&&!this.slice.ck56.airesult&&this.$set(this.slice.ck56,"airesult",{})},mounted(){this.slice.started&&this.slice.ck56&&null===this.slice.ck56.diagnosis&&this.getAlgorithmResult(),window.addEventListener("online",()=>{this.showbutton||this.getAlgorithmResult()})},beforeDestroy(){clearTimeout(this.loopHandler),this.loopHandler=0},watch:{"slice.id":{handler(){clearTimeout(this.loopHandler),this.loopHandler=0}},drawMpp:{handler(t){t&&(this.$set(this.slice,"mppx",t),this.$set(this.slice,"mppy",t),this.$emit("save","auto"),this.startAnalyze())}}},props:["slice","record"],components:{"v-dragon":v.a,"v-analyroi":be,"v-roi":m}},we={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"cnt",attrs:{tabIndex:0},on:{keydown:t.keydown}},[i("div",{staticClass:"analyright"},[i("v-dragon",{staticClass:"dragon",attrs:{record:t.record,slice:t.slice,roilist:this.slice.roilist.map(function(t){return Object.assign({method:"rectangle"},t,{color:{"阳性肿瘤":"red"}[t.jgResult]||"yellow"})}).concat((this.slice.ck56?this.slice.ck56.result:[]).map(function(t){return Object.assign({method:"rectangle"},t,{editable:!1,selectable:!1,color:"grey"})}),(this.slice.ck56?[].concat.apply([],Object.values(this.slice.ck56.airesult)):[]).filter(function(t){return 0!=t.type}).filter(function(t){return 2!=t.type}).map(function(e){return{id:e.id,color:{0:"yellow",1:"green",2:"blue",3:"red"}[e.type],path:{x:[(e.x[0]+e.x[2])/2],y:[(e.y[0]+e.y[2])/2]},method:"spot",editable:!0,selectable:!1,radius:1/(t.slice.mppx||.242042)}})),curRois:t.curRois,penColor:t.auto?"grey":"yellow",centerRegion:t.centerRegion,position:t.position,showMppGuide:t.showMppGuide},on:{curROI:t.curROIChange,draw:t.draw,delRoi:function(e){return t.delCurRoi(e)},position:function(e,i,s){t.$set(t.position,"offx",e),t.$set(t.position,"offy",i),t.$set(t.position,"zoom",s),t.$set(t.slice,"position",t.position)},closeMppGuide:function(e){t.showMppGuide=!1},changeMpp:function(e){return t.drawMpp=e}}}),t._v(" "),t.showbutton?i("button",{on:{click:function(e){return t.isDrawMpp()}}},[t._v(t._s(t.$t("slice.start")))]):t._e()],1),t._v(" "),i("div",{staticClass:"analylist"},[i("h2",[i("span",{class:t.auto?"auto":"",on:{click:function(e){t.auto=!0}}},[t._v(t._s(t.$t("analyze.airoi")))]),t._v(" "),i("span",{class:t.auto?"":"noauto",on:{click:function(e){t.auto=!1}}},[t._v(t._s(t.$t("analyze.roi")))])]),t._v(" "),t.auto?i("v-analyroi",{staticClass:"table",attrs:{slice:t.slice,ROIS:this.slice.ck56?this.slice.ck56.result:[],sRois:this.slice.ck56?this.slice.ck56.airesult:{},currentRois:t.curRois},on:{curROI:function(e,i){return t.curROIChange(e,i)+t.listChangeCurrent()},delRoi:function(e){return t.delCurRoi(e)}}}):t._e(),t._v(" "),t.auto?t._e():i("v-roi",{staticClass:"manualroi",attrs:{roilist:t.slice.roilist,currentRois:t.curRois},on:{curROI:function(e,i){return t.curROIChange(e,i)+t.listChangeCurrent()},delRoi:function(e){return t.delCurRoi(e)}}}),t._v(" "),!t.showbutton&&t.auto?i("div",{staticClass:"loding"},[i("div",{staticClass:"video"},[i("img",{attrs:{src:"/static/video/loading.gif"}}),t._v(" "),0==t.lineup?i("div",{staticClass:"lineup"},[t._v("正在处理...")]):t._e(),t._v(" "),t.lineup>0?i("div",{staticClass:"lineup"},[t._v(t._s(t.$t("slice.lineup"))+" "),i("span",{staticStyle:{color:"#4C9FFA","font-size":"18px","font-weight":"bolder"}},[t._v(t._s(t.lineup))]),t._v(" "+t._s(t.$t("slice.position")))]):t._e()]),t._v(" "),i("div",{staticClass:"cancel",on:{click:t.canceltesk}},[t._v(t._s(t.$t("slice.cancelTasks")))])]):t._e(),t._v(" "),0==t.auto?i("div",{staticClass:"opinio"},[i("h1",[t._v("\n                "+t._s(t.$t("analyze.point"))+"\n            ")]),t._v(" "),i("textarea",{directives:[{name:"model",rawName:"v-model",value:t.record.opinion,expression:"record.opinion"}],attrs:{placeholder:t.$t("report.pointremind"),maxlength:"300"},domProps:{value:t.record.opinion},on:{input:[function(e){e.target.composing||t.$set(t.record,"opinion",e.target.value)},t.noEmoji]}})]):t._e()],1)])},staticRenderFns:[]};var ke=i("VU/8")(Ce,we,!1,function(t){i("IaF7")},"data-v-33e16d84",null).exports,xe={data:()=>({index:0,options:[{value:"HER-2 0",label:"HER-2 0"},{value:"HER-2 1+",label:"HER-2 1+"},{value:"HER-2 2+",label:"HER-2 2+"},{value:"HER-2 3+",label:"HER-2 3+"}],checkResult:null}),methods:{changeResult(t){this.checkResult=t,this.$emit("update",t)},changeImage(t){this.$set(t,"image",1-(t.image||0)),this.$emit("roiChanged","image",[t])},checkall(){if(!this.ROIS.length)return;let t=this.ROIS.every(t=>!!t.image),e=this.ROIS.map(e=>{return{id:e.id,image:t?0:1}});this.$emit("roiChanged","image",e)},del(t){this.$emit("closecontextmenu"),this.$confirm(this.$t("analaysisPanel.delete"),{confirmButtonText:this.$t("confirm.confirm"),cancelButtonText:this.$t("confirm.quit"),type:"warning"}).then(()=>{this.$emit("delRoi",t)},()=>{})},totalRoi(t){return this.checkedRois.map(e=>e.aiResult[t][0]).reduce((t,e)=>t+e,0)}},mounted(){"her2"===this.slice.alg&&this.slice.check_result&&(this.checkResult=this.slice.check_result)},computed:{checkedRois(){return this.ROIS.filter(t=>t.image)},positiveTotal(){return this.checkedRois.map(t=>t.aiResult["肿瘤细胞总数"]).reduce((t,e)=>t+e,0)}},watch:{"slice.check_result":{handler(t){"her2"===this.slice.alg&&(this.checkResult=t)}}},props:["ROIS","currentRois","ave","slice"]},$e={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"her2rois"},[t.ROIS?t._e():i("div",{staticClass:"ifshowtables"},[t._v(t._s(t.$t("slice.noanalysis")))]),t._v(" "),t.ROIS?i("div",{staticClass:"hertable"},[i("div",{staticClass:"top"},[i("div",{staticClass:"left"},[i("div",[i("span",{staticClass:"uncheck",class:{checked:0==t.ROIS.length?"":t.ROIS.every(function(t){return!!t.image})},on:{click:t.checkall}}),t._v("\n                    ROI\n                ")])]),t._v(" "),i("div",{staticClass:"long"},[t._v("分级结果")]),t._v(" "),i("div",{staticClass:"option"},[t._v(t._s(t.$t("slice.deleted")))])]),t._v(" "),i("div",{staticClass:"rois"},t._l(t.ROIS,function(e,s){return i("div",{key:s},[i("div",{staticClass:"row",class:{curRoi:t.currentRois[e.id]},on:{click:function(i){t.$emit("closecontextmenu"),t.$emit("curROI",e,i.shiftKey)}}},[i("div",{staticClass:"left"},[i("div",[i("span",{staticClass:"uncheck",class:{checked:e.image},on:{click:function(i){return i.stopPropagation(),t.changeImage(e)}}}),t._v("\n                            "+t._s(e.aiResult.whole_slide?"全场图":s+1)+"\n                        ")])]),t._v(" "),i("div",{staticClass:"long"},[t._v(t._s(e.aiResult["分级结果"]))]),t._v(" "),i("div",{staticClass:"option"},[i("em",{staticClass:"eidt",attrs:{title:"详情"},on:{click:function(e){e.stopPropagation(),t.index===s?t.index=null:t.index=s}}}),t._v(" "),i("em",{attrs:{title:t.$t("upload.delete")},on:{click:function(i){return i.stopPropagation(),t.del(e)}}})])]),t._v(" "),t.index===s?i("div",{staticClass:"roi-detail"},[i("p",[t._v("微弱的不完整膜阳性肿瘤细胞："+t._s(e.aiResult["微弱的不完整膜阳性肿瘤细胞"][0]))]),t._v(" "),i("p",[t._v("弱中等的完整膜阳性肿瘤细胞："+t._s(e.aiResult["弱中等的完整膜阳性肿瘤细胞"][0]))]),t._v(" "),i("p",[t._v("中强度的不完整膜阳性肿瘤细胞："+t._s(e.aiResult["中强度的不完整膜阳性肿瘤细胞"][0]))]),t._v(" "),i("p",[t._v("强度的完整膜阳性肿瘤细胞："+t._s(e.aiResult["强度的完整膜阳性肿瘤细胞"][0]))]),t._v(" "),i("p",[t._v("阳性肿瘤细胞："+t._s(e.aiResult["阳性肿瘤细胞"][0]))])]):t._e()])}),0)]):t._e(),t._v(" "),t.ROIS?i("div",{staticClass:"herbtm"},[i("table",[t._m(0),t._v(" "),i("tr",[t._m(1),t._v(" "),i("td",{staticStyle:{color:"#FFC1C1"},attrs:{width:"50"}},[t._v(t._s(t.totalRoi("微弱的不完整膜阳性肿瘤细胞")))]),t._v(" "),i("td",[t._v(t._s((t.totalRoi("微弱的不完整膜阳性肿瘤细胞")/(t.positiveTotal||1)*100).toFixed(2))+"%")])]),t._v(" "),i("tr",[t._m(2),t._v(" "),i("td",{staticStyle:{color:"#FC7915"},attrs:{width:"50"}},[t._v(t._s(t.totalRoi("弱中等的完整膜阳性肿瘤细胞")))]),t._v(" "),i("td",[t._v(t._s((t.totalRoi("弱中等的完整膜阳性肿瘤细胞")/(t.positiveTotal||1)*100).toFixed(2))+"%")])]),t._v(" "),i("tr",[t._m(3),t._v(" "),i("td",{staticStyle:{color:"#9974FE"},attrs:{width:"50"}},[t._v(t._s(t.totalRoi("中强度的不完整膜阳性肿瘤细胞")))]),t._v(" "),i("td",[t._v(t._s((t.totalRoi("中强度的不完整膜阳性肿瘤细胞")/(t.positiveTotal||1)*100).toFixed(2))+"%")])]),t._v(" "),i("tr",[t._m(4),t._v(" "),i("td",{staticStyle:{color:"#FF0000"},attrs:{width:"50"}},[t._v(t._s(t.totalRoi("强度的完整膜阳性肿瘤细胞")))]),t._v(" "),i("td",[t._v(t._s((t.totalRoi("强度的完整膜阳性肿瘤细胞")/(t.positiveTotal||1)*100).toFixed(2))+"%")])]),t._v(" "),i("tr",[t._m(5),t._v(" "),i("td",{attrs:{width:"50"}},[t._v(t._s(t.totalRoi("完整膜阳性肿瘤细胞")))]),t._v(" "),i("td",[t._v(t._s((t.totalRoi("完整膜阳性肿瘤细胞")/(t.positiveTotal||1)*100).toFixed(2))+"%")])]),t._v(" "),i("tr",[t._m(6),t._v(" "),i("td",{attrs:{width:"50"}},[t._v(t._s(t.totalRoi("阳性肿瘤细胞")))]),t._v(" "),i("td",[t._v(t._s((t.totalRoi("阳性肿瘤细胞")/(t.positiveTotal||1)*100).toFixed(2))+"%")])]),t._v(" "),i("tr",[t._m(7),t._v(" "),i("td",{staticStyle:{color:"#3D901F"},attrs:{width:"50"}},[t._v(t._s(this.checkedRois.map(function(t){return t.aiResult["阴性肿瘤细胞"]}).reduce(function(t,e){return t+e},0)))]),t._v(" "),i("td",[t._v("--")])]),t._v(" "),i("tr",[t._m(8),t._v(" "),i("td",{attrs:{width:"50"}},[t._v(t._s(t.positiveTotal))]),t._v(" "),i("td",[t._v("--")])]),t._v(" "),i("tr",[t._m(9),t._v(" "),i("td",{staticStyle:{color:"#A8FC8E"},attrs:{width:"50"}},[t._v(t._s(this.checkedRois.map(function(t){return t.aiResult["其他"]}).reduce(function(t,e){return t+e},0)))]),t._v(" "),i("td",[t._v("--")])])]),t._v(" "),i("div",{staticClass:"level"},[t._v("\n           HER-2分级："),i("span",[t._v(t._s(t.ave))])])]):t._e(),t._v(" "),i("div",{staticClass:"recheck"},[i("div",{staticClass:"doc-check"},[i("i",[t._v("医生复核")]),t._v(" "),i("span",{on:{click:function(e){return t.changeResult("")}}},[t._v("清空")]),t._v(" "),i("span",{on:{click:function(e){return t.changeResult(t.ave)}}},[t._v("采纳AI建议")])]),t._v(" "),i("div",{staticClass:"check-result"},[t._v("\n            请选择\n            "),i("el-select",{on:{change:t.changeResult},model:{value:t.checkResult,callback:function(e){t.checkResult=e},expression:"checkResult"}},t._l(t.options,function(t){return i("el-option",{key:t.value,attrs:{value:t.value,label:t.label}})}),1)],1)])])},staticRenderFns:[function(){var t=this.$createElement,e=this._self._c||t;return e("tr",[e("th",[this._v("细胞")]),e("th",[this._v("总数")]),e("th",[this._v("占肿瘤细胞")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("td",{attrs:{title:"微弱的不完整膜阳性肿瘤细胞"}},[e("div",{staticClass:"tolong"},[this._v("微弱的不完整膜阳性肿瘤细胞")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("td",{attrs:{title:"弱中等的完整膜阳性肿瘤细胞"}},[e("div",{staticClass:"tolong"},[this._v("弱中等的完整膜阳性肿瘤细胞")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("td",{attrs:{title:"中强度的不完整膜阳性肿瘤细胞"}},[e("div",{staticClass:"tolong"},[this._v("中强度的不完整膜阳性肿瘤细胞")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("td",{attrs:{title:"强度的完整膜阳性肿瘤细胞"}},[e("div",{staticClass:"tolong"},[this._v("强度的完整膜阳性肿瘤细胞")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("td",{attrs:{title:"完整膜阳性肿瘤细胞"}},[e("div",{staticClass:"tolong"},[this._v("完整膜阳性肿瘤细胞")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("td",{attrs:{title:"阳性肿瘤细胞"}},[e("div",{staticClass:"tolong"},[this._v("阳性肿瘤细胞")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("td",{attrs:{title:"阴性肿瘤细胞"}},[e("div",{staticClass:"tolong"},[this._v("阴性肿瘤细胞")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("td",{attrs:{title:"肿瘤细胞总数"}},[e("div",{staticClass:"tolong"},[this._v("肿瘤细胞总数")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("td",{attrs:{title:"其他"}},[e("div",{staticClass:"tolong"},[this._v("其他")])])}]};var Ie=i("VU/8")(xe,$e,!1,function(t){i("a733"),i("feOy")},null,null).exports,Oe={data:()=>({labeltree:[{id:1,label:"微弱的不完整膜阳性肿瘤细胞"},{id:2,label:"弱中等的完整膜阳性肿瘤细胞"},{id:3,label:"中强度的不完整膜阳性肿瘤细胞"},{id:4,label:"强度的完整膜阳性肿瘤细胞"},{id:7,label:"阴性肿瘤细胞"},{id:13,label:"其他",children:[{id:9,label:"组织细胞"},{id:10,label:"淋巴细胞"},{id:11,label:"纤维细胞"},{id:12,label:"其他非肿瘤细胞"}]}],roiTypeOpitions:{1:"#FFC1C1",2:"#FC7915",3:"#9974FE",4:"#FF0000",7:"#3D901F",9:"#A8FC8E",10:"#A8FC8E",11:"#A8FC8E",12:"#A8FC8E"},defaultColor:"#FFC1C1",defaultType:1}),computed:{ave(){let t=this.aiFatherRois.filter(t=>t.image),e=t.map(t=>t.aiResult["强度的完整膜阳性肿瘤细胞"][0]).reduce((t,e)=>t+e,0),i=t.map(t=>t.aiResult["微弱的不完整膜阳性肿瘤细胞"][0]).reduce((t,e)=>t+e,0),s=t.map(t=>t.aiResult["中强度的不完整膜阳性肿瘤细胞"][0]).reduce((t,e)=>t+e,0),n=t.map(t=>t.aiResult["弱中等的完整膜阳性肿瘤细胞"][0]).reduce((t,e)=>t+e,0),a=t.map(t=>t.aiResult["阴性肿瘤细胞"]).reduce((t,e)=>t+e,0);if(i+n+s+e+a+t.map(t=>t.aiResult["其他"]).reduce((t,e)=>t+e,0)<10)return"有效检测细胞不足";i>=e?n+=s:i+=s;let o=n+e,r=i+n+(s=0)+e,l=r+a+1e-16;return e/l>.1?"HER-2 3+":o/l>.1&&e/l<.1||e/l>=.005&&e/l<=.1?"HER-2 2+":n/l>=.02&&n/l<=.1||(i+s)/l>.1&&o/l<=.1?"HER-2 1+":r/l<.01||(i+s)/l<=.1?"HER-2 0":void 0}},components:{"v-dragon":v.a,"v-analyroi":Ie,"v-roi":m,"v-menus":V},mixins:[G.a]},Ae={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"cnt",attrs:{tabIndex:0},on:{keydown:t.keydown}},[i("div",{staticClass:"analyright",on:{mousewheel:function(e){t.ki67Anno=null},mousedown:function(e){t.ki67Anno=null}}},[i("v-dragon",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],ref:"osd",staticClass:"dragon",attrs:{record:t.record,slice:t.slice,roilist:t.leftRoilist,curRois:t.curRois,penColor:t.auto?"grey":"yellow",centerRegion:t.centerRegion,position:t.position,showMppGuide:t.showMppGuide,cellArea:110,"element-loading-text":"处理中，请耐心等待","element-loading-spinner":"el-icon-loading","element-loading-background":"rgba(0, 0, 0, 0.5)"},on:{curROI:t.curROIChange,draw:t.draw,delRoi:function(e){return t.delCurRoi(e)},position:function(e,i,s){t.$set(t.position,"offx",e),t.$set(t.position,"offy",i),t.$set(t.position,"zoom",s),t.$set(t.slice,"position",t.position)},closeMppGuide:function(e){t.showMppGuide=!1},changeMpp:function(e){return t.drawMpp=e},clickDraw:t.clickDraw,getRoi:function(e){return t.getRoi(e)},roiChanged:t.roiChanged,parentId:function(e){return t.parentId=e},contextmenu:function(e,i){return t.showMenu(e,i)}}},[t.ki67Anno?i("div",{staticStyle:{position:"absolute"},style:{left:t.menuPosition.x+"px",top:t.menuPosition.y+"px"}},[i("v-menus",{attrs:{pos:t.ki67Anno,menus:t.labeltree,currentItem:t.currentItem,newover:t.newover},on:{chosen:function(e){return t.setAnnotation(e)}}})],1):t._e()]),t._v(" "),t.showbutton?i("button",{on:{click:function(e){return t.isDrawMpp()}}},[t._v(t._s(t.$t("slice.start")))]):t._e()],1),t._v(" "),i("div",{staticClass:"analylist"},[i("div",{staticClass:"quality"},[t._m(0),t._v(" "),i("div",{staticClass:"quality-detail"},[i("p",{staticStyle:{width:"50%",margin:"0"}},[t._v("清 晰 度："+t._s(t.slice.clarity?(100*t.slice.clarity).toFixed(2)+"%":"-"))]),t._v(" "),i("p",{staticStyle:{width:"50%",margin:"0"}},[t._v("扫描倍数："+t._s(t.slice.objective_rate||"-"))])])]),t._v(" "),i("h2",[i("span",{class:t.auto?"auto":"",on:{click:function(e){t.auto=!0}}},[t._v("AI处理")]),t._v(" "),i("span",{class:t.auto?"":"noauto",on:{click:function(e){t.auto=!1}}},[t._v("手动处理")])]),t._v(" "),t.auto?i("v-analyroi",{staticClass:"table",attrs:{slice:t.slice,ROIS:t.aiFatherRois,ave:t.ave,currentRois:t.curRois},on:{curROI:function(e,i){return t.curROIChange(e,i)+t.listChangeCurrent()},delRoi:function(e){return t.delCurRoi(e)},roiChanged:t.roiChanged,update:function(e){return t.reCheck(e)},closecontextmenu:function(e){t.ki67Anno=null}}}):t._e(),t._v(" "),t.auto?t._e():i("v-roi",{staticClass:"manualroi",attrs:{roilist:t.rightRoilist,currentRois:t.curRois},on:{curROI:function(e,i){return t.curROIChange(e,i)+t.listChangeCurrent()},delRoi:function(e){return t.delCurRoi(e)},roiChanged:t.roiChanged}}),t._v(" "),!t.showbutton&&t.auto?i("div",{staticClass:"loding"},[i("div",{staticClass:"video"},[i("img",{attrs:{src:"/static/video/loading.gif"}}),t._v(" "),0==t.lineup?i("div",{staticClass:"lineup"},[t._v("正在处理...")]):t._e(),t._v(" "),t.lineup>0?i("div",{staticClass:"lineup"},[t._v(t._s(t.$t("slice.lineup"))+" "),i("span",{staticStyle:{color:"#4C9FFA","font-size":"18px","font-weight":"bolder"}},[t._v(t._s(t.lineup))]),t._v(" "+t._s(t.$t("slice.position")))]):t._e()]),t._v(" "),i("div",{staticClass:"cancel",on:{click:t.canceltesk}},[t._v(t._s(t.$t("slice.cancelTasks")))])]):t._e()],1)])},staticRenderFns:[function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"title"},[e("span",[this._v("AI质控")])])}]};var Me=i("VU/8")(Oe,Ae,!1,function(t){i("foGf")},"data-v-41867852",null).exports,Se={data(){return{checkResult:this.slice.alg===this.slice.toolType&&this.slice.check_result.slice(0,this.slice.check_result.length-1)||null}},computed:{aiResult(){return this.ROIS[0].aiResult}},methods:{changeResult(t){this.checkResult=t,this.$emit("acceptAI",t)},changeImage(t){this.$set(t,"image",1-(t.image||0)),this.$emit("roiChanged","image",[t])},checkall(){if(!this.ROIS.length)return;let t=this.ROIS.every(t=>!!t.image),e=this.ROIS.map(e=>{return{id:e.id,image:t?0:1}});this.$emit("roiChanged","image",e)},del(t){this.$confirm(this.$t("analaysisPanel.delete"),{confirmButtonText:this.$t("confirm.confirm"),cancelButtonText:this.$t("confirm.quit"),type:"warning"}).then(()=>{this.$emit("delRoi",t)},()=>{})}},props:["ROIS","currentRois","slice","ave"]},Te={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"pdl1rois"},[t.ROIS?i("div",{staticClass:"pal1table"},[i("div",{staticClass:"top"},[i("div",{staticClass:"left"},[i("div",[i("span",{staticClass:"uncheck",class:{checked:0==t.ROIS.length?"":t.ROIS.every(function(t){return!!t.image})},on:{click:t.checkall}}),t._v("\n                    ROI\n                ")])]),t._v(" "),i("div",{staticClass:"long"},[t._v("阳性肿瘤")]),t._v(" "),i("div",{staticClass:"total"},[t._v(t._s(t.$t("slice.total")))]),t._v(" "),i("div",{staticClass:"tps"},[t._v("TPS")]),t._v(" "),i("div",{staticClass:"option"},[t._v(t._s(t.$t("slice.deleted")))])]),t._v(" "),i("div",{staticClass:"rois"},[t._l(t.ROIS,function(e,s){return i("div",{key:s,staticClass:"row",class:{curRoi:t.currentRois[e.id]},on:{click:function(i){return t.$emit("curROI",e,i.shiftKey)}}},[i("div",{staticClass:"left"},[i("div",[i("span",{staticClass:"uncheck",class:{checked:e.image},on:{click:function(i){return i.stopPropagation(),t.changeImage(e)}}}),t._v("\n                        "+t._s(s+1)+"\n                    ")])]),t._v(" "),i("div",{staticClass:"long",attrs:{title:e.aiResult.pos_tumor}},[t._v(t._s(e.aiResult.pos_tumor))]),t._v(" "),i("div",{staticClass:"total",attrs:{title:e.aiResult.neg_tumor+e.aiResult.pos_tumor}},[t._v("\n                    "+t._s(e.aiResult.neg_tumor+e.aiResult.pos_tumor)+"\n                ")]),t._v(" "),i("div",{staticClass:"tps"},[t._v(t._s((100*e.aiResult.tps).toFixed(2)+"%")+"\n                ")]),t._v(" "),i("div",{staticClass:"option"},[i("em",{attrs:{title:t.$t("upload.delete")},on:{click:function(i){return i.stopPropagation(),t.del(e)}}})])])}),t._v(" "),t.ROIS.some(function(t){return t.aiResult.whole_slide})?i("div",{staticClass:"qure"},[i("div",{staticClass:"roi-detail",on:{click:function(e){return t.$emit("movetoCenter","lefttop")}}},[t._m(0),t._v(" "),i("div",{staticClass:"long",attrs:{title:t.aiResult[1].pos_tumor}},[t._v(t._s(t.aiResult[1].pos_tumor))]),t._v(" "),i("div",{staticClass:"total",attrs:{title:t.aiResult[1].pos_tumor+t.aiResult[1].neg_tumor}},[t._v("\n                        "+t._s(t.aiResult[1].pos_tumor+t.aiResult[1].neg_tumor)+"\n                    ")]),t._v(" "),i("div",{staticClass:"tps"},[t._v(t._s((t.aiResult[1].pos_tumor/(t.aiResult[1].pos_tumor+t.aiResult[1].neg_tumor||1)*100).toFixed(2)+"%"))]),t._v(" "),i("div",{staticClass:"option"})]),t._v(" "),i("div",{staticClass:"roi-detail",on:{click:function(e){return t.$emit("movetoCenter","righttop")}}},[t._m(1),t._v(" "),i("div",{staticClass:"long",attrs:{title:t.aiResult[2].pos_tumor}},[t._v(t._s(t.aiResult[2].pos_tumor))]),t._v(" "),i("div",{staticClass:"total",attrs:{title:t.aiResult[2].pos_tumor+t.aiResult[2].neg_tumor}},[t._v("\n                        "+t._s(t.aiResult[2].pos_tumor+t.aiResult[2].neg_tumor)+"\n                    ")]),t._v(" "),i("div",{staticClass:"tps"},[t._v(t._s((t.aiResult[2].pos_tumor/(t.aiResult[2].pos_tumor+t.aiResult[2].neg_tumor||1)*100).toFixed(2)+"%"))]),t._v(" "),i("div",{staticClass:"option"})]),t._v(" "),i("div",{staticClass:"roi-detail",on:{click:function(e){return t.$emit("movetoCenter","leftbottom")}}},[t._m(2),t._v(" "),i("div",{staticClass:"long",attrs:{title:t.aiResult[3].pos_tumor}},[t._v(t._s(t.aiResult[3].pos_tumor))]),t._v(" "),i("div",{staticClass:"total",attrs:{title:t.aiResult[3].pos_tumor+t.aiResult[3].neg_tumor}},[t._v("\n                        "+t._s(t.aiResult[3].pos_tumor+t.aiResult[3].neg_tumor)+"\n                    ")]),t._v(" "),i("div",{staticClass:"tps"},[t._v(t._s((t.aiResult[3].pos_tumor/(t.aiResult[3].pos_tumor+t.aiResult[3].neg_tumor||1)*100).toFixed(2)+"%"))]),t._v(" "),i("div",{staticClass:"option"})]),t._v(" "),i("div",{staticClass:"roi-detail",on:{click:function(e){return t.$emit("movetoCenter","rightbottom")}}},[t._m(3),t._v(" "),i("div",{staticClass:"long",attrs:{title:t.aiResult[4].pos_tumor}},[t._v(t._s(t.aiResult[4].pos_tumor))]),t._v(" "),i("div",{staticClass:"total",attrs:{title:t.aiResult[4].pos_tumor+t.aiResult[4].neg_tumor}},[t._v("\n                        "+t._s(t.aiResult[4].pos_tumor+t.aiResult[4].neg_tumor)+"\n                    ")]),t._v(" "),i("div",{staticClass:"tps"},[t._v(t._s((t.aiResult[4].pos_tumor/(t.aiResult[4].pos_tumor+t.aiResult[4].neg_tumor||1)*100).toFixed(2)+"%"))]),t._v(" "),i("div",{staticClass:"option"})])]):t._e()],2)]):t._e(),t._v(" "),t.ROIS?i("div",{staticClass:"pdl1btm"},[i("div",{staticClass:"result",staticStyle:{color:"red"}},[i("div",[t._v("\n                阳性肿瘤细胞\n            ")]),t._v(" "),i("div",[t._v("\n                "+t._s(t.ROIS.filter(function(t){return t.image}).map(function(t){return t.aiResult.pos_tumor}).reduce(function(t,e){return t+e},0))+"\n            ")])]),t._v(" "),i("div",{staticClass:"result",staticStyle:{color:"green"}},[i("div",[t._v("\n                阴性肿瘤细胞\n            ")]),t._v(" "),i("div",[t._v("\n                "+t._s(t.ROIS.filter(function(t){return t.image}).map(function(t){return t.aiResult.neg_tumor}).reduce(function(t,e){return t+e},0))+"\n            ")])]),t._v(" "),i("div",{staticClass:"result",staticStyle:{color:"yellow"}},[i("div",[t._v("\n                阳性非肿瘤细胞\n            ")]),t._v(" "),i("div",[t._v("\n                "+t._s(t.ROIS.filter(function(t){return t.image}).map(function(t){return t.aiResult.pos_norm}).reduce(function(t,e){return t+e},0))+"\n            ")])]),t._v(" "),i("div",{staticClass:"result",staticStyle:{color:"#9117d0"}},[i("div",[t._v("\n                阴性非肿瘤细胞\n            ")]),t._v(" "),i("div",[t._v("\n                "+t._s(t.ROIS.filter(function(t){return t.image}).map(function(t){return t.aiResult.neg_norm}).reduce(function(t,e){return t+e},0))+"\n            ")])]),t._v(" "),i("div",{staticClass:"result"},[i("div",[t._v("\n                细胞总数\n            ")]),t._v(" "),i("div",[t._v("\n                "+t._s(t.ROIS.filter(function(t){return t.image}).map(function(t){return t.aiResult.total}).reduce(function(t,e){return t+e},0))+"\n            ")])]),t._v(" "),i("div",{staticClass:"result"},[i("div",[t._v("\n                TPS\n            ")]),t._v(" "),i("div",[t._v("\n                "+t._s(t.ave)+"%\n            ")])])]):t._e(),t._v(" "),i("div",{staticClass:"recheck"},[i("div",{staticClass:"doc-check"},[i("i",[t._v("医生复核")]),t._v(" "),i("span",{on:{click:function(e){return t.changeResult("")}}},[t._v("清空")]),t._v(" "),i("span",{on:{click:function(e){return t.changeResult(t.ave)}}},[t._v("采纳AI建议")])]),t._v(" "),i("div",{staticClass:"check-result"},[t._v("指数"),i("input",{directives:[{name:"model",rawName:"v-model",value:t.checkResult,expression:"checkResult"}],domProps:{value:t.checkResult},on:{blur:function(e){return t.changeResult(t.checkResult)},input:function(e){e.target.composing||(t.checkResult=e.target.value)}}}),t._v("%")])])])},staticRenderFns:[function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"left"},[e("div",[this._v("1象限")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"left"},[e("div",[this._v("2象限")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"left"},[e("div",[this._v("3象限")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"left"},[e("div",[this._v("4象限")])])}]};var Fe=i("VU/8")(Se,Te,!1,function(t){i("YYGD"),i("bg7G")},null,null).exports,je={data:()=>({labeltree:[{id:3,label:"阳性肿瘤"},{id:1,label:"阴性肿瘤"},{id:2,label:"阳性非肿瘤"},{id:0,label:"阴性非肿瘤"}],roiTypeOpitions:{0:"purple",2:"yellow",3:"red",1:"green"},defaultColor:"red",defaultType:3,moveStatus:"countEnd",isMaxlvl:!1,screenCount:[],curCount:{}}),methods:{movetoCenter(t){let e=this.slice.width/this.slice.height,i=this.$refs.osd;switch(t){case"lefttop":i.move(.25,.25/e,Math.min(i.offsetHeight/i.offsetWidth*e*2,2));break;case"righttop":i.move(.75,.25/e,Math.min(i.offsetHeight/i.offsetWidth*e*2,2));break;case"leftbottom":i.move(.25,.75/e,Math.min(i.offsetHeight/i.offsetWidth*e*2,2));break;case"rightbottom":i.move(.75,.75/e,Math.min(i.offsetHeight/i.offsetWidth*e*2,2))}},changeMoveStatus(t){this.moveStatus=t,"moveEnd"==t&&this.slice.ai_suggest&&this.getScreenCount()},getScreenCount(){Object(s.b)(`slice/getScreenCount?companyid=${Object(s.s)().company}`,{caseid:this.record.id,fileid:this.slice.id,position:JSON.stringify(this.curLevel),ai_type:"pdl1"}).then(({data:t})=>{this.isMaxlvl=t.isMaxlvl,this.moveStatus="countEnd",!t.isMaxlvl&&this.fullField?this.screenCount=Object.values(t.result):this.curCount=t.result})}},computed:{fullField(){return this.aiFatherRois.some(t=>t.aiResult.whole_slide)},ave(){return(this.aiFatherRois.filter(t=>t.image).map(t=>t.aiResult.pos_tumor).reduce((t,e)=>t+e,0)/((this.aiFatherRois.filter(t=>t.image).map(t=>t.aiResult.pos_tumor).reduce((t,e)=>t+e,0)||0)+this.aiFatherRois.filter(t=>t.image).map(t=>t.aiResult.neg_tumor).reduce((t,e)=>t+e,0)||1)*100).toFixed(2)}},props:["slice","record"],components:{"v-dragon":v.a,"v-analyroi":Fe,"v-roi":m,"v-menus":V},mixins:[G.a]},Ee={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"cnt",attrs:{tabIndex:0},on:{keydown:t.keydown}},[i("div",{staticClass:"analyright",class:{showall:t.fullField&&!t.isMaxlvl},on:{mousewheel:function(e){t.ki67Anno=null},mousedown:function(e){t.ki67Anno=null}}},[i("v-dragon",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],ref:"osd",staticClass:"dragon",attrs:{record:t.record,slice:t.slice,roilist:t.leftRoilist,curRois:t.curRois,penColor:t.auto?"grey":"yellow",centerRegion:t.centerRegion,moveStatus:t.moveStatus,position:t.position,showMppGuide:t.showMppGuide,cellArea:110,"element-loading-text":"处理中，请耐心等待","element-loading-spinner":"el-icon-loading","element-loading-background":"rgba(0, 0, 0, 0.5)"},on:{changeMoveStatus:t.changeMoveStatus,curROI:t.curROIChange,draw:t.draw,delRoi:function(e){return t.delCurRoi(e)},position:function(e,i,s){t.$set(t.position,"offx",e),t.$set(t.position,"offy",i),t.$set(t.position,"zoom",s),t.$set(t.slice,"position",t.position)},closeMppGuide:function(e){t.showMppGuide=!1},changeMpp:function(e){return t.drawMpp=e},clickDraw:t.clickDraw,getRoi:t.getRoi,roiChanged:t.roiChanged,parentId:function(e){return t.parentId=e},contextmenu:function(e,i){return t.showMenu(e,i)}}},[t.ki67Anno?i("div",{staticStyle:{position:"absolute"},style:{left:t.menuPosition.x+"px",top:t.menuPosition.y+"px"}},[i("v-menus",{attrs:{pos:t.ki67Anno,menus:t.labeltree,currentItem:t.currentItem,newover:t.newover},on:{chosen:t.setAnnotation}})],1):t._e()]),t._v(" "),t.showbutton?i("button",{on:{click:function(e){return t.isDrawMpp()}}},[t._v(t._s(t.$t("slice.start")))]):t._e(),t._v(" "),t.fullField&&!t.isMaxlvl?i("div",t._l(t.screenCount,function(e,s){return i("div",{key:s,staticClass:"tps",class:{lefttop:0==s,righttop:1==s,leftbottom:2==s,rightbottom:3==s}},[i("p",[t._v("阳性肿瘤细胞："),"countEnd"==t.moveStatus?i("span",{staticClass:"red"},[t._v(t._s(e.pos_tumor))]):t._e()]),t._v(" "),i("p",[t._v("TPS："),"countEnd"==t.moveStatus?i("span",[t._v(t._s((e.pos_tumor/(e.pos_tumor+e.neg_tumor||1)*100).toFixed(2))+"%")]):t._e()]),t._v(" "),"countEnd"!=t.moveStatus?i("div",{staticClass:"start",class:{end:"moveEnd"==t.moveStatus}}):t._e()])}),0):t._e(),t._v(" "),(t.isMaxlvl&&t.fullField||!t.fullField)&&t.slice.ai_suggest?i("div",{staticClass:"tps btmcenter"},[i("p",[t._v("阳性肿瘤细胞："),"countEnd"==t.moveStatus?i("span",{staticClass:"red"},[t._v(t._s(t.curCount.pos_tumor))]):t._e()]),t._v(" "),i("p",[t._v("TPS："),"countEnd"==t.moveStatus?i("span",[t._v(t._s((t.curCount.pos_tumor/(t.curCount.pos_tumor+t.curCount.neg_tumor||1)*100).toFixed(2))+"%")]):t._e()]),t._v(" "),"countEnd"!=t.moveStatus?i("div",{staticClass:"start",class:{end:"moveEnd"==t.moveStatus}}):t._e()]):t._e()],1),t._v(" "),i("div",{staticClass:"analylist"},[i("div",{staticClass:"quality"},[t._m(0),t._v(" "),i("div",{staticClass:"quality-detail"},[i("p",{staticStyle:{width:"50%",margin:"0"}},[t._v("清 晰 度："+t._s(t.slice.clarity?(100*t.slice.clarity).toFixed(2)+"%":"-"))]),t._v(" "),i("p",{staticStyle:{width:"50%",margin:"0"}},[t._v("扫描倍数："+t._s(t.slice.objective_rate||"-"))])])]),t._v(" "),i("h2",[i("span",{class:t.auto?"auto":"",on:{click:function(e){t.auto=!0}}},[t._v("AI处理")]),t._v(" "),i("span",{class:t.auto?"":"noauto",on:{click:function(e){t.auto=!1}}},[t._v(t._s(t.$t("analyze.roi")))])]),t._v(" "),t.auto?i("v-analyroi",{staticClass:"table",attrs:{slice:t.slice,ROIS:t.aiFatherRois,ave:t.ave,currentRois:t.curRois},on:{curROI:function(e,i){return t.curROIChange(e,i)+t.listChangeCurrent()},delRoi:function(e){return t.delCurRoi(e)},roiChanged:t.roiChanged,movetoCenter:t.movetoCenter,acceptAI:function(e){return t.reCheck(e?e+"%":"")}}}):t._e(),t._v(" "),t.auto?t._e():i("v-roi",{staticClass:"manualroi",attrs:{roilist:t.rightRoilist,currentRois:t.curRois},on:{curROI:function(e,i){return t.curROIChange(e,i)+t.listChangeCurrent()},delRoi:function(e){return t.delCurRoi(e)},roiChanged:t.roiChanged}}),t._v(" "),!t.showbutton&&t.auto?i("div",{staticClass:"loding"},[i("div",{staticClass:"video"},[i("img",{attrs:{src:"/static/video/loading.gif"}}),t._v(" "),0==t.lineup?i("div",{staticClass:"lineup"},[t._v("正在处理...")]):t._e(),t._v(" "),t.lineup>0?i("div",{staticClass:"lineup"},[t._v(t._s(t.$t("slice.lineup"))+" "),i("span",{staticStyle:{color:"#4C9FFA","font-size":"18px","font-weight":"bolder"}},[t._v(t._s(t.lineup))]),t._v(" "+t._s(t.$t("slice.position")))]):t._e()]),t._v(" "),i("div",{staticClass:"cancel",on:{click:t.canceltesk}},[t._v(t._s(t.$t("slice.cancelTasks")))])]):t._e()],1)])},staticRenderFns:[function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"title"},[e("span",[this._v("AI质控")])])}]};var Pe=i("VU/8")(je,Ee,!1,function(t){i("BcJf")},"data-v-606d3a06",null).exports,De={data:()=>({}),computed:{totalTps(){return this.ROIS.filter(t=>t.image).map(t=>this.getCount(t,"positive")).reduce((t,e)=>t+e,0)/(this.ROIS.filter(t=>t.image).map(t=>this.getCount(t,"positive")).reduce((t,e)=>t+e,0)+this.ROIS.filter(t=>t.image).map(t=>this.getCount(t,"negative")).reduce((t,e)=>t+e,0)||1)*100}},methods:{getCount(t,e){return this.sRois[t.id]&&this.sRois[t.id][e]?this.sRois[t.id][e]:0},checkall(){let t=this.ROIS.every(t=>!!t.image);this.ROIS.forEach(e=>this.$set(e,"image",!t)),this.$emit("closecontextmenu")},change(t,e,i){this.$emit("closecontextmenu"),this.$set(t,"image",i)},del(t){this.$emit("closecontextmenu"),this.$confirm(this.$t("analaysisPanel.delete"),{confirmButtonText:this.$t("confirm.confirm"),cancelButtonText:this.$t("confirm.quit"),type:"warning"}).then(()=>{this.$emit("delRoi",t)},()=>{})}},props:["showbutton","ROIS","currentRois","sRois","slice"]},Le={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"tctrois"},[t.ROIS?t._e():i("div",{staticClass:"ifshowtables"},[t._v(t._s(t.$t("slice.noanalysis")))]),t._v(" "),t.ROIS?i("div",{staticClass:"pal1table"},[i("div",{staticClass:"top"},[i("div",{staticClass:"left"},[i("div",[i("span",{staticClass:"uncheck",class:{checked:0==t.ROIS.length?"":t.ROIS.every(function(t){return!!t.image})},on:{click:t.checkall}}),t._v("\n                    ROI\n                ")])]),t._v(" "),i("div",{staticClass:"long"},[t._v("阳性肿瘤")]),t._v(" "),i("div",{staticClass:"total"},[t._v(t._s(t.$t("slice.total")))]),t._v(" "),i("div",{staticClass:"tps"},[t._v("TPS")]),t._v(" "),i("div",{staticClass:"option"},[t._v(t._s(t.$t("slice.deleted")))])]),t._v(" "),i("div",{staticClass:"rois"},t._l(t.ROIS,function(e,s){return i("div",{key:s,staticClass:"row",class:{curRoi:t.currentRois[e.id]},on:{click:function(i){t.$emit("closecontextmenu"),t.$emit("curROI",e,i.shiftKey)}}},[i("div",{staticClass:"left"},[i("div",[i("span",{staticClass:"uncheck",class:{checked:e.image},on:{click:function(i){i.stopPropagation(),t.change(e,"image",1-(e.image||0))}}}),t._v("\n                        "+t._s(s+1)+"\n                    ")])]),t._v(" "),i("div",{staticClass:"long",attrs:{title:t.getCount(e,"positive")||"0"}},[t._v(t._s(t.getCount(e,"positive")||"0"))]),t._v(" "),i("div",{staticClass:"total",attrs:{title:t.getCount(e,"positive")+t.getCount(e,"negative")||"0"}},[t._v("\n                    "+t._s(t.getCount(e,"positive")+t.getCount(e,"negative")||"0")+"\n                ")]),t._v(" "),i("div",{staticClass:"tps"},[t._v(t._s((t.getCount(e,"positive")/(t.getCount(e,"positive")+t.getCount(e,"negative")||1)*100).toFixed(1)+"%")+"\n                ")]),t._v(" "),i("div",{staticClass:"option"},[i("em",{attrs:{title:t.$t("upload.delete")},on:{click:function(i){return i.stopPropagation(),t.del(e)}}})])])}),0)]):t._e(),t._v(" "),t.ROIS?i("div",{staticClass:"pdl1btm"},[i("div",{staticClass:"result",staticStyle:{color:"red"}},[i("div",[t._v("\n                阳性肿瘤细胞\n            ")]),t._v(" "),i("div",[t._v("\n                "+t._s(t.ROIS.filter(function(t){return t.image}).map(function(e){return t.getCount(e,"positive")}).reduce(function(t,e){return t+e},0))+"\n            ")])]),t._v(" "),i("div",{staticClass:"result",staticStyle:{color:"green"}},[i("div",[t._v("\n                阴性肿瘤细胞\n            ")]),t._v(" "),i("div",[t._v("\n                "+t._s(t.ROIS.filter(function(t){return t.image}).map(function(e){return t.getCount(e,"negative")}).reduce(function(t,e){return t+e},0))+"\n            ")])]),t._v(" "),i("div",{staticClass:"result",staticStyle:{color:"yellow"}},[i("div",[t._v("\n                阳性非肿瘤细胞\n            ")]),t._v(" "),i("div",[t._v("\n                "+t._s(t.ROIS.filter(function(t){return t.image}).map(function(e){return t.getCount(e,"positivenon")}).reduce(function(t,e){return t+e},0))+"\n            ")])]),t._v(" "),i("div",{staticClass:"result",staticStyle:{color:"#9117d0"}},[i("div",[t._v("\n                阴性非肿瘤细胞\n            ")]),t._v(" "),i("div",[t._v("\n                "+t._s(t.ROIS.filter(function(t){return t.image}).map(function(e){return t.getCount(e,"negativenon")}).reduce(function(t,e){return t+e},0))+"\n            ")])]),t._v(" "),i("div",{staticClass:"result"},[i("div",[t._v("\n                细胞总数\n            ")]),t._v(" "),i("div",[t._v("\n                "+t._s(t.ROIS.filter(function(t){return t.image}).map(function(e){return t.getCount(e,"total")}).reduce(function(t,e){return t+e},0)||0)+"\n            ")])]),t._v(" "),i("div",{staticClass:"result"},[i("div",[t._v("\n                TPS\n            ")]),t._v(" "),i("div",[t._v("\n                "+t._s(t.totalTps.toFixed(1)+"%")+"\n            ")])])]):t._e()])},staticRenderFns:[]};var He=i("VU/8")(De,Le,!1,function(t){i("z57H"),i("Fd3u")},null,null).exports;let ze;var Ne={data(){return{loopHandler:0,result:{},auto:!0,centerRegion:null,curRois:{},showbutton:!0,ki67Anno:null,labeltree:[{id:"positive",label:"阳性肿瘤"},{id:"negative",label:"阴性肿瘤"},{id:"positivenon",label:"阳性非肿瘤"},{id:"negativenon",label:"阴性非肿瘤"}],position:{offx:this.slice.position?this.slice.position.offx:.5,offy:this.slice.position?this.slice.position.offy:.5*this.slice.height/this.slice.width,zoom:this.slice.position?this.slice.position.zoom:null},lineup:null,addAnnRoi:!1,menuPosition:{},showMppGuide:!1,drawMpp:null,viewport:null,parentId:null}},computed:{getCommonAnnotation(){var t=Object.values(this.curRois);return t[0]&&t.every(t=>t.jgResult)&&t.every(e=>e.jgResult==t[0].jgResult)?t[0].jgResult.split(",")[0]:""}},methods:{isDrawMpp(){/\.(png|jpg|jpeg|tiff|tif|bmp)$/.test(this.slice.filename)?this.showMppGuide=!0:!this.slice.pdl1_sp236.result.length&&!this.slice.pdl1_sp236.result.filter(t=>t.image).length||this.slice.pdl1_sp236.pdl1_allresult.length?this.$confirm("未勾选任意roi，是否进行全片分析",{confirmButtonText:this.$t("confirm.confirm"),cancelButtonText:this.$t("confirm.quit"),type:"warning"}).then(()=>{this.startAnalyze("pdl1_sp263all"),this.slice.pdl1_sp236.pdl1_allresult.length&&this.delCurRoi(this.slice.pdl1_sp236.result[0])}).catch(t=>{}):this.startAnalyze("pdl1_sp263roi")},canceltesk(t=this.record.id,e=this.slice.id,i=this.slice.filename){Object(s.b)("ai/revokeTask",{caseid:t,fileid:e,filename:i,type:this.slice.pdl1_sp236.type,other:""}).then(t=>{0==t.code&&(clearTimeout(this.loopHandler),this.loopHandler=0,this.showbutton=!0,this.slice.started=!1,this.record.started=!1,this.updateRecord())}).catch(t=>console.log(t))},updateRecord(){this.$emit("save","auto")},startAnalyze(t,e=this.record.id,i=this.slice.id,n=this.slice.filename){this.$set(this.slice.pdl1_sp236,"diagnosis",null),this.$set(this.slice.pdl1_sp236,"type",t),this.slice.started=!0,this.record.started=!0,this.showbutton=!1,this.auto=!0,Object.values(this.curRois).map(t=>this.slice.roilist.every(e=>t.id!=e.id)&&this.slice.pdl1_sp236.result.every(e=>t.id!=e.id)?delete this.curRois[t.id]:""),Object(s.b)("ai/start",{caseid:e,fileid:i,filename:n,type:t,other:JSON.stringify(this.slice.pdl1_sp236.result.filter(t=>t.image).map(t=>({id:t.id,x:t.path.x,y:t.path.y})))}).then(t=>this.getAlgorithmResult()).catch(t=>console.log(t)),this.updateRecord()},getAlgorithmResult(t=this.record.id,e=this.slice.id,i=this.slice.filename){Object(s.b)("ai/getresult",{caseid:t,fileid:e,filename:i,type:this.slice.pdl1_sp236.type,other:JSON.stringify(this.slice.pdl1_sp236.result.filter(t=>t.image).map(t=>({id:t.id,x:t.path.x,y:t.path.y})))}).then(t=>{if(this.lineup=t.data.rank,t.data.done){if(this.showbutton=!0,this.loopHandler=0,this.$set(this.slice,"type","pdl1_sp236"),-1!=t.data.rank)this.flag="error",this.$set(this.slice.pdl1_sp236,"diagnosis","error");else{let n;if("pdl1_sp263roi"===this.slice.pdl1_sp236.type){Object.keys(t.data.result).filter(t=>!this.slice.pdl1_sp236.result.find(e=>e.id==t)).map(e=>delete t.data.result[e]);let e=Object.assign({},this.slice.pdl1_sp236.airesult);for(let i in t.data.result)e[i]=t.data.result[i];[].concat.apply([],Object.values(e)).forEach(t=>{t.display=!1,t.cell.forEach(t=>{t.id||(t.id=(""+Math.random()).substr(2,8))})}),this.$set(this.slice.pdl1_sp236,"airesult",e);let i=0,s=0;for(let e in t.data.result)i+=t.data.result[e].positive,s+=t.data.result[e].positive+t.data.result[e].negative;n=(i/(s||1)*100).toFixed(1)}if("pdl1_sp263all"===this.slice.pdl1_sp236.type){var e={};e.id=(Math.random()+"").substr(2,6),e=Object.assign({},e,{image:1},{method:"maskArea"},{path:{x:[],y:[]}});var i=[...this.slice.pdl1_sp236.result,e];this.$set(this.slice.pdl1_sp236,"result",i);let a=Object.assign({},this.slice.pdl1_sp236.airesult);a[i[0].id]=t.data.result,a[i[0].id].isDisplayCell=!0,a[i[0].id].display=!0,this.$set(this.slice.pdl1_sp236,"airesult",JSON.parse(JSON.stringify(a).replace(/contours/g,"cell")));var s=[];t.data.result.contours.forEach((t,e)=>{var i={};i.id=(Math.random()+"").substr(2,6),i=Object.assign({},i,{image:1},{strokeWidth:0},{path:{x:[],y:[]}}),t.map(t=>{i.path.x.push(t.x),i.path.y.push(t.y)}),s.push(i)}),this.$set(this.slice.pdl1_sp236,"pdl1_allresult",s),n=(t.data.result.positive/(t.data.result.positive+t.data.result.negative||1)*100).toFixed(1)}this.$set(this.slice.pdl1_sp236,"diagnosis",1),0===this.record.slices.indexOf(this.slice)&&(this.record.analy="TPS: "+n+"%")}this.updateRecord()}else this.showbutton=!1,this.loopHandler=setTimeout(()=>this.getAlgorithmResult(),5e3)})},curROIChange(t,e){var i;t?t.length?i=t:e&&this.curRois[t.id]?(delete this.curRois[t.id],i=[]):i=[t]:i=[];let s=this.slice.pdl1_sp236.airesult,n=this.slice.pdl1_sp236.result;if(t&&n.some(e=>e.id===t.id)){for(let t in s)s[t].display=!1,s[t].cell.map(t=>{this.curRois[t.id]&&delete this.curRois[t.id]});s[t.id]&&(s[t.id].isDisplayCell?s[t.id].display=!0:this.$message({message:"由于细胞数过多，为避免卡顿，已对结果进行优化隐藏，可框选小roi进行结果预览标注",type:"warning"}))}this.curRois=Object.assign({},e&&this.curRois,...i.map(t=>"grey"==t.color||"spot"==t.method?{[t.id]:Object.assign({},t,{editable:!1})}:{[t.id]:t}))},listChangeCurrent(){var t=[].concat.apply([],Object.values(this.curRois).map(t=>t.path.x)),e=[].concat.apply([],Object.values(this.curRois).map(t=>t.path.y));t.length?this.centerRegion=[Math.min.apply(null,t),Math.min.apply(null,e),Math.max.apply(null,t),Math.max.apply(null,e)]:this.centerRegion=null},clickDraw(t,e){var i,s=t.x,n=t.y;if(i=void 0!=ze?{id:(Math.random()+"").substr(2,9),path:{x:[s],y:[n]},method:"spot",remark:ze.split(",")[1],jgResult:ze.split(",")[0]}:{id:(Math.random()+"").substr(2,9),path:{x:[s],y:[n]},method:"spot"}){let t={positive:2,negative:0,positivenon:3,negativenon:1},s={2:"positive",0:"negative",3:"positivenon",1:"negativenon"},n=(i.path.x[0],i.path.y[0],{id:i.id,x:i.path.x[0].toFixed(2),y:i.path.y[0].toFixed(2),type:ze?t[ze.split(",")[0]]:2}),a=this.slice.pdl1_sp236.airesult,o=this.slice.pdl1_sp236.result.find(t=>t.id===this.parentId);if(o){if(!a[o.id])return void this.$message({message:"欲进行标注操作，请选中已分析过的roi框",type:"warning"});if(!a[o.id].display)return void(a[o.id].isDisplayCell?this.$message({message:"欲进行标注操作，请选中已分析过的roi框",type:"warning"}):this.$message({message:"由于细胞数过多，为避免卡顿，已对结果进行优化隐藏，可框选小roi进行结果预览标注",type:"warning"}));a[o.id].cell.push(n),a[o.id].total+=1,a[o.id][s[n.type]]+=1;i.color=["green","purple","red","yellow"][n.type],e?Object.assign(this.curRois,{[i.id]:i}):this.curRois={[i.id]:i}}}},draw(t){if(this.auto){t.id=(Math.random()+"").substr(2,6),t=Object.assign({},t,{image:1});var e=[...this.slice.pdl1_sp236.result,t];this.$set(this.slice.pdl1_sp236,"result",e)}else t.id=(Math.random()+"").substr(2,9),this.slice.roilist=[...this.slice.roilist,t];this.slice.pdl1_sp236.pdl1_allresult.length&&(this.$message({message:"进行roi框选分析之前请先删除全场图分析结果",type:"warning"}),setTimeout(()=>{this.delCurRoi(t)},200))},async delCurRoi(t){if(Object.values(this.curRois)[0]&&"maskArea"===Object.values(this.curRois)[0].method)await this.$confirm(this.$t("analaysisPanel.delete"),{confirmButtonText:this.$t("confirm.confirm"),cancelButtonText:this.$t("confirm.quit"),type:"warning"}),this.$set(this.slice.pdl1_sp236,"result",[]),this.$set(this.slice.pdl1_sp236,"pdl1_allresult",[]),this.$set(this.slice.pdl1_sp236,"airesult",{}),this.curRois={};else{let i={},s=this.slice.pdl1_sp236.airesult;for(var e of(t?(i={[t.id]:t},this.curRois[t.id]&&(delete this.curRois[t.id],this.curRois=Object.assign({},this.curRois))):(this.ki67Anno=null,i=this.curRois,await this.$confirm(this.$t("analaysisPanel.delete"),{confirmButtonText:this.$t("confirm.confirm"),cancelButtonText:this.$t("confirm.quit"),type:"warning"}),this.curRois={}),Object.keys(i)))if(6==e.length)this.slice.pdl1_sp236.result=this.slice.pdl1_sp236.result.filter(t=>t.id!=e),delete s[e],t&&"maskArea"===t.method&&this.$set(this.slice.pdl1_sp236,"pdl1_allresult",[]);else{let t={red:"positive",green:"negative",yellow:"positivenon",purple:"negativenon"};this.slice.pdl1_sp236.result.map(e=>{if(void 0!=s[e.id]){if(s[e.id].cell.some(t=>i[t.id]))for(let n in i)s[e.id].total-=1,s[e.id][t[i[n].color]]-=1;s[e.id].cell=s[e.id].cell.filter(t=>!i[t.id])}})}this.slice.roilist=this.slice.roilist.filter(t=>!i[t.id])}},roiChanged(){for(var t in this.curRois)this.curRois[t]=Object.assign({},this.curRois[t]);var e=Object.assign({},this.curRois),i=Object.assign({},i,...Object.values(e).filter(t=>"grey"!=t.color&&"spot"!=t.method).map(t=>({[t.id]:t})));this.$set(this.slice,"roilist",this.slice.roilist.map(t=>{var e=i[t.id];return e?(delete i[t.id],e):t}).concat(Object.values(i))),this.slice.pdl1_sp236.result.map(t=>{i[t.id]&&(this.slice.pdl1_sp236.airesult[t.id]=(this.slice.pdl1_sp236.airesult[t.id]||[]).filter(t=>!i[t.id]))})},setAnnotation(t){if(this.ki67Anno=null,"下载Roi"==t[0]){let t=Object.values(this.curRois)[0].path,a={};if(t.x.length<=4)a[0]=[],a[1]=[],a[0].push(t.x[0]),a[0].push(t.y[0]),a[1].push(t.x[2]),a[1].push(t.y[2]);else{a[0]=[],a[1]=[];var e=Math.max.apply(Math,t.x),i=Math.min.apply(Math,t.x),s=Math.max.apply(Math,t.y),n=Math.min.apply(Math,t.y);a[0].push(i),a[0].push(n),a[1].push(e),a[1].push(s)}return void window.open("/aipath/api/files/screenshot?caseid="+this.record.id+"&fileid="+this.slice.id+"&filename="+encodeURIComponent(this.slice.filename)+"&roi=[["+a[0][0]+","+a[0][1]+"],["+a[1][0]+","+a[1][1]+"]] &roiid="+Object.keys(this.curRois)[0])}var a;for(var o in a="string"!=typeof t?t[0]+","+t[1]:t,this.curRois){let t=this.curRois[o];this.curRois[o]=Object.assign({},t,{jgResult:a,remark:a.split(",")[a.split(",").length-1]})}ze=a;var r=Object.assign({},this.curRois);let l={positive:2,negative:0,positivenon:3,negativenon:1},c={2:"positive",0:"negative",3:"positivenon",1:"negativenon"};var u=Object.assign({},u,...Object.values(r).filter(t=>"grey"!=t.color).map(t=>({[t.id]:t})));let h=this.slice.pdl1_sp236.airesult;this.slice.pdl1_sp236.result.map(t=>{h[t.id]&&(h[t.id].cell||[]).forEach(e=>{if(u[e.id]){let i=c[e.type],s=c[l[ze.split(",")[0]]];h[t.id][i]-=1,h[t.id][s]||(h[t.id][s]=0),h[t.id][s]+=1,e.type=l[ze.split(",")[0]]}})}),this.curRois={}},showMenu(t,e){if((!t.type||t.button)&&(t.preventDefault(),"maskArea"!==e.method&&!(0==Object.keys(this.curRois).length||Object.keys(this.curRois).every(t=>t!=e.id)||this.slice.pdl1_sp236.result.some(t=>t.id==e.id)||this.slice.roilist.some(t=>t.id==e.id)))){var i=t.currentTarget,s=t.offsetX,n=t.offsetY,a=i.offsetWidth,o=i.offsetHeight;this.ki67Anno={},this.ki67Anno.hd=s>a/2?"right":"left",this.ki67Anno.vd=n>o/2?"bottom":"top",this.menuPosition={x:s,y:n}}},keydown(t){if("Delete"!=t.key&&"Backspace"!=t.key||!Object.keys(this.curRois).length||this.delCurRoi(),"M"===t.key||"m"===t.key){var e=prompt("输入坐标字符串",'{"x":[54272, 55296, 55296, 54272],"y":[30720, 30720, 31744, 31744]}');e&&this.draw({color:"grey",method:"rectangle",path:JSON.parse(e)})}},checkjgResult:t=>(""+t).split(",")[0],noEmoji(t){t.target.value=t.target.value.replace(/[^\u0020-\u007E\u00A0-\u00BE\u2E80-\uA4CF\uF900-\uFAFF\uFE30-\uFE4F\uFF00-\uFFEF\u0080-\u009F\u2000-\u201f\u2026\u2022\u20ac\r\n]/g,"")}},beforeMount(){this.slice.pdl1_sp236||(this.$set(this.slice,"pdl1_sp236",{}),this.$set(this.slice.pdl1_sp236,"result",[]),this.$set(this.slice.pdl1_sp236,"pdl1_allresult",[]),this.$set(this.slice.pdl1_sp236,"airesult",{})),this.slice.pdl1_sp236&&!this.slice.pdl1_sp236.airesult&&this.$set(this.slice.pdl1_sp236,"airesult",{});let t=[];this.slice.roilist.forEach(e=>{const i=t.findIndex(t=>e.id===t.id);-1!==i?t[i].value=t[i].value+e.value:t.push(e)}),this.slice.roilist=t},mounted(){this.slice.started&&this.slice.pdl1_sp236&&null===this.slice.pdl1_sp236.diagnosis&&this.getAlgorithmResult(),window.addEventListener("online",()=>{this.showbutton||this.getAlgorithmResult()})},beforeDestroy(){clearTimeout(this.loopHandler),this.loopHandler=0},watch:{"slice.id":{handler(){clearTimeout(this.loopHandler),this.loopHandler=0}},"slice.roilist":{handler(t){t.filter(t=>!!t.jgResult).length>1500&&(this.addAnnRoi=!0,setTimeout(()=>this.addAnnRoi=!1,2500),Object.values(this.curRois).map(t=>delete this.curRois[t.id]),t.pop())}},drawMpp:{handler(t){t&&(this.$set(this.slice,"mppx",t),this.$set(this.slice,"mppy",t),this.$emit("save","auto"),this.slice.pdl1_sp236.result.length||this.slice.pdl1_sp236.result.filter(t=>t.image).length?this.startAnalyze("pdl1_sp263roi"):this.$confirm("未勾选任意roi，是否进行全片分析",{confirmButtonText:this.$t("confirm.confirm"),cancelButtonText:this.$t("confirm.quit"),type:"warning"}).then(()=>{this.startAnalyze("pdl1_sp263all")}).catch(t=>{}))}}},props:["slice","record"],components:{"v-menus":Ct,"v-dragon":v.a,"v-analyroi":He,"v-roi":m}},Be={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"cnt",attrs:{tabIndex:0},on:{keydown:t.keydown}},[i("div",{staticClass:"analyright",on:{mousewheel:function(e){t.ki67Anno=null},mousedown:function(e){t.ki67Anno=null}}},[i("v-dragon",{staticClass:"dragon",attrs:{record:t.record,slice:t.slice,roilist:this.slice.roilist.map(function(t){return Object.assign({method:"rectangle"},t,{color:"yellow"})}).concat((this.slice.pdl1_sp236?this.slice.pdl1_sp236.result:[]).map(function(t){return Object.assign({method:"rectangle"},t,{editable:!1,color:"grey"})}),(this.slice.pdl1_sp236?[].concat.apply([],[].concat.apply([],Object.values(this.slice.pdl1_sp236.airesult)).filter(function(t){return t.display}).map(function(t){return t.cell})):[]).map(function(e){return{id:e.id,path:{x:[e.x],y:[e.y]},color:{0:"green",1:"purple",2:"red",3:"yellow"}[e.type],method:"spot",editable:!1,selectable:!1,radius:3/(t.slice.mppx||.242042)}}),(this.slice.pdl1_sp236?this.slice.pdl1_sp236.pdl1_allresult:[]).map(function(t){return Object.assign(t,{method:"maskArea"},{color:"rgba(255,182,193,0.6)"},{fillColor:"rgba(255,182,193,0.6)"})})),curRois:t.curRois,penColor:t.auto?"grey":"yellow",centerRegion:t.centerRegion,position:t.position,showMppGuide:t.showMppGuide,cellArea:268},on:{curROI:t.curROIChange,draw:t.draw,delRoi:function(e){return t.delCurRoi(e)},contextmenu:function(e,i){return t.showMenu(e,i)},clickDraw:t.clickDraw,roiChanged:t.roiChanged,position:function(e,i,s){t.$set(t.position,"offx",e),t.$set(t.position,"offy",i),t.$set(t.position,"zoom",s),t.$set(t.slice,"position",t.position)},closeMppGuide:function(e){t.showMppGuide=!1},changeMpp:function(e){return t.drawMpp=e},viewer:function(e){return t.viewport=e},parentId:function(e){return t.parentId=e}}},[t.ki67Anno?i("div",{staticStyle:{position:"absolute"},style:{left:t.menuPosition.x+"px",top:t.menuPosition.y+"px"}},[i("v-menus",{attrs:{pos:t.ki67Anno,menus:t.labeltree,currentItem:t.getCommonAnnotation},on:{chosen:t.setAnnotation}})],1):t._e(),t._v(" "),t.addAnnRoi?i("div",{staticClass:"addannroi"},[t._v("标注roi数量不能超出1500个")]):t._e()]),t._v(" "),t.showbutton?i("button",{on:{click:function(e){return t.isDrawMpp()}}},[t._v(t._s(t.$t("slice.start")))]):t._e()],1),t._v(" "),i("div",{staticClass:"analylist",on:{click:function(e){t.ki67Anno=null}}},[i("h2",[i("span",{class:t.auto?"auto":"",on:{click:function(e){t.auto=!0}}},[t._v(t._s(t.$t("analyze.airoi")))]),t._v(" "),i("span",{class:t.auto?"":"noauto",on:{click:function(e){t.auto=!1}}},[t._v(t._s(t.$t("analyze.roi")))])]),t._v(" "),t.auto?i("v-analyroi",{staticClass:"table ki67table",attrs:{ROIS:this.slice.pdl1_sp236?this.slice.pdl1_sp236.result:[],sRois:this.slice.pdl1_sp236?this.slice.pdl1_sp236.airesult:{},slice:t.slice,showbutton:t.showbutton,currentRois:t.curRois},on:{curROI:function(e,i){return t.curROIChange(e,i)+t.listChangeCurrent()},delRoi:function(e){return t.delCurRoi(e)},closecontextmenu:function(e){t.ki67Anno=null}}}):t._e(),t._v(" "),t.auto?t._e():i("v-roi",{staticClass:"manualroi",attrs:{roilist:t.slice.roilist,currentRois:t.curRois},on:{curROI:function(e,i){return t.curROIChange(e,i)+t.listChangeCurrent()},delRoi:function(e){return t.delCurRoi(e)}}}),t._v(" "),!t.showbutton&&t.auto?i("div",{staticClass:"loding"},[i("div",{staticClass:"video"},[i("img",{attrs:{src:"/static/video/loading.gif"}}),t._v(" "),0==t.lineup?i("div",{staticClass:"lineup"},[t._v("正在处理...")]):t._e(),t._v(" "),t.lineup>0?i("div",{staticClass:"lineup"},[t._v(t._s(t.$t("slice.lineup"))+" "),i("span",{staticStyle:{color:"#4C9FFA","font-size":"18px","font-weight":"bolder"}},[t._v(t._s(t.lineup))]),t._v(" "+t._s(t.$t("slice.position"))+"\n        ")]):t._e()]),t._v(" "),i("div",{staticClass:"cancel",on:{click:function(e){return t.canceltesk()}}},[t._v(t._s(t.$t("slice.cancelTasks")))])]):t._e(),t._v(" "),0==t.auto?i("div",{staticClass:"opinio"},[i("h1",[t._v("\n        "+t._s(t.$t("analyze.point"))+"\n      ")]),t._v(" "),i("textarea",{directives:[{name:"model",rawName:"v-model",value:t.record.opinion,expression:"record.opinion"}],attrs:{placeholder:t.$t("report.pointremind"),maxlength:"300"},domProps:{value:t.record.opinion},on:{input:[function(e){e.target.composing||t.$set(t.record,"opinion",e.target.value)},t.noEmoji]}})]):t._e()],1)])},staticRenderFns:[]};var Ge=i("VU/8")(Ne,Be,!1,function(t){i("GF12")},"data-v-10c272b4",null).exports,Ue={data:()=>({}),methods:{changeImage(t){this.$set(t,"image",1-(t.image||0)),this.$emit("roiChanged","image",[t])},checkall(){if(!this.ROIS.length)return;let t=this.ROIS.every(t=>!!t.image),e=this.ROIS.map(e=>{return{id:e.id,image:t?0:1}});this.$emit("roiChanged","image",e)},del(t){this.$confirm(this.$t("analaysisPanel.delete"),{confirmButtonText:this.$t("confirm.confirm"),cancelButtonText:this.$t("confirm.quit"),type:"warning"}).then(()=>{this.$emit("delRoi",t)},()=>{})}},props:["ROIS","currentRois","slice","ave"]},Ye={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"fishrois"},[t.ROIS.length?t._e():i("div",{staticClass:"ifshowtables"},[t._v(t._s(t.$t("slice.noanalysis")))]),t._v(" "),t.ROIS?i("div",{staticClass:"fishtable"},[i("div",{staticClass:"top"},[i("div",{staticClass:"left"},[i("div",[i("span",{staticClass:"uncheck",class:{checked:t.ROIS.every(function(t){return!!t.image})},on:{click:t.checkall}}),t._v("\n                    ROI\n                ")])]),t._v(" "),i("div",[t._v("细胞核")]),t._v(" "),i("div",[t._v("红")]),t._v(" "),i("div",[t._v("绿")]),t._v(" "),i("div",[t._v(t._s(t.$t("slice.deleted")))])]),t._v(" "),i("div",{staticClass:"rois"},t._l(t.ROIS,function(e,s){return i("div",{key:s,staticClass:"row",class:{curRoi:t.currentRois[e.id]}},[i("div",{staticClass:"left"},[i("div",[i("span",{staticClass:"uncheck",class:{checked:e.image},on:{click:function(i){return i.stopPropagation(),t.changeImage(e)}}}),t._v("\n                        "+t._s(s+1)+"\n                    ")])]),t._v(" "),i("div",[t._v(t._s(e.aiResult.nuclues_num))]),t._v(" "),i("div",[t._v(t._s(e.aiResult.red_signal_num))]),t._v(" "),i("div",[t._v(t._s(e.aiResult.green_signal_num))]),t._v(" "),i("div",[i("em",{attrs:{title:t.$t("upload.delete")},on:{click:function(i){return i.stopPropagation(),t.del(e)}}})])])}),0)]):t._e()])},staticRenderFns:[]};var Ve=i("VU/8")(Ue,Ye,!1,function(t){i("6jY2"),i("LtZJ")},null,null).exports;let Je;var Xe={data:()=>({labeltree:[{id:"red",label:"红信号点"},{id:"#00FF15",label:"绿信号点"}]}),methods:{async clickDraw(t,e){if(this.auto){if(!this.showbutton)return void this.$message({message:"计算中不能标注",type:"warning"});if(!this.aiFatherRois.length)return void this.$message({message:"该模块不支持区域分析，请直接计算后再做修改",type:"warning"});let n=this.aiFatherRois[0].id;var i={path:{x:[t.x],y:[t.y]},method:"spot",radius:8.333333333333334,mark_type:2,ai_type:"fishTissue",fillColor:"",strokeColor:Je||"red",area_id:n};if(i.id=await Object(s.h)(this.record.id,this.slice.id,i),!i.id)return;e?Object.assign(this.curRois,{[i.id]:i}):this.curRois={[i.id]:i},this.leftRoilist=[...this.leftRoilist,i],this.aiFatherRois=await Object(s.p)(this.record.id,this.slice.id,"fishTissue")}},async setAnnotation(t){for(var e in this.ki67Anno=null,this.curRois){let i=this.curRois[e];"spot"==i.method&&(this.curRois[e]=Object.assign({},i,{strokeColor:t}))}Je=t;var i=Object.assign({},this.curRois),n=Object.assign({},n,...Object.values(i).filter(t=>"spot"==t.method).map(t=>({[t.id]:t})));this.leftRoilist=this.leftRoilist.map(t=>(n[t.id]&&(t=n[t.id]),t)),this.curRois={};let a=this.$refs.osd.scope?Object.assign({},this.$refs.osd.scope,{color:Object.values(n)[0].strokeColor}):null;this.loading=!0,await Object(s.e)(this.record.id,this.slice.id,"fishTissue",Object.values(n).map(t=>({id:t.id,strokeColor:t.strokeColor,area_id:t.area_id})),a),this.loading=!1,this.aiFatherRois=await Object(s.p)(this.record.id,this.slice.id,"fishTissue"),this.leftRoilist=await Object(s.n)(this.record.id,this.slice.id,this.curLevel,"fishTissue")},isDrawMpp(){this.startAnalyze()},async draw(t,e){if(t.strokeColor="yellow",t.mark_type=1,this.auto){if(!this.showbutton)return void this.$message({message:"计算中不能标注",type:"warning"});if(!this.aiFatherRois.length)return void this.$message({message:"该模块不支持区域分析，请直接计算后再做修改",type:"warning"});let e=this.aiFatherRois[0].id;t.strokeColor="#fff",t.mark_type=2,t.ai_type="fishTissue",t.area_id=e}t.id=await Object(s.h)(this.record.id,this.slice.id,t),t.id&&(this.curROIChange(t,e),this.leftRoilist=[...this.leftRoilist,t],this.rightRoilist=await Object(s.p)(this.record.id,this.slice.id),this.aiFatherRois=await Object(s.p)(this.record.id,this.slice.id,"fishTissue"),this.leftRoilist=await Object(s.n)(this.record.id,this.slice.id,this.curLevel,"fishTissue"),this.IsOutFrame())},async delCurRoi(t){t?(this.loading=!0,await Object(s.i)(this.record.id,this.slice.id,"fishTissue",[t.id],null),this.loading=!1,this.curRois[t.id]&&(delete this.curRois[t.id],this.curRois=Object.assign({},this.curRois)),this.rightRoilist=await Object(s.p)(this.record.id,this.slice.id),this.aiFatherRois=await Object(s.p)(this.record.id,this.slice.id,"fishTissue"),this.leftRoilist=await Object(s.n)(this.record.id,this.slice.id,this.curLevel,"fishTissue")):await this.$confirm(this.$t("analaysisPanel.delete"),{confirmButtonText:this.$t("confirm.confirm"),cancelButtonText:this.$t("confirm.quit"),type:"warning"}).catch(()=>{})&&(this.loading=!0,await Object(s.i)(this.record.id,this.slice.id,"fishTissue",Object.keys(this.curRois),this.$refs.osd.scope),this.loading=!1,[...new Set(Object.values(this.curRois).map(t=>t.mark_type))].map(async t=>{1===t?this.rightRoilist=await Object(s.p)(this.record.id,this.slice.id):this.aiFatherRois=await Object(s.p)(this.record.id,this.slice.id,"fishTissue")}),this.curRois={},this.leftRoilist=await Object(s.n)(this.record.id,this.slice.id,this.curLevel,"fishTissue"))}},props:["slice","record","config"],components:{"v-dragon":v.a,"v-roi":m,"v-analyroi":Ve,"v-menus":V},mixins:[G.a]},We={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"cnt",staticStyle:{width:"100%"},attrs:{tabIndex:0},on:{keydown:t.keydown}},[i("div",{staticClass:"analyright",on:{mousewheel:function(e){t.ki67Anno=null},mousedown:function(e){t.ki67Anno=null}}},[i("v-dragon",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],ref:"osd",staticClass:"dragon",attrs:{record:t.record,slice:t.slice,roilist:[].concat(t.leftRoilist),curRois:t.curRois,penColor:t.auto?"#fff":"yellow",centerRegion:t.centerRegion,position:t.position,showMppGuide:t.showMppGuide,cellArea:1962,"element-loading-text":"处理中，请耐心等待","element-loading-spinner":"el-icon-loading","element-loading-background":"rgba(0, 0, 0, 0.5)"},on:{curROI:t.curROIChange,roiChanged:t.roiChanged,draw:t.draw,delRoi:function(e){return t.delCurRoi(e)},position:function(e,i,s){t.$set(t.position,"offx",e),t.$set(t.position,"offy",i),t.$set(t.position,"zoom",s),t.$set(t.slice,"position",t.position)},closeMppGuide:function(e){t.showMppGuide=!1},changeMpp:function(e){return t.drawMpp=e},getRoi:t.getRoi,clickDraw:t.clickDraw,contextmenu:function(e,i){return t.showMenu(e,i)}}},[t.ki67Anno?i("div",{staticStyle:{position:"absolute"},style:{left:t.menuPosition.x+"px",top:t.menuPosition.y+"px"}},[i("v-menus",{attrs:{pos:t.ki67Anno,menus:t.labeltree,currentItem:t.currentItem,newover:t.newover},on:{chosen:function(e){return t.setAnnotation(e)}}})],1):t._e()]),t._v(" "),t.showbutton?i("button",{on:{click:function(e){return t.isDrawMpp()}}},[t._v(t._s(t.$t("slice.start")))]):t._e()],1),t._v(" "),i("div",{staticClass:"analylist"},[i("div",{staticClass:"quality"},[t._m(0),t._v(" "),i("div",{staticClass:"quality-detail"},[i("p",{staticStyle:{width:"50%",margin:"0"}},[t._v("清 晰 度："+t._s(t.slice.clarity?(100*t.slice.clarity).toFixed(2)+"%":"-"))]),t._v(" "),i("p",{staticStyle:{width:"50%",margin:"0"}},[t._v("扫描倍数："+t._s(t.slice.objective_rate||"-"))])])]),t._v(" "),i("h2",[i("span",{class:t.auto?"auto":"",on:{click:function(e){t.auto=!0}}},[t._v("AI处理")]),t._v(" "),i("span",{class:t.auto?"":"noauto",on:{click:function(e){t.auto=!1}}},[t._v("手动处理")])]),t._v(" "),t.auto?i("v-analyroi",{staticClass:"table",attrs:{slice:t.slice,ROIS:t.aiFatherRois,currentRois:t.curRois},on:{curROI:function(e,i){return t.curROIChange(e,i)+t.listChangeCurrent()},delRoi:function(e){return t.delCurRoi(e)},roiChanged:t.roiChanged}}):t._e(),t._v(" "),t.auto?t._e():i("v-roi",{staticClass:"manualroi",attrs:{roilist:t.rightRoilist,currentRois:t.curRois},on:{curROI:function(e,i){return t.curROIChange(e,i)+t.listChangeCurrent()},delRoi:function(e){return t.delCurRoi(e)},roiChanged:t.roiChanged}}),t._v(" "),!t.showbutton&&t.auto?i("div",{staticClass:"loding"},[i("div",{staticClass:"video"},[i("img",{attrs:{src:"/static/video/loading.gif"}}),t._v(" "),0==t.lineup?i("div",{staticClass:"lineup"},[t._v("正在处理...")]):t._e(),t._v(" "),t.lineup>0?i("div",{staticClass:"lineup"},[t._v(t._s(t.$t("slice.lineup"))+" "),i("span",{staticStyle:{color:"#4C9FFA","font-size":"18px","font-weight":"bolder"}},[t._v(t._s(t.lineup))]),t._v(" "+t._s(t.$t("slice.position")))]):t._e()]),t._v(" "),i("div",{staticClass:"cancel",on:{click:t.canceltesk}},[t._v(t._s(t.$t("slice.cancelTasks")))])]):t._e()],1)])},staticRenderFns:[function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"title"},[e("span",[this._v("AI质控")])])}]};var qe=i("VU/8")(Xe,We,!1,function(t){i("5dFS"),i("LkHl")},"data-v-45a69d50",null).exports,Ke={data:()=>({}),methods:{getlong(t){return this.sRois[t.id]&&this.sRois[t.id].length?Math.max(...this.sRois[t.id].map(t=>t.long)).toFixed(1):0},getshort(t){return this.sRois[t.id]&&this.sRois[t.id].length?Math.min(...this.sRois[t.id].map(t=>t.short)).toFixed(1):0},getperimeter(t){return this.sRois[t.id]&&this.sRois[t.id].length?(this.sRois[t.id].map(t=>t.perimeter).reduce((t,e)=>t+e,0)/this.sRois[t.id].length).toFixed(1):0},getarea(t){return this.sRois[t.id]&&this.sRois[t.id].length?this.sRois[t.id].map(t=>t.area).reduce((t,e)=>t+e,0).toFixed(1):0},getsamlarea(t){return this.sRois[t.id]&&this.sRois[t.id].length?(this.getarea(t)/this.sRois[t.id].length).toFixed(1):0},RoiArea(){return Object.values(this.sRois).length?[...[].concat.apply([],this.ROIS.filter(t=>!!t.image).map(t=>this.sRois[t.id]))].filter(t=>!!t).map(t=>t.area).reduce((t,e)=>t+e,0).toFixed(1):0},Roiarea(){if(Object.values(this.sRois).length){var t=[...[].concat.apply([],this.ROIS.filter(t=>!!t.image).map(t=>this.sRois[t.id]))].filter(t=>!!t);return(t.map(t=>t.area).reduce((t,e)=>t+e,0)/(t.length||1)).toFixed(1)}return 0},RoiPerimeter(){if(Object.values(this.sRois).length){var t=[...[].concat.apply([],this.ROIS.filter(t=>!!t.image).map(t=>this.sRois[t.id]))].filter(t=>!!t);return(t.map(t=>t.perimeter).reduce((t,e)=>t+e,0)/(t.length||1)).toFixed(1)}return 0},Roilong(){if(Object.values(this.sRois).length){var t=[...[].concat.apply([],this.ROIS.filter(t=>!!t.image).map(t=>this.sRois[t.id]))].filter(t=>!!t);return t.length?Math.max(...t.map(t=>t.long),0).toFixed(1):0}return 0},Roishort(){if(Object.values(this.sRois).length){var t=[...[].concat.apply([],this.ROIS.filter(t=>!!t.image).map(t=>this.sRois[t.id]))].filter(t=>!!t);return t.length?Math.min(...t.map(t=>t.short)).toFixed(1):0}return 0},getCount(t){return this.sRois[t.id]?this.sRois[t.id].length:0},checkall(){let t=this.ROIS.every(t=>!!t.image);this.ROIS.forEach(e=>this.$set(e,"image",!t)),this.$emit("closecontextmenu")},change(t,e,i){this.$set(t,"image",i),this.$emit("closecontextmenu")},del(t){this.$emit("closecontextmenu"),this.$confirm(this.$t("analaysisPanel.delete"),{confirmButtonText:this.$t("confirm.confirm"),cancelButtonText:this.$t("confirm.quit"),type:"warning"}).then(()=>{this.$emit("delRoi",t)},()=>{})}},props:["ROIS","currentRois","sRois","slice"]},Ze={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"muscletctrois"},[t.ROIS?t._e():i("div",{staticClass:"ifshowtables"},[t._v(t._s(t.$t("slice.noanalysis")))]),t._v(" "),t.ROIS?i("div",{staticClass:"table"},[i("div",{staticClass:"top"},[i("div",{staticClass:"left"},[i("div",[i("span",{staticClass:"uncheck",class:{checked:t.ROIS.every(function(t){return!!t.image})},on:{click:t.checkall}}),t._v("\n                    ROI\n                ")])]),t._v(" "),i("div",{staticStyle:{width:"68%"}},[t._v("详情")]),t._v(" "),i("div",[t._v(t._s(t.$t("slice.deleted")))])]),t._v(" "),i("div",{staticClass:"rois"},t._l(t.ROIS,function(e,s){return i("div",{key:s,staticClass:"row",class:{curRoi:t.currentRois[e.id]},on:{click:function(i){t.$emit("curROI",e,i.shiftKey),t.$emit("closecontextmenu")}}},[i("div",{staticClass:"left"},[i("div",[i("span",{staticClass:"uncheck",class:{checked:e.image},on:{click:function(i){i.stopPropagation(),t.change(e,"image",1-(e.image||0))}}}),t._v("\n                        "+t._s(s+1)+"\n                    ")])]),t._v(" "),i("div",{staticClass:"roicenter",staticStyle:{width:"63%"}},[i("div",{staticClass:"item"},[i("div",[t._v("ROI面积:")]),t._v(" "),i("div",[i("span",[t._v(t._s(t.getarea(e)))]),t._m(0,!0)])]),t._v(" "),i("div",{staticClass:"item"},[i("div",[t._v("肌纤维数:")]),i("div",[t._v(t._s(t.getCount(e)))])]),t._v(" "),i("div",{staticClass:"item"},[i("div",[t._v("平均面积:")]),t._v(" "),i("div",[i("span",[t._v(t._s(t.getsamlarea(e)))]),t._m(1,!0)])]),t._v(" "),i("div",{staticClass:"item"},[i("div",[t._v("平均周长:")]),t._v(" "),i("div",[t._v("\n                            "+t._s(t.getperimeter(e))+"μm\n                        ")])]),t._v(" "),i("div",{staticClass:"item"},[i("div",[t._v("最长长径:")]),t._v(" "),i("div",[t._v("\n                            "+t._s(t.getlong(e))+"μm\n                        ")])]),t._v(" "),i("div",{staticClass:"item"},[i("div",[t._v("最短短径:")]),t._v(" "),i("div",[t._v("\n                            "+t._s(t.getshort(e))+"μm\n                        ")])])]),t._v(" "),i("div",{on:{click:function(i){return i.stopPropagation(),t.del(e)}}},[i("em",{attrs:{title:t.$t("upload.delete")}})])])}),0)]):t._e(),t._v(" "),t.ROIS?i("div",{staticClass:"tctbtm"},[i("div",{staticClass:"getResult"},[i("div",{staticClass:"left"},[t._v("\n                "+t._s(t.$t("slice.AiResult"))+"\n            ")]),t._v(" "),i("div",{staticClass:"right"},[i("div",{staticClass:"item"},[i("div",[t._v("ROI面积:")]),t._v(" "),i("div",[i("span",[t._v(t._s(t.RoiArea()))]),t._m(2)])]),t._v(" "),i("div",{staticClass:"item"},[i("div",[t._v("肌纤维数:")]),i("div",[t._v(t._s(t.ROIS.filter(function(t){return t.image}).map(function(e){return t.getCount(e)}).reduce(function(t,e){return t+e},0)))])]),t._v(" "),i("div",{staticClass:"item"},[i("div",[t._v("平均面积:")]),t._v(" "),i("div",[i("span",[t._v("\n                            "+t._s(t.Roiarea())+"\n                        ")]),t._v(" "),t._m(3)])]),t._v(" "),i("div",{staticClass:"item"},[i("div",[t._v("平均周长:")]),t._v(" "),i("div",[t._v("\n                    "+t._s(t.RoiPerimeter())+"μm\n                    ")])]),t._v(" "),i("div",{staticClass:"item"},[i("div",[t._v("最长长径:")]),t._v(" "),i("div",[t._v(t._s(t.Roilong())+"μm")])]),t._v(" "),i("div",{staticClass:"item"},[i("div",[t._v("最短短径:")]),t._v(" "),i("div",[t._v(t._s(t.Roishort())+"μm")])])])]),t._v(" "),i("div",{staticClass:"confidence"},[i("div",[t._v(t._s(t.$t("slice.confidence")))]),t._v(" "),i("div",["error"!=t.slice.muscle.diagnosis&&null!=t.slice.muscle.diagnosis?i("div",[t._v("100"),i("span",[t._v("%")])]):t._e(),t._v(" "),"error"==t.slice.muscle.diagnosis?i("div",[t._v("0")]):t._e()])]),t._v(" "),i("div",{staticClass:"interactive"},[i("div",[t._v(t._s(t.$t("slice.interaction")))]),t._v(" "),i("el-radio-group",{staticClass:"radios",model:{value:t.slice.muscle.computer,callback:function(e){t.$set(t.slice.muscle,"computer",e)},expression:"slice.muscle.computer"}},[i("el-radio",{attrs:{label:!0}},[t._v("YES")]),t._v(" "),i("el-radio",{attrs:{label:!1}},[t._v("NO")]),t._v(" "),i("el-radio",{attrs:{label:"unsure"}},[t._v("UNSURE")])],1)],1)]):t._e()])},staticRenderFns:[function(){var t=this.$createElement,e=this._self._c||t;return e("span",[this._v("μm"),e("sup",[this._v("2")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("span",[this._v("μm"),e("sup",[this._v("2")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("span",[this._v("μm"),e("sup",[this._v("2")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("span",[this._v("\n                            μm"),e("sup",[this._v("2")])])}]};var Qe=i("VU/8")(Ke,Ze,!1,function(t){i("PQ4l"),i("Xkiu")},null,null).exports,ti={data(){return{loopHandler:0,auto:!0,centerRegion:null,curRois:{},showbutton:!0,position:{offx:this.slice.position?this.slice.position.offx:.5,offy:this.slice.position?this.slice.position.offy:.5*this.slice.height/this.slice.width,zoom:this.slice.position?this.slice.position.zoom:null},lineup:null,showroi:{},muscleroi:!1,musclestyle:{},totalArea:"",showMppGuide:!1,drawMpp:null}},methods:{isDrawMpp(){/\.(png|jpg|jpeg|tiff|tif|bmp)$/.test(this.slice.filename)?this.showMppGuide=!0:this.startAnalyze()},showMenu(t,e){this.muscleroi=!1,this.musclestyle={},Object.values(this.showroi).length?(this.muscleroi=!0,this.musclestyle.left=t.offsetX-76+"px",this.musclestyle.top=t.offsetY-128+"px"):this.muscleroi=!1},noEmoji(t){t.target.value=t.target.value.replace(/[^\u0020-\u007E\u00A0-\u00BE\u2E80-\uA4CF\uF900-\uFAFF\uFE30-\uFE4F\uFF00-\uFFEF\u0080-\u009F\u2000-\u201f\u2026\u2022\u20ac\r\n]/g,"")},curROIChange(t,e){var i;[].concat(...Object.values(this.slice.muscle.airesult));!t||"grey"==t.color&&this.totalArea>1e5?(i=[],this.totalArea=0):t.length?i=t:e&&this.curRois[t.id]?(delete this.curRois[t.id],i=[]):i=[t],this.curRois=Object.assign({},e&&this.curRois,...i.map(t=>"grey"==t.color?{[t.id]:Object.assign({},t,{editable:!1})}:{[t.id]:t})),this.showroi={},t&&this.curRois[t.id]&&(this.showroi=[].concat.apply([],Object.values(this.slice.muscle.airesult)).filter(e=>e.id==this.curRois[t.id].id)),this.slice.roilist.forEach(t=>{this.curRois[t.id]&&this.$set(t,"path",this.curRois[t.id].path)}),Object.values(this.showroi).length||(this.muscleroi=!1)},listChangeCurrent(){var t=[].concat.apply([],Object.values(this.curRois).map(t=>t.path.x)),e=[].concat.apply([],Object.values(this.curRois).map(t=>t.path.y));t.length?this.centerRegion=[Math.min.apply(null,t),Math.min.apply(null,e),Math.max.apply(null,t),Math.max.apply(null,e)]:this.centerRegion=null},getArea(t){if(t.area)return t.area;for(var e=0,i=[t.x[0],t.y[0]],s=1;s<t.x.length-1;s++){var n=[t.x[s],t.y[s]],a=[t.x[s+1],t.y[s+1]];e+=(i[0]*n[1]+n[0]*a[1]+a[0]*i[1]-i[0]*a[1]-n[0]*i[1]-a[0]*n[1])/2}return Math.round(Math.abs(e)*Math.pow(this.slice.mppx||.242042,2))},getPerimeter(t){if(t.perimeter)return t.perimeter;for(var e=0,i=0;i<t.x.length-1;i++){var s=t.x[i],n=t.y[i],a=t.x[i+1],o=t.y[i+1];e+=Math.hypot(s-a,n-o)*(this.slice.mppx||.242042)}return e},getLong(t){return t.long?t.long:t.axis[1]*(this.slice.mppx||.242042)},getShort(t){return t.short?t.short:t.axis[0]*(this.slice.mppx||.242042)},draw(t){this.totalArea=this.getArea(t.path);for(var e=0;e<this.slice.muscle.result.length;e++)this.totalArea+=this.getArea(this.slice.muscle.result[e].path);if(t.id=(Math.random()+"").substr(2,6),this.auto){if(this.totalArea>1e5)return void this.$message({message:"ROI总面积不能大于0.1mm²",type:"warning"});t=Object.assign({},t,{image:""});var i=[...this.slice.muscle.result,t];this.$set(this.slice.muscle,"result",i)}else this.slice.roilist=[...this.slice.roilist,t]},async delCurRoi(t){let e={};for(var i of(t?(e={[t.id]:t},this.curRois[t.id]&&(delete this.curRois[t.id],this.curRois=Object.assign({},this.curRois))):(e=this.curRois,await this.$confirm(this.$t("analaysisPanel.delete"),{confirmButtonText:this.$t("confirm.confirm"),cancelButtonText:this.$t("confirm.quit"),type:"warning"}),this.curRois={}),Object.keys(e)))6==i.length?(this.slice.muscle.result=this.slice.muscle.result.filter(t=>t.id!=i),delete this.slice.muscle.airesult[i]):this.slice.muscle.result.map(t=>{void 0!=this.slice.muscle.airesult[t.id]&&(this.slice.muscle.airesult[t.id]=this.slice.muscle.airesult[t.id].filter(t=>!e[t.id]))});this.slice.roilist=this.slice.roilist.filter(t=>!e[t.id]),this.muscleroi=!1,this.showroi={}},getAlgorithmResult(t=this.record.id,e=this.slice.id,i=this.slice.filename){Object(s.b)("ai/getresult",{caseid:t,fileid:e,filename:i,type:"muscle",other:JSON.stringify(this.slice.muscle.result.map(t=>({id:t.id,x:t.path.x,y:t.path.y})))}).then(t=>{if(this.lineup=t.data.rank,t.data.done){if(this.showbutton=!0,this.loopHandler=0,this.$set(this.slice,"type","muscle"),-1!=t.data.rank)this.flag="error",this.$set(this.slice.muscle,"diagnosis","error");else{Object.keys(t.data.result).filter(t=>!this.slice.muscle.result.find(e=>e.id==t)).map(e=>delete t.data.result[e]),this.slice.muscle.airesult=t.data.result,[].concat.apply([],Object.values(this.slice.muscle.airesult)).forEach(t=>t.id=(""+Math.random()).substr(2,8)),[].concat.apply([],Object.values(this.slice.muscle.airesult)).forEach(t=>t.area=this.getArea(t)),[].concat.apply([],Object.values(this.slice.muscle.airesult)).forEach(t=>t.perimeter=this.getPerimeter(t)),[].concat.apply([],Object.values(this.slice.muscle.airesult)).forEach(t=>t.long=this.getLong(t)),[].concat.apply([],Object.values(this.slice.muscle.airesult)).forEach(t=>t.short=this.getShort(t)),this.$set(this.slice.muscle,"diagnosis",1)}this.updateRecord()}else this.showbutton=!1,this.loopHandler=setTimeout(()=>this.getAlgorithmResult(),5e3)})},startAnalyze(t=this.record.id,e=this.slice.id,i=this.slice.filename){0!=this.slice.muscle.result.length?(this.showroi={},this.$set(this.slice.muscle,"airesult",{}),this.$set(this.slice.muscle,"diagnosis",null),this.slice.started=!0,this.record.started=!0,this.showbutton=!1,this.auto=!0,this.slice.muscle.result.map(t=>t.image=!0),Object.values(this.curRois).map(t=>this.slice.roilist.every(e=>t.id!=e.id)&&this.slice.muscle.result.every(e=>t.id!=e.id)?delete this.curRois[t.id]:""),Object(s.b)("ai/start",{caseid:t,fileid:e,filename:i,type:"muscle",other:JSON.stringify(this.slice.muscle.result.map(t=>({id:t.id,x:t.path.x,y:t.path.y})))}).then(t=>{this.getAlgorithmResult()}).catch(t=>console.log(t)),this.updateRecord()):this.$message({message:"请先绘制ROI,再进行处理",type:"warning"})},canceltesk(){this.showbutton=!0,Object(s.b)("ai/revokeTask",{caseid:this.record.id,fileid:this.slice.id,type:"muscle",other:""}).then(t=>{0==t.code&&(clearTimeout(this.loopHandler),this.loopHandler=0,this.slice.started=!1,this.record.started=!1,this.slice.muscle.result.map(t=>t.image=!1),this.updateRecord())}).catch(t=>console.log(t))},updateRecord(){this.$emit("save","auto")},keydown(t){"Delete"!=t.key&&"Backspace"!=t.key||!Object.keys(this.curRois).length||this.delCurRoi()}},beforeMount(){this.slice.muscle||(this.$set(this.slice,"muscle",{}),this.$set(this.slice.muscle,"result",[]),this.$set(this.slice.muscle,"airesult",{})),this.slice.muscle&&!this.slice.muscle.airesult&&this.$set(this.slice.muscle,"airesult",{})},mounted(){this.slice.started&&this.slice.muscle&&null===this.slice.muscle.diagnosis&&this.getAlgorithmResult(),window.addEventListener("online",()=>{this.showbutton||this.getAlgorithmResult()})},beforeDestroy(){clearTimeout(this.loopHandler),this.loopHandler=0},watch:{"slice.id":{handler(){clearTimeout(this.loopHandler),this.loopHandler=0}},drawMpp:{handler(t){t&&(this.$set(this.slice,"mppx",t),this.$set(this.slice,"mppy",t),this.$emit("save","auto"),this.startAnalyze())}}},props:["slice","record"],components:{"v-dragon":v.a,"v-analyroi":Qe,"v-roi":m}},ei={render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"cnt",attrs:{tabIndex:0},on:{keydown:t.keydown}},[s("div",{staticClass:"analyright",on:{mousewheel:function(e){t.muscleroi=!1},mousedown:function(e){t.muscleroi=!1}}},[s("v-dragon",{staticClass:"dragon",attrs:{record:t.record,slice:t.slice,roilist:(this.slice.muscle?this.slice.muscle.result:[]).map(function(t){return Object.assign({method:"rectangle"},t,{editable:!1,selectable:!1,color:"grey"})}).concat((this.slice.muscle?[].concat.apply([],Object.values(this.slice.muscle.airesult)):[]).map(function(t){return{id:t.id,path:{x:t.x,y:t.y},color:"#00ff00",method:"freepen",editable:!1,selectable:!1,width:3}}),this.slice.roilist.map(function(t){return Object.assign({method:"rectangle"},t,{color:"yellow"})})),curRois:t.curRois,penColor:t.auto?"grey":"yellow",centerRegion:t.centerRegion,position:t.position,showMppGuide:t.showMppGuide},on:{curROI:t.curROIChange,draw:t.draw,delRoi:function(e){return t.delCurRoi(e)},contextmenu:function(e,i){return t.showMenu(e,i)},position:function(e,i,s){t.$set(t.position,"offx",e),t.$set(t.position,"offy",i),t.$set(t.position,"zoom",s),t.$set(t.slice,"position",t.position)},closeMppGuide:function(e){t.showMppGuide=!1},changeMpp:function(e){return t.drawMpp=e}}},[t.muscleroi?s("div",{staticClass:"muscleroi",staticStyle:{position:"absolute"},style:t.musclestyle,on:{click:function(e){e.stopPropagation(),t.muscleroi=!1}}},[s("img",{attrs:{src:i("uOiT")}}),t._v(" "),s("div",{staticClass:"item"},[s("div",[t._v("面积:")]),s("div",[s("span",[t._v(t._s(t.showroi.length?t.getArea(t.showroi[0]).toFixed(1):0))]),s("span",[t._v("μm"),s("sup",[t._v("2")])])])]),t._v(" "),s("div",{staticClass:"item"},[s("div",[t._v("周长:")]),s("div",[t._v(t._s(t.showroi.length?t.getPerimeter(t.showroi[0]).toFixed(1):0)+"μm")])]),t._v(" "),s("div",{staticClass:"item"},[s("div",[t._v("长径:")]),s("div",[t._v(t._s(t.showroi.length?t.getLong(t.showroi[0]).toFixed(1):0)+"μm")])]),t._v(" "),s("div",{staticClass:"item"},[s("div",[t._v("短径:")]),s("div",[t._v(t._s(t.showroi.length?t.getShort(t.showroi[0]).toFixed(1):0)+"μm")])])]):t._e()]),t._v(" "),t.showbutton?s("button",{on:{click:function(e){return t.isDrawMpp()}}},[t._v(t._s(t.$t("slice.start")))]):t._e()],1),t._v(" "),s("div",{staticClass:"analylist",on:{click:function(e){t.muscleroi=!1}}},[s("h2",[s("span",{class:t.auto?"auto":"",on:{click:function(e){t.auto=!0}}},[t._v(t._s(t.$t("analyze.airoi")))]),t._v(" "),s("span",{class:t.auto?"":"noauto",on:{click:function(e){t.auto=!1}}},[t._v(t._s(t.$t("analyze.roi")))])]),t._v(" "),t.auto?s("v-analyroi",{staticClass:"table",attrs:{slice:t.slice,ROIS:this.slice.muscle?this.slice.muscle.result:[],sRois:this.slice.muscle?this.slice.muscle.airesult:{},currentRois:t.curRois},on:{curROI:function(e,i){return t.curROIChange(e,i)+t.listChangeCurrent()},delRoi:function(e){return t.delCurRoi(e)},closecontextmenu:function(e){t.muscleroi=!1}}}):t._e(),t._v(" "),t.auto?t._e():s("v-roi",{staticClass:"manualroi",attrs:{roilist:t.slice.roilist,currentRois:t.curRois},on:{curROI:function(e,i){return t.curROIChange(e,i)+t.listChangeCurrent()},delRoi:function(e){return t.delCurRoi(e)},closecontextmenu:function(e){t.muscleroi=!1}}}),t._v(" "),!t.showbutton&&t.auto?s("div",{staticClass:"loding"},[s("div",{staticClass:"video"},[s("img",{attrs:{src:"/static/video/loading.gif"}}),t._v(" "),0==t.lineup?s("div",{staticClass:"lineup"},[t._v("正在处理...")]):t._e(),t._v(" "),t.lineup>0?s("div",{staticClass:"lineup"},[t._v(t._s(t.$t("slice.lineup"))+" "),s("span",{staticStyle:{color:"#4C9FFA","font-size":"18px","font-weight":"bolder"}},[t._v(t._s(t.lineup))]),t._v(" "+t._s(t.$t("slice.position")))]):t._e()]),t._v(" "),s("div",{staticClass:"cancel",on:{click:t.canceltesk}},[t._v(t._s(t.$t("slice.cancelTasks")))])]):t._e(),t._v(" "),0==t.auto?s("div",{staticClass:"opinio"},[s("h1",[t._v("\n                "+t._s(t.$t("analyze.point"))+"\n            ")]),t._v(" "),s("textarea",{directives:[{name:"model",rawName:"v-model",value:t.record.opinion,expression:"record.opinion"}],attrs:{placeholder:t.$t("report.pointremind"),maxlength:"300"},domProps:{value:t.record.opinion},on:{input:[function(e){e.target.composing||t.$set(t.record,"opinion",e.target.value)},t.noEmoji]}})]):t._e()],1)])},staticRenderFns:[]};var ii=i("VU/8")(ti,ei,!1,function(t){i("Q0DQ")},"data-v-4dbfdd35",null).exports,si={data(){return{loopHandler:0,auto:"one",centerRegion:null,curRois:{},showbutton:!0,radio:null,position:{offx:this.slice.position?this.slice.position.offx:.5,offy:this.slice.position?this.slice.position.offy:.5*this.slice.height/this.slice.width,zoom:this.slice.position?this.slice.position.zoom:null},lineup:null,showMppGuide:!1,drawMpp:null}},methods:{isDrawMpp(){/\.(png|jpg|jpeg|tiff|tif|bmp)$/.test(this.slice.filename)?this.showMppGuide=!0:this.startAnalyze()},keypress(t){if(t.ctrlKey&&"KeyB"==t.code){let t=window.prompt("人工结果？");this.record.analy=this.slice.breast.diagnosis=t}},noEmoji(t){t.target.value=t.target.value.replace(/[^\u0020-\u007E\u00A0-\u00BE\u2E80-\uA4CF\uF900-\uFAFF\uFE30-\uFE4F\uFF00-\uFFEF\u0080-\u009F\u2000-\u201f\u2026\u2022\u20ac\r\n]/g,"")},curROIChange(t,e){var i;t?t.length?i=t:e&&this.curRois[t.id]?(delete this.curRois[t.id],i=[]):i=[t]:i=[],this.curRois=Object.assign({},e&&this.curRois,...i.map(t=>({[t.id]:t})))},roiChanged(){for(var t in this.curRois)this.curRois[t]=Object.assign({},this.curRois[t]);var e=Object.assign({},this.curRois);this.$set(this.slice,"roilist",this.slice.roilist.map(t=>{var i=e[t.id];return i?(delete e[t.id],i):t}).concat(Object.values(e))),this.slice.breast&&(this.slice.breast.result=this.slice.breast.result.filter(t=>!this.curRois[t.id]))},listChangeCurrent(){var t=[].concat.apply([],Object.values(this.curRois).map(t=>t.path.x)),e=[].concat.apply([],Object.values(this.curRois).map(t=>t.path.y));t.length?this.centerRegion=[Math.min.apply(null,t),Math.min.apply(null,e),Math.max.apply(null,t),Math.max.apply(null,e)]:this.centerRegion=null},draw(t){t.id=(Math.random()+"").substr(2,6),"freepen"===t.method&&"yellow"===t.color&&(t.simplify=5),this.slice.roilist=[...this.slice.roilist,t]},async delCurRoi(t){let e={};t?(e={[t.id]:t},this.curRois[t.id]&&(delete this.curRois[t.id],this.curRois=Object.assign({},this.curRois))):(e=this.curRois,await this.$confirm(this.$t("analaysisPanel.delete"),{confirmButtonText:this.$t("confirm.confirm"),cancelButtonText:this.$t("confirm.quit"),type:"warning"}),this.curRois={}),this.slice.breast&&(this.slice.breast.result=this.slice.breast.result.filter(t=>!e[t.id])),this.slice.roilist=this.slice.roilist.filter(t=>!e[t.id])},getAlgorithmResult(t=this.record.id,e=this.slice.id,i=this.slice.filename){Object(s.b)("ai/getresult",{caseid:t,fileid:e,filename:i,type:"breast",other:""}).then(t=>{if(this.lineup=t.data.rank,t.data.done){if(this.showbutton=!0,this.loopHandler=0,this.slice.breast&&0==this.slice.breast.result.length){if(-1==t.data.rank)if(0==Object.keys(t.data.result).length)this.$set(this.slice.breast,"diagnosis","U");else{var e,i=t.data.result.cells&&t.data.result.cells.slice(0,30).map(t=>({id:(Math.random()+"").substr(2,6),path:{x:t.contourPoints.slice(0,-1).map(t=>t[0]),y:t.contourPoints.slice(0,-1).map(t=>t[1])}}));this.$set(this.slice.breast,"result",i);try{e=t.data.result.diagnosis[0].toLowerCase()}catch(t){}e={n:"阴性",p:"阳性",u:"不确定"}[e]||"不满意",this.$set(this.slice.breast,"diagnosis",e)}else this.$set(this.slice.breast,"diagnosis","U");this.$set(this.slice,"type","breast"),this.updateRecord()}}else this.showbutton=!1,this.loopHandler=setTimeout(()=>{this.getAlgorithmResult()},5e3)})},startAnalyze(t=this.record.id,e=this.slice.id,i=this.slice.filename){this.$set(this.slice,"breast",{}),this.$set(this.slice.breast,"result",[]),this.slice.started=!0,this.record.started=!0,this.$set(this.slice.breast,"diagnosis",null),this.showbutton=!1,this.auto="one",Object.values(this.curRois).map(t=>this.slice.roilist.every(e=>t.id!=e.id)&&this.slice.breast.result.every(e=>t.id!=e.id)?delete this.curRois[t.id]:""),Object(s.b)("ai/start",{caseid:t,fileid:e,filename:i,type:"breast",other:""}).then(t=>{this.getAlgorithmResult()}).catch(t=>console.log(t)),this.updateRecord()},canceltesk(){Object(s.b)("ai/revokeTask",{caseid:this.record.id,fileid:this.slice.id,type:"breast",other:""}).then(t=>{0==t.code&&(clearTimeout(this.loopHandler),this.loopHandler=0,this.showbutton=!0,this.slice.started=!1,this.record.started=!1,this.updateRecord())}).catch(t=>console.log(t))},updateRecord(){this.$emit("save","auto")},keydown(t){"Delete"!=t.key&&"Backspace"!=t.key||!Object.keys(this.curRois).length||this.delCurRoi()}},mounted(){this.slice.started&&this.slice.breast&&null===this.slice.breast.diagnosis&&this.getAlgorithmResult(),window.addEventListener("online",()=>{this.showbutton||this.getAlgorithmResult()})},watch:{"slice.id":{handler(){clearTimeout(this.loopHandler),this.loopHandler=0}},"slice.breast.computer":{async handler(t){await Object(s.b)("ai/edit",{caseid:this.record.id,fileid:this.slice.id,filename:this.slice.filename,type:"breast",result:t}),this.slice.breast.diagnosis={negative:"阴性",positive:"阳性",unsure:"不确定"}[t],this.$emit("save","auto")}},drawMpp:{handler(t){t&&(this.$set(this.slice,"mppx",t),this.$set(this.slice,"mppy",t),this.$emit("save","auto"),this.startAnalyze())}}},beforeDestroy(){clearTimeout(this.loopHandler),this.loopHandler=0},props:["slice","record"],components:{"v-dragon":v.a,"v-roi":m}},ni={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"cnt",staticStyle:{width:"100%"},attrs:{tabIndex:0},on:{keydown:t.keydown,keypress:t.keypress}},[i("div",{staticClass:"analyright"},[i("v-dragon",{staticClass:"dragon",attrs:{record:t.record,slice:t.slice,roilist:this.slice.roilist.map(function(t){return Object.assign({method:"rectangle"},t,{color:"yellow"})}).concat((this.slice.breast?this.slice.breast.result:[]).map(function(t){return Object.assign({},t,{color:"red",method:"rectangle",editable:!0,selectable:!1})})),curRois:t.curRois,penColor:"yellow",centerRegion:t.centerRegion,position:t.position,showMppGuide:t.showMppGuide},on:{curROI:t.curROIChange,roiChanged:t.roiChanged,draw:t.draw,delRoi:function(e){return t.delCurRoi(e)},position:function(e,i,s){t.$set(t.position,"offx",e),t.$set(t.position,"offy",i),t.$set(t.position,"zoom",s),t.$set(t.slice,"position",t.position)},closeMppGuide:function(e){t.showMppGuide=!1},changeMpp:function(e){return t.drawMpp=e}}}),t._v(" "),t.showbutton?i("button",{on:{click:function(e){return t.isDrawMpp()}}},[t._v(t._s(t.$t("slice.start")))]):t._e()],1),t._v(" "),i("div",{staticClass:"analylist"},[i("h2",[i("span",{class:"one"==t.auto?"auto":"",on:{click:function(e){t.auto="one"}}},[t._v(t._s(t.$t("analyze.airoi")))]),t._v(" "),i("span",{class:"two"==t.auto?"auto":"",on:{click:function(e){t.auto="two"}}},[t._v(t._s(t.$t("analyze.roi")))])]),t._v(" "),this.slice.breast&&"one"==t.auto?i("v-roi",{staticClass:"automanualroi",attrs:{roilist:this.slice.breast?this.slice.breast.result:[],currentRois:t.curRois},on:{curROI:function(e,i){return t.curROIChange(e,i)+t.listChangeCurrent()},delRoi:function(e){return t.delCurRoi(e)}}}):t._e(),t._v(" "),"two"==t.auto?i("v-roi",{staticClass:"manualroi",attrs:{roilist:t.slice.roilist,currentRois:t.curRois},on:{curROI:function(e,i){return t.curROIChange(e,i)+t.listChangeCurrent()},delRoi:function(e){return t.delCurRoi(e)}}}):t._e(),t._v(" "),t.showbutton||"one"!=t.auto?t._e():i("div",{staticClass:"loding"},[i("div",{staticClass:"video"},[i("img",{attrs:{src:"/static/video/loading.gif"}}),t._v(" "),0==t.lineup?i("div",{staticClass:"lineup"},[t._v("正在处理...")]):t._e(),t._v(" "),t.lineup>0?i("div",{staticClass:"lineup"},[t._v(t._s(t.$t("slice.lineup"))+" "),i("span",{staticStyle:{color:"#4C9FFA","font-size":"18px","font-weight":"bolder"}},[t._v(t._s(t.lineup))]),t._v(" "+t._s(t.$t("slice.position")))]):t._e()]),t._v(" "),i("div",{staticClass:"cancel",on:{click:t.canceltesk}},[t._v(t._s(t.$t("slice.cancelTasks")))])]),t._v(" "),this.slice.breast||"one"!=t.auto?t._e():i("div",{staticClass:"ifshowtables"},[t._v(t._s(t.$t("slice.noanalysis")))]),t._v(" "),this.slice.breast&&"one"==t.auto?i("div",{staticClass:"tctbtm"},[i("div",{staticClass:"AiResult"},[i("div",[t._v("\n                    "+t._s(t.$t("slice.AiResult"))+"\n                ")]),t._v(" "),i("div",{class:{error:"error"==this.slice.breast.diagnosis}},[i("input",{directives:[{name:"model",rawName:"v-model",value:t.slice.breast.diagnosis,expression:"slice.breast.diagnosis"}],attrs:{type:"text"},domProps:{value:t.slice.breast.diagnosis},on:{input:function(e){e.target.composing||t.$set(t.slice.breast,"diagnosis",e.target.value)}}})])]),t._v(" "),i("div",{staticClass:"confidence"},[i("div",[t._v(t._s(t.$t("slice.confidence")))]),t._v(" "),t._m(0)]),t._v(" "),i("div",{staticClass:"interactive"},[i("div",[t._v(t._s(t.$t("slice.interaction")))]),t._v(" "),i("el-radio-group",{staticClass:"radios",model:{value:t.slice.breast.computer,callback:function(e){t.$set(t.slice.breast,"computer",e)},expression:"slice.breast.computer"}},[i("el-radio",{attrs:{label:"positive"}},[t._v("阳性")]),t._v(" "),i("el-radio",{attrs:{label:"negative"}},[t._v("阴性")]),t._v(" "),i("el-radio",{attrs:{label:"unsure"}},[t._v("不确定")])],1)],1)]):t._e(),t._v(" "),"two"==t.auto?i("div",{staticClass:"opinio"},[i("h1",[t._v("\n                "+t._s(t.$t("analyze.point"))+"\n            ")]),t._v(" "),i("textarea",{directives:[{name:"model",rawName:"v-model",value:t.record.opinion,expression:"record.opinion"}],attrs:{placeholder:t.$t("report.pointremind"),maxlength:"300"},domProps:{value:t.record.opinion},on:{input:[function(e){e.target.composing||t.$set(t.record,"opinion",e.target.value)},t.noEmoji]}})]):t._e()],1)])},staticRenderFns:[function(){var t=this.$createElement,e=this._self._c||t;return e("div",[e("div",[this._v("100%")])])}]};var ai=i("VU/8")(si,ni,!1,function(t){i("eBbF"),i("OhiO")},"data-v-431c4782",null).exports,oi={data(){return{loopHandler:0,auto:!0,centerRegion:null,curRois:{},showbutton:!0,position:{offx:this.slice.position?this.slice.position.offx:.5,offy:this.slice.position?this.slice.position.offy:.5*this.slice.height/this.slice.width,zoom:this.slice.position?this.slice.position.zoom:null},lineup:null,showMppGuide:!1,drawMpp:null}},filters:{showdiagnosis(t){if(void 0!=t)switch(t){case"Benign":return"N";case"Malignant":return"P";case"Unsure":return"U";case"PreCancer":return"A";default:return"U"}}},methods:{isDrawMpp(){/\.(png|jpg|jpeg|tiff|tif|bmp)$/.test(this.slice.filename)?this.showMppGuide=!0:this.startAnalyze()},listChangeCurrent(){var t=[].concat.apply([],Object.values(this.curRois).map(t=>t.path.x)),e=[].concat.apply([],Object.values(this.curRois).map(t=>t.path.y));t.length?this.centerRegion=[Math.min.apply(null,t),Math.min.apply(null,e),Math.max.apply(null,t),Math.max.apply(null,e)]:this.centerRegion=null},noEmoji(t){t.target.value=t.target.value.replace(/[^\u0020-\u007E\u00A0-\u00BE\u2E80-\uA4CF\uF900-\uFAFF\uFE30-\uFE4F\uFF00-\uFFEF\u0080-\u009F\u2000-\u201f\u2026\u2022\u20ac\r\n]/g,"")},curROIChange(t,e){var i;t?t.length?i=t:e&&this.curRois[t.id]?(delete this.curRois[t.id],i=[]):i=[t]:i=[],this.curRois=Object.assign({},e&&this.curRois,...i.map(t=>({[t.id]:t}))),this.slice.roilist.forEach(t=>{this.curRois[t.id]&&this.$set(t,"path",this.curRois[t.id].path)})},draw(t){t.id=(Math.random()+"").substr(2,6),this.slice.roilist=[...this.slice.roilist,t]},async delCurRoi(t){let e={};t?(e={[t.id]:t},this.curRois[t.id]&&(delete this.curRois[t.id],this.curRois=Object.assign({},this.curRois))):(e=this.curRois,await this.$confirm(this.$t("analaysisPanel.delete"),{confirmButtonText:this.$t("confirm.confirm"),cancelButtonText:this.$t("confirm.quit"),type:"warning"}),this.curRois={}),this.slice.roilist=this.slice.roilist.filter(t=>!e[t.id])},getAlgorithmResult(t=this.record.id,e=this.slice.id,i=this.slice.filename){Object(s.b)("ai/getresult",{caseid:t,fileid:e,filename:i,type:"mucosa",other:""}).then(t=>{this.lineup=t.data.rank,t.data.done?(this.showbutton=!0,this.loopHandler=0,this.slice.cervix&&(this.$set(this.slice,"type","mucosa"),this.$set(this.slice.cervix,"diagnosis",t.data.result.flag),this.updateRecord())):(this.showbutton=!1,this.loopHandler=setTimeout(()=>this.getAlgorithmResult(),5e3))})},startAnalyze(t=this.record.id,e=this.slice.id,i=this.slice.filename){this.slice.cervix={},this.$set(this.slice.cervix,"diagnosis",null),this.slice.started=!0,this.record.started=!0,this.showbutton=!1,this.auto=!0,Object(s.b)("ai/start",{caseid:t,fileid:e,filename:i,type:"mucosa",other:""}).then(t=>{this.getAlgorithmResult()}).catch(t=>console.log(t)),this.updateRecord()},canceltesk(){Object(s.b)("ai/revokeTask",{caseid:this.record.id,fileid:this.slice.id,type:"mucosa",other:""}).then(t=>{0==t.code&&(clearTimeout(this.loopHandler),this.loopHandler=0,this.showbutton=!0,this.slice.started=!1,this.record.started=!1,this.updateRecord())}).catch(t=>console.log(t))},updateRecord(){this.$emit("save","auto")},keydown(t){"Delete"!=t.key&&"Backspace"!=t.key||!Object.keys(this.curRois).length||this.delCurRoi()}},mounted(){this.slice.started&&this.slice.cervix&&null===this.slice.cervix.diagnosis&&this.getAlgorithmResult(),window.addEventListener("online",()=>{this.showbutton||this.getAlgorithmResult()})},beforeDestroy(){clearTimeout(this.loopHandler),this.loopHandler=0},watch:{"slice.id":{handler(){clearTimeout(this.loopHandler),this.loopHandler=0}},drawMpp:{handler(t){t&&(this.$set(this.slice,"mppx",t),this.$set(this.slice,"mppy",t),this.$emit("save","auto"),this.startAnalyze())}}},props:["slice","record"],components:{"v-dragon":v.a,"v-roi":m}},ri={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"cnt"},[i("div",{staticClass:"analyright",attrs:{tabIndex:0},on:{keydown:t.keydown}},[i("v-dragon",{staticClass:"dragon",attrs:{record:t.record,slice:t.slice,roilist:[].concat(this.slice.roilist.map(function(t){return Object.assign({method:"rectangle"},t,{color:"yellow"})})),curRois:t.curRois,penColor:"yellow",centerRegion:t.centerRegion,position:t.position,showMppGuide:t.showMppGuide},on:{curROI:t.curROIChange,draw:t.draw,delRoi:function(e){return t.delCurRoi(e)},position:function(e,i,s){t.$set(t.position,"offx",e),t.$set(t.position,"offy",i),t.$set(t.position,"zoom",s),t.$set(t.slice,"position",t.position)},closeMppGuide:function(e){t.showMppGuide=!1},changeMpp:function(e){return t.drawMpp=e}}}),t._v(" "),t.showbutton?i("button",{on:{click:function(e){return t.isDrawMpp()}}},[t._v(t._s(t.$t("slice.start")))]):t._e()],1),t._v(" "),i("div",{staticClass:"analylist"},[i("h2",[i("span",{class:1==t.auto?"auto":"",on:{click:function(e){t.auto=!0}}},[t._v(t._s(t.$t("analyze.airoi")))]),t._v(" "),i("span",{class:0==t.auto?"noauto":"",on:{click:function(e){t.auto=!1}}},[t._v(t._s(t.$t("analyze.roi")))])]),t._v(" "),t.auto&&this.slice.cervix?i("v-roi",{staticClass:"automanualroi",attrs:{roilist:[],currentRois:t.curRois},on:{curROI:function(e,i){return t.curROIChange(e,i)+t.listChangeCurrent()},delRoi:function(e){return t.delCurRoi(e)}}}):t._e(),t._v(" "),t.auto?t._e():i("v-roi",{staticClass:"manualroi",attrs:{roilist:t.slice.roilist,currentRois:t.curRois},on:{curROI:function(e,i){return t.curROIChange(e,i)+t.listChangeCurrent()},delRoi:function(e){return t.delCurRoi(e)}}}),t._v(" "),!t.showbutton&&t.auto?i("div",{staticClass:"loding"},[i("div",{staticClass:"video"},[i("img",{attrs:{src:"/static/video/loading.gif"}}),t._v(" "),0==t.lineup?i("div",{staticClass:"lineup"},[t._v("正在处理...")]):t._e(),t._v(" "),t.lineup>0?i("div",{staticClass:"lineup"},[t._v(t._s(t.$t("slice.lineup"))+" "),i("span",{staticStyle:{color:"#4C9FFA","font-size":"18px","font-weight":"bolder"}},[t._v(t._s(t.lineup))]),t._v(" "+t._s(t.$t("slice.position")))]):t._e()]),t._v(" "),i("div",{staticClass:"cancel",on:{click:t.canceltesk}},[t._v(t._s(t.$t("slice.cancelTasks")))])]):t._e(),t._v(" "),!t.slice.cervix&&t.auto?i("div",{staticClass:"ifshowtables"},[t._v(t._s(t.$t("slice.noanalysis")))]):t._e(),t._v(" "),t.slice.cervix&&t.auto?i("div",{staticClass:"tctbtm"},[i("div",{staticClass:"AiResult"},[i("div",[t._v("\n                    "+t._s(t.$t("slice.AiResult"))+"\n                ")]),t._v(" "),i("div",[t._v("\n                    N\n                ")])]),t._v(" "),i("div",{staticClass:"confidence"},[i("div",[t._v(t._s(t.$t("slice.confidence")))]),t._v(" "),t._m(0)]),t._v(" "),i("div",{staticClass:"interactive"},[i("div",[t._v(t._s(t.$t("slice.interaction")))]),t._v(" "),i("el-radio-group",{staticClass:"radios",model:{value:t.slice.company,callback:function(e){t.$set(t.slice,"company",e)},expression:"slice.company"}},[i("el-radio",{attrs:{label:!0}},[t._v("YES")]),t._v(" "),i("el-radio",{attrs:{label:!1}},[t._v("NO")]),t._v(" "),i("el-radio",{attrs:{label:"unsure"}},[t._v("UNSURE")])],1)],1)]):t._e(),t._v(" "),0==t.auto?i("div",{staticClass:"opinio"},[i("h1",[t._v("\n                "+t._s(t.$t("analyze.point"))+"\n            ")]),t._v(" "),i("textarea",{directives:[{name:"model",rawName:"v-model",value:t.record.opinion,expression:"record.opinion"}],attrs:{placeholder:t.$t("report.pointremind"),maxlength:"300"},domProps:{value:t.record.opinion},on:{input:[function(e){e.target.composing||t.$set(t.record,"opinion",e.target.value)},t.noEmoji]}})]):t._e()],1)])},staticRenderFns:[function(){var t=this.$createElement,e=this._self._c||t;return e("div",[e("div",[this._v("100%")])])}]};var li=i("VU/8")(oi,ri,!1,function(t){i("ntHD"),i("dNnZ")},"data-v-bcc84c68",null).exports,ci={data(){return{loopHandler:0,auto:!0,centerRegion:null,curRois:{},showbutton:!0,position:{offx:this.slice.position?this.slice.position.offx:.5,offy:this.slice.position?this.slice.position.offy:.5*this.slice.height/this.slice.width,zoom:this.slice.position?this.slice.position.zoom:null},lineup:null,showMppGuide:!1,drawMpp:null}},filters:{showdiagnosis(t){if(void 0!=t)switch(t){case"Benign":return"N";case"Malignant":return"P";case"Unsure":return"U";case"PreCancer":return"A";default:return"U"}}},methods:{isDrawMpp(){/\.(png|jpg|jpeg|tiff|tif|bmp)$/.test(this.slice.filename)?this.showMppGuide=!0:this.startAnalyze()},listChangeCurrent(){var t=[].concat.apply([],Object.values(this.curRois).map(t=>t.path.x)),e=[].concat.apply([],Object.values(this.curRois).map(t=>t.path.y));t.length?this.centerRegion=[Math.min.apply(null,t),Math.min.apply(null,e),Math.max.apply(null,t),Math.max.apply(null,e)]:this.centerRegion=null},noEmoji(t){t.target.value=t.target.value.replace(/[^\u0020-\u007E\u00A0-\u00BE\u2E80-\uA4CF\uF900-\uFAFF\uFE30-\uFE4F\uFF00-\uFFEF\u0080-\u009F\u2000-\u201f\u2026\u2022\u20ac\r\n]/g,"")},curROIChange(t,e){var i;t?t.length?i=t:e&&this.curRois[t.id]?(delete this.curRois[t.id],i=[]):i=[t]:i=[],this.curRois=Object.assign({},e&&this.curRois,...i.map(t=>({[t.id]:t}))),this.slice.roilist.forEach(t=>{this.curRois[t.id]&&this.$set(t,"path",this.curRois[t.id].path)})},draw(t){t.id=(Math.random()+"").substr(2,6),this.slice.roilist=[...this.slice.roilist,t]},async delCurRoi(t){let e={};t?(e={[t.id]:t},this.curRois[t.id]&&(delete this.curRois[t.id],this.curRois=Object.assign({},this.curRois))):(e=this.curRois,await this.$confirm(this.$t("analaysisPanel.delete"),{confirmButtonText:this.$t("confirm.confirm"),cancelButtonText:this.$t("confirm.quit"),type:"warning"}),this.curRois={}),this.slice.roilist=this.slice.roilist.filter(t=>!e[t.id])},getAlgorithmResult(t=this.record.id,e=this.slice.id,i=this.slice.filename){Object(s.b)("ai/getresult",{caseid:t,fileid:e,filename:i,type:"mucosa",other:""}).then(t=>{this.lineup=t.data.rank,t.data.done?(this.showbutton=!0,this.loopHandler=0,this.slice.lung&&(this.$set(this.slice,"type","lung"),this.$set(this.slice.lung,"diagnosis",t.data.result.flag),this.updateRecord())):(this.showbutton=!1,this.loopHandler=setTimeout(()=>this.getAlgorithmResult(),5e3))})},startAnalyze(t=this.record.id,e=this.slice.id,i=this.slice.filename){this.slice.lung={},this.$set(this.slice.lung,"diagnosis",null),this.slice.started=!0,this.record.started=!0,this.showbutton=!1,this.auto=!0,Object(s.b)("ai/start",{caseid:t,fileid:e,filename:i,type:"mucosa",other:""}).then(t=>{this.getAlgorithmResult()}).catch(t=>console.log(t)),this.updateRecord()},canceltesk(){Object(s.b)("ai/revokeTask",{caseid:this.record.id,fileid:this.slice.id,type:"mucosa",other:""}).then(t=>{0==t.code&&(clearTimeout(this.loopHandler),this.loopHandler=0,this.showbutton=!0,this.slice.started=!1,this.record.started=!1,this.updateRecord())}).catch(t=>console.log(t))},updateRecord(){this.$emit("save","auto")},keydown(t){"Delete"!=t.key&&"Backspace"!=t.key||!Object.keys(this.curRois).length||this.delCurRoi()}},mounted(){this.slice.started&&this.slice.lung&&null===this.slice.lung.diagnosis&&this.getAlgorithmResult(),window.addEventListener("online",()=>{this.showbutton||this.getAlgorithmResult()})},beforeDestroy(){clearTimeout(this.loopHandler),this.loopHandler=0},watch:{"slice.id":{handler(){clearTimeout(this.loopHandler),this.loopHandler=0}},drawMpp:{handler(t){t&&(this.$set(this.slice,"mppx",t),this.$set(this.slice,"mppy",t),this.$emit("save","auto"),this.startAnalyze())}}},props:["slice","record"],components:{"v-dragon":v.a,"v-roi":m}},ui={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"cnt"},[i("div",{staticClass:"analyright",attrs:{tabIndex:0},on:{keydown:t.keydown}},[i("v-dragon",{staticClass:"dragon",attrs:{record:t.record,slice:t.slice,roilist:[].concat(this.slice.roilist.map(function(t){return Object.assign({method:"rectangle"},t,{color:"yellow"})})),curRois:t.curRois,penColor:"yellow",centerRegion:t.centerRegion,position:t.position,showMppGuide:t.showMppGuide},on:{curROI:t.curROIChange,draw:t.draw,delRoi:function(e){return t.delCurRoi(e)},position:function(e,i,s){t.$set(t.position,"offx",e),t.$set(t.position,"offy",i),t.$set(t.position,"zoom",s),t.$set(t.slice,"position",t.position)},closeMppGuide:function(e){t.showMppGuide=!1},changeMpp:function(e){return t.drawMpp=e}}}),t._v(" "),t.showbutton?i("button",{on:{click:function(e){return t.isDrawMpp()}}},[t._v(t._s(t.$t("slice.start")))]):t._e()],1),t._v(" "),i("div",{staticClass:"analylist"},[i("h2",[i("span",{class:1==t.auto?"auto":"",on:{click:function(e){t.auto=!0}}},[t._v(t._s(t.$t("analyze.airoi")))]),t._v(" "),i("span",{class:0==t.auto?"noauto":"",on:{click:function(e){t.auto=!1}}},[t._v(t._s(t.$t("analyze.roi")))])]),t._v(" "),t.auto&&this.slice.lung?i("v-roi",{staticClass:"automanualroi",attrs:{roilist:[],currentRois:t.curRois},on:{curROI:function(e,i){return t.curROIChange(e,i)+t.listChangeCurrent()},delRoi:function(e){return t.delCurRoi(e)}}}):t._e(),t._v(" "),t.auto?t._e():i("v-roi",{staticClass:"manualroi",attrs:{roilist:t.slice.roilist,currentRois:t.curRois},on:{curROI:function(e,i){return t.curROIChange(e,i)+t.listChangeCurrent()},delRoi:function(e){return t.delCurRoi(e)}}}),t._v(" "),!t.showbutton&&t.auto?i("div",{staticClass:"loding"},[i("div",{staticClass:"video"},[i("img",{attrs:{src:"/static/video/loading.gif"}}),t._v(" "),0==t.lineup?i("div",{staticClass:"lineup"},[t._v("正在处理...")]):t._e(),t._v(" "),t.lineup>0?i("div",{staticClass:"lineup"},[t._v(t._s(t.$t("slice.lineup"))+" "),i("span",{staticStyle:{color:"#4C9FFA","font-size":"18px","font-weight":"bolder"}},[t._v(t._s(t.lineup))]),t._v(" "+t._s(t.$t("slice.position")))]):t._e()]),t._v(" "),i("div",{staticClass:"cancel",on:{click:t.canceltesk}},[t._v(t._s(t.$t("slice.cancelTasks")))])]):t._e(),t._v(" "),!t.slice.lung&&t.auto?i("div",{staticClass:"ifshowtables"},[t._v(t._s(t.$t("slice.noanalysis")))]):t._e(),t._v(" "),t.slice.lung&&t.auto?i("div",{staticClass:"tctbtm"},[i("div",{staticClass:"AiResult"},[i("div",[t._v("\n                    "+t._s(t.$t("slice.AiResult"))+"\n                ")]),t._v(" "),i("div",[t._v("\n                    P\n                ")])]),t._v(" "),i("div",{staticClass:"confidence"},[i("div",[t._v(t._s(t.$t("slice.confidence")))]),t._v(" "),t._m(0)]),t._v(" "),i("div",{staticClass:"interactive"},[i("div",[t._v(t._s(t.$t("slice.interaction")))]),t._v(" "),i("el-radio-group",{staticClass:"radios",model:{value:t.slice.company,callback:function(e){t.$set(t.slice,"company",e)},expression:"slice.company"}},[i("el-radio",{attrs:{label:!0}},[t._v("YES")]),t._v(" "),i("el-radio",{attrs:{label:!1}},[t._v("NO")]),t._v(" "),i("el-radio",{attrs:{label:"unsure"}},[t._v("UNSURE")])],1)],1)]):t._e(),t._v(" "),0==t.auto?i("div",{staticClass:"opinio"},[i("h1",[t._v("\n                "+t._s(t.$t("analyze.point"))+"\n            ")]),t._v(" "),i("textarea",{directives:[{name:"model",rawName:"v-model",value:t.record.opinion,expression:"record.opinion"}],attrs:{placeholder:t.$t("report.pointremind"),maxlength:"300"},domProps:{value:t.record.opinion},on:{input:[function(e){e.target.composing||t.$set(t.record,"opinion",e.target.value)},t.noEmoji]}})]):t._e()],1)])},staticRenderFns:[function(){var t=this.$createElement,e=this._self._c||t;return e("div",[e("div",[this._v("100%")])])}]};var hi=i("VU/8")(ci,ui,!1,function(t){i("SlxH"),i("Z1n+")},"data-v-3f7a68a7",null).exports,di={data(){return{loopHandler:0,auto:!0,centerRegion:null,curRois:{},showbutton:!0,position:{offx:this.slice.position?this.slice.position.offx:.5,offy:this.slice.position?this.slice.position.offy:.5*this.slice.height/this.slice.width,zoom:this.slice.position?this.slice.position.zoom:null},lineup:null,showMppGuide:!1,drawMpp:null}},filters:{showdiagnosis(t){if(void 0!=t)switch(t){case"Benign":return"N";case"Malignant":return"P";case"Unsure":return"U";case"PreCancer":return"A";default:return"U"}}},methods:{isDrawMpp(){/\.(png|jpg|jpeg|tiff|tif|bmp)$/.test(this.slice.filename)?this.showMppGuide=!0:this.startAnalyze()},listChangeCurrent(){var t=[].concat.apply([],Object.values(this.curRois).map(t=>t.path.x)),e=[].concat.apply([],Object.values(this.curRois).map(t=>t.path.y));t.length?this.centerRegion=[Math.min.apply(null,t),Math.min.apply(null,e),Math.max.apply(null,t),Math.max.apply(null,e)]:this.centerRegion=null},noEmoji(t){t.target.value=t.target.value.replace(/[^\u0020-\u007E\u00A0-\u00BE\u2E80-\uA4CF\uF900-\uFAFF\uFE30-\uFE4F\uFF00-\uFFEF\u0080-\u009F\u2000-\u201f\u2026\u2022\u20ac\r\n]/g,"")},curROIChange(t,e){var i;t?t.length?i=t:e&&this.curRois[t.id]?(delete this.curRois[t.id],i=[]):i=[t]:i=[],this.curRois=Object.assign({},e&&this.curRois,...i.map(t=>({[t.id]:t}))),this.slice.roilist.forEach(t=>{this.curRois[t.id]&&this.$set(t,"path",this.curRois[t.id].path)})},draw(t){t.id=(Math.random()+"").substr(2,6),this.slice.roilist=[...this.slice.roilist,t]},async delCurRoi(t){let e={};t?(e={[t.id]:t},this.curRois[t.id]&&(delete this.curRois[t.id],this.curRois=Object.assign({},this.curRois))):(e=this.curRois,await this.$confirm(this.$t("analaysisPanel.delete"),{confirmButtonText:this.$t("confirm.confirm"),cancelButtonText:this.$t("confirm.quit"),type:"warning"}),this.curRois={}),this.slice.roilist=this.slice.roilist.filter(t=>!e[t.id])},getAlgorithmResult(t=this.record.id,e=this.slice.id,i=this.slice.filename){Object(s.b)("ai/getresult",{caseid:t,fileid:e,filename:i,type:"mucosa",other:""}).then(t=>{this.lineup=t.data.rank,t.data.done?(this.showbutton=!0,this.loopHandler=0,this.slice.prostate&&(this.$set(this.slice,"type","prostate"),this.$set(this.slice.prostate,"diagnosis",t.data.result.flag),this.updateRecord())):(this.showbutton=!1,this.loopHandler=setTimeout(()=>this.getAlgorithmResult(),5e3))})},startAnalyze(t=this.record.id,e=this.slice.id,i=this.slice.filename){this.slice.prostate={},this.$set(this.slice.prostate,"diagnosis",null),this.slice.started=!0,this.record.started=!0,this.showbutton=!1,this.auto=!0,Object(s.b)("ai/start",{caseid:t,fileid:e,filename:i,type:"mucosa",other:""}).then(t=>{this.getAlgorithmResult(),this.slice.prostate.taskid=t.data.task_id}).catch(t=>console.log(t)),this.updateRecord()},canceltesk(){Object(s.b)("ai/revokeTask",{ccaseid:this.record.id,fileid:this.slice.id,type:"mucosa",other:""}).then(t=>{0==t.code&&(clearTimeout(this.loopHandler),this.loopHandler=0,this.showbutton=!0,this.slice.started=!1,this.record.started=!1,this.updateRecord())}).catch(t=>console.log(t))},updateRecord(){this.$emit("save","auto")},keydown(t){"Delete"!=t.key&&"Backspace"!=t.key||!Object.keys(this.curRois).length||this.delCurRoi()}},mounted(){this.slice.started&&this.slice.prostate&&null===this.slice.prostate.diagnosis&&this.getAlgorithmResult(),window.addEventListener("online",()=>{this.showbutton||this.getAlgorithmResult()})},beforeDestroy(){clearTimeout(this.loopHandler),this.loopHandler=0},watch:{"slice.id":{handler(){clearTimeout(this.loopHandler),this.loopHandler=0}},drawMpp:{handler(t){t&&(this.$set(this.slice,"mppx",t),this.$set(this.slice,"mppy",t),this.$emit("save","auto"),this.startAnalyze())}}},props:["slice","record"],components:{"v-dragon":v.a,"v-roi":m}},pi={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"cnt"},[i("div",{staticClass:"analyright",attrs:{tabIndex:0},on:{keydown:t.keydown}},[i("v-dragon",{staticClass:"dragon",attrs:{record:t.record,slice:t.slice,roilist:[].concat(this.slice.roilist.map(function(t){return Object.assign({method:"rectangle"},t,{color:"yellow"})})),curRois:t.curRois,penColor:"yellow",centerRegion:t.centerRegion,position:t.position,showMppGuide:t.showMppGuide},on:{curROI:t.curROIChange,draw:t.draw,delRoi:function(e){return t.delCurRoi(e)},position:function(e,i,s){t.$set(t.position,"offx",e),t.$set(t.position,"offy",i),t.$set(t.position,"zoom",s),t.$set(t.slice,"position",t.position)},closeMppGuide:function(e){t.showMppGuide=!1},changeMpp:function(e){return t.drawMpp=e}}}),t._v(" "),t.showbutton?i("button",{on:{click:function(e){return t.isDrawMpp()}}},[t._v(t._s(t.$t("slice.start")))]):t._e()],1),t._v(" "),i("div",{staticClass:"analylist"},[i("h2",[i("span",{class:1==t.auto?"auto":"",on:{click:function(e){t.auto=!0}}},[t._v(t._s(t.$t("analyze.airoi")))]),t._v(" "),i("span",{class:0==t.auto?"noauto":"",on:{click:function(e){t.auto=!1}}},[t._v(t._s(t.$t("analyze.roi")))])]),t._v(" "),t.auto&&this.slice.prostate?i("v-roi",{staticClass:"automanualroi",attrs:{roilist:[],currentRois:t.curRois},on:{curROI:function(e,i){return t.curROIChange(e,i)+t.listChangeCurrent()},delRoi:function(e){return t.delCurRoi(e)}}}):t._e(),t._v(" "),t.auto?t._e():i("v-roi",{staticClass:"manualroi",attrs:{roilist:t.slice.roilist,currentRois:t.curRois},on:{curROI:function(e,i){return t.curROIChange(e,i)+t.listChangeCurrent()},delRoi:function(e){return t.delCurRoi(e)}}}),t._v(" "),!t.showbutton&&t.auto?i("div",{staticClass:"loding"},[i("div",{staticClass:"video"},[i("img",{attrs:{src:"/static/video/loading.gif"}}),t._v(" "),0==t.lineup?i("div",{staticClass:"lineup"},[t._v("正在处理...")]):t._e(),t._v(" "),t.lineup>0?i("div",{staticClass:"lineup"},[t._v(t._s(t.$t("slice.lineup"))+" "),i("span",{staticStyle:{color:"#4C9FFA","font-size":"18px","font-weight":"bolder"}},[t._v(t._s(t.lineup))]),t._v(" "+t._s(t.$t("slice.position")))]):t._e()]),t._v(" "),i("div",{staticClass:"cancel",on:{click:t.canceltesk}},[t._v(t._s(t.$t("slice.cancelTasks")))])]):t._e(),t._v(" "),!t.slice.prostate&&t.auto?i("div",{staticClass:"ifshowtables"},[t._v(t._s(t.$t("slice.noanalysis")))]):t._e(),t._v(" "),t.slice.prostate&&t.auto?i("div",{staticClass:"tctbtm"},[i("div",{staticClass:"AiResult"},[i("div",[t._v("\n                    "+t._s(t.$t("slice.AiResult"))+"\n                ")]),t._v(" "),i("div",[t._v("\n                    P\n                ")])]),t._v(" "),i("div",{staticClass:"confidence"},[i("div",[t._v(t._s(t.$t("slice.confidence")))]),t._v(" "),t._m(0)]),t._v(" "),i("div",{staticClass:"interactive"},[i("div",[t._v(t._s(t.$t("slice.interaction")))]),t._v(" "),i("el-radio-group",{staticClass:"radios",model:{value:t.slice.company,callback:function(e){t.$set(t.slice,"company",e)},expression:"slice.company"}},[i("el-radio",{attrs:{label:!0}},[t._v("YES")]),t._v(" "),i("el-radio",{attrs:{label:!1}},[t._v("NO")]),t._v(" "),i("el-radio",{attrs:{label:"unsure"}},[t._v("UNSURE")])],1)],1)]):t._e(),t._v(" "),0==t.auto?i("div",{staticClass:"opinio"},[i("h1",[t._v("\n                "+t._s(t.$t("analyze.point"))+"\n            ")]),t._v(" "),i("textarea",{directives:[{name:"model",rawName:"v-model",value:t.record.opinion,expression:"record.opinion"}],attrs:{placeholder:t.$t("report.pointremind"),maxlength:"300"},domProps:{value:t.record.opinion},on:{input:[function(e){e.target.composing||t.$set(t.record,"opinion",e.target.value)},t.noEmoji]}})]):t._e()],1)])},staticRenderFns:[function(){var t=this.$createElement,e=this._self._c||t;return e("div",[e("div",[this._v("100%")])])}]};var vi=i("VU/8")(di,pi,!1,function(t){i("/yYD"),i("TBqe")},"data-v-afaf8f6c",null).exports,gi={data(){return{loopHandler:0,auto:!0,centerRegion:null,curRois:{},showbutton:!0,position:{offx:this.slice.position?this.slice.position.offx:.5,offy:this.slice.position?this.slice.position.offy:.5*this.slice.height/this.slice.width,zoom:this.slice.position?this.slice.position.zoom:null},lineup:null,showMppGuide:!1,drawMpp:null}},filters:{showdiagnosis(t){if(void 0!=t)switch(t){case"Benign":return"N";case"Malignant":return"P";case"Unsure":return"U";case"PreCancer":return"A";default:return"U"}}},methods:{isDrawMpp(){/\.(png|jpg|jpeg|tiff|tif|bmp)$/.test(this.slice.filename)?this.showMppGuide=!0:this.startAnalyze()},listChangeCurrent(){var t=[].concat.apply([],Object.values(this.curRois).map(t=>t.path.x)),e=[].concat.apply([],Object.values(this.curRois).map(t=>t.path.y));t.length?this.centerRegion=[Math.min.apply(null,t),Math.min.apply(null,e),Math.max.apply(null,t),Math.max.apply(null,e)]:this.centerRegion=null},noEmoji(t){t.target.value=t.target.value.replace(/[^\u0020-\u007E\u00A0-\u00BE\u2E80-\uA4CF\uF900-\uFAFF\uFE30-\uFE4F\uFF00-\uFFEF\u0080-\u009F\u2000-\u201f\u2026\u2022\u20ac\r\n]/g,"")},curROIChange(t,e){var i;t?t.length?i=t:e&&this.curRois[t.id]?(delete this.curRois[t.id],i=[]):i=[t]:i=[],this.curRois=Object.assign({},e&&this.curRois,...i.map(t=>({[t.id]:t}))),this.slice.roilist.forEach(t=>{this.curRois[t.id]&&this.$set(t,"path",this.curRois[t.id].path)})},draw(t){t.id=(Math.random()+"").substr(2,6),this.slice.roilist=[...this.slice.roilist,t]},async delCurRoi(t){let e={};t?(e={[t.id]:t},this.curRois[t.id]&&(delete this.curRois[t.id],this.curRois=Object.assign({},this.curRois))):(e=this.curRois,await this.$confirm(this.$t("analaysisPanel.delete"),{confirmButtonText:this.$t("confirm.confirm"),cancelButtonText:this.$t("confirm.quit"),type:"warning"}),this.curRois={}),this.slice.roilist=this.slice.roilist.filter(t=>!e[t.id])},getAlgorithmResult(t=this.record.id,e=this.slice.id,i=this.slice.filename){Object(s.b)("ai/getresult",{caseid:t,fileid:e,filename:i,type:"mucosa",other:""}).then(t=>{this.lineup=t.data.rank,t.data.done?(this.showbutton=!0,this.loopHandler=0,this.slice.sentinelnode&&(this.$set(this.slice,"type","sentinelnode"),this.$set(this.slice.sentinelnode,"diagnosis",t.data.result.flag),this.updateRecord())):(this.showbutton=!1,this.loopHandler=setTimeout(()=>this.getAlgorithmResult(),5e3))})},startAnalyze(t=this.record.id,e=this.slice.id,i=this.slice.filename){this.slice.sentinelnode={},this.$set(this.slice.sentinelnode,"diagnosis",null),this.slice.started=!0,this.record.started=!0,this.showbutton=!1,this.auto=!0,Object(s.b)("ai/start",{caseid:t,fileid:e,filename:i,type:"mucosa",other:""}).then(t=>{this.getAlgorithmResult()}).catch(t=>console.log(t)),this.updateRecord()},canceltesk(){Object(s.b)("ai/revokeTask",{caseid:this.record.id,fileid:this.slice.id,type:"mucosa",other:""}).then(t=>{0==t.code&&(clearTimeout(this.loopHandler),this.loopHandler=0,this.showbutton=!0,this.slice.started=!1,this.record.started=!1,this.updateRecord())}).catch(t=>console.log(t))},updateRecord(){this.$emit("save","auto")},keydown(t){"Delete"!=t.key&&"Backspace"!=t.key||!Object.keys(this.curRois).length||this.delCurRoi()}},mounted(){this.slice.started&&this.slice.sentinelnode&&null===this.slice.sentinelnode.diagnosis&&this.getAlgorithmResult(),window.addEventListener("online",()=>{this.showbutton||this.getAlgorithmResult()})},beforeDestroy(){clearTimeout(this.loopHandler),this.loopHandler=0},watch:{"slice.id":{handler(){clearTimeout(this.loopHandler),this.loopHandler=0}},drawMpp:{handler(t){t&&(this.$set(this.slice,"mppx",t),this.$set(this.slice,"mppy",t),this.$emit("save","auto"),this.startAnalyze())}}},props:["slice","record"],components:{"v-dragon":v.a,"v-roi":m}},fi={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"cnt"},[i("div",{staticClass:"analyright",attrs:{tabIndex:0},on:{keydown:t.keydown}},[i("v-dragon",{staticClass:"dragon",attrs:{record:t.record,slice:t.slice,roilist:[].concat(this.slice.roilist.map(function(t){return Object.assign({method:"rectangle"},t,{color:"yellow"})})),curRois:t.curRois,penColor:"yellow",centerRegion:t.centerRegion,position:t.position,showMppGuide:t.showMppGuide},on:{curROI:t.curROIChange,draw:t.draw,delRoi:function(e){return t.delCurRoi(e)},position:function(e,i,s){t.$set(t.position,"offx",e),t.$set(t.position,"offy",i),t.$set(t.position,"zoom",s),t.$set(t.slice,"position",t.position)},closeMppGuide:function(e){t.showMppGuide=!1},changeMpp:function(e){return t.drawMpp=e}}}),t._v(" "),t.showbutton?i("button",{on:{click:function(e){return t.isDrawMpp()}}},[t._v(t._s(t.$t("slice.start")))]):t._e()],1),t._v(" "),i("div",{staticClass:"analylist"},[i("h2",[i("span",{class:1==t.auto?"auto":"",on:{click:function(e){t.auto=!0}}},[t._v(t._s(t.$t("analyze.airoi")))]),t._v(" "),i("span",{class:0==t.auto?"noauto":"",on:{click:function(e){t.auto=!1}}},[t._v(t._s(t.$t("analyze.roi")))])]),t._v(" "),t.auto&&this.slice.sentinelnode?i("v-roi",{staticClass:"automanualroi",attrs:{roilist:[],currentRois:t.curRois},on:{curROI:function(e,i){return t.curROIChange(e,i)+t.listChangeCurrent()},delRoi:function(e){return t.delCurRoi(e)}}}):t._e(),t._v(" "),t.auto?t._e():i("v-roi",{staticClass:"manualroi",attrs:{roilist:t.slice.roilist,currentRois:t.curRois},on:{curROI:function(e,i){return t.curROIChange(e,i)+t.listChangeCurrent()},delRoi:function(e){return t.delCurRoi(e)}}}),t._v(" "),!t.showbutton&&t.auto?i("div",{staticClass:"loding"},[i("div",{staticClass:"video"},[i("img",{attrs:{src:"/static/video/loading.gif"}}),t._v(" "),0==t.lineup?i("div",{staticClass:"lineup"},[t._v("正在处理...")]):t._e(),t._v(" "),t.lineup>0?i("div",{staticClass:"lineup"},[t._v(t._s(t.$t("slice.lineup"))+" "),i("span",{staticStyle:{color:"#4C9FFA","font-size":"18px","font-weight":"bolder"}},[t._v(t._s(t.lineup))]),t._v(" "+t._s(t.$t("slice.position")))]):t._e()]),t._v(" "),i("div",{staticClass:"cancel",on:{click:t.canceltesk}},[t._v(t._s(t.$t("slice.cancelTasks")))])]):t._e(),t._v(" "),!t.slice.sentinelnode&&t.auto?i("div",{staticClass:"ifshowtables"},[t._v(t._s(t.$t("slice.noanalysis")))]):t._e(),t._v(" "),t.slice.sentinelnode&&t.auto?i("div",{staticClass:"tctbtm"},[i("div",{staticClass:"AiResult"},[i("div",[t._v("\n                    "+t._s(t.$t("slice.AiResult"))+"\n                ")]),t._v(" "),i("div",[t._v("\n                    U\n                ")])]),t._v(" "),i("div",{staticClass:"confidence"},[i("div",[t._v(t._s(t.$t("slice.confidence")))]),t._v(" "),t._m(0)]),t._v(" "),i("div",{staticClass:"interactive"},[i("div",[t._v(t._s(t.$t("slice.interaction")))]),t._v(" "),i("el-radio-group",{staticClass:"radios",model:{value:t.slice.company,callback:function(e){t.$set(t.slice,"company",e)},expression:"slice.company"}},[i("el-radio",{attrs:{label:!0}},[t._v("YES")]),t._v(" "),i("el-radio",{attrs:{label:!1}},[t._v("NO")]),t._v(" "),i("el-radio",{attrs:{label:"unsure"}},[t._v("UNSURE")])],1)],1)]):t._e(),t._v(" "),0==t.auto?i("div",{staticClass:"opinio"},[i("h1",[t._v("\n                "+t._s(t.$t("analyze.point"))+"\n            ")]),t._v(" "),i("textarea",{directives:[{name:"model",rawName:"v-model",value:t.record.opinion,expression:"record.opinion"}],attrs:{placeholder:t.$t("report.pointremind"),maxlength:"300"},domProps:{value:t.record.opinion},on:{input:[function(e){e.target.composing||t.$set(t.record,"opinion",e.target.value)},t.noEmoji]}})]):t._e()],1)])},staticRenderFns:[function(){var t=this.$createElement,e=this._self._c||t;return e("div",[e("div",[this._v("100%")])])}]};var mi=i("VU/8")(gi,fi,!1,function(t){i("RrJT"),i("9MxB")},"data-v-2fd80da8",null).exports,_i={data:()=>({}),methods:{changearea:t=>(t/1e6).toFixed(2),checkall(){let t=this.roilist.every(t=>!!t.image);this.roilist.forEach(e=>this.$set(e,"image",t?0:1)),this.$emit("closecontextmenu")},del(t){this.$confirm(this.$t("analaysisPanel.delete"),{confirmButtonText:this.$t("confirm.confirm"),cancelButtonText:this.$t("confirm.quit"),type:"warning"}).then(()=>this.$emit("delRoi",t),t=>t)},noEmoji(t){t.target.value=t.target.value.replace(/[^\u0020-\u007E\u00A0-\u00BE\u2E80-\uA4CF\uF900-\uFAFF\uFE30-\uFE4F\uFF00-\uFFEF\u0080-\u009F\u2000-\u201f\u2026\u2022\u20ac\r\n]/g,"")}},props:["roilist","currentRois","startLearn","record"]},yi={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"roi"},[t.startLearn?t._e():i("div",{staticClass:"top"},[i("div",{staticClass:"left"},[i("div",[i("span",{staticClass:"uncheck",class:{checked:!!t.roilist.length&&t.roilist.every(function(t){return!!t.image})},on:{click:t.checkall}}),t._v("\n                ROI\n            ")])]),t._v(" "),i("div",{staticClass:"center"},[t._v("\n            "+t._s(t.$t("slice.remark"))+"\n        ")]),t._v(" "),t._m(0),t._v(" "),i("div",{staticClass:"right"},[t._v("\n            "+t._s(t.$t("analyze.opration"))+"\n        ")])]),t._v(" "),t.startLearn?i("div",{staticClass:"startlearn"},[i("div",{staticClass:"learning"},[t._v("\n            训练中...\n        ")])]):i("div",{staticClass:"rois"},t._l(t.roilist,function(e,s){return i("div",{key:s,staticClass:"row",class:{curRoi:t.currentRois[e.id]},on:{click:function(i){t.$emit("curROI",e,i.shiftKey),t.$emit("closecontextmenu")}}},[i("div",{staticClass:"left"},[i("div",[i("span",{staticClass:"uncheck",class:{checked:e.image},on:{click:function(i){i.stopPropagation(),t.$set(e,"image",1-(e.image||0)),t.$emit("closecontextmenu")}}}),t._v("\n                    "+t._s(s+1)+"\n                ")])]),t._v(" "),i("div",{staticClass:"center"},[i("input",{directives:[{name:"model",rawName:"v-model.lazy",value:e.remark,expression:"roi.remark",modifiers:{lazy:!0}}],attrs:{type:"text",placeholder:t.$t("slice.input"),maxlength:"300",title:e.remark},domProps:{value:e.remark},on:{keydown:function(e){if(!e.type.indexOf("key")&&t._k(e.keyCode,"delete",[8,46],e.key,["Backspace","Delete","Del"]))return null;e.stopPropagation()},input:t.noEmoji,change:function(i){return t.$set(e,"remark",i.target.value)}}})]),t._v(" "),i("div",{staticClass:"area"},[i("div",[t._v("\n                    "+t._s(e.area?t.changearea(e.area):"请输入...")+"\n                ")])]),t._v(" "),i("div",{staticClass:"right"},[i("em",{attrs:{title:t.$t("upload.delete")},on:{click:function(i){return i.stopPropagation(),t.del(e)}}})])])}),0)])},staticRenderFns:[function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"area area_top"},[this._v("\n            面积("),e("span",[this._v("mm"),e("sup",[this._v("2")])]),this._v(")\n        ")])}]};var Ri=i("VU/8")(_i,yi,!1,function(t){i("abTO")},"data-v-3aa27f03",null).exports,bi={data(){return{loopHandler:0,auto:"two",centerRegion:null,curRois:{},showbutton:!0,labeltree:[{id:"坏死区域",label:"坏死区域"},{id:"正常组织区域",label:"正常组织区域"}],liverAnno:null,position:{offx:this.slice.position?this.slice.position.offx:.5,offy:this.slice.position?this.slice.position.offy:.5*this.slice.height/this.slice.width,zoom:this.slice.position?this.slice.position.zoom:null},lineup:null,addAnnRoi:!1,RoiWidth:null,PatchWidth:null,pathseg:!0,getroi:!0,startLearn:!1,menuPosition:{},showMppGuide:!1,drawMpp:null}},computed:{getCommonAnnotation(){var t=Object.values(this.curRois);return t[0]&&t.every(t=>t.jgResult)&&t.every(e=>e.jgResult==t[0].jgResult)?t[0].jgResult.split(",")[0]:""},percentage(){return 0==(this.slice.liver.result.filter(t=>"normal"==t.type).map(t=>t.area).reduce((t,e)=>t+e,0)/1e6).toFixed(2)?"0%":((this.slice.liver.result.filter(t=>"abnormal"==t.type).map(t=>t.area).reduce((t,e)=>t+e,0)/1e6).toFixed(2)/((this.slice.liver.result.filter(t=>"normal"==t.type).map(t=>t.area).reduce((t,e)=>t+e,0)+this.slice.liver.result.filter(t=>"abnormal"==t.type).map(t=>t.area).reduce((t,e)=>t+e,0))/1e6).toFixed(2)).toFixed(2)+"%"}},methods:{isDrawMpp(){/\.(png|jpg|jpeg|tiff|tif|bmp)$/.test(this.slice.filename)?this.showMppGuide=!0:this.startAnalyze()},mouseDown(){this.liverAnno=null},listChangeCurrent(){var t=[].concat.apply([],Object.values(this.curRois).map(t=>t.path.x)),e=[].concat.apply([],Object.values(this.curRois).map(t=>t.path.y));t.length?this.centerRegion=[Math.min.apply(null,t),Math.min.apply(null,e),Math.max.apply(null,t),Math.max.apply(null,e)]:this.centerRegion=null},curROIChange(t,e){var i;t?t.length?i=t:e&&this.curRois[t.id]?(delete this.curRois[t.id],i=[]):i=[t]:i=[],this.curRois=Object.assign({},e&&this.curRois,...i.map(t=>({[t.id]:t})))},clickDraw(t,e){var i=10,s=t.x,n=t.y,a={id:(Math.random()+"").substr(2,9),path:{x:[s-i,s+i,s+i,s-i],y:[n-i,n-i,n+i,n+i]},width:2,method:"rectangle"};this.slice.roilist=[...this.slice.roilist,a],this.curROIChange(a,e)},getArea(t){for(var e=0,i=0;i<t.x.length-2;i++){if(i+2<t.x.length)var s=[t.x[0],t.y[0]],n=[t.x[i+1],t.y[i+1]],a=[t.x[i+2],t.y[i+2]];e+=(Math.abs(s[0]*n[1])+Math.abs(n[0]*a[1])+Math.abs(a[0]*s[1])-Math.abs(s[0]*a[1])-Math.abs(n[0]*s[1])-Math.abs(a[0]*n[1]))/2}return e=Math.round(Math.abs(e)*Math.pow(this.slice.mppx||.49,2))},draw(t){t.id=(Math.random()+"").substr(2,9),t.area=this.getArea(t.path),"freepen"===t.method&&(t.simplify=5),this.slice.roilist=[...this.slice.roilist,t]},clearSimplify(t){this.$set(this.slice,"roilist",this.slice.roilist.map(e=>(e.id===t.id&&(e.path.x=t.x,e.path.y=t.y,e.simplify&&delete e.simplify),e)))},async delCurRoi(t){let e={};t?(e={[t.id]:t},this.curRois[t.id]&&(delete this.curRois[t.id],this.curRois=Object.assign({},this.curRois))):(e=this.curRois,await this.$confirm(this.$t("analaysisPanel.delete"),{confirmButtonText:this.$t("confirm.confirm"),cancelButtonText:this.$t("confirm.quit"),type:"warning"}),this.curRois={}),this.slice.liver&&(this.slice.liver.result=this.slice.liver.result.filter(t=>!e[t.id])),this.slice.roilist=this.slice.roilist.filter(t=>!e[t.id]),this.liverAnno=null},roiChanged(){for(var t in this.curRois)this.curRois[t]=Object.assign({},this.curRois[t]);var e=Object.assign({},this.curRois);this.$set(this.slice,"roilist",this.slice.roilist.map(t=>{var i=e[t.id];return i?(delete e[t.id],i):t}).concat(Object.values(e))),this.slice.liver&&(this.slice.liver.result=this.slice.liver.result.filter(t=>!this.curRois[t.id]))},checkjgResult:t=>t.jgResult?t.jgResult.split(",")[1]:"",setAnnotation(t){var e;for(var i in e="string"!=typeof t?t[0]+","+t[1]:t,this.liverAnno=null,this.curRois){let t=this.curRois[i];this.curRois[i]=Object.assign({},t,{jgResult:e,remark:e.split(",")[e.split(",").length-1]})}var s=Object.assign({},this.curRois);this.$set(this.slice,"roilist",this.slice.roilist.map(t=>{var e=s[t.id];return e?(delete s[t.id],e):t}).concat(Object.values(s))),this.slice.liver&&(this.slice.liver.result=this.slice.liver.result.filter(t=>!this.curRois[t.id]))},showMenu(t,e){if((!t.type||t.button)&&(this.showleft=!1,this.showlivertop=!1,t.preventDefault(),0!=Object.keys(this.curRois).length&&!Object.keys(this.curRois).every(t=>t!=e.id))){var i=t.currentTarget,s=t.offsetX,n=t.offsetY,a=i.offsetWidth,o=i.offsetHeight;this.liverAnno={},this.liverAnno.hd=s>a/2?"right":"left",this.liverAnno.vd=n>o/2?"bottom":"top",this.menuPosition={x:s,y:n}}},getAlgorithmResult(t=this.record.id,e=this.slice.id,i=this.slice.filename){Object(s.b)("ai/getresult",{caseid:t,fileid:e,filename:i,type:"hepatonecrosis",other:""}).then(t=>{if(this.lineup=t.data.rank,t.data.done){if(this.showbutton=!0,this.loopHandler=0,this.slice.liver&&0==this.slice.liver.result.length){if(-1==t.data.rank)if(0==Object.keys(t.data.result).length)this.$set(this.slice.liver,"diagnosis","U");else{var e=t.data.result[-1].abnormal_region&&t.data.result[-1].abnormal_region.map(t=>({id:(Math.random()+"").substr(2,9),editable:!1,path:{x:t.x,y:t.y},type:"abnormal",area:this.getArea({x:t.x,y:t.y}),remark:"坏死区域"})),i=t.data.result[-1].normal_region&&t.data.result[-1].normal_region.map(t=>({id:(Math.random()+"").substr(2,9),editable:!1,path:{x:t.x,y:t.y},type:"normal",area:this.getArea({x:t.x,y:t.y}),remark:"正常区域"})),s=e.concat(...i);this.$set(this.slice.liver,"result",s),this.$set(this.slice.liver,"diagnosis","U")}else this.$set(this.slice.liver,"diagnosis","U");this.$set(this.slice,"type","hepatonecrosis"),this.updateRecord()}}else this.showbutton=!1,this.loopHandler=setTimeout(()=>{this.getAlgorithmResult()},5e3)})},startAnalyze(t=this.record.id,e=this.slice.id,i=this.slice.filename){this.$set(this.slice,"liver",{}),this.$set(this.slice.liver,"result",[]),this.slice.started=!0,this.record.started=!0,this.$set(this.slice.liver,"diagnosis",null),this.showbutton=!1,Object.values(this.curRois).map(t=>this.slice.roilist.every(e=>t.id!=e.id)&&this.slice.liver.result.every(e=>t.id!=e.id)?delete this.curRois[t.id]:""),Object(s.b)("ai/start",{caseid:t,fileid:e,filename:i,type:"hepatonecrosis",other:""}).then(t=>{this.getAlgorithmResult(),this.slice.liver.taskid=t.data.task_id}).catch(t=>console.log(t)),this.updateRecord()},canceltesk(){Object(s.b)("ai/revokeTask",{caseid:this.record.id,fileid:this.slice.id,type:"hepatonecrosis",other:""}).then(t=>{0==t.code&&(clearTimeout(this.loopHandler),this.loopHandler=0,this.showbutton=!0,this.slice.started=!1,this.record.started=!1,this.updateRecord())}).catch(t=>console.log(t))},updateRecord(){this.$emit("save","auto")},keydown(t){"Delete"!=t.key&&"Backspace"!=t.key||!Object.keys(this.curRois).length||this.delCurRoi()},PathSeg(){this.pathseg=!1,Object(s.b)("script/cutwsi",{caseid:this.record.id,fileid:this.slice.id,filename:this.slice.filename,size:this.PatchWidth||1024}).then(t=>{console.log(t)}).catch(t=>{console.log(t)})},GetRoi(){this.getroi=!1,Object(s.b)("script/extractAnnots",{caseid:this.record.id,fileid:this.slice.id,filename:this.slice.filename,size:this.RoiWidth||1024}).then(t=>{console.log(t)}).catch(t=>{console.log(t)})},stoplearn(){this.startLearn=!this.startLearn,Object(s.b)("ai/train",{}).then(t=>{console.log(t)})},startlearn(){this.startLearn=!this.startLearn,Object(s.b)("ai/stopTrain",{}).then(t=>{console.log(t)})}},mounted(){this.slice.started&&this.slice.liver&&null===this.slice.liver.diagnosis&&this.getAlgorithmResult(),window.addEventListener("online",()=>{this.showbutton||this.getAlgorithmResult()})},watch:{"slice.id":{handler(){clearTimeout(this.loopHandler),this.loopHandler=0}},"slice.roilist":{handler(t){t.length>300&&(this.addAnnRoi=!0,setTimeout(()=>this.addAnnRoi=!1,2500),Object.values(this.curRois).map(t=>delete this.curRois[t.id]),t.pop())}},drawMpp:{handler(t){t&&(this.$set(this.slice,"mppx",t),this.$set(this.slice,"mppy",t),this.$emit("save","auto"),this.startAnalyze())}}},beforeDestroy(){clearTimeout(this.loopHandler),this.loopHandler=0},props:["slice","record"],components:{"v-menus":Ct,"v-dragon":v.a,"v-analyroi":Ri}},Ci={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"cnt",staticStyle:{width:"100%"}},[i("div",{ref:"osd",staticClass:"analyright",attrs:{tabIndex:0},on:{mousewheel:function(e){t.liverAnno=null},keydown:t.keydown}},[i("v-dragon",{staticClass:"dragon",attrs:{record:t.record,slice:t.slice,roilist:this.slice.roilist.map(function(e){return Object.assign({method:"rectangle"},e,{color:{"坏死区域":"red","正常组织区域":"green"}[t.checkjgResult(e)]})}).concat((this.slice.liver?this.slice.liver.result:[]).map(function(t){return Object.assign({},t,{color:{abnormal:"red",normal:"green"}[t.type],method:"rectangle",editable:!1})})),penColor:"yellow",curRois:t.curRois,centerRegion:t.centerRegion,position:t.position,showMppGuide:t.showMppGuide},on:{curROI:t.curROIChange,draw:t.draw,delRoi:function(e){return t.delCurRoi(e)},contextmenu:function(e,i){return t.showMenu(e,i)},roiChanged:t.roiChanged,mousedown:t.mouseDown,position:function(e,i,s){t.$set(t.position,"offx",e),t.$set(t.position,"offy",i),t.$set(t.position,"zoom",s),t.$set(t.slice,"position",t.position)},closeMppGuide:function(e){t.showMppGuide=!1},changeMpp:function(e){return t.drawMpp=e},clearSimplify:t.clearSimplify}},[t.liverAnno?i("div",{staticStyle:{position:"absolute"},style:{left:t.menuPosition.x+5+"px",top:t.menuPosition.y+5+"px"}},[i("v-menus",{attrs:{pos:t.liverAnno,menus:t.labeltree,currentItem:t.getCommonAnnotation},on:{chosen:t.setAnnotation}})],1):t._e(),t._v(" "),t.addAnnRoi?i("div",{staticClass:"addannroi"},[t._v("标注roi数量不能超出300个")]):t._e()]),t._v(" "),t.showbutton&&!t.startLearn?i("button",{on:{click:function(e){return t.isDrawMpp()}}},[t._v(t._s(t.$t("slice.start")))]):t._e()],1),t._v(" "),i("div",{staticClass:"analylist",on:{click:function(e){t.liverAnno=null}}},[i("h2",[i("span",{class:"one"==t.auto?"auto":"",on:{click:function(e){t.auto="one"}}},[t._v(t._s(t.$t("analyze.airoi")))]),t._v(" "),i("span",{class:"two"==t.auto?"auto":"",on:{click:function(e){t.auto="two"}}},[t._v("训练ROI")])]),t._v(" "),this.slice.liver&&"one"==t.auto?i("v-analyroi",{staticClass:"automanualroi",attrs:{roilist:this.slice.liver?this.slice.liver.result:[],currentRois:t.curRois},on:{curROI:function(e,i){return t.curROIChange(e,i)+t.listChangeCurrent()},delRoi:function(e){return t.delCurRoi(e)},closecontextmenu:function(e){t.liverAnno=null}}}):t._e(),t._v(" "),"two"==t.auto?i("v-analyroi",{staticClass:"manualroi",attrs:{roilist:t.slice.roilist,currentRois:t.curRois,startLearn:t.startLearn,record:t.record},on:{curROI:function(e,i){return t.curROIChange(e,i)+t.listChangeCurrent()},delRoi:function(e){return t.delCurRoi(e)},closecontextmenu:function(e){t.liverAnno=null}}}):t._e(),t._v(" "),t.showbutton||"one"!=t.auto?t._e():i("div",{staticClass:"loding"},[i("div",{staticClass:"video"},[i("img",{attrs:{src:"/static/video/loading.gif"}}),t._v(" "),0==t.lineup?i("div",{staticClass:"lineup"},[t._v("正在处理...")]):t._e(),t._v(" "),t.lineup>0?i("div",{staticClass:"lineup"},[t._v(t._s(t.$t("slice.lineup"))+" "),i("span",{staticStyle:{color:"#4C9FFA","font-size":"18px","font-weight":"bolder"}},[t._v(t._s(t.lineup))]),t._v(" "+t._s(t.$t("slice.position")))]):t._e()]),t._v(" "),i("div",{staticClass:"cancel",on:{click:t.canceltesk}},[t._v(t._s(t.$t("slice.cancelTasks")))])]),t._v(" "),this.slice.liver||"one"!=t.auto?t._e():i("div",{staticClass:"ifshowtables"},[t._v(t._s(t.$t("slice.noanalysis")))]),t._v(" "),this.slice.liver&&"one"==t.auto?i("div",{staticClass:"liverbtm"},[i("div",{staticClass:"AiResult"},[i("div",[t._v(t._s(t.$t("slice.AiResult")))]),t._v(" "),i("div",[t._v("坏死区域面积:  "+t._s(this.slice.liver.result.length?(this.slice.liver.result.filter(function(t){return"abnormal"==t.type}).map(function(t){return t.area}).reduce(function(t,e){return t+e},0)/1e6).toFixed(2):0)+"  "),t._m(0)]),t._v(" "),i("div",[t._v("正常区域面积:  "+t._s(this.slice.liver.result.length?(this.slice.liver.result.filter(function(t){return"normal"==t.type}).map(function(t){return t.area}).reduce(function(t,e){return t+e},0)/1e6).toFixed(2):0)+"  "),t._m(1)]),t._v(" "),i("div",[t._v("\n                    坏死区域面积/总面积:  "+t._s(t.percentage))])]),t._v(" "),i("div",{staticClass:"confidence"},[i("div",[t._v(t._s(t.$t("slice.confidence")))]),t._v(" "),t._m(2)]),t._v(" "),i("div",{staticClass:"interactive"},[i("div",[t._v(t._s(t.$t("slice.interaction")))]),t._v(" "),i("el-radio-group",{staticClass:"radios",model:{value:t.slice.liver.computer,callback:function(e){t.$set(t.slice.liver,"computer",e)},expression:"slice.liver.computer"}},[i("el-radio",{attrs:{label:!0}},[t._v("YES")]),t._v(" "),i("el-radio",{attrs:{label:!1}},[t._v("NO")]),t._v(" "),i("el-radio",{attrs:{label:"unsure"}},[t._v("UNSURE")])],1)],1)]):t._e(),t._v(" "),"two"==t.auto?i("div",{staticClass:"translate"},[i("button",{class:t.startLearn?"stop":"",on:{click:function(e){t.startLearn?t.startlearn():t.stoplearn()}}},[t._v(t._s(t.startLearn?"终止训练":"开始训练"))])]):t._e()],1)])},staticRenderFns:[function(){var t=this.$createElement,e=this._self._c||t;return e("span",[this._v("mm"),e("sup",{staticStyle:{"font-size":"12px"}},[this._v("2")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("span",[this._v("mm"),e("sup",{staticStyle:{"font-size":"12px"}},[this._v("2")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",[e("div",[this._v("100%")])])}]};var wi=i("VU/8")(bi,Ci,!1,function(t){i("GOFS"),i("PkV4")},"data-v-213046b1",null).exports,ki={data:()=>({}),methods:{changearea:t=>(t/1e6).toFixed(2),checkall(){let t=this.roilist.every(t=>!!t.image);this.roilist.forEach(e=>this.$set(e,"image",t?0:1))},del(t){this.$confirm(this.$t("analaysisPanel.delete"),{confirmButtonText:this.$t("confirm.confirm"),cancelButtonText:this.$t("confirm.quit"),type:"warning"}).then(()=>this.$emit("delRoi",t),t=>t)},noEmoji(t){t.target.value=t.target.value.replace(/[^\u0020-\u007E\u00A0-\u00BE\u2E80-\uA4CF\uF900-\uFAFF\uFE30-\uFE4F\uFF00-\uFFEF\u0080-\u009F\u2000-\u201f\u2026\u2022\u20ac\r\n]/g,"")}},props:["roilist","currentRois","record"]},xi={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"roi"},[i("div",{staticClass:"top"},[i("div",{staticClass:"left"},[i("div",[i("span",{staticClass:"uncheck",class:{checked:!!t.roilist.length&&t.roilist.every(function(t){return!!t.image})},on:{click:t.checkall}}),t._v("\n                ROI\n            ")])]),t._v(" "),i("div",{staticClass:"center"},[t._v("\n            "+t._s(t.$t("slice.remark"))+"\n        ")]),t._v(" "),t._m(0),t._v(" "),i("div",{staticClass:"right"},[t._v("\n            "+t._s(t.$t("analyze.opration"))+"\n        ")])]),t._v(" "),i("div",{staticClass:"rois"},t._l(t.roilist,function(e,s){return i("div",{key:s,staticClass:"row",class:{curRoi:t.currentRois[e.id]},on:{click:function(i){t.$emit("curROI",e,i.shiftKey),t.$emit("closecontextmenu")}}},[i("div",{staticClass:"left"},[i("div",[i("span",{staticClass:"uncheck",class:{checked:e.image},on:{click:function(i){i.stopPropagation(),t.$set(e,"image",1-(e.image||0)),t.$emit("closecontextmenu")}}}),t._v("\n                    "+t._s(s+1)+"\n                ")])]),t._v(" "),i("div",{staticClass:"center"},[i("input",{directives:[{name:"model",rawName:"v-model.lazy",value:e.remark,expression:"roi.remark",modifiers:{lazy:!0}}],attrs:{type:"text",placeholder:t.$t("slice.input"),maxlength:"300",title:e.remark},domProps:{value:e.remark},on:{keydown:function(e){if(!e.type.indexOf("key")&&t._k(e.keyCode,"delete",[8,46],e.key,["Backspace","Delete","Del"]))return null;e.stopPropagation()},input:t.noEmoji,change:function(i){return t.$set(e,"remark",i.target.value)}}})]),t._v(" "),i("div",{staticClass:"area"},[i("div",[t._v("\n                    "+t._s(e.area?t.changearea(e.area):"请输入...")+"\n                ")])]),t._v(" "),i("div",{staticClass:"right"},[i("em",{attrs:{title:t.$t("upload.delete")},on:{click:function(i){return i.stopPropagation(),t.del(e)}}})])])}),0)])},staticRenderFns:[function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"area area_top"},[this._v("\n            面积("),e("span",[this._v("mm"),e("sup",[this._v("2")])]),this._v(")\n        ")])}]};var $i=i("VU/8")(ki,xi,!1,function(t){i("kNmz")},"data-v-2da58ca1",null).exports,Ii={data(){return{loopHandler:0,auto:"one",centerRegion:null,curRois:{},showbutton:!0,position:{offx:this.slice.position?this.slice.position.offx:.5,offy:this.slice.position?this.slice.position.offy:.5*this.slice.height/this.slice.width,zoom:this.slice.position?this.slice.position.zoom:null},lineup:null,addAnnRoi:!1,RoiWidth:null,PatchWidth:null,pathseg:!0,getroi:!0,showMppGuide:!1,drawMpp:null}},computed:{getCommonAnnotation(){var t=Object.values(this.curRois);return t[0]&&t.every(t=>t.jgResult)&&t.every(e=>e.jgResult==t[0].jgResult)?t[0].jgResult.split(",")[0]:""},percentage(){return 0==(this.slice.liver.result.filter(t=>"normal"==t.type).map(t=>t.area).reduce((t,e)=>t+e,0)/1e6).toFixed(2)?"0%":((this.slice.liver.result.filter(t=>"abnormal"==t.type).map(t=>t.area).reduce((t,e)=>t+e,0)/1e6).toFixed(2)/((this.slice.liver.result.filter(t=>"normal"==t.type).map(t=>t.area).reduce((t,e)=>t+e,0)+this.slice.liver.result.filter(t=>"abnormal"==t.type).map(t=>t.area).reduce((t,e)=>t+e,0))/1e6).toFixed(2)).toFixed(2)+"%"}},methods:{isDrawMpp(){/\.(png|jpg|jpeg|tiff|tif|bmp)$/.test(this.slice.filename)?this.showMppGuide=!0:this.startAnalyze()},noEmoji(t){t.target.value=t.target.value.replace(/[^\u0020-\u007E\u00A0-\u00BE\u2E80-\uA4CF\uF900-\uFAFF\uFE30-\uFE4F\uFF00-\uFFEF\u0080-\u009F\u2000-\u201f\u2026\u2022\u20ac\r\n]/g,"")},listChangeCurrent(){var t=[].concat.apply([],Object.values(this.curRois).map(t=>t.path.x)),e=[].concat.apply([],Object.values(this.curRois).map(t=>t.path.y));t.length?this.centerRegion=[Math.min.apply(null,t),Math.min.apply(null,e),Math.max.apply(null,t),Math.max.apply(null,e)]:this.centerRegion=null},curROIChange(t,e){var i;t?t.length?i=t:e&&this.curRois[t.id]?(delete this.curRois[t.id],i=[]):i=[t]:i=[],this.curRois=Object.assign({},e&&this.curRois,...i.map(t=>({[t.id]:t})))},clickDraw(t,e){var i=10,s=t.x,n=t.y,a={id:(Math.random()+"").substr(2,9),path:{x:[s-i,s+i,s+i,s-i],y:[n-i,n-i,n+i,n+i]},width:2,method:"rectangle"};this.slice.roilist=[...this.slice.roilist,a],this.curROIChange(a,e)},getArea(t){for(var e=0,i=0;i<t.x.length-2;i++){if(i+2<t.x.length)var s=[t.x[0],t.y[0]],n=[t.x[i+1],t.y[i+1]],a=[t.x[i+2],t.y[i+2]];e+=(Math.abs(s[0]*n[1])+Math.abs(n[0]*a[1])+Math.abs(a[0]*s[1])-Math.abs(s[0]*a[1])-Math.abs(n[0]*s[1])-Math.abs(a[0]*n[1]))/2}return e=Math.round(Math.abs(e)*Math.pow(this.slice.mppx||.49,2))},draw(t){t.id=(Math.random()+"").substr(2,9),t.area=this.getArea(t.path),this.slice.roilist=[...this.slice.roilist,t]},async delCurRoi(t){let e={};t?(e={[t.id]:t},this.curRois[t.id]&&(delete this.curRois[t.id],this.curRois=Object.assign({},this.curRois))):(e=this.curRois,await this.$confirm(this.$t("analaysisPanel.delete"),{confirmButtonText:this.$t("confirm.confirm"),cancelButtonText:this.$t("confirm.quit"),type:"warning"}),this.curRois={}),this.slice.liver&&(this.slice.liver.result=this.slice.liver.result.filter(t=>!e[t.id])),this.slice.roilist=this.slice.roilist.filter(t=>!e[t.id])},roiChanged(){for(var t in this.curRois)this.curRois[t]=Object.assign({},this.curRois[t]);var e=Object.assign({},this.curRois);this.$set(this.slice,"roilist",this.slice.roilist.map(t=>{var i=e[t.id];return i?(delete e[t.id],i):t}).concat(Object.values(e))),this.slice.liver&&(this.slice.liver.result=this.slice.liver.result.filter(t=>!this.curRois[t.id]))},getAlgorithmResult(t=this.record.id,e=this.slice.id,i=this.slice.filename){Object(s.b)("ai/getresult",{caseid:t,fileid:e,filename:i,type:"hepatonecrosis",other:""}).then(t=>{if(this.lineup=t.data.rank,t.data.done){if(this.showbutton=!0,this.loopHandler=0,this.slice.liver&&0==this.slice.liver.result.length){if(-1==t.data.rank)if(0==Object.keys(t.data.result).length)this.$set(this.slice.liver,"diagnosis","U");else{var e=t.data.result[-1].abnormal_region&&t.data.result[-1].abnormal_region.map(t=>({id:(Math.random()+"").substr(2,9),editable:!1,path:{x:t.x,y:t.y},type:"abnormal",area:this.getArea({x:t.x,y:t.y}),remark:"坏死区域"})),i=t.data.result[-1].normal_region&&t.data.result[-1].normal_region.map(t=>({id:(Math.random()+"").substr(2,9),editable:!1,path:{x:t.x,y:t.y},type:"normal",area:this.getArea({x:t.x,y:t.y}),remark:"正常区域"})),s=e.concat(...i);this.$set(this.slice.liver,"result",s),this.$set(this.slice.liver,"diagnosis","U")}else this.$set(this.slice.liver,"diagnosis","U");this.$set(this.slice,"type","liver"),this.updateRecord()}}else this.showbutton=!1,this.loopHandler=setTimeout(()=>{this.getAlgorithmResult()},5e3)})},startAnalyze(t=this.record.id,e=this.slice.id,i=this.slice.filename){this.$set(this.slice,"liver",{}),this.$set(this.slice.liver,"result",[]),this.slice.started=!0,this.record.started=!0,this.$set(this.slice.liver,"diagnosis",null),this.showbutton=!1,Object.values(this.curRois).map(t=>this.slice.roilist.every(e=>t.id!=e.id)&&this.slice.liver.result.every(e=>t.id!=e.id)?delete this.curRois[t.id]:""),Object(s.b)("ai/start",{caseid:t,fileid:e,filename:i,type:"hepatonecrosis",other:""}).then(t=>{this.getAlgorithmResult()}).catch(t=>console.log(t)),this.updateRecord()},canceltesk(){Object(s.b)("ai/revokeTask",{caseid:this.record.id,fileid:this.slice.id,type:"hepatonecrosis",other:""}).then(t=>{0==t.code&&(clearTimeout(this.loopHandler),this.loopHandler=0,this.showbutton=!0,this.slice.started=!1,this.record.started=!1,this.updateRecord())}).catch(t=>console.log(t))},updateRecord(){this.$emit("save","auto")},keydown(t){"Delete"!=t.key&&"Backspace"!=t.key||!Object.keys(this.curRois).length||this.delCurRoi()},PathSeg(){this.pathseg=!1,Object(s.b)("script/cutwsi",{caseid:this.record.id,fileid:this.slice.id,filename:this.slice.filename,size:this.PatchWidth||1024}).then(t=>{console.log(t)}).catch(t=>{console.log(t)})},GetRoi(){this.getroi=!1,Object(s.b)("script/extractAnnots",{caseid:this.record.id,fileid:this.slice.id,filename:this.slice.filename,size:this.RoiWidth||1024}).then(t=>{console.log(t)}).catch(t=>{console.log(t)})}},mounted(){this.slice.started&&this.slice.liver&&null===this.slice.liver.diagnosis&&this.getAlgorithmResult(),window.addEventListener("online",()=>{this.showbutton||this.getAlgorithmResult()})},watch:{"slice.id":{handler(){clearTimeout(this.loopHandler),this.loopHandler=0}},"slice.roilist":{handler(t){t.length>300&&(this.addAnnRoi=!0,setTimeout(()=>this.addAnnRoi=!1,2500),Object.values(this.curRois).map(t=>delete this.curRois[t.id]),t.pop())}},drawMpp:{handler(t){t&&(this.$set(this.slice,"mppx",t),this.$set(this.slice,"mppy",t),this.$emit("save","auto"),this.startAnalyze())}}},beforeDestroy(){clearTimeout(this.loopHandler),this.loopHandler=0},props:["slice","record"],components:{"v-menus":Ct,"v-dragon":v.a,"v-analyroi":$i}},Oi={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"cnt",staticStyle:{width:"100%"}},[i("div",{ref:"osd",staticClass:"analyright",attrs:{tabIndex:0},on:{keydown:t.keydown}},[i("v-dragon",{staticClass:"dragon",attrs:{record:t.record,slice:t.slice,roilist:this.slice.roilist.map(function(t){return Object.assign({method:"rectangle"},t,{color:"yellow"})}).concat((this.slice.liver?this.slice.liver.result:[]).map(function(t){return Object.assign({},t,{color:{abnormal:"red",normal:"green"}[t.type],method:"rectangle",editable:!1})})),penColor:"yellow",curRois:t.curRois,centerRegion:t.centerRegion,position:t.position,showMppGuide:t.showMppGuide},on:{curROI:t.curROIChange,draw:t.draw,delRoi:function(e){return t.delCurRoi(e)},roiChanged:t.roiChanged,position:function(e,i,s){t.$set(t.position,"offx",e),t.$set(t.position,"offy",i),t.$set(t.position,"zoom",s),t.$set(t.slice,"position",t.position)},closeMppGuide:function(e){t.showMppGuide=!1},changeMpp:function(e){return t.drawMpp=e}}}),t._v(" "),t.showbutton?i("button",{on:{click:function(e){return t.isDrawMpp()}}},[t._v(t._s(t.$t("slice.start")))]):t._e()],1),t._v(" "),i("div",{staticClass:"analylist"},[i("h2",[i("span",{class:"one"==t.auto?"auto":"",on:{click:function(e){t.auto="one"}}},[t._v(t._s(t.$t("analyze.airoi")))]),t._v(" "),i("span",{class:"two"==t.auto?"auto":"",on:{click:function(e){t.auto="two"}}},[t._v("手工ROI")])]),t._v(" "),this.slice.liver&&"one"==t.auto?i("v-analyroi",{staticClass:"automanualroi",attrs:{roilist:this.slice.liver?this.slice.liver.result:[],currentRois:t.curRois},on:{curROI:function(e,i){return t.curROIChange(e,i)+t.listChangeCurrent()},delRoi:function(e){return t.delCurRoi(e)}}}):t._e(),t._v(" "),"two"==t.auto?i("v-analyroi",{staticClass:"manualroi",attrs:{roilist:t.slice.roilist,currentRois:t.curRois,record:t.record},on:{curROI:function(e,i){return t.curROIChange(e,i)+t.listChangeCurrent()},delRoi:function(e){return t.delCurRoi(e)}}}):t._e(),t._v(" "),t.showbutton||"one"!=t.auto?t._e():i("div",{staticClass:"loding"},[i("div",{staticClass:"video"},[i("img",{attrs:{src:"/static/video/loading.gif"}}),t._v(" "),0==t.lineup?i("div",{staticClass:"lineup"},[t._v("正在处理...")]):t._e(),t._v(" "),t.lineup>0?i("div",{staticClass:"lineup"},[t._v(t._s(t.$t("slice.lineup"))+" "),i("span",{staticStyle:{color:"#4C9FFA","font-size":"18px","font-weight":"bolder"}},[t._v(t._s(t.lineup))]),t._v(" "+t._s(t.$t("slice.position")))]):t._e()]),t._v(" "),i("div",{staticClass:"cancel",on:{click:t.canceltesk}},[t._v(t._s(t.$t("slice.cancelTasks")))])]),t._v(" "),this.slice.liver||"one"!=t.auto?t._e():i("div",{staticClass:"ifshowtables"},[t._v(t._s(t.$t("slice.noanalysis")))]),t._v(" "),this.slice.liver&&"one"==t.auto?i("div",{staticClass:"liverbtm"},[i("div",{staticClass:"AiResult"},[i("div",[t._v(t._s(t.$t("slice.AiResult")))]),t._v(" "),i("div",[t._v("坏死区域面积:  "+t._s(this.slice.liver.result.length?(this.slice.liver.result.filter(function(t){return"abnormal"==t.type}).map(function(t){return t.area}).reduce(function(t,e){return t+e},0)/1e6).toFixed(2):0)+"  "),t._m(0)]),t._v(" "),i("div",[t._v("正常区域面积:  "+t._s(this.slice.liver.result.length?(this.slice.liver.result.filter(function(t){return"normal"==t.type}).map(function(t){return t.area}).reduce(function(t,e){return t+e},0)/1e6).toFixed(2):0)+"  "),t._m(1)]),t._v(" "),i("div",[t._v("\n                    坏死区域面积/总面积:  "+t._s(t.percentage))])]),t._v(" "),i("div",{staticClass:"confidence"},[i("div",[t._v(t._s(t.$t("slice.confidence")))]),t._v(" "),t._m(2)]),t._v(" "),i("div",{staticClass:"interactive"},[i("div",[t._v(t._s(t.$t("slice.interaction")))]),t._v(" "),i("el-radio-group",{staticClass:"radios",model:{value:t.slice.liver.computer,callback:function(e){t.$set(t.slice.liver,"computer",e)},expression:"slice.liver.computer"}},[i("el-radio",{attrs:{label:!0}},[t._v("YES")]),t._v(" "),i("el-radio",{attrs:{label:!1}},[t._v("NO")]),t._v(" "),i("el-radio",{attrs:{label:"unsure"}},[t._v("UNSURE")])],1)],1)]):t._e(),t._v(" "),"two"==t.auto?i("div",{staticClass:"opinio"},[i("h1",[t._v("\n                "+t._s(t.$t("analyze.point"))+"\n            ")]),t._v(" "),i("textarea",{directives:[{name:"model",rawName:"v-model",value:t.record.opinion,expression:"record.opinion"}],attrs:{placeholder:t.$t("report.pointremind"),maxlength:"300"},domProps:{value:t.record.opinion},on:{input:[function(e){e.target.composing||t.$set(t.record,"opinion",e.target.value)},t.noEmoji]}})]):t._e()],1)])},staticRenderFns:[function(){var t=this.$createElement,e=this._self._c||t;return e("span",[this._v("mm"),e("sup",{staticStyle:{"font-size":"12px"}},[this._v("2")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("span",[this._v("mm"),e("sup",{staticStyle:{"font-size":"12px"}},[this._v("2")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",[e("div",[this._v("100%")])])}]};var Ai=i("VU/8")(Ii,Oi,!1,function(t){i("Mliy"),i("UvJC")},"data-v-38335735",null).exports,Mi={data:()=>({}),methods:{reduceCount(t){return Object.keys(this.sRois).map(e=>Number(this.sRois[e][t].toFixed(1))).reduce((t,e)=>t+e,0)},checkall(){let t=this.ROIS.every(t=>!!t.image);this.ROIS.forEach(e=>this.$set(e,"image",!t))},change(t,e,i){this.$set(t,"image",i)},del(t){this.$confirm(this.$t("analaysisPanel.delete"),{confirmButtonText:this.$t("confirm.confirm"),cancelButtonText:this.$t("confirm.quit"),type:"warning"}).then(()=>{this.$emit("delRoi",t)},()=>{})}},props:["ROIS","currentRois","sRois","slice"]},Si={render:function(){var t=this,e=this,i=e.$createElement,s=e._self._c||i;return s("div",{staticClass:"ca-tctrois"},[e.ROIS.length?e._e():s("div",{staticClass:"ifshowtables"},[e._v(e._s(e.$t("slice.noanalysis")))]),e._v(" "),e.ROIS?s("div",{staticClass:"table"},[s("div",{staticClass:"top"},[s("div",{staticClass:"left"},[s("div",[s("span",{staticClass:"uncheck",class:{checked:e.ROIS.every(function(t){return!!t.image})},on:{click:e.checkall}}),e._v("\n                    ROI\n                ")])]),e._v(" "),s("div",{staticClass:"roicenter"},[e._v("详情")]),e._v(" "),s("div",[e._v(e._s(e.$t("slice.deleted")))])]),e._v(" "),s("div",{staticClass:"rois"},e._l(e.ROIS,function(t,i){return s("div",{key:i,staticClass:"row",class:{curRoi:e.currentRois[t.id]},on:{click:function(i){return e.$emit("curROI",t,i.shiftKey)}}},[s("div",{staticClass:"left"},[s("div",[s("span",{staticClass:"uncheck",class:{checked:t.image},on:{click:function(i){i.stopPropagation(),e.change(t,"image",1-(t.image||0))}}}),e._v(" "),s("span",{staticClass:"roidetails"},[e._v(e._s(i+1))])])]),e._v(" "),s("div",{staticClass:"roicenter"},[s("p",[e._v("血管周长："+e._s(e.sRois[t.id]?e.sRois[t.id].vessel_perimeter.toFixed(1):"0")+"μm")]),e._v(" "),s("p",[e._v("血管面积："+e._s(e.sRois[t.id]?e.sRois[t.id].vessel_area.toFixed(1):"0")+"μm²")]),e._v(" "),s("p",[e._v("血管个数："+e._s(e.sRois[t.id]?e.sRois[t.id].num_vessel:"0"))]),e._v(" "),s("p",[e._v("ROI面积："+e._s(e.sRois[t.id]?e.sRois[t.id].tumor_area.toFixed(1):"0")+"μm²")]),e._v(" "),s("p",[e._v("血管面积比："+e._s(e.sRois[t.id]?(100*e.sRois[t.id].vessel_tumor_ratio).toFixed(1):0)+"%")]),e._v(" "),s("p",[e._v("血管密度："+e._s(e.sRois[t.id]?(1e3*e.sRois[t.id].vessel_dense*1e3).toFixed(1):0)+"/mm²")])]),e._v(" "),s("div",[s("em",{attrs:{title:e.$t("upload.delete")},on:{click:function(i){return i.stopPropagation(),e.del(t)}}})])])}),0)]):e._e(),e._v(" "),e.sRois?s("div",{staticClass:"capbtm"},[s("h2",[e._v("处理结果")]),e._v(" "),s("div",{staticClass:"AiResult"},[s("p",[s("span",[e._v("总血管周长：")]),e._v(e._s(e.reduceCount("vessel_perimeter").toFixed(1))+"μm")]),e._v(" "),s("p",[s("span",[e._v("总血管面积：")]),e._v(e._s(e.reduceCount("vessel_area").toFixed(1))+"μm²")]),e._v(" "),s("p",[s("span",[e._v("总血管个数：")]),e._v(e._s(Object.keys(this.sRois).map(function(e){return Number(t.sRois[e].num_vessel)}).reduce(function(t,e){return t+e},0)))]),e._v(" "),s("p",[s("span",[e._v("ROI总面积：")]),e._v(e._s(e.reduceCount("tumor_area").toFixed(1))+"μm²")]),e._v(" "),s("p",[s("span",[e._v("总血管面积比：")]),e._v(e._s((e.reduceCount("vessel_area")/(e.reduceCount("tumor_area")||1)*100).toFixed(1))+"%")]),e._v(" "),s("p",[s("span",[e._v("总血管密度：")]),e._v(e._s((e.reduceCount("num_vessel")/(e.reduceCount("tumor_area")||1)*1e3*1e3).toFixed(1))+"/mm²")])])]):e._e()])},staticRenderFns:[]};var Ti=i("VU/8")(Mi,Si,!1,function(t){i("UWzv"),i("c4rj")},null,null).exports,Fi={data(){return{loopHandler:0,auto:!0,centerRegion:null,curRois:{},showbutton:!0,position:{offx:this.slice.position?this.slice.position.offx:.5,offy:this.slice.position?this.slice.position.offy:.5*this.slice.height/this.slice.width,zoom:this.slice.position?this.slice.position.zoom:null},lineup:null,totalArea:"",showLayer:!0,viewport:null}},methods:{addLayer(){Object.keys(this.slice.angiocarpy.airesult).map(t=>{let e="/aipath/api/ai/getResultImage?caseid="+this.record.id+"&fileid="+this.slice.id+"&type=angiocarpy&roiid="+t,i=new Image;i.style.pointerEvents="none",i.id=t;let s=this.slice.angiocarpy.airesult[t];if(!Object.keys(s).length)return;i.src=location.origin+e;let n=s.position[0]/this.slice.width,a=s.position[1]/this.slice.width,o=s.size[0]/this.slice.width,r=s.size[1]/this.slice.width;this.viewport.viewer.addOverlay({element:i,location:new OpenSeadragon.Rect(n,a,o,r)})})},noEmoji(t){t.target.value=t.target.value.replace(/[^\u0020-\u007E\u00A0-\u00BE\u2E80-\uA4CF\uF900-\uFAFF\uFE30-\uFE4F\uFF00-\uFFEF\u0080-\u009F\u2000-\u201f\u2026\u2022\u20ac\r\n]/g,"")},curROIChange(t,e){var i;!t||"grey"==t.color&&this.totalArea>5e5?(i=[],this.totalArea=0):t.length?i=t:e&&this.curRois[t.id]?(delete this.curRois[t.id],i=[]):i=[t],this.curRois=Object.assign({},e&&this.curRois,...i.map(t=>"grey"==t.color?{[t.id]:Object.assign({},t,{editable:!1})}:{[t.id]:t})),this.slice.roilist.forEach(t=>{this.curRois[t.id]&&this.$set(t,"path",this.curRois[t.id].path)})},listChangeCurrent(){var t=[].concat.apply([],Object.values(this.curRois).map(t=>t.path.x)),e=[].concat.apply([],Object.values(this.curRois).map(t=>t.path.y));t.length?this.centerRegion=[Math.min.apply(null,t),Math.min.apply(null,e),Math.max.apply(null,t),Math.max.apply(null,e)]:this.centerRegion=null},getArea(t){for(var e=0,i=0;i<t.x.length-2;i++){if(i+2<t.x.length)var s=[t.x[0],t.y[0]],n=[t.x[i+1],t.y[i+1]],a=[t.x[i+2],t.y[i+2]];e+=(Math.abs(s[0]*n[1])+Math.abs(n[0]*a[1])+Math.abs(a[0]*s[1])-Math.abs(s[0]*a[1])-Math.abs(n[0]*s[1])-Math.abs(a[0]*n[1]))/2}return e=Math.round(Math.abs(e)*Math.pow(this.slice.mppx||.242042,2))},draw(t){this.totalArea=this.getArea(t.path);for(var e=0;e<this.slice.angiocarpy.result.length;e++)this.totalArea+=this.getArea(this.slice.angiocarpy.result[e].path);if(t.id=(Math.random()+"").substr(2,6),this.auto){t=Object.assign({},t,{image:""});var i=[...this.slice.angiocarpy.result,t];this.$set(this.slice.angiocarpy,"result",i)}else this.slice.roilist=[...this.slice.roilist,t]},async delCurRoi(t){let e={};for(var i of(t?(e={[t.id]:t},this.curRois[t.id]&&(delete this.curRois[t.id],this.curRois=Object.assign({},this.curRois))):(e=this.curRois,await this.$confirm(this.$t("analaysisPanel.delete"),{confirmButtonText:this.$t("confirm.confirm"),cancelButtonText:this.$t("confirm.quit"),type:"warning"}),this.curRois={}),Object.keys(e)))this.slice.angiocarpy.result=this.slice.angiocarpy.result.filter(t=>t.id!=i),delete this.slice.angiocarpy.airesult[i],this.viewport.viewer.removeOverlay(i);this.slice.roilist=this.slice.roilist.filter(t=>!e[t.id])},getAlgorithmResult(t=this.record.id,e=this.slice.id,i=this.slice.filename){Object(s.b)("ai/getresult",{caseid:t,fileid:e,filename:i,type:"angiocarpy",other:JSON.stringify(this.slice.angiocarpy.result.map(t=>({id:t.id,x:t.path.x,y:t.path.y})))}).then(t=>{if(this.lineup=t.data.rank,t.data.done){if(this.showbutton=!0,this.loopHandler=0,this.$set(this.slice,"type","angiocarpy"),-1!=t.data.rank)this.flag="error",this.$set(this.slice.angiocarpy,"diagnosis","error");else{if(!t.data.result[-1]){Object.keys(t.data.result).filter(t=>!this.slice.angiocarpy.result.find(e=>e.id==t)).map(e=>delete t.data.result[e])}this.slice.angiocarpy.airesult=t.data.result,this.addLayer(),this.$set(this.slice.angiocarpy,"diagnosis",1)}this.updateRecord()}else this.showbutton=!1,this.loopHandler=setTimeout(()=>this.getAlgorithmResult(),5e3)})},startAnalyze(t=this.record.id,e=this.slice.id,i=this.slice.filename){this.$set(this.slice.angiocarpy,"airesult",{}),this.$set(this.slice.angiocarpy,"diagnosis",null),this.viewport.viewer.clearOverlays(),this.slice.started=!0,this.record.started=!0,this.showbutton=!1,this.auto=!0,this.slice.angiocarpy.result.map(t=>t.image=!0),Object(s.b)("ai/start",{caseid:t,fileid:e,filename:i,type:"angiocarpy",other:JSON.stringify(this.slice.angiocarpy.result.map(t=>({id:t.id,x:t.path.x,y:t.path.y})))}).then(t=>{this.getAlgorithmResult()}).catch(t=>console.log(t)),this.updateRecord()},canceltesk(){Object(s.b)("ai/revokeTask",{caseid:this.record.id,fileid:this.slice.id,type:"angiocarpy",other:""}).then(t=>{0==t.code&&(clearTimeout(this.loopHandler),this.loopHandler=0,this.showbutton=!0,this.slice.started=!1,this.record.started=!1,this.slice.angiocarpy.result.map(t=>t.image=!1),this.updateRecord())}).catch(t=>console.log(t))},updateRecord(){this.$emit("save","auto")},keydown(t){"Delete"!=t.key&&"Backspace"!=t.key||!Object.keys(this.curRois).length||this.delCurRoi()}},beforeMount(){this.slice.angiocarpy||(this.$set(this.slice,"angiocarpy",{}),this.$set(this.slice.angiocarpy,"result",[]),this.$set(this.slice.angiocarpy,"airesult",{})),this.slice.angiocarpy&&!this.slice.angiocarpy.airesult&&this.$set(this.slice.angiocarpy,"airesult",{})},mounted(){this.slice.started&&this.slice.angiocarpy&&null===this.slice.angiocarpy.diagnosis&&this.getAlgorithmResult(),window.addEventListener("online",()=>{this.showbutton||this.getAlgorithmResult()}),Object.keys(this.slice.angiocarpy.airesult).length&&this.addLayer()},beforeDestroy(){clearTimeout(this.loopHandler),this.loopHandler=0},watch:{"slice.id":{handler(){clearTimeout(this.loopHandler),this.loopHandler=0}},showLayer:{handler(t){t?Object.keys(this.slice.angiocarpy.airesult).length&&this.addLayer():this.viewport.viewer.clearOverlays()},deep:!0}},props:["slice","record"],components:{"v-dragon":v.a,"v-analyroi":Ti,"v-roi":m}},ji={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"cnt",attrs:{tabIndex:0},on:{keydown:t.keydown}},[i("div",{staticClass:"analyright"},[i("v-dragon",{staticClass:"dragon",attrs:{record:t.record,slice:t.slice,roilist:this.slice.roilist.map(function(t){return Object.assign({method:"rectangle"},t,{color:{"阳性肿瘤":"red"}[t.jgResult]||"yellow"})}).concat((this.slice.angiocarpy?this.slice.angiocarpy.result:[]).map(function(t){return Object.assign({method:"rectangle"},t,{editable:!1,selectable:!1,color:"grey"})})),curRois:t.curRois,penColor:t.auto?"grey":"yellow",centerRegion:t.centerRegion,position:t.position,showLayer:t.showLayer},on:{curROI:t.curROIChange,draw:t.draw,delRoi:function(e){return t.delCurRoi(e)},position:function(e,i,s){t.$set(t.position,"offx",e),t.$set(t.position,"offy",i),t.$set(t.position,"zoom",s),t.$set(t.slice,"position",t.position)},viewer:function(e){return t.viewport=e},changeShowLayer:function(e){return t.showLayer=e}}}),t._v(" "),t.showbutton?i("button",{on:{click:function(e){return t.startAnalyze()}}},[t._v(t._s(t.$t("slice.start")))]):t._e()],1),t._v(" "),i("div",{staticClass:"analylist"},[i("h2",[i("span",{class:t.auto?"auto":"",on:{click:function(e){t.auto=!0}}},[t._v(t._s(t.$t("analyze.airoi")))]),t._v(" "),i("span",{class:t.auto?"":"noauto",on:{click:function(e){t.auto=!1}}},[t._v(t._s(t.$t("analyze.roi")))])]),t._v(" "),t.auto?i("v-analyroi",{staticClass:"table",attrs:{slice:t.slice,ROIS:this.slice.angiocarpy?this.slice.angiocarpy.result:[],sRois:this.slice.angiocarpy?this.slice.angiocarpy.airesult:{},currentRois:t.curRois},on:{curROI:function(e,i){return t.curROIChange(e,i)+t.listChangeCurrent()},delRoi:function(e){return t.delCurRoi(e)}}}):t._e(),t._v(" "),t.auto?t._e():i("v-roi",{staticClass:"manualroi",attrs:{roilist:t.slice.roilist,currentRois:t.curRois},on:{curROI:function(e,i){return t.curROIChange(e,i)+t.listChangeCurrent()},delRoi:function(e){return t.delCurRoi(e)}}}),t._v(" "),!t.showbutton&&t.auto?i("div",{staticClass:"loding"},[i("div",{staticClass:"video"},[i("img",{attrs:{src:"/static/video/loading.gif"}}),t._v(" "),0==t.lineup?i("div",{staticClass:"lineup"},[t._v("正在处理...")]):t._e(),t._v(" "),t.lineup>0?i("div",{staticClass:"lineup"},[t._v(t._s(t.$t("slice.lineup"))+" "),i("span",{staticStyle:{color:"#4C9FFA","font-size":"18px","font-weight":"bolder"}},[t._v(t._s(t.lineup))]),t._v(" "+t._s(t.$t("slice.position")))]):t._e()]),t._v(" "),i("div",{staticClass:"cancel",on:{click:t.canceltesk}},[t._v(t._s(t.$t("slice.cancelTasks")))])]):t._e(),t._v(" "),0==t.auto?i("div",{staticClass:"opinio"},[i("h1",[t._v("\n                "+t._s(t.$t("analyze.point"))+"\n            ")]),t._v(" "),i("textarea",{directives:[{name:"model",rawName:"v-model",value:t.record.opinion,expression:"record.opinion"}],attrs:{placeholder:t.$t("report.pointremind"),maxlength:"300"},domProps:{value:t.record.opinion},on:{input:[function(e){e.target.composing||t.$set(t.record,"opinion",e.target.value)},t.noEmoji]}})]):t._e()],1)])},staticRenderFns:[]};var Ei=i("VU/8")(Fi,ji,!1,function(t){i("8FSm")},"data-v-43ecc665",null).exports,Pi=null,Di={name:"tree",data(){return{showOptions:!1,templates:[],cruTemplateId:this.templateId,groups:[],defaultProps:{children:"children",label:"label"},pageSize:100,pageIndex:1,tmDisplay:!1,hideAddSon:!1,rightMenu:{top:0,left:0},curGroup:{},rois:{},defaultExpandIds:[]}},methods:{strlen(t){for(var e=0,i=0;i<t.length;i++){var s=t.charCodeAt(i);s>=1&&s<=126||65376<=s&&s<=65439?e++:e+=2}return e},showEtc(t){if(t)return this.strlen(t)<24?t:t.includes(")")?t.slice(0,4)+"..."+t.slice(-7):t.slice(0,4)+"..."+t.slice(-4)},handleNodeExpand(t){let e=!1;this.defaultExpandIds.some(i=>{if(i===t.id)return e=!0,!0}),e||this.defaultExpandIds.push(t.id)},handleNodeCollapse(t){this.defaultExpandIds.some((e,i)=>{e===t.id&&this.defaultExpandIds.splice(i,1)}),this.removeChildrenIds(t)},removeChildrenIds(t){t.children&&t.children.forEach(t=>{const e=this.defaultExpandIds.indexOf(t.id);e>0&&this.defaultExpandIds.splice(e,1),this.removeChildrenIds(t)})},selectTree(t,e){t.children&&(e.isCurrent=!1,this.$refs.vueTree.setCurrentKey(this.group.id))},toogleGroupRois(t){t.is_show=1==t.is_show?-1:1,Object(s.b)(`slice/markShow?companyid=${Object(s.s)().company}`,{caseid:this.record.id,fileid:this.slice.id,group_id:t.id}).then(async()=>{if(this.groups=await this.getGroups(this.templateId),this.selectGroup(this.group.id),t.children){let e=null;(await this.getCurGroup(t.id)).children.map(t=>{t.id==this.group.id?e=t:t.children&&t.children.map(t=>{t.id==this.group.id&&(e=t)})}),e?this.$emit("setGroup",e):this.$emit("loadLeft","checkCurRois")}else t.id==this.group.id?this.$emit("setGroup",t):this.$emit("loadLeft","checkCurRois");this.$nextTick(()=>{this.$refs.vueTree.setCurrentKey(this.group.id)})}).catch(t=>{this.$alert(t.message)})},getTemplate(){Object(s.b)(`slice/templateList?companyid=${Object(s.s)().company}`,{caseid:this.record.id,fileid:this.slice.id}).then(({data:t})=>{this.templates=t.templates,this.templateId&&this.$emit("curTem",t.templates.find(t=>t.id==this.templateId))}).catch(()=>{this.templates=[]})},async selectChange(t){this.$emit("setTemplateId",t),this.$emit("curTem",this.templates.find(e=>e.id==t)),this.groups=await this.getGroups(t),this.setGroupChecked(),this.$emit("loadLeft")},getGroups(t){return new Promise(e=>{Object(s.b)(`slice/selectTemplate?companyid=${Object(s.s)().company}`,{caseid:this.record.id,fileid:this.slice.id,id:t}).then(({data:t})=>e(t)).catch(t=>e([]))})},dbclick(t){clearTimeout(Pi),this.reName(t),this.$refs.vueTree.setCurrentKey(this.group.id)},reName(t){this.$set(t,"modify",!0),setTimeout(()=>{this.$refs[t.id].$el.querySelector("input").focus()},200)},async setModifyFalse(t){t.label||(t.label="默认组名称"),this.$set(t,"modify",!1),delete t.modify,await this.modifyGroup("update")},getCurGroup(t){return new Promise(e=>{Object(s.b)(`slice/queryGroup?companyid=${Object(s.s)().company}`,{caseid:this.record.id,fileid:this.slice.id,group_id:t}).then(t=>e(t.data)).catch(t=>{this.$alert(t.message)})})},async rightClick(t,e,i){let s=await this.getCurGroup(e.id);e.modify||(3==i.level||2==i.level&&!s.is_empty||1==i.level&&!s.is_empty?this.hideAddSon=!0:this.hideAddSon=!1,this.tmDisplay=!0,this.rightMenu={top:t.pageY+"px",left:t.pageX+"px"},this.curGroup=e,document.onclick=(t=>{t.target!==document.getElementById("perTreeMenu")&&(this.tmDisplay=!1)}))},async colorChange(t){t.color||(this.$set(t,"color","#f00"),t.color),await this.modifyGroup(),this.$emit("setGroup",t)},modifyGroup(t){return new Promise(e=>{Object(s.c)(`slice/modifyGroup?companyid=${Object(s.s)().company}`,{caseid:this.record.id,fileid:this.slice.id,groups:JSON.stringify(this.groups)}).then(async()=>{t&&(this.groups=await this.getGroups(this.templateId)),e()}).catch(t=>{this.$alert(t.message)})})},getSon(t){return t.children?this.getSon(t.children[0]):t},setGroupChecked(){if(this.groups.length){let t=this.getSon(this.groups[0]);this.$emit("setGroup",t),this.selectGroup(t.id),this.$nextTick(()=>{this.$refs.vueTree.setCurrentKey(this.group.id)})}else this.$emit("setGroup",{}),this.rois={total:0,marks:[]}},removeExpandIds(t){if(this.defaultExpandIds.includes(t)){let e=this.defaultExpandIds.findIndex(e=>e===t);this.defaultExpandIds.splice(e,1)}},delGroup(t){this.$confirm("删除后该组下的所有组和标注信息将被清空且无法恢复，确定要删除吗？","操作确认",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"}).then(()=>{Object(s.c)(`slice/deleteGroup?companyid=${Object(s.s)().company}`,{caseid:this.record.id,fileid:this.slice.id,group_id:t.id}).then(async()=>{this.groups=await this.getGroups(this.templateId),this.groups.forEach(t=>{t.children?t.children.forEach(t=>{this.removeExpandIds(t.id)}):this.removeExpandIds(t.id)}),this.removeExpandIds(t.id),this.group.id==t.id?this.setGroupChecked():t.children&&t.children.forEach(t=>{t.id==this.group.id&&this.setGroupChecked(),t.children&&t.children.forEach(t=>{t.id==this.group.id&&this.setGroupChecked()})}),this.$emit("loadLeft","checkCurRois")}).catch(t=>{this.$alert(t.message)})}).catch(()=>{})},async newGroup(){let t=await this.getGroupId(),e={id:t,label:"默认组名称",modify:!0,color:"#FF0000",is_empty:1,is_show:1};this.groups.push(e),setTimeout(()=>{document.getElementById(t).focus(),this.$refs.vueTree.setCurrentKey(t),this.pageIndex=1,this.$emit("setGroup",e),this.selectGroup(t)},200)},nodeClick(t){clearTimeout(Pi),Pi=setTimeout(async()=>{this.tmDisplay=!1,t.children||(this.pageIndex=1,this.selectGroup(t.id),this.$emit("setGroup",t))},200)},selectGroup(t){Object(s.b)(`slice/selectGroup?companyid=${Object(s.s)().company}`,{caseid:this.record.id,fileid:this.slice.id,group_id:t,page:this.pageIndex,per_page:this.pageSize}).then(t=>{this.rois=t.data;let e=Math.ceil(t.data.total/this.pageSize);this.pageIndex>e&&this.pageIndex>1&&this.changeIndex(e)}).catch(t=>this.$alert(t.message))},getGroupId(){return new Promise(t=>{Object(s.b)(`slice/createGroup?companyid=${Object(s.s)().company}`,{caseid:this.record.id,fileid:this.slice.id,template_id:this.cruTemplateId}).then(({data:e})=>t(e.new_group_id)).catch(t=>this.$alert(t.message))})},async addSon(){let t=await this.getGroupId(),e={id:t,label:"默认组名称",color:"#FF0000",is_show:1,is_empty:1,modify:!0};this.defaultExpandIds.includes(this.curGroup.id)||this.defaultExpandIds.push(this.curGroup.id),this.curGroup.children?this.curGroup.children.push(e):(this.curGroup.hasOwnProperty("children")&&delete this.curGroup.children,this.$set(this.curGroup,"children",[e])),setTimeout(async()=>{document.getElementById(t)&&document.getElementById(t).focus(),this.$refs.vueTree.setCurrentKey(t),this.pageIndex=1,this.$emit("setGroup",e),this.selectGroup(t)},200)},changeSize(t){this.pageIndex=1,this.pageSize=t,this.selectGroup(this.group.id)},changeIndex(t){this.pageIndex=t,this.selectGroup(this.group.id)}},destroyed(){document.onclick=null},async mounted(){this.getTemplate(),this.templateId&&(this.groups=await this.getGroups(this.templateId),Object.keys(this.group).length?(this.$emit("loadLeft"),this.selectGroup(this.group.id),this.$nextTick(()=>{this.$refs.vueTree.setCurrentKey(this.group.id)})):this.setGroupChecked())},props:["slice","record","templateId","group","currentRois","radius"]},Li={render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"marklist"},[s("div",{staticClass:"fatherlist"},[s("div",{staticClass:"top"},[s("div",{staticClass:"top-select",on:{click:function(e){t.showOptions=!t.showOptions}}},[s("el-select",{attrs:{placeholder:"请选择"},on:{change:t.selectChange},model:{value:t.cruTemplateId,callback:function(e){t.cruTemplateId=e},expression:"cruTemplateId"}},t._l(t.templates,function(t){return s("el-option",{key:t.id,attrs:{label:t.name,value:t.id}})}),1)],1),t._v(" "),t.cruTemplateId?s("div",{staticClass:"new-group",on:{click:t.newGroup}},[t._v("+新建组")]):t._e()]),t._v(" "),s("div",{staticClass:"group-list"},[s("el-tree",{ref:"vueTree",staticClass:"tree",attrs:{data:t.groups,props:t.defaultProps,"default-expanded-keys":t.defaultExpandIds,"expand-on-click-node":!1,"node-key":"id"},on:{"node-contextmenu":t.rightClick,"node-click":t.selectTree,"node-expand":t.handleNodeExpand,"node-collapse":t.handleNodeCollapse},scopedSlots:t._u([{key:"default",fn:function(e){var i=e.data;return[s("span",{staticStyle:{flex:"1",display:"flex","align-items":"center","justify-content":"space-between","font-size":"14px",width:"100%"}},[s("span",{staticClass:"hide-button",class:{hidden:i.is_show<0},on:{click:function(e){return e.stopPropagation(),t.toogleGroupRois(i)}}}),t._v(" "),i.modify||!i.label?s("span",{staticStyle:{width:"166px"}},[s("el-input",{ref:i.id,attrs:{id:i.id},on:{blur:function(e){return t.setModifyFalse(i)}},model:{value:i.label,callback:function(e){t.$set(i,"label",e)},expression:"data.label"}})],1):s("span",{ref:i.id,staticStyle:{width:"166px",overflow:"hidden","white-space":"nowrap","text-overflow":"ellipsis"},attrs:{title:i.label},on:{click:function(e){return t.nodeClick(i)},dblclick:function(e){return e.stopPropagation(),t.dbclick(i)}}},[t._v("   \n                            "+t._s(i.children?t.showEtc(i.label):t.showEtc(i.label+"("+i.mark_count+")"))+"\n                        ")]),t._v(" "),s("span",{staticStyle:{"font-size":"0"},on:{click:function(t){t.stopPropagation()}}},[i.children?t._e():s("el-color-picker",{staticStyle:{flex:"1"},attrs:{size:"mini"},on:{change:function(e){return t.colorChange(i)}},model:{value:i.color,callback:function(e){t.$set(i,"color",e)},expression:"data.color"}})],1),t._v(" "),s("span",{staticClass:"delimg",on:{click:function(e){return e.stopPropagation(),t.delGroup(i)}}})])]}}])}),t._v(" "),t.tmDisplay?s("div",{staticClass:"tree_menu",style:{left:t.rightMenu.left,top:t.rightMenu.top},attrs:{id:"perTreeMenu"}},[s("ul",[t.hideAddSon?t._e():s("li",{on:{click:t.addSon}},[t._v("新建下级组")]),t._v(" "),s("li",{on:{click:function(e){return t.reName(t.curGroup)}}},[t._v("重命名")])])]):t._e()],1)]),t._v(" "),s("div",{staticClass:"sonlist"},[s("div",{staticClass:"top"},[t.group.label?s("h3",{attrs:{title:t.group.label+"（"+(t.rois.total||0)+"）"}},[t._v(t._s(t.group.label)+"（"+t._s(t.rois.total||0)+"）")]):t._e()]),t._v(" "),s("div",{staticClass:"rois"},[t.rois.total?s("ul",{staticClass:"outerroi"},t._l(t.rois.marks,function(e){return s("li",{key:e.id,staticClass:"roillist",class:{curRoi:t.currentRois[e.id]},on:{click:function(i){return t.$emit("curROI",e,i.shiftKey)}}},[s("span",{staticClass:"sort-name"},[t._v("标注"+t._s(e.index))]),s("span",{staticClass:"sort-name"},[s("input",{directives:[{name:"model",rawName:"v-model",value:e.remark,expression:"roi.remark"}],domProps:{value:e.remark},on:{blur:function(i){return t.$emit("roiChanged","remark",[e])},input:function(i){i.target.composing||t.$set(e,"remark",i.target.value)}}})]),s("span",{staticClass:"delete-bottom",on:{click:function(i){return i.stopPropagation(),t.$emit("delRoi",e.id)}}})])}),0):s("div",{staticClass:"noroi"},[s("img",{attrs:{src:i("nPAZ")}}),t._v(" "),s("p",[t._v("当前没有标注 !")])]),t._v(" "),t.rois.total?s("el-pagination",{attrs:{"current-page":t.pageIndex,"page-sizes":[100,200,500],"page-size":t.pageSize,small:"",layout:"sizes, prev, pager, next",total:t.rois.total,"pager-count":5},on:{"size-change":t.changeSize,"current-change":t.changeIndex}}):t._e()],1)])])},staticRenderFns:[]};var Hi=i("VU/8")(Di,Li,!1,function(t){i("xSBg"),i("xTgL")},null,null).exports,zi={data(){return{loopHandler:0,centerRegion:null,curRois:{},showbutton:!0,position:{offx:this.slice.position?this.slice.position.offx:.5,offy:this.slice.position?this.slice.position.offy:.5*this.slice.height/this.slice.width,zoom:this.slice.position?this.slice.position.zoom:null},lineup:null,showMppGuide:!1,drawMpp:null,parentId:null,curLevel:{},leftRoilist:[],rightRoilist:[],aiFatherRois:[],ki67Anno:null,templateId:this.slice.templateId||null,group:this.slice.group||{},loading:!1,radius:null,filled:!0,curTem:null,currentItem:"",defaultExpandIds:[]}},computed:{showBtn(){return!(!this.curTem||!["ki67","tct","fishTissue","er","pr","pdl1","her2","lct","ki67hot","np","dna","bm"].includes(this.curTem.type))}},methods:{getFilledType(){Object(s.b)(`slice/querySolidStatus?companyid=${Object(s.s)().company}`,{caseid:this.record.id,fileid:this.slice.id}).then(({data:t})=>{this.filled=t.is_solid}).catch(t=>{this.$alert(t.message)})},radiusChanged(t){this.radius=t.target.value,Object(s.b)(`slice/modifyRadius?companyid=${Object(s.s)().company}`,{caseid:this.record.id,fileid:this.slice.id,radius:this.radius}).then(async()=>{this.leftRoilist=await Object(s.n)(this.record.id,this.slice.id,this.curLevel,"label",this.templateId)}).catch(t=>{this.$alert(t.message)})},showBg(){this.filled=!this.filled,Object(s.b)(`slice/modifySolidStatus?companyid=${Object(s.s)().company}`,{caseid:this.record.id,fileid:this.slice.id,is_solid:1&this.filled}).then(async()=>{this.leftRoilist=await Object(s.n)(this.record.id,this.slice.id,this.curLevel,"label",this.templateId)}).catch(t=>{this.$alert(t.message)})},async loadLeft(t){if(this.leftRoilist=await Object(s.n)(this.record.id,this.slice.id,this.curLevel,"label",this.templateId),t)for(var e in this.curRois)this.leftRoilist.some(t=>t.id==e)||(delete this.curRois[e],this.curRois=Object.assign({},this.curRois))},rightDelRoi(t){this.$confirm("确认删除这个roi?",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"}).then(async()=>{this.loading=!0,await Object(s.i)(this.record.id,this.slice.id,this.slice.toolType,[t],null,this.slice.templateId),this.loading=!1,this.$refs.group.groups=await this.$refs.group.getGroups(this.templateId),delete this.curRois[t],this.loadLeft(),this.$refs.group.selectGroup(this.group.id)}).catch(()=>{})},setTemplateId(t){this.templateId=t,this.$set(this.slice,"templateId",t),this.curRois={}},async setGroup(t){this.group=t,this.$set(this.slice,"group",t),Object.keys(t).length&&(this.loadLeft("checkCurRois"),this.$emit("save"))},importAIresult(){this.$confirm("导入后，原有标注组和标注数据将被清空","操作确认",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warnning"}).then(()=>{this.loading=!0,Object(s.b)(`slice/importAiResult?companyid=${Object(s.s)().company}`,{caseid:this.record.id,fileid:this.slice.id}).then(()=>{this.loading=!1,this.$refs.group.selectChange(this.templateId),this.getFilledType()}).catch(t=>{this.loading=!1,this.$message.error(t.message)})}).catch(t=>t)},showMenu(t,e){if((!t.type||t.button&&!e.dashed)&&(t.preventDefault(),!(0==Object.keys(this.curRois).length||Object.keys(this.curRois).every(t=>t!=e.id)||this.aiFatherRois.some(t=>t.id==e.id)||this.rightRoilist.some(t=>t.id==e.id)))){this.curRois[e.id]&&(this.$refs.group.groups.forEach(t=>{t.id==e.group_id?this.currentItem=t.id+":"+t.id:t.children&&t.children.forEach(i=>{i.id==e.group_id?this.currentItem=t.id+":"+i.id:i.children&&i.children.forEach(s=>{s.id==e.group_id&&(this.currentItem=t.id+":"+i.id+":"+s.id)})})}),this.newover=this.currentItem.substring(0,this.currentItem.lastIndexOf(":")));var i=t.currentTarget,s=t.offsetX,n=t.offsetY,a=i.offsetWidth,o=i.offsetHeight;this.ki67Anno={},this.ki67Anno.hd=s>a/2?"right":"left",this.ki67Anno.vd=n>o/2?"bottom":"top",this.menuPosition={x:s,y:n}}},async setAnnotation(t){this.ki67Anno=null,this.loading=!0,await this.changeRois(t,this.$refs.osd.scope),this.loading=!1,this.$refs.group.groups=await this.$refs.group.getGroups(this.templateId),this.loadLeft(),(Object.values(this.curRois).some(t=>t.group_id==this.group.id)||t==this.group.id)&&this.$refs.group.selectGroup(this.group.id),this.curRois={}},async getRoi(t){let{x1:e,y1:i,x2:s,y2:n,z:a}=t;this.curLevel={x:[e,s],y:[i,n],z:a},this.loadLeft()},curROIChange(t,e){var i;t?t.length?i=t:e&&this.curRois[t.id]?(delete this.curRois[t.id],i=[]):i=[t]:i=[],this.curRois=Object.assign({},e&&this.curRois,...i.map(t=>({[t.id]:t})))},listChangeCurrent(){if(Object.keys(this.curRois).length){var t=[].concat.apply([],Object.values(this.curRois).map(t=>t.path.x)),e=[].concat.apply([],Object.values(this.curRois).map(t=>t.path.y));t.length?this.centerRegion=[Math.min.apply(null,t),Math.min.apply(null,e),Math.max.apply(null,t),Math.max.apply(null,e)]:this.centerRegion=null,this.$refs.osd.scope=null,Object.keys(this.curRois).forEach(t=>{this.leftRoilist.find(e=>e.id===t)||delete this.curRois[t]})}},async roiChanged(t,e){if(e){let i=e.map(e=>({id:e.id,remark:e[t]}));this.loading=!0,await Object(s.e)(this.record.id,this.slice.id,this.slice.toolType,i),this.loading=!1}else this.$refs.osd.scope?this.$message.error("不支持多选移动"):(this.loading=!0,await this.changeRois(null,this.$refs.osd.scope),this.loading=!1,Object.values(this.curRois).some(t=>t.group_id==this.group.id)&&this.$refs.group.selectGroup(this.group.id)),this.$refs.osd.scope&&this.$refs.osd.scope.offset&&(this.curRois={},this.$refs.osd.scope=null),Object.values(this.curRois).some(t=>t.group_id==this.group.id)&&this.$refs.group.selectGroup(this.group.id),this.loadLeft(),this.IsOutFrame()},changeRois(t,e){return new Promise(i=>{Object(s.b)(`slice/modifyMark?companyid=${Object(s.s)().company}`,{caseid:this.record.id,fileid:this.slice.id,ai_type:this.slice.toolType,marks:JSON.stringify(Object.values(this.curRois)),selected_group_id:this.group.id,target_group_id:t,scope:JSON.stringify(e),template_id:this.templateId}).then(()=>i()).catch(t=>i())})},newMark(t){return new Promise(e=>{Object(s.b)(`slice/createMark?companyid=${Object(s.s)().company}`,{caseid:this.record.id,fileid:this.slice.id,group_id:this.group.id,ai_type:"label",mark:JSON.stringify(t),template_id:this.templateId}).then(({data:t})=>e(t.new_mark_id)).catch(t=>e(null))})},async draw(t,e){Object.keys(this.group).length?this.group.is_show<0?this.$message.error("当前标注组被隐藏，无法绘制！"):(t.strokeColor=this.group.color,t.group_id=this.group.id,t.mark_type=1,t.dashed&&(t.strokeColor="#E3E9EF",t.mark_type=5,t.dashed=1),t.id=await this.newMark(t),t.id&&(this.curROIChange(t,e),this.leftRoilist=[...this.leftRoilist,t],this.loadLeft(),this.$refs.group.groups=await this.$refs.group.getGroups(this.templateId),this.$refs.group.selectGroup(this.group.id),this.IsOutFrame())):this.$message.error("请选择模板或新建一个组！")},async clickDraw(t,e){if(Object.keys(this.group).length)if(this.group.is_show<0)this.$message.error("当前标注组被隐藏，无法绘制！");else{var i={path:{x:[t.x],y:[t.y]},method:"spot",radius:this.radius/(this.slice.mppx||.242042),mark_type:1,fillColor:this.group.color,group_id:this.group.id};i.id=await this.newMark(i),i.id&&(this.curROIChange(i,e),this.leftRoilist=[...this.leftRoilist,i],this.loadLeft(),this.IsOutFrame(),this.$refs.group.groups=await this.$refs.group.getGroups(this.templateId),this.$refs.group.selectGroup(this.group.id))}else this.$message.error("请选择模板或新建一个组！")},IsOutFrame(){Object.keys(this.curRois).map(t=>{this.leftRoilist.some(e=>e.id==t)||(delete this.curRois[t],this.curRois=Object.assign({},this.curRois))})},async delCurRoi(){await this.$confirm(this.$t("analaysisPanel.delete"),{confirmButtonText:this.$t("confirm.confirm"),cancelButtonText:this.$t("confirm.quit"),type:"warning"}).catch(()=>{})&&(this.loading=!0,await Object(s.i)(this.record.id,this.slice.id,this.slice.toolType,Object.keys(this.curRois),this.$refs.osd.scope,this.templateId),this.loading=!1,this.$refs.group.groups=await this.$refs.group.getGroups(this.templateId),Object.values(this.curRois).some(t=>t.group_id==this.group.id)&&this.$refs.group.selectGroup(this.group.id),this.curRois={},this.loadLeft())},keydown(t){"Delete"!=t.key&&"Backspace"!=t.key||!Object.keys(this.curRois).length||["TEXTAREA","INPUT"].includes(t.target.nodeName)||this.delCurRoi()}},created(){Object(s.b)(`slice/queryRadius?companyid=${Object(s.s)().company}`,{caseid:this.record.id,fileid:this.slice.id}).then(({data:t})=>{this.radius=t.radius}).catch(t=>{this.$alert(t.message)})},async mounted(){this.loadLeft(),this.getFilledType()},props:["slice","record","config"],components:{"v-dragon":v.a,"v-marktree":Hi,"v-menus":V}},Ni={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"cnt",attrs:{tabIndex:0},on:{keydown:t.keydown}},[i("div",{staticClass:"analyright",on:{mousewheel:function(e){t.ki67Anno=null},mousedown:function(e){t.ki67Anno=null}}},[i("v-dragon",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],ref:"osd",staticClass:"dragon",attrs:{record:t.record,slice:t.slice,roilist:[].concat(t.leftRoilist),curRois:t.curRois,penColor:t.group.color||"yellow",centerRegion:t.centerRegion,position:t.position,showMppGuide:t.showMppGuide,cellArea:110,"element-loading-text":"处理中，请耐心等待","element-loading-spinner":"el-icon-loading","element-loading-background":"rgba(0, 0, 0, 0.5)",radius:t.radius,filled:t.filled},on:{curROI:t.curROIChange,draw:t.draw,position:function(e,i,s){t.$set(t.position,"offx",e),t.$set(t.position,"offy",i),t.$set(t.position,"zoom",s),t.$set(t.slice,"position",t.position)},closeMppGuide:function(e){t.showMppGuide=!1},changeMpp:function(e){return t.drawMpp=e},clickDraw:t.clickDraw,getRoi:t.getRoi,roiChanged:t.roiChanged,parentId:function(e){return t.parentId=e},contextmenu:function(e,i){return t.showMenu(e,i)},setRadius:t.radiusChanged,showBg:t.showBg}},[t.ki67Anno?i("div",{staticStyle:{position:"absolute"},style:{left:t.menuPosition.x+"px",top:t.menuPosition.y+"px"}},[i("v-menus",{attrs:{pos:t.ki67Anno,menus:t.$refs.group.groups,currentItem:t.currentItem,newover:t.newover},on:{chosen:t.setAnnotation}})],1):t._e()]),t._v(" "),t.showBtn?i("button",{style:{right:t.config&&t.config.zeiss?"248px":"174px"},on:{click:t.importAIresult}},[t._v("导入算法结果")]):t._e()],1),t._v(" "),i("div",{staticClass:"analylist"},[i("v-marktree",{ref:"group",attrs:{slice:t.slice,record:t.record,templateId:t.templateId,group:t.group,currentRois:t.curRois},on:{setTemplateId:t.setTemplateId,curTem:function(e){return t.curTem=e},setGroup:t.setGroup,loadLeft:t.loadLeft,delRoi:t.rightDelRoi,roiChanged:t.roiChanged,curROI:function(e,i){return t.curROIChange(e,i)+t.listChangeCurrent()}}})],1)])},staticRenderFns:[]};var Bi=i("VU/8")(zi,Ni,!1,function(t){i("vlIZ")},"data-v-829a504c",null).exports,Gi={data:()=>({showBtn:!1}),computed:{lymbs(){let t={[this.getTotalCount("嗜酸性粒细胞")]:"嗜酸性粒细胞",[this.getTotalCount("淋巴细胞")]:"淋巴细胞",[this.getTotalCount("浆细胞")]:"浆细胞",[this.getTotalCount("中性粒细胞")]:"中性粒细胞"},e=Math.max(...[this.getTotalCount("嗜酸性粒细胞"),this.getTotalCount("淋巴细胞"),this.getTotalCount("浆细胞"),this.getTotalCount("中性粒细胞")]);return[e?t[e]+"：":"",e/this.getAllCount()*100]}},methods:{changeImage(t){this.$set(t,"image",1-(t.image||0)),this.$emit("roiChanged","image",[t])},del(t){this.$confirm(this.$t("analaysisPanel.delete"),{confirmButtonText:this.$t("confirm.confirm"),cancelButtonText:this.$t("confirm.quit"),type:"warning"}).then(()=>{this.$emit("delRoi",t)},()=>{})},getTotalCount(t){return this.ROIS.filter(t=>t.image).map(e=>e.aiResult[t].count).reduce((t,e)=>t+e,0)},getAllCount(){return this.getTotalCount("嗜酸性粒细胞")+this.getTotalCount("淋巴细胞")+this.getTotalCount("浆细胞")+this.getTotalCount("中性粒细胞")||1},getTotalArea(t){return"μm²"===this.calUnit?this.ROIS.filter(t=>t.image).map(e=>e.aiResult[t].area).reduce((t,e)=>t+e,0):this.ROIS.filter(t=>t.image).map(e=>e.aiResult[t].area).reduce((t,e)=>t+e,0)/1e3/1e3},denominator(t){return"μm²"===this.calUnit?this.ROIS.filter(t=>t.image).map(e=>e.aiResult[t].total_area).reduce((t,e)=>t+e,0)||1:this.ROIS.filter(t=>t.image).map(e=>e.aiResult[t].total_area).reduce((t,e)=>t+e,0)/1e3/1e3||1e-6}},props:["ROIS","currentRois","calUnit"]},Ui={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"nprois"},[t.ROIS.length?i("div",{staticClass:"nprtable",style:{height:t.showBtn?"calc(100% - 80px)":"calc(100% - 408px)"}},t._l(t.ROIS,function(e,s){return i("div",{key:s,staticClass:"roilist",on:{click:function(i){t.$emit("curROI",e,i.shiftKey),t.$emit("closecontextmenu")}}},[i("table",{class:{gocheck:t.currentRois[e.id]}},[i("tr",[i("th",{attrs:{width:"100"}},[i("span",{staticClass:"uncheck",class:{checked:e.image},on:{click:function(i){return i.stopPropagation(),t.changeImage(e)}}}),t._v("炎细胞种类")]),i("th",{attrs:{width:"110"}},[t._v("数量")]),i("th",{attrs:{width:"90"}},[t._v("指数（%）")]),i("th",[t._v("操作")])]),t._v(" "),i("tr",{staticStyle:{color:"#FF0000"}},[i("td",[t._v("嗜酸性粒细胞")]),i("td",[t._v(t._s(e.aiResult["嗜酸性粒细胞"].count))]),i("td",[t._v(t._s(e.aiResult["嗜酸性粒细胞"].index))]),i("td",{attrs:{rowspan:"8"}},[i("em",{attrs:{title:t.$t("upload.delete")},on:{click:function(i){return i.stopPropagation(),t.del(e)}}})])]),t._v(" "),i("tr",{staticStyle:{color:"#00EEFF"}},[i("td",[t._v("淋巴细胞")]),i("td",[t._v(t._s(e.aiResult["淋巴细胞"].count))]),i("td",[t._v(t._s(e.aiResult["淋巴细胞"].index))])]),t._v(" "),i("tr",{staticStyle:{color:"#EAFD00"}},[i("td",[t._v("浆细胞")]),i("td",[t._v(t._s(e.aiResult["浆细胞"].count))]),i("td",[t._v(t._s(e.aiResult["浆细胞"].index))])]),t._v(" "),i("tr",{staticStyle:{color:"#66FD00"}},[i("td",[t._v("中性粒细胞")]),i("td",[t._v(t._s(e.aiResult["中性粒细胞"].count))]),i("td",[t._v(t._s(e.aiResult["中性粒细胞"].index))])]),t._v(" "),i("tr",[i("td",{staticClass:"thed"},[t._v("区域种类")]),i("td",{staticClass:"thed"},[t._v("面积（"+t._s(t.calUnit)+"）")]),i("td",{staticClass:"thed"},[t._v("指数（%）")])]),t._v(" "),i("tr",{staticStyle:{color:"#00FEBB"}},[i("td",[t._v("上皮区域")]),i("td",[t._v(t._s("μm²"===t.calUnit?e.aiResult["上皮区域"].area:(e.aiResult["上皮区域"].area/1e3/1e3).toFixed(2)))]),i("td",[t._v(t._s(e.aiResult["上皮区域"].index))])]),t._v(" "),i("tr",{staticStyle:{color:"#AB86FF"}},[i("td",[t._v("腺体区域")]),i("td",[t._v(t._s("μm²"===t.calUnit?e.aiResult["腺体区域"].area:(e.aiResult["腺体区域"].area/1e3/1e3).toFixed(2)))]),i("td",[t._v(t._s(e.aiResult["腺体区域"].index))])]),t._v(" "),i("tr",{staticStyle:{color:"#D32CD6"}},[i("td",[t._v("血管区域")]),i("td",[t._v(t._s("μm²"===t.calUnit?e.aiResult["血管区域"].area:(e.aiResult["血管区域"].area/1e3/1e3).toFixed(2)))]),i("td",[t._v(t._s(e.aiResult["血管区域"].index))])])])])}),0):t._e(),t._v(" "),i("div",{staticClass:"tal",class:{short:t.showBtn}},[i("div",{staticClass:"bottom"},[t._v("\n            统计     \n            "),i("span",{style:{transform:t.showBtn?"rotate(180deg)":"rotate(0deg)"},on:{click:function(e){t.showBtn=!t.showBtn}}})]),t._v(" "),!t.showBtn&&t.ROIS.length?i("div",{staticClass:"shownot"},[i("table",[t._m(0),t._v(" "),i("tr",{staticStyle:{color:"#FF0000"}},[i("td",[t._v("嗜酸性粒细胞")]),i("td",[t._v(t._s(t.getTotalCount("嗜酸性粒细胞")))]),i("td",[t._v(t._s(t.ROIS.filter(function(t){return t.image}).length<2?"-":(t.getTotalCount("嗜酸性粒细胞")/t.ROIS.length).toFixed(2)))]),i("td",[t._v(t._s((t.getTotalCount("嗜酸性粒细胞")/t.getAllCount()*100).toFixed(2)))])]),t._v(" "),i("tr",{staticStyle:{color:"#00EEFF"}},[i("td",[t._v("淋巴细胞")]),i("td",[t._v(t._s(t.getTotalCount("淋巴细胞")))]),i("td",[t._v(t._s(t.ROIS.filter(function(t){return t.image}).length<2?"-":(t.getTotalCount("淋巴细胞")/t.ROIS.length).toFixed(2)))]),i("td",[t._v(t._s((t.getTotalCount("淋巴细胞")/t.getAllCount()*100).toFixed(2)))])]),t._v(" "),i("tr",{staticStyle:{color:"#EAFD00"}},[i("td",[t._v("浆细胞")]),i("td",[t._v(t._s(t.getTotalCount("浆细胞")))]),i("td",[t._v(t._s(t.ROIS.filter(function(t){return t.image}).length<2?"-":(t.getTotalCount("浆细胞")/t.ROIS.length).toFixed(2)))]),i("td",[t._v(t._s((t.getTotalCount("浆细胞")/t.getAllCount()*100).toFixed(2)))])]),t._v(" "),i("tr",{staticStyle:{color:"#66FD00"}},[i("td",[t._v("中性粒细胞")]),i("td",[t._v(t._s(t.getTotalCount("中性粒细胞")))]),i("td",[t._v(t._s(t.ROIS.filter(function(t){return t.image}).length<2?"-":(t.getTotalCount("中性粒细胞")/t.ROIS.length).toFixed(2)))]),i("td",[t._v(t._s((t.getTotalCount("中性粒细胞")/t.getAllCount()*100).toFixed(2)))])]),t._v(" "),i("tr",[i("td",[t._v("总体炎症细胞")]),i("td",[t._v(t._s(t.getTotalCount("嗜酸性粒细胞")+t.getTotalCount("中性粒细胞")+t.getTotalCount("淋巴细胞")+t.getTotalCount("浆细胞")))]),i("td",[t._v(t._s(t.ROIS.filter(function(t){return t.image}).length<2?"-":((t.getTotalCount("嗜酸性粒细胞")+t.getTotalCount("中性粒细胞")+t.getTotalCount("淋巴细胞")+t.getTotalCount("浆细胞"))/t.ROIS.length).toFixed(2)))]),i("td",[t._v(t._s("100%"))])])]),t._v(" "),i("table",[i("tr",[i("th",{attrs:{width:"100"}},[t._v("区域种类")]),i("th",{attrs:{width:"80"}},[t._v("总面积（"+t._s(t.calUnit)+"）")]),i("th",{attrs:{width:"90"}},[t._v("平均面积（"+t._s(t.calUnit)+"）")]),i("th",[t._v("指数（%）")])]),t._v(" "),i("tr",{staticStyle:{color:"#00FEBB"}},[i("td",[t._v("上皮区域")]),i("td",[t._v(t._s(t.getTotalArea("上皮区域").toFixed(2)))]),i("td",[t._v(t._s(t.ROIS.filter(function(t){return t.image}).length<2?"-":(t.getTotalArea("上皮区域")/t.ROIS.length).toFixed(2)))]),i("td",[t._v(t._s((t.getTotalArea("上皮区域")/t.denominator("上皮区域")*100).toFixed(2)))])]),t._v(" "),i("tr",{staticStyle:{color:"#AB86FF"}},[i("td",[t._v("腺体区域")]),i("td",[t._v(t._s(t.getTotalArea("腺体区域").toFixed(2)))]),i("td",[t._v(t._s(t.ROIS.filter(function(t){return t.image}).length<2?"-":(t.getTotalArea("腺体区域")/t.ROIS.length).toFixed(2)))]),i("td",[t._v(t._s((t.getTotalArea("腺体区域")/t.denominator("腺体区域")*100).toFixed(2)))])]),t._v(" "),i("tr",{staticStyle:{color:"#D32CD6"}},[i("td",[t._v("血管区域")]),i("td",[t._v(t._s(t.getTotalArea("血管区域").toFixed(2)))]),i("td",[t._v(t._s(t.ROIS.filter(function(t){return t.image}).length<2?"-":(t.getTotalArea("血管区域")/t.ROIS.length).toFixed(2)))]),i("td",[t._v(t._s((t.getTotalArea("血管区域")/t.denominator("血管区域")*100).toFixed(2)))])]),t._v(" "),i("tr",[i("td",[t._v("总体区域")]),i("td",[t._v(t._s((t.getTotalArea("上皮区域")+t.getTotalArea("腺体区域")+t.getTotalArea("血管区域")).toFixed(2)))]),i("td",[t._v(t._s(t.ROIS.filter(function(t){return t.image}).length<2?"-":((t.getTotalArea("上皮区域")+t.getTotalArea("腺体区域")+t.getTotalArea("血管区域"))/t.ROIS.length).toFixed(2)))]),i("td",[t._v("-")])])])]):t._e(),t._v(" "),i("div",{staticClass:"doc-check"},[t._v(t._s(t.lymbs[0])),i("span",[t._v(t._s(t.lymbs[1].toFixed(2))+"%")])])])])},staticRenderFns:[function(){var t=this.$createElement,e=this._self._c||t;return e("tr",[e("th",{attrs:{width:"100"}},[this._v("炎细胞种类")]),e("th",{attrs:{width:"80"}},[this._v("总数")]),e("th",{attrs:{width:"90"}},[this._v("平均数")]),e("th",[this._v("指数（%）")])])}]};var Yi=i("VU/8")(Gi,Ui,!1,function(t){i("DJHp"),i("FIq8")},null,null).exports,Vi={data:()=>({labeltree:[{id:1,label:"嗜酸性粒细胞"},{id:2,label:"淋巴细胞"},{id:3,label:"浆细胞"},{id:4,label:"中性粒细胞"}],roiTypeOpitions:{1:"#FF0000",2:"#00EEFF",3:"#EAFD00",4:"#66FD00",5:"#00FEBB",6:"#AB86FF",7:"#D32CD6"},defaultColor:"#FF0000",defaultType:1,moveStatus:"countEnd",isMaxlvl:!1,screenCount:[],curCount:{},calUnit:"mm²"}),methods:{totalCount:t=>t["嗜酸性粒细胞"]+t["淋巴细胞"]+t["浆细胞"]+t["中性粒细胞"]||1,movetoCenter(t){let e=this.slice.width/this.slice.height,i=this.$refs.osd;switch(t){case"lefttop":i.move(.25,.25/e,Math.min(i.offsetHeight/i.offsetWidth*e*2,2));break;case"righttop":i.move(.75,.25/e,Math.min(i.offsetHeight/i.offsetWidth*e*2,2));break;case"leftbottom":i.move(.25,.75/e,Math.min(i.offsetHeight/i.offsetWidth*e*2,2));break;case"rightbottom":i.move(.75,.75/e,Math.min(i.offsetHeight/i.offsetWidth*e*2,2))}},changeMoveStatus(t){this.moveStatus=t,"moveEnd"==t&&this.slice.ai_suggest&&this.getScreenCount()},getScreenCount(){Object(s.b)(`slice/getScreenCount?companyid=${Object(s.s)().company}`,{caseid:this.record.id,fileid:this.slice.id,position:JSON.stringify(this.curLevel),ai_type:"np"}).then(({data:t})=>{this.isMaxlvl=t.isMaxlvl,this.moveStatus="countEnd",!t.isMaxlvl&&this.fullField?this.screenCount=Object.values(t.result):this.curCount=t.result})}},computed:{fullField(){return this.aiFatherRois.some(t=>t.aiResult.whole_slide)}},components:{"v-dragon":v.a,"v-analyroi":Yi,"v-roi":m,"v-menus":V},mixins:[G.a]},Ji={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"cnt",attrs:{tabIndex:0},on:{keydown:t.keydown}},[i("div",{staticClass:"analyright",class:{showall:t.fullField&&!t.isMaxlvl,"fixed-showall":t.$refs.osd&&t.$refs.osd.fullPage},on:{mousewheel:function(e){t.ki67Anno=null},mousedown:function(e){t.ki67Anno=null}}},[i("v-dragon",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],ref:"osd",staticClass:"dragon",attrs:{record:t.record,slice:t.slice,roilist:t.leftRoilist,curRois:t.curRois,penColor:t.auto?"grey":"yellow",centerRegion:t.centerRegion,moveStatus:t.moveStatus,position:t.position,showMppGuide:t.showMppGuide,cellArea:110,"element-loading-text":"处理中，请耐心等待","element-loading-spinner":"el-icon-loading","element-loading-background":"rgba(0, 0, 0, 0.5)"},on:{changeMoveStatus:t.changeMoveStatus,curROI:t.curROIChange,draw:t.draw,delRoi:function(e){return t.delCurRoi(e)},position:function(e,i,s){t.$set(t.position,"offx",e),t.$set(t.position,"offy",i),t.$set(t.position,"zoom",s),t.$set(t.slice,"position",t.position)},closeMppGuide:function(e){t.showMppGuide=!1},changeMpp:function(e){return t.drawMpp=e},clickDraw:t.clickDraw,getRoi:function(e){return t.getRoi(e)},roiChanged:t.roiChanged,parentId:function(e){return t.parentId=e},contextmenu:function(e,i){return t.showMenu(e,i)}}},[t.ki67Anno?i("div",{staticStyle:{position:"absolute"},style:{left:t.menuPosition.x+"px",top:t.menuPosition.y+"px"}},[i("v-menus",{attrs:{pos:t.ki67Anno,menus:t.labeltree,currentItem:t.currentItem,newover:t.newover},on:{chosen:function(e){return t.setAnnotation(e)}}})],1):t._e(),t._v(" "),(t.isMaxlvl&&t.fullField||!t.fullField)&&t.slice.ai_suggest?i("div",{staticClass:"tps btmcenter"},[i("p",[t._v("嗜酸性粒细胞："),"countEnd"==t.moveStatus?i("span",[t._v(t._s(t.curCount["嗜酸性粒细胞"])+"（"+t._s((t.curCount["嗜酸性粒细胞"]/t.totalCount(t.curCount)*100).toFixed(2))+"%）")]):t._e()]),t._v(" "),i("p",[t._v("淋巴细胞："),"countEnd"==t.moveStatus?i("span",[t._v(t._s(t.curCount["淋巴细胞"])+"（"+t._s((t.curCount["淋巴细胞"]/t.totalCount(t.curCount)*100).toFixed(2))+"%）")]):t._e()]),t._v(" "),i("p",[t._v("浆细胞："),"countEnd"==t.moveStatus?i("span",[t._v(t._s(t.curCount["浆细胞"])+"（"+t._s((t.curCount["浆细胞"]/t.totalCount(t.curCount)*100).toFixed(2))+"%）")]):t._e()]),t._v(" "),i("p",[t._v("中性粒细胞："),"countEnd"==t.moveStatus?i("span",[t._v(t._s(t.curCount["中性粒细胞"])+"（"+t._s((t.curCount["中性粒细胞"]/t.totalCount(t.curCount)*100).toFixed(2))+"%）")]):t._e()]),t._v(" "),"countEnd"!=t.moveStatus?i("div",{staticClass:"start",class:{end:"moveEnd"==t.moveStatus}}):t._e()]):t._e(),t._v(" "),t.fullField&&!t.isMaxlvl?i("div",t._l(t.screenCount,function(e,s){return i("div",{key:s,staticClass:"tps",class:{lefttop:0==s,righttop:1==s,leftbottom:2==s,rightbottom:3==s}},[i("p",[t._v("嗜酸性粒细胞："),"countEnd"==t.moveStatus?i("span",[t._v(t._s(e["嗜酸性粒细胞"])+"（"+t._s((e["嗜酸性粒细胞"]/t.totalCount(e)*100).toFixed(2))+"%）")]):t._e()]),t._v(" "),i("p",[t._v("淋巴细胞："),"countEnd"==t.moveStatus?i("span",[t._v(t._s(e["淋巴细胞"])+"（"+t._s((e["淋巴细胞"]/t.totalCount(e)*100).toFixed(2))+"%）")]):t._e()]),t._v(" "),i("p",[t._v("浆细胞："),"countEnd"==t.moveStatus?i("span",[t._v(t._s(e["浆细胞"])+"（"+t._s((e["浆细胞"]/t.totalCount(e)*100).toFixed(2))+"%）")]):t._e()]),t._v(" "),i("p",[t._v("中性粒细胞："),"countEnd"==t.moveStatus?i("span",[t._v(t._s(e["中性粒细胞"])+"（"+t._s((e["中性粒细胞"]/t.totalCount(e)*100).toFixed(2))+"%）")]):t._e()]),t._v(" "),"countEnd"!=t.moveStatus?i("div",{staticClass:"start",class:{end:"moveEnd"==t.moveStatus}}):t._e()])}),0):t._e()]),t._v(" "),t.showbutton?i("button",{on:{click:function(e){return t.isDrawMpp()}}},[t._v(t._s(t.$t("slice.start")))]):t._e()],1),t._v(" "),i("div",{staticClass:"analylist"},[i("div",{staticClass:"quality"},[t._m(0),t._v(" "),i("div",{staticClass:"quality-detail"},[i("p",{staticStyle:{width:"50%",margin:"0"}},[t._v("清 晰 度："+t._s(t.slice.clarity?(100*t.slice.clarity).toFixed(2)+"%":"-"))]),t._v(" "),i("p",{staticStyle:{width:"50%",margin:"0"}},[t._v("扫描倍数："+t._s(t.slice.objective_rate||"-"))])])]),t._v(" "),i("h2",[i("span",{class:t.auto?"auto":"",on:{click:function(e){t.auto=!0}}},[t._v("AI处理")]),t._v(" "),i("span",{class:t.auto?"":"noauto",on:{click:function(e){t.auto=!1}}},[t._v("手动处理")]),t._v(" "),i("ul",[i("li",{class:{che:"mm²"===t.calUnit},on:{click:function(e){t.calUnit="mm²"}}},[t._v("mm²")]),t._v(" "),i("li",{class:{che:"μm²"===t.calUnit},on:{click:function(e){t.calUnit="μm²"}}},[t._v("μm²")])])]),t._v(" "),t.auto?i("v-analyroi",{staticClass:"table",attrs:{slice:t.slice,ROIS:t.aiFatherRois,calUnit:t.calUnit,currentRois:t.curRois},on:{roiChanged:t.roiChanged,delRoi:function(e){return t.delCurRoi(e)},movetoCenter:t.movetoCenter,curROI:function(e,i){return t.curROIChange(e,i)+t.listChangeCurrent()}}}):t._e(),t._v(" "),t.auto?t._e():i("v-roi",{staticClass:"manualroi",attrs:{roilist:t.rightRoilist,currentRois:t.curRois},on:{curROI:function(e,i){return t.curROIChange(e,i)+t.listChangeCurrent()},delRoi:function(e){return t.delCurRoi(e)},roiChanged:t.roiChanged}}),t._v(" "),!t.showbutton&&t.auto?i("div",{staticClass:"loding"},[i("div",{staticClass:"video"},[i("img",{attrs:{src:"/static/video/loading.gif"}}),t._v(" "),0==t.lineup?i("div",{staticClass:"lineup"},[t._v("正在处理...")]):t._e(),t._v(" "),t.lineup>0?i("div",{staticClass:"lineup"},[t._v(t._s(t.$t("slice.lineup"))+" "),i("span",{staticStyle:{color:"#4C9FFA","font-size":"18px","font-weight":"bolder"}},[t._v(t._s(t.lineup))]),t._v(" "+t._s(t.$t("slice.position")))]):t._e()]),t._v(" "),i("div",{staticClass:"cancel",on:{click:t.canceltesk}},[t._v(t._s(t.$t("slice.cancelTasks")))])]):t._e()],1)])},staticRenderFns:[function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"title"},[e("span",[this._v("AI质控")])])}]};var Xi=i("VU/8")(Vi,Ji,!1,function(t){i("AANI")},"data-v-4e8bd8da",null).exports,Wi={data(){return{index:0,options:[{value:"HER-2 0",label:"HER-2 0"},{value:"HER-2 1+",label:"HER-2 1+"},{value:"HER-2 2+",label:"HER-2 2+"},{value:"HER-2 3+",label:"HER-2 3+"}],checkResult:this.slice.alg===this.slice.toolType&&this.slice.check_result.slice(0,this.slice.check_result.length-1)||null}},methods:{changeResult(t){this.checkResult=t,this.$emit("update",t)},changeImage(t){this.$set(t,"image",1-(t.image||0)),this.$emit("roiChanged","image",[t])},checkall(){if(!this.ROIS.length)return;let t=this.ROIS.every(t=>!!t.image),e=this.ROIS.map(e=>{return{id:e.id,image:t?0:1}});this.$emit("roiChanged","image",e)},del(t){this.$emit("closecontextmenu"),this.$confirm(this.$t("analaysisPanel.delete"),{confirmButtonText:this.$t("confirm.confirm"),cancelButtonText:this.$t("confirm.quit"),type:"warning"}).then(()=>{this.$emit("delRoi",t)},()=>{})}},props:["ROIS","currentRois","ave","slice"]},qi={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"cdrois"},[t.ROIS?i("div",{staticClass:"cdtable"},[i("div",{staticClass:"top"},[i("div",{staticClass:"left"},[i("div",[i("span",{staticClass:"uncheck",class:{checked:0==t.ROIS.length?"":t.ROIS.every(function(t){return!!t.image})},on:{click:t.checkall}}),t._v("\n                    ROI\n                ")])]),t._v(" "),i("div",{staticClass:"long"},[t._v("阳性肿瘤")]),t._v(" "),i("div",{staticClass:"total"},[t._v(t._s(t.$t("slice.total")))]),t._v(" "),i("div",{staticClass:"tps"},[t._v("TPS")]),t._v(" "),i("div",{staticClass:"option"},[t._v(t._s(t.$t("slice.deleted")))])]),t._v(" "),i("div",{staticClass:"rois"},t._l(t.ROIS,function(e,s){return i("div",{key:s},[i("div",{staticClass:"row",class:{curRoi:t.currentRois[e.id]},on:{click:function(i){t.$emit("closecontextmenu"),t.$emit("curROI",e,i.shiftKey)}}},[i("div",{staticClass:"left"},[i("div",[i("span",{staticClass:"uncheck",class:{checked:e.image},on:{click:function(i){return i.stopPropagation(),t.changeImage(e)}}}),t._v("\n                            "+t._s(s+1)+"\n                        ")])]),t._v(" "),i("div",{staticClass:"long",attrs:{title:e.aiResult.pos_tumor}},[t._v(t._s(e.aiResult.pos_tumor))]),t._v(" "),i("div",{staticClass:"total",attrs:{title:e.aiResult.total}},[t._v("\n                        "+t._s(e.aiResult.total)+"\n                    ")]),t._v(" "),i("div",{staticClass:"tps"},[t._v(t._s((100*e.aiResult.tps).toFixed(2)+"%")+"\n                    ")]),t._v(" "),i("div",{staticClass:"option"},[i("em",{staticClass:"eidt",attrs:{title:"详情"},on:{click:function(e){e.stopPropagation(),t.index===s?t.index=null:t.index=s}}}),t._v(" "),i("em",{attrs:{title:t.$t("upload.delete")},on:{click:function(i){return i.stopPropagation(),t.del(e)}}})])]),t._v(" "),t.index===s?i("div",{staticClass:"roi-detail"},[i("div",{staticClass:"detail-son"},[i("div",{staticClass:"left"},[t._v("1+")]),t._v(" "),i("div",{staticClass:"long"},[t._v(t._s(e.aiResult["1+"]))]),t._v(" "),i("div",{staticClass:"total"},[t._v(t._s(e.aiResult.total))]),t._v(" "),i("div",{staticClass:"tps"},[t._v(t._s((100*e.aiResult["1+tps"]).toFixed(2)+"%"))]),t._v(" "),i("div",{staticClass:"option"})]),t._v(" "),i("div",{staticClass:"detail-son"},[i("div",{staticClass:"left"},[t._v("2+")]),t._v(" "),i("div",{staticClass:"long"},[t._v(t._s(e.aiResult["2+"]))]),t._v(" "),i("div",{staticClass:"total"},[t._v(t._s(e.aiResult.total))]),t._v(" "),i("div",{staticClass:"tps"},[t._v(t._s((100*e.aiResult["2+tps"]).toFixed(2)+"%"))]),t._v(" "),i("div",{staticClass:"option"})]),t._v(" "),i("div",{staticClass:"detail-son"},[i("div",{staticClass:"left"},[t._v("3+")]),t._v(" "),i("div",{staticClass:"long"},[t._v(t._s(e.aiResult["3+"]))]),t._v(" "),i("div",{staticClass:"total"},[t._v(t._s(e.aiResult.total))]),t._v(" "),i("div",{staticClass:"tps"},[t._v(t._s((100*e.aiResult["3+tps"]).toFixed(2)+"%"))]),t._v(" "),i("div",{staticClass:"option"})])]):t._e()])}),0)]):t._e(),t._v(" "),t.ROIS?i("div",{staticClass:"cdbtm"},[i("div",{staticClass:"result",staticStyle:{color:"#D9001B"}},[i("div",[t._v("\n                阳性肿瘤细胞\n            ")]),t._v(" "),i("div",[t._v("\n                "+t._s(t.ROIS.filter(function(t){return t.image}).map(function(t){return t.aiResult.pos_tumor}).reduce(function(t,e){return t+e},0))+"\n            ")])]),t._v(" "),i("div",{staticClass:"result",staticStyle:{color:"#70B603"}},[i("div",[t._v("\n                阴性肿瘤细胞\n            ")]),t._v(" "),i("div",[t._v("\n                "+t._s(t.ROIS.filter(function(t){return t.image}).map(function(t){return t.aiResult.neg_tumor}).reduce(function(t,e){return t+e},0))+"\n            ")])]),t._v(" "),i("div",{staticClass:"result",staticStyle:{color:"#C280FF"}},[i("div",[t._v("\n                阳性非肿瘤细胞\n            ")]),t._v(" "),i("div",[t._v("\n                "+t._s(t.ROIS.filter(function(t){return t.image}).map(function(t){return t.aiResult.pos_norm}).reduce(function(t,e){return t+e},0))+"\n            ")])]),t._v(" "),i("div",{staticClass:"result",staticStyle:{color:"#FFFF00"}},[i("div",[t._v("\n                阴性非肿瘤细胞\n            ")]),t._v(" "),i("div",[t._v("\n                "+t._s(t.ROIS.filter(function(t){return t.image}).map(function(t){return t.aiResult.neg_norm}).reduce(function(t,e){return t+e},0))+"\n            ")])]),t._v(" "),i("div",{staticClass:"result",staticStyle:{color:"#F59A23"}},[i("div",[t._v("\n                阳性不确定细胞\n            ")]),t._v(" "),i("div",[t._v("\n                "+t._s(t.ROIS.filter(function(t){return t.image}).map(function(t){return t.aiResult.pos_cell_uncertain}).reduce(function(t,e){return t+e},0))+"\n                "),i("button",{on:{click:function(e){return t.$emit("adopt","withdraw",1)}}},[t._v("撤销")]),t._v(" "),i("button",{on:{click:function(e){return t.$emit("adopt","adopt",1)}}},[t._v("纳入")])])]),t._v(" "),i("div",{staticClass:"result",staticStyle:{color:"#02A7F0"}},[i("div",[t._v("\n                阴性不确定细胞\n            ")]),t._v(" "),i("div",[t._v("\n                "+t._s(t.ROIS.filter(function(t){return t.image}).map(function(t){return t.aiResult.neg_cell_uncertain}).reduce(function(t,e){return t+e},0))+"\n                "),i("button",{on:{click:function(e){return t.$emit("adopt","withdraw",2)}}},[t._v("撤销")]),t._v(" "),i("button",{on:{click:function(e){return t.$emit("adopt","adopt",2)}}},[t._v("纳入")])])]),t._v(" "),i("div",{staticClass:"result"},[i("div",[t._v("\n                肿瘤总数\n            ")]),t._v(" "),i("div",[t._v("\n                "+t._s(t.ROIS.filter(function(t){return t.image}).map(function(t){return t.aiResult.total}).reduce(function(t,e){return t+e},0))+"\n            ")])]),t._v(" "),i("div",{staticClass:"result"},[i("div",[t._v("\n                TPS\n            ")]),t._v(" "),i("div",[t._v("\n                "+t._s(t.ave)+"%\n            ")])])]):t._e(),t._v(" "),i("div",{staticClass:"recheck"},[i("div",{staticClass:"doc-check"},[i("i",[t._v("医生复核")]),t._v(" "),i("span",{on:{click:function(e){return t.changeResult("")}}},[t._v("清空")]),t._v(" "),i("span",{on:{click:function(e){return t.changeResult(t.ave)}}},[t._v("采纳AI建议")])]),t._v(" "),i("div",{staticClass:"check-result"},[t._v("指数"),i("input",{directives:[{name:"model",rawName:"v-model",value:t.checkResult,expression:"checkResult"}],domProps:{value:t.checkResult},on:{blur:function(e){return t.changeResult(t.checkResult)},input:function(e){e.target.composing||(t.checkResult=e.target.value)}}}),t._v("%")])])])},staticRenderFns:[]};var Ki=i("VU/8")(Wi,qi,!1,function(t){i("oHR0"),i("EuHb")},null,null).exports,Zi={data:()=>({typeOptions:[{value:1,label:"外周T细胞淋巴瘤"},{value:2,label:"弥漫大B细胞淋巴瘤"},{value:3,label:"B细胞淋巴瘤"},{value:4,label:"T细胞淋巴瘤"}],labeltree:[{id:257,label:"阴性肿瘤细胞"},{id:258,label:"阳性肿瘤细胞-1+"},{id:259,label:"阳性肿瘤细胞-2+"},{id:260,label:"阳性肿瘤细胞-3+"},{id:261,label:"阴性非肿瘤细胞"},{id:262,label:"阳性非肿瘤细胞-1+"},{id:263,label:"阳性非肿瘤细胞-2+"},{id:264,label:"阳性非肿瘤细胞-3+"},{id:265,label:"纤维细胞"},{id:277,label:"阳性不确定细胞-1+"},{id:278,label:"阳性不确定细胞-2+"},{id:279,label:"阳性不确定细胞-3+"},{id:280,label:"阴性不确定细胞"}],roiTypeOpitions:{257:"#70B603",258:"#D9001B",259:"#D9001B",260:"#D9001B",261:"#FFFF00",262:"#C280FF",263:"#C280FF",264:"#C280FF",265:"#FFFF00",277:"#F59A23",278:"#F59A23",279:"#F59A23",280:"#02A7F0"},defaultColor:"#70B603",defaultType:257,model_type:1}),methods:{isDrawMpp(){this.startAnalyze()},adopt(t,e){let i="adopt"===t?`slice/adopt?companyid=${Object(s.s)().company}`:`slice/revoke?companyid=${Object(s.s)().company}`;const n="adopt"===t?{adopt_type:e,caseid:this.record.id,fileid:this.slice.id}:{revoke_type:e,caseid:this.record.id,fileid:this.slice.id},a="adopt"===t?"纳入成功":"撤销成功";Object(s.b)(i,n).then(async()=>{this.$message.success(a),this.aiFatherRois=await Object(s.p)(this.record.id,this.slice.id,"cd30"),this.curRois={},this.leftRoilist=await Object(s.n)(this.record.id,this.slice.id,this.curLevel,"cd30")}).catch(t=>this.$message.error(t.message))}},computed:{ave(){return(this.aiFatherRois.filter(t=>t.image).map(t=>t.aiResult.pos_tumor).reduce((t,e)=>t+e,0)/((this.aiFatherRois.filter(t=>t.image).map(t=>t.aiResult.pos_tumor).reduce((t,e)=>t+e,0)||0)+this.aiFatherRois.filter(t=>t.image).map(t=>t.aiResult.neg_tumor).reduce((t,e)=>t+e,0)||1)*100).toFixed(2)}},components:{"v-dragon":v.a,"v-analyroi":Ki,"v-roi":m,"v-menus":V},mixins:[G.a]},Qi={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"cnt",attrs:{tabIndex:0},on:{keydown:t.keydown}},[i("div",{staticClass:"analyright",on:{mousewheel:function(e){t.ki67Anno=null},mousedown:function(e){t.ki67Anno=null}}},[i("v-dragon",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],ref:"osd",staticClass:"dragon",attrs:{record:t.record,slice:t.slice,roilist:t.leftRoilist,curRois:t.curRois,penColor:t.auto?"grey":"yellow",centerRegion:t.centerRegion,position:t.position,showMppGuide:t.showMppGuide,cellArea:110,"element-loading-text":"处理中，请耐心等待","element-loading-spinner":"el-icon-loading","element-loading-background":"rgba(0, 0, 0, 0.5)"},on:{curROI:t.curROIChange,draw:t.draw,delRoi:function(e){return t.delCurRoi(e)},position:function(e,i,s){t.$set(t.position,"offx",e),t.$set(t.position,"offy",i),t.$set(t.position,"zoom",s),t.$set(t.slice,"position",t.position)},closeMppGuide:function(e){t.showMppGuide=!1},changeMpp:function(e){return t.drawMpp=e},clickDraw:t.clickDraw,getRoi:function(e){return t.getRoi(e)},roiChanged:t.roiChanged,parentId:function(e){return t.parentId=e},contextmenu:function(e,i){return t.showMenu(e,i)}}},[t.ki67Anno?i("div",{staticStyle:{position:"absolute"},style:{left:t.menuPosition.x+"px",top:t.menuPosition.y+"px"}},[i("v-menus",{attrs:{pos:t.ki67Anno,menus:t.labeltree,currentItem:t.currentItem,newover:t.newover},on:{chosen:function(e){return t.setAnnotation(e)}}})],1):t._e()]),t._v(" "),t.showbutton?i("button",{on:{click:function(e){return t.isDrawMpp()}}},[t._v(t._s(t.$t("slice.start")))]):t._e(),t._v(" "),i("el-select",{staticClass:"m-2",model:{value:t.model_type,callback:function(e){t.model_type=e},expression:"model_type"}},t._l(t.typeOptions,function(t){return i("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})}),1)],1),t._v(" "),i("div",{staticClass:"analylist"},[i("div",{staticClass:"quality"},[t._m(0),t._v(" "),i("div",{staticClass:"quality-detail"},[i("p",{staticStyle:{width:"50%",margin:"0"}},[t._v("清 晰 度："+t._s(t.slice.clarity?(100*t.slice.clarity).toFixed(2)+"%":"-"))]),t._v(" "),i("p",{staticStyle:{width:"50%",margin:"0"}},[t._v("扫描倍数："+t._s(t.slice.objective_rate||"-"))])])]),t._v(" "),i("h2",[i("span",{class:t.auto?"auto":"",on:{click:function(e){t.auto=!0}}},[t._v("AI处理")]),t._v(" "),i("span",{class:t.auto?"":"noauto",on:{click:function(e){t.auto=!1}}},[t._v("手动处理")])]),t._v(" "),t.auto?i("v-analyroi",{staticClass:"table",attrs:{slice:t.slice,ROIS:t.aiFatherRois,ave:t.ave,currentRois:t.curRois},on:{curROI:function(e,i){return t.curROIChange(e,i)+t.listChangeCurrent()},delRoi:function(e){return t.delCurRoi(e)},roiChanged:t.roiChanged,update:function(e){return t.reCheck(e?e+"%":"")},closecontextmenu:function(e){t.ki67Anno=null},adopt:t.adopt}}):t._e(),t._v(" "),t.auto?t._e():i("v-roi",{staticClass:"manualroi",attrs:{roilist:t.rightRoilist,currentRois:t.curRois},on:{curROI:function(e,i){return t.curROIChange(e,i)+t.listChangeCurrent()},delRoi:function(e){return t.delCurRoi(e)},roiChanged:t.roiChanged}}),t._v(" "),!t.showbutton&&t.auto?i("div",{staticClass:"loding"},[i("div",{staticClass:"video"},[i("img",{attrs:{src:"/static/video/loading.gif"}}),t._v(" "),0==t.lineup?i("div",{staticClass:"lineup"},[t._v("正在处理...")]):t._e(),t._v(" "),t.lineup>0?i("div",{staticClass:"lineup"},[t._v(t._s(t.$t("slice.lineup"))+" "),i("span",{staticStyle:{color:"#4C9FFA","font-size":"18px","font-weight":"bolder"}},[t._v(t._s(t.lineup))]),t._v(" "+t._s(t.$t("slice.position")))]):t._e()]),t._v(" "),i("div",{staticClass:"cancel",on:{click:t.canceltesk}},[t._v(t._s(t.$t("slice.cancelTasks")))])]):t._e()],1)])},staticRenderFns:[function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"title"},[e("span",[this._v("AI质控")])])}]};var ts=i("VU/8")(Zi,Qi,!1,function(t){i("b+/A")},"data-v-495e095b",null).exports,es={name:"v-menus",props:["menus","currentItem","pos","newover"],data(){var t={position:{},over:this.newover.substring(0,this.newover.indexOf(":"))||this.newover,curWidth:0,childPos:{}};return this.pos&&"top"==this.pos.vd?t.position.top=0:this.pos&&"bottom"==this.pos.vd&&(t.position.bottom=0),this.pos&&"left"==this.pos.hd?t.position.left=0:this.pos&&"right"==this.pos.hd&&(t.position.right=0),t},methods:{mouseOver(t){this.over=t}},updated(){this.curWidth=this.$refs[this.over].clientWidth+5},watch:{over:{immediate:!0,handler(){this.$nextTick(()=>{this.curWidth=this.$refs[this.over].clientWidth+5})}},pos:{immediate:!0,handler(){this.$nextTick(()=>{this.childPos={hd:this.pos&&this.pos.hd,vd:this.pos&&"top"==this.pos.vd?"bottom":"top"}})}}},components:{"v-menus":ss}},is={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{ref:t.over,staticClass:"container",style:t.position},t._l(t.menus,function(e,s){return i("div",{key:s,staticClass:"item",class:t.over==e.id?"active":"",on:{mouseover:function(i){return t.mouseOver(e.id)},mousedown:function(t){return t.stopPropagation(),t},click:function(i){i.stopPropagation(),(!e.children||!e.children.length)&&t.$emit("chosen",e.id)}}},[t.currentItem&&t.currentItem.split(":")[0]==e.id?i("span",{staticClass:"left"}):t._e(),t._v("\n        "+t._s(e.label)+"\n        "),e.id==t.over&&e.children?i("v-menus",{key:s,style:{transform:"translate("+("left"==t.pos.hd?t.curWidth+"px":-t.curWidth+"px")+",0"},attrs:{newover:t.currentItem&&t.currentItem.split(":").length>2?t.currentItem.substring(t.currentItem.indexOf(":")+1):t.currentItem.split(":")[0],menus:e.children,currentItem:t.currentItem&&t.currentItem.split(":").slice(1).join(":"),pos:t.childPos},on:{chosen:function(e){return t.$emit("chosen",e)}}}):t._e(),t._v(" "),e.children&&e.children.length?i("span",{staticClass:"right"}):t._e()],1)}),0)},staticRenderFns:[]};var ss=i("VU/8")(es,is,!1,function(t){i("soCW")},"data-v-042673f7",null).exports,ns={props:["slice","record","config"],components:{"v-dragon":v.a,"v-roi":m,"v-menus":ss},data(){return{curLevel:{},rightRoilist:[],aiFatherRois:[],curRois:{},ki67Anno:null,showMppGuide:!1,showbutton:!0,lineup:null,loopHandler:0,centerRegion:null,position:{offx:this.slice.position?this.slice.position.offx:.5,offy:this.slice.position?this.slice.position.offy:.5*this.slice.height/this.slice.width,zoom:this.slice.position?this.slice.position.zoom:null},parentId:null,loading:!1,currentItem:"",newover:"",auto:"one",leftRoilist:[],aiRoilist:[],humanRoilist:[],options:["HSIL","ASC-H","LSIL","ASC-US","AGC"],showType:"HSIL",showHumanType:"HSIL",aiResult:{},humanResult:{},cells:[],docResult:{microbe:[],background:[],tps:[],diagnosis:""},showTips:!1,labeltree:[{id:"骨髓细胞分类-红系",label:"骨髓细胞分类-红系",children:[{id:"原始红细胞",label:"原始红细胞"},{id:"中幼红细胞",label:"中幼红细胞"},{id:"早幼红细胞",label:"早幼红细胞"},{id:"晚幼红细胞",label:"晚幼红细胞"}]},{id:"骨髓细胞分类-单核系",label:"骨髓细胞分类-单核系",children:[{id:"原始单核细胞",label:"原始单核细胞"},{id:"单核细胞",label:"单核细胞"},{id:"异常单核细胞（PB）",label:"异常单核细胞（PB）"},{id:"幼稚单核细胞",label:"幼稚单核细胞"}]},{id:"骨髓细胞分类-巨核系",label:"骨髓细胞分类-巨核系",children:[{id:"原始巨核细胞",label:"原始巨核细胞"},{id:"幼稚巨核细胞",label:"幼稚巨核细胞"},{id:"颗粒型巨核细胞",label:"颗粒型巨核细胞"},{id:"产版型巨核细胞",label:"产版型巨核细胞"},{id:"裸核型巨核细胞",label:"裸核型巨核细胞"}]},{id:"骨髓细胞分类-浆细胞",label:"骨髓细胞分类-浆细胞",children:[{id:"浆细胞",label:"浆细胞"},{id:"骨髓瘤细胞",label:"骨髓瘤细胞"}]},{id:"骨髓细胞分类-Auer小体",label:"骨髓细胞分类-Auer小体",children:[{id:"柴捆细胞",label:"柴捆细胞"},{id:"含Auer小体细胞",label:"含Auer小体细胞"}]},{id:"骨髓细胞分类-Artefacts",label:"骨髓细胞分类-Artefacts",children:[{id:"Smudge cell",label:"Smudge cell"},{id:"Artefact",label:"Artefact"}]},{id:"骨髓细胞分类-淋巴系",label:"骨髓细胞分类-淋巴系",children:[{id:"原始淋巴细胞",label:"原始淋巴细胞"},{id:"淋巴细胞",label:"淋巴细胞"},{id:"反应性淋巴细胞",label:"反应性淋巴细胞"},{id:"大颗粒淋巴细胞",label:"大颗粒淋巴细胞"},{id:"毛细胞",label:"毛细胞"},{id:"套细胞",label:"套细胞"},{id:"滤泡细胞",label:"滤泡细胞"},{id:"Burkkit细胞",label:"Burkkit细胞"},{id:"淋巴瘤细胞（其他）",label:"淋巴瘤细胞（其他）"},{id:"幼稚淋巴细胞",label:"幼稚淋巴细胞"}]},{id:"骨髓细胞分类-粒系",label:"骨髓细胞分类-粒系",children:[{id:"原始粒细胞",label:"原始粒细胞"},{id:"早幼粒细胞",label:"早幼粒细胞"},{id:"中性中幼粒细胞",label:"中性中幼粒细胞"},{id:"中性杆状核粒细胞",label:"中性杆状核粒细胞"},{id:"嗜酸性粒细胞",label:"嗜酸性粒细胞"},{id:"嗜碱性粒细胞",label:"嗜碱性粒细胞"},{id:"异常早幼粒细胞",label:"异常早幼粒细胞"},{id:"异常中幼粒细胞t(8,21)",label:"异常中幼粒细胞t(8,21)"},{id:"异常嗜酸性粒细胞 inv(16)",label:"异常嗜酸性粒细胞 inv(16)"},{id:"中性晚幼粒细胞",label:"中性晚幼粒细胞"},{id:"中性分叶核粒细胞",label:"中性分叶核粒细胞"}]},{id:"骨髓细胞分类-其他细胞",label:"骨髓细胞分类-其他细胞",children:[{id:"成骨细胞",label:"成骨细胞"},{id:"破骨细胞",label:"破骨细胞"},{id:"戈谢细胞",label:"戈谢细胞"},{id:"海蓝细胞",label:"海蓝细胞"},{id:"尼曼匹克细胞",label:"尼曼匹克细胞"},{id:"分裂象",label:"分裂象"},{id:"转移瘤细胞",label:"转移瘤细胞"},{id:"吞噬细胞",label:"吞噬细胞"}]},{id:"MDS病态造血-红系",label:"MDS病态造血-红系",children:[{id:"核异常-核出芽",label:"核异常-核出芽"},{id:"核异常-核间桥",label:"核异常-核间桥"},{id:"核异常-核碎裂",label:"核异常-核碎裂"},{id:"核异常-多个核",label:"核异常-多个核"},{id:"胞浆异常-胞浆空泡",label:"胞浆异常-胞浆空泡"},{id:"大小异常-巨幼样变",label:"大小异常-巨幼样变"}]},{id:"MDS病态造血-粒系",label:"MDS病态造血-粒系",children:[{id:"核异常-分叶过多",label:"核异常-分叶过多"},{id:"核异常-分叶减少",label:"核异常-分叶减少"},{id:"胞浆异常-颗粒减少",label:"胞浆异常-颗粒减少"},{id:"胞浆异常-杜勒小体",label:"胞浆异常-杜勒小体"},{id:"胞浆异常-Auer小体",label:"胞浆异常-Auer小体"},{id:"大小异常-巨幼样变",label:"大小异常-巨幼样变"}]},{id:"MDS病态造血-巨核系",label:"MDS病态造血-巨核系",children:[{id:"大小异常-微小巨核",label:"大小异常-微小巨核"},{id:"大小异常-单圆巨核",label:"大小异常-单圆巨核"},{id:"大小异常-多圆巨核",label:"大小异常-多圆巨核"},{id:"核异常-核分叶减少",label:"核异常-核分叶减少"}]},{id:"MPN巨核细胞",label:"MPN巨核细胞",children:[{id:"CML-侏儒状巨核",label:"CML-侏儒状巨核"},{id:"ET-鹿角状巨核",label:"ET-鹿角状巨核"},{id:"PMF-气球状巨核",label:"PMF-气球状巨核"}]},{id:"原虫及真菌",label:"原虫及真菌",children:[{id:"疟原虫",label:"疟原虫"},{id:"利杜体",label:"利杜体"},{id:"马尔尼菲青霉菌",label:"马尔尼菲青霉菌"},{id:"荚膜组织胞浆菌",label:"荚膜组织胞浆菌"}]},{id:"血小板",label:"血小板",children:[{id:"血小板",label:"血小板"}]}],roiTypeOpitions:{HSIL:"#FF8A01",ASCH:"#FF8A01",LSIL:"#FF8A01","ASC-US":"#FF8A01",AGC:"#FF8A01","阴性":"#039D12","异物":"#039D12","滴虫":"#0000FF","霉菌":"#0000FF","线索":"#0000FF","放线菌":"#0000FF","疱疹":"#0000FF","不确定":"yellow"},contextmenuPosition:null,observer:null,curModule:"cellresult",clickTimer:null,currentFatherCellGroupIndex:0,currentSonCellGroupIndex:0,currentHumanFatherCellGroupIndex:0,currentHumanSonCellGroupIndex:0}},methods:{reCheck(t){this.$set(this.slice,"check_result",t),this.slice.alg!=this.alg&&(this.$set(this.slice,"alg",this.alg),this.$set(this.slice,"ai_suggest",null)),this.$emit("save")},getNum:(t,e)=>t+e,async start(t=this.record.id,e=this.slice.id,i=this.slice.filename){let n=this.aiFatherRois.filter(t=>!t.aiResult.whole_slide).map(t=>({id:t.id,x:t.path.x,y:t.path.y}));this.$set(this.slice,"ai_dict",Object.assign(this.slice.ai_dict,{[this.alg+"Started"]:!0})),this.$set(this.slice,"alg",this.alg),this.$set(this.slice,"ai_suggest",null),this.$set(this.slice,"check_result",null),this.showbutton=!1,this.auto="one",this.aiFatherRois.length&&"fishTissue"!=this.alg&&(this.aiFatherRois.map(t=>t.image=1),await Object(s.e)(t,e,this.alg,this.aiFatherRois.map(t=>({id:t.id,image:t.image})),null)),console.log(t),await Object(s.r)(t,e,i,this.alg,JSON.stringify(n),this.model_type),this.curRois={},this.leftRoilist=await Object(s.n)(t,e,this.curLevel,this.alg),this.aiFatherRois=await Object(s.p)(t,e,this.alg),Object.values(this.curRois).map(t=>this.leftRoilist.every(e=>t.id!=e.id)?delete this.curRois[t.id]:""),this.getAlgorithmResult()},curROIChange(t,e){var i;t?t.length?i=t:e&&this.curRois[t.id]?(delete this.curRois[t.id],i=[]):i=[t]:i=[],["tct1","tct2","lct1","lct2","bm"].includes(this.alg)?this.curRois=Object.assign({},e&&this.curRois,...i.map(t=>({[t.id]:t}))):this.curRois=Object.assign({},e&&this.curRois,...i.filter(t=>!t.aiResult||!t.aiResult.whole_slide).map(t=>({[t.id]:t})))},async roiChanged(t,e){let i;i=e?e.map(e=>e.dna_index?{id:e.id,[t]:e[t],area_id:e.area_id,iconType:"dnaIcon"}:{id:e.id,[t]:e[t],area_id:e.area_id}):Object.values(this.curRois).map(e=>({id:e.id,[t]:e[t],area_id:e.area_id}));let n="image"==t||"remark"==t?null:this.$refs.osd.scope;n&&n.offset&&(this.curRois={},this.$refs.osd.scope=null),n?this.$message.error("不支持多选移动"):(this.loading=!0,await Object(s.e)(this.record.id,this.slice.id,this.alg,i,n),this.loading=!1),["tct1","tct2","lct1","lct2","fishTissue","dna","bm"].includes(this.alg)?this.leftRoilist=await Object(s.n)(this.record.id,this.slice.id,this.curLevel,this.alg):(this.aiFatherRois=await Object(s.p)(this.record.id,this.slice.id,this.alg),this.rightRoilist=await Object(s.p)(this.record.id,this.slice.id),this.leftRoilist=await Object(s.n)(this.record.id,this.slice.id,this.curLevel,this.alg)),this.IsOutFrame()},IsOutFrame(){Object.keys(this.curRois).map(t=>{this.leftRoilist.some(e=>e.id==t)||(delete this.curRois[t],this.curRois=Object.assign({},this.curRois))})},listChangeCurrent(){if(Object.keys(this.curRois).length){var t=[].concat.apply([],Object.values(this.curRois).map(t=>t.path.x)),e=[].concat.apply([],Object.values(this.curRois).map(t=>t.path.y));t.length?this.centerRegion=[Math.min.apply(null,t),Math.min.apply(null,e),Math.max.apply(null,t),Math.max.apply(null,e)]:this.centerRegion=null,this.$refs.osd.scope=null}},async clickDraw(t,e){if(this.auto){if(!this.showbutton)return void this.$message({message:"计算中不能标注",type:"warning"});let n,a=this.leftRoilist.find(t=>t.id===this.parentId);if((n=this.aiFatherRois.some(t=>t.aiResult.whole_slide)?this.aiFatherRois.find(t=>t.aiResult.whole_slide):this.aiFatherRois.find(t=>t.id===this.parentId))||a&&2==a.mark_type){let o="cd30"===this.alg?4.131514365275448:1/(this.slice.mppx||.242042);if((i={path:{x:[t.x],y:[t.y]},method:"spot",radius:o,area_id:n?n.id:a.area_id,mark_type:2,ai_type:this.alg,type:"number"==typeof ki67remark?ki67remark:this.defaultType,fillColor:"number"==typeof ki67remark?this.roiTypeOpitions[ki67remark]:this.defaultColor}).id=await Object(s.h)(this.record.id,this.slice.id,i),!i.id)return;e?Object.assign(this.curRois,{[i.id]:i}):this.curRois={[i.id]:i},this.leftRoilist=[...this.leftRoilist,i],this.aiFatherRois=await Object(s.p)(this.record.id,this.slice.id,this.alg)}else this.$message({message:"只能在处理ROI区域内打点",type:"warning"})}else{var i;if((i={path:{x:[t.x],y:[t.y]},method:"spot",radius:3/(this.slice.mppx||.242042),mark_type:1,fillColor:"yellow"}).id=await Object(s.h)(this.record.id,this.slice.id,i),!i.id)return;this.curROIChange(i,e),this.leftRoilist=[...this.leftRoilist,i],this.rightRoilist=await Object(s.p)(this.record.id,this.slice.id)}},keydown(t){"Delete"!=t.key&&"Backspace"!=t.key||!Object.keys(this.curRois).length||this.delCurRoi()},goTocurRoi(t,e){this.curROIChange(t,e),this.listChangeCurrent()},showMenu(t,e){if((!t.type||t.button)&&(t.preventDefault(),0!=Object.keys(this.curRois).length&&!Object.keys(this.curRois).every(t=>t!=e.id))){var i=t.currentTarget,s=t.offsetX,n=t.offsetY,a=i.offsetWidth,o=i.offsetHeight;if(this.contextmenuPosition={},this.contextmenuPosition.hd=s>a/2?"right":"left",this.contextmenuPosition.vd=n>o/2?"bottom":"top",this.menuPosition={x:s,y:n},this.curRois[e.id]){let t=this.labeltree.find(t=>t.id==e.doctorDiagnosis),i=this.labeltree.filter(t=>t.children);if(t)this.currentItem=t.id+":"+t.id;else{let t=[];i.forEach(e=>{t.push(e.children.map(t=>Object.assign({},t,{fatherId:e.id})))});let s=t.flat().find(t=>t.id==e.doctorDiagnosis);this.currentItem=s?s.fatherId+":"+e.doctorDiagnosis:e.doctorDiagnosis+":"+e.doctorDiagnosis}this.newover=this.currentItem.substring(0,this.currentItem.lastIndexOf(":"))}}},async setAnnotation(t){for(var e in this.contextmenuPosition=null,this.curRois){let i=this.curRois[e];if(i.dashed)this.curRois[e]=Object.assign({},i,{strokeColor:"yellow",doctorDiagnosis:t});else{let e=Object.assign({},{path:i.path,dashed:1,doctorDiagnosis:t,strokeColor:"yellow",ai_type:"human_bm",mark_type:1,method:"rectangle"});await Object(s.h)(this.record.id,this.slice.id,e)}}var i=Object.assign({},this.curRois),n=Object.assign({},n,...Object.values(i).filter(t=>t.dashed).map(t=>({[t.id]:t})));this.curRois={},Object.keys(n).length&&(this.loading=!0,await Object(s.e)(this.record.id,this.slice.id,"human_bm",Object.values(n).map(t=>({id:t.id,strokeColor:t.strokeColor,doctorDiagnosis:t.doctorDiagnosis}))),this.loading=!1),this.leftRoilist=await Object(s.n)(this.record.id,this.slice.id,this.curLevel,this.alg),this.humanResult=await this.getHumanResult(),this.humanRoilist=this.humanResult[this.currentHumanFatherCellGroupIndex].data[this.currentHumanSonCellGroupIndex].data||[]},setShowType(){this.currentFatherCellGroupIndex=0,this.currentSonCellGroupIndex=0},changeImage(t){this.$set(t,"image",1-(t.image||0)),this.roiChanged("image",[t])},change(t,e){"阴性"===t&&(this.docResult.tps=[]),this.docResult[e]=t,this.check()},accept(){this.docResult=Object.assign({},{microbe:this.aiResult.microbe,tps:[this.aiResult.diagnosis[1]],diagnosis:this.aiResult.diagnosis[0],background:[]}),this.check()},clearCheckReslut(){this.$confirm("确认清空复核结果？","提示",{cancelTextButtom:"取消",confirmTextButtom:"确定"}).then(()=>{this.docResult={microbe:[],background:[],tps:[],diagnosis:""},this.check()}).catch(()=>!1)},check(){this.$set(this.slice,"check_result",this.docResult.diagnosis+" "+this.docResult.tps.join("+")+" "+this.docResult.microbe.join(",")+" "+this.docResult.background.join(",")),this.$set(this.slice,"alg",this.slice.toolType),this.$emit("save")},toggleCellsGroup(t,e){"father"==e?this.currentFatherCellGroupIndex!==t&&(this.currentFatherCellGroupIndex=t,this.currentSonCellGroupIndex=0,this.aiRoilist=this.aiResult.cells[this.currentFatherCellGroupIndex].data[this.currentSonCellGroupIndex].data):"son"==e?(this.currentSonCellGroupIndex=t,this.aiRoilist=this.aiResult.cells[this.currentFatherCellGroupIndex].data[this.currentSonCellGroupIndex].data):(this.currentFatherCellGroupIndex=0,this.currentSonCellGroupIndex=0,this.aiRoilist=this.aiResult.cells[this.currentFatherCellGroupIndex].data[this.currentSonCellGroupIndex].data),this.$nextTick(()=>{let t=this.$refs.aiRoilist;t&&(t.scrollTop=0,t.removeEventListener("scroll",this.scrollHander),t.addEventListener("scroll",this.scrollHander))}),this.startOberserve()},async toogleHumanType(t,e){"father"==e?this.currentHumanFatherCellGroupIndex!==t&&(this.currentHumanFatherCellGroupIndex=t,this.currentHumanSonCellGroupIndex=0,this.humanRoilist=this.humanResult[this.currentHumanFatherCellGroupIndex].data[this.currentHumanSonCellGroupIndex].data):"son"==e?(this.currentHumanSonCellGroupIndex=t,this.humanRoilist=this.humanResult[this.currentHumanFatherCellGroupIndex].data[this.currentHumanSonCellGroupIndex].data):(this.currentHumanFatherCellGroupIndex=0,this.currentHumanSonCellGroupIndex=0,this.humanRoilist=this.humanResult[this.currentHumanFatherCellGroupIndex].data[this.currentHumanSonCellGroupIndex].data)},async getRoi(t){let{x1:e,y1:i,x2:n,y2:a,z:o}=t;this.curLevel={x:[e,n],y:[i,a],z:o},this.leftRoilist.length||(this.leftRoilist=[...await Object(s.n)(this.record.id,this.slice.id,this.curLevel,this.alg)]),this.leftRoilist=[...await Object(s.n)(this.record.id,this.slice.id,this.curLevel,this.alg)]},async draw(t,e){t.strokeColor="yellow",t.mark_type=1,t.dashed=1,t.ai_type="human_bm",t.doctorDiagnosis="无",t.id=await Object(s.h)(this.record.id,this.slice.id,t),t.id&&(this.curROIChange(t,e),this.leftRoilist=[...this.leftRoilist,t],this.humanResult=await this.getHumanResult(),this.humanRoilist=this.humanResult[this.currentHumanFatherCellGroupIndex].data[this.currentHumanSonCellGroupIndex].data,this.IsOutFrame())},async delCurRoi(t){if(t)this.loading=!0,await Object(s.i)(this.record.id,this.slice.id,"human_bm",[t.id],null),this.loading=!1,this.curRois[t.id]&&(delete this.curRois[t.id],this.curRois=Object.assign({},this.curRois)),this.humanResult=await this.getHumanResult(),this.humanRoilist=this.humanResult[this.currentHumanFatherCellGroupIndex].data[this.currentHumanSonCellGroupIndex].data,this.leftRoilist=await Object(s.n)(this.record.id,this.slice.id,this.curLevel,this.slice.toolType);else if(await this.$confirm(this.$t("analaysisPanel.delete"),{confirmButtonText:this.$t("confirm.confirm"),cancelButtonText:this.$t("confirm.quit"),type:"warning"}).catch(()=>{})){let t=Object.values(this.curRois).filter(t=>t.dashed).map(t=>t.id);if(!t.length)return;this.loading=!0,await Object(s.i)(this.record.id,this.slice.id,"human_bm",t,this.$refs.osd.scope),this.loading=!1,this.humanResult=await this.getHumanResult(),this.humanRoilist=this.humanResult[this.currentHumanFatherCellGroupIndex].data[this.currentHumanSonCellGroupIndex].data,this.curRois={},this.leftRoilist=await Object(s.n)(this.record.id,this.slice.id,this.curLevel,this.slice.toolType)}},getAlgorithmResult(t=this.record.id,e=this.slice.id,i=this.slice.filename){Object(s.b)("ai/getresult",{caseid:t,fileid:e,filename:i,type:this.slice.toolType,other:this.config&&this.config.mode?"cs":""}).then(async t=>{this.lineup=t.data.rank,t.data.done?(this.showbutton=!0,this.loopHandler=0,-1==t.data.rank&&(this.aiResult=await this.getAiResult(),this.aiRoilist=this.aiResult.cells[this.currentFatherCellGroupIndex].data[this.currentSonCellGroupIndex].data,this.cells=this.aiResult.cells,this.$set(this.slice,"ai_suggest",this.aiResult.diagnosis),this.$set(this.slice,"cell_num",this.aiResult.cell_num),this.$set(this.slice,"slide_quality",this.aiResult.slide_quality)),this.$set(this.slice,"ai_dict",Object.assign(this.slice.ai_dict,{[this.slice.toolType+"Started"]:!1})),this.startOberserve()):(this.showbutton=!1,this.loopHandler=setTimeout(()=>{this.getAlgorithmResult()},5e3))})},async getAiResult(){return new Promise(t=>{Object(s.b)(`slice/getROIList?companyid=${Object(s.s)().company}`,{caseid:this.record.id,fileid:this.slice.id,ai_type:this.slice.toolType,other:this.config&&this.config.mode?"cs":""}).then(({data:e})=>{e.ROIS.length?t(e.ROIS[0].aiResult):t({})}).catch(e=>t({}))})},async getHumanResult(){return new Promise(t=>{Object(s.b)(`slice/getROIList?companyid=${Object(s.s)().company}`,{caseid:this.record.id,fileid:this.slice.id,ai_type:"human_bm",other:this.config&&this.config.mode?"cs":""}).then(({data:e})=>{t(e.ROIS)}).catch(e=>t({}))})},async startAnalyze(t=this.record.id,e=this.slice.id,i=this.slice.filename){this.$set(this.slice,"ai_dict",Object.assign(this.slice.ai_dict,{[this.slice.toolType+"Started"]:!0})),this.$set(this.slice,"alg",this.slice.toolType),this.$set(this.slice,"ai_suggest",null),this.$set(this.slice,"check_result",null),this.$set(this.slice,"cell_num",null),this.$set(this.slice,"slide_quality",""),this.removeObserver(),this.showbutton=!1,this.auto="one",await Object(s.r)(t,e,i,this.slice.toolType,this.config&&this.config.mode?"cs":""),this.leftRoilist=await Object(s.n)(this.record.id,this.slice.id,this.curLevel,this.slice.toolType),this.aiResult=await this.getAiResult(),this.humanResult=await this.getHumanResult(),this.aiRoilist=this.aiResult.cells[this.currentFatherCellGroupIndex].data[this.currentSonCellGroupIndex].data||[],this.humanRoilist=this.humanResult[this.currentHumanFatherCellGroupIndex].data[this.currentHumanSonCellGroupIndex].data||[],Object.values(this.curRois).map(t=>this.leftRoilist.every(e=>t.id!=e.id)?delete this.curRois[t.id]:""),this.getAlgorithmResult()},canceltesk(){Object(s.b)("ai/revokeTask",{caseid:this.record.id,fileid:this.slice.id,type:this.slice.toolType,other:this.config&&this.config.mode?"cs":""}).then(async t=>{0==t.code&&(clearTimeout(this.loopHandler),this.loopHandler=0,this.showbutton=!0,this.$set(this.slice,"ai_dict",Object.assign(this.slice.ai_dict,{[this.slice.toolType+"Started"]:!1})),this.aiResult=await this.getAiResult(),this.cells=this.aiResult.cells)}).catch(t=>console.log(t))},scrollHander(){let t=this.$refs.aiRoilist;t.scrollTop+t.clientHeight==t.scrollHeight&&this.cells[this.currentFatherCellGroupIndex].data[this.currentSonCellGroupIndex].num>100?this.showTips=!0:this.showTips=!1},startOberserve(){this.observer&&this.removeObserver(),this.$nextTick(()=>{if(this.aiRoilist.length){document.querySelectorAll(".img-content img").forEach(t=>{this.observer.observe(t)})}})},removeObserver(){document.querySelectorAll(".img-content img").forEach(t=>{this.observer.disconnect(t)})},changeTab(t){this.auto!==t&&(this.auto=t,"one"===t&&this.startOberserve())}},async mounted(){this.aiResult=await this.getAiResult(),this.humanResult=await this.getHumanResult(),this.setShowType(),this.aiRoilist=this.aiResult.cells[this.currentFatherCellGroupIndex].data[this.currentSonCellGroupIndex].data||[],this.humanRoilist=this.humanResult[this.currentHumanFatherCellGroupIndex].data[this.currentHumanSonCellGroupIndex].data||[],this.cells=this.aiResult.cells,this.observer=new IntersectionObserver(t=>{t.forEach(t=>{t.intersectionRatio>0&&!t.target.src&&(t.target.src=t.target.dataset.src)})}),this.startOberserve(),this.$nextTick(()=>{let t=this.$refs.aiRoilist;t&&t.removeEventListener("scroll",this.scrollHander),t&&t.addEventListener("scroll",this.scrollHander)}),this.slice.ai_dict[[this.alg+"Started"]]?this.getAlgorithmResult():this.showbutton=!0},beforeDestroy(){let t=this.$refs.aiRoilist;t&&t.removeEventListener("scroll",this.scrollHander),this.removeObserver(),clearTimeout(this.loopHandler),this.loopHandler=0},watch:{"slice.id":{handler(){clearTimeout(this.loopHandler),this.loopHandler=0}}},computed:{alg(){return"fish"===this.slice.toolType?"fishTissue":this.slice.toolType},userInfo:()=>Object(s.s)()}},as={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"cnt",staticStyle:{width:"100%"},attrs:{tabIndex:0},on:{keydown:t.keydown,mousewheel:function(e){t.contextmenuPosition=null},mousedown:function(e){t.contextmenuPosition=null}}},[i("div",{staticClass:"analyright"},[i("v-dragon",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],ref:"osd",staticClass:"dragon",attrs:{record:t.record,slice:t.slice,roilist:[].concat(t.leftRoilist),curRois:t.curRois,penColor:"yellow",centerRegion:t.centerRegion,position:t.position,showMppGuide:t.showMppGuide,cellArea:1962,"element-loading-text":"处理中，请耐心等待","element-loading-spinner":"el-icon-loading","element-loading-background":"rgba(0, 0, 0, 0.5)"},on:{curROI:t.curROIChange,roiChanged:t.roiChanged,draw:t.draw,delRoi:function(e){return t.delCurRoi(e)},position:function(e,i,s){t.$set(t.position,"offx",e),t.$set(t.position,"offy",i),t.$set(t.position,"zoom",s),t.$set(t.slice,"position",t.position)},contextmenu:function(e,i){return t.showMenu(e,i)},closeMppGuide:function(e){t.showMppGuide=!1},getRoi:t.getRoi}},[t.contextmenuPosition?i("div",{staticStyle:{position:"absolute"},style:{left:t.menuPosition.x+"px",top:t.menuPosition.y+"px"}},[i("v-menus",{attrs:{pos:t.contextmenuPosition,menus:t.labeltree,currentItem:t.currentItem,newover:t.newover},on:{chosen:function(e){return t.setAnnotation(e)}}})],1):t._e()]),t._v(" "),t.showbutton?i("button",{on:{click:function(e){return t.startAnalyze()}}},[t._v(t._s(t.$t("slice.start")))]):t._e()],1),t._v(" "),i("div",{staticClass:"analylist"},[i("div",{staticClass:"quality"},[t._m(0),t._v(" "),i("div",{staticClass:"quality-detail"},[i("p",{staticStyle:{width:"50%",margin:"0"}},[t._v("清 晰 度："+t._s(t.slice.clarity?(100*t.slice.clarity).toFixed(2)+"%":"-"))]),t._v(" "),i("p",{staticStyle:{width:"50%",margin:"0"}},[t._v("扫描倍数："+t._s(t.slice.objective_rate||"-"))])])]),t._v(" "),i("div",{staticClass:"quality q-center",style:{height:"two"==t.auto?"calc(100% - 82px)":(t.aiResult.diagnosis&&t.aiResult.diagnosis.length&&t.aiResult.aiNotCompleted,"calc(100% - 82px)")}},[i("div",{staticClass:"title"},[i("span",{class:"one"==t.auto?"auto":"",on:{click:function(e){return t.changeTab("one")}}},[t._v("AI处理")]),t._v(" "),i("span",{class:"two"==t.auto?"auto":"",on:{click:function(e){return t.changeTab("two")}}},[t._v("手工标注")])]),t._v(" "),t.aiResult.aiNotCompleted||"one"!=t.auto?t._e():i("div",{staticClass:"noroi"},[t.cells.length?i("div",{staticClass:"quality-detail-bm short"},[i("div",{staticClass:"father-title"},t._l(t.cells,function(e,s){return i("div",{key:"aifather"+s,class:{active:t.currentFatherCellGroupIndex===s},on:{click:function(e){return t.toggleCellsGroup(s,"father")}}},[i("div",{staticClass:"bm-label",attrs:{title:e.label}},[t._v(t._s(e.label))]),t._v(" "),i("div",{staticClass:"bm-count",attrs:{title:e.num}},[t._v(t._s(e.num))])])}),0),t._v(" "),i("div",{staticClass:"son-title"},t._l(t.cells[t.currentFatherCellGroupIndex].data,function(e,s){return i("div",{key:"aison"+s,class:{active:t.currentSonCellGroupIndex===s},on:{click:function(e){return t.toggleCellsGroup(s,"son")}}},[i("div",{staticClass:"bm-label",attrs:{title:e.label}},[t._v(t._s(e.label))]),t._v(" "),i("div",{staticClass:"bm-count",attrs:{title:e.num}},[t._v(t._s(e.num))])])}),0)]):t._e(),t._v(" "),i("div",{staticClass:"list-container"},[t.aiRoilist.length?i("div",{staticClass:"list"},[i("div",{ref:"aiRoilist",staticClass:"roi-container"},t._l(t.aiRoilist,function(e){return i("div",{key:e.id,staticClass:"img-content",class:{"check-img":t.curRois[e.id]},on:{click:function(i){return t.goTocurRoi(e,i.shiftKey)}}},[i("img",{attrs:{"data-src":"/aipath/api/files/ROI?caseid="+t.record.id+"&fileid="+t.slice.id+"&filename="+encodeURIComponent(t.slice.filename)+"&roi=[["+Math.min.apply(Math,e.path.x)+","+Math.min.apply(Math,e.path.y)+"],["+Math.max.apply(Math,e.path.x)+","+Math.max.apply(Math,e.path.y)+"]] &roiid="+e.id,alt:""}}),t._v(" "),i("span",{class:{blue:e.image},on:{click:function(i){return i.stopPropagation(),t.changeImage(e)}}})])}),0),t._v(" "),t.showTips?i("div",{staticClass:"viewpop"},[t._v("只展示置信度最高的前100个视野")]):t._e()]):i("h3",[t._v("处理结果为空～")])])]),t._v(" "),"two"==t.auto?i("div",{staticClass:"noroi manunal"},[i("div",{staticClass:"quality-detail-bm short"},[i("div",{staticClass:"father-title"},t._l(t.humanResult,function(e,s){return i("div",{key:"humanfather"+s,class:{active:t.currentHumanFatherCellGroupIndex===s},on:{click:function(e){return t.toogleHumanType(s,"father")}}},[i("div",{staticClass:"bm-label",attrs:{title:e.label}},[t._v(t._s(e.label))]),t._v(" "),i("div",{staticClass:"bm-count",attrs:{title:t.humanResult[s].data.map(function(t){return t.data.length}).reduce(t.getNum,0)}},[t._v(t._s(t.humanResult[s].data.map(function(t){return t.data.length}).reduce(t.getNum,0)))])])}),0),t._v(" "),i("div",{staticClass:"son-title"},t._l(t.humanResult[t.currentHumanFatherCellGroupIndex].data,function(e,s){return i("div",{key:"humanson"+s,class:{active:t.currentHumanSonCellGroupIndex===s},on:{click:function(e){return t.toogleHumanType(s,"son")}}},[i("div",{staticClass:"bm-label",attrs:{title:e.label}},[t._v(t._s(e.label))]),t._v(" "),i("div",{staticClass:"bm-count",attrs:{title:e.num}},[t._v(t._s(e.data.length))])])}),0)]),t._v(" "),i("v-roi",{staticClass:"checkroi",attrs:{roilist:t.humanRoilist,currentRois:t.curRois},on:{curROI:function(e,i){return t.curROIChange(e,i)+t.listChangeCurrent()},delRoi:function(e){return t.delCurRoi(e)},roiChanged:t.roiChanged}})],1):t._e()]),t._v(" "),t.aiResult.aiNotCompleted&&"one"==t.auto&&t.showbutton?i("div",{staticClass:"ifshowtables"},[t._v(t._s(t.$t("slice.noanalysis")))]):t._e(),t._v(" "),t.showbutton||"one"!=t.auto?t._e():i("div",{staticClass:"loding"},[i("div",{staticClass:"video"},[i("img",{attrs:{src:"/static/video/loading.gif"}}),t._v(" "),0==t.lineup?i("div",{staticClass:"lineup"},[t._v("正在处理...")]):t._e(),t._v(" "),t.lineup>0?i("div",{staticClass:"lineup"},[t._v(t._s(t.$t("slice.lineup"))+" "),i("span",{staticStyle:{color:"#4C9FFA","font-size":"18px","font-weight":"bolder"}},[t._v(t._s(t.lineup))]),t._v(" "+t._s(t.$t("slice.position")))]):t._e()]),t._v(" "),i("div",{staticClass:"cancel",on:{click:function(e){return t.canceltesk()}}},[t._v(t._s(t.$t("slice.cancelTasks")))])])])])},staticRenderFns:[function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"title"},[e("span",[this._v("AI质控")])])}]};var os=i("VU/8")(ns,as,!1,function(t){i("qKzM"),i("SW+N")},"data-v-7f6535c6",null).exports,rs={props:["record","companyid","config","netSocket"],data(){return{company:this.companyid||Object(s.s)().company,currentRoiIndex:"",curAI:null,choosingAI:!1,closeAi:!1,fullPage:!1,startIndex:0,isMounted:!1}},computed:{curSlice(){let t=this.record.slices.find(t=>t.id==this.record.slice)||this.record.slices.filter(t=>1==t.state)[0]||null;return t&&(this.curAI=t.toolType||"human"),t},url(){return location.href.split("#")[0]+"#/share?caseid="+this.record.id+"&fileid="+this.curSlice.id+"&companyid="+this.company+"&filename="+this.curSlice.filename},totalList(){return this.record.slices.filter(t=>t.width)},count(){return this.isMounted?Math.ceil(this.$refs.lazyloadImg.clientHeight/80):void 0},loadList(){return this.isMounted?this.totalList.slice(0,(2+this.startIndex)*this.count):void 0}},mounted(){const t=document.querySelector("#id"+this.record.id+" .btm_left");if(t){document.querySelector("#id"+this.record.id+" .db-page").style.top=t.offsetTop+t.offsetHeight+6+"px"}this.$refs.lazyloadImg&&(this.$refs.lazyloadImg.addEventListener("scroll",this.lazyload),this.isMounted=!0)},destroyed(){this.$refs.lazyloadImg&&this.$refs.lazyloadImg.removeEventListener("scroll",this.lazyload)},methods:{cameraMove(){if("open"!==this.netSocket.readyState)this.$alert("显微镜连接失败。请确保显微镜、上位机已开启，扫描软件已启动且设置>socket已勾选。","错误");else{const t=this.$refs.aiType.$refs.osd.viewport;let{x:e,y:i}=t.getBounds(!0).getCenter();const n=JSON.parse(localStorage.correctData);Object(s.b)(`files/stagePos?caseid=${this.record.id}&fileid=${this.curSlice.id}&filename=${encodeURIComponent(this.curSlice.filename||this.curSlice.name)}`,{xPos:e*this.curSlice.width,yPos:i*this.curSlice.width}).then(t=>{let e=t.xPos,i=t.yPos,s=t.zPos,a=e+Number(n.x),o=i+Number(n.y),r=s+Number(n.z);this.netSocket.write(JSON.stringify({method:"MoveStage",X:a,Y:o,Z:r,ack:!0})),this.$emit("move-stage",{finalX:a,finalY:o,finalZ:r})}).catch(t=>{this.$alert(t.message),console.log("moveStage err",t)})}},lazyload(){let t=this.$refs.lazyloadImg.scrollTop;if(80*this.loadList.length-Math.ceil(t)-this.$refs.lazyloadImg.clientHeight<=0){if(this.loadList.length===this.totalList.length)return;this.startIndex+=1}},toogleDouble(){"pdl1db"===this.curAI?this.curAI=localStorage.perToolType:(localStorage.perToolType=this.curAI||"human",this.curAI="pdl1db")},share(){this.$refs.shareLink.select(),document.execCommand("Copy"),this.$message({message:"复制成功,可粘贴",type:"success"})},switchSlices(t,e){this.$set(t,"slice",e.id)},keydown(t){let e=this.record.slices.filter(t=>1==t.state);if((t.ctrlKey||t.metaKey)&&this.curSlice&&("ArrowUp"==t.key||"ArrowDown"==t.key)){this.$refs.container.focus();let i=e.indexOf(this.curSlice);i=i+t.keyCode-39,i=Math.max(i,0),i=Math.min(i,e.length-1),this.$set(this.record,"slice",e[i].id)}},next(){this.$emit("next")},prev(){this.$emit("prev")},curRoiIndex(t){this.currentRoiIndex=t},save(t){this.$emit("save",t)}},watch:{curAI(t){["human","cellseg","center","pdl1db","ki67","ki67ann","pdl1ann","pathann","thyroid","mucosa","bladder","embolus","kidney","bacillus","er","erann","pr","prann","ck56","her2","pdl1","fish","muscle","mitosis","breast","prostate","lung","cervix","sentinelnode","pdl1cellann","liverann","liver","ki67hot","dna","pdl1_sp236","capillary","esd","tct1","tct2","lct1","lct2","tagging","np","cd30","bm"].includes(t)?this.curSlice.toolType=t:this.curSlice.toolType="human","esd"===t&&(document.querySelector(".share").style.display="none")}},components:{chooseAI:p,human:R,esd:M,cellseg:F,center:H,pdl1db:B,ki67:ut,ki67hot:ft,pdl1ann:At,pathann:Pt,thyroid:Ht,mucosa:Bt,bladder:Yt,embolus:Xt,kidney:se,bacillus:oe,erann:de,prann:_e,ck56:ke,her2:Me,pdl1:Pe,fish:qe,muscle:ii,mitosis:te,breast:ai,prostate:vi,lung:hi,cervix:li,sentinelnode:mi,pdl1cellann:Ft,liverann:wi,liver:Ai,ki67anntwo:$t,pdl1_sp236:Ge,capillary:Ei,tct:Z,tagging:Bi,np:Xi,dna:nt,cd30:ts,bm:os,lct1:Z,lct2:Z,tct1:Z,tct2:Z,er:ut,pr:ut}},ls={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return this.record.slices.filter(function(t){return 1==t.state}).length?i("div",{ref:"container",staticClass:"container",attrs:{tabIndex:1},on:{click:function(e){t.closeAi=!t.closeAi},keydown:t.keydown}},[t.record.slices.length?i("div",{staticClass:"conter"},[i("div",{staticClass:"slice-list"},[i("table",{staticClass:"img-top"},[i("tr",[i("th",[t._v(t._s(t.$t("slice.slicelist")))])])]),t._v(" "),i("div",{ref:"lazyloadImg",staticClass:"img-list"},[i("table",{staticClass:"img-top"},t._l(t.loadList,function(e){return i("tr",{key:e.id,class:{tr_active:e==t.curSlice},on:{click:function(i){return t.switchSlices(t.record,e)}}},[i("td",{attrs:{width:"80"}},[i("img",{attrs:{src:"/aipath/api/files/thumbnail?caseid="+t.record.id+"&fileid="+e.id+"&companyid="+t.company}})]),t._v(" "),i("td",[i("p",{attrs:{title:e.name}},[t._v(t._s(e.name))]),t._v(" "),i("p",{attrs:{title:e.stain}},[t._v(t._s(e.stain))])])])}),0)])]),t._v(" "),i("chooseAI",{staticClass:"algorithmlist",attrs:{curAI:t.curAI,closeAi:t.closeAi},on:{chooseAI:function(e){return t.curAI=e}}})],1):t._e(),t._v(" "),t.curSlice?i("div",{key:t.curSlice.id,staticClass:"analy"},[i(t.curAI,{ref:"aiType",tag:"component",attrs:{config:t.config,record:t.record,slice:t.curSlice},on:{save:function(e){return t.save(e)}}}),t._v(" "),"human"==t.curAI?i("h2",[i("span",[t._v(t._s(t.$t("analyze.roi")))])]):t._e()],1):t._e(),t._v(" "),t.record.slices.length?i("div",{staticClass:"footer"},[i("div",{staticClass:"share"},[i("input",{ref:"shareLink",attrs:{type:"text",readonly:""},domProps:{value:t.url}}),t._v(" "),i("button",{on:{click:t.share}},[t._v("分享")])]),t._v(" "),t.config&&t.config.zeiss?i("span",{on:{click:t.cameraMove}},[t._v("移动")]):t._e(),t._v(" "),i("span",{on:{click:function(e){return t.save("auto")}}},[t._v("保存")])]):t._e(),t._v(" "),i("div",{directives:[{name:"show",rawName:"v-show",value:!t.fullPage,expression:"!fullPage"}],staticClass:"db-page",attrs:{id:t.record.id}},[i("div",{staticClass:"img",class:{checked:"pdl1db"===t.curAI},on:{click:function(e){return t.toogleDouble()}}})])]):t._e()},staticRenderFns:[]};var cs=i("VU/8")(rs,ls,!1,function(t){i("xR/6")},"data-v-d42b7d10",null).exports,us=i("7iKh"),hs={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticStyle:{position:"relative",width:"100%",height:"100%"}},[i("div",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticClass:"outer",attrs:{"element-loading-text":"请稍后...","element-loading-background":"rgba(0, 0, 0, 0.8)"}},[i("v-eidtreport",{style:"transform:scale("+t.scaleRate+");height:calc((100% - 140px)/"+t.scaleRate+");overflow-y:auto;overflow-x:hidden;border-radius:4px;",attrs:{record:t.record,signed:t.signed,slices:t.slices,reportType:t.reportType,algType:t.algType,sign:t.sign},on:{typeChange:t.typeChange,sliceChangge:function(e){return t.getImages()},changeSign:t.changeSign}}),t._v(" "),i("div",{staticClass:"triangle1"},[t._v(t._s(t.$t("report.edit")))]),t._v(" "),t.slices.human?i("v-viewreport",{style:"transform:scale("+t.scaleRate+");height:calc((100% - 140px)/"+t.scaleRate+");overflow-y:auto;overflow-x:hidden;border-radius:4px;",attrs:{id:"viewreport",viewRecord:t.record,remotesigned:t.signed,propslices:t.slices,remotesign:t.sign,viewReportType:t.reportType}}):t._e(),t._v(" "),i("div",{staticClass:"triangle2"},[t._v(t._s(t.$t("report.preview")))]),t._v(" "),i("div",{staticClass:"footer"},[i("span",{on:{click:function(e){return t.$emit("save","auto")}}},[t._v("保存")]),t._v(" "),i("span",{on:{click:t.download}},[t._v(t._s(t.$t("report.next")))]),t._v(" "),t.demoModeValue?t._e():i("span",{on:{click:t.prev}},[t._v("上一个")]),t._v(" "),t.demoModeValue?t._e():i("span",{on:{click:function(e){return t.$emit("next")}}},[t._v("下一个")])])],1)])},staticRenderFns:[]};var ds=function(t){i("gyaa")},ps=i("VU/8")(us.a,hs,!1,ds,"data-v-0208f2e1",null).exports,vs=i("k5KV"),gs=i.n(vs),fs=i("Mk6O"),ms=i.n(fs),_s={data:()=>({company:Object(s.s)().company,record:{},oldRecord:null,transition:"",saved:!1}),async created(){let t=Object(s.o)("caseid"),e=Object(s.o)("jwt");document.cookie=`jwt=${e}`,this.caseid=window.location.hash.split("=")[1],this.company=Object(s.s)().company,Object(s.b)("records/detail",{caseid:t}).then(({data:t})=>{this.record=Object.assign({},t),this.$set(this.record,"stage",2),t.slices.length&&Object(s.b)("files/getInfo?companyid="+this.company,{caseid:t.id,fileid:t.slices[0].id}).then(t=>{this.$set(this.record.slices,0,Object.assign({},this.record.slices[0],t.data,{name:t.data.name})),this.oldRecord=gs.a.clone(this.record)}).catch(t=>1)}).catch(t=>t)},watch:{"record.stage":{handler(t,e){this.transition=e<t?"right2left":"left2right"}},"record.slice":{handler(){this.getSliceInfo()}},clickTimer:function(t,e){this.clickTimer=e}},methods:{getSliceInfo(){if(this.record.slice){let t=this.record.slices.find(t=>t.id===this.record.slice),e=this.record.slices.findIndex(t=>t.id===this.record.slice);Object(s.b)("files/getInfo?companyid="+this.company,{caseid:this.record.id,fileid:this.record.slice}).then(i=>{this.$set(this.record.slices,e,Object.assign({},t,i.data,{name:t.name})),this.oldRecord=gs.a.clone(this.record)}).catch(t=>1)}},nav(t){this.record.stage=t},cleanRecord:t=>Object.assign({},t,{slices:t.slices.filter(t=>1==t.state).map(({id:t,name:e,filename:i})=>({id:t,name:e,filename:i})),attachments:t.attachments.filter(t=>1==t.state)}),async save(t){var e=this;await Promise.all(this.record.slices.filter(t=>1==t.state).filter((t,e)=>{var i=this.oldRecord.slices.find(e=>e.id==t.id);return!i||!gs.a.equals(i,t)}).map(function(t,i){if("1234567"!=t.id)return Object(s.b)("files/saveInfo?companyid="+e.company,{caseid:e.record.id,fileid:t.id,content:JSON.stringify(t)}).then(t=>{if(0==t.code)return 1;throw"保存切片失败"})}));var i=this.cleanRecord(this.record),n=this.cleanRecord(this.oldRecord);ms()(n,i)&&await Object(s.b)("records/update?companyid="+this.company,{id:i.id,content:JSON.stringify(i)}),this.oldRecord=gs.a.clone(this.record),t&&t.indexOf("resetOpinion")>-1&&(await Object(s.b)("records/update-opinion?companyid="+this.company,{id:i.id}),this.$set(this.oldRecord,"opinion",null),this.$set(this.oldRecord,"opinion",null),this.$set(this.record,"opinion",null)),"auto"==t&&(this.saved=!0,setTimeout(t=>this.saved=!1,1500)),"getInfo"==t&&this.getSliceInfo()}},components:{basic:o,file:u,analyze:cs,report:ps}},ys={render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"blackback",attrs:{id:"id"+t.record.id}},[s("div",{staticClass:"header"},[s("img",{attrs:{src:i("aCHr"),alt:"迪英加",width:"186"}}),t._v(" "),s("div",{staticClass:"nav"},[s("div",{class:t.record.stage>=0?"basic-nav-active":"basic-nav-normal",on:{click:function(e){return t.nav(0)}}},[t._v(t._s(t.$t("detail.basic")))]),t._v(" "),s("div",{class:t.record.stage>=1?"files-nav-active":"files-nav-normal",on:{click:function(e){return t.nav(1)}}},[t._v(t._s(t.$t("detail.files")))]),t._v(" "),s("div",{class:t.record.stage>=2?"analyze-nav-active":"analyze-nav-normal",on:{click:function(e){return t.nav(2)}}},[t._v(t._s(t.$t("detail.analyze")))]),t._v(" "),s("div",{class:t.record.stage>=3?"report-nav-active":"report-nav-normal",on:{click:function(e){return t.nav(3)}}},[t._v(t._s(t.$t("detail.report")))])])]),t._v(" "),s("div",{staticClass:"body"},[t.oldRecord?s("transition",{attrs:{name:t.transition}},[s(["basic","file","analyze","report"][t.record.stage],{tag:"component",attrs:{record:t.record,config:!1,companyid:t.company},on:{save:t.save,"move-stage":function(e){return t.$emit("move-stage",e)}}})],1):t._e()],1),t._v(" "),t.saved?s("div",{staticClass:"saved"},[t._v("保存成功")]):t._e()])},staticRenderFns:[]};var Rs=i("VU/8")(_s,ys,!1,function(t){i("ELz9")},"data-v-a4dcde82",null);e.default=Rs.exports},"bPZ+":function(t,e){},bg7G:function(t,e){},bw5Q:function(t,e){},c3E9:function(t,e){},c4rj:function(t,e){},dNnZ:function(t,e){},dbyp:function(t,e,i){"use strict";var s={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",[i("div",{class:{tct:!0,print:t.host}},[i("h4",{class:{title:!0,print:t.host}},[t._v("样本信息")]),t._v(" "),i("table",{class:{print:t.host},attrs:{cellspacing:"0"}},[i("tr",[i("td",{attrs:{width:"40%"}},[i("span",{staticClass:"weight600"},[t._v(t._s(t.$t("report.satisfaction")))]),t._v(" "),"1"==t.info.LCT.isStatisfied?i("span",[t._v(t._s(t.$t("report.satisfied")))]):"0"==t.info.LCT.isStatisfied?i("span",[t._v(t._s(t.$t("report.notsatisfied")))]):t._e()]),t._v(" "),t._m(0),t._v(" "),i("td",{attrs:{rowspan:"2",width:"20%"}},[i("span",{staticClass:"weight600"},[t._v("微生物:")]),t._v("\n          "+t._s(t.info.LCT.pathogen&&t.info.LCT.pathogen.length?t.info.LCT.pathogen.join(","):"无")+"\n        ")])]),t._v(" "),i("tr",[i("td",[i("span",{staticClass:"weight600"},[t._v(t._s(t.$t("report.cellmass")))]),t._v(" "),"greater"==t.info.LCT.cellNum?i("span",[t._v(">5000")]):"less"==t.info.LCT.cellNum?i("span",[t._v("≤5000")]):t._e()]),t._v(" "),i("td",[i("span",{staticClass:"weight600"},[t._v("炎细胞：")]),t._v(" "),"less"==t.info.LCT.inflammatoryCells?i("span",[t._v("少量")]):"medium"==t.info.LCT.inflammatoryCells?i("span",[t._v("中量")]):"more"==t.info.LCT.inflammatoryCells?i("span",[t._v("大量")]):t._e()])]),t._v(" "),i("tr",[i("td",[i("span",{staticClass:"weight600"},[t._v(t._s(t.$t("report.solencyte")))]),t._v(" "),"1"==t.info.LCT.cervicalCanalCells?i("span",[t._v("有")]):"0"==t.info.LCT.cervicalCanalCells?i("span",[t._v("无")]):t._e()]),t._v(" "),i("td",[i("span",{staticClass:"weight600"},[t._v("红细胞：")]),t._v(" "),"less"==t.info.LCT.erythrocyte?i("span",[t._v("少量")]):"medium"==t.info.LCT.erythrocyte?i("span",[t._v("中量")]):"more"==t.info.LCT.erythrocyte?i("span",[t._v("大量")]):t._e()]),t._v(" "),i("td",[i("span",{staticClass:"weight600"},[t._v("放疗：")]),t._v(" "),"1"==t.info.LCT.radiotherapy?i("span",[t._v("有")]):"0"==t.info.LCT.radiotherapy?i("span",[t._v("无")]):t._e()])]),t._v(" "),i("tr",[i("td",[i("span",{staticClass:"weight600"},[t._v(t._s(t.$t("report.metaplastic")))]),t._v(" "),"1"==t.info.LCT.metaplasticCells?i("span",[t._v("有")]):"0"==t.info.LCT.metaplasticCells?i("span",[t._v("无")]):t._e()]),t._v(" "),i("td",[i("span",{staticClass:"weight600"},[t._v("细胞萎缩：")]),t._v(" "),"1"==t.info.LCT.cataplasia?i("span",[t._v("有")]):"0"==t.info.LCT.cataplasia?i("span",[t._v("无")]):t._e()]),t._v(" "),i("td",[i("span",{staticClass:"weight600"},[t._v("宫内节育器：")]),t._v(" "),"1"==t.info.LCT.intrauterineDevice?i("span",[t._v("有")]):"0"==t.info.LCT.intrauterineDevice?i("span",[t._v("无")]):t._e()])])])]),t._v(" "),i("div",{class:{opinion:!0,print:t.host}},[i("h4",{class:{title:!0,print:t.host}},[t._v(t._s(t.$t("report.point")))]),t._v(" "),i("div",{staticClass:"opinion-write",domProps:{innerHTML:t._s(t.opinion)}})])])},staticRenderFns:[function(){var t=this.$createElement,e=this._self._c||t;return e("td",{attrs:{width:"40%"}},[e("span",{staticClass:"weight600"},[this._v("炎症以及反应性细胞改变")])])}]};var n=i("VU/8")({props:["info","host"],computed:{opinion:function(){if(this.info.LCT.opinion)return this.info.LCT.opinion.replace(/\r\n/g,"<br>").replace(/\n/g,"<br>").replace(/\s/g," ")}}},s,!1,function(t){i("Khx+")},"data-v-bb3be42a",null).exports,a={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",[i("div",{class:{tct:!0,print:t.host}},[i("h4",{class:{title:!0,print:t.host}},[t._v("样本信息")]),t._v(" "),i("table",{class:{print:t.host},attrs:{cellspacing:"0"}},[i("tr",[i("td",{attrs:{width:"40%"}},[i("span",{staticClass:"weight600"},[t._v(t._s(t.$t("report.satisfaction")))]),t._v(" "),"1"==t.info.DNA.isStatisfied?i("span",[t._v(t._s(t.$t("report.satisfied")))]):"0"==t.info.DNA.isStatisfied?i("span",[t._v(t._s(t.$t("report.notsatisfied")))]):t._e()]),t._v(" "),t._m(0),t._v(" "),i("td",{attrs:{rowspan:"2",width:"20%"}},[i("span",{staticClass:"weight600"},[t._v("微生物:")]),t._v("\n          "+t._s(t.info.DNA.pathogen&&t.info.DNA.pathogen.length?t.info.DNA.pathogen.join(","):"无")+"\n        ")])]),t._v(" "),i("tr",[i("td",[i("span",{staticClass:"weight600"},[t._v(t._s(t.$t("report.cellmass")))]),t._v(" "),"greater"==t.info.DNA.cellNum?i("span",[t._v(">5000")]):"less"==t.info.DNA.cellNum?i("span",[t._v("≤5000")]):t._e()]),t._v(" "),i("td",[i("span",{staticClass:"weight600"},[t._v("炎细胞：")]),t._v(" "),"less"==t.info.DNA.inflammatoryCells?i("span",[t._v("少量")]):"medium"==t.info.DNA.inflammatoryCells?i("span",[t._v("中量")]):"more"==t.info.DNA.inflammatoryCells?i("span",[t._v("大量")]):t._e()])]),t._v(" "),i("tr",[i("td",[i("span",{staticClass:"weight600"},[t._v(t._s(t.$t("report.solencyte")))]),t._v(" "),"1"==t.info.DNA.cervicalCanalCells?i("span",[t._v("有")]):"0"==t.info.DNA.cervicalCanalCells?i("span",[t._v("无")]):t._e()]),t._v(" "),i("td",[i("span",{staticClass:"weight600"},[t._v("红细胞：")]),t._v(" "),"less"==t.info.DNA.erythrocyte?i("span",[t._v("少量")]):"medium"==t.info.DNA.erythrocyte?i("span",[t._v("中量")]):"more"==t.info.DNA.erythrocyte?i("span",[t._v("大量")]):t._e()]),t._v(" "),i("td",[i("span",{staticClass:"weight600"},[t._v("放疗：")]),t._v(" "),"1"==t.info.DNA.radiotherapy?i("span",[t._v("有")]):"0"==t.info.DNA.radiotherapy?i("span",[t._v("无")]):t._e()])]),t._v(" "),i("tr",[i("td",[i("span",{staticClass:"weight600"},[t._v(t._s(t.$t("report.metaplastic")))]),t._v(" "),"1"==t.info.DNA.metaplasticCells?i("span",[t._v("有")]):"0"==t.info.DNA.metaplasticCells?i("span",[t._v("无")]):t._e()]),t._v(" "),i("td",[i("span",{staticClass:"weight600"},[t._v("细胞萎缩：")]),t._v(" "),"1"==t.info.DNA.cataplasia?i("span",[t._v("有")]):"0"==t.info.DNA.cataplasia?i("span",[t._v("无")]):t._e()]),t._v(" "),i("td",[i("span",{staticClass:"weight600"},[t._v("宫内节育器：")]),t._v(" "),"1"==t.info.DNA.intrauterineDevice?i("span",[t._v("有")]):"0"==t.info.DNA.intrauterineDevice?i("span",[t._v("无")]):t._e()])])])]),t._v(" "),i("div",{class:{opinion:!0,print:t.host}},[i("h4",{class:{title:!0,print:t.host}},[t._v(t._s(t.$t("report.point")))]),t._v(" "),i("div",{staticClass:"opinion-write",domProps:{innerHTML:t._s(t.opinion)}})])])},staticRenderFns:[function(){var t=this.$createElement,e=this._self._c||t;return e("td",{attrs:{width:"40%"}},[e("span",{staticClass:"weight600"},[this._v("炎症以及反应性细胞改变")])])}]};var o=i("VU/8")({props:["info","host"],computed:{opinion:function(){if(this.info.DNA.tbsOpinion)return"TBS诊断意见："+this.info.DNA.tbsOpinion.replace(/\r\n/g,"<br>").replace(/\n/g,"<br>").replace(/\s/g," ")}}},a,!1,function(t){i("47Vy")},"data-v-a16b0e28",null).exports,r=i("Gu7T"),l=i.n(r),c={props:["info","sliceId","host","slices","recordId","roishow"],data:function(){return{showRoi:[],list:[],checkedArrayList:[]}},computed:{opinion:function(){if(this.info.DNA.tbsOpinion)return"TBS诊断意见："+this.info.DNA.tbsOpinion.replace(/\r\n/g,"<br>").replace(/\n/g,"<br>").replace(/\s/g," ")},DNAOpinion:function(){if(this.info.DNA.DNAOpinion)return'<font style="font-size:18px;font-weight:bold;display:block;margin-bottom:10px">DNA检测意见：</font>'+this.info.DNA.DNAOpinion.replace(/\r\n/g,"<br>").replace(/\n/g,"<br>").replace(/\s/g," ")},uniteOpinion:function(){if(this.info.DNA.uniteOpinion)return'<font style="font-size:18px;font-weight:bold;display:block;margin-bottom:10px">诊断建议：</font>'+this.info.DNA.uniteOpinion.replace(/\r\n/g,"<br>").replace(/\n/g,"<br>").replace(/\s/g," ")},tableData:function(){return this.info.DNA}},methods:{getDNAInfo:function(){},checkData:function(){var t=[].concat(l()(this.slices.human),l()(this.slices.dna)),e=[],i=[];this.checkedArrayList=[],t.length&&(e=t.filter(function(t){return"dnaIcon"!=t.iconType})),[].concat(l()(this.slices.dna)).length&&(i=[].concat(l()(this.slices.dna)).filter(function(t){return"dnaIcon"==t.iconType}),this.checkedArrayList=i.filter(function(t){return t.di>=2.5}),i.length>30&&(i=i.slice(0,30))),this.showRoi=e,this.list=i}},watch:{slices:{immediate:!0,deep:!0,handler:function(t){this.slices=t,this.checkData()}}},mounted:function(){this.checkData(),this.getDNAInfo()}},u={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",[i("div",{class:{opinion:!0,print:t.host}},[i("h4",{class:{title:!0,print:t.host}},[t._v(t._s(t.$t("report.point")))]),t._v(" "),i("div",{staticClass:"pic-index"},[i("img",{staticClass:"pic-index-img",attrs:{src:t.host?t.host+"/data/"+t.recordId+"/slices/"+t.sliceId+"dna_index.png":"/aipath/api/files/getImage?caseid="+t.recordId+"&fileid="+t.sliceId+"&type=histplot&date="+(new Date).getTime(),alt:""}})]),t._v(" "),i("div",{staticClass:"pic-index"},[i("img",{staticClass:"pic-index-img",attrs:{src:t.host?t.host+"/data/"+t.recordId+"/slices/"+t.sliceId+"scatterplot.png":"/aipath/api/files/getImage?caseid="+t.recordId+"&fileid="+t.sliceId+"&type=scatterplot&date="+(new Date).getTime(),alt:""}})])]),t._v(" "),i("div",{staticClass:"pic"},[i("div",{staticClass:"dna-item-analy"},[i("li",{staticStyle:{color:"rgb(112,182,3)"}},[i("span",{staticClass:"dna-item-title"},[t._v("正常二倍体细胞")]),t._v("  "+t._s(t.tableData.num_normal))]),t._v(" "),i("li",{staticStyle:{color:"rgb(245,154,35)"}},[i("span",{staticClass:"dna-item-title"},[t._v("增生细胞")]),t._v("  "+t._s(t.tableData.num_abnormal_low))]),t._v(" "),i("li",{staticStyle:{color:"rgb(217,0,27)"}},[i("span",{staticClass:"dna-item-title"},[t._v("多倍体细胞")]),t._v("  "+t._s(t.tableData.num_abnormal_high>100?t.checkedArrayList.length+(t.tableData.num_abnormal_high-100):t.checkedArrayList.length))]),t._v(" "),i("li",{staticStyle:{marginBottom:"20px"}},[i("span",{staticClass:"dna-item-title"},[t._v("上皮细胞")]),t._v("  "+t._s(t.tableData.num_normal+t.tableData.num_abnormal_low+t.tableData.num_abnormal_high))]),t._v(" "),i("div",{staticClass:"opinion-write",domProps:{innerHTML:t._s(t.DNAOpinion)}}),t._v(" "),i("br"),t._v(" "),i("div",{staticClass:"opinion-write",domProps:{innerHTML:t._s(t.uniteOpinion)}})]),t._v(" "),i("div",{staticClass:"pic-dna"},[t.list.length?i("div",{staticClass:"pic-dna-icons"},t._l(t.list,function(e){return i("div",{key:e.id,staticClass:"pic-dna-icon"},[i("img",{staticClass:"pic-dna-icon-img",attrs:{src:t.host?t.host+"/data/"+t.recordId+"/slices/"+e.fileid+"/roi/"+t.roi.id+".jpg":"/aipath/api/files/ROI?caseid="+t.recordId+"&fileid="+e.fileid+"&filename="+encodeURIComponent(e.filename)+"&roi=[["+Math.min.apply(Math,e.path.x)+","+Math.min.apply(Math,e.path.y)+"],["+Math.max.apply(Math,e.path.x)+","+Math.max.apply(Math,e.path.y)+"]] &roiid="+e.id,alt:""}}),t._v(" "),i("div",{staticClass:"roi-percent",class:{"red-color":e.di-0>=2.5}},[t._v(t._s(e.di))])])}),0):t._e()])])])},staticRenderFns:[]};var h=i("VU/8")(c,u,!1,function(t){i("gJtp")},"data-v-bfcb2866",null).exports,d={props:["info","sliceId","host","slices","recordId","roishow"],data:function(){return{showRoi:[],list:[],checkedArrayList:[]}},computed:{opinion:function(){if(this.info.DNA.tbsOpinion)return"TBS诊断意见："+this.info.DNA.tbsOpinion.replace(/\r\n/g,"<br>").replace(/\n/g,"<br>").replace(/\s/g," ")},DNAOpinion:function(){if(this.info.DNA.DNAOpinion)return"DNA检测意见："+this.info.DNA.DNAOpinion.replace(/\r\n/g,"<br>").replace(/\n/g,"<br>").replace(/\s/g," ")},uniteOpinion:function(){if(this.info.DNA.uniteOpinion)return"联合诊断建议："+this.info.DNA.uniteOpinion.replace(/\r\n/g,"<br>").replace(/\n/g,"<br>").replace(/\s/g," ")},tableData:function(){return this.info.DNA}},methods:{getDNAInfo:function(){},checkData:function(){var t=[].concat(l()(this.slices.human),l()(this.slices.dna)),e=[],i=[];this.checkedArrayList=[],t.length&&(e=t.filter(function(t){return"dnaIcon"!=t.iconType})),[].concat(l()(this.slices.dna)).length&&(i=[].concat(l()(this.slices.dna)).filter(function(t){return"dnaIcon"==t.iconType}),this.checkedArrayList=i.filter(function(t){return t.di>=2.5}),i.length>30&&(i=i.slice(0,30))),this.showRoi=e,this.list=i}},watch:{slices:{immediate:!0,deep:!0,handler:function(t){this.slices=t,this.checkData()}}},mounted:function(){this.checkData(),this.getDNAInfo()}},p={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",[i("div",{class:{tct:!0,print:t.host}},[i("h4",{class:{title:!0,print:t.host}},[t._v("样本信息")]),t._v(" "),i("table",{class:{print:t.host},attrs:{cellspacing:"0"}},[i("tr",[i("td",{attrs:{width:"50%"}},[i("span",{staticClass:"weight600"},[t._v(t._s(t.$t("report.satisfaction")))]),t._v(" "),"1"==t.info.DNA.isStatisfied?i("span",[t._v(t._s(t.$t("report.satisfied")))]):"0"==t.info.DNA.isStatisfied?i("span",[t._v(t._s(t.$t("report.notsatisfied")))]):t._e()]),t._v(" "),i("td",[i("span",{staticClass:"weight600"},[t._v(t._s(t.$t("report.solencyte")))]),t._v(" "),"1"==t.info.DNA.cervicalCanalCells?i("span",[t._v("有")]):"0"==t.info.DNA.cervicalCanalCells?i("span",[t._v("无")]):t._e()])]),t._v(" "),i("tr",[i("td",[i("span",{staticClass:"weight600"},[t._v(t._s(t.$t("report.cellmass")))]),t._v(" "),"greater"==t.info.DNA.cellNum?i("span",[t._v(">5000")]):"less"==t.info.DNA.cellNum?i("span",[t._v("≤5000")]):t._e()]),t._v(" "),i("td",[i("span",{staticClass:"weight600"},[t._v(t._s(t.$t("report.metaplastic")))]),t._v(" "),"1"==t.info.DNA.metaplasticCells?i("span",[t._v("有")]):"0"==t.info.DNA.metaplasticCells?i("span",[t._v("无")]):t._e()])]),t._v(" "),t._m(0),t._v(" "),i("tr",[i("td",{attrs:{width:"50%"}},[i("span",{staticClass:"weight600"},[t._v("炎细胞：")]),t._v(" "),"less"==t.info.DNA.inflammatoryCells?i("span",[t._v("少量")]):"medium"==t.info.DNA.inflammatoryCells?i("span",[t._v("中量")]):"more"==t.info.DNA.inflammatoryCells?i("span",[t._v("大量")]):t._e()]),t._v(" "),i("td",{attrs:{width:"50%"}},[i("span",{staticClass:"weight600"},[t._v("微生物:")]),t._v("\n            "+t._s(t.info.DNA.pathogen&&t.info.DNA.pathogen.length?t.info.DNA.pathogen.join(","):"无")+"\n          ")])]),t._v(" "),i("tr",[i("td",{attrs:{width:"50%"}},[i("span",{staticClass:"weight600"},[t._v("红细胞：")]),t._v(" "),"less"==t.info.DNA.erythrocyte?i("span",[t._v("少量")]):"medium"==t.info.DNA.erythrocyte?i("span",[t._v("中量")]):"more"==t.info.DNA.erythrocyte?i("span",[t._v("大量")]):t._e()]),t._v(" "),i("td",{attrs:{width:"50%"}},[i("span",{staticClass:"weight600"},[t._v("放疗：")]),t._v(" "),"1"==t.info.DNA.radiotherapy?i("span",[t._v("有")]):"0"==t.info.DNA.radiotherapy?i("span",[t._v("无")]):t._e()])]),t._v(" "),i("tr",[i("td",{attrs:{width:"50%"}},[i("span",{staticClass:"weight600"},[t._v("细胞萎缩：")]),t._v(" "),"1"==t.info.DNA.cataplasia?i("span",[t._v("有")]):"0"==t.info.DNA.cataplasia?i("span",[t._v("无")]):t._e()]),t._v(" "),i("td",{attrs:{width:"50%"}},[i("span",{staticClass:"weight600"},[t._v("宫内节育器：")]),t._v(" "),"1"==t.info.DNA.intrauterineDevice?i("span",[t._v("有")]):"0"==t.info.DNA.intrauterineDevice?i("span",[t._v("无")]):t._e()])])]),t._v(" "),i("div",{class:{opinion:!0,print:t.host}},[i("h4",{class:{title:!0,print:t.host}},[t._v(t._s(t.$t("report.point")))]),t._v(" "),i("div",{staticClass:"opinion-write",domProps:{innerHTML:t._s(t.opinion)}}),t._v(" "),i("div",{staticClass:"pic-index"},[i("img",{staticClass:"pic-index-img",attrs:{src:t.host?t.host+"/data/"+t.recordId+"/slices/"+t.sliceId+"dna_index.png":"/aipath/api/files/getImage?caseid="+t.recordId+"&fileid="+t.sliceId+"&type=histplot&date="+(new Date).getTime(),alt:""}})]),t._v(" "),i("div",{staticClass:"pic-index"},[i("img",{staticClass:"pic-index-img",attrs:{src:t.host?t.host+"/data/"+t.recordId+"/slices/"+t.sliceId+"scatterplot.png":"/aipath/api/files/getImage?caseid="+t.recordId+"&fileid="+t.sliceId+"&type=scatterplot&date="+(new Date).getTime(),alt:""}})]),t._v(" "),i("div",{staticClass:"opinion-write",domProps:{innerHTML:t._s(t.DNAOpinion)}}),t._v(" "),i("div",{staticClass:"opinion-write",domProps:{innerHTML:t._s(t.uniteOpinion)}})])]),t._v(" "),i("div",{staticClass:"pic"},[t.showRoi.length?i("div",{staticClass:"pic-tbs",class:t.host?"slice-list clearfix print":"slice-list clearfix"},[t._l([t.showRoi[0]],function(e){return i("div",{key:e.id,staticClass:"pic-tbs-content"},[i("img",{staticClass:"pic-tbs-content-img",attrs:{src:t.host?t.host+"/data/"+t.recordId+"/slices/"+e.fileid+"scatterplot.png":"/aipath/api/files/ROI?caseid="+t.recordId+"&fileid="+e.fileid+"&filename="+encodeURIComponent(e.filename)+"&roi=[["+Math.min.apply(Math,e.path.x)+","+Math.min.apply(Math,e.path.y)+"],["+Math.max.apply(Math,e.path.x)+","+Math.max.apply(Math,e.path.y)+"]] &roiid="+e.id,alt:""}})])}),t._v(" "),t.roishow?t._e():i("div",{staticClass:"slice-name"},[t._v("切片名称："+t._s(t.showRoi[0].filename))]),t._v(" "),i("div",{staticClass:"slice-name"},[t._v(t._s(t.showRoi[0].remark))])],2):i("div",{staticClass:"pic-tbs"}),t._v(" "),i("div",{staticClass:"pic-dna"},[t.list.length?i("div",{staticClass:"pic-dna-icons"},t._l(t.list,function(e){return i("div",{key:e.id,staticClass:"pic-dna-icon"},[i("img",{staticClass:"pic-dna-icon-img",attrs:{src:t.host?t.host+"/data/"+t.recordId+"/slices/"+e.fileid+"/roi/"+t.roi.id+".jpg":"/aipath/api/files/ROI?caseid="+t.recordId+"&fileid="+e.fileid+"&filename="+encodeURIComponent(e.filename)+"&roi=[["+Math.min.apply(Math,e.path.x)+","+Math.min.apply(Math,e.path.y)+"],["+Math.max.apply(Math,e.path.x)+","+Math.max.apply(Math,e.path.y)+"]] &roiid="+e.id,alt:""}}),t._v(" "),i("div",{staticClass:"roi-percent",class:{"red-color":e.di-0>=2.5}},[t._v(t._s(e.di))])])}),0):t._e(),t._v(" "),i("div",{staticClass:"dna-item-analy"},[i("li",{staticStyle:{color:"rgb(112,182,3)"}},[i("span",{staticClass:"dna-item-title"},[t._v("正常二倍体细胞")]),t._v("  "+t._s(t.tableData.num_normal))]),t._v(" "),i("li",{staticStyle:{color:"rgb(245,154,35)"}},[i("span",{staticClass:"dna-item-title"},[t._v("增生细胞")]),t._v("  "+t._s(t.tableData.num_abnormal_low))]),t._v(" "),i("li",{staticStyle:{color:"rgb(217,0,27)"}},[i("span",{staticClass:"dna-item-title"},[t._v("多倍体细胞")]),t._v("  "+t._s(t.tableData.num_abnormal_high>100?t.checkedArrayList.length+(t.tableData.num_abnormal_high-100):t.checkedArrayList.length))]),t._v(" "),i("li",[i("span",{staticClass:"dna-item-title"},[t._v("上皮细胞")]),t._v("  "+t._s(t.tableData.num_normal+t.tableData.num_abnormal_low+t.tableData.num_abnormal_high))])])])])])},staticRenderFns:[function(){var t=this.$createElement,e=this._self._c||t;return e("tr",[e("td",{attrs:{width:"50%"}},[e("span",{staticClass:"weight600"},[this._v("炎症以及反应性细胞改变")])])])}]};var v=i("VU/8")(d,p,!1,function(t){i("wjIq")},"data-v-113ef889",null).exports,g={render:function(){var t=this.$createElement,e=this._self._c||t;return e("div",[e("div",{class:{opinion:!0,print:this.host}},[e("h4",{staticClass:"title"},[this._v(this._s(this.$t("report.point")))]),this._v(" "),e("div",{staticClass:"opinion-write",domProps:{innerHTML:this._s(this.opinion)}})])])},staticRenderFns:[]};var f=i("VU/8")({props:["info","host"],computed:{opinion:function(){if(this.info.REG.opinion)return this.info.REG.opinion.replace(/\r\n/g,"<br>").replace(/\n/g,"<br>").replace(/\s/g," ")}}},g,!1,function(t){i("e0JV")},"data-v-bcc6a73a",null).exports,m={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",[i("div",{class:{tct:!0,print:t.host}},[i("h4",{class:{title:!0,print:t.host}},[t._v(t._s(t.$t("basic.cancerTypeTitle")))]),t._v(" "),i("table",{class:{print:t.host},attrs:{cellspacing:"0"}},[i("tr",[i("td",{attrs:{colspan:"3"}},[i("span",{staticClass:"weight600"},[t._v(t._s(t.$t("report.location"))+":")]),t._v(" "),i("span",{staticClass:"contentItem"},[t._v(t._s(t.info.ESD.locationId))])])]),t._v(" "),i("tr",[i("td",{attrs:{colspan:"3"}},[i("span",{staticClass:"weight600"},[t._v(t._s(t.$t("report.operativeMethods"))+":")]),t._v(" "),i("span",{staticClass:"contentItem"},[t._v(t._s(t.info.ESD.operativeMethodId))])])]),t._v(" "),i("tr",[i("td",{attrs:{colspan:"3"}},[i("span",{staticClass:"weight600"},[t._v(t._s(t.$t("report.specimenCompleteness"))+":")]),t._v(" "),i("span",{staticClass:"contentItem"},[t._v(t._s(t.info.ESD.specimenIntegrityId))])])]),t._v(" "),i("tr",[i("td",{attrs:{colspan:"3"}},[i("span",{staticClass:"weight600"},[t._v(t._s(t.$t("report.mucosalSize"))+":")]),t._v(" "),i("span",{staticClass:"contentItem"},[t._v(t._s(t.info.ESD.mucosalSize))]),t._v(" mm\n                ")])]),t._v(" "),i("tr",[i("td",{attrs:{colspan:"3"}},[i("span",{staticClass:"weight600"},[t._v(t._s(t.$t("report.numberofLesions"))+":")]),t._v(" "),i("span",{staticClass:"contentItem"},[t._v(t._s(t.info.ESD.numberofLesions))])])]),t._v(" "),i("tr",[i("td",{attrs:{colspan:"3"}},[i("span",{staticClass:"weight600"},[t._v(t._s(t.$t("report.lesionRange"))+":")]),t._v(" "),i("span",{staticClass:"contentItem"},[t._v("宽度"+t._s(t.info.ESD.mucosalWidth)+"mm")]),i("span",{staticStyle:{"margin-left":"20px"}},[t._v("深度"+t._s(t.info.ESD.mucosalHeight)+"mm")])])]),t._v(" "),i("tr",[i("td",{attrs:{colspan:"3"}},[i("span",{staticClass:"weight600"},[t._v(t._s(t.$t("report.grossType"))+":")]),t._v(" "),i("span",{staticClass:"contentItem"},[t._v(t._s(t.info.ESD.grossType))])])]),t._v(" "),i("tr",[i("td",{attrs:{colspan:"3"}},[i("span",{staticClass:"weight600"},[t._v(t._s(t.$t("report.histologicalType"))+":")]),t._v(" "),i("span",{staticClass:"contentItem"},[t._v(t._s(t.info.ESD.histologicalType))])])]),t._v(" "),i("tr",[i("td",{attrs:{colspan:"3"}},[i("span",{staticClass:"weight600"},[t._v(t._s(t.$t("report.histologyGrade"))+":")]),t._v(" "),i("span",{staticClass:"contentItem"},[t._v(t._s(t.info.ESD.histologyGrade))])])]),t._v(" "),i("tr",[i("td",{attrs:{colspan:"3"}},[i("span",{staticClass:"weight600"},[t._v(t._s(t.$t("report.lauren"))+":")]),t._v(" "),i("span",{staticClass:"contentItem"},[t._v(t._s(t.info.ESD.lauren))])])]),t._v(" "),i("tr",[i("td",{attrs:{colspan:"3"}},[i("span",{staticClass:"weight600"},[t._v(t._s(t.$t("report.invasionDepth"))+":")]),t._v(" "),i("span",{staticClass:"contentItem"},[t._v(t._s(t.info.ESD.invasionDepth))])])]),t._v(" "),i("tr",[i("td",{attrs:{colspan:"3"}},[i("span",{staticClass:"weight600"},[t._v(t._s(t.$t("report.combinedUlcer"))+":")]),t._v(" "),0==t.info.ESD.isCombinedUlcer?i("span",[t._v("是")]):t._e(),1==t.info.ESD.isCombinedUlcer?i("span",[t._v("否")]):t._e()])]),t._v(" "),i("tr",[i("td",{attrs:{colspan:"3"}},[i("span",{staticClass:"weight600"},[t._v(t._s(t.$t("report.tumorThrombus"))+":")]),t._v(" "),0==t.info.ESD.isTumorThrombus?i("span",[t._v("是")]):t._e(),1==t.info.ESD.isTumorThrombus?i("span",[t._v("否")]):t._e()])]),t._v(" "),i("tr",[i("td",{attrs:{colspan:"3"}},[i("span",{staticClass:"weight600"},[t._v(t._s(t.$t("report.nerveInvasion"))+":")]),t._v(" "),0==t.info.ESD.isNerveInvasion?i("span",[t._v("是")]):t._e(),1==t.info.ESD.isNerveInvasion?i("span",[t._v("否")]):t._e()])]),t._v(" "),i("tr",[i("td",{attrs:{colspan:"3"}},[i("span",{staticClass:"weight600"},[t._v(t._s(t.$t("report.wettingPattern"))+":")]),t._v(" "),i("span",{staticClass:"contentItem"},[t._v(t._s(t.info.ESD.wettingPattern))])])]),t._v(" "),i("tr",[i("td",{attrs:{colspan:"3"}},[i("span",{staticClass:"weight600"},[t._v(t._s(t.$t("report.astricMucosa"))+":")]),t._v(" "),i("span",{staticClass:"contentItem"},[t._v(t._s(t.info.ESD.astricMucosa))])])]),t._v(" "),i("tr",[i("td",{attrs:{colspan:"3"}},[i("span",{staticClass:"weight600"},[t._v(t._s(t.$t("report.horizontalPMH"))+":")]),t._v(" "),1==t.info.ESD.horizontalPMH?i("span",[t._v("阴性，最近距离阳性为"+t._s(t.info.ESD.PMH)+"mm")]):t._e(),t._v(" "),0==t.info.ESD.horizontalPMH?i("span",[t._v("阳性")]):t._e()])]),t._v(" "),i("tr",[i("td",{attrs:{colspan:"3"}},[i("span",{staticClass:"weight600"},[t._v(t._s(t.$t("report.verticalPVM"))+":")]),t._v(" "),1==t.info.ESD.verticalPVM?i("span",[t._v("阴性，最近距离阳性为"+t._s(t.info.ESD.PVM)+"mm")]):t._e(),t._v(" "),0==t.info.ESD.verticalPVM?i("span",[t._v("阳性")]):t._e()])]),t._v(" "),i("tr",[i("td",{attrs:{colspan:"3"}},[i("span",{staticClass:"weight600"},[t._v(t._s(t.$t("report.others"))+":")]),t._v(" "),i("span",{staticClass:"contentItem"},[t._v(t._s(t.info.ESD.others))])])])])]),t._v(" "),i("div",{class:{opinion:!0,print:t.host}},[i("h4",{class:{title:!0,print:t.host}},[t._v(t._s(t.$t("report.remark")))]),t._v(" "),i("div",{staticClass:"opinion-write",domProps:{innerHTML:t._s(t.opinion)}})]),t._v(" "),i("el-row",{attrs:{gutter:20}},[i("el-col",{attrs:{span:8}},[i("div",{staticClass:"grid-content"},[i("img",{staticClass:"img_esd",attrs:{src:t.info.ESD.src1,alt:""}})])]),t._v(" "),i("el-col",{attrs:{span:8}},[i("div",{staticClass:"grid-content"},[i("img",{staticClass:"img_esd",attrs:{src:t.info.ESD.src2,alt:""}})])]),t._v(" "),i("el-col",{attrs:{span:8}},[i("div",{staticClass:"grid-content"},[i("img",{staticClass:"img_esd",attrs:{src:t.info.ESD.src3,alt:""}})])])],1)],1)},staticRenderFns:[]};var _=i("VU/8")({props:["info","host"],computed:{opinion:function(){if(this.info.ESD.opinion)return this.info.ESD.opinion.replace(/\r\n/g,"<br>").replace(/\n/g,"<br>").replace(/\s/g," ")}}},m,!1,function(t){i("/zkq")},"data-v-a3c1d5da",null).exports,y={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",[i("h4",{class:t.host?"reference print":"reference"},[t._v(t._s(t.$t("report.references")))]),t._v(" "),i("ul",t._l(t.references,function(e,s){return i("li",{key:s,class:t.host?"refer-items print":"refer-items"},[t._v("\n            "+t._s(s+1+".")+t._s(e)+"\n        ")])}),0)])},staticRenderFns:[]};var R=i("VU/8")({props:["host"],data:function(){return{references:['Lin Yang, Peter Meer and David J. Foran, "Unsupervised analysis of imaged pathology specimens based on robust estimation and color active contour models", IEEE Transaction on Information Technology in Biomedicine (TITB), Vol. 9, No. 1, pp. 475-486, 2005.','Oncel Tuzel, Lin Yang, Peter Meer and David J. Foran, "Classification of hematologic malignancies using texton signatures", Pattern Analysis and Applications (PAA), Vol. 10, No. 4, pp. 277-290, 2007.','Lin Yang, Wenjin Chen, Peter Meer, Gratian Salaru, Viktors Berstis and David J. Foran, "Virtual microscopy and grid-enabled decision support for large scale analysis of imaged pathology specimens", IEEE Transaction on Information Technology in Biomedicine (TITB), Vol. 13, No. 4, pp. 636-644, 2009','Lin Yang, Oncel Tuzel, Wenjin Chen, Peter Meer, Gratian Salaru, Lauri A. Goodell and David J. Foran, "PathMiner: A web-based tool for computer assisted diagnostics in pathology", IEEE Transaction on Information Technology in Biomedicine (TITB). Vol. 13, No. 3, pp. 291-299, 2009','Jianqin Qu, Leiguang Gong and Lin Yang, "A 3D point matching algorithm for affine registration", International Journal of Computer Assisted Radiology and Surgery, Vol. 6, No. 2, pp. 229-236, 2010.','Lin Yang, Bogdan Georgescu, Yefeng Zheng, Wang Yang, Peter Meer and Dorin Comaniciu, "Prediction based collaborative trackers (PCT): A robust and accurate approach toward 3D medical object tracking ", IEEE Transaction on Medical Imaging (TMI), Vol. 30, No. 11, pp. 1921-1932, 2011','David J. Foran , Lin Yang, Wenjin Chen, Jun Hu, Lauri A. Goodell, Michael Reiss, Fusheng Wang, Tahsin Kurc, Tony Pan, Ashish Sharma, and Joel Saltz. "Image miner: Comparative analysis of tissue microarrays using content based image retrieval, high performance computing, and Grid technology", Journal of American Medical Information Association (JAMIA), Vol. 18, No. 4, pp. 403-415, 2011','David J. Foran, Wenjin Chen and Lin Yang, "Automated image interpretation computer-assisted diagnosis", Analytical Cellular Pathology, Vol. 34, No. 6, pp. 279-300, 2011','Xin Qi, Fuyong Xing, David J. Foran and Lin Yang, "Robust segmentation of overlapping cells in histopathology specimens using parallel seed detection and repulsive level set ", IEEE Transaction on Biomedical Engineering (TBME), Vol. 59, No. 3, pp. 754-765, 2012',"Rebekah H. Gensure, David J. Foran, Vincent M. Lee, Vyacheslav M Gendal, Salma K Jabbour, Darren R Carpizo, John L. Nosher, and Lin Yang, “Evaluation of hepatic tumor response to yttrium-90 radioembolization therapy using texture signatures generated from contrast-enhanced CT”, Academic Radiology, Vol. 19, No. 10, pp. 1201-1207, 2012.",'Xin Qi, Fuyong Xing, David J. Foran, Lin Yang, "A Fast, Automatic Segmentation Algorithm for Locating and Delineating Touching Cell Boundaries in Imaged Histopathology ", Journal of Methods in Medical Informatics, Vol. 51, No. 3, pp. 91- 102, 2012',"Xin Qi, Hyunjoo Kim, Fuyong Xing, Manish Parashar, David J. Foran, Lin Yang, “The Analysis of Image Feature Robustness Using CometCloud”, Vol. 3. No. 33, pp. 1-13, Journal of Pathology Informatics, 2012.","Baiyang Liu, Junzhou Huang, Casimir Kulikowski, Lin Yang, “Robust Visual Tracking Using Local Sparse Appearance Model and K-selection”, IEEE Transaction on Pattern Analysis and Machine Intelligence (TPAMI), Vol. 35, No. 12, pp. 2968-2981, 2013.","Joythi Mula, Jonah D. Lee, Fujun Liu, Lin Yang, Charlotte A. Peterson, “Automated Image Analysis of Skeletal Muscle Fiber Cross-sectional Area”, Journal of Applied Physiology (JAP), Vol. 114, No. 1, pp. 148-155, 2013.","Fujun Liu, Abigail L. Mackey, Ratchakrit Srikuea, Karyn Esser, Lin Yang, “Automated Image Segmentation of Hemotoxylin and Eosin Stained Skeletal Muscle Cross-Sections”, Journal of Microscopy, Vol. 253, No. 3, pp. 275-285, 2013","Hai Su, Fuyong Xing, Jonah Lee, Charlotte Peterson, Lin Yang, “Automatic Myonuclear Detection in Isolated Single Muscle Fiber Using Robust Ellipse Fitting and Sparse Optimization”, IEEE/ACM Transaction on Computational Biology and Bioinformatics (TCBB), 14 pages, 2013","Fujun Liu, Christopher S. Fry, Jyothi Mula, Janna R. Jackson, Jonah D. Lee, Charlotte A. Peterson, Lin Yang, “Automated Fiber-type-specific Cross-sectional Area Assessment and Myonuclei Counting in Skeletal Muscle”, Journal of Applied Physiology (JAP), Vol. 115, No. 11, pp. 1714-1724, 2013","Lin Yang, Xin Qi, Fuyong Xing, Tahsin Kurc, Joel Saltz, David J. Foran, “Parallel Content Based Sub-image Retrieval Using Hierarchical Searching”, Bioinformatics, Vol. 30, No. 7, pp. 996-1002, 2014",'Hui Meng, Paul M. L. Janssen, Robert W. Grange, Lin Yang, Alan H. Beggs, Lindsay C. Swanson, Stacy A. Cossette, Alison Frase, Martin K. Childers, Henk Granzier, Emanuela Gussoni, Michael W. Lawlor, "Tissue triage and freezing for models of skeletal muscle disease", Journal of Visualized Experiments (JOVE), No. 89, 2014',"Michael W. Lawlor, Marissa G. Viola, Hui Meng, Rachel V. Edelstein, Fujun Liu, Ke Yang, Elizabeth J. Luna, Alexandra Lerch-Gaggl, Raymond G. Hoffmann, Christopher R. Pierson, Anna Buj-Bello, Jennifer L. Lachey, Scott Pearsall, Lin Yang, Cecilia Hillard, Alan H. Beggs, “Differential Muscle Hypertrophy Is Associated With Satellite Cell Numbers And Akt Pathway Activation Following Activin Type IIB Receptor Inhibition In Mtm1 p.R69C Mice”, American Journal of Pathology, Vol. 184, No. 6, pp. 1831-1842, 2014","Hongyuan Wang, Fuyong Xing, Hai Su, Arnold Stromberg, and Lin Yang, “Novel image markers for non-small cell lung cancer classification and survival prediction”, BMC Bioinformatics, Vol. 19, No. 15, pp. 310-324, 2014.","Xin Qi, Daihou Wang, Ivan Rodero, Javier Diaz-Montes, Rebekah H Gensure, Fuyong Xing, Hua Zhong, Lauri Goodell, Manish Parashar, David J Foran, Lin Yang, “Content-based histopathology image retrieval using CometCloud”, BMC Bioinformatics, Vol. 15, pp. 287-300, 2014",'Sandra Donkervoort, Ying Hu, Tanya Stojkovic, Nicol Voermans, A. Reghan Foley, Meganne E Leach, Jahannaz Dastgir, Veronique Bolduc, Thomas Cullup, Alix de Becdelievre, Lin Yang, Hai Su, Katherine Meilleur, Alice Schindler, Erik-Jan Kamsteeg, Pascale Richard, Russell Butterfield, Thomas L. Winder, Thomas Crawford, Robert B. Weiss, Francesco Muntoni, Valerie Allamand, Carsten G. Bonnemann, "Mosaicism for dominant COLVI mutations as a cause for intra-familial phenotypic variability", Human Mutation, Vol. 36, No. 1, pp. 48-56, 2014','Michael Spencer, Lin Yang, Akosua Adu, Brian S. Finlin, Beibei Zhu, Lindsey R. Shipp, Neda Rasouli, Charlotte A. Peterson, Philip Kern, "Pioglitazone treatment reduces adipose tissue inflammation through reduction of mast cell and macrophage number and by improving vascularity", PLOS ONE, Vol. 9, No. 7, 2014.','Nicolas Wein, Adeline Vulin, Maria Sofia Falzarano, Christina Al-Khalili Szigyarto, Baijayanta Maiti, Andrew Findlay, Kristin H. Heller, Mathias Uhlen, Baskar Bakthavachalu, Sonia Messina, Giuseppe Vita, Chiara Passarelli, Francesca Gualandi, Steve D. Wilton, Louise Rodino-Klapec, Lin Yang, Diane M. Dunn, Daniel Schoenberg, Robert B. Weiss, Michael T. Howard, Alessandra Ferlini, Kevin M. Flanigan, "A novel DMD IRES results in a functional N-truncated dystrophin, providing a potential route to therapy for patients with 5’ mutations", Nature Medicine, Vol. 20, No. 9, pp. 992-1000, 2014.',"Fuyong Xing, Hai Su, Janna Neltner, Lin Yang, “Automatic Ki-67 Counting Using Robust Cell Detection and Online Dictionary Learning”, IEEE Transaction on Biomedical Engineering (TBME), Vol. 61, No. 3, pp. 859-870, 2014",'Christopher S. Fry, Jonah D. Lee, Jyothi Mula, Tyler J. Kirby, Janna R. Jackson, Fujun Liu, Lin Yang, Esther E. Dupont-Versteegden, John J. McCarthy, Charlotte A. Peterson, "Inducible depletion of satellite cells in adult, sedentary mice impairs muscle regenerative capacity without affecting sarcopenia", Nature Medicine, Vol. 21, pp. 76-80, 2015.','Xiaofan Zhang, Fuyong Xing, Hai Su, Lin Yang, Shaoting Zhang, "High throughput histopathology image analysis via robust cell segmentation and hashing", Medical Image Analysis, Vol. 26, No. 1, pp. 306-315, 2015.',"Tahsin Kurc, Xin Qi, Daihou Wang, Fusheng Wang, George Teodoro, Lee Cooper, Michael Nalisnik, Lin Yang, Joel Saltz, David J Foran, “Scalable Analysis of Big Pathology Image Data Cohorts using Efficient Methods and High-Performance Computing Strategies”, BMC Bioinformatics, Vol. 16, No. 399, 2015","Hai Su, Fuyong Xing, Lin Yang, “Robust cell detection of histopathological brain tumor images using sparse reconstruction and adaptive dictionary selection”, IEEE Transaction on Medical Imaging, Vol. 35, No. 6, 2016.","Fuyong Xing, Lin Yang, “An automatic learning-based framework for robust nucleus segmentation”, IEEE Transaction on Medical Imaging, Vol. 35, No. 2, pp. 550-566, 2016.","Fuyong Xing, Lin Yang, “Robust nucleus/cell detection and segmentation for digital pathology and microscopic images: A comprehensive review”, IEEE Reviews in Biomedical Engineering, No. 9, pp. 234-263, 2016.","Xiaoshuang Shi, Zhenhuo Guo, Feiping Nie, Lin Yang, Jane You, and Dacheng Tao, “Two-dimensional whitening reconstruction for enhancing robustness of principle component analysis”, IEEE Transaction on Pattern Analysis and Machine Intelligence, Vol. 38, No. 10, pp. 2130-2136, 2016","Manish Sapkota, Fujun Liu, Yuanpu Xie, Hai Su, Fuyong Xing, Lin Yang, “AIIMD: An integrated framework of automatic idiopathic inflammatory myopathy diagnosis for muscle”, IEEE Journal of Biomedical and Health Informatics, 2017","Yuanpu Xie, Fuyong Xing, Xiaoshuang Shi, Xiaofei Kong, Hai Su, Lin Yang, “Efficient and robust cell detection: A structured regression approach”, Medical Image Analysis, 2017","Xiaoshuang Shi, Fuyong Xing, Kaidi Xu, Yuanpu Xie, Hai Su, Lin Yang, “Supervised graph hashing for histopathology image retrieval and classification”, Medical Image Analysis, Vol. 22, pp. 117-128, 2017","Zizhao Zhang, Fuyong Xing, Xiaoshuang Shi, Lin Yang, “Revisiting Graph Construction for Fast Image Segmentation”, Pattern Recognition (PR), 2018","Yuanpu Xie, Fuyong Xing, Lin Yang, “Deep Voting and Structured Regression for Microscopy Image Analysis” In Deep Learning for Medical Image Analysis (pp. 155-175), 2018",'Xiaoshuang Shi, Manish Sapkota, Fuyong Xing, Fujun Liu, Lei Cui, Lin Yang, "Pairwise based deep ranking hashing for histopathology image classification and retrieval", accepted to Pattern Recognition, 2018',"Xiaoshuang Shi, Fuyong Xing, Jinzheng Cai, Lin Yang, “Self-learning for face clustering”, accepted to Pattern Recognition, 2018",'Lin Yang, Peter Meer and David J. Foran, "Multiple class segmentation using a unified framework over mean-shift patches", Proc. IEEE International Conference on Computer Vision and Pattern Recognition (CVPR), Vol. 1, pp. 1-8, June 2007.','Lin Yang, Wenjin Chen, Peter Meer, Gratian Salaru, Michael D. Feldman and David J. Foran, "High throughput analysis of breast cancer specimens on the Grid", Proc. International Conference on Medical Image Computing and Computer Assisted Intervention (MICCAI), Vol. 10, pp. 617-625, 2007.','Lin Yang, Bogdan Georgescu, Yefeng Zheng, David J. Foran and Dorin Comaniciu. "A fast and accurate tracking algorithm of left ventricles in 3D echocardiography", Proc. International Symposium on Biomedical Imaging (ISBI), Vol. 5, pp. 221-224, 2008.','Lin Yang, Bogdan Georgescu, Yefeng Zheng, Peter Meer and Dorin Comaniciu, "3D Ultrasound tracking of the left ventricle using one-step forward prediction and data fusion of collaborative trackers", Proc. IEEE International Conference on Computer Vision and Pattern Recognition (CVPR), Vol. 1, pp. 1-8, 2008.','Lin Yang, Oncel Tuzel, Peter Meer and David J. Foran, "Automatic image analysis of histopathology specimens using concave vertex graph", Proc. International Conference on Medical Image Computing and Computer Assisted Intervention (MICCAI), Vol. 11, pp. 833-841, 2008.','Hong Zhang, Lin Yang, David J. Foran, John Nosher, Peter Yim, "3D segmentation of the liver using free-form deformation based on boosting and deformation gradients", Proc. IEEE International Symposium on Biomedical Imaging (ISBI), Vol. 1, pp. 494-497, 2009.','David J. Foran, Lin Yang, Oncel Tuzel, Wenjin Chen, Jun Hu, Tahsin Kurc, Renato Ferreira, Joel Saltz, "A caGrid-enabled, learning based image segmentation method for histopathology specimens", Proc. IEEE International Symposium on Biomedical Imaging (ISBI), Vol. 1, pp. 1306-1309, 2009.','Baiyang Liu, Lin Yang, Casimir Kulikowski, Jinghao Zhou, Leiguang Gong, David J. Foran, Salma J. Jabbour and Ning J. Yue. "An adaptive tracking algorithm of lung tumors in fluoroscopy using online learned collaborative trackers ", IEEE International Symposium on Biomedical Imaging (ISBI), Vol. 1, pp. 209-212, 2010','Baiyang Liu, Lin Yang, Junzhou Huang, P. Meer, Leiguang Gong, Casimir Kulikowski, "Robust and fast visual tracking with two stage sparse optimization", European Conference on Computer Vision (ECCV), Vol. 6314, pp. 624-637, 2010','Tahsin Kurc, Patrick Widener, Wenjin Chen, Fusheng Wang, Lin Yang, Jun Hu, Vijay Kumar, Vicky Chu, Lee Cooper, Jun Kong, Ashish Sharma, Tony Pan, Joel Saltz, David Foran, "Grid-enabled, high-performance microscopy image analysis", High Performance Computing (HP) workshop associated with Proc. International Conference on Medical Image Computing and Computer Assisted Intervention (MICCAI), Beijing, China, 2010','Xin Qi, Fuyong Xing, David J. Foran and Lin Yang, "GPU enabled parallel touching cell segmentation using mean shift based seed detection and repulsive level set", High Performance Computing (HP) workshop associated with Proc. International Conference on Medical Image Computing and Computer Assisted Intervention (MICCAI), Beijing, China, 2010','Xin Qi, Hyunjoo Kim, Fuyong Xing, Manish Parashar, David Foran and Lin Yang, "The Analysis of Image Texture Feature Robustness Using CometCloud", High Performance Computing (HP) Workshop associated with Proc. International Conference on Medical Image Computing and Computer Assisted Intervention (MICCAI), Toronto, Canada, 2011','Lin Yang, Hyunjoo Kim, Manish Parashar and David Foran, "High Throughput Landmark Based Image Registration Using Cloud Computing", High Performance Computing (HP) workshop associated with Proc. International Conference on Medical Image Computing and Computer Assisted Intervention (MICCAI), Toronto, Canada, 2011','Baiyang Liu, Junzhou Huang, Casimir Kulikowski, Lin Yang, "Robust tracking using local sparse appearance model and K-Selection", Proc. IEEE International Conference on Computer Vision and Pattern Recognition (CVPR), Vol. 1, pp. 1-8, 2011',"Xin Qi, Fuyong Xing, Meghana Ghadge, Ivan Rodero, Moustafa Abdelbaky, Manish Parashar, Evita Sadimin, David Foran, Lin Yang, “Content-based Image Retrieval on Imaged Peripheral Blood Smear Specimens using High Performance Computation”, Data- and Compute-intensive Clinical and Translation Imaging associated with the International Conference on Medical Image Computing and Computer Assisted Intervention (MICCAI), Nice, France, 2012","Fuyong Xing, Xin Qi, David Foran, Tahsin Kurc, Joel Saltz, Lin Yang, “Content-based Parallel Sub-image Retrieval”, Data- and Compute-intensive Clinical and Translation Imaging associated with the International Conference on Medical Image Computing and Computer Assisted Intervention (MICCAI), Nice, France, 2012","Fuyong Xing, Lin Yang, “Robust non-small cell lung cancer classification using molecular morphological features”, International Symposium on Biomedical Imaging (ISBI), 2013","Hai Su, Fuyong Xing, Jonah Lee, Charlotte Peterson, Lin Yang, “Learning based automatic detection of myonuclei in isolated single skeletal muscle fibers using multi-focus image fusion”, International Symposium on Biomedical Imaging (ISBI), 2013","Fuyong Xing, Lin Yang, “Robust Selection-based Sparse Shape Model for Lung Cancer Image Segmentation”, The 16th International Conference on Medical Image Computing and Computer Assisted Intervention (MICCAI), Nagoya, Japan, 2013","Fuyong Xing, Hai Su, Lin Yang, “An Integrated Framework for Automatic Ki-67 Scoring in Pancreatic Neuroendocrine Tumor”, The 16th International Conference on Medical Image Computing and Computer Assisted Intervention (MICCAI), Nagoya, Japan, 2013","Xin Qi, Daihou Wang, Javier Diaz-Montes, Ivan Rodero, Tony Pan, Abulimit Aji, Lee Cooper, Fuyong Xing, Manish Parashar, David J. Foran, Lin Yang, “Exploring Online Nuclear Segmentation on Large Fluorescence Brain Tumor Images Using CometCloud”, Accepted to the Six High Performance Computing Workshop Associated with The 16th International Conference on Medical Image Computing and Computer Assisted Intervention (MICCAI), Nagoya, Japan, 2013","Daihou Wang, Xin Qi, Manish Parashar, David J. Foran, Lin Yang, “High Throughput Content-based Image Retrieval Using GPGPU”, Accepted to the Six High Performance Computing Workshop Associated with The 16th International Conference on Medical Image Computing and Computer Assisted Intervention (MICCAI), Nagoya, Japan, 2013","Manish Sapkota, Fujun Liu, Lin Yang, “Distributed Content Based Image Retrieval for Skeletal Muscle Images Using Kd-Tree and MapReduce”, Accepted to the Six High Performance Computing Workshop Associated with The 16th International Conference on Medical Image Computing and Computer Assisted Intervention (MICCAI), Nagoya, Japan, 2013","Fujun Liu, Fuyong Xing, Lin Yang, “Robust muscle cell segmentation using region selection with dynamic programming”, Accepted to 2014 International Symposium on Biomedical Imaging (ISBI), 2014","Fujun Liu, Fuyong Xing, Hai Su, Lin Yang, “Touching adipocyte cells decomposition using combinatorial optimization”, Accepted to 2014 International Symposium on Biomedical Imaging (ISBI), 2014","Xiaofan Zhang, Lin Yang, Wei Liu, Hai Su, Shaoting Zhang, “Mining histopathology images via composite hashing and online learning”, Accepted to The 17th International Conference on Medical Image Computing and Computer Assisted Intervention (MICCAI), Boston, MA, U. S. A., 2014","Fuyong Xing, Manish Sapkota, Lin Yang, “Histopathology lung cancer image mining with Kd-tree and MapReduce”, Accepted to the Seventh High Performance Computing Workshop Associated with The 16th International Conference on Medical Image Computing and Computer Assisted Intervention (MICCAI), Boston, MA, U. S. A. 2014","Daihou Wang, Manuel Diaz Granados, Javier Diaz-Montes, Ivan Rodero, Lin Yang, Manish Parashar, David J. Fordan, Xin Qi, “High-throughput Automatic Gleason-grading System for Prostate Histopathology Images using CometCloud”, Accepted to the Seventh High Performance Computing Workshop Associated with The 16th International Conference on Medical Image Computing and Computer Assisted Intervention (MICCAI), Boston, MA, U. S. A. 2014",'Hai Su, Fujun Liu, Yuanpu Xie, Fuyong Xing, Sreenivasan Meyyappan, Lin Yang, "Region segmentation in histopathological breast cancer images using deep convolutional neural network", Accepted to the 2015 International Symposium on Biomedical Imaging (ISBI), 2015','Fuyong Xing, Lin Yang, "Unsupervised shape prior modeling for cell segmentation in neuroendocrine tumor", Accepted to the 2015 International Symposium on Biomedical Imaging (ISBI), 2015','Manish Sapkota, Fuyong Xing, Hai Su, Lin Yang, "Automatic muscle perimysium annotation using deep convolutional neural network", Accepted to the 2015 International Symposium on Biomedical Imaging (ISBI), 2015',"Xiaofan Zhang, Hai Su, Lin Yang, Shaoting Zhang, “Weighted hashing with multiple cues for cell-level analysis of histopathology images”, Accepted to the 2015 International 24th Biennial International Conference on Information Processing in Medical Imaging (IPMI), 2015","Xiaofan Zhang, Hai Su, Lin Yang, Shaoting Zhang, “Scalable analysis of histopathology images via robust cellular segmentation and weighted hashing”, Accepted to the 2015 International Conference on Computer Vision and Patter Recognition (CVPR), 2015","Fuyong Xing, Lin Yang, “Fast Cell Segmentation Using Scalable Sparse Manifold Learning and Affine Transform-approximated Active Contour”, Accepted to The 18th International Conference on Medical Image Computing and Computer Assisted Intervention (MICCAI), Munich, Germany, 8 pages, 2015","Fujun Liu, Fuyong Xing, Zizhao Zhang, Mason Mcgough, Lin Yang, “Robust Muscle Cell Quantification Using Structured Edge Detection and Hierarchical Segmentation”, Accepted to The 18th International Conference on Medical Image Computing and Computer Assisted Intervention (MICCAI), Munich, Germany, 8 pages, 2015","Fujun Liu, Lin Yang, “A Novel Cell Detection Method Using Deep Convolutional Neural Network and Maximum-Weight Independent Set”, Accepted to The 18th International Conference on Medical Image Computing and Computer Assisted Intervention (MICCAI), Munich, Germany, 8 pages, 2015","Yuanpu Xie, Fuyong Xing, Xiangfei Kong, Hai Su, Lin Yang, “Beyond Classification: Structured Regression For Robust Cell Detection Using Convolutional Neural Network”, Accepted to The 18th International Conference on Medical Image Computing and Computer Assisted Intervention (MICCAI), Munich, Germany, 8 pages, 2015","Yuanpu Xie, Xiangfei Kong, Fuyong Xing, Fujun Liu, Hai Su, Lin Yang, “Deep Voting: A Robust Approach Towards Nucleus Localization In Microscopy Images”, Accepted to The 18th International Conference on Medical Image Computing and Computer Assisted Intervention (MICCAI), Munich, Germany, 8 pages, 2015","Hai Su, Fuyong Xing, Xiangfei Kong, Yuanpu Xie, Shaoting Zhang, Lin Yang, “Robust Cell Detection and Segmentation in Histopathological Images using Sparse Reconstruction and Stacked Denoising Autoencoders”, Accepted to The 18th International Conference on Medical Image Computing and Computer Assisted Intervention (MICCAI), Munich, Germany, 8 pages, 2015","Menglin Jiang, Shaoting Zhang, Junzhou Huang, Lin Yang, Dimitris Metaxas, “Joint Kernel-Based Supervised Hashing for Scalable Histopathological Image Analysis”, Accepted to The 18th International Conference on Medical Image Computing and Computer Assisted Intervention (MICCAI), Munich, Germany, 8 pages, 2015",'Yuanpu Xie, Zizhao Zhang, Manish Sapkota, Lin Yang, "Spatial Clockwork Recurrent Neural Network for Muscle Perimysium Segmentation", Accepted to The 19th International Conference on Medical Image Computing and Computer Assisted Intervention (MICCAI), 2016.','Fuyong Xing, Xiaoshuang Shi, Zizhao Zhang, Jinzheng Cai, Yuanpu Xie, Lin Yang, "Transfer Shape Priors Towards High-throughput Microscopy Image Segmentation", Accepted to The 19th International Conference on Medical Image Computing and Computer Assisted Intervention (MICCAI), 2016.','Jinzheng Cai, Le Lu, Qian Yin, Zizhao Zhang, Fuyong Xing, Lin Yang, "Pancreas Segmentation using Graph based Data Fusion with Convolutional Neural Networks", Accepted to The 19th International Conference on Medical Image Computing and Computer Assisted Intervention (MICCAI), 2016.','Zizhao Zhang, Fuyong Xing, Xiaoshuang Shi, Lin Yang, "SemiContour: A semi-supervised learning approach for contour detection", IEEE International Conference on Computer Vision and Pattern Recognition (CVPR), 2016','Xiaoshuang Shi, Fuyong Xing, Jinzheng Cai, Zizhao Zhang, Yuanpu Xie, Lin Yang, "Kernel-based supervised discrete hashing for image retrieval", European Conference on Computer Vision (ECCV), 2016.','Zizhao Zhang, Yuanpu, Xie, Fuyong Xing, Mason Mcgough, Lin Yang, "MDNet: A Semantically and Visually Interpretable Medical Image Diagnosis Network", IEEE Conference on Computer Vision and Pattern Recognition (CVPR), 2017 oral (2.7% acceptance rate)','Zizhao Zhang, Pingjun Chen, Manish Sapkota, Lin Yang, "TandemNet: Distilling Knowledge from Medical Images Using Diagnostic Reports as Optional Semantic References", International Conference on Medical Image Computing and Computer Assisted Intervention (MICCAI), 2017 oral (3.6% acceptance rate)','Xiaoshuang Shi, Fuyong Xing, Kaidi Xu, Manish Sapkota, Lin Yang, "Asymmetric discrete graph hashing", The thirty-first AAAI conference on Artificial Intelligence (AAAI), 2017','Jinzheng Cai, Le Lu, Yuanpu Xie, Fuyong Xing, Lin Yang, "Improving deep pancreas segmentation in CT and MRI image via recurrent neural contextual learning and direct loss function", International Conference on Medical Image Computing and Computer Assisted Intervention (MICCAI), 2017','Xiaoshuang Shi, Fuyong Xing, Yuanpu Xie, Lin Yang, "Cell encoding for histopathology image classification", International Conference on Medical Image Computing and Computer Assisted Intervention (MICCAI), 2017',"Zizhao Zhang*, Yuanpu Xie*, Lin Yang, “Photographic Text-to-Image Synthesis with a Hierarchically-nested Adversarial Network”, International Conference on Computer Vision and Pattern Recognition (CVPR), 2018, Spotlight (~8%) * indicates equal contribution","Zizhao Zhang, Lin Yang, Y. Zheng, “Translating and Segmenting Multimodal Medical Volumes with Cycle- and Shape-Consistency Generative Adversarial Network”, International Conference on Computer Vision and Pattern Recognition (CVPR), 2018",'Mehmet Celenk, Lin Yang, Ganti Kamalakar, Derek J. Bleyle, Sudhir K. Sunkara, Yufei Wang, Philip Prudich, Yuangcui Huang and Qiang Zhou, "Tumor detection in VIVO NIRF imaging", Vol. 5370, SPIE International Symposium on Medical Imaging (SPIE), 2004.','Lin Yang, Jundong Liu, Charles D. Cavanaugh and Lonnie R. Welch, "A robust QoS forecasting algorithm for a dynamic, distributed real-time testbed", Proc. IEEE International Workshop on Computer Architectures for Machine Perception (WCAMP), New Orleans, LA, May, 2003','Lin Yang, Jundong Liu, Charles D. Cavanaugh and Lonnie R. Welch, "A L2E-based QoS forecasting technique for dynamic, distributed real-time systems", Proc. International Conference on Parallel and Distributed Processing Techniques and Applications (PDPTA), 2004.','Dazhang Gu, Lin Yang and Lonnie R. Welch. "A predictive, decentralized load balancing approach", 19th Proc. IEEE International Parallel and Distributed Processing Symposium (IPDPS), Vo1. 1, pp. 101-110, 2005.','Lin Yang and David J. Foran. "A variational framework for partially occluded image segmentation using coarse to fine shape alignment and semi-parametric density approximation", Proc. IEEE International Conference on Image Processing (ICIP), Vol. 1, pp. 78-82, 2007.','Lin Yang, Leiguang Gong, Hong Zhang, John L. Nosher and David J. Foran, "A multicore based parallel image registration method", Proc. International Conference on Engineering in Medicine and Biology Society (EMBS), Vol. 1, pp. 98-101, 2009.','Lin Yang, Leiguang Gong, Hong Zhang, John L. Nosher and David J. Foran, "A parallel point matching algorithm for landmark based image registration using multicore platform", European Conference on Parallel Computing (Euro-par), Vol. 5704, pp. 936-947, 2009.','Hyunjoo Kim, Manish Parashar, David J. Foran and Lin Yang, "Investigating the use of automatic cloudbursts for high-throughput medical image registration", IEEE International Conference on Grid Computing (GRID), Vol. 1, pp. 34-41, 2009.','Fuyong Xing, Baiyang Liu, Xin Qi, David J. Foran and Lin Yang, "Digital tissue microarray classification using sparse reconstruction", SPIE International Symposium on Medical Imaging (SPIE), 2012',"Hai Su, Yong Shen, Fuyong Xing, Xin Qi, Kim M. Hirshfield, Lin Yang, and David J. Foran, “Robust automatic breast cancer staging using a combination of functional genomics and image-omics”, Proc. International Conference on Engineering in Medicine and Biology Society (EMBS), accepted, 5 pages, 2015"]}}},y,!1,function(t){i("6zwf")},"data-v-442118ac",null).exports,b={props:["basic","host"],computed:{gender:function(){return"zh"==(this.host?window.lang:i18n.locale)?{"男":"男","女":"女","其他":"其他"}:{"男":"M","女":"F","其他":"O"}}}},C={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"person-info"},[i("h4",{class:{title:!0,print:t.host}},[t._v(t._s(t.$t("basic.basic")))]),t._v(" "),i("table",{class:{print:t.host},attrs:{cellspacing:"0"}},[i("tr",{attrs:{valign:"top"}},[i("td",{attrs:{width:"40%"}},[i("span",{staticClass:"weight600"},[t._v(t._s(t.$t("report.name")))]),t._v("\n                "+t._s(t.basic.name)+"\n            ")]),t._v(" "),i("td",{attrs:{width:"40%"}},[i("span",{staticClass:"weight600"},[t._v(t._s(t.$t("basic.sex")))]),t._v("\n                "+t._s(t.gender[t.basic.gender])+"\n            ")]),t._v(" "),i("td",[i("span",{staticClass:"weight600"},[t._v(t._s(t.$t("basic.age")))]),t._v("\n                "+t._s(t.basic.age)+"\n            ")])]),t._v(" "),i("tr",{attrs:{valign:"top"}},[i("td",{attrs:{width:"40%"}},[i("span",{staticClass:"weight600"},[t._v(t._s(t.$t("basic.sampleCollectDate")))]),t._v("\n                "+t._s(t.basic.sampleCollectDate)+"\n            ")]),t._v(" "),i("td",{attrs:{width:"40%"}},[i("span",{staticClass:"weight600"},[t._v(t._s(t.$t("report.caseid")))]),t._v("\n                "+t._s(t.basic.caseid)+"\n            ")]),t._v(" "),i("td",[i("span",{staticClass:"weight600"},[t._v(t._s(t.$t("basic.samplePart")))]),t._v("\n                "+t._s(t.basic.samplePart)+"\n            ")])]),t._v(" "),i("tr",{attrs:{valign:"top"}},[i("td",{attrs:{width:"40%"}},[i("span",{staticClass:"weight600"},[t._v("送检医院：")]),t._v("\n                "+t._s(t.basic.inspectionHospital)+"\n            ")]),t._v(" "),i("td",{attrs:{colspan:"2"}},[i("span",{staticClass:"weight600"},[t._v("送检医生：")]),t._v("\n                "+t._s(t.basic.inspectionDoctor)+"\n            ")])]),t._v(" "),i("tr",{attrs:{valign:"top"}},[i("td",{staticClass:"dias",attrs:{colspan:"3"}},[i("span",{staticClass:"weight600"},[t._v(t._s(t.$t("basic.cancerType")))]),t._v(" "),i("span",{staticStyle:{display:"inline-block",width:"500px","min-height":"20px","vertical-align":"top","line-height":"20px"}},[t._v(t._s(t.basic.cancerType))])])])])])},staticRenderFns:[]};var w=i("VU/8")(b,C,!1,function(t){i("GbrN")},"data-v-2b7c3fdc",null).exports,k={props:["slices","recordId","host","type","roishow"],data:function(){return{list:[]}},methods:{checkData:function(){var t=[];[].concat(l()(this.slices.dna)).length&&(t=[].concat(l()(this.slices.dna)).filter(function(t){return"dnaIcon"!==t.iconType})),this.list=[].concat(l()(this.slices.human),l()(this.slices.tct),l()(t))}},watch:{slices:{immediate:!0,deep:!0,handler:function(t){this.slices=t,"dna"==this.type?this.checkData():this.list=[].concat(l()(this.slices.human),l()(this.slices.tct))}},type:{immediate:!0,deep:!0,handler:function(t){this.type=t,"dna"==this.type?this.checkData():this.list=[].concat(l()(this.slices.human),l()(this.slices.tct))}}}},x={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{class:{microscope:!0,print:t.host}},[i("h4",{class:{title:!0,print:t.host}},[t._v("镜下所见")]),t._v(" "),i("div",{staticClass:"slices"},[t.slices.human&&t.slices.human.length||t.slices.tct&&t.slices.tct.length||t.slices.dna&&t.slices.dna.length?i("div",{staticClass:"card"},t._l([].concat(t.list),function(e){return i("div",{key:e.id,class:t.host?"slice-list clearfix print":"slice-list clearfix"},[i("div",{staticClass:"fleft"},[i("img",{attrs:{src:t.host?t.host+"/data/"+t.recordId+"/slices/"+e.fileid+"/roi/"+t.ai.id+".jpg":"/aipath/api/files/ROI?caseid="+t.recordId+"&fileid="+e.fileid+"&filename="+encodeURIComponent(e.filename)+"&roi=[["+Math.min.apply(Math,e.path.x)+","+Math.min.apply(Math,e.path.y)+"],["+Math.max.apply(Math,e.path.x)+","+Math.max.apply(Math,e.path.y)+"]] &roiid="+e.id,alt:""}})]),t._v(" "),t.roishow?t._e():i("div",{staticClass:"slice-name"},[t._v("切片名称："+t._s(e.filename))]),t._v(" "),i("div",{staticClass:"slice-name"},[t._v(t._s(e.remark))])])}),0):t._e()])])},staticRenderFns:[]};var $=i("VU/8")(k,x,!1,function(t){i("a0GU")},"data-v-fc567692",null).exports,I=i("mtWM"),O=i.n(I),A=i("mw3O"),M=i.n(A),S=O.a.CancelToken;function T(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{headers:{},onUploadProgress:void 0};t.startsWith("/")||(t="/aipath/api/"+t);var s=S.source();i.cancelToken=s.token;var n=O()({method:"post",onUploadProgress:i.onUploadProgress,url:t,data:M.a.stringify(e)}).then(function(t){if(400==t.data.code&&console.log(vue.$router.push("/login")),0!=t.data.code)throw t.data;return t.data});return n.cancel=function(){s.cancel("取消")},n}function F(){return j("jwt")?JSON.parse(atob(j("jwt").split(".")[1]+"")):{}}function j(t){var e,i=new RegExp("(^| )"+t+"=([^;]*)(;|$)");return(e=document.cookie.match(i))?unescape(e[2]):null}var E={props:["viewRecord","host","viewReportType","propslices","remotesign","remotesigned"],components:{"v-tct2":n,"v-tct1":o,"v-dna":v,"v-dna2":h,"v-reg":f,"v-esd":_,"v-reference":R,"v-basic":w,"v-slides":$},data:function(){return{record:this.viewRecord,reportType:this.viewReportType,componentType:"view",img_error:!0,slices:this.propslices,sign:this.remotesign,signed:this.remotesigned,showDna:!1}},watch:{viewRecord:function(t){this.record=t},viewReportType:function(t){this.reportType=t},propslices:function(t){this.slices=t},remotesigned:function(t){this.signed=t},remotesign:function(t){this.sign=t}},methods:{imgError:function(){this.img_error=!1},currentTime:function(){var t=new Date,e=t.getFullYear(),i=t.getMonth()+1,s=t.getDate();return e+"-"+(i<10?"0"+i:i)+"-"+(s<10?"0"+s:s)},getReport:function(t,e){var i=this;return T("report/get",{caseid:t,reportid:e}).then(function(t){if(0==t.code){var e=JSON.parse(t.data);i.record=e,i.reportType=e.reportInfo.type.toUpperCase()}}).catch(function(t){i.$message({message:t.message,type:"error"})})},getremoteImage:function(t){var e=this;T("report/getReportROI",{caseid:t,alg:this.reportType.toLowerCase()}).then(function(t){e.slices=t.data,e.dnaType?(e.showDna=!0,setTimeout(function(){window.status=1},5e3)):setTimeout(function(){window.status=1},3e3)})},GetQueryString:function(t){for(var e=window.location.search,i=e.indexOf("?"),s=(e=e.substr(i+1)).split("&"),n=[],a=0;a<s.length;a++){var o=s[a].indexOf("=");n.push(s[a].substring(0,o)),n.push(s[a].substr(o+1))}var r=n.indexOf(t);return r>=0?n[r+1]:t+"不是正确的参数名"},getDNAInfo:function(t,e){T("report/getDNAInfo",{caseid:this.record.id,fileid:this.record.slice}).then(function(t){var i=t.data;e(i)})}},computed:{esdType:function(){return this.record&&"ESD"==(this.reportType||this.record.reportInfo.type)},lctType:function(){return this.record&&("LCT"==this.reportType||"LCT"==this.record.reportInfo.type)},dnaType:function(){return this.record&&"DNA"==(this.reportType||this.record.reportInfo.type)},regType:function(){return this.record&&"REG"==(this.reportType||this.record.reportInfo.type)},pureReport:function(){return!this.host&&"report"!=this.componentType},pageType:function(){return this.record&&this.record.reportInfo.DNA&&this.record.reportInfo.DNA.pageType},reportTypeMode:function(){return this.record&&this.record.reportInfo.DNA&&this.record.reportInfo.DNA.reportTypeMode}},created:function(){var t=this;"/report.html"==window.location.pathname&&(this.getReport(this.GetQueryString("caseid"),this.GetQueryString("reportid")).then(function(e){t.getremoteImage(t.GetQueryString("caseid"))}),this.componentType="report",this.sign="/aipath/api/user/sign?id="+this.GetQueryString("username")+"&"+Math.random(),T("user/haveSign").then(function(e){t.signed=e.data}),console.log(444))},mounted:function(){"view"===this.componentType&&(this.showDna=!0,this.$refs.father.style.width="905px",this.$refs.father.style.position="absolute",this.$refs.father.style.position="absolute",this.$refs.father.style.right="22px",this.$refs.father.style.top="62px")},updated:function(){var t=this;this.$nextTick(function(){"report"===t.componentType&&(document.getElementById("main").style.paddingTop="44px")})}},P={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{ref:"father",staticClass:"father"},[t.dnaType&&"double"==t.reportTypeMode?i("div",{class:t.host?"print content first":"content first"},[t.pureReport?i("div",{staticClass:"header"},[i("img",{staticClass:"logo",attrs:{src:t.record.logo,id:"logoView",alt:""}}),t._v(" "),i("div",{staticClass:"text"},[t._v("\n                    样本号："+t._s(this.record.basic.caseid)+"   "+t._s(t.$t("report.date"))+t._s(t.currentTime())+"\n                ")])]):t._e(),t._v(" "),"TBSPage"===t.pageType?i("div",{staticClass:"main",attrs:{id:"main"}},[i("h2",{class:{print:t.host}},[t._v(t._s(t.record.report_name))]),t._v(" "),i("h3",{class:{print:t.host}},[t._v(t._s(t.record.report_info))]),t._v(" "),t.record?i("v-basic",{attrs:{basic:t.record.basic,host:t.host}}):t._e(),t._v(" "),t.dnaType?i("v-tct1",{attrs:{info:t.record.reportInfo,host:t.host}}):t._e(),t._v(" "),i("v-slides",{attrs:{slices:t.slices,recordId:t.record.id,roishow:t.record.roishow,type:t.reportType&&t.reportType.toLowerCase()||t.record.reportInfo.type.toLowerCase(),host:t.host}}),t._v(" "),i("div",{class:t.host?"print sign":"sign",staticStyle:{"box-sizing":"content-box"}},[i("div",[t._v(t._s(t.$t("report.doctor")))]),t._v(" "),t.signed?i("img",{directives:[{name:"show",rawName:"v-show",value:t.img_error,expression:"img_error"}],attrs:{src:t.sign},on:{error:function(e){return t.imgError()}}}):t._e()])],1):t._e(),t._v(" "),"DNAPage"===t.pageType?i("div",{staticClass:"main",attrs:{id:"main"}},[i("h2",{class:{print:t.host}},[t._v(t._s(t.record.report_name))]),t._v(" "),i("h3",{class:{print:t.host}},[t._v(t._s(t.record.report_info))]),t._v(" "),t.record?i("v-basic",{attrs:{basic:t.record.basic,host:t.host}}):t._e(),t._v(" "),t.dnaType&&t.showDna?i("v-dna2",{attrs:{info:t.record.reportInfo,sliceId:t.record.slice,host:t.host,slices:t.slices,recordId:t.record.id,roishow:t.record.roishow},on:{getDNAInfo:t.getDNAInfo}}):t._e(),t._v(" "),i("div",{class:t.host?"print sign":"sign",staticStyle:{"box-sizing":"content-box"}},[i("div",[t._v(t._s(t.$t("report.doctor")))]),t._v(" "),t.signed?i("img",{directives:[{name:"show",rawName:"v-show",value:t.img_error,expression:"img_error"}],attrs:{src:t.sign},on:{error:function(e){return t.imgError()}}}):t._e()])],1):t._e(),t._v(" "),t.pureReport?i("div",{staticClass:"footer clearfix"},[i("div",{staticClass:"fleft"},[i("p",[t._v(t._s(t.$t("report.bottom")))]),t._v(" "),i("p",[t._v("research use only")])])]):t._e()]):i("div",{class:t.host?"print content first":"content first"},[t.pureReport?i("div",{staticClass:"header"},[i("img",{staticClass:"logo",attrs:{src:t.record.logo,id:"logoView",alt:""}}),t._v(" "),i("div",{staticClass:"text"},[t._v("\n                    样本号："+t._s(this.record.basic.caseid)+"   "+t._s(t.$t("report.date"))+t._s(t.currentTime())+"\n                ")])]):t._e(),t._v(" "),i("div",{staticClass:"main",attrs:{id:"main"}},[i("h2",{class:{print:t.host}},[t._v(t._s(t.record.report_name))]),t._v(" "),i("h3",{class:{print:t.host}},[t._v(t._s(t.record.report_info))]),t._v(" "),t.record?i("v-basic",{attrs:{basic:t.record.basic,host:t.host}}):t._e(),t._v(" "),t.lctType?i("v-tct2",{attrs:{info:t.record.reportInfo,host:t.host}}):t._e(),t._v(" "),t.dnaType&&t.showDna?i("v-dna",{attrs:{info:t.record.reportInfo,sliceId:t.record.slice,host:t.host,slices:t.slices,recordId:t.record.id,roishow:t.record.roishow},on:{getDNAInfo:t.getDNAInfo}}):t._e(),t._v(" "),t.regType?i("v-reg",{attrs:{info:t.record.reportInfo,host:t.host}}):t._e(),t._v(" "),t.esdType?i("v-esd",{attrs:{info:t.record.reportInfo,host:t.host}}):t._e(),t._v(" "),t.dnaType?t._e():i("v-slides",{attrs:{slices:t.slices,recordId:t.record.id,roishow:t.record.roishow,type:t.reportType&&t.reportType.toLowerCase()||t.record.reportInfo.type.toLowerCase(),host:t.host}}),t._v(" "),i("div",{class:t.host?"print sign":"sign",staticStyle:{"box-sizing":"content-box"}},[i("div",[t._v(t._s(t.$t("report.doctor")))]),t._v(" "),t.signed?i("img",{directives:[{name:"show",rawName:"v-show",value:t.img_error,expression:"img_error"}],attrs:{src:t.sign},on:{error:function(e){return t.imgError()}}}):t._e()])],1),t._v(" "),t.pureReport?i("div",{staticClass:"footer clearfix"},[i("div",{staticClass:"fleft"},[i("p",[t._v(t._s(t.$t("report.bottom")))]),t._v(" "),i("p",[t._v("research use only")])])]):t._e()])])},staticRenderFns:[]};i.d(e,!1,function(){return F}),i.d(e,!1,function(){return j});var D=i("VU/8")(E,P,!1,function(t){i("4dxX")},"data-v-12f22c8e",null);e.a=D.exports},e0JV:function(t,e){},eBbF:function(t,e){},fC4T:function(t,e){t.exports=function(t){return t&&"object"==typeof t&&"function"==typeof t.copy&&"function"==typeof t.fill&&"function"==typeof t.readUInt8}},feOy:function(t,e){},foGf:function(t,e){},gJtp:function(t,e){},gbAu:function(t,e){},gyaa:function(t,e){},iEaZ:function(t,e,i){t.exports=i.p+"static/img/矩形排除.e7e2699.svg"},iHgs:function(t,e){},jdSn:function(t,e,i){t.exports=i.p+"static/img/矩形.2e64410.svg"},k5KV:function(t,e,i){(function(){var e,s,n=[].slice;s=i("rdLu"),i("OMJi").puts,e={isPlainObject:function(t){return null!=(null!=t?t.constructor:void 0)&&"Object"===t.constructor.name},clone:function(t){var i,n,a,o,r;if(s.isArray(t)){for(i=[],o=0,r=t.length;o<r;o++)a=t[o],i.push(e.clone(a));return i}if(e.isPlainObject(t)){for(n in i={},t)a=t[n],i[n]=e.clone(a);return i}return t},equals:function(t,i){var n,a,o,r,l;if(t===i)return!0;if(s.isArray(t)){if(!s.isArray(i)||t.length!==i.length)return!1;for(n=r=0,l=t.length;0<=l?r<l:r>l;n=0<=l?++r:--r)if(!e.equals(t[n],i[n]))return!1;return!0}if(e.isPlainObject(t)){if(o=s.size(t),!e.isPlainObject(i)||o!==s.size(i))return!1;for(a in t)if(!e.equals(t[a],i[a]))return!1;return!0}return!1},extend:function(){var t,i,s,a,o,r;for(t=arguments[0],o=0,r=(a=2<=arguments.length?n.call(arguments,1):[]).length;o<r;o++)for(i in s=a[o])e.isPlainObject(t[i])&&e.isPlainObject(s[i])?e.extend(t[i],s[i]):t[i]=e.clone(s[i]);return t},select:function(t,i,n){var a,o,r,l;if(null==n&&(n=[]),r=[],i(t))r.push({path:n,value:t});else if(s.isObject(t))for(o in t)l=t[o],(a=s.clone(n)).push(o),r=r.concat(e.select(l,i,a));return r},set:function(t,e,i){var n,a,o;for(n=(e=s.clone(e)).pop(),a=0,o=e.length;a<o;a++)t=t[e[a]];return t[n]=i},transform:function(t,i,n){var a,o,r,l,c;if(i(t))return n(t);if(s.isArray(t)){for(o=[],l=0,c=t.length;l<c;l++)r=t[l],o.push(e.transform(r,i,n));return o}if(e.isPlainObject(t)){for(a in o={},t)r=t[a],o[a]=e.transform(r,i,n);return o}return t}},t.exports=e}).call(this)},k8Nx:function(t,e,i){t.exports=i.p+"static/img/关闭.a9102f6.png"},kNmz:function(t,e){},kcF8:function(t,e){},l7ju:function(t,e){},nPAZ:function(t,e,i){t.exports=i.p+"static/img/标注列表-缺省.04d341d.png"},ntHD:function(t,e){},nxrE:function(t,e){},oHR0:function(t,e){},odF9:function(t,e){},ogye:function(t,e){},pHcL:function(t,e){},qKzM:function(t,e){},qbzz:function(t,e,i){"use strict";(function(t){var s=i("I9+T"),n=i("k5KV"),a=i.n(n),o=i("jyVo"),r=[];r.append=function(t){let e=()=>{var t=r.shift();if(!t)return r.running=!1;r.running=!0,t().then(e).catch(e)};this.push(t),this.running||e()};let l=!1;function c(t,e=t.currentTarget){return t.touches?u(t.touches[0],e):t}function u(t,e){for(var i={x:0,y:0};e.offsetParent;)i.x+=e.offsetLeft,i.y+=e.offsetTop,e=e.offsetParent;return{offsetX:t.clientX-i.x,offsetY:t.clientY-i.y,x:t.clientX,y:t.clientY,shiftKey:t.shiftKey}}e.a={props:["slice","record","roilist","curRois","centerRegion","penColor","position","content","companyid","showMppGuide","cellArea","showLayer"],data(){return{mpp:this.slice.mppx||.242042,scale:1,fullPage:!1,osd:null,company:this.$props.companyid||Object(o.s)().company,viewport:null,paper:null,selectedTool:"choose",dataMapPath:{},offsetWidth:0,offsetHeight:0,curRoi:null,showRoi:!0,showScreenshot:!1,saved:!1,screenshotImages:[],showLabel:!0,knew:!1,drawMpp:!1,userMpp:null,deg:0,lineA:null,lineB:null,uploadData:new Map}},methods:{rotate(){this.deg+=90,this.$refs.rotate.style.transform=`rotate(${this.deg}deg)`},drawCell(){this.$emit("closeMppGuide",!0),this.drawMpp=!0,this.selectedTool="rectangle"},convertPoint(t,e){return this.paper.view.viewToProject(new this.paper.Point(t,e))},initOSD(){let t=OpenSeadragon({element:this.$refs.osd,tileSources:{height:this.slice.height,width:this.slice.width,tileSize:1024,getTileUrl:(t,e,i)=>`/aipath/api/files/slice?x=${e}&y=${i}&z=${t}&caseid=${this.record.id}&fileid=${this.slice.id}&companyid=${this.company}&filename=${encodeURIComponent(this.slice.filename||this.slice.name)}`},minZoomLevel:.001,maxZoomLevel:1e4,visibilityRatio:.01,toolbar:this.$refs.hideToolbar,mouseNavEnabled:!1,animationTime:.8,maxImageCacheCount:12});this.osd=t,this.viewport=t.viewport,this.$emit("viewer",this.viewport),t.activateImagingHelper(),t.addHandler("open",()=>{this.paper=new paper.PaperScope,this.paper.activate(),this.paper.setup(this.$refs.canvas),this.paper.settings.handleSize=8,this.roilistChange(this.roilist||[],[]),this.resized(),this.position.zoom?this.update(this.position,!0):this.buttonClick("home"),t.addHandler("update-viewport",()=>{let t=this.slice.width,{x:e,y:i}=this.viewport.getBounds(!0).getCenter();this.paper.view.setCenter(e*t,i*t),this.paper.view.zoom=this.viewport.viewportToImageZoom(this.viewport.getZoom(!0))})}),this.$refs.osd.addEventListener("contextmenu",this.contextmenu),window.addEventListener("resize",this.resize)},mappAgain(){this.roilist.forEach(t=>{this.$emit("delRoi",t)}),setTimeout(()=>{this.drawCloseRoi()},100)},drawCloseRoi(){let t=a.a.clone(this.record.slices.filter(t=>-1!==t.name.indexOf("痕"))[0].roilist);if(0===t.length)return void this.$message({message:"未检查到ESD数据标注，无法映射",type:"error"});let e=t.map(t=>({x:t.path.x,y:t.path.y,name:t.name}));var i=[];this.record.slices.filter(t=>-1===t.name.indexOf("痕")&&-1===t.name.indexOf("体")).forEach(t=>{i=[...i,...t.roilist]});var s=i.filter(t=>t.hasOwnProperty("esdMessage")),n=[];if(Math.abs(t[0].path.x[0]-t[0].path.x[1])>Math.abs(t[0].path.y[0]-t[0].path.y[1])){e.forEach(t=>{t.x[0]>t.x[1]&&(t.x.reverse(),t.y.reverse())}),e.sort((t,e)=>t.y[0]-e.y[0]);var o=[];e.forEach(t=>{var e=s.find(e=>e.name===t.name);e?o.push(e.esdMessage):o.push([])});var r=[];o.forEach(t=>{1!==t.length?r.push(t.filter(e=>e.startingPointDistance===Math.max.apply(Math,t.map(t=>t.startingPointDistance))||e.startingPointDistance===Math.min.apply(Math,t.map(t=>t.startingPointDistance)))):r.push(t)}),e.forEach((t,e)=>{var i=[],s=new this.paper.Path({strokeWidth:1,strokeColor:"white",strokeScaling:!1,fillColor:"rgba(0,0,0,0.001)"});s.add(new this.paper.Point(this.record.slices.filter(t=>-1!==t.name.indexOf("痕"))[0].roilist.find(e=>e.name===t.name).path.x[0],this.record.slices.filter(t=>-1!==t.name.indexOf("痕"))[0].roilist.find(e=>e.name===t.name).path.y[0])),s.add(new this.paper.Point(this.record.slices.filter(t=>-1!==t.name.indexOf("痕"))[0].roilist.find(e=>e.name===t.name).path.x[1],this.record.slices.filter(t=>-1!==t.name.indexOf("痕"))[0].roilist.find(e=>e.name===t.name).path.y[1])),r[e].forEach(t=>{var e=s.length*t.startingPointDistance/t.totalLength,n=s.length*(t.startingPointDistance+t.intersectionDistance)/t.totalLength,a=s.getPointAt(e),o=s.getPointAt(n);i.push({x:parseInt(a.x),y:parseInt(a.y)}),i.push({x:parseInt(o.x),y:parseInt(o.y)})}),2!=i.length&&0!=i.length&&(i=i.filter(t=>t.x===Math.min.apply(Math,i.map(t=>t.x))||t.x===Math.max.apply(Math,i.map(t=>t.x))))[0].x>i[1].x&&i.reverse(),n.push(i),s.remove()})}else{e.forEach(t=>{t.y[0]>t.y[1]&&(t.x.reverse(),t.y.reverse())}),e.sort((t,e)=>t.x[0]-e.x[0]);o=[];e.forEach(t=>{var e=s.find(e=>e.name===t.name);e?o.push(e.esdMessage):o.push([])});r=[];o.forEach(t=>{1!==t.length?r.push(t.filter(e=>e.startingPointDistance===Math.max.apply(Math,t.map(t=>t.startingPointDistance))||e.startingPointDistance===Math.min.apply(Math,t.map(t=>t.startingPointDistance)))):r.push(t)}),e.forEach((t,e)=>{var i=[],s=new this.paper.Path({strokeWidth:1,strokeColor:"white",strokeScaling:!1,fillColor:"rgba(0,0,0,0.001)"});s.add(new this.paper.Point(this.record.slices.filter(t=>-1!==t.name.indexOf("痕"))[0].roilist.find(e=>e.name===t.name).path.x[0],this.record.slices.filter(t=>-1!==t.name.indexOf("痕"))[0].roilist.find(e=>e.name===t.name).path.y[0])),s.add(new this.paper.Point(this.record.slices.filter(t=>-1!==t.name.indexOf("痕"))[0].roilist.find(e=>e.name===t.name).path.x[1],this.record.slices.filter(t=>-1!==t.name.indexOf("痕"))[0].roilist.find(e=>e.name===t.name).path.y[1])),r[e].forEach(t=>{var e=s.length*t.startingPointDistance/t.totalLength,n=s.length*(t.startingPointDistance+t.intersectionDistance)/t.totalLength,a=s.getPointAt(e),o=s.getPointAt(n);i.push({x:parseInt(a.x),y:parseInt(a.y)}),i.push({x:parseInt(o.x),y:parseInt(o.y)})}),2!=i.length&&0!=i.length&&(i=i.filter(t=>t.y===Math.min.apply(Math,i.map(t=>t.y))||t.y===Math.max.apply(Math,i.map(t=>t.y))))[0].y>i[1].y&&i.reverse(),n.push(i),s.remove()})}var l=[];e.forEach(t=>{l.push(t.x.map((e,i)=>({x:e,y:t.y[i]})))});for(var c={x:[],y:[]},u=0;u<l.length;u++)c.x.push(l[u][0].x),c.y.push(l[u][0].y);for(u=l.length-1;u>=0;u--)c.x.push(l[u][1].x),c.y.push(l[u][1].y);var h={x:[],y:[]};for(u=0;u<n.length;u++)0!=n[u].length&&(h.x.push(n[u][0].x),h.y.push(n[u][0].y));for(u=n.length-1;u>=0;u--)0!=n[u].length&&(h.x.push(n[u][1].x),h.y.push(n[u][1].y));l.forEach(t=>{var e={method:"signLine",path:{x:[t[0].x,t[1].x],y:[t[0].y,t[1].y]}};this.$emit("draw",e)});var d={method:"signArea",path:c};this.$emit("draw",d);var p={method:"redArea",path:h};this.$emit("draw",p)},move(t,e,i){this.$emit("position","number"==typeof t?t:this.position.offx,"number"==typeof e?e:this.position.offy,"number"==typeof i?i:this.position.zoom)},update(t=this.position,e){this.viewport.zoomTo(t.zoom,"",e),this.viewport.panTo({x:t.offx,y:t.offy},e)},resize(){setTimeout(t=>this.resized(this.position.zoom/this.scale),0)},resized(t){this.offsetWidth=this.$refs.osd.offsetWidth,this.offsetHeight=this.$refs.osd.offsetHeight,this.paper.view.viewSize=[this.offsetWidth,this.offsetHeight],this.scale=this.mpp*this.slice.width*Math.min(this.offsetHeight/this.offsetWidth,1)/22e3,this.move(null,null,t?t*this.scale:null),t&&t*this.scale!=this.position.zoom||setTimeout(this.update,80)},navstart(t){if(t.button)return;let e=this.$refs.navigator;var i=t=>{t=c(t),this.move(t.offsetX/e.clientWidth,t.offsetY/e.clientHeight*this.slice.height/this.slice.width)},s=()=>{e.removeEventListener("mousemove",i),e.removeEventListener("touchmove",i),window.removeEventListener("mouseup",s)};e.addEventListener("mousemove",i),e.addEventListener("touchmove",i),window.addEventListener("mouseup",s),i(t)},handleFullScreen(){this.fullPage=!this.fullPage,localStorage.setItem("fullPage",this.fullPage),this.resize()},buttonClick(t){switch(t){case"zoom-in":this.move(null,null,2*this.position.zoom);break;case"zoom-out":this.move(null,null,this.position.zoom/2);break;case"home":let e=this.slice.width/this.slice.height;this.move(.5,.5/e,Math.min(this.offsetHeight/this.offsetWidth*e,1));break;case"original":this.move(null,null,this.slice.width/this.offsetWidth);break;default:this.move(null,null,t)}},path2data:t=>({x:t.map(t=>Math.round(t.point.x)),y:t.map(t=>Math.round(t.point.y))}),equal(t,e){if(t.length!==e.length)return!1;for(let i=0;i<t.length;i++)if(t[i].image!==e[i].image)return!1;return!0},roilistChange(t,e){let i={},s={};t.filter(t=>t.image!=e[t.id]).map(t=>{i[t.id]=t}),e.filter(e=>e.image!=t[e.id]).map(t=>{s[t.id]=t});let n=e.filter(t=>!a.a.equals(t,i[t.id])),o=t.filter(t=>!a.a.equals(t,s[t.id]));if(this.equal(e,t)||n.length!==o.length){for(let t of n)this.dataMapPath[t.id]&&(this.dataMapPath[t.id].text&&(this.dataMapPath[t.id].text.remove(),this.dataMapPath[t.id].rectangle.remove()),this.dataMapPath[t.id].signpenTip&&this.dataMapPath[t.id].signpenTip.remove(),this.dataMapPath[t.id].measureText&&this.dataMapPath[t.id].measureText.remove(),this.dataMapPath[t.id].path.remove(),delete this.dataMapPath[t.id]);for(let t of o)this.newRoi(t);this.slice.roilist.find(t=>this.curRois[t.id])&&this.drawArea(this.slice.roilist.find(t=>this.curRois[t.id])),this.roilist.forEach(t=>{this.showRoi?this.dataMapPath[t.id].path.selected=!!this.curRois[t.id]:this.dataMapPath[t.id].path.selected=!1})}},spliceArray(t){for(var e=void 0,i=0;i<t.x.length-1;i++){var s=t.x[i+1]-t.x[i],n=(t.y[i+1]-t.y[i])/s;(isNaN(e)&&isNaN(n)||n==e)&&(t.x.splice(i,1),t.y.splice(i,1),i--),e=n}return t},newRoi(t={editable:!0,selectable:!0,path:{x:[],y:[]}}){this.viewport.viewportToImageZoom(this.position.zoom);let e,i={};if(this.paper.activate(),t.path.x.length>4&&(t.path=this.spliceArray(t.path)),e="spot"==t.method?new this.paper.Path.Circle({center:[4===t.path.x.length?t.path.x[1]:t.path.x[0],t.path.y[0]],radius:t.radius,strokeScaling:!1,fillColor:t.color,owner:t}):"freepen"==t.method?new this.paper.Path({segments:t.path.x.map((e,i)=>({x:e,y:t.path.y[i]})),strokeWidth:2,fillColor:"rgba(0,0,0,0.001)",strokeColor:t.color||"white",strokeScaling:!1,owner:t,closed:!1}):"signpen"==t.method?new this.paper.Path({segments:t.path.x.map((e,i)=>({x:e,y:t.path.y[i]})),strokeWidth:1,fillColor:"rgba(0,0,0,0.001)",strokeColor:t.color||"white",strokeScaling:!1,owner:t,closed:!1}):"measure"==t.method||"level_measure"==t.method||"verticl_measure"==t.method?new this.paper.Path({segments:t.path.x.map((e,i)=>({x:e,y:t.path.y[i]})),strokeWidth:3,dashArray:[4,10],strokeColor:"yellow",strokeScaling:!1,owner:t}):"circlepen"==t.method?new this.paper.Path({segments:t.path.x.map((e,i)=>({x:e,y:t.path.y[i]})),strokeWidth:2,fillColor:"rgba(0,0,0,0.001)",strokeColor:t.color||"#FF2400",strokeScaling:!1,owner:t,closed:!0}):"redArea"==t.method?new this.paper.Path({segments:t.path.x.map((e,i)=>({x:e,y:t.path.y[i]})),closed:!0,fillColor:"red",opacity:.5,owner:t}):"signArea"==t.method?new this.paper.Path({segments:t.path.x.map((e,i)=>({x:e,y:t.path.y[i]})),strokeWidth:t.width||2,fillColor:"rgba(0,0,0,0.001)",strokeColor:t.color||"black",strokeScaling:!1,owner:t,closed:!0}):"signLine"==t.method?new this.paper.Path({segments:t.path.x.map((e,i)=>({x:e,y:t.path.y[i]})),strokeWidth:t.width||2,fillColor:"rgba(0,0,0,0.001)",strokeColor:t.color||"white",strokeScaling:!1,owner:t,closed:!0}):"crashLine"==t.method?new this.paper.Path({segments:t.path.x.map((e,i)=>({x:e,y:t.path.y[i]})),strokeWidth:2,fillColor:"rgba(0,0,0,0.001)",strokeColor:"black",strokeScaling:!1,owner:t,closed:!0,dashArray:[10,10]}):new this.paper.Path({segments:t.path.x.map((e,i)=>({x:e,y:t.path.y[i]})),strokeWidth:t.width||3,fillColor:"rgba(0,0,0,0.001)",strokeColor:t.color||"yellow",strokeScaling:!1,owner:t,closed:!0}),Object.assign(i,{path:e,dragCenter:!1,dragVertex:!1,dragEdge:!1,resetDragStatus(){this.dragCenter=this.dragVertex=this.dragEdge=!1}}),"freepen"==t.method){var s=this;i.drag=function(t){this.dragVertex?(this.segment.point.x+=t.x,this.segment.point.y+=t.y,i.text&&(i.text.content=this.content?this.content:"面积:"+Math.round(Math.abs(i.path.area)*Math.pow(s.mpp,2))+"μm²")):this.dragCenter&&(this.path.position.x+=t.x,this.path.position.y+=t.y,i.text&&(i.text.position.x+=t.x,i.text.position.y+=t.y,i.rectangle.position.x+=t.x,i.rectangle.position.y+=t.y))},i.checkPath=function(t,e){this.segment=null,this.resetDragStatus(),"segment"==e.type?(this.segment=e.segment,this.dragVertex=!0,i.text&&(i.text.content=this.content?this.content:"面积:"+Math.round(Math.abs(i.path.area)*Math.pow(s.mpp,2))+"μm²")):e.type}}else if("signArea"==t.method||"redArea"==t.method||"signLine"==t.method)i.drag=function(t){this.path.segments.map(e=>{e.point.x+=t.x,e.point.y+=t.y})};else if("rectangle"==t.method){s=this;i.drag=function(t){let e=(t,e)=>Math.abs(t-e)<1e-4;if(this.dragVertex){let n=this.segment.point.x,a=this.segment.point.y,o=n+t.x,r=a+t.y;this.path.segments.map(t=>{t.point.x=e(t.point.x,n)?o:t.point.x,t.point.y=e(t.point.y,a)?r:t.point.y});let l=this.path.segments[0].point.x<this.path.segments[2].point.x?this.path.segments[0].point.x:this.path.segments[2].point.x,c=this.path.segments[0].point.y<this.path.segments[2].point.y?this.path.segments[0].point.y:this.path.segments[2].point.y;i.text.content=this.content?this.content:"面积:"+Math.round(Math.abs(i.path.area)*Math.pow(s.mpp,2))+"μm²";let u=l!=Math.min.apply(null,i.data.path.x),h=c!=Math.min.apply(null,i.data.path.y);u&&!h&&(i.text.position.x+=t.x,i.rectangle.position.x+=t.x),!u&&h&&(i.text.position.y+=t.y,i.rectangle.position.y+=t.y),u&&h&&(i.text.position.y+=t.y,i.rectangle.position.y+=t.y,i.text.position.x+=t.x,i.rectangle.position.x+=t.x)}else if(this.dragEdge){if(e(this.editPt1.x,this.editPt2.x)&&(this.editPt1.x+=t.x,this.editPt2.x+=t.x,i.text)){i.text.content=this.content?this.content:"面积:"+Math.round(Math.abs(i.path.area)*Math.pow(s.mpp,2))+"μm²";let e=i.path.segments[0].point.x>i.path.segments[2].point.x?i.path.segments[0].point.x:i.path.segments[2].point.x;this.editPt1.x<e&&(i.text.position.x+=t.x,i.rectangle.position.x+=t.x)}if(e(this.editPt1.y,this.editPt2.y)&&(this.editPt1.y+=t.y,this.editPt2.y+=t.y,i.text)){i.text.content=this.content?this.content:"面积:"+Math.round(Math.abs(i.path.area)*Math.pow(s.mpp,2))+"μm²";let e=i.path.segments[0].point.y>i.path.segments[2].point.y?i.path.segments[0].point.y:i.path.segments[2].point.y;this.editPt1.y<e&&(i.text.position.y+=t.y,i.rectangle.position.y+=t.y)}}else this.dragCenter&&(this.path.segments.map(e=>{e.point.x+=t.x,e.point.y+=t.y}),i.text&&(i.text.position.x+=t.x,i.text.position.y+=t.y,i.rectangle.position.x+=t.x,i.rectangle.position.y+=t.y))},i.checkPath=function(t,e){if(this.segment=this.editPt1=this.editPt2=null,this.resetDragStatus(),"segment"==e.type)this.segment=e.segment,this.dragVertex=!0;else if("stroke"==e.type){let t=e.location;this.editPt1=t.curve.point1,this.editPt2=t.curve.point2,this.dragEdge=!0}else"fill"==e.type&&(this.dragCenter=!0)}}else if("spot"==t.method)i.drag=function(t){this.path.position.x+=t.x,this.path.position.y+=t.y},i.checkPath=function(t,e){this.segment=null,this.resetDragStatus(),"segment"==e.type?(this.segment=e.segment,this.dragVertex=!0):"fill"==e.type&&(this.dragCenter=!0)};else if("signpen"==t.method){let e=new this.paper.Point({x:t.path.x[1]-t.path.x[0],y:t.path.y[1]-t.path.y[0]}),s=new this.paper.Path.RegularPolygon({center:[t.path.x[1],t.path.y[1]],sides:3,radius:2,fillColor:"white"});s.rotate(Math.abs(e.angle)>90?e.angle-150:e.angle-30),i.signpenTip=s}else if("measure"==t.method||"level_measure"==t.method||"verticl_measure"==t.method){let e=new this.paper.Point({x:t.path.x[1]-t.path.x[0],y:t.path.y[1]-t.path.y[0]}),s=e.normalize(10/this.paper.view.zoom).rotate(Math.abs(e.angle)>90?90:-90),n=new this.paper.PointText({point:{x:(t.path.x[1]+t.path.x[0])/2+s.x,y:(t.path.y[0]+t.path.y[1])/2+s.y},content:Math.round(100*e.length*this.mpp)/100+"μm",justification:"center",fontSize:14/this.paper.view.zoom});n.rotate(Math.abs(e.angle)>90?180+e.angle:e.angle),i.measureText=n}return i.data=t,i.path.visible=this.showRoi,i.path.selected=this.showRoi,this.dataMapPath[t.id]=i,i},drawArea(t){if("circlepen"==t.method||"signArea"==t.method||"redArea"==t.method||"measure"==t.method||"level_measure"==t.method||"verticl_measure"==t.method)return;this.paper.activate();let e=this.dataMapPath[t.id];e.text&&(e.text.remove(),e.rectangle.remove());let i=t.path.x[0],s=t.path.y[0],n=this.viewport.viewportToImageZoom(this.position.zoom);var a={x:i,y:s-30/n},o={x:i,y:s},r=t.name;"rectangle"==t.method&&(r=this.content?this.content:"面积:"+Math.round(Math.abs(e.path.area)*Math.pow(this.mpp,2)+200)+"μm²"),e.text=new this.paper.PointText({point:o,content:r,fillColor:"white",justification:"center",fontSize:14/n});var l=e.text.bounds.width,c=e.text.bounds.height;e.text.bounds.top-=28/n-c,e.text.bounds.left+=l/2+4/n,e.rectangle=new this.paper.Path.Rectangle(a,l+8/n,24/n,4/n),e.rectangle.fillColor="rgba(0,0,0,0.5)",this.paper.project.activeLayer.addChild(e.text),"freepen"==t.method&&(e.text.bounds.left-=l+12/n,e.rectangle.bounds.left-=e.rectangle.bounds.width+4/n),this.showRoi||(e.text.visible=!1,e.rectangle.visible=!1)},contextmenu(t){let e=this.convertPoint(t.offsetX,t.offsetY),i=this.paper.project.hitTest(e,{stroke:!0,segments:!0,fill:!0});i&&(this.$emit("contextmenu",t,i.item.owner),this.selectedTool="choose")},keydown(t){switch(t.key){case"ArrowUp":t.ctrlKey||t.metaKey||this.move(null,this.position.offy-.95*this.viewport.getBounds().height);break;case"ArrowDown":t.ctrlKey||t.metaKey||this.move(null,this.position.offy+.95*this.viewport.getBounds().height);break;case"ArrowLeft":t.ctrlKey||t.metaKey||this.move(this.position.offx-.95*this.viewport.getBounds().width);break;case"ArrowRight":t.ctrlKey||t.metaKey||this.move(this.position.offx+.95*this.viewport.getBounds().width);break;case"Escape":this.fullPage&&this.handleFullScreen();break;case"F":case"f":this.selectedTool="freepen";break;case"R":case"r":break;case"=":this.buttonClick("zoom-in");break;case"-":this.buttonClick("zoom-out");break;case"1":this.buttonClick("home");break;case"2":this.buttonClick(2*this.scale);break;case"3":this.buttonClick(4*this.scale);break;case"4":this.buttonClick(10*this.scale);break;case"5":this.buttonClick(20*this.scale);break;case"6":this.buttonClick(40*this.scale);break;case"7":this.buttonClick("original");break;case"8":this.handleFullScreen();break;case"Escape":this.fullPage&&this.handleFullScreen();break;case"A":case"a":if(t.ctrlKey||t.metaKey){t.preventDefault();let e=this.convertPoint(0,0),i=this.convertPoint(this.offsetWidth,this.offsetHeight),s=this.roilist.filter(t=>t.path.x.every(t=>t>e.x&&t<i.x)&&t.path.y.every(t=>t>e.y&&t<i.y));s.length&&this.$emit("curROI",s,!1)}}},wheel(t){document.querySelector(".openseadragon-canvas").canvas;let e=t.wheelDeltaY>0?1.2:1/1.2;var i=this.viewport.pointFromPixel(new OpenSeadragon.Point(t.offsetX,t.offsetY)),s=this.position;this.move((s.offx-i.x)/e+i.x,(s.offy-i.y)/e+i.y,s.zoom*e)},getDistance(t,e){var i=Math.abs(e.pageX-t.pageX),s=Math.abs(e.pageY-t.pageY);return Math.sqrt(i*i+s*s)},esdscreenshot(t){let e=(i=document.querySelector(".openseadragon-canvas canvas"),s=document.createElement("canvas"),n=s.getContext("2d"),s.width=i.width,s.height=i.height,n.drawImage(i,0,0),s);var i,s,n;let a=document.querySelector(".canvas");e.getContext("2d").drawImage(a,0,0);let o=e.toDataURL("image/jpeg");var r="大体病变图"+(new Date).getTime()+".png";let l=o.split(","),c=window.atob(l[1]),u=l[0].match(/:(.*?);/)[1],h=new Uint8Array(c.length);for(var d=0;d<c.length;d++)h[d]=c.charCodeAt(d);let p=new Blob([h],{type:u}),v=new window.File([p],r,{type:"image/jpeg"}),g=v.size,f={id:Math.floor(1e7*Math.random())+"",filename:v.name,name:v.name,roilist:[],loaded:0,total:g,stain:"",state:4},m=new FormData;m.append("file",v),m.append("caseid",this.record.id),m.append("fileid",f.id),m.append("type","attachment"),m.type="attachment",m.path=v.path,this.record.attachments.unshift(f),this.uploadData.set(f,m),this.upload(f)},async upload(t){var e=this.uploadData.get(t);t.state=4,t.loaded=0,r.append(async()=>{if(!this.$parent._isDestroyed){if(e.path&&e.path.endsWith(".mrxs")){let i=window.require("fs"),s=window.require("path"),n=window.require("http"),a=e.path.slice(0,-5),{name:o}=s.parse(e.path),r=i.readdirSync(a).map(t=>a+"\\"+t),l=r.map(t=>i.statSync(t).size).reduce((t,e)=>t+e);t.total=l,t.state=0;for(let e of r){if(t.deleted)return;await new Promise(a=>{let{base:r}=s.parse(e),l=i.createReadStream(e),c=n.request({host:location.hostname,port:location.port,path:`/aipath/api/files/upload2?caseid=${this.record.id}&fileid=${t.id}&type=slice&filename=${encodeURIComponent(o+"\\"+r)}`,headers:{Cookie:document.cookie,"Content-Type":"application/octet-stream","Transfer-Encoding":"chunked",Connection:"keep-alive"}},a);l.on("data",t=>c.write(t)),l.on("end",e=>c.end()+(t.loaded+=l.bytesRead)),c.on("error",e=>{throw t.state=3,t.loaded=0,console.error(`problem with request: ${e.message}`),e})})}}return t.ajaxToken=Object(o.b)(`files/upload?caseid=${this.record.id}&fileid=${t.id}&type=${e.type}&filename=${t.name}&total=${t.total}`,e,{onUploadProgress:e=>{t.deleted?t.ajaxToken.cancel():(t.total=Math.max(t.total,e.total),t.loaded=Math.max(t.loaded,e.loaded),t.state=0)}}),t.ajaxToken.then(e=>{0==e.code?(t.state=1,Object.assign(t,e.data,{total:t.total,loaded:t.loaded}),this.save("auto")):5==e.code?t.state=5:t.state=2}).catch(e=>{t.state=3,t.loaded=0})}})},async save(t){var e=this.cleanRecord(this.record);this.record.update=e.update=(new Date).toISOString(),await Object(o.b)("records/update",{id:e.id,content:JSON.stringify(e)}).then(t=>{0===t.code?this.$message({message:"采图成功",type:"success"}):this.$message({message:t.message,type:"error"})})},cleanRecord:t=>Object.assign({},t,{slices:t.slices.filter(t=>1==t.state).map(({id:t,name:e,filename:i})=>({id:t,name:e,filename:i})),attachments:t.attachments.filter(t=>1==t.state)}),screenshot(e){let i=(0,window.require)("fs"),s=window.electron.remote.process.argv.filter(t=>-1!=t.indexOf("folder:"))[0].slice(8);s=s.replace('"',"\\");let n=document.querySelector(".openseadragon-canvas canvas"),a=document.querySelector(".canvas");n.getContext("2d").drawImage(a,0,0);let r=n.toDataURL("image/jpeg"),l=t.from(r.substring(r.lastIndexOf(",")+1,r.length),"base64"),c=Object(o.l)(new Date).replace(/[-\s:]/g,"_")+".jpg";i.writeFile(s+c,l,t=>{if(t)console.log(t);else{this.screenshotImages.push(c);let t="";if(this.slice.ki67&&this.slice.ki67.airesult){let e=0,i=0;for(let t in this.slice.ki67.airesult){let s=this.slice.ki67.airesult[t];e+=s.length,i+=s.filter(t=>3==t.type).length}t=(i/e*100).toFixed(2)+"%"}else t="";let e={images:Array.from(new Set(this.screenshotImages)),result:t+""};i.writeFile(s+"index.json",JSON.stringify(e,null,4),t=>{}),this.saved=!0,setTimeout(t=>this.saved=!1,1e3)}})},mapping(){var t=[];this.record.slices.filter(t=>-1===t.name.indexOf("痕")&&-1===t.name.indexOf("体")).forEach(e=>{t=[...t,...e.roilist]});var e=t.filter(t=>t.hasOwnProperty("esdMessage"));0!=e.length?this.esdDraw(e):this.$message({message:"未检查到ESD数据标注，无法映射",type:"error"})},esdDraw(t){var e=this.slice.roilist,i=!1;if(0!=e.length){for(var s={},n=0;n<e.length;n++)t.forEach((t,a)=>{if(e[n].name==t.name){i=!0;var o=new this.paper.Path({strokeWidth:1,strokeColor:"white",strokeScaling:!1,fillColor:"rgba(0,0,0,0.001)"}),r=[];o.add(new this.paper.Point(e[n].path.x[0],e[n].path.y[0])),o.add(new this.paper.Point(e[n].path.x[1],e[n].path.y[1])),t.esdMessage.forEach((t,e)=>{var i=o.length*t.startingPointDistance/t.totalLength,s=o.length*(t.startingPointDistance+t.intersectionDistance)/t.totalLength,n=o.getPointAt(i),a=o.getPointAt(s),l=new this.paper.Path({strokeWidth:5,strokeColor:t.color,strokeScaling:!1,fillColor:"rgba(0,0,0,0.001)"},100);l.add(new this.paper.Point(n)),l.add(new this.paper.Point(a)),r.length&&r.forEach((t,e)=>{if(l.getIntersections(t).length){var i=l.length/2,s=l.getNormalAt(i);s.length=.3*(e+1),l.translate(s)}}),r.push(l)}),o.remove(),s[e[n].id]=r}});this.$emit("addSignLineArr",s),i||this.$message({message:"未检查到相对应的ESD数据标注，请检查名称是否对应",type:"error"})}else this.$message({message:"未标记切痕，请先标记切痕",type:"error"})},spaceShoot(t){"Space"===t.code&&"input"!=t.target.tagName.toLowerCase()&&this.screenshot(t)},getSliceDistance(t){for(var e=0,i=0,s=0;s<t[0].index;s++)e+=this.lineA.curves[s].length;e+=t[0].time*this.lineA.curves[t[0].index].length;for(s=0;s<t[1].index;s++)i+=this.lineA.curves[s].length;return i+=t[1].time*this.lineA.curves[t[1].index].length,this.$emit("addMeasure",parseFloat(Math.round(100*e*this.mpp)/100),"defaultId","level_measure"),this.$emit("addMeasure",parseFloat(Math.round(100*(this.lineA.length-i)*this.mpp)/100),"defaultId","level_measure"),{intersectionDistance:i-e,startingPointDistance:e,iD:Math.round(100*(i-e)*this.mpp)/100+"μm",level_measure_arr:[parseFloat(Math.round(100*e*this.mpp)/100),parseFloat(Math.round(100*(this.lineA.length-i)*this.mpp)/100)]}},getNoIntersectionDistance(t){var e={};if(this.lineA.curves.forEach((i,s)=>{for(var n=i.segment1,a=1;a<=10;a++){var o=[n,i.getPointAt(i.length/10*a)],r=new this.paper.Path(o);r.style={strokeWidth:1,strokeColor:"yellow",strokeScaling:!1,fillColor:"rgba(0,0,0,0.001)"},r.rotate(90),r.scale(150),r.opacity=0,0!==r.getIntersections(t).length&&(e[s]?e[s].push(a):e[s]=[a]),n=i.getPointAt(i.length/10*a)}}),0!==Object.keys(e).length){var i=0,s=0;if(1===Object.keys(e).length){var n=Object.keys(e)[0];if(1===e[Object.keys(e)[0]].length)var a=e[Object.keys(e)[0]][0],o=e[Object.keys(e)[0]][0]+1;else a=e[Object.keys(e)[0]][0],o=e[Object.keys(e)[0]][e[Object.keys(e)].length-1];for(var r=0;r<n;r++)i+=this.lineA.curves[r].length;i+=a/10*this.lineA.curves[n].length;for(r=0;r<n;r++)s+=this.lineA.curves[r].length;s+=o/10*this.lineA.curves[n].length}else{var l=Object.keys(e)[0],c=Object.keys(e)[Object.keys(e).length-1];for(a=e[l][0],o=e[c][e[c].length-1],r=0;r<l;r++)i+=this.lineA.curves[r].length;i+=a/10*this.lineA.curves[l].length;for(r=0;r<c;r++)s+=this.lineA.curves[r].length;s+=o/10*this.lineA.curves[c].length}return this.$emit("addMeasure",parseFloat(Math.round(100*i*this.mpp)/100),"defaultId","level_measure"),this.$emit("addMeasure",parseFloat(Math.round(100*(this.lineA.length-s)*this.mpp)/100),"defaultId","level_measure"),{intersectionDistance:s-i,startingPointDistance:i,iD:Math.round(100*(s-i)*this.mpp)/100+"μm",level_measure_arr:[parseFloat(Math.round(100*i*this.mpp)/100),parseFloat(Math.round(100*(this.lineA.length-s)*this.mpp)/100)]}}this.$message({message:"映射失败，请微调位置重新圈出病变区域",type:"warning"})},nameFreePen(t){var e=[];this.record.slices.filter(t=>-1===t.name.indexOf("痕")&&-1===t.name.indexOf("体")).forEach(t=>{e=[...e,...t.roilist]}),t.name=e.filter(t=>"freepen"===t.method).length+1},contextmenuDisplay(t){2==t.button&&this.lineB&&(t.preventDefault(),this.$refs.circleOpt.style.display="block",this.$refs.circleOpt.style.top=t.offsetY-25+"px",this.$refs.circleOpt.style.left=t.offsetX+10+"px")},setCircleCol(t){var e=t.target.querySelector("i")?t.target.querySelector("i"):t.target;this.$emit("changeEsdRoiColoe",e.style.background,t.target.title,this.lineB.id),this.$refs.circleOpt.style.display="none",this.$emit("curROI",null,!1)},mouseDown(t){this.$refs.osd.querySelector(".openseadragon-canvas").focus(),this.$refs.circleOpt.style.display="none",t.preventDefault(),this.$emit("mousedown");let e=c(t);var i,s,n,a,o=t=>{var o=c(t,this.$refs.osd);if(new paper.Point(v.x-o.x,v.y-o.y).length>5&&(g=!0),m)if(t.touches&&2==t.touches.length){let e=this.viewport.deltaPointsFromPixels(new paper.Point((p.touches[0].clientX+p.touches[1].clientX-t.touches[0].clientX-t.touches[1].clientX)/2,(p.touches[0].clientY+p.touches[1].clientY-t.touches[0].clientY-t.touches[1].clientY)/2)),i=Math.hypot(p.touches[0].clientX-p.touches[1].clientX,p.touches[0].clientY-p.touches[1].clientY),s=Math.hypot(t.touches[0].clientX-t.touches[1].clientX,t.touches[0].clientY-t.touches[1].clientY);this.move(this.position.offx+e.x,this.position.offy+e.y,this.position.zoom*s/i)}else{let t=this.viewport.deltaPointsFromPixels(new paper.Point(d.x-o.x,d.y-o.y));this.move(this.position.offx+t.x,this.position.offy+t.y)}else{let t=this.convertPoint(o.x-e.x+e.offsetX,o.y-e.y+e.offsetY);switch(this.selectedTool){case"choose":for(let t in this.curRois){var r=this.dataMapPath[t];if(r.dragCenter||this.curRoi.owner.id==t)if(0!=this.curRois[t].editable){let t=this.convertPoint(0,0),e=this.convertPoint(o.x-d.x,o.y-d.y);if(e.x-=t.x,e.y-=t.y,"rectangle"===r.data.method)r.drag(e);else if("signArea"===r.data.method)for(var l in this.dataMapPath)this.dataMapPath[l].drag(e)}else m=!0}break;case"circlepen":case"freepen":this.curRoi.path.closed=!1,this.curRoi.path.fullySelected=!1,this.curRoi.path.add(t);break;case"rectangle":{let e=this.curRoi.path.segments[0].point;this.curRoi.path.removeSegments(),this.curRoi.path.addSegments([e,new this.paper.Point(t.x,e.y),t,new this.paper.Point(e.x,t.y)]);break}case"level_measure":case"verticl_measure":case"measure":{s&&s.remove(),i&&i.remove(),this.paper.activate(),(s=new this.paper.Path([f,t])).strokeWidth=3,s.dashArray=[4,10],s.strokeScaling=!1,s.strokeColor="yellow";let e=new this.paper.Point({x:t.x-f.x,y:t.y-f.y}),n=e.normalize(10/this.paper.view.zoom).rotate(Math.abs(e.angle)>90?90:-90);(i=new this.paper.PointText({point:{x:(t.x+f.x)/2+n.x,y:(f.y+t.y)/2+n.y},content:Math.round(100*e.length*this.mpp)/100+"μm",justification:"center",fontSize:14/this.paper.view.zoom})).rotate(Math.abs(e.angle)>90?180+e.angle:e.angle);break}case"signpen":{a&&a.remove(),n&&n.remove(),this.paper.activate(),(a=new this.paper.Path([f,t])).strokeWidth=1,a.strokeScaling=!1,a.strokeColor="white";let e=new this.paper.Point({x:t.x-f.x,y:t.y-f.y});(n=new this.paper.Path.RegularPolygon({center:[t.x,t.y],sides:3,radius:2,fillColor:"white"})).rotate(Math.abs(e.angle)>90?e.angle-150:e.angle-30)}}this.paper.view.draw()}d={x:o.x,y:o.y},p=t},r=!1,h=t=>{if(r=!0,window.removeEventListener("mousemove",o),window.removeEventListener("touchmove",o),window.removeEventListener("mouseup",h),window.removeEventListener("touchend",h),this.$refs.osd.removeEventListener("touchstart",_),t=t.changedTouches?u(t.changedTouches[0],this.$refs.osd):t,g){if(m)return;switch(this.selectedTool){case"freepen":{let e=this.curRoi.data;e.color="white",e.path=this.path2data(this.curRoi.path.segments),e.tD=Math.round(100*this.curRoi.path.length*this.mpp)/100+"μm",this.nameFreePen(e),delete this.dataMapPath[this.curRoi.id],this.curRoi.path.remove(),this.curRoi=null,this.$emit("draw",e),this.$emit("curROI",e,t.shiftKey),this.selectedTool="choose";break}case"circlepen":{let t=this.curRoi.data;if(t.path=this.path2data(this.curRoi.path.segments),t.color="#FF2400",this.lineA){var e=this.lineA.getIntersections(this.curRoi.path);if(0==e.length){(c=this.getNoIntersectionDistance(this.curRoi.path))&&(c.totalLength=this.lineA.length,setTimeout(()=>{c.id=t.id,c.color="#FF2400",c.title="高级别上皮内瘤变（包括原位癌）",this.roilist.forEach(t=>{t.id===this.lineA.owner.id&&this.$emit("addEsdMes",t.id,c)})},300))}else{if(1==e.length)return this.$message({message:"只产生了一个交点，请检查圈注",type:"warning"}),delete this.dataMapPath[this.curRoi.id],this.curRoi.path.remove(),this.curRoi=null,void(this.selectedTool="choose");var c;(c=this.getSliceDistance(e)).totalLength=this.lineA.length,setTimeout(()=>{c.id=t.id,c.color="#FF2400",c.title="高级别上皮内瘤变（包括原位癌）",this.roilist.forEach(t=>{t.id===this.lineA.owner.id&&this.$emit("addEsdMes",t.id,c)})},300)}}delete this.dataMapPath[this.curRoi.id],this.curRoi.path.remove(),this.curRoi=null,this.$emit("draw",t),this.selectedTool="choose";break}case"rectangle":{let e=this.curRoi.data;e.path=this.path2data(this.curRoi.path.segments),delete this.dataMapPath[this.curRoi.id],this.drawMpp?(this.userMpp=Math.sqrt((this.cellArea||200)/this.curRoi.path.area).toFixed(4),"NaN"===this.userMpp||"Infinity"===this.userMpp?(this.$alert("您画的roi太小,请选择矩形工具重新画一个"),this.curRoi.path.remove(),this.curRoi=null):(this.drawMpp=!1,this.knew=!0)):(this.curRoi.path.remove(),this.curRoi=null,this.$emit("draw",e),this.$emit("curROI",e,t.shiftKey)),this.selectedTool="choose";break}case"choose":Object.values(this.curRois).map(t=>{"signArea"===t.method?(this.roilist.filter(e=>e.id!=t.id).forEach(t=>{t.path=this.path2data(this.dataMapPath[t.id].path.segments),this.$emit("curROI",[t])}),t.path=this.path2data(this.dataMapPath[t.id].path.segments)):t.path=this.path2data(this.dataMapPath[t.id].path.segments)}),this.$emit("curROI",Object.values(this.curRois)),this.$emit("roiChanged");break;case"measure":{s.remove(),i.remove();let t=this.curRoi.data;t.path=this.path2data(s.segments),delete this.dataMapPath[this.curRoi.id],this.curRoi.path.remove(),this.curRoi=null,this.$emit("draw",t),this.$emit("addMeasure",parseFloat(i.content),t.id,"measure"),this.selectedTool="choose";break}case"level_measure":{s.remove(),i.remove();let t=this.curRoi.data;t.path=this.path2data(s.segments),delete this.dataMapPath[this.curRoi.id],this.curRoi.path.remove(),this.curRoi=null,this.$emit("draw",t),this.$emit("addMeasure",parseFloat(i.content),t.id,"level_measure"),this.selectedTool="choose";break}case"verticl_measure":{s.remove(),i.remove();let t=this.curRoi.data;t.path=this.path2data(s.segments),delete this.dataMapPath[this.curRoi.id],this.curRoi.path.remove(),this.curRoi=null,this.$emit("draw",t),this.$emit("addMeasure",parseFloat(i.content),t.id,"verticl_measure"),this.selectedTool="choose";break}case"signpen":{a.remove(),n.remove();let e=this.curRoi.data;e.color="white",e.path=this.path2data(a.segments),e.name=this.roilist.length+1,delete this.dataMapPath[this.curRoi.id],this.curRoi.path.remove(),this.curRoi=null,this.$emit("draw",e),this.$emit("curROI",e,t.shiftKey),this.selectedTool="choose";break}}}else{let e=this.convertPoint(t.offsetX,t.offsetY);if("choose"==this.selectedTool){let i=this.paper.project.hitTest(e,{stroke:!0,segments:!0,fill:!0,tolerance:2});if(i){if(l)return this.$emit("reverseRoi",null),this.$emit("curROI",null,t.shiftKey),void(l=!1);if("redArea"===i.item.owner.method)return;this.$emit("curROI",i.item.owner,t.shiftKey),(t={offsetX:t.offsetX,offsetY:t.offsetY,type:t.type}).preventDefault||(t.preventDefault=(t=>0)),t.currentTarget=this.$refs.osd,this.$emit("contextmenu",t,i.item.owner)}else this.$emit("curROI",null,t.shiftKey)}else"freepen"!=this.selectedTool&&"rectangle"!=this.selectedTool&&"circlepen"!=this.selectedTool&&"signpen"!=this.selectedTool||(delete this.dataMapPath[this.curRoi.id],this.curRoi.path.remove(),this.curRoi=null,t.shiftKey||(this.selectedTool="choose"))}};if(e.button)return;let d={x:e.x,y:e.y},p=t,v=d,g=!1,f=this.convertPoint(e.offsetX,e.offsetY),m=!1;switch(this.selectedTool){case"choose":{let e=this.paper.project.hitTest(f,{fill:!0,stroke:!0,segments:!0,tolerance:2}),i=Object.values(this.curRois).map(t=>this.dataMapPath[t.id]);i.some(t=>t.path==(e&&e.item))?(this.curRoi=e.item,i.map(t=>{"rectangle"===t.data.method&&t.checkPath(t,e)})):t.touches&&("stylus"==t.touches[0].touchType||t.touches[0].force<1)?(this.selectedTool="freepen",this.curRoi=this.newRoi({path:{x:[f.x],y:[f.y]},method:"freepen",color:this.penColor})):m=!0;break}case"freepen":case"circlepen":case"measure":case"level_measure":case"verticl_measure":case"signpen":case"rectangle":this.curRoi=this.newRoi({path:{x:[f.x],y:[f.y]},method:this.selectedTool})}window.addEventListener("touchmove",o),window.addEventListener("mousemove",o),window.addEventListener("mouseup",h),window.addEventListener("touchend",h);var _=t=>{r||h(t)};this.$refs.osd.addEventListener("touchstart",_)},mouseMove(t){if(this.roilist.forEach(t=>{"crashLine"===t.method&&this.$emit("delRoi",t)}),"crosscurve"===this.selectedTool){let e=this.convertPoint(t.offsetX,t.offsetY);this.$emit("draw",{method:"crashLine",path:{x:[e.x-2e3,e.x+2e3],y:[e.y,e.y]}}),this.$emit("draw",{method:"crashLine",path:{x:[e.x,e.x],y:[e.y-2e3,e.y+2e3]}})}},chooseSFB(t){if(0===t.flag)this.$emit("delRoi",this.dataMapPath["rectangle"+t.id].data);else{var e={id:"rectangle"+t.id,method:"rectangle",path:{x:[Math.round(this.dataMapPath[t.id].path.bounds.center.x-224.345/this.mpp),Math.round(this.dataMapPath[t.id].path.bounds.center.x+224.345/this.mpp),Math.round(this.dataMapPath[t.id].path.bounds.center.x+224.345/this.mpp),Math.round(this.dataMapPath[t.id].path.bounds.center.x-224.345/this.mpp)],y:[Math.round(this.dataMapPath[t.id].path.bounds.center.y-224.345/this.mpp),Math.round(this.dataMapPath[t.id].path.bounds.center.y-224.345/this.mpp),Math.round(this.dataMapPath[t.id].path.bounds.center.y+224.345/this.mpp),Math.round(this.dataMapPath[t.id].path.bounds.center.y+224.345/this.mpp)]}};this.$emit("draw",e)}}},mounted(){let t="/aipath/api/files/getLabel?caseid="+this.record.id+"&fileid="+this.slice.id,e=new Image;if(e.onerror=(()=>this.showLabel=!1),e.src=location.origin+t,this.initOSD(),this.$refs.osd.addEventListener("touchstart",this.mouseDown),this.$refs.navigator.addEventListener("mousedown",this.navstart),this.$refs.navigator.addEventListener("touchstart",this.navstart),window.electron){let t=window.electron.remote.process.argv;if(t.filter(t=>-1!=t.indexOf("No:")).length){t.filter(t=>-1!=t.indexOf("No:"))[0].substring(4)===window.curRecord.id&&(this.showScreenshot=!0)}window.addEventListener("keydown",this.spaceShoot)}0==this.roilist.length&&setTimeout(()=>{-1!==this.slice.name.indexOf("体")&&this.drawCloseRoi()},200)},destroyed(){window.removeEventListener("resize",this.resize),window.removeEventListener("keydown",this.spaceShoot),setTimeout(()=>{this.paper.view.remove(),this.osd.destroy()},1e3)},watch:{position:{handler(t){this.update(t)},deep:!0},selectedTool:{handler(t){switch(t){case"choose":this.$refs.osd.querySelector(".openseadragon-canvas").style.cursor="pointer";break;case"freepen":case"rectangle":case"level_measure":case"verticl_measure":case"measure":this.$refs.osd.querySelector(".openseadragon-canvas").style.cursor="crosshair";break;case"translate":if(!Object.values(this.curRois)[0])return this.$message({message:"没有选择要旋转的标记线",type:"warning"}),void(this.selectedTool="choose");this.$emit("reverseRoi",Object.values(this.curRois)[0]),this.selectedTool="choose",this.$emit("curROI",null,null);break;case"circlepen":if(!this.lineA)return this.$message({message:"没有选择要标注的电子切片",type:"warning"}),void(this.selectedTool="choose");this.$refs.osd.querySelector(".openseadragon-canvas").style.cursor="crosshair"}},deep:!0},"position.zoom":function(){this.$refs.circleOpt.style.display="none",setTimeout(t=>{for(let t in this.curRois)"spot"!=this.curRois[t].method&&this.drawArea(this.curRois[t])},90)},showRoi(t){t?this.$emit("changeShowLayer",!0):(this.$emit("changeShowLayer",!1),this.$refs.circleOpt.style.display="none");for(let e in this.dataMapPath)this.dataMapPath[e].path.visible=!!t,this.dataMapPath[e].path.selected=this.curRois[e]&&t,this.dataMapPath[e].text&&(this.dataMapPath[e].text.visible=!!t,this.dataMapPath[e].rectangle.visible=!!t),this.dataMapPath[e].signpenTip&&(this.dataMapPath[e].signpenTip.visible=!!t);for(let e in this.record.signLineArr)this.record.signLineArr[e].forEach(e=>{e.visible=!!t})},roilist(t,e){this.roilistChange(t,e),this.$refs.circleOpt.style.display="none"},centerRegion([t,e,i,s]){let n,a=1.5*(i-t),o=1.5*(s-e),r=this.slice.width,l=(t+i)/2,c=(e+s)/2;n=a/o>this.offsetWidth/this.offsetHeight?r/a:r/o*this.offsetHeight/this.offsetWidth,this.move(l/r,c/r,Math.min(n,this.position.zoom))},curRois(t){for(var e in this.lineA=null,this.lineB=null,t)"freepen"===t[e].method&&(this.lineA=this.dataMapPath[t[e].id].path),"circlepen"===t[e].method&&(this.lineB=this.dataMapPath[t[e].id].data);this.roilist.forEach(e=>{this.showRoi?(this.dataMapPath[e.id].path.selected=!!t[e.id],t[e.id]&&0!=t[e.id].editable&&this.paper.project.activeLayer.addChild(this.dataMapPath[e.id].path)):this.dataMapPath[e.id].path.selected=!1,this.dataMapPath[e.id].path.visible=!!this.showRoi});for(let t in this.dataMapPath)this.dataMapPath[t].text&&(this.dataMapPath[t].text.remove(),this.dataMapPath[t].rectangle.remove());for(let e in t)"spot"!=t[e].method&&this.drawArea(t[e])}},components:{"v-attactments":s.a},computed:{sliceType:function(){return-1===this.slice.filename.indexOf("痕")&&-1===this.slice.filename.indexOf("体")},mapAgain:function(){return-1!==this.slice.filename.indexOf("大体")&&0!=this.roilist.length}}}}).call(e,i("EuP9").Buffer)},quzU:function(t,e){},rdLu:function(t,e,i){(function(){var i=this,s=i._,n={},a=Array.prototype,o=Object.prototype,r=Function.prototype,l=a.push,c=a.slice,u=a.concat,h=o.toString,d=o.hasOwnProperty,p=a.forEach,v=a.map,g=a.reduce,f=a.reduceRight,m=a.filter,_=a.every,y=a.some,R=a.indexOf,b=a.lastIndexOf,C=Array.isArray,w=Object.keys,k=r.bind,x=function(t){return t instanceof x?t:this instanceof x?void(this._wrapped=t):new x(t)};void 0!==t&&t.exports&&(e=t.exports=x),e._=x,x.VERSION="1.4.4";var $=x.each=x.forEach=function(t,e,i){if(null!=t)if(p&&t.forEach===p)t.forEach(e,i);else if(t.length===+t.length){for(var s=0,a=t.length;s<a;s++)if(e.call(i,t[s],s,t)===n)return}else for(var o in t)if(x.has(t,o)&&e.call(i,t[o],o,t)===n)return};x.map=x.collect=function(t,e,i){var s=[];return null==t?s:v&&t.map===v?t.map(e,i):($(t,function(t,n,a){s[s.length]=e.call(i,t,n,a)}),s)};var I="Reduce of empty array with no initial value";x.reduce=x.foldl=x.inject=function(t,e,i,s){var n=arguments.length>2;if(null==t&&(t=[]),g&&t.reduce===g)return s&&(e=x.bind(e,s)),n?t.reduce(e,i):t.reduce(e);if($(t,function(t,a,o){n?i=e.call(s,i,t,a,o):(i=t,n=!0)}),!n)throw new TypeError(I);return i},x.reduceRight=x.foldr=function(t,e,i,s){var n=arguments.length>2;if(null==t&&(t=[]),f&&t.reduceRight===f)return s&&(e=x.bind(e,s)),n?t.reduceRight(e,i):t.reduceRight(e);var a=t.length;if(a!==+a){var o=x.keys(t);a=o.length}if($(t,function(r,l,c){l=o?o[--a]:--a,n?i=e.call(s,i,t[l],l,c):(i=t[l],n=!0)}),!n)throw new TypeError(I);return i},x.find=x.detect=function(t,e,i){var s;return O(t,function(t,n,a){if(e.call(i,t,n,a))return s=t,!0}),s},x.filter=x.select=function(t,e,i){var s=[];return null==t?s:m&&t.filter===m?t.filter(e,i):($(t,function(t,n,a){e.call(i,t,n,a)&&(s[s.length]=t)}),s)},x.reject=function(t,e,i){return x.filter(t,function(t,s,n){return!e.call(i,t,s,n)},i)},x.every=x.all=function(t,e,i){e||(e=x.identity);var s=!0;return null==t?s:_&&t.every===_?t.every(e,i):($(t,function(t,a,o){if(!(s=s&&e.call(i,t,a,o)))return n}),!!s)};var O=x.some=x.any=function(t,e,i){e||(e=x.identity);var s=!1;return null==t?s:y&&t.some===y?t.some(e,i):($(t,function(t,a,o){if(s||(s=e.call(i,t,a,o)))return n}),!!s)};x.contains=x.include=function(t,e){return null!=t&&(R&&t.indexOf===R?-1!=t.indexOf(e):O(t,function(t){return t===e}))},x.invoke=function(t,e){var i=c.call(arguments,2),s=x.isFunction(e);return x.map(t,function(t){return(s?e:t[e]).apply(t,i)})},x.pluck=function(t,e){return x.map(t,function(t){return t[e]})},x.where=function(t,e,i){return x.isEmpty(e)?i?null:[]:x[i?"find":"filter"](t,function(t){for(var i in e)if(e[i]!==t[i])return!1;return!0})},x.findWhere=function(t,e){return x.where(t,e,!0)},x.max=function(t,e,i){if(!e&&x.isArray(t)&&t[0]===+t[0]&&t.length<65535)return Math.max.apply(Math,t);if(!e&&x.isEmpty(t))return-1/0;var s={computed:-1/0,value:-1/0};return $(t,function(t,n,a){var o=e?e.call(i,t,n,a):t;o>=s.computed&&(s={value:t,computed:o})}),s.value},x.min=function(t,e,i){if(!e&&x.isArray(t)&&t[0]===+t[0]&&t.length<65535)return Math.min.apply(Math,t);if(!e&&x.isEmpty(t))return 1/0;var s={computed:1/0,value:1/0};return $(t,function(t,n,a){var o=e?e.call(i,t,n,a):t;o<s.computed&&(s={value:t,computed:o})}),s.value},x.shuffle=function(t){var e,i=0,s=[];return $(t,function(t){e=x.random(i++),s[i-1]=s[e],s[e]=t}),s};var A=function(t){return x.isFunction(t)?t:function(e){return e[t]}};x.sortBy=function(t,e,i){var s=A(e);return x.pluck(x.map(t,function(t,e,n){return{value:t,index:e,criteria:s.call(i,t,e,n)}}).sort(function(t,e){var i=t.criteria,s=e.criteria;if(i!==s){if(i>s||void 0===i)return 1;if(i<s||void 0===s)return-1}return t.index<e.index?-1:1}),"value")};var M=function(t,e,i,s){var n={},a=A(e||x.identity);return $(t,function(e,o){var r=a.call(i,e,o,t);s(n,r,e)}),n};x.groupBy=function(t,e,i){return M(t,e,i,function(t,e,i){(x.has(t,e)?t[e]:t[e]=[]).push(i)})},x.countBy=function(t,e,i){return M(t,e,i,function(t,e){x.has(t,e)||(t[e]=0),t[e]++})},x.sortedIndex=function(t,e,i,s){for(var n=(i=null==i?x.identity:A(i)).call(s,e),a=0,o=t.length;a<o;){var r=a+o>>>1;i.call(s,t[r])<n?a=r+1:o=r}return a},x.toArray=function(t){return t?x.isArray(t)?c.call(t):t.length===+t.length?x.map(t,x.identity):x.values(t):[]},x.size=function(t){return null==t?0:t.length===+t.length?t.length:x.keys(t).length},x.first=x.head=x.take=function(t,e,i){if(null!=t)return null==e||i?t[0]:c.call(t,0,e)},x.initial=function(t,e,i){return c.call(t,0,t.length-(null==e||i?1:e))},x.last=function(t,e,i){if(null!=t)return null==e||i?t[t.length-1]:c.call(t,Math.max(t.length-e,0))},x.rest=x.tail=x.drop=function(t,e,i){return c.call(t,null==e||i?1:e)},x.compact=function(t){return x.filter(t,x.identity)};var S=function(t,e,i){return $(t,function(t){x.isArray(t)?e?l.apply(i,t):S(t,e,i):i.push(t)}),i};x.flatten=function(t,e){return S(t,e,[])},x.without=function(t){return x.difference(t,c.call(arguments,1))},x.uniq=x.unique=function(t,e,i,s){x.isFunction(e)&&(s=i,i=e,e=!1);var n=i?x.map(t,i,s):t,a=[],o=[];return $(n,function(i,s){(e?s&&o[o.length-1]===i:x.contains(o,i))||(o.push(i),a.push(t[s]))}),a},x.union=function(){return x.uniq(u.apply(a,arguments))},x.intersection=function(t){var e=c.call(arguments,1);return x.filter(x.uniq(t),function(t){return x.every(e,function(e){return x.indexOf(e,t)>=0})})},x.difference=function(t){var e=u.apply(a,c.call(arguments,1));return x.filter(t,function(t){return!x.contains(e,t)})},x.zip=function(){for(var t=c.call(arguments),e=x.max(x.pluck(t,"length")),i=new Array(e),s=0;s<e;s++)i[s]=x.pluck(t,""+s);return i},x.object=function(t,e){if(null==t)return{};for(var i={},s=0,n=t.length;s<n;s++)e?i[t[s]]=e[s]:i[t[s][0]]=t[s][1];return i},x.indexOf=function(t,e,i){if(null==t)return-1;var s=0,n=t.length;if(i){if("number"!=typeof i)return t[s=x.sortedIndex(t,e)]===e?s:-1;s=i<0?Math.max(0,n+i):i}if(R&&t.indexOf===R)return t.indexOf(e,i);for(;s<n;s++)if(t[s]===e)return s;return-1},x.lastIndexOf=function(t,e,i){if(null==t)return-1;var s=null!=i;if(b&&t.lastIndexOf===b)return s?t.lastIndexOf(e,i):t.lastIndexOf(e);for(var n=s?i:t.length;n--;)if(t[n]===e)return n;return-1},x.range=function(t,e,i){arguments.length<=1&&(e=t||0,t=0),i=arguments[2]||1;for(var s=Math.max(Math.ceil((e-t)/i),0),n=0,a=new Array(s);n<s;)a[n++]=t,t+=i;return a},x.bind=function(t,e){if(t.bind===k&&k)return k.apply(t,c.call(arguments,1));var i=c.call(arguments,2);return function(){return t.apply(e,i.concat(c.call(arguments)))}},x.partial=function(t){var e=c.call(arguments,1);return function(){return t.apply(this,e.concat(c.call(arguments)))}},x.bindAll=function(t){var e=c.call(arguments,1);return 0===e.length&&(e=x.functions(t)),$(e,function(e){t[e]=x.bind(t[e],t)}),t},x.memoize=function(t,e){var i={};return e||(e=x.identity),function(){var s=e.apply(this,arguments);return x.has(i,s)?i[s]:i[s]=t.apply(this,arguments)}},x.delay=function(t,e){var i=c.call(arguments,2);return setTimeout(function(){return t.apply(null,i)},e)},x.defer=function(t){return x.delay.apply(x,[t,1].concat(c.call(arguments,1)))},x.throttle=function(t,e){var i,s,n,a,o=0,r=function(){o=new Date,n=null,a=t.apply(i,s)};return function(){var l=new Date,c=e-(l-o);return i=this,s=arguments,c<=0?(clearTimeout(n),n=null,o=l,a=t.apply(i,s)):n||(n=setTimeout(r,c)),a}},x.debounce=function(t,e,i){var s,n;return function(){var a=this,o=arguments,r=i&&!s;return clearTimeout(s),s=setTimeout(function(){s=null,i||(n=t.apply(a,o))},e),r&&(n=t.apply(a,o)),n}},x.once=function(t){var e,i=!1;return function(){return i?e:(i=!0,e=t.apply(this,arguments),t=null,e)}},x.wrap=function(t,e){return function(){var i=[t];return l.apply(i,arguments),e.apply(this,i)}},x.compose=function(){var t=arguments;return function(){for(var e=arguments,i=t.length-1;i>=0;i--)e=[t[i].apply(this,e)];return e[0]}},x.after=function(t,e){return t<=0?e():function(){if(--t<1)return e.apply(this,arguments)}},x.keys=w||function(t){if(t!==Object(t))throw new TypeError("Invalid object");var e=[];for(var i in t)x.has(t,i)&&(e[e.length]=i);return e},x.values=function(t){var e=[];for(var i in t)x.has(t,i)&&e.push(t[i]);return e},x.pairs=function(t){var e=[];for(var i in t)x.has(t,i)&&e.push([i,t[i]]);return e},x.invert=function(t){var e={};for(var i in t)x.has(t,i)&&(e[t[i]]=i);return e},x.functions=x.methods=function(t){var e=[];for(var i in t)x.isFunction(t[i])&&e.push(i);return e.sort()},x.extend=function(t){return $(c.call(arguments,1),function(e){if(e)for(var i in e)t[i]=e[i]}),t},x.pick=function(t){var e={},i=u.apply(a,c.call(arguments,1));return $(i,function(i){i in t&&(e[i]=t[i])}),e},x.omit=function(t){var e={},i=u.apply(a,c.call(arguments,1));for(var s in t)x.contains(i,s)||(e[s]=t[s]);return e},x.defaults=function(t){return $(c.call(arguments,1),function(e){if(e)for(var i in e)null==t[i]&&(t[i]=e[i])}),t},x.clone=function(t){return x.isObject(t)?x.isArray(t)?t.slice():x.extend({},t):t},x.tap=function(t,e){return e(t),t};var T=function(t,e,i,s){if(t===e)return 0!==t||1/t==1/e;if(null==t||null==e)return t===e;t instanceof x&&(t=t._wrapped),e instanceof x&&(e=e._wrapped);var n=h.call(t);if(n!=h.call(e))return!1;switch(n){case"[object String]":return t==String(e);case"[object Number]":return t!=+t?e!=+e:0==t?1/t==1/e:t==+e;case"[object Date]":case"[object Boolean]":return+t==+e;case"[object RegExp]":return t.source==e.source&&t.global==e.global&&t.multiline==e.multiline&&t.ignoreCase==e.ignoreCase}if("object"!=typeof t||"object"!=typeof e)return!1;for(var a=i.length;a--;)if(i[a]==t)return s[a]==e;i.push(t),s.push(e);var o=0,r=!0;if("[object Array]"==n){if(r=(o=t.length)==e.length)for(;o--&&(r=T(t[o],e[o],i,s)););}else{var l=t.constructor,c=e.constructor;if(l!==c&&!(x.isFunction(l)&&l instanceof l&&x.isFunction(c)&&c instanceof c))return!1;for(var u in t)if(x.has(t,u)&&(o++,!(r=x.has(e,u)&&T(t[u],e[u],i,s))))break;if(r){for(u in e)if(x.has(e,u)&&!o--)break;r=!o}}return i.pop(),s.pop(),r};x.isEqual=function(t,e){return T(t,e,[],[])},x.isEmpty=function(t){if(null==t)return!0;if(x.isArray(t)||x.isString(t))return 0===t.length;for(var e in t)if(x.has(t,e))return!1;return!0},x.isElement=function(t){return!(!t||1!==t.nodeType)},x.isArray=C||function(t){return"[object Array]"==h.call(t)},x.isObject=function(t){return t===Object(t)},$(["Arguments","Function","String","Number","Date","RegExp"],function(t){x["is"+t]=function(e){return h.call(e)=="[object "+t+"]"}}),x.isArguments(arguments)||(x.isArguments=function(t){return!(!t||!x.has(t,"callee"))}),x.isFunction=function(t){return"function"==typeof t},x.isFinite=function(t){return isFinite(t)&&!isNaN(parseFloat(t))},x.isNaN=function(t){return x.isNumber(t)&&t!=+t},x.isBoolean=function(t){return!0===t||!1===t||"[object Boolean]"==h.call(t)},x.isNull=function(t){return null===t},x.isUndefined=function(t){return void 0===t},x.has=function(t,e){return d.call(t,e)},x.noConflict=function(){return i._=s,this},x.identity=function(t){return t},x.times=function(t,e,i){for(var s=Array(t),n=0;n<t;n++)s[n]=e.call(i,n);return s},x.random=function(t,e){return null==e&&(e=t,t=0),t+Math.floor(Math.random()*(e-t+1))};var F={escape:{"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","/":"&#x2F;"}};F.unescape=x.invert(F.escape);var j={escape:new RegExp("["+x.keys(F.escape).join("")+"]","g"),unescape:new RegExp("("+x.keys(F.unescape).join("|")+")","g")};x.each(["escape","unescape"],function(t){x[t]=function(e){return null==e?"":(""+e).replace(j[t],function(e){return F[t][e]})}}),x.result=function(t,e){if(null==t)return null;var i=t[e];return x.isFunction(i)?i.call(t):i},x.mixin=function(t){$(x.functions(t),function(e){var i=x[e]=t[e];x.prototype[e]=function(){var t=[this._wrapped];return l.apply(t,arguments),H.call(this,i.apply(x,t))}})};var E=0;x.uniqueId=function(t){var e=++E+"";return t?t+e:e},x.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var P=/(.)^/,D={"'":"'","\\":"\\","\r":"r","\n":"n","\t":"t","\u2028":"u2028","\u2029":"u2029"},L=/\\|'|\r|\n|\t|\u2028|\u2029/g;x.template=function(t,e,i){var s;i=x.defaults({},i,x.templateSettings);var n=new RegExp([(i.escape||P).source,(i.interpolate||P).source,(i.evaluate||P).source].join("|")+"|$","g"),a=0,o="__p+='";t.replace(n,function(e,i,s,n,r){return o+=t.slice(a,r).replace(L,function(t){return"\\"+D[t]}),i&&(o+="'+\n((__t=("+i+"))==null?'':_.escape(__t))+\n'"),s&&(o+="'+\n((__t=("+s+"))==null?'':__t)+\n'"),n&&(o+="';\n"+n+"\n__p+='"),a=r+e.length,e}),o+="';\n",i.variable||(o="with(obj||{}){\n"+o+"}\n"),o="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+o+"return __p;\n";try{s=new Function(i.variable||"obj","_",o)}catch(t){throw t.source=o,t}if(e)return s(e,x);var r=function(t){return s.call(this,t,x)};return r.source="function("+(i.variable||"obj")+"){\n"+o+"}",r},x.chain=function(t){return x(t).chain()};var H=function(t){return this._chain?x(t).chain():t};x.mixin(x),$(["pop","push","reverse","shift","sort","splice","unshift"],function(t){var e=a[t];x.prototype[t]=function(){var i=this._wrapped;return e.apply(i,arguments),"shift"!=t&&"splice"!=t||0!==i.length||delete i[0],H.call(this,i)}}),$(["concat","join","slice"],function(t){var e=a[t];x.prototype[t]=function(){return H.call(this,e.apply(this._wrapped,arguments))}}),x.extend(x.prototype,{chain:function(){return this._chain=!0,this},value:function(){return this._wrapped}})}).call(this)},"rp/m":function(t,e){},"rxv/":function(t,e,i){t.exports=i.p+"static/img/连续标注.aee9368.svg"},sOR5:function(t,e){var i={}.toString;t.exports=Array.isArray||function(t){return"[object Array]"==i.call(t)}},soCW:function(t,e){},tKRC:function(t,e,i){"use strict";(function(t){var s=i("jyVo"),n=i("mtWM"),a=i.n(n),o=i("mw3O"),r=i.n(o),l=[];l.append=function(t){let e=()=>{var t=l.shift();if(!t)return l.running=!1;l.running=!0,t().then(e).catch(e)};this.push(t),this.running||e()};var c={data:()=>({uploadData:new Map,alertTitle:!1,uploadType:".sdpc,.tif,.tiff,.sxs,.png,.jpg,.jpeg,.svs,.kfb,.ndpi,image/vms,image/vmu,image/scn,image/bif,.mdsx,.zyp,.tmap,.bif,.czi,.ibl,.tron",startIndex:0,isMounted:!1,loading:!1,userInfo:Object(s.s)(),demoModeValue:"1"===localStorage.getItem("demoMode")||!1}),computed:{count(){return this.isMounted?Math.ceil(this.$refs.sliceTable.bodyWrapper.style.height.slice(0,-2)/45):void 0},loadList(){return this.isMounted?this.record.slices.slice(0,(2+this.startIndex)*this.count):void 0}},destroyed(){this.$refs.sliceTable&&this.$refs.sliceTable.bodyWrapper.removeEventListener("scroll",this.lazyload)},methods:{lazyload(){let t=document.querySelectorAll(".el-autocomplete-suggestion"),e=document.querySelectorAll("input");t.forEach(t=>t.style.display="none"),e.forEach(t=>t.blur());let i=this.$refs.sliceTable.bodyWrapper.scrollTop;if(45*this.loadList.length-Math.ceil(i)-this.$refs.sliceTable.bodyWrapper.style.height.slice(0,-2)<=2){if(this.loadList.length===this.record.slices.length)return;this.startIndex+=1}},uploadAll(){this.record.slices.forEach(t=>{2!==t.state&&3!==t.state||this.upload(t)})},noEmoji(t){t.target.value=t.target.value.replace(/[^\u0020-\u007E\u00A0-\u00BE\u2E80-\uA4CF\uF900-\uFAFF\uFE30-\uFE4F\uFF00-\uFFEF\u0080-\u009F\u2000-\u201f\u2026\u2022\u20ac\r\n]/g,"")},alert(t){this.alertTitle=t},addDb(t,e){var i=t.files[0];let n=i.size/1024/1024;var a=new FileReader;n>100?this.$message.error("文件大小不能超过100MB"):(a.onload=(()=>{let t=new FormData;t.append("file",i),Object(s.b)(`files/importDb?caseid=${this.record.id}&fileid=${e.id}`,t).then(t=>{t.code?this.$message.error("上传失败"):this.$message.success("上传成功")})}),a.readAsDataURL(i))},exportDb(e,i){this.loading=!0;let s="json"===i?"/aipath/api/files/exportJson":"/aipath/api/files/exportDb";a()({headers:{"Content-Type":" application/x-www-form-urlencoded"},method:"post",url:s,data:r.a.stringify({fileid:e.id,caseid:this.record.id}),responseType:"blob"}).then(s=>{let n=e.filename.substring(0,e.filename.lastIndexOf("."));if(window.electron){let e=window.require,a=e("fs"),o=e("stream"),r=new Blob([s.data],{type:`application/${i}`}),l=new FileReader;l.readAsDataURL(r),l.onload=(e=>{const{dialog:s}=window.remote;s.showSaveDialog({defaultPath:`${n}.${i}`,title:`导出${i}`,filters:[{name:`.${i}`,extensions:[i]}]}).then(async({filePath:i})=>{if(i){let s=t.from(e.target.result.split("base64,")[1],"base64");const n=new o.PassThrough({allowHalfOpen:!1}).end(s),r=new a.createWriteStream(i);r.on("error",t=>{console.log(t),this.$message.error("导出错误，请重试"),this.loading=!1}).on("finish",()=>{this.loading=!1}),n.pipe(r)}else this.loading=!1})})}else{const t=document.createElement("a");let e=new Blob([s.data],{type:`application/${i}`});t.style.display="none",t.href=URL.createObjectURL(e),t.download=`${n}.${i}`,document.body.appendChild(t),t.click(),document.body.removeChild(t),window.URL.revokeObjectURL(t.href),this.loading=!1}}).catch(t=>{this.$message.error(t)})},async addFiles(t,e="slice"){for(var i of t.files){let t=i.size,s={id:Math.floor(1e7*Math.random())+"",filename:i.name,name:i.name,loaded:0,total:t,stain:"",state:4},n=new FormData;n.append("file",i),n.append("caseid",this.record.id),n.append("fileid",s.id),n.append("type",e),n.type=e,n.path=i.path,"slice"==e?this.record.slices.unshift(s):this.record.attachments.unshift(s),this.uploadData.set(s,n),this.upload(s)}t.value=""},async upload(t){var e=this.uploadData.get(t);t.state=4,t.loaded=0,l.append(async()=>{if(!this.$parent._isDestroyed){if(e.path&&e.path.endsWith(".mrxs")){let i=window.require("fs"),s=window.require("path"),n=window.require("http"),a=e.path.slice(0,-5),{name:o}=s.parse(e.path),r=i.readdirSync(a).map(t=>a+"\\"+t),l=r.map(t=>i.statSync(t).size).reduce((t,e)=>t+e);t.total=l,t.state=0;for(let e of r){if(t.deleted)return;await new Promise(a=>{let{base:r}=s.parse(e),l=i.createReadStream(e),c=n.request({host:location.hostname,port:location.port,path:`/aipath/api/files/upload2?caseid=${this.record.id}&fileid=${t.id}&type=slice&filename=${encodeURIComponent(o+"\\"+r)}&other=${this.config&&this.config.mode?"cs":""}`,headers:{Cookie:document.cookie,"Content-Type":"application/octet-stream","Transfer-Encoding":"chunked",Connection:"keep-alive"}},a);l.pipe(c),l.on("end",e=>c.end()+(t.loaded+=l.bytesRead)),c.on("error",e=>{throw t.state=3,t.loaded=0,console.error(`problem with request: ${e.message}`),e})})}}return t.ajaxToken=Object(s.b)(`files/upload?caseid=${this.record.id}&fileid=${t.id}&type=${e.type}&filename=${t.name}&other=${this.config&&this.config.mode&&"slice"==e.type?"cs":""}&total=${t.total}`,e,{onUploadProgress:e=>{t.deleted?t.ajaxToken.cancel():(t.total=Math.max(t.total,e.total),t.loaded=Math.max(t.loaded,e.loaded),t.state=0)}}),t.ajaxToken.then(e=>{0==e.code?(t.state=1,Object.assign(t,e.data,{total:t.total,loaded:t.loaded}),this.$parent.save()):5==e.code?t.state=5:t.state=2}).catch(e=>{t.state=3,t.loaded=0})}})},del(t){let e=1==t.state||2==t.state?"确定要删除 ("+t.name+") ?":"确定要取消上传 ("+t.name+") ?";this.$confirm(e,{confirmButtonText:this.$t("confirm.confirm"),cancelButtonText:this.$t("confirm.quit"),type:"warning"}).then(()=>{t.deleted=!0,Object(s.b)("files/delSlice",{caseid:this.record.id,fileid:t.id}).then(e=>{e.code||(this.record.slices=this.record.slices.filter(e=>e!=t),this.record.attachments=this.record.attachments.filter(e=>e!=t),this.$emit("save"))}).catch(t=>{this.$message.error(t.message)})},()=>{})},stainTypes(t,e){t=t&&t.trim().toLowerCase(),e(this.$t("upload.stainType").filter(e=>!t||e.toLowerCase().indexOf(t)>=0).slice(0,30).map(t=>({value:t})))},next(){this.$emit("next")},prev(){this.$emit("prev")}},mounted(){window.electron&&(this.uploadType=".sdpc,.tif,.tiff,.sxs,.png,.jpg,.jpeg,.svs,.kfb,.ndpi,image/vms,image/vmu,image/scn,image/bif,.mrxs,.mdsx,.zyp,.tmap,.bif,.czi,.ibl,.tron"),window.addEventListener("keydown",function(t){83==t.keyCode&&(navigator.platform.match("Mac")?t.metaKey:t.ctrlKey)&&t.preventDefault()},!1),this.$refs.sliceTable&&setTimeout(t=>{this.$refs.sliceTable.bodyWrapper.addEventListener("scroll",this.lazyload),this.isMounted=!0},0)},props:["record","config"]};e.a=c}).call(e,i("EuP9").Buffer)},uOiT:function(t,e,i){t.exports=i.p+"static/img/三角.619288f.png"},ujcs:function(t,e){e.read=function(t,e,i,s,n){var a,o,r=8*n-s-1,l=(1<<r)-1,c=l>>1,u=-7,h=i?n-1:0,d=i?-1:1,p=t[e+h];for(h+=d,a=p&(1<<-u)-1,p>>=-u,u+=r;u>0;a=256*a+t[e+h],h+=d,u-=8);for(o=a&(1<<-u)-1,a>>=-u,u+=s;u>0;o=256*o+t[e+h],h+=d,u-=8);if(0===a)a=1-c;else{if(a===l)return o?NaN:1/0*(p?-1:1);o+=Math.pow(2,s),a-=c}return(p?-1:1)*o*Math.pow(2,a-s)},e.write=function(t,e,i,s,n,a){var o,r,l,c=8*a-n-1,u=(1<<c)-1,h=u>>1,d=23===n?Math.pow(2,-24)-Math.pow(2,-77):0,p=s?0:a-1,v=s?1:-1,g=e<0||0===e&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(r=isNaN(e)?1:0,o=u):(o=Math.floor(Math.log(e)/Math.LN2),e*(l=Math.pow(2,-o))<1&&(o--,l*=2),(e+=o+h>=1?d/l:d*Math.pow(2,1-h))*l>=2&&(o++,l/=2),o+h>=u?(r=0,o=u):o+h>=1?(r=(e*l-1)*Math.pow(2,n),o+=h):(r=e*Math.pow(2,h-1)*Math.pow(2,n),o=0));n>=8;t[i+p]=255&r,p+=v,r/=256,n-=8);for(o=o<<n|r,c+=n;c>0;t[i+p]=255&o,p+=v,o/=256,c-=8);t[i+p-v]|=128*g}},uowx:function(t,e){},vAZQ:function(t,e){},vhYd:function(t,e,i){t.exports=i.p+"static/img/矩形排除-d.95f3983.svg"},vlIZ:function(t,e){},w55B:function(t,e){},wjIq:function(t,e){},wsMQ:function(t,e){},xG4u:function(t,e){},"xR/6":function(t,e){},xSBg:function(t,e){},xTgL:function(t,e){},xpBU:function(t,e){},yCbK:function(t,e){},z57H:function(t,e){},zV1N:function(t,e){},zvCs:function(t,e){}});