webpackJsonp([4],{"+I/B":function(t,e){},"1O0Z":function(t,e){},"3IRH":function(t,e){t.exports=function(t){return t.webpackPolyfill||(t.deprecate=function(){},t.paths=[],t.children||(t.children=[]),Object.defineProperty(t,"loaded",{enumerable:!0,get:function(){return t.l}}),Object.defineProperty(t,"id",{enumerable:!0,get:function(){return t.i}}),t.webpackPolyfill=1),t}},"4jrt":function(t,e,n){t.exports=n.p+"static/img/自由排除.22dcf85.svg"},"5MiC":function(t,e){},"94hp":function(t,e,n){t.exports=n.p+"static/img/logo.50b0d33.svg"},"9HLs":function(t,e){},B2xp:function(t,e,n){"use strict";var r={data:()=>({showTip:!1,setPsw:""}),methods:{confirmHandle(){this.setPsw?"dyj2017119"!==this.setPsw?this.showTip=!0:this.$emit("confirmBtn"):this.$message.error("密码不能为空")},cancelHandel(){this.setPsw="",this.$emit("cancelBtn")}},props:["title"]},i={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"set-psw"},[n("div",{staticClass:"header"},[t._v("\n      提示\n      "),n("span",{staticClass:"iconfont",on:{click:t.cancelHandel}})]),t._v(" "),n("p",[t._v(t._s(t.title))]),t._v(" "),n("input",{directives:[{name:"model",rawName:"v-model",value:t.setPsw,expression:"setPsw"}],attrs:{type:"password",placeholder:"请输入授权密码",autofocus:""},domProps:{value:t.setPsw},on:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.confirmHandle(e)},input:function(e){e.target.composing||(t.setPsw=e.target.value)}}}),t._v(" "),t.showTip?n("div",{staticClass:"icons"},[t._v("密码错误")]):t._e(),t._v(" "),n("div",{staticClass:"footer"},[n("button",{staticClass:"save",on:{click:t.confirmHandle}},[t._v("确定")]),t._v(" "),n("button",{on:{click:t.cancelHandel}},[t._v(t._s(t.$t("confirm.quit")))])])])},staticRenderFns:[]};var s=n("VU/8")(r,i,!1,function(t){n("cp6Q")},"data-v-75e3881b",null);e.a=s.exports},DsNH:function(t,e){},E82G:function(t,e){},F5RR:function(t,e){},FcKU:function(t,e,n){t.exports=n.p+"static/img/自由排除-d.d759dc1.svg"},FfyW:function(t,e){},"Ga4/":function(t,e){},GaJ7:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n("JCuE"),i=n("aeYY"),s=n("tOHu"),a=n("jyVo"),o={data(){return{count:0,companyid:Object(a.r)().company,userid:this.$route.query.id||Object(a.r)().username,data:null,loaaded:!1,records:[],currentRecord:null,currentPage:1,pagesize:parseInt(localStorage.getItem("pageNum"))||20,filters:{idSearch:"",nameSearch:"",filename:"",state:[],report:[],analy:[],gender:[],samplePart:[],sampleType:[]},sortColumn:"",sortOrder:""}},filters:{fmt:a.k},mounted(){this.getRecords(),document.title=this.$t("title.title"),console.log(Object(a.r)())},computed:{userInfo:()=>Object(a.r)(),tableData(){return(this.records||[]).filter(t=>t.basic.name.toLowerCase().indexOf(this.filters.nameSearch.toLowerCase())>=0).filter(t=>t.basic.caseid.indexOf(this.filters.idSearch)>=0).filter(t=>0==this.filters.state.length||this.filters.state.indexOf(!!t.started)>=0).filter(t=>0==this.filters.gender.length||this.filters.gender.indexOf(t.basic.gender)>=0).filter(t=>0==this.filters.samplePart.length||this.filters.samplePart.indexOf(t.basic.samplePart)>=0).filter(t=>""==this.filters.filename||t.slices.some(t=>t.name.toString().indexOf(this.filters.filename)>=0)).filter(t=>0==this.filters.analy.length||this.filters.analy.indexOf(t.analy)>=0).filter(t=>0==this.filters.report.length||this.filters.report.indexOf(!!t.reports.length)>=0).filter(t=>0==this.filters.sampleType.length||this.filters.sampleType.indexOf(t.basic.sampleType)>=0)},sorted(){return this.tableData.sort((t,e)=>{if(this.sortColumn){var n=0;switch(this.sortColumn){case"update":n=(t.update||"").localeCompare(e.update||"");break;case"slices.length":n=t.slices.length-e.slices.length;break;case"basic.age":n=t.basic.age-e.basic.age}return("descending"==this.sortOrder?-1:1)*n}return new Date(e.update).getTime()-new Date(t.update).getTime()}).slice((this.currentPage-1)*this.pagesize,this.currentPage*this.pagesize)},gender:()=>"en"==window.i18n.locale?{"男":"M","女":"F","其他":"O"}:{"男":"男","女":"女","其他":"其他"}},watch:{filters:{deep:!0,handler(){this.currentPage=1}},tableData(t,e){this.currentPage=Math.min(this.currentPage,Math.ceil(t.length/this.pagesize)),this.currentPage=Math.max(this.currentPage,1)},sorted:function(t,e){this.currentRecord&&t.find(t=>t.id===this.currentRecord.id)||(this.currentRecord=null)}},methods:{async getOne(){let t;for(;;){try{t=await Object(a.b)("check/get")}catch(t){return this.$alert("任务被抢完了,请等几分钟再来"),void this.getRecords()}let e=t.data.companyid,n=t.data.caseid;try{return t=await Object(a.b)("records/get?companyid="+e,{caseid:n}),void(this.data={companyid:e,record:t.data})}catch(t){}}},closeWindow(){this.data=null,this.getRecords()},openWindow(t){this.data={companyid:t.companyid,record:t}},handleSizeChange:function(t){localStorage.pageNum=this.pagesize=t,this.currentPage=1},states(){return[{text:this.$t("caselist.tableheader.states[0]"),value:!0},{text:this.$t("caselist.tableheader.states[1]"),value:!1}]},checkAnaly(t){var e={};return this.records.filter(e=>!!e[t]).map(e=>e[t]).forEach(t=>e[t]=t),Object.keys(e).map(t=>({text:t,value:t})).sort((t,e)=>t.text.localeCompare(e.text))},filterChange(t){Object.assign(this.filters,t)},sortChange({column:t,prop:e,order:n}){this.sortColumn=e,this.sortOrder=n},aggregate(t){var e={};return this.records.map(e=>e.basic[t]).forEach(t=>e[t]=t),Object.keys(e).map(t=>({text:t,value:t})).sort((t,e)=>t.text.localeCompare(e.text))},getRecords(){this.handler&&clearInterval(this.handler);var t=()=>{Object(a.b)("check/queryCount").then(t=>this.count=t.data),Object(a.b)("check/querySingle",{companyid:this.companyid,userid:this.userid}).then(t=>{let e=t.data.sort((t,e)=>new Date(e.update).getTime()-new Date(t.update).getTime())||[],n={};for(let t=e.length-1;t>=0;t--){let r=e[t];n[r.id]?e.splice(t,1):n[r.id]=1}this.records=e.map(t=>({opinion:t.opinion,DNAopinion:t.DNAopinion?t.DNAopinion:"",analy:(t=>"N"==t?"阴性":"P"==t?"阳性":"U"==t?"标本不满意":t||"")(t.analy),attachments:t.attachments,basic:t.basic,id:t.id,repoInfo:t.repoInfo,reports:t.reports,slices:t.slices,slice:t.slice,state:t.stage||2,started:t.started,companyid:t.companyid,update:t.update})),this.currentRecord=this.currentRecord&&t.data.find(t=>t.id==this.currentRecord.id),this.$refs.table&&this.$refs.table.setCurrentRow(this.currentRecord),this.loaaded=!0}).catch(t=>{this.loaaded=!0,console.error(t)})};this.handler=setInterval(t,3e5),t()}},components:{"v-header":r.a,"v-thumbnails":i.a,detail:s.a}},l={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"container"},[n("header",{staticClass:"header"},[n("v-header",{attrs:{showSign:!1}})],1),t._v(" "),n("div",{staticClass:"center-content"},[n("div",{staticClass:"table-header"},[n("div",{staticClass:"basic-index"},[t._v(t._s(t.$t("caselist.tableheader.cases"))),n("span",[t._v(t._s(this.tableData.length))])]),t._v(" "),this.$route.query.id?t._e():n("div",{staticClass:"button",on:{click:t.getOne}},[t._v("\n            我要复查一张新片子 ("+t._s(t.count)+")\n        ")])]),t._v(" "),n("el-table",{ref:"table",staticClass:"table",attrs:{data:t.sorted,size:"medium","row-class-name":function(t){return t.rowIndex%2?"row1":"row2"},"row-key":"id","current-row-key":null,"header-cell-class-name":"header",height:"calc(100% - 277px)","highlight-current-row":"","empty-text":t.loaaded?t.$t("loading.nodata"):t.$t("loading.loading")},on:{"current-change":function(e){t.currentRecord=e||t.currentRecord},"row-dblclick":function(e){return t.openWindow(e)},"filter-change":t.filterChange,"sort-change":t.sortChange}},[n("el-table-column",{attrs:{label:t.$t("caselist.tableheader.sample"),"min-width":"55"},scopedSlots:t._u([{key:"default",fn:function(e){return[n("el-tooltip",{attrs:{content:e.row.basic.caseid}},[n("span",[t._v(t._s(e.row.basic.caseid))])])]}}])},[n("template",{slot:"header"},[n("input",{directives:[{name:"model",rawName:"v-model",value:t.filters.idSearch,expression:"filters.idSearch"}],staticClass:"name-input",attrs:{placeholder:"样本号"},domProps:{value:t.filters.idSearch},on:{input:function(e){e.target.composing||t.$set(t.filters,"idSearch",e.target.value)}}})])],2),t._v(" "),n("el-table-column",{attrs:{label:t.$t("caselist.tableheader.filename"),"min-width":"60"},scopedSlots:t._u([{key:"default",fn:function(e){return[n("el-tooltip",[n("span",[t._v(t._s(e.row.basic.filename))])])]}}])},[n("template",{slot:"header"},[n("input",{directives:[{name:"model",rawName:"v-model",value:t.filters.filename,expression:"filters.filename"}],staticClass:"name-input",attrs:{placeholder:"切片"},domProps:{value:t.filters.filename},on:{input:function(e){e.target.composing||t.$set(t.filters,"filename",e.target.value)}}})])],2),t._v(" "),n("el-table-column",{attrs:{label:t.$t("caselist.tableheader.name"),"min-width":"55"},scopedSlots:t._u([{key:"default",fn:function(e){return[n("el-tooltip",{attrs:{content:e.row.basic.name}},[n("span",[t._v(t._s(e.row.basic.name))])])]}}])},[n("template",{slot:"header"},[n("input",{directives:[{name:"model",rawName:"v-model",value:t.filters.nameSearch,expression:"filters.nameSearch"}],staticClass:"name-input",attrs:{placeholder:"姓名"},domProps:{value:t.filters.nameSearch},on:{input:function(e){e.target.composing||t.$set(t.filters,"nameSearch",e.target.value)}}})])],2),t._v(" "),n("el-table-column",{attrs:{label:t.$t("caselist.tableheader.sex"),"min-width":"60",filters:[{text:""+t.$t("caselist.tableheader.gender[0]"),value:"男"},{text:""+t.$t("caselist.tableheader.gender[1]"),value:"女"},{text:""+t.$t("caselist.tableheader.gender[2]"),value:"其他"}],"column-key":"gender",prop:"basic.gender"},scopedSlots:t._u([{key:"default",fn:function(e){return[n("a",{attrs:{type:e.row.basic.gender===""+t.$t("caselist.tableheader.gender[0]")?"primary":"success","disable-transitions":""}},[t._v("\n              "+t._s(t.gender[e.row.basic.gender])+"\n            ")])]}}])}),t._v(" "),n("el-table-column",{attrs:{label:t.$t("caselist.tableheader.age"),prop:"basic.age","min-width":"55","sort-method":function(t,e){return t.basic.age-e.basic.age},sortable:""},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v("\n            "+t._s(e.row.basic.age)+"\n          ")]}}])}),t._v(" "),n("el-table-column",{attrs:{label:t.$t("caselist.tableheader.samplePart"),filters:t.aggregate("samplePart"),prop:"basic.samplePart","column-key":"samplePart","min-width":"85"},scopedSlots:t._u([{key:"default",fn:function(e){return[n("el-tooltip",{attrs:{content:e.row.basic.samplePart}},[n("span",[t._v(t._s(e.row.basic.samplePart))])])]}}])}),t._v(" "),n("el-table-column",{attrs:{label:t.$t("caselist.tableheader.sampleType"),"min-width":"85",filters:t.aggregate("sampleType"),prop:"basic.sampleType","column-key":"sampleType"},scopedSlots:t._u([{key:"default",fn:function(e){return[n("el-tooltip",{attrs:{content:e.row.basic.sampleType}},[n("span",[t._v(t._s(e.row.basic.sampleType))])])]}}])}),t._v(" "),n("el-table-column",{attrs:{label:t.$t("caselist.tableheader.sliceNum"),"min-width":"85",prop:"slices.length",sortable:""},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v("\n            "+t._s(e.row.slices.length)+"\n          ")]}}])}),t._v(" "),n("el-table-column",{attrs:{label:t.$t("caselist.tableheader.state"),filters:t.states(),"min-width":"85",prop:"id","column-key":"state"},scopedSlots:t._u([{key:"default",fn:function(e){return[n("el-tooltip",{attrs:{content:t.states().find(function(t){return t.value==!!e.row.started}).text}},[n("span",{staticStyle:{position:"relative","padding-left":"18px"}},[n("i",{staticClass:"circle",class:{"bg-blue":t.states().find(function(t){return t.value==!!e.row.started}).text==t.$t("caselist.tableheader.states[1]")}}),t._v("\n                "+t._s(t.states().find(function(t){return t.value==!!e.row.started}).text)+"\n              ")])])]}}])}),t._v(" "),n("el-table-column",{attrs:{label:t.$t("caselist.tableheader.analy"),filters:t.checkAnaly("analy"),"min-width":"90",prop:"analy","column-key":"analy"},scopedSlots:t._u([{key:"default",fn:function(e){return["阴性"===e.row.analy?n("span",{staticStyle:{color:"green"}},[t._v("\n                "+t._s(e.row.analy)+"\n              ")]):"阳性"===e.row.analy?n("span",{staticStyle:{color:"red"}},[t._v("\n                "+t._s(e.row.analy)+"\n              ")]):n("span",{staticStyle:{color:"yellow"}},[t._v("\n                "+t._s(e.row.analy)+"\n              ")])]}}])}),t._v(" "),n("el-table-column",{attrs:{label:t.$t("caselist.tableheader.updateTime"),"min-width":"90",prop:"update",sortable:""},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v("\n            "+t._s(t._f("fmt")(e.row.update))+"\n          ")]}}])}),t._v(" "),n("el-table-column",{attrs:{label:t.$t("caselist.tableheader.operation"),"min-width":"90"},scopedSlots:t._u([{key:"default",fn:function(e){return[n("el-button",{staticClass:"detail",on:{click:function(n){return t.openWindow(e.row)}}},[t._v(t._s(t.$t("caselist.operation.detail")))])]}}])})],1),t._v(" "),n("div",{staticClass:"message-bar"},[n("div",{staticClass:"message"}),t._v(" "),t.records.length?n("el-pagination",{staticClass:"page",attrs:{"current-page":t.currentPage,"page-sizes":[20,50,100],"page-size":t.pagesize,layout:"sizes, prev, pager, next",total:t.tableData.length},on:{"size-change":t.handleSizeChange,"current-change":function(e){return t.currentPage=e}}}):t._e()],1),t._v(" "),n("v-thumbnails",{key:"thumb"+(t.currentRecord&&t.currentRecord.id),attrs:{record:t.currentRecord&&t.tableData.find(function(e){return e.id==t.currentRecord.id})},on:{click:function(e){return t.openWindow(t.currentRecord,e)}}})],1),t._v(" "),t.data?n("detail",{attrs:{data:t.data,companyid:t.data.companyid},on:{closing:function(e){return t.closeWindow()}}}):t._e()],1)},staticRenderFns:[]};var c=n("VU/8")(o,l,!1,function(t){n("gxuG")},"data-v-33bdc024",null);e.default=c.exports},"I9+T":function(t,e,n){"use strict";n("jyVo");var r={data(){return{basic:this.$props.record.basic,isOpen:!1,checked:"basicMessage",isBig:!1}},methods:{toggleBig:function(){this.isBig=!this.isBig},download(t,e,n){window.location.href=`/aipath/api/files/attachment?caseid=${t}&fileid=${e}&filename=${n}`}},computed:{gender(){let t=window.localStorage.getItem("localeLanguage");return"zh"==t?{"男":"男","女":"女","其他":"其他"}:"en"==t?{"男":"M","女":"F","其他":"O"}:void 0}},props:["record"]},i={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"container"},[n("div",{staticClass:"open-message",attrs:{title:t.$t("basic.basic")},on:{click:function(e){t.isOpen=!t.isOpen}}}),t._v(" "),t.isOpen?n("div",{class:{"case-bigger":t.isBig,"case-message":!t.isBig}},[n("h1",[n("span",{class:{"cur-checked":"basicMessage"==t.checked},on:{click:function(e){t.checked="basicMessage"}}},[t._v(t._s(t.$t("basic.message")))]),t._v(" "),n("span",{class:{"cur-checked":"attachment"==t.checked},on:{click:function(e){t.checked="attachment"}}},[t._v(t._s(t.$t("basic.attactment")))]),t._v(" "),n("i",{staticClass:"close",on:{click:function(e){t.isOpen=!1}}}),n("i",{staticClass:"scale",class:{"bg-blue":t.isBig},on:{click:function(e){return t.toggleBig()}}})]),t._v(" "),n("div",{staticClass:"message-content"},["attachment"==t.checked?n("div",[n("ul",t._l(t.record.attachments.filter(function(t){return 1==t.state}),function(e){return n("li",{key:e.id},[n("a",{ref:"attachment",refInFor:!0,attrs:{title:e.name},on:{click:function(n){return t.download(t.record.id,e.id,e.name)}}},[t._v(t._s(e.name))])])}),0)]):t._e(),t._v(" "),"basicMessage"==t.checked?n("div",[n("div",{staticClass:"basics"},[n("h1",[t._v(t._s(t.$t("basic.basic")))]),t._v(" "),n("ul",[n("li",[n("dl",[n("dt",[t._v(t._s(t.$t("basic.age")))]),n("dd",[t._v(t._s(t.basic.age))])]),n("dl",[n("dt",[t._v(t._s(t.$t("basic.sex")))]),n("dd",[t._v(t._s(t.gender[t.basic.gender]))])])]),t._v(" "),n("li",[n("dl",{staticStyle:{width:"100%"}},[n("dt",{attrs:{title:t.$t("basic.cancerTypeTitle")}},[t._v(t._s(t.$t("basic.cancerType")))]),n("dd",[t._v(t._s(t.basic.cancerType))])])]),t._v(" "),n("li",[n("dl",{staticStyle:{width:"100%"}},[n("dt",{attrs:{title:t.$t("basic.familyHistoryTitle")}},[t._v(t._s(t.$t("basic.familyHistory")))]),n("dd",[t._v(t._s(t.basic.familyHistory))])])]),t._v(" "),n("li",[n("dl",{staticStyle:{width:"100%"}},[n("dt",{attrs:{title:t.$t("basic.medicalHistoryTitle")}},[t._v(t._s(t.$t("basic.medicalHistory")))]),n("dd",[t._v(t._s(t.basic.medicalHistory))])])])])]),t._v(" "),n("div",{staticClass:"basics"},[n("h1",[t._v(t._s(t.$t("basic.sample")))]),t._v(" "),n("ul",[n("li",[n("dl",{staticStyle:{width:"100%"}},[n("dt",{attrs:{title:t.$t("basic.samplePartTitle")}},[t._v(t._s(t.$t("basic.samplePart")))]),n("dd",[t._v(t._s(t.basic.samplePart))])])]),t._v(" "),n("li",[n("dl",{staticStyle:{width:"100%"}},[n("dt",{attrs:{title:t.$t("basic.sampleTypeTitle")}},[t._v(t._s(t.$t("basic.sampleType")))]),n("dd",[t._v(t._s(t.basic.sampleType))])])]),t._v(" "),n("li",[n("dl",{staticStyle:{width:"100%"}},[n("dt",[t._v(t._s(t.$t("basic.generallySeen")))]),n("dd",[t._v(t._s(t.basic.generallySeen))])])])])])]):t._e()])]):t._e()])},staticRenderFns:[]};var s=n("VU/8")(r,i,!1,function(t){n("l7ju")},"data-v-a17105bc",null);e.a=s.exports},JCuE:function(t,n,r){"use strict";var i=r("jyVo"),s={data:()=>({}),methods:{userInfo:i.r,imgPreview(t){if(window.FileReader)var n=new FileReader;else this.$alert(e.message,{confirmButtonText:this.$t("signature.updateEquipment")});var r=document.getElementById("imageFile").files[0];r.size/1024/1024>5?this.$message.error("文件大小不能超过5MB"):(n.onload=function(t){document.getElementById("preview").src=t.target.result},n.readAsDataURL(r))},upload(){let t=new FormData;t.append("sign",this.$refs.file.files[0]),Object(i.b)("user/updateSign",t),this.$emit("close")},cancleUpload:function(){this.$emit("close")}}},a={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"sign-bg"},[n("div",{staticClass:"sign-content"},[n("div",{staticClass:"headerFloat"},[t._v("\n      "+t._s(t.$t("signature.title"))+"\n      "),n("span",{staticClass:"iconfont",on:{click:function(e){return t.cancleUpload()}}})]),t._v(" "),n("div",{staticClass:"img-content"},[n("div",{attrs:{id:"uploadimg"}},[n("div",{staticClass:"uploader-list",attrs:{id:"fileList"}},[n("img",{attrs:{id:"preview",src:"/aipath/api/user/sign?id="+t.userInfo().username+"&"+Math.random()}})]),t._v(" "),n("div",{staticClass:"imgPicker have-img"},[n("form",{attrs:{id:"imgFile"}},[t._v("\n            "+t._s(t.$t("signature.changeSignature"))+"\n            "),n("input",{ref:"file",attrs:{type:"file",id:"imageFile",name:"file",accept:"image/jpeg,image/png,image/bmp"},on:{change:function(e){return t.imgPreview(e.currentTarget)}}})])])])]),t._v(" "),n("div",{staticClass:"footer"},[n("button",{on:{click:function(e){return t.cancleUpload()}}},[t._v(t._s(t.$t("confirm.quit")))]),t._v(" "),n("button",{attrs:{id:"ctlBtn"},on:{click:function(e){return t.upload()}}},[t._v(t._s(t.$t("confirm.confirm")))])])])])},staticRenderFns:[]};var o=r("VU/8")(s,a,!1,function(t){r("Ga4/")},"data-v-69f0cfc4",null).exports,l=r("B2xp"),c=r("KaQe"),u=(r("igz+"),{name:"mode",components:{},props:{modeName:String,modelName:String,active:Boolean},data:()=>({}),computed:{},methods:{}}),h={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"component__mode mode inflex f-ai-c f-fs-0",class:{active:t.active},on:{click:function(e){return e.stopPropagation(),t.$emit("choose")}}},[n("div",{staticClass:"mode-text f-fs-0"},[n("div",{staticClass:"mode-text-item"},[t._v("\n            模式："+t._s(t.modeName)+"\n        ")]),t._v(" "),n("div",{staticClass:"mode-text-item"},[t._v("\n            模型："+t._s(t.modelName)+"\n        ")])]),t._v(" "),n("div",{staticClass:"mode-btns f-fs-0"},[n("div",{staticClass:"mode-btns-btn",on:{click:function(e){return e.stopPropagation(),t.$emit("edit")}}},[t._v("修改")]),t._v(" "),n("div",{staticClass:"mode-btns-btn",on:{click:function(e){return e.stopPropagation(),t.$emit("delete")}}},[t._v("删除")])])])},staticRenderFns:[]};var f=r("VU/8")(u,h,!1,function(t){r("5MiC")},"data-v-a465c3de",null).exports,d=r("scHV"),p=r("d0PZ"),v=r("qlG4"),m=r("7+uW"),g={name:"mode-form",components:{},props:{formData:Object,modelList:Array},data:()=>({}),computed:{validate(){return this.$refs.form.validate}},methods:{getLength:p.d}},_={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("el-form",{ref:"form",staticClass:"component__mode-form mode-form",attrs:{model:t.formData,"status-icon":"","label-width":"80px","hide-required-asterisk":""}},[n("el-form-item",{attrs:{label:"模式名称",prop:"patternName",rules:[{required:!0,message:"请输入模式名称",trigger:"blur"},{validator:function(e,n,r){t.getLength(n)>20?r(new t.Error("模式名称长度不能超过20字符")):r()},trigger:"blur"}]}},[n("el-input",{attrs:{autocomplete:"off"},model:{value:t.formData.patternName,callback:function(e){t.$set(t.formData,"patternName",e)},expression:"formData.patternName"}})],1),t._v(" "),n("el-form-item",{attrs:{label:"绑定模型",prop:"modelName",rules:[{required:!0,message:"请选择绑定模型",trigger:"blur"}]}},[n("el-select",{attrs:{placeholder:"请选择绑定模型"},model:{value:t.formData.modelName,callback:function(e){t.$set(t.formData,"modelName",e)},expression:"formData.modelName"}},t._l(t.modelList,function(t){return n("el-option",{key:t,attrs:{label:t,value:t}})}),1)],1)],1)},staticRenderFns:[]};var y=r("VU/8")(g,_,!1,function(t){r("kh4U")},"data-v-0758c223",null).exports,w=r("M4fF"),b=r.n(w),x={name:"mode-list",mixins:[d.b],components:{Mode:f},props:{aiType:String,modeId:Number},data:()=>({paramsCache:{},modelList:[]}),computed:{aiTypeModes(){return this.getAiTypeModes(this.aiType)}},methods:{async getAiParams(t){if(this.paramsCache[t]){const e=this.paramsCache[t];return this.$emit("getAiParams",JSON.parse(JSON.stringify(e))),JSON.parse(JSON.stringify(e))}return Object(i.d)("manage/getAiParams",{id:t}).then(e=>{let n=e.data?Object.assign({},e.data,{threshold_value:100*e.data.threshold_value}):{};n.cell_conf=n.cell_conf||{},n.cell_num=n.cell_num||{},this.$set(this.paramsCache,t,n),this.$emit("getAiParams",JSON.parse(JSON.stringify(n)))}).catch(t=>{this.$message.error(t.message)})},changeModeId(t){this.$emit("update:modeId",t),this.getAiParams(t)},onEdit(t){const e=this.$createElement;let n,r=m.default.observable(t?{patternName:t.patternName,modelName:t.modelName,id:t.id}:{patternName:"",modelName:null});v.a.show({props:{width:"400px",title:"模式"},slots:{default:()=>n=e(y,{attrs:{formData:r,modelList:this.modelList}}),footer:e("span",{slot:"footer",class:"dialog-footer"},[e("el-button",{on:{click:()=>{v.a.close()}},attrs:{size:"mini"}},["取 消"]),e("el-button",{attrs:{type:"primary",size:"mini"},on:{click:()=>{n.componentInstance.validate(t=>{if(t)return Object(i.d)("manage/editAiPattern",Object.assign({aiType:this.aiType},r)).then(async()=>{this.$message.success(r.id?"修改成功":"新增成功"),v.a.close(),await this.getModes(),r.id||this.changeModeId(b.a.last(this.aiTypeModes).id)}).catch(t=>{this.$message.error(t.message)})})}}},["确 定"])])}})},onDelete(t){this.$confirm("确定删除吗？","操作确认").then(()=>Object(i.d)("manage/delAiPattern",{id:t.id}).then(()=>(this.$message.success("删除成功"),this.getModes())).catch(t=>{this.$message.error(t.message)}))},getModes:()=>Object(d.a)(),getModels(){return Object(i.d)("manage/getModel",{aiType:this.aiType}).then(t=>{this.modelList=t.data})}},created(){this.getModes(),this.getModels(),this.changeModeId(this.aiTypeModes[0].id)}},C={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"component__mode-list mode-list flex f-ai-c"},[t.aiTypeModes?t._l(t.aiTypeModes,function(e){return n("Mode",{key:e.id,attrs:{modeName:e.patternName,modelName:e.modelName,active:t.modeId===e.id},on:{choose:function(n){return t.changeModeId(e.id)},edit:function(n){return t.onEdit(e)},delete:function(n){return t.onDelete(e)}}})}):t._e(),t._v(" "),n("el-button",{staticClass:"mode-add",attrs:{type:"text",icon:"el-icon-plus",size:"medium"},on:{click:function(e){return t.onEdit()}}},[t._v("新模式")])],2)},staticRenderFns:[]};var k=r("VU/8")(x,C,!1,function(t){r("kzvN"),r("uGx8")},"data-v-2190bb08",null).exports,P={data:()=>({user:Object(i.r)(),isChange:!1,home:!1,oldPassword:"",newPassword:"",newPasswordSure:"",reg:/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d|\W).{8,32}$/,showSettingAIParam:!1,showSetting:!1,labelcheck:4,clarityStandardsUpper:.6,clarityStandardsLower:.2,ajustType:"tct",defaultTctThreshold:0,defaultLctThreshold:0,curParam:{},tctParam:{},lctParam:{},dnaParam:{},dna_ploidyParam:{},loading:!1,showTrial:!1,trialTimes:[],analyseThreshold:{},onTrial:0,demoModeValue:"1"==localStorage.getItem("demoMode")||!1,showMsg:!1,showTipTxt:!1,showTips:!1,showSetPsw:!1,showTip:!1,pwsType:"",setPsw:"",electron:window.electron,showBuble:!1,curTime:(new Date).getTime(),remainMemory:0,memoryRoot:null,clearTime:"",pickerOptions:{disabledDate:t=>t.getTime()>Date.now()-864e4},recordCount:0,showMemoryBox:!1,smoothImg:null,smoothValue:.01,all_use:0,correctData:{},cell_conf_colums:["ASC-US","LSIL","ASC-H","HSIL","AGC","CC","TRI","CAN","ACT","HSV","INF","ATR","RAP","META","GC"],cell_num_colums:["CC","TRI","CAN","ACT","HSV","INF","ATR","RAP","META","GC"],params_tct_lct_dna_reg:/(t|l)ct|dna/,params_tct_lct_reg:/(t|l)ct/,modeId:null}),watch:{curParam:{handler(){this.params_tct_lct_dna_reg.test(this.ajustType)&&this.getAnalyseThreshold()},deep:!0}},methods:{getAiParams(t){this.curParam=t,this[this.ajustType+"Param"]=t,this.getAnalyseThreshold()},changeTab(t){switch(this.ajustType=t,t){case"tct":b.a.isEmpty(this.tctParam)?this.curParam={cell_conf:{},cell_num:{}}:(this.curParam=this.tctParam,this.getAnalyseThreshold());break;case"lct":b.a.isEmpty(this.lctParam)?this.curParam={cell_conf:{},cell_num:{}}:(this.curParam=this.lctParam,this.getAnalyseThreshold());break;case"pdl1":this.getSmoothValue();break;case"dna":this.curParam=this.dnaParam,this.getAnalyseThreshold();break;case"dna_ploidy":this.curParam=this.dna_ploidyParam}},modifySmoothValue(t){"plus"===t?this.smoothValue<.05?(this.smoothValue+=.01,this.getImg()):this.$message.warning("不能再加了"):this.smoothValue>.01?(this.smoothValue=Number((this.smoothValue-.01).toFixed(2)),this.getImg()):this.$message.warning("不能再减了")},downloadTem(){window.location.href=`/aipath/api/files/downloadTemplate?name=${encodeURIComponent("调参模板.xlsx")}`},imgPreview(t){var e=t.files[0];if(e.size/1024/1024>10)return void this.$message.error("文件大小不能超过10MB");let n=new FormData;n.append("file",e),Object(i.b)("ai/uploadDoc",n).then(t=>{t.code?this.$message.error(t.message):this.getImg(),this.$refs.smoothfile.value=""})},getImg(){Object(i.b)("ai/getFittingCurve",{smooth_value:this.smoothValue}).then(t=>{t.code?this.$message.error(t.message):this.smoothImg=t.img})},resetModelCalibration(){this.$confirm("模型将恢复到初始状态，操作后不可撤回，确定要重置吗？","提示").then(()=>{Object(i.b)("ai/resetModelCalibration").then(t=>{t.code?this.$message.error(t.message):this.$message.success("操作成功")})}).catch(t=>t)},resetSmooth(){Object(i.b)("ai/clearParameter").then(t=>{t.code?this.$message.error(t.message):(this.smoothImg=null,this.smoothValue=.01)})},getSmoothValue(){Object(i.b)("ai/getParameter").then(t=>{t.code?this.$message.error(t.message):(this.smoothImg=t.img,this.smoothValue=t.smooth_value)})},getMemory:()=>new Promise(t=>{Object(i.b)("manage/remainingSpace").then(({data:e})=>{t(e.remainingSpace)})}),timeChange(t){Object(i.b)("manage/recordCount",{closing_date:t}).then(({data:t})=>{this.recordCount=t.recordCount})},clearCase(){this.recordCount?this.$confirm("删除后数据无法恢复，确认继续吗？").then(()=>{Object(i.b)("manage/freeUpSpace",{closing_date:this.clearTime}).then(async()=>{this.remainMemory=await this.getMemory(),this.$emit("updateList"),this.clearTime="",this.recordCount=0,this.showMemoryBox=!1,this.$message.success("操作成功，系统将在1小时内更新可用存储空间。")})}).catch(t=>t):this.$message.error("请选择病例")},timing(){this.curTime=(new Date).getTime(),this.user.is_test&&setTimeout(this.timing,864e5)},async openSeting(){"param"===this.pwsType?(this.ajustType="tct",await Promise.all([this.getThreshold("dna"),this.getThreshold("dna_ploidy")]).then(([t,e])=>{this.dnaParam=t,this.$set(this.dnaParam,"cell_conf",this.dnaParam.cell_conf||{}),this.$set(this.dnaParam,"cell_num",this.dnaParam.cell_num||{}),this.dna_ploidyParam=e||{}}),this.changeTab("tct"),this.$set(this.curParam,"cell_conf",{}),this.$set(this.curParam,"cell_num",{}),this.showSettingAIParam=!0,this.showSetting=!1,this.showSetPsw=!1,this.setPsw=""):"control"===this.pwsType?(this.showSetting=!1,this.showSetPsw=!1,this.setPsw="",window.remote.getCurrentWindow().toggleDevTools()):this.$message.error("出什么事了")},changeMode(t){console.log("changeMode")},setType(t){this.pwsType=t,this.showSetPsw=!0,this.showMsg=!1},async showTrialMan(){await this.getTrialTimes(),this.home=!1,this.showTrial=!0},getTrialTimes(){Object(i.b)("manage/get_trial_times").then(({data:t})=>{this.onTrial=t.onTrial;let e=JSON.parse(t.model_lis),n=JSON.parse(t.trialTimes);if(this.onTrial){this.trialTimes=[];for(let t in n)e.includes(t)&&this.trialTimes.push({key:t,times:n[t]})}})},settingOpen(){Object(i.c)("ai/getLabel").then(t=>{this.demoModeValue="1"==localStorage.getItem("demoMode")||!1;const e=t.data;this.labelcheck=e.label,this.clarityStandardsLower=e.clarityStandardsLower,this.clarityStandardsUpper=e.clarityStandardsUpper,this.home=!1,this.showSetting=!0})},orcSave(){localStorage.correctData=JSON.stringify(this.correctData),Object(i.c)("ai/modifyLabel",{label:this.labelcheck,clarityStandardsLower:this.clarityStandardsLower,clarityStandardsUpper:this.clarityStandardsUpper}).then(t=>{this.demoModeValue?localStorage.setItem("demoMode","1"):localStorage.setItem("demoMode","0"),this.$emit("updateList"),this.$message.success("保存成功"),this.showSetting=!1}).catch(t=>{this.$message.error(t.message)})},async cancel(){this.showSettingAIParam=!1},apply(){this.$confirm('确定应用新参数吗？<span style="color:#f00">正在处理的切片将不受新参数影响。</span>',"提示",{cancelButtonText:"取消",confirmButtonText:"确定",dangerouslyUseHTMLString:!0,type:"warning"}).then(()=>{if("pdl1"===this.ajustType)this.loading=!0,Object(i.b)("ai/changeTps",{smooth_value:this.smoothValue,all_use:Number(this.all_use)}).then(t=>{this.loading=!1,this.$message.success("应用成功"),this.showSettingAIParam=!1,this.$emit("updateList")}).catch(t=>{this.loading=!1,this.$message.error(t.message)});else if("dna_ploidy"===this.ajustType){this.loading=!0;let t={alg_type:this.ajustType,threshold_value:JSON.stringify(this.curParam),threshold_range:0};Object(i.b)(`manage/saveAiThreshold?companyid=${this.user.company}`,t).then(t=>{this.loading=!1,this.$message.success("应用成功"),this.showSettingAIParam=!1,this.$emit("updateList")}).catch(t=>{this.loading=!1,this.$message.error(t.message)})}else if(this.params_tct_lct_reg.test(this.ajustType)){this.loading=!0;let t=Object.assign({},this.curParam,{alg_type:this.ajustType,threshold_value:this.curParam.threshold_value/100},0===this.curParam.slice_range?{search_key:JSON.stringify(this.$parent.filters)}:{});Object(i.d)(`manage/editAiThreshold?companyid=${this.user.company}`,{id:this.modeId,aiThreshold:t,aiType:this.ajustType}).then(t=>{this.loading=!1,this.$message.success("应用成功"),this.showSettingAIParam=!1,this.$emit("updateList")}).catch(t=>{this.loading=!1,this.$message.error(t.message)})}else if(this.params_tct_lct_dna_reg.test(this.ajustType)){this.loading=!0;let t=Object.assign({},this.curParam,{alg_type:this.ajustType,threshold_value:this.curParam.threshold_value/100,cell_conf:JSON.stringify(this.curParam.cell_conf),cell_num:JSON.stringify(this.curParam.cell_num)},0===this.curParam.slice_range?{search_key:JSON.stringify(this.$parent.filters)}:{});Object(i.b)(`manage/saveAiThreshold?companyid=${this.user.company}`,t).then(t=>{this.loading=!1,this.$message.success("应用成功"),this.showSettingAIParam=!1,this.$emit("updateList")}).catch(t=>{this.loading=!1,this.$message.error(t.message)})}else{this.loading=!0;let t=Object.assign({},this.curParam,{alg_type:this.ajustType,threshold_value:this.curParam.threshold_value/100});Object(i.b)(`manage/saveAiThreshold?companyid=${this.user.company}`,t).then(t=>{this.loading=!1,this.$message.success("应用成功"),this.showSettingAIParam=!1,this.$emit("updateList")}).catch(t=>{this.loading=!1,this.$message.error(t.message)})}}).catch(()=>{this.loading=!1})},seset(){Object(i.b)(`manage/getDefaultAiThreshold?companyid=${this.user.company}`,{alg_type:this.ajustType}).then(t=>{this.curParam=t.data,this.$set(this.curParam,"threshold_value",100*t.data.threshold_value),this.getAnalyseThreshold(),this.$message.success("设置成功")}).catch(t=>{this.loading=!1,this.$message.error(t.message)})},resetDnaPloidy(){Object(i.b)(`manage/getDefaultAiThreshold?companyid=${this.user.company}`,{alg_type:this.ajustType}).then(t=>{this.curParam=t.data.threshold_value,this.$message.success("设置成功")}).catch(t=>{this.loading=!1,this.$message.error(t.message)})},getThreshold(t){return new Promise(e=>{Object(i.b)(`manage/getAiThreshold?companyid=${this.user.company}`,{alg_type:t}).then(n=>{e("dna_ploidy"===t?n.data.threshold_value:Object.assign({},n.data,{threshold_value:100*n.data.threshold_value}))}).catch(()=>e({}))})},getAnalyseThreshold(){let t=Object.assign({},this.curParam,{threshold_value:this.curParam.threshold_value/100,cell_conf:JSON.stringify(this.curParam.cell_conf),cell_num:JSON.stringify(this.curParam.cell_num),alg_type:this.ajustType,patternId:this.modeId},0===this.curParam.slice_range?{search_key:JSON.stringify(this.$parent.filters)}:{});Object(i.b)("ai/analyseThreshold",t).then(t=>{this.analyseThreshold=t.data})},barChange(t){this.getAnalyseThreshold()},quit(){this.isStart?this.$alert("高通量运行状态下无法退出登录，请停止高通量后重试。","提示",{confirmButtonText:"确定",callback:t=>{this.home=!1}}):this.$confirm(this.$t("personal.confirmQiut"),{confirmButtonText:this.$t("confirm.confirm"),cancelButtonText:this.$t("confirm.quit"),type:"warning"}).then(()=>{localStorage.setItem("demoMode","0"),document.cookie="jwt=; expires=Thu, 01 Jan 1970 00:00:00 GMT",window.ws.onclose=null,window.ws&&window.ws.close(),window.ws=null,this.$router.push("/login")}).catch(()=>{this.home=!1})},clearCache(){this.$confirm("确定清除缓存？",{confirmButtonText:this.$t("confirm.confirm"),cancelButtonText:this.$t("confirm.quit"),type:"warning"}).then(()=>{Object(i.b)("files/delJunkFile").then(()=>{this.home=!1})}).catch(()=>{})},shutdown(){this.$confirm("确定关机吗",{confirmButtonText:this.$t("confirm.confirm"),cancelButtonText:this.$t("confirm.quit"),type:"warning"}).then(()=>{Object(i.b)("manage/shutdown").then(t=>{this.$message({message:"服务器将在10秒后关闭,服务不再可用！",type:"warning"})})}).catch(()=>{this.home=!1})},reboot(){this.$confirm("确定重启吗",{confirmButtonText:this.$t("confirm.confirm"),cancelButtonText:this.$t("confirm.quit"),type:"warning"}).then(()=>{Object(i.b)("manage/reboot").then(t=>{this.$message({message:"服务器将在立刻重启,服务不再可用！",type:"warning"})})}).catch(()=>{this.home=!1})},closeSign(){this.$emit("closeSign"),this.home=!1},noBg:function(){this.home=!1},toogleHome:function(){this.home=!this.home},changePsw(){this.isChange=!0,this.home=!1},confirmPsw(){this.oldPassword&&this.newPassword&&this.newPasswordSure&&this.reg.test(this.newPassword)&&this.oldPassword!=this.newPassword&&this.newPasswordSure==this.newPassword&&Object(i.c)("user/updatePassword",{password:this.oldPassword,newPassword:this.newPassword}).then(t=>{this.$alert(this.$t("changepassword.success"),{confirmButtonText:this.$t("confirm.confirm")}),this.isChange=!1,this.home=!1,this.oldPassword="",this.newPassword="",this.newPasswordSure=""}).catch(t=>{1==t.code?this.$alert(this.$t("changepassword.wrong"),{confirmButtonText:this.$t("confirm.confirm")}):3==t.code?this.$alert("旧密码错误",{confirmButtonText:this.$t("confirm.confirm")}):this.$alert(t.message,{confirmButtonText:this.$t("confirm.confirm")})})},qiutPsw(){this.isChange=!1,this.home=!1,this.oldPassword="",this.newPassword="",this.newPasswordSure=""},addImg:function(){this.home=!1,this.$emit("showSign")},backStage(){this.isStart?this.$alert("高通量运行状态下无法进入后台管理，请停止高通量后重试。","提示",{confirmButtonText:"确定",callback:t=>{this.home=!1}}):"sa"==this.user.role?this.$router.push("/manage"):"admin"==this.user.role&&this.$router.push({path:"/admin",query:{data:this.user.company}})}},async created(){this.getAnalyseThreshold(),this.getTrialTimes(),this.timing(),this.remainMemory=await this.getMemory(),this.memoryRoot=setInterval(async()=>{this.remainMemory=await this.getMemory()},3e5),localStorage.correctData?this.correctData=JSON.parse(localStorage.correctData):(this.correctData={x:0,y:0,z:0},localStorage.correctData=JSON.stringify({x:0,y:0,z:0}))},computed:{num_input_disabled_list(){if(!this.curParam.cell_num)return;const t=["CC","TRI","CAN","ACT","HSV"],e=["INF","ATR","RAP","META","GC"];let n=[];return this.curParam.microbe||(n=n.concat(t)),this.curParam.other||(n=n.concat(e)),n},isNearExpires(){let t=this.user.time_out+" 23:59:59";return new Date(t).getTime()-this.curTime<864e6},clarityStandards:{get(){return[this.clarityStandardsLower,this.clarityStandardsUpper]},set([t,e]){this.clarityStandardsLower=t,this.clarityStandardsUpper=e}}},beforeDestroy(){clearTimeout(this.memoryRoot),this.memoryRoot=null},props:["showSign","isStart","config"],components:{"v-sign":o,PswPop:l.a,DTooltip:c.a,ModeList:k}},T={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("ul",{staticClass:"conflict"},[n("li",[n("img",{staticStyle:{cursor:"pointer"},attrs:{src:r("94hp"),width:"186",alt:"迪英加"},on:{click:function(e){return t.$router.push("index")}}}),t._v(" "),t.user.is_test&&!t.isNearExpires?n("div",{staticClass:"status",on:{mouseenter:function(e){t.showBuble=!0},mouseleave:function(e){t.showBuble=!1}}},[t._v("试用中")]):t._e(),t._v(" "),t.user.is_test&&t.isNearExpires?n("div",{staticClass:"statusNearExpire",on:{mouseenter:function(e){t.showBuble=!0},mouseleave:function(e){t.showBuble=!1}}},[t._v("试用即将到期，您可拨打400-8910357获取帮助")]):t._e(),t._v(" "),t.showBuble?n("div",{staticClass:"buble"},[t._v("试用到期时间："+t._s(t.user.time_out))]):t._e()]),t._v(" "),n("li",{staticClass:"header-username"},[n("a",{on:{click:function(e){return t.toogleHome()}}},[t._v(t._s(t.user.username+"@"+t.user.company)),n("em")]),t._v(" "),n("div",{staticClass:"stage",on:{click:function(e){t.showMemoryBox=!t.showMemoryBox}}},[n("img",{attrs:{src:r("i1en")}}),t._v("剩余存储   "),n("span",{class:{warnning:t.remainMemory<5}},[t._v(t._s(t.remainMemory)+"%")])]),t._v(" "),t.home?n("div",{staticClass:"home"},[n("ul",[n("li",{on:{click:function(e){return t.changePsw()}}},[t._v(t._s(t.$t("personal.password")))]),t._v(" "),n("li",{on:{click:function(e){return t.addImg()}}},[t._v(t._s(t.$t("personal.signature")))]),t._v(" "),"sa"==t.user.role||"admin"==t.user.role?n("li",{on:{click:t.backStage}},[t._v("后台管理")]):t._e(),t._v(" "),n("li",{on:{click:t.settingOpen}},[t._v("系统设置")]),t._v(" "),t.user.cloud?t._e():n("li",{on:{click:t.shutdown}},[t._v("关闭服务器")]),t._v(" "),t.user.cloud?t._e():n("li",{on:{click:t.reboot}},[t._v("重启服务器")]),t._v(" "),t.onTrial?n("li",{on:{click:t.showTrialMan}},[t._v("试用管理")]):t._e(),t._v(" "),n("li",{on:{click:t.quit}},[t._v(t._s(t.$t("personal.quit")))])])]):t._e()]),t._v(" "),n("br",{staticStyle:{clear:"both"}})]),t._v(" "),t.home?n("div",{staticClass:"home-bg",on:{click:function(e){return t.noBg()}}}):t._e(),t._v(" "),t.showSign?n("v-sign",{on:{close:t.closeSign}}):t._e(),t._v(" "),n("transition",{attrs:{name:"fade"}},[t.isChange?n("div",{staticClass:"delete"},[n("div",{staticClass:"ctn"},[n("div",{staticClass:"header"},[t._v("\n          "+t._s(t.$t("changepassword.title"))+"\n          "),n("span",{staticClass:"iconfont",on:{click:function(e){return t.qiutPsw()}}})]),t._v(" "),n("div",{staticClass:"content-psw"},[n("dl",{staticClass:"p40"},[n("dt",[t._v(t._s(t.$t("changepassword.oldpsw")))]),t._v(" "),n("dd",[n("input",{directives:[{name:"model",rawName:"v-model",value:t.oldPassword,expression:"oldPassword"}],staticClass:"pws-text",attrs:{name:"txtPassword",autocomplete:"off",type:"password"},domProps:{value:t.oldPassword},on:{input:function(e){e.target.composing||(t.oldPassword=e.target.value)}}}),t._v(" "),""==t.oldPassword?n("div",{staticClass:"point"},[t._v(t._s(t.$t("changepassword.remindoldpsw")))]):t._e()])]),t._v(" "),n("dl",{staticClass:"p12"},[n("dt",[t._v(t._s(t.$t("changepassword.newpsw")))]),t._v(" "),n("dd",[n("input",{directives:[{name:"model",rawName:"v-model",value:t.newPassword,expression:"newPassword"}],staticClass:"pws-text",class:{red:t.newPassword&&(t.newPassword==t.oldPassword||!t.reg.test(t.newPassword))},attrs:{name:"txtPassword1",autocomplete:"off",type:"password"},domProps:{value:t.newPassword},on:{input:function(e){e.target.composing||(t.newPassword=e.target.value)}}}),t._v(" "),t.newPassword?t._e():n("div",{staticClass:"point"},[t._v(t._s(t.$t("changepassword.remindnewpsw")))]),t._v(" "),t.newPassword&&!t.reg.test(t.newPassword)?n("div",{staticClass:"point",staticStyle:{color:"#f6472a"}},[t._v(t._s(t.$t("changepassword.remindnewpsw")))]):t._e(),t._v(" "),t.newPassword&&t.reg.test(t.newPassword)&&t.newPassword==t.oldPassword?n("div",{staticClass:"point",staticStyle:{color:"#f6472a"}},[t._v(t._s(t.$t("changepassword.pswconfirm")))]):t._e()])]),t._v(" "),n("dl",{staticClass:"p12"},[n("dt",[t._v(t._s(t.$t("changepassword.confirmpsw")))]),t._v(" "),n("dd",[n("input",{directives:[{name:"model",rawName:"v-model",value:t.newPasswordSure,expression:"newPasswordSure"}],staticClass:"pws-text",class:{red:""!=t.newPasswordSure&&t.newPasswordSure!=t.newPassword},attrs:{name:"txtPassword2",autocomplete:"off",type:"password"},domProps:{value:t.newPasswordSure},on:{input:function(e){e.target.composing||(t.newPasswordSure=e.target.value)}}}),t._v(" "),t.newPasswordSure?t._e():n("div",{staticClass:"point top40"},[t._v(t._s(t.$t("changepassword.remindconfirmpsw")))]),t._v(" "),t.newPasswordSure&&t.newPasswordSure!=t.newPassword?n("div",{staticClass:"point top40",staticStyle:{color:"#f6472a"}},[t._v(t._s(t.$t("changepassword.inconsistentpsw")))]):t._e()])])]),t._v(" "),n("div",{staticClass:"footer"},[n("button",{on:{click:function(e){return t.confirmPsw()}}},[t._v(t._s(t.$t("confirm.confirm")))]),t._v(" "),n("button",{staticClass:"currentSure",on:{click:function(e){return t.qiutPsw()}}},[t._v(t._s(t.$t("confirm.quit")))])])])]):t._e()]),t._v(" "),n("transition",{attrs:{name:"fade"}},[t.showSettingAIParam?n("div",{staticClass:"delete"},[n("div",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticClass:"param",class:{higher:t.curParam.all_use&&"pdl1"!=t.ajustType,"pdl1-box":"pdl1"==t.ajustType,"tct-box":t.params_tct_lct_dna_reg.test(t.ajustType),"tct-box-v2":t.params_tct_lct_reg.test(t.ajustType)},attrs:{"element-loading-text":"参数应用中…为确保数据安全，期间请勿关闭客户端和服务器","element-loading-background":"rgba(0, 0, 0, 0.8)"}},[n("div",{staticClass:"top-header"},[t._v("算法参数设置")]),t._v(" "),n("div",{staticClass:"center-header"},[n("div",{staticClass:"tips"},[t._v("通过调整参数可以改变AI判读倾向。应用成功后，AI将按照新参数标准进行，请谨慎操作！")]),t._v(" "),n("div",{staticClass:"tabs"},[n("div",{staticClass:"tabs-top"},[n("span",{class:{checked:"tct"===t.ajustType},on:{click:function(e){return e.stopPropagation(),t.changeTab("tct")}}},[t._v("TCT")]),t._v(" "),n("span",{class:{checked:"lct"===t.ajustType},on:{click:function(e){return e.stopPropagation(),t.changeTab("lct")}}},[t._v("LCT")]),t._v(" "),n("span",{class:{checked:"pdl1"===t.ajustType},on:{click:function(e){return e.stopPropagation(),t.changeTab("pdl1")}}},[t._v("PDL1")]),t._v(" "),n("span",{class:{checked:"dna"===t.ajustType},on:{click:function(e){return e.stopPropagation(),t.changeTab("dna")}}},[t._v("TBS+DNA")]),t._v(" "),n("span",{class:{checked:"dna_ploidy"===t.ajustType},on:{click:function(e){return e.stopPropagation(),t.changeTab("dna_ploidy")}}},[t._v("DNA倍体")])]),t._v(" "),"pdl1"===t.ajustType?n("div",[n("div",{staticClass:"tabs-content"},[n("div",{staticClass:"updown"},[t._v("\n                  拟合曲线\n                  "),t.smoothImg?n("div",{staticClass:"adjust"},[t._v("\n                    平滑度调整：\n                    "),n("button",{on:{click:function(e){return t.modifySmoothValue("plus")}}},[t._v("+")]),t._v(" "),n("button",{on:{click:function(e){return t.modifySmoothValue("reduce")}}},[t._v("-")])]):t._e(),t._v(" "),n("span",{on:{click:t.resetSmooth}},[t._v("恢复默认")]),t._v(" "),n("span",{on:{click:t.downloadTem}},[t._v("下载模版")]),t._v(" "),n("span",{staticClass:"upload-xls"},[t._v("\n                    上传调参依据\n                    "),n("input",{ref:"smoothfile",staticClass:"pdl1-file",attrs:{type:"file",accept:".xlsx,.xls"},on:{change:function(e){return t.imgPreview(e.currentTarget)}}})])]),t._v(" "),n("div",{staticClass:"img-box"},[t.smoothImg?n("img",{attrs:{src:t.smoothImg,alt:""}}):n("div",[n("div",{staticClass:"upload-box"}),t._v(" "),n("p",[t._v("请先上传调参依据")])])])]),t._v(" "),n("div",{staticClass:"tabs-bot"},["pdl1"===t.ajustType?n("el-checkbox",{model:{value:t.all_use,callback:function(e){t.all_use=e},expression:"all_use"}},[t._v("已处理切片也应用新参数")]):n("el-checkbox",{model:{value:t.curParam.all_use,callback:function(e){t.$set(t.curParam,"all_use",e)},expression:"curParam.all_use"}},[t._v("已处理切片也应用新参数")]),t._v(" "),n("span",{staticClass:"sec"},[t._v(t._s("（一旦开始无法中断，仅支持已处理的全场分析结果调参）"))]),t._v(" "),n("p",[t._v("勾选后，原AI结果可能被更改")])],1)]):"dna_ploidy"===t.ajustType?n("div",[n("div",{staticClass:"tabs-content"},[n("div",{staticClass:"reset",on:{click:t.resetDnaPloidy}},[t._v("恢复默认阈值")]),t._v(" "),n("div",{staticClass:"dna_ploidy_params params"},[n("el-row",{attrs:{type:"flex",align:"middle"}},[n("el-col",{attrs:{span:4}},[t._v("IOD比例")]),t._v(" "),n("el-col",{attrs:{span:20}},[n("el-input-number",{attrs:{precision:2,step:.01,max:.99,min:.01},model:{value:t.curParam.iod_ratio,callback:function(e){t.$set(t.curParam,"iod_ratio",e)},expression:"curParam.iod_ratio"}}),t._v(" "),n("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"阈值越高，检出细胞核的DI值越高。建议每次调整0.2幅度看效果",placement:"right","popper-class":"dna_ploidy_params-tooltip"}},[n("i",{staticClass:"el-icon-info el-icon dna_ploidy_params-icon"})])],1)],1),t._v(" "),n("el-row",{attrs:{type:"flex",align:"middle"}},[n("el-col",{attrs:{span:4}},[t._v("细胞置信度")]),t._v(" "),n("el-col",{attrs:{span:20}},[n("el-input-number",{attrs:{precision:2,step:.01,max:.99,min:.01},model:{value:t.curParam.conf_thres,callback:function(e){t.$set(t.curParam,"conf_thres",e)},expression:"curParam.conf_thres"}}),t._v(" "),n("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"阈值越高，细胞检出越少",placement:"right","popper-class":"dna_ploidy_params-tooltip"}},[n("i",{staticClass:"el-icon-info el-icon dna_ploidy_params-icon"})])],1)],1)],1)])]):t.params_tct_lct_reg.test(t.ajustType)?n("div",[n("div",{staticClass:"tabs-content"},[n("ModeList",{key:t.ajustType,attrs:{aiType:t.ajustType,modeId:t.modeId},on:{"update:modeId":function(e){t.modeId=e},"update:mode-id":function(e){t.modeId=e},getAiParams:t.getAiParams}}),t._v(" "),n("div",{staticClass:"item flex f-ai-c f-jc-sb",staticStyle:{padding:"0 18px"}},[n("div",{staticClass:"range",staticStyle:{margin:"0"}},[t._v("\n                  调参范围：\n                  "),n("el-radio",{attrs:{label:0},model:{value:t.curParam.threshold_range,callback:function(e){t.$set(t.curParam,"threshold_range",e)},expression:"curParam.threshold_range"}},[t._v("阴性和ASC-US、ASC-H切片")]),t._v(" "),n("el-radio",{attrs:{label:1},model:{value:t.curParam.threshold_range,callback:function(e){t.$set(t.curParam,"threshold_range",e)},expression:"curParam.threshold_range"}},[t._v("所有类型切片")])],1),t._v(" "),n("div",{staticClass:"reset",staticStyle:{position:"static"},on:{click:t.seset}},[t._v("恢复默认阈值")])]),t._v(" "),n("div",{staticClass:"block"},[n("div",{staticClass:"word",style:{left:"calc("+t.curParam.threshold_value+"% - 18px)"}},[t._v(t._s(t.curParam.threshold_value/100))]),t._v(" "),n("el-slider",{attrs:{"show-tooltip":!1},on:{change:t.barChange},model:{value:t.curParam.threshold_value,callback:function(e){t.$set(t.curParam,"threshold_value",e)},expression:"curParam.threshold_value"}}),t._v(" "),t.curParam.threshold_range?n("div",{staticClass:"tot long",style:{left:"calc("+t.curParam.threshold_value+"% - 63px)"}},[n("p",[t._v("阴性 "+t._s((100*t.analyseThreshold.ratio.NILM).toFixed(2))+"%")]),t._v(" "),n("p",[t._v("ASC-US "+t._s((100*t.analyseThreshold.ratio["ASC-US"]).toFixed(2))+"%")]),t._v(" "),n("p",[t._v("ASC-H "+t._s((100*t.analyseThreshold.ratio["ASC-H"]).toFixed(2))+"%")]),t._v(" "),n("p",[t._v("AGC "+t._s((100*t.analyseThreshold.ratio.AGC).toFixed(2))+"%")]),t._v(" "),n("p",[t._v("HSIL "+t._s((100*t.analyseThreshold.ratio.HSIL).toFixed(2))+"%")]),t._v(" "),n("p",[t._v("LSIL "+t._s((100*t.analyseThreshold.ratio.LSIL).toFixed(2))+"%")])]):n("div",{staticClass:"tot",style:{left:"calc("+t.curParam.threshold_value+"% - 63px)"}},[n("p",[t._v("阴性 "+t._s((100*t.analyseThreshold.ratio.NILM).toFixed(2))+"%")]),t._v(" "),n("p",[t._v("ASC-US "+t._s((100*t.analyseThreshold.ratio["ASC-US"]).toFixed(2))+"%")]),t._v(" "),n("p",[t._v("ASC-H "+t._s((100*t.analyseThreshold.ratio["ASC-H"]).toFixed(2))+"%")])])],1),t._v(" "),n("div",{staticClass:"end"},[n("span",[t._v(t._s(t.curParam.threshold_range?"阳性检出更多,阴性检出更少":"ASC-US、ASC-H检出更多，阴性检出更少"))]),t._v(" "),n("span",[t._v(t._s(t.curParam.threshold_range?"阳性检出更少,阴性检出更多":"ASC-US、ASC-H检出更少，阴性检出更多"))])]),t._v(" "),n("div",{staticClass:"params"},[n("div",{staticClass:"params-item"},[t._v("\n                    细胞置信度阈值：\n                    "),t._l(Math.ceil(t.cell_conf_colums.length/4),function(e){return n("el-row",{key:e,attrs:{type:"flex",align:"middle"}},t._l(t.cell_conf_colums.slice(4*(e-1),4*e),function(e){return n("el-col",{key:e,staticClass:"flex f-ai-c",attrs:{span:6}},[n("el-col",{attrs:{span:8}},[t._v(t._s(e))]),t._v(" "),n("el-col",{attrs:{span:16}},[n("el-input-number",{attrs:{precision:2,step:.01,max:.99,min:.01},model:{value:t.curParam.cell_conf[e],callback:function(n){t.$set(t.curParam.cell_conf,e,n)},expression:"curParam.cell_conf[conf]"}})],1)],1)}),1)})],2),t._v(" "),n("div",{staticClass:"params-item"},[t._v("\n                    高于阈值数量则提示：\n                    "),n("div",{staticClass:"checkboxs"},[n("el-checkbox",{model:{value:t.curParam.microbe,callback:function(e){t.$set(t.curParam,"microbe",e)},expression:"curParam.microbe"}},[t._v("微生物")]),t._v(" "),n("el-checkbox",{model:{value:t.curParam.other,callback:function(e){t.$set(t.curParam,"other",e)},expression:"curParam.other"}},[t._v("其他生物")])],1),t._v(" "),t._l(Math.ceil(t.cell_num_colums.length/4),function(e){return n("el-row",{key:e,attrs:{type:"flex",align:"middle"}},t._l(t.cell_num_colums.slice(4*(e-1),4*e),function(e){return n("el-col",{key:e,staticClass:"flex f-ai-c",attrs:{span:6}},[n("el-col",{attrs:{span:8}},[t._v(t._s(e))]),t._v(" "),n("el-col",{attrs:{span:16}},[n("el-input-number",{attrs:{precision:0,step:1,min:0,disabled:t.num_input_disabled_list.includes(e)},model:{value:t.curParam.cell_num[e],callback:function(n){t.$set(t.curParam.cell_num,e,n)},expression:"curParam.cell_num[num]"}})],1)],1)}),1)})],2),t._v(" "),n("div",{staticClass:"params-item"},[n("el-row",{attrs:{type:"flex",align:"middle"}},[n("el-col",{staticClass:"flex f-ai-c",attrs:{span:8}},[n("el-col",{attrs:{span:12}},[t._v("合格细胞量")]),t._v(" "),n("el-col",{attrs:{span:12}},[n("el-input-number",{attrs:{precision:0,step:1,min:0},model:{value:t.curParam.qc_cell_num,callback:function(e){t.$set(t.curParam,"qc_cell_num",e)},expression:"curParam.qc_cell_num"}})],1)],1),t._v(" "),n("el-col",{staticClass:"flex f-ai-c",attrs:{span:8}},[n("el-col",{attrs:{span:12}},[t._v("阳性细胞"+t._s("<")+"则判阴  ")]),t._v(" "),n("el-col",{attrs:{span:12}},[n("el-input-number",{attrs:{precision:0,step:1,min:-1},model:{value:t.curParam.min_pos_cell,callback:function(e){t.$set(t.curParam,"min_pos_cell",e)},expression:"curParam.min_pos_cell"}})],1)],1)],1)],1)])],1),t._v(" "),n("div",{staticClass:"tabs-bot"},[n("el-checkbox",{model:{value:t.curParam.all_use,callback:function(e){t.$set(t.curParam,"all_use",e)},expression:"curParam.all_use"}},[t._v("已处理切片也应用新参数")]),t._v(" "),n("span",{staticClass:"sec"},[t._v(t._s("（预计耗时"+t.analyseThreshold.num_slide+"秒，一旦开始无法中断）"))]),t._v(" "),n("DTooltip",{attrs:{content:"勾选后，原AI结果可能被更改"}},[n("img",{staticStyle:{width:"16px","vertical-align":"bottom"},attrs:{src:r("XA3p")}})]),t._v(" "),t.curParam.all_use?n("div",{staticClass:"tct-radios"},[n("el-radio",{attrs:{label:1},model:{value:t.curParam.slice_range,callback:function(e){t.$set(t.curParam,"slice_range",e)},expression:"curParam.slice_range"}},[t._v("所有已处理切片")]),t._v(" "),n("el-radio",{attrs:{label:0},model:{value:t.curParam.slice_range,callback:function(e){t.$set(t.curParam,"slice_range",e)},expression:"curParam.slice_range"}},[t._v("列表筛选结果的已处理切片")])],1):t._e(),t._v(" "),t.curParam.all_use?n("div",{staticClass:"c-res"},[n("h2",[t._v("应用结果预览：")]),t._v(" "),n("ul",[n("li",[n("h3",[t._v("敏感性："+t._s((100*t.analyseThreshold.sensitivity).toFixed(2))+"%")]),t._v(" "),n("h3",[t._v("敏感性(不含ASC-US)："+t._s((100*t.analyseThreshold.sensitivity_plus).toFixed(2))+"%")]),t._v(" "),n("h3",[t._v("特异性："+t._s((100*t.analyseThreshold.specificity).toFixed(2))+"%")])]),t._v(" "),n("li",[n("h3",[n("span",[t._v("总数（已处理）："+t._s(t.analyseThreshold.count.sum))])]),t._v(" "),n("div",{staticClass:"flex f-fw-w"},[n("h3",[t._v("阴性："+t._s(t.analyseThreshold.count.NILM))]),t._v(" "),n("h3",[t._v("HSIL："+t._s(t.analyseThreshold.count.HSIL))]),t._v(" "),n("h3",[t._v("ASC-H："+t._s(t.analyseThreshold.count["ASC-H"]))]),t._v(" "),n("h3",[t._v("LSIL："+t._s(t.analyseThreshold.count.LSIL))]),t._v(" "),n("h3",[t._v("ASC-US："+t._s(t.analyseThreshold.count["ASC-US"]))]),t._v(" "),n("h3",[t._v("AGC："+t._s(t.analyseThreshold.count.AGC))])])]),t._v(" "),n("li",[n("h3",[n("span",[t._v("AI漏阳总数："+t._s(t.analyseThreshold.fn.sum))])]),t._v(" "),n("div",{staticClass:"flex f-fw-w"},[n("h3",[t._v("HSIL："+t._s(t.analyseThreshold.fn.HSIL))]),t._v(" "),n("h3",[t._v("ASC-H："+t._s(t.analyseThreshold.fn["ASC-H"]))]),t._v(" "),n("h3",[t._v("LSIL："+t._s(t.analyseThreshold.fn.LSIL))]),t._v(" "),n("h3",[t._v("ASC-US："+t._s(t.analyseThreshold.fn["ASC-US"]))]),t._v(" "),n("h3",[t._v("AGC："+t._s(t.analyseThreshold.fn.AGC))])])])]),t._v(" "),n("div",{staticStyle:{"padding-top":"12px"}},[n("h4",[t._v("为使预览结果准确，请：1. 等待所有切片完成判读   2. 确保所有切片的"),n("span",{staticClass:"sec"},[t._v("医院标签正确填入复核结果栏。")]),n("span",{staticClass:"sec"},[t._v("当前已复核总数为"+t._s(t.analyseThreshold.num_manual)+"。")])])])]):t._e()],1)]):t.params_tct_lct_dna_reg.test(t.ajustType)?n("div",[n("div",{staticClass:"tabs-content"},[n("div",{staticClass:"reset",on:{click:t.seset}},[t._v("恢复默认阈值")]),t._v(" "),n("div",{staticClass:"range"},[t._v("\n                  调参范围：\n                  "),n("el-radio",{attrs:{label:0},model:{value:t.curParam.threshold_range,callback:function(e){t.$set(t.curParam,"threshold_range",e)},expression:"curParam.threshold_range"}},[t._v("阴性和ASC-US、ASC-H切片")]),t._v(" "),n("el-radio",{attrs:{label:1},model:{value:t.curParam.threshold_range,callback:function(e){t.$set(t.curParam,"threshold_range",e)},expression:"curParam.threshold_range"}},[t._v("所有类型切片")])],1),t._v(" "),n("div",{staticClass:"block"},[n("div",{staticClass:"word",style:{left:"calc("+t.curParam.threshold_value+"% - 18px)"}},[t._v(t._s(t.curParam.threshold_value/100))]),t._v(" "),n("el-slider",{attrs:{"show-tooltip":!1},on:{change:t.barChange},model:{value:t.curParam.threshold_value,callback:function(e){t.$set(t.curParam,"threshold_value",e)},expression:"curParam.threshold_value"}}),t._v(" "),t.curParam.threshold_range?n("div",{staticClass:"tot long",style:{left:"calc("+t.curParam.threshold_value+"% - 63px)"}},[n("p",[t._v("阴性 "+t._s((100*t.analyseThreshold.ratio.NILM).toFixed(2))+"%")]),t._v(" "),n("p",[t._v("ASC-US "+t._s((100*t.analyseThreshold.ratio["ASC-US"]).toFixed(2))+"%")]),t._v(" "),n("p",[t._v("ASC-H "+t._s((100*t.analyseThreshold.ratio["ASC-H"]).toFixed(2))+"%")]),t._v(" "),n("p",[t._v("AGC "+t._s((100*t.analyseThreshold.ratio.AGC).toFixed(2))+"%")]),t._v(" "),n("p",[t._v("HSIL "+t._s((100*t.analyseThreshold.ratio.HSIL).toFixed(2))+"%")]),t._v(" "),n("p",[t._v("LSIL "+t._s((100*t.analyseThreshold.ratio.LSIL).toFixed(2))+"%")])]):n("div",{staticClass:"tot",style:{left:"calc("+t.curParam.threshold_value+"% - 63px)"}},[n("p",[t._v("阴性 "+t._s((100*t.analyseThreshold.ratio.NILM).toFixed(2))+"%")]),t._v(" "),n("p",[t._v("ASC-US "+t._s((100*t.analyseThreshold.ratio["ASC-US"]).toFixed(2))+"%")]),t._v(" "),n("p",[t._v("ASC-H "+t._s((100*t.analyseThreshold.ratio["ASC-H"]).toFixed(2))+"%")])])],1),t._v(" "),n("div",{staticClass:"end"},[n("span",[t._v(t._s(t.curParam.threshold_range?"阳性检出更多,阴性检出更少":"ASC-US、ASC-H检出更多，阴性检出更少"))]),t._v(" "),n("span",[t._v(t._s(t.curParam.threshold_range?"阳性检出更少,阴性检出更多":"ASC-US、ASC-H检出更少，阴性检出更多"))])]),t._v(" "),n("div",{staticClass:"params"},[n("div",{staticClass:"params-item"},[t._v("\n                    细胞置信度阈值：\n                    "),t._l(Math.ceil(t.cell_conf_colums.length/4),function(e){return n("el-row",{key:e,attrs:{type:"flex",align:"middle"}},t._l(t.cell_conf_colums.slice(4*(e-1),4*e),function(e){return n("el-col",{key:e,staticClass:"flex f-ai-c",attrs:{span:6}},[n("el-col",{attrs:{span:8}},[t._v(t._s(e))]),t._v(" "),n("el-col",{attrs:{span:16}},[n("el-input-number",{attrs:{precision:2,step:.01,max:.99,min:.01},model:{value:t.curParam.cell_conf[e],callback:function(n){t.$set(t.curParam.cell_conf,e,n)},expression:"curParam.cell_conf[conf]"}})],1)],1)}),1)})],2),t._v(" "),n("div",{staticClass:"params-item"},[t._v("\n                    高于阈值数量则提示：\n                    "),t._l(Math.ceil(t.cell_num_colums.length/4),function(e){return n("el-row",{key:e,attrs:{type:"flex",align:"middle"}},t._l(t.cell_num_colums.slice(4*(e-1),4*e),function(e){return n("el-col",{key:e,staticClass:"flex f-ai-c",attrs:{span:6}},[n("el-col",{attrs:{span:8}},[t._v(t._s(e))]),t._v(" "),n("el-col",{attrs:{span:16}},[n("el-input-number",{attrs:{precision:0,step:1,min:0},model:{value:t.curParam.cell_num[e],callback:function(n){t.$set(t.curParam.cell_num,e,n)},expression:"curParam.cell_num[num]"}})],1)],1)}),1)})],2),t._v(" "),n("div",{staticClass:"params-item"},[n("el-row",{attrs:{type:"flex",align:"middle"}},[n("el-col",{staticClass:"flex f-ai-c",attrs:{span:8}},[n("el-col",{attrs:{span:12}},[t._v("合格细胞量")]),t._v(" "),n("el-col",{attrs:{span:12}},[n("el-input-number",{attrs:{precision:0,step:1,min:0},model:{value:t.curParam.qc_cell_num,callback:function(e){t.$set(t.curParam,"qc_cell_num",e)},expression:"curParam.qc_cell_num"}})],1)],1),t._v(" "),n("el-col",{staticClass:"flex f-ai-c",attrs:{span:8}},[n("el-col",{attrs:{span:12}},[t._v("阳性细胞"+t._s("<")+"则判阴  ")]),t._v(" "),n("el-col",{attrs:{span:12}},[n("el-input-number",{attrs:{precision:0,step:1,min:-1},model:{value:t.curParam.min_pos_cell,callback:function(e){t.$set(t.curParam,"min_pos_cell",e)},expression:"curParam.min_pos_cell"}})],1)],1)],1)],1)])]),t._v(" "),n("div",{staticClass:"tabs-bot"},[n("el-checkbox",{model:{value:t.curParam.all_use,callback:function(e){t.$set(t.curParam,"all_use",e)},expression:"curParam.all_use"}},[t._v("已处理切片也应用新参数")]),t._v(" "),n("span",{staticClass:"sec"},[t._v(t._s("（预计耗时"+t.analyseThreshold.num_slide+"秒，一旦开始无法中断）"))]),t._v(" "),n("DTooltip",{attrs:{content:"勾选后，原AI结果可能被更改"}},[n("img",{staticStyle:{width:"16px","vertical-align":"bottom"},attrs:{src:r("XA3p")}})]),t._v(" "),t.curParam.all_use?n("div",{staticClass:"tct-radios"},[n("el-radio",{attrs:{label:1},model:{value:t.curParam.slice_range,callback:function(e){t.$set(t.curParam,"slice_range",e)},expression:"curParam.slice_range"}},[t._v("所有已处理切片")]),t._v(" "),n("el-radio",{attrs:{label:0},model:{value:t.curParam.slice_range,callback:function(e){t.$set(t.curParam,"slice_range",e)},expression:"curParam.slice_range"}},[t._v("列表筛选结果的已处理切片")])],1):t._e(),t._v(" "),t.curParam.all_use?n("div",{staticClass:"c-res"},[n("h2",[t._v("应用结果预览：")]),t._v(" "),n("ul",[n("li",[n("h3",[t._v("敏感性："+t._s((100*t.analyseThreshold.sensitivity).toFixed(2))+"%")]),t._v(" "),n("h3",[t._v("敏感性(不含ASC-US)："+t._s((100*t.analyseThreshold.sensitivity_plus).toFixed(2))+"%")]),t._v(" "),n("h3",[t._v("特异性："+t._s((100*t.analyseThreshold.specificity).toFixed(2))+"%")])]),t._v(" "),n("li",[n("h3",[n("span",[t._v("总数（已处理）："+t._s(t.analyseThreshold.count.sum))])]),t._v(" "),n("div",{staticClass:"flex f-fw-w"},[n("h3",[t._v("阴性："+t._s(t.analyseThreshold.count.NILM))]),t._v(" "),n("h3",[t._v("HSIL："+t._s(t.analyseThreshold.count.HSIL))]),t._v(" "),n("h3",[t._v("ASC-H："+t._s(t.analyseThreshold.count["ASC-H"]))]),t._v(" "),n("h3",[t._v("LSIL："+t._s(t.analyseThreshold.count.LSIL))]),t._v(" "),n("h3",[t._v("ASC-US："+t._s(t.analyseThreshold.count["ASC-US"]))]),t._v(" "),n("h3",[t._v("AGC："+t._s(t.analyseThreshold.count.AGC))])])]),t._v(" "),n("li",[n("h3",[n("span",[t._v("AI漏阳总数："+t._s(t.analyseThreshold.fn.sum))])]),t._v(" "),n("div",{staticClass:"flex f-fw-w"},[n("h3",[t._v("HSIL："+t._s(t.analyseThreshold.fn.HSIL))]),t._v(" "),n("h3",[t._v("ASC-H："+t._s(t.analyseThreshold.fn["ASC-H"]))]),t._v(" "),n("h3",[t._v("LSIL："+t._s(t.analyseThreshold.fn.LSIL))]),t._v(" "),n("h3",[t._v("ASC-US："+t._s(t.analyseThreshold.fn["ASC-US"]))]),t._v(" "),n("h3",[t._v("AGC："+t._s(t.analyseThreshold.fn.AGC))])])])]),t._v(" "),n("div",{staticStyle:{"padding-top":"12px"}},[n("h4",[t._v("为使预览结果准确，请：1. 等待所有切片完成判读   2. 确保所有切片的"),n("span",{staticClass:"sec"},[t._v("医院标签正确填入复核结果栏。")]),n("span",{staticClass:"sec"},[t._v("当前已复核总数为"+t._s(t.analyseThreshold.num_manual)+"。")])])])]):t._e()],1)]):t._e()])]),t._v(" "),n("div",{staticClass:"top-footer"},[t.params_tct_lct_dna_reg.test(t.ajustType)&&t.curParam.all_use?n("span",{staticClass:"apply",on:{click:function(e){return t.apply()}}},[t._v("保存并应用")]):t.params_tct_lct_dna_reg.test(t.ajustType)&&!t.curParam.all_use?n("span",{staticClass:"apply",on:{click:function(e){return t.apply()}}},[t._v("保存")]):n("span",{staticClass:"apply",on:{click:function(e){return t.apply()}}},[t._v("应用")]),t._v(" "),n("span",{on:{click:function(e){return t.cancel()}}},[t._v("取消")])])])]):t._e()]),t._v(" "),n("transition",{attrs:{name:"fade"}},[t.showTrial?n("div",{staticClass:"setting trialctn"},[n("div",{staticClass:"header"},[t._v("\n          账号试用中\n          "),n("span",{staticClass:"iconfont",on:{click:function(e){t.showTrial=!1}}})]),t._v(" "),n("div",{staticClass:"trial"},[n("div",{staticClass:"msg"},[t._v("各算法模块有使用次数限制，可用次数耗尽将无法试用。")]),t._v(" "),n("table",[n("tr",[n("th",[t._v("算法模块")]),n("th",[t._v("可用次数")])]),t._v(" "),t._l(t.trialTimes,function(e){return n("tr",{key:e.key},[n("td",[t._v(t._s(e.key))]),n("td",[t._v(t._s(e.times))])])})],2)]),t._v(" "),n("div",{staticClass:"footer"},[n("button",{staticClass:"save",on:{click:function(e){t.showTrial=!1}}},[t._v("关闭")])])]):t._e()]),t._v(" "),n("transition",{attrs:{name:"fade"}},[t.showSetting?n("div",{staticClass:"zhezao"},[n("div",{staticClass:"setting ossetting"},[n("div",{staticClass:"header"},[t._v("\n          系统设置\n          "),n("span",{staticClass:"iconfont",on:{click:function(e){t.showSetting=!1}}})]),t._v(" "),n("div",{staticClass:"content-setting"},[n("div",{staticClass:"regn regn-hidden"},[t._v("切片标签识别\n            "),n("img",{attrs:{src:r("XA3p"),alt:""},on:{mouseenter:function(e){t.showMsg=!0},mouseleave:function(e){t.showMsg=!1}}}),t._v(" "),t.showMsg?n("span",[t._v("切片上传后自动识别，识别成功结果将保存为切片编号")]):t._e()]),t._v(" "),n("el-radio-group",{model:{value:t.labelcheck,callback:function(e){t.labelcheck=e},expression:"labelcheck"}},[n("el-radio",{attrs:{label:4}},[t._v("OCR识别")]),t._v(" "),n("el-radio",{attrs:{label:2}},[t._v("识别条形码")]),t._v(" "),n("el-radio",{attrs:{label:3}},[t._v("识别二维码")]),t._v(" "),n("el-radio",{attrs:{label:1}},[t._v("不识别")])],1),t._v(" "),n("div",{staticClass:"regn"},[t._v("演示模式\n            "),n("img",{attrs:{src:r("XA3p"),alt:""},on:{mouseenter:function(e){t.showTipTxt=!0},mouseleave:function(e){t.showTipTxt=!1}}}),t._v(" "),t.showTipTxt?n("span",{staticClass:"tip-txt"},[t._v("演示模式下，病例详情页可最小化，支持多标签切换浏览，但不支持切换病例（上/下一个）。")]):t._e()]),t._v(" "),n("div",{staticClass:"switch-btn"},[n("el-switch",{on:{change:t.changeMode},model:{value:t.demoModeValue,callback:function(e){t.demoModeValue=e},expression:"demoModeValue"}})],1),t._v(" "),t.config&&t.config.zeiss?n("div",[n("div",{staticClass:"regn"},[t._v("载物平台移动补偿\n              "),n("img",{attrs:{src:r("XA3p"),alt:""},on:{mouseenter:function(e){t.showTips=!0},mouseleave:function(e){t.showTips=!1}}}),t._v(" "),t.showTips?n("span",{staticClass:"tip-txt new-tip"},[t._v("当平台移动后的镜下视野与全场图位置有偏差时，可通过配置X Y Z轴偏差值来补偿矫正")]):t._e()]),t._v(" "),n("div",[t._v("\n              X："),n("el-input",{staticClass:"pos-rad",model:{value:t.correctData.x,callback:function(e){t.$set(t.correctData,"x",e)},expression:"correctData.x"}}),t._v("\n              Y："),n("el-input",{staticClass:"pos-rad",model:{value:t.correctData.y,callback:function(e){t.$set(t.correctData,"y",e)},expression:"correctData.y"}}),t._v("\n              Z："),n("el-input",{staticClass:"pos-rad",model:{value:t.correctData.z,callback:function(e){t.$set(t.correctData,"z",e)},expression:"correctData.z"}})],1)]):t._e(),t._v(" "),n("div",[n("div",{staticClass:"regn"},[t._v("\n              切片清晰度标准\n              "),n("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"调整清晰度较差、中等、良好的判断标准",placement:"right","popper-class":"__regn-tips"}},[n("img",{attrs:{src:r("XA3p")}})])],1),t._v(" "),n("div",{staticClass:"slider-wrapper flex f-ai-c f-jc-c"},[n("el-slider",{staticStyle:{width:"320px"},attrs:{range:"","format-tooltip":function(t){return Math.round(100*(t||0))+"%"},max:1,step:.01,marks:{0:"较差",1:"良好"}},model:{value:t.clarityStandards,callback:function(e){t.clarityStandards=e},expression:"clarityStandards"}})],1)]),t._v(" "),n("div",{staticClass:"regn"},[t._v("算法调参")]),t._v(" "),n("div",{staticClass:"btn",on:{click:function(e){return t.setType("param")}}},[t._v("算法参数设置")]),t._v(" "),t.electron?n("div",{staticClass:"regn"},[t._v("控制台")]):t._e(),t._v(" "),t.electron?n("div",{staticClass:"btn",on:{click:function(e){return t.setType("control")}}},[t._v("进入控制台")]):t._e()],1),t._v(" "),n("div",{staticClass:"footer"},[n("button",{staticClass:"save",on:{click:t.orcSave}},[t._v("保存")]),t._v(" "),n("button",{on:{click:function(e){t.showSetting=!1}}},[t._v(t._s(t.$t("confirm.quit")))])])])]):t._e()]),t._v(" "),n("transition",{attrs:{name:"fade"}},[t.showSetPsw?n("PswPop",{attrs:{title:"该功能仅限授权人员访问",setPsw:t.setPsw,showTip:t.showTip},on:{confirmBtn:t.openSeting,cancelBtn:function(e){t.showSetPsw=!1}}}):t._e()],1),t._v(" "),n("transition",{attrs:{name:"fade"}},[t.showMemoryBox?n("div",{staticClass:"zhezao"},[n("div",{staticClass:"setting me-contetn"},[n("div",{staticClass:"header"},[t._v("\n            存储空间管理\n            "),n("span",{staticClass:"iconfont",on:{click:function(e){t.showMemoryBox=!1}}})]),t._v(" "),n("div",{staticClass:"content-setting"},[n("div",{staticClass:"progress"},[n("div",{staticClass:"per"},[n("div",{staticClass:"used-memory",class:{warnning:t.remainMemory<5},style:{width:100-t.remainMemory+"%"}})]),t._v("\n              当前剩余 "),n("span",{class:{warnning:t.remainMemory<5}},[t._v(t._s(t.remainMemory)+"%")]),t._v(" 可用\n            ")]),t._v(" "),n("p",{staticClass:"gray"},[t._v("系统每小时校准一次文件占用空间，入进行大批量数据删除，请稍后再查看。")]),t._v(" "),n("p",{staticClass:"gray"},[t._v("服务器存储空间不足时将无法上传新的切片，建议删除病例切片腾出空间，也可以拨打客服热线400-8910357申请增加磁盘空间。")]),t._v(" "),n("div",{staticClass:"memorydiv"},[t._v("删除"),n("el-date-picker",{attrs:{type:"date","picker-options":t.pickerOptions},on:{change:t.timeChange},model:{value:t.clearTime,callback:function(e){t.clearTime=e},expression:"clearTime"}}),t._v("之前创建的所有病例（含切片、附件）")],1),t._v(" "),n("div",{staticClass:"memorydiv"},[t._v("共 "+t._s(t.recordCount)+" 条病例")])]),t._v(" "),n("div",{staticClass:"footer"},[n("button",{staticClass:"save",on:{click:t.clearCase}},[t._v("删除")]),t._v(" "),n("button",{on:{click:function(e){t.showMemoryBox=!1}}},[t._v(t._s(t.$t("confirm.quit")))])])])]):t._e()])],1)},staticRenderFns:[]};var S=r("VU/8")(P,T,!1,function(t){r("F5RR"),r("aJOx")},"data-v-6a25fe10",null);n.a=S.exports},KaQe:function(t,e,n){"use strict";var r=n("aMwW"),i={name:"d-toolip",mixins:[n.n(r).a],components:{},props:{},data:()=>({}),computed:{},methods:{},render(t){this.popperVM&&(this.popperVM.node=t("transition",{attrs:{name:this.transition},on:{afterLeave:this.doDestroy}},[t("div",{on:{mouseleave:()=>{this.setExpectedState(!1),this.debounceClose()},mouseenter:()=>{this.setExpectedState(!0)}},ref:"popper",attrs:{role:"tooltip",id:this.tooltipId,"aria-hidden":this.disabled||!this.showPopper?"true":"false"},directives:[{name:"show",value:!this.disabled&&this.showPopper}],class:["el-tooltip__popper","is-"+this.effect,this.popperClass,"__component__d-toolip__popper"]},[this.$slots.content||this.content])]));const e=this.getFirstElement();if(!e)return null;const n=e.data=e.data||{};return n.staticClass=this.addTooltipClass(n.staticClass),e}};var s=n("VU/8")(i,null,!1,function(t){n("iP0Q"),n("FfyW")},"data-v-0620e923",null);e.a=s.exports},LC74:function(t,e){"function"==typeof Object.create?t.exports=function(t,e){t.super_=e,t.prototype=Object.create(e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}})}:t.exports=function(t,e){t.super_=e;var n=function(){};n.prototype=e.prototype,t.prototype=new n,t.prototype.constructor=t}},M4fF:function(t,e,n){(function(t,r){var i;
/**
 * @license
 * Lodash <https://lodash.com/>
 * Copyright JS Foundation and other contributors <https://js.foundation/>
 * Released under MIT license <https://lodash.com/license>
 * Based on Underscore.js 1.8.3 <http://underscorejs.org/LICENSE>
 * Copyright Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
 */(function(){var s,a=200,o="Unsupported core-js use. Try https://npms.io/search?q=ponyfill.",l="Expected a function",c="__lodash_hash_undefined__",u=500,h="__lodash_placeholder__",f=1,d=2,p=4,v=1,m=2,g=1,_=2,y=4,w=8,b=16,x=32,C=64,k=128,P=256,T=512,S=30,$="...",R=800,j=16,O=1,A=2,M=1/0,I=9007199254740991,L=1.7976931348623157e308,E=NaN,z=4294967295,D=z-1,N=z>>>1,F=[["ary",k],["bind",g],["bindKey",_],["curry",w],["curryRight",b],["flip",T],["partial",x],["partialRight",C],["rearg",P]],B="[object Arguments]",U="[object Array]",H="[object AsyncFunction]",q="[object Boolean]",V="[object Date]",W="[object DOMException]",G="[object Error]",J="[object Function]",X="[object GeneratorFunction]",Y="[object Map]",K="[object Number]",Z="[object Null]",Q="[object Object]",tt="[object Proxy]",et="[object RegExp]",nt="[object Set]",rt="[object String]",it="[object Symbol]",st="[object Undefined]",at="[object WeakMap]",ot="[object WeakSet]",lt="[object ArrayBuffer]",ct="[object DataView]",ut="[object Float32Array]",ht="[object Float64Array]",ft="[object Int8Array]",dt="[object Int16Array]",pt="[object Int32Array]",vt="[object Uint8Array]",mt="[object Uint8ClampedArray]",gt="[object Uint16Array]",_t="[object Uint32Array]",yt=/\b__p \+= '';/g,wt=/\b(__p \+=) '' \+/g,bt=/(__e\(.*?\)|\b__t\)) \+\n'';/g,xt=/&(?:amp|lt|gt|quot|#39);/g,Ct=/[&<>"']/g,kt=RegExp(xt.source),Pt=RegExp(Ct.source),Tt=/<%-([\s\S]+?)%>/g,St=/<%([\s\S]+?)%>/g,$t=/<%=([\s\S]+?)%>/g,Rt=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,jt=/^\w*$/,Ot=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,At=/[\\^$.*+?()[\]{}|]/g,Mt=RegExp(At.source),It=/^\s+|\s+$/g,Lt=/^\s+/,Et=/\s+$/,zt=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,Dt=/\{\n\/\* \[wrapped with (.+)\] \*/,Nt=/,? & /,Ft=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,Bt=/\\(\\)?/g,Ut=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,Ht=/\w*$/,qt=/^[-+]0x[0-9a-f]+$/i,Vt=/^0b[01]+$/i,Wt=/^\[object .+?Constructor\]$/,Gt=/^0o[0-7]+$/i,Jt=/^(?:0|[1-9]\d*)$/,Xt=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,Yt=/($^)/,Kt=/['\n\r\u2028\u2029\\]/g,Zt="\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff",Qt="\\xac\\xb1\\xd7\\xf7\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf\\u2000-\\u206f \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",te="[\\ud800-\\udfff]",ee="["+Qt+"]",ne="["+Zt+"]",re="\\d+",ie="[\\u2700-\\u27bf]",se="[a-z\\xdf-\\xf6\\xf8-\\xff]",ae="[^\\ud800-\\udfff"+Qt+re+"\\u2700-\\u27bfa-z\\xdf-\\xf6\\xf8-\\xffA-Z\\xc0-\\xd6\\xd8-\\xde]",oe="\\ud83c[\\udffb-\\udfff]",le="[^\\ud800-\\udfff]",ce="(?:\\ud83c[\\udde6-\\uddff]){2}",ue="[\\ud800-\\udbff][\\udc00-\\udfff]",he="[A-Z\\xc0-\\xd6\\xd8-\\xde]",fe="(?:"+se+"|"+ae+")",de="(?:"+he+"|"+ae+")",pe="(?:"+ne+"|"+oe+")"+"?",ve="[\\ufe0e\\ufe0f]?"+pe+("(?:\\u200d(?:"+[le,ce,ue].join("|")+")[\\ufe0e\\ufe0f]?"+pe+")*"),me="(?:"+[ie,ce,ue].join("|")+")"+ve,ge="(?:"+[le+ne+"?",ne,ce,ue,te].join("|")+")",_e=RegExp("['’]","g"),ye=RegExp(ne,"g"),we=RegExp(oe+"(?="+oe+")|"+ge+ve,"g"),be=RegExp([he+"?"+se+"+(?:['’](?:d|ll|m|re|s|t|ve))?(?="+[ee,he,"$"].join("|")+")",de+"+(?:['’](?:D|LL|M|RE|S|T|VE))?(?="+[ee,he+fe,"$"].join("|")+")",he+"?"+fe+"+(?:['’](?:d|ll|m|re|s|t|ve))?",he+"+(?:['’](?:D|LL|M|RE|S|T|VE))?","\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])","\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",re,me].join("|"),"g"),xe=RegExp("[\\u200d\\ud800-\\udfff"+Zt+"\\ufe0e\\ufe0f]"),Ce=/[a-z][A-Z]|[A-Z]{2,}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,ke=["Array","Buffer","DataView","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Map","Math","Object","Promise","RegExp","Set","String","Symbol","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap","_","clearTimeout","isFinite","parseInt","setTimeout"],Pe=-1,Te={};Te[ut]=Te[ht]=Te[ft]=Te[dt]=Te[pt]=Te[vt]=Te[mt]=Te[gt]=Te[_t]=!0,Te[B]=Te[U]=Te[lt]=Te[q]=Te[ct]=Te[V]=Te[G]=Te[J]=Te[Y]=Te[K]=Te[Q]=Te[et]=Te[nt]=Te[rt]=Te[at]=!1;var Se={};Se[B]=Se[U]=Se[lt]=Se[ct]=Se[q]=Se[V]=Se[ut]=Se[ht]=Se[ft]=Se[dt]=Se[pt]=Se[Y]=Se[K]=Se[Q]=Se[et]=Se[nt]=Se[rt]=Se[it]=Se[vt]=Se[mt]=Se[gt]=Se[_t]=!0,Se[G]=Se[J]=Se[at]=!1;var $e={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},Re=parseFloat,je=parseInt,Oe="object"==typeof t&&t&&t.Object===Object&&t,Ae="object"==typeof self&&self&&self.Object===Object&&self,Me=Oe||Ae||Function("return this")(),Ie="object"==typeof e&&e&&!e.nodeType&&e,Le=Ie&&"object"==typeof r&&r&&!r.nodeType&&r,Ee=Le&&Le.exports===Ie,ze=Ee&&Oe.process,De=function(){try{return ze&&ze.binding&&ze.binding("util")}catch(t){}}(),Ne=De&&De.isArrayBuffer,Fe=De&&De.isDate,Be=De&&De.isMap,Ue=De&&De.isRegExp,He=De&&De.isSet,qe=De&&De.isTypedArray;function Ve(t,e,n){switch(n.length){case 0:return t.call(e);case 1:return t.call(e,n[0]);case 2:return t.call(e,n[0],n[1]);case 3:return t.call(e,n[0],n[1],n[2])}return t.apply(e,n)}function We(t,e,n,r){for(var i=-1,s=null==t?0:t.length;++i<s;){var a=t[i];e(r,a,n(a),t)}return r}function Ge(t,e){for(var n=-1,r=null==t?0:t.length;++n<r&&!1!==e(t[n],n,t););return t}function Je(t,e){for(var n=null==t?0:t.length;n--&&!1!==e(t[n],n,t););return t}function Xe(t,e){for(var n=-1,r=null==t?0:t.length;++n<r;)if(!e(t[n],n,t))return!1;return!0}function Ye(t,e){for(var n=-1,r=null==t?0:t.length,i=0,s=[];++n<r;){var a=t[n];e(a,n,t)&&(s[i++]=a)}return s}function Ke(t,e){return!!(null==t?0:t.length)&&ln(t,e,0)>-1}function Ze(t,e,n){for(var r=-1,i=null==t?0:t.length;++r<i;)if(n(e,t[r]))return!0;return!1}function Qe(t,e){for(var n=-1,r=null==t?0:t.length,i=Array(r);++n<r;)i[n]=e(t[n],n,t);return i}function tn(t,e){for(var n=-1,r=e.length,i=t.length;++n<r;)t[i+n]=e[n];return t}function en(t,e,n,r){var i=-1,s=null==t?0:t.length;for(r&&s&&(n=t[++i]);++i<s;)n=e(n,t[i],i,t);return n}function nn(t,e,n,r){var i=null==t?0:t.length;for(r&&i&&(n=t[--i]);i--;)n=e(n,t[i],i,t);return n}function rn(t,e){for(var n=-1,r=null==t?0:t.length;++n<r;)if(e(t[n],n,t))return!0;return!1}var sn=fn("length");function an(t,e,n){var r;return n(t,function(t,n,i){if(e(t,n,i))return r=n,!1}),r}function on(t,e,n,r){for(var i=t.length,s=n+(r?1:-1);r?s--:++s<i;)if(e(t[s],s,t))return s;return-1}function ln(t,e,n){return e==e?function(t,e,n){var r=n-1,i=t.length;for(;++r<i;)if(t[r]===e)return r;return-1}(t,e,n):on(t,un,n)}function cn(t,e,n,r){for(var i=n-1,s=t.length;++i<s;)if(r(t[i],e))return i;return-1}function un(t){return t!=t}function hn(t,e){var n=null==t?0:t.length;return n?vn(t,e)/n:E}function fn(t){return function(e){return null==e?s:e[t]}}function dn(t){return function(e){return null==t?s:t[e]}}function pn(t,e,n,r,i){return i(t,function(t,i,s){n=r?(r=!1,t):e(n,t,i,s)}),n}function vn(t,e){for(var n,r=-1,i=t.length;++r<i;){var a=e(t[r]);a!==s&&(n=n===s?a:n+a)}return n}function mn(t,e){for(var n=-1,r=Array(t);++n<t;)r[n]=e(n);return r}function gn(t){return function(e){return t(e)}}function _n(t,e){return Qe(e,function(e){return t[e]})}function yn(t,e){return t.has(e)}function wn(t,e){for(var n=-1,r=t.length;++n<r&&ln(e,t[n],0)>-1;);return n}function bn(t,e){for(var n=t.length;n--&&ln(e,t[n],0)>-1;);return n}var xn=dn({"À":"A","Á":"A","Â":"A","Ã":"A","Ä":"A","Å":"A","à":"a","á":"a","â":"a","ã":"a","ä":"a","å":"a","Ç":"C","ç":"c","Ð":"D","ð":"d","È":"E","É":"E","Ê":"E","Ë":"E","è":"e","é":"e","ê":"e","ë":"e","Ì":"I","Í":"I","Î":"I","Ï":"I","ì":"i","í":"i","î":"i","ï":"i","Ñ":"N","ñ":"n","Ò":"O","Ó":"O","Ô":"O","Õ":"O","Ö":"O","Ø":"O","ò":"o","ó":"o","ô":"o","õ":"o","ö":"o","ø":"o","Ù":"U","Ú":"U","Û":"U","Ü":"U","ù":"u","ú":"u","û":"u","ü":"u","Ý":"Y","ý":"y","ÿ":"y","Æ":"Ae","æ":"ae","Þ":"Th","þ":"th","ß":"ss","Ā":"A","Ă":"A","Ą":"A","ā":"a","ă":"a","ą":"a","Ć":"C","Ĉ":"C","Ċ":"C","Č":"C","ć":"c","ĉ":"c","ċ":"c","č":"c","Ď":"D","Đ":"D","ď":"d","đ":"d","Ē":"E","Ĕ":"E","Ė":"E","Ę":"E","Ě":"E","ē":"e","ĕ":"e","ė":"e","ę":"e","ě":"e","Ĝ":"G","Ğ":"G","Ġ":"G","Ģ":"G","ĝ":"g","ğ":"g","ġ":"g","ģ":"g","Ĥ":"H","Ħ":"H","ĥ":"h","ħ":"h","Ĩ":"I","Ī":"I","Ĭ":"I","Į":"I","İ":"I","ĩ":"i","ī":"i","ĭ":"i","į":"i","ı":"i","Ĵ":"J","ĵ":"j","Ķ":"K","ķ":"k","ĸ":"k","Ĺ":"L","Ļ":"L","Ľ":"L","Ŀ":"L","Ł":"L","ĺ":"l","ļ":"l","ľ":"l","ŀ":"l","ł":"l","Ń":"N","Ņ":"N","Ň":"N","Ŋ":"N","ń":"n","ņ":"n","ň":"n","ŋ":"n","Ō":"O","Ŏ":"O","Ő":"O","ō":"o","ŏ":"o","ő":"o","Ŕ":"R","Ŗ":"R","Ř":"R","ŕ":"r","ŗ":"r","ř":"r","Ś":"S","Ŝ":"S","Ş":"S","Š":"S","ś":"s","ŝ":"s","ş":"s","š":"s","Ţ":"T","Ť":"T","Ŧ":"T","ţ":"t","ť":"t","ŧ":"t","Ũ":"U","Ū":"U","Ŭ":"U","Ů":"U","Ű":"U","Ų":"U","ũ":"u","ū":"u","ŭ":"u","ů":"u","ű":"u","ų":"u","Ŵ":"W","ŵ":"w","Ŷ":"Y","ŷ":"y","Ÿ":"Y","Ź":"Z","Ż":"Z","Ž":"Z","ź":"z","ż":"z","ž":"z","Ĳ":"IJ","ĳ":"ij","Œ":"Oe","œ":"oe","ŉ":"'n","ſ":"s"}),Cn=dn({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"});function kn(t){return"\\"+$e[t]}function Pn(t){return xe.test(t)}function Tn(t){var e=-1,n=Array(t.size);return t.forEach(function(t,r){n[++e]=[r,t]}),n}function Sn(t,e){return function(n){return t(e(n))}}function $n(t,e){for(var n=-1,r=t.length,i=0,s=[];++n<r;){var a=t[n];a!==e&&a!==h||(t[n]=h,s[i++]=n)}return s}function Rn(t,e){return"__proto__"==e?s:t[e]}function jn(t){var e=-1,n=Array(t.size);return t.forEach(function(t){n[++e]=t}),n}function On(t){var e=-1,n=Array(t.size);return t.forEach(function(t){n[++e]=[t,t]}),n}function An(t){return Pn(t)?function(t){var e=we.lastIndex=0;for(;we.test(t);)++e;return e}(t):sn(t)}function Mn(t){return Pn(t)?function(t){return t.match(we)||[]}(t):function(t){return t.split("")}(t)}var In=dn({"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"});var Ln=function t(e){var n,r=(e=null==e?Me:Ln.defaults(Me.Object(),e,Ln.pick(Me,ke))).Array,i=e.Date,Zt=e.Error,Qt=e.Function,te=e.Math,ee=e.Object,ne=e.RegExp,re=e.String,ie=e.TypeError,se=r.prototype,ae=Qt.prototype,oe=ee.prototype,le=e["__core-js_shared__"],ce=ae.toString,ue=oe.hasOwnProperty,he=0,fe=(n=/[^.]+$/.exec(le&&le.keys&&le.keys.IE_PROTO||""))?"Symbol(src)_1."+n:"",de=oe.toString,pe=ce.call(ee),ve=Me._,me=ne("^"+ce.call(ue).replace(At,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),ge=Ee?e.Buffer:s,we=e.Symbol,xe=e.Uint8Array,$e=ge?ge.allocUnsafe:s,Oe=Sn(ee.getPrototypeOf,ee),Ae=ee.create,Ie=oe.propertyIsEnumerable,Le=se.splice,ze=we?we.isConcatSpreadable:s,De=we?we.iterator:s,sn=we?we.toStringTag:s,dn=function(){try{var t=Ns(ee,"defineProperty");return t({},"",{}),t}catch(t){}}(),En=e.clearTimeout!==Me.clearTimeout&&e.clearTimeout,zn=i&&i.now!==Me.Date.now&&i.now,Dn=e.setTimeout!==Me.setTimeout&&e.setTimeout,Nn=te.ceil,Fn=te.floor,Bn=ee.getOwnPropertySymbols,Un=ge?ge.isBuffer:s,Hn=e.isFinite,qn=se.join,Vn=Sn(ee.keys,ee),Wn=te.max,Gn=te.min,Jn=i.now,Xn=e.parseInt,Yn=te.random,Kn=se.reverse,Zn=Ns(e,"DataView"),Qn=Ns(e,"Map"),tr=Ns(e,"Promise"),er=Ns(e,"Set"),nr=Ns(e,"WeakMap"),rr=Ns(ee,"create"),ir=nr&&new nr,sr={},ar=ua(Zn),or=ua(Qn),lr=ua(tr),cr=ua(er),ur=ua(nr),hr=we?we.prototype:s,fr=hr?hr.valueOf:s,dr=hr?hr.toString:s;function pr(t){if($o(t)&&!go(t)&&!(t instanceof _r)){if(t instanceof gr)return t;if(ue.call(t,"__wrapped__"))return ha(t)}return new gr(t)}var vr=function(){function t(){}return function(e){if(!So(e))return{};if(Ae)return Ae(e);t.prototype=e;var n=new t;return t.prototype=s,n}}();function mr(){}function gr(t,e){this.__wrapped__=t,this.__actions__=[],this.__chain__=!!e,this.__index__=0,this.__values__=s}function _r(t){this.__wrapped__=t,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=z,this.__views__=[]}function yr(t){var e=-1,n=null==t?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}function wr(t){var e=-1,n=null==t?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}function br(t){var e=-1,n=null==t?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}function xr(t){var e=-1,n=null==t?0:t.length;for(this.__data__=new br;++e<n;)this.add(t[e])}function Cr(t){var e=this.__data__=new wr(t);this.size=e.size}function kr(t,e){var n=go(t),r=!n&&mo(t),i=!n&&!r&&bo(t),s=!n&&!r&&!i&&Eo(t),a=n||r||i||s,o=a?mn(t.length,re):[],l=o.length;for(var c in t)!e&&!ue.call(t,c)||a&&("length"==c||i&&("offset"==c||"parent"==c)||s&&("buffer"==c||"byteLength"==c||"byteOffset"==c)||Ws(c,l))||o.push(c);return o}function Pr(t){var e=t.length;return e?t[xi(0,e-1)]:s}function Tr(t,e){return oa(rs(t),Lr(e,0,t.length))}function Sr(t){return oa(rs(t))}function $r(t,e,n){(n===s||fo(t[e],n))&&(n!==s||e in t)||Mr(t,e,n)}function Rr(t,e,n){var r=t[e];ue.call(t,e)&&fo(r,n)&&(n!==s||e in t)||Mr(t,e,n)}function jr(t,e){for(var n=t.length;n--;)if(fo(t[n][0],e))return n;return-1}function Or(t,e,n,r){return Fr(t,function(t,i,s){e(r,t,n(t),s)}),r}function Ar(t,e){return t&&is(e,il(e),t)}function Mr(t,e,n){"__proto__"==e&&dn?dn(t,e,{configurable:!0,enumerable:!0,value:n,writable:!0}):t[e]=n}function Ir(t,e){for(var n=-1,i=e.length,a=r(i),o=null==t;++n<i;)a[n]=o?s:Qo(t,e[n]);return a}function Lr(t,e,n){return t==t&&(n!==s&&(t=t<=n?t:n),e!==s&&(t=t>=e?t:e)),t}function Er(t,e,n,r,i,a){var o,l=e&f,c=e&d,u=e&p;if(n&&(o=i?n(t,r,i,a):n(t)),o!==s)return o;if(!So(t))return t;var h=go(t);if(h){if(o=function(t){var e=t.length,n=new t.constructor(e);return e&&"string"==typeof t[0]&&ue.call(t,"index")&&(n.index=t.index,n.input=t.input),n}(t),!l)return rs(t,o)}else{var v=Us(t),m=v==J||v==X;if(bo(t))return Ki(t,l);if(v==Q||v==B||m&&!i){if(o=c||m?{}:qs(t),!l)return c?function(t,e){return is(t,Bs(t),e)}(t,function(t,e){return t&&is(e,sl(e),t)}(o,t)):function(t,e){return is(t,Fs(t),e)}(t,Ar(o,t))}else{if(!Se[v])return i?t:{};o=function(t,e,n){var r,i,s,a=t.constructor;switch(e){case lt:return Zi(t);case q:case V:return new a(+t);case ct:return function(t,e){var n=e?Zi(t.buffer):t.buffer;return new t.constructor(n,t.byteOffset,t.byteLength)}(t,n);case ut:case ht:case ft:case dt:case pt:case vt:case mt:case gt:case _t:return Qi(t,n);case Y:return new a;case K:case rt:return new a(t);case et:return(s=new(i=t).constructor(i.source,Ht.exec(i))).lastIndex=i.lastIndex,s;case nt:return new a;case it:return r=t,fr?ee(fr.call(r)):{}}}(t,v,l)}}a||(a=new Cr);var g=a.get(t);if(g)return g;if(a.set(t,o),Mo(t))return t.forEach(function(r){o.add(Er(r,e,n,r,t,a))}),o;if(Ro(t))return t.forEach(function(r,i){o.set(i,Er(r,e,n,i,t,a))}),o;var _=h?s:(u?c?As:Os:c?sl:il)(t);return Ge(_||t,function(r,i){_&&(r=t[i=r]),Rr(o,i,Er(r,e,n,i,t,a))}),o}function zr(t,e,n){var r=n.length;if(null==t)return!r;for(t=ee(t);r--;){var i=n[r],a=e[i],o=t[i];if(o===s&&!(i in t)||!a(o))return!1}return!0}function Dr(t,e,n){if("function"!=typeof t)throw new ie(l);return ra(function(){t.apply(s,n)},e)}function Nr(t,e,n,r){var i=-1,s=Ke,o=!0,l=t.length,c=[],u=e.length;if(!l)return c;n&&(e=Qe(e,gn(n))),r?(s=Ze,o=!1):e.length>=a&&(s=yn,o=!1,e=new xr(e));t:for(;++i<l;){var h=t[i],f=null==n?h:n(h);if(h=r||0!==h?h:0,o&&f==f){for(var d=u;d--;)if(e[d]===f)continue t;c.push(h)}else s(e,f,r)||c.push(h)}return c}pr.templateSettings={escape:Tt,evaluate:St,interpolate:$t,variable:"",imports:{_:pr}},pr.prototype=mr.prototype,pr.prototype.constructor=pr,gr.prototype=vr(mr.prototype),gr.prototype.constructor=gr,_r.prototype=vr(mr.prototype),_r.prototype.constructor=_r,yr.prototype.clear=function(){this.__data__=rr?rr(null):{},this.size=0},yr.prototype.delete=function(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e},yr.prototype.get=function(t){var e=this.__data__;if(rr){var n=e[t];return n===c?s:n}return ue.call(e,t)?e[t]:s},yr.prototype.has=function(t){var e=this.__data__;return rr?e[t]!==s:ue.call(e,t)},yr.prototype.set=function(t,e){var n=this.__data__;return this.size+=this.has(t)?0:1,n[t]=rr&&e===s?c:e,this},wr.prototype.clear=function(){this.__data__=[],this.size=0},wr.prototype.delete=function(t){var e=this.__data__,n=jr(e,t);return!(n<0||(n==e.length-1?e.pop():Le.call(e,n,1),--this.size,0))},wr.prototype.get=function(t){var e=this.__data__,n=jr(e,t);return n<0?s:e[n][1]},wr.prototype.has=function(t){return jr(this.__data__,t)>-1},wr.prototype.set=function(t,e){var n=this.__data__,r=jr(n,t);return r<0?(++this.size,n.push([t,e])):n[r][1]=e,this},br.prototype.clear=function(){this.size=0,this.__data__={hash:new yr,map:new(Qn||wr),string:new yr}},br.prototype.delete=function(t){var e=zs(this,t).delete(t);return this.size-=e?1:0,e},br.prototype.get=function(t){return zs(this,t).get(t)},br.prototype.has=function(t){return zs(this,t).has(t)},br.prototype.set=function(t,e){var n=zs(this,t),r=n.size;return n.set(t,e),this.size+=n.size==r?0:1,this},xr.prototype.add=xr.prototype.push=function(t){return this.__data__.set(t,c),this},xr.prototype.has=function(t){return this.__data__.has(t)},Cr.prototype.clear=function(){this.__data__=new wr,this.size=0},Cr.prototype.delete=function(t){var e=this.__data__,n=e.delete(t);return this.size=e.size,n},Cr.prototype.get=function(t){return this.__data__.get(t)},Cr.prototype.has=function(t){return this.__data__.has(t)},Cr.prototype.set=function(t,e){var n=this.__data__;if(n instanceof wr){var r=n.__data__;if(!Qn||r.length<a-1)return r.push([t,e]),this.size=++n.size,this;n=this.__data__=new br(r)}return n.set(t,e),this.size=n.size,this};var Fr=os(Jr),Br=os(Xr,!0);function Ur(t,e){var n=!0;return Fr(t,function(t,r,i){return n=!!e(t,r,i)}),n}function Hr(t,e,n){for(var r=-1,i=t.length;++r<i;){var a=t[r],o=e(a);if(null!=o&&(l===s?o==o&&!Lo(o):n(o,l)))var l=o,c=a}return c}function qr(t,e){var n=[];return Fr(t,function(t,r,i){e(t,r,i)&&n.push(t)}),n}function Vr(t,e,n,r,i){var s=-1,a=t.length;for(n||(n=Vs),i||(i=[]);++s<a;){var o=t[s];e>0&&n(o)?e>1?Vr(o,e-1,n,r,i):tn(i,o):r||(i[i.length]=o)}return i}var Wr=ls(),Gr=ls(!0);function Jr(t,e){return t&&Wr(t,e,il)}function Xr(t,e){return t&&Gr(t,e,il)}function Yr(t,e){return Ye(e,function(e){return ko(t[e])})}function Kr(t,e){for(var n=0,r=(e=Gi(e,t)).length;null!=t&&n<r;)t=t[ca(e[n++])];return n&&n==r?t:s}function Zr(t,e,n){var r=e(t);return go(t)?r:tn(r,n(t))}function Qr(t){return null==t?t===s?st:Z:sn&&sn in ee(t)?function(t){var e=ue.call(t,sn),n=t[sn];try{t[sn]=s;var r=!0}catch(t){}var i=de.call(t);return r&&(e?t[sn]=n:delete t[sn]),i}(t):function(t){return de.call(t)}(t)}function ti(t,e){return t>e}function ei(t,e){return null!=t&&ue.call(t,e)}function ni(t,e){return null!=t&&e in ee(t)}function ri(t,e,n){for(var i=n?Ze:Ke,a=t[0].length,o=t.length,l=o,c=r(o),u=1/0,h=[];l--;){var f=t[l];l&&e&&(f=Qe(f,gn(e))),u=Gn(f.length,u),c[l]=!n&&(e||a>=120&&f.length>=120)?new xr(l&&f):s}f=t[0];var d=-1,p=c[0];t:for(;++d<a&&h.length<u;){var v=f[d],m=e?e(v):v;if(v=n||0!==v?v:0,!(p?yn(p,m):i(h,m,n))){for(l=o;--l;){var g=c[l];if(!(g?yn(g,m):i(t[l],m,n)))continue t}p&&p.push(m),h.push(v)}}return h}function ii(t,e,n){var r=null==(t=ea(t,e=Gi(e,t)))?t:t[ca(xa(e))];return null==r?s:Ve(r,t,n)}function si(t){return $o(t)&&Qr(t)==B}function ai(t,e,n,r,i){return t===e||(null==t||null==e||!$o(t)&&!$o(e)?t!=t&&e!=e:function(t,e,n,r,i,a){var o=go(t),l=go(e),c=o?U:Us(t),u=l?U:Us(e),h=(c=c==B?Q:c)==Q,f=(u=u==B?Q:u)==Q,d=c==u;if(d&&bo(t)){if(!bo(e))return!1;o=!0,h=!1}if(d&&!h)return a||(a=new Cr),o||Eo(t)?Rs(t,e,n,r,i,a):function(t,e,n,r,i,s,a){switch(n){case ct:if(t.byteLength!=e.byteLength||t.byteOffset!=e.byteOffset)return!1;t=t.buffer,e=e.buffer;case lt:return!(t.byteLength!=e.byteLength||!s(new xe(t),new xe(e)));case q:case V:case K:return fo(+t,+e);case G:return t.name==e.name&&t.message==e.message;case et:case rt:return t==e+"";case Y:var o=Tn;case nt:var l=r&v;if(o||(o=jn),t.size!=e.size&&!l)return!1;var c=a.get(t);if(c)return c==e;r|=m,a.set(t,e);var u=Rs(o(t),o(e),r,i,s,a);return a.delete(t),u;case it:if(fr)return fr.call(t)==fr.call(e)}return!1}(t,e,c,n,r,i,a);if(!(n&v)){var p=h&&ue.call(t,"__wrapped__"),g=f&&ue.call(e,"__wrapped__");if(p||g){var _=p?t.value():t,y=g?e.value():e;return a||(a=new Cr),i(_,y,n,r,a)}}return!!d&&(a||(a=new Cr),function(t,e,n,r,i,a){var o=n&v,l=Os(t),c=l.length,u=Os(e).length;if(c!=u&&!o)return!1;for(var h=c;h--;){var f=l[h];if(!(o?f in e:ue.call(e,f)))return!1}var d=a.get(t);if(d&&a.get(e))return d==e;var p=!0;a.set(t,e),a.set(e,t);for(var m=o;++h<c;){f=l[h];var g=t[f],_=e[f];if(r)var y=o?r(_,g,f,e,t,a):r(g,_,f,t,e,a);if(!(y===s?g===_||i(g,_,n,r,a):y)){p=!1;break}m||(m="constructor"==f)}if(p&&!m){var w=t.constructor,b=e.constructor;w!=b&&"constructor"in t&&"constructor"in e&&!("function"==typeof w&&w instanceof w&&"function"==typeof b&&b instanceof b)&&(p=!1)}return a.delete(t),a.delete(e),p}(t,e,n,r,i,a))}(t,e,n,r,ai,i))}function oi(t,e,n,r){var i=n.length,a=i,o=!r;if(null==t)return!a;for(t=ee(t);i--;){var l=n[i];if(o&&l[2]?l[1]!==t[l[0]]:!(l[0]in t))return!1}for(;++i<a;){var c=(l=n[i])[0],u=t[c],h=l[1];if(o&&l[2]){if(u===s&&!(c in t))return!1}else{var f=new Cr;if(r)var d=r(u,h,c,t,e,f);if(!(d===s?ai(h,u,v|m,r,f):d))return!1}}return!0}function li(t){return!(!So(t)||fe&&fe in t)&&(ko(t)?me:Wt).test(ua(t))}function ci(t){return"function"==typeof t?t:null==t?jl:"object"==typeof t?go(t)?vi(t[0],t[1]):pi(t):Nl(t)}function ui(t){if(!Ks(t))return Vn(t);var e=[];for(var n in ee(t))ue.call(t,n)&&"constructor"!=n&&e.push(n);return e}function hi(t){if(!So(t))return function(t){var e=[];if(null!=t)for(var n in ee(t))e.push(n);return e}(t);var e=Ks(t),n=[];for(var r in t)("constructor"!=r||!e&&ue.call(t,r))&&n.push(r);return n}function fi(t,e){return t<e}function di(t,e){var n=-1,i=yo(t)?r(t.length):[];return Fr(t,function(t,r,s){i[++n]=e(t,r,s)}),i}function pi(t){var e=Ds(t);return 1==e.length&&e[0][2]?Qs(e[0][0],e[0][1]):function(n){return n===t||oi(n,t,e)}}function vi(t,e){return Js(t)&&Zs(e)?Qs(ca(t),e):function(n){var r=Qo(n,t);return r===s&&r===e?tl(n,t):ai(e,r,v|m)}}function mi(t,e,n,r,i){t!==e&&Wr(e,function(a,o){if(So(a))i||(i=new Cr),function(t,e,n,r,i,a,o){var l=Rn(t,n),c=Rn(e,n),u=o.get(c);if(u)$r(t,n,u);else{var h=a?a(l,c,n+"",t,e,o):s,f=h===s;if(f){var d=go(c),p=!d&&bo(c),v=!d&&!p&&Eo(c);h=c,d||p||v?go(l)?h=l:wo(l)?h=rs(l):p?(f=!1,h=Ki(c,!0)):v?(f=!1,h=Qi(c,!0)):h=[]:Oo(c)||mo(c)?(h=l,mo(l)?h=qo(l):(!So(l)||r&&ko(l))&&(h=qs(c))):f=!1}f&&(o.set(c,h),i(h,c,r,a,o),o.delete(c)),$r(t,n,h)}}(t,e,o,n,mi,r,i);else{var l=r?r(Rn(t,o),a,o+"",t,e,i):s;l===s&&(l=a),$r(t,o,l)}},sl)}function gi(t,e){var n=t.length;if(n)return Ws(e+=e<0?n:0,n)?t[e]:s}function _i(t,e,n){var r=-1;return e=Qe(e.length?e:[jl],gn(Es())),function(t,e){var n=t.length;for(t.sort(e);n--;)t[n]=t[n].value;return t}(di(t,function(t,n,i){return{criteria:Qe(e,function(e){return e(t)}),index:++r,value:t}}),function(t,e){return function(t,e,n){for(var r=-1,i=t.criteria,s=e.criteria,a=i.length,o=n.length;++r<a;){var l=ts(i[r],s[r]);if(l){if(r>=o)return l;var c=n[r];return l*("desc"==c?-1:1)}}return t.index-e.index}(t,e,n)})}function yi(t,e,n){for(var r=-1,i=e.length,s={};++r<i;){var a=e[r],o=Kr(t,a);n(o,a)&&Si(s,Gi(a,t),o)}return s}function wi(t,e,n,r){var i=r?cn:ln,s=-1,a=e.length,o=t;for(t===e&&(e=rs(e)),n&&(o=Qe(t,gn(n)));++s<a;)for(var l=0,c=e[s],u=n?n(c):c;(l=i(o,u,l,r))>-1;)o!==t&&Le.call(o,l,1),Le.call(t,l,1);return t}function bi(t,e){for(var n=t?e.length:0,r=n-1;n--;){var i=e[n];if(n==r||i!==s){var s=i;Ws(i)?Le.call(t,i,1):Ni(t,i)}}return t}function xi(t,e){return t+Fn(Yn()*(e-t+1))}function Ci(t,e){var n="";if(!t||e<1||e>I)return n;do{e%2&&(n+=t),(e=Fn(e/2))&&(t+=t)}while(e);return n}function ki(t,e){return ia(ta(t,e,jl),t+"")}function Pi(t){return Pr(dl(t))}function Ti(t,e){var n=dl(t);return oa(n,Lr(e,0,n.length))}function Si(t,e,n,r){if(!So(t))return t;for(var i=-1,a=(e=Gi(e,t)).length,o=a-1,l=t;null!=l&&++i<a;){var c=ca(e[i]),u=n;if(i!=o){var h=l[c];(u=r?r(h,c,l):s)===s&&(u=So(h)?h:Ws(e[i+1])?[]:{})}Rr(l,c,u),l=l[c]}return t}var $i=ir?function(t,e){return ir.set(t,e),t}:jl,Ri=dn?function(t,e){return dn(t,"toString",{configurable:!0,enumerable:!1,value:Sl(e),writable:!0})}:jl;function ji(t){return oa(dl(t))}function Oi(t,e,n){var i=-1,s=t.length;e<0&&(e=-e>s?0:s+e),(n=n>s?s:n)<0&&(n+=s),s=e>n?0:n-e>>>0,e>>>=0;for(var a=r(s);++i<s;)a[i]=t[i+e];return a}function Ai(t,e){var n;return Fr(t,function(t,r,i){return!(n=e(t,r,i))}),!!n}function Mi(t,e,n){var r=0,i=null==t?r:t.length;if("number"==typeof e&&e==e&&i<=N){for(;r<i;){var s=r+i>>>1,a=t[s];null!==a&&!Lo(a)&&(n?a<=e:a<e)?r=s+1:i=s}return i}return Ii(t,e,jl,n)}function Ii(t,e,n,r){e=n(e);for(var i=0,a=null==t?0:t.length,o=e!=e,l=null===e,c=Lo(e),u=e===s;i<a;){var h=Fn((i+a)/2),f=n(t[h]),d=f!==s,p=null===f,v=f==f,m=Lo(f);if(o)var g=r||v;else g=u?v&&(r||d):l?v&&d&&(r||!p):c?v&&d&&!p&&(r||!m):!p&&!m&&(r?f<=e:f<e);g?i=h+1:a=h}return Gn(a,D)}function Li(t,e){for(var n=-1,r=t.length,i=0,s=[];++n<r;){var a=t[n],o=e?e(a):a;if(!n||!fo(o,l)){var l=o;s[i++]=0===a?0:a}}return s}function Ei(t){return"number"==typeof t?t:Lo(t)?E:+t}function zi(t){if("string"==typeof t)return t;if(go(t))return Qe(t,zi)+"";if(Lo(t))return dr?dr.call(t):"";var e=t+"";return"0"==e&&1/t==-M?"-0":e}function Di(t,e,n){var r=-1,i=Ke,s=t.length,o=!0,l=[],c=l;if(n)o=!1,i=Ze;else if(s>=a){var u=e?null:Cs(t);if(u)return jn(u);o=!1,i=yn,c=new xr}else c=e?[]:l;t:for(;++r<s;){var h=t[r],f=e?e(h):h;if(h=n||0!==h?h:0,o&&f==f){for(var d=c.length;d--;)if(c[d]===f)continue t;e&&c.push(f),l.push(h)}else i(c,f,n)||(c!==l&&c.push(f),l.push(h))}return l}function Ni(t,e){return null==(t=ea(t,e=Gi(e,t)))||delete t[ca(xa(e))]}function Fi(t,e,n,r){return Si(t,e,n(Kr(t,e)),r)}function Bi(t,e,n,r){for(var i=t.length,s=r?i:-1;(r?s--:++s<i)&&e(t[s],s,t););return n?Oi(t,r?0:s,r?s+1:i):Oi(t,r?s+1:0,r?i:s)}function Ui(t,e){var n=t;return n instanceof _r&&(n=n.value()),en(e,function(t,e){return e.func.apply(e.thisArg,tn([t],e.args))},n)}function Hi(t,e,n){var i=t.length;if(i<2)return i?Di(t[0]):[];for(var s=-1,a=r(i);++s<i;)for(var o=t[s],l=-1;++l<i;)l!=s&&(a[s]=Nr(a[s]||o,t[l],e,n));return Di(Vr(a,1),e,n)}function qi(t,e,n){for(var r=-1,i=t.length,a=e.length,o={};++r<i;){var l=r<a?e[r]:s;n(o,t[r],l)}return o}function Vi(t){return wo(t)?t:[]}function Wi(t){return"function"==typeof t?t:jl}function Gi(t,e){return go(t)?t:Js(t,e)?[t]:la(Vo(t))}var Ji=ki;function Xi(t,e,n){var r=t.length;return n=n===s?r:n,!e&&n>=r?t:Oi(t,e,n)}var Yi=En||function(t){return Me.clearTimeout(t)};function Ki(t,e){if(e)return t.slice();var n=t.length,r=$e?$e(n):new t.constructor(n);return t.copy(r),r}function Zi(t){var e=new t.constructor(t.byteLength);return new xe(e).set(new xe(t)),e}function Qi(t,e){var n=e?Zi(t.buffer):t.buffer;return new t.constructor(n,t.byteOffset,t.length)}function ts(t,e){if(t!==e){var n=t!==s,r=null===t,i=t==t,a=Lo(t),o=e!==s,l=null===e,c=e==e,u=Lo(e);if(!l&&!u&&!a&&t>e||a&&o&&c&&!l&&!u||r&&o&&c||!n&&c||!i)return 1;if(!r&&!a&&!u&&t<e||u&&n&&i&&!r&&!a||l&&n&&i||!o&&i||!c)return-1}return 0}function es(t,e,n,i){for(var s=-1,a=t.length,o=n.length,l=-1,c=e.length,u=Wn(a-o,0),h=r(c+u),f=!i;++l<c;)h[l]=e[l];for(;++s<o;)(f||s<a)&&(h[n[s]]=t[s]);for(;u--;)h[l++]=t[s++];return h}function ns(t,e,n,i){for(var s=-1,a=t.length,o=-1,l=n.length,c=-1,u=e.length,h=Wn(a-l,0),f=r(h+u),d=!i;++s<h;)f[s]=t[s];for(var p=s;++c<u;)f[p+c]=e[c];for(;++o<l;)(d||s<a)&&(f[p+n[o]]=t[s++]);return f}function rs(t,e){var n=-1,i=t.length;for(e||(e=r(i));++n<i;)e[n]=t[n];return e}function is(t,e,n,r){var i=!n;n||(n={});for(var a=-1,o=e.length;++a<o;){var l=e[a],c=r?r(n[l],t[l],l,n,t):s;c===s&&(c=t[l]),i?Mr(n,l,c):Rr(n,l,c)}return n}function ss(t,e){return function(n,r){var i=go(n)?We:Or,s=e?e():{};return i(n,t,Es(r,2),s)}}function as(t){return ki(function(e,n){var r=-1,i=n.length,a=i>1?n[i-1]:s,o=i>2?n[2]:s;for(a=t.length>3&&"function"==typeof a?(i--,a):s,o&&Gs(n[0],n[1],o)&&(a=i<3?s:a,i=1),e=ee(e);++r<i;){var l=n[r];l&&t(e,l,r,a)}return e})}function os(t,e){return function(n,r){if(null==n)return n;if(!yo(n))return t(n,r);for(var i=n.length,s=e?i:-1,a=ee(n);(e?s--:++s<i)&&!1!==r(a[s],s,a););return n}}function ls(t){return function(e,n,r){for(var i=-1,s=ee(e),a=r(e),o=a.length;o--;){var l=a[t?o:++i];if(!1===n(s[l],l,s))break}return e}}function cs(t){return function(e){var n=Pn(e=Vo(e))?Mn(e):s,r=n?n[0]:e.charAt(0),i=n?Xi(n,1).join(""):e.slice(1);return r[t]()+i}}function us(t){return function(e){return en(kl(ml(e).replace(_e,"")),t,"")}}function hs(t){return function(){var e=arguments;switch(e.length){case 0:return new t;case 1:return new t(e[0]);case 2:return new t(e[0],e[1]);case 3:return new t(e[0],e[1],e[2]);case 4:return new t(e[0],e[1],e[2],e[3]);case 5:return new t(e[0],e[1],e[2],e[3],e[4]);case 6:return new t(e[0],e[1],e[2],e[3],e[4],e[5]);case 7:return new t(e[0],e[1],e[2],e[3],e[4],e[5],e[6])}var n=vr(t.prototype),r=t.apply(n,e);return So(r)?r:n}}function fs(t){return function(e,n,r){var i=ee(e);if(!yo(e)){var a=Es(n,3);e=il(e),n=function(t){return a(i[t],t,i)}}var o=t(e,n,r);return o>-1?i[a?e[o]:o]:s}}function ds(t){return js(function(e){var n=e.length,r=n,i=gr.prototype.thru;for(t&&e.reverse();r--;){var a=e[r];if("function"!=typeof a)throw new ie(l);if(i&&!o&&"wrapper"==Is(a))var o=new gr([],!0)}for(r=o?r:n;++r<n;){var c=Is(a=e[r]),u="wrapper"==c?Ms(a):s;o=u&&Xs(u[0])&&u[1]==(k|w|x|P)&&!u[4].length&&1==u[9]?o[Is(u[0])].apply(o,u[3]):1==a.length&&Xs(a)?o[c]():o.thru(a)}return function(){var t=arguments,r=t[0];if(o&&1==t.length&&go(r))return o.plant(r).value();for(var i=0,s=n?e[i].apply(this,t):r;++i<n;)s=e[i].call(this,s);return s}})}function ps(t,e,n,i,a,o,l,c,u,h){var f=e&k,d=e&g,p=e&_,v=e&(w|b),m=e&T,y=p?s:hs(t);return function g(){for(var _=arguments.length,w=r(_),b=_;b--;)w[b]=arguments[b];if(v)var x=Ls(g),C=function(t,e){for(var n=t.length,r=0;n--;)t[n]===e&&++r;return r}(w,x);if(i&&(w=es(w,i,a,v)),o&&(w=ns(w,o,l,v)),_-=C,v&&_<h){var k=$n(w,x);return bs(t,e,ps,g.placeholder,n,w,k,c,u,h-_)}var P=d?n:this,T=p?P[t]:t;return _=w.length,c?w=function(t,e){for(var n=t.length,r=Gn(e.length,n),i=rs(t);r--;){var a=e[r];t[r]=Ws(a,n)?i[a]:s}return t}(w,c):m&&_>1&&w.reverse(),f&&u<_&&(w.length=u),this&&this!==Me&&this instanceof g&&(T=y||hs(T)),T.apply(P,w)}}function vs(t,e){return function(n,r){return function(t,e,n,r){return Jr(t,function(t,i,s){e(r,n(t),i,s)}),r}(n,t,e(r),{})}}function ms(t,e){return function(n,r){var i;if(n===s&&r===s)return e;if(n!==s&&(i=n),r!==s){if(i===s)return r;"string"==typeof n||"string"==typeof r?(n=zi(n),r=zi(r)):(n=Ei(n),r=Ei(r)),i=t(n,r)}return i}}function gs(t){return js(function(e){return e=Qe(e,gn(Es())),ki(function(n){var r=this;return t(e,function(t){return Ve(t,r,n)})})})}function _s(t,e){var n=(e=e===s?" ":zi(e)).length;if(n<2)return n?Ci(e,t):e;var r=Ci(e,Nn(t/An(e)));return Pn(e)?Xi(Mn(r),0,t).join(""):r.slice(0,t)}function ys(t){return function(e,n,i){return i&&"number"!=typeof i&&Gs(e,n,i)&&(n=i=s),e=Fo(e),n===s?(n=e,e=0):n=Fo(n),function(t,e,n,i){for(var s=-1,a=Wn(Nn((e-t)/(n||1)),0),o=r(a);a--;)o[i?a:++s]=t,t+=n;return o}(e,n,i=i===s?e<n?1:-1:Fo(i),t)}}function ws(t){return function(e,n){return"string"==typeof e&&"string"==typeof n||(e=Ho(e),n=Ho(n)),t(e,n)}}function bs(t,e,n,r,i,a,o,l,c,u){var h=e&w;e|=h?x:C,(e&=~(h?C:x))&y||(e&=~(g|_));var f=[t,e,i,h?a:s,h?o:s,h?s:a,h?s:o,l,c,u],d=n.apply(s,f);return Xs(t)&&na(d,f),d.placeholder=r,sa(d,t,e)}function xs(t){var e=te[t];return function(t,n){if(t=Ho(t),n=null==n?0:Gn(Bo(n),292)){var r=(Vo(t)+"e").split("e");return+((r=(Vo(e(r[0]+"e"+(+r[1]+n)))+"e").split("e"))[0]+"e"+(+r[1]-n))}return e(t)}}var Cs=er&&1/jn(new er([,-0]))[1]==M?function(t){return new er(t)}:Ll;function ks(t){return function(e){var n=Us(e);return n==Y?Tn(e):n==nt?On(e):function(t,e){return Qe(e,function(e){return[e,t[e]]})}(e,t(e))}}function Ps(t,e,n,i,a,o,c,u){var f=e&_;if(!f&&"function"!=typeof t)throw new ie(l);var d=i?i.length:0;if(d||(e&=~(x|C),i=a=s),c=c===s?c:Wn(Bo(c),0),u=u===s?u:Bo(u),d-=a?a.length:0,e&C){var p=i,v=a;i=a=s}var m=f?s:Ms(t),T=[t,e,n,i,a,p,v,o,c,u];if(m&&function(t,e){var n=t[1],r=e[1],i=n|r,s=i<(g|_|k),a=r==k&&n==w||r==k&&n==P&&t[7].length<=e[8]||r==(k|P)&&e[7].length<=e[8]&&n==w;if(!s&&!a)return t;r&g&&(t[2]=e[2],i|=n&g?0:y);var o=e[3];if(o){var l=t[3];t[3]=l?es(l,o,e[4]):o,t[4]=l?$n(t[3],h):e[4]}(o=e[5])&&(l=t[5],t[5]=l?ns(l,o,e[6]):o,t[6]=l?$n(t[5],h):e[6]),(o=e[7])&&(t[7]=o),r&k&&(t[8]=null==t[8]?e[8]:Gn(t[8],e[8])),null==t[9]&&(t[9]=e[9]),t[0]=e[0],t[1]=i}(T,m),t=T[0],e=T[1],n=T[2],i=T[3],a=T[4],!(u=T[9]=T[9]===s?f?0:t.length:Wn(T[9]-d,0))&&e&(w|b)&&(e&=~(w|b)),e&&e!=g)S=e==w||e==b?function(t,e,n){var i=hs(t);return function a(){for(var o=arguments.length,l=r(o),c=o,u=Ls(a);c--;)l[c]=arguments[c];var h=o<3&&l[0]!==u&&l[o-1]!==u?[]:$n(l,u);return(o-=h.length)<n?bs(t,e,ps,a.placeholder,s,l,h,s,s,n-o):Ve(this&&this!==Me&&this instanceof a?i:t,this,l)}}(t,e,u):e!=x&&e!=(g|x)||a.length?ps.apply(s,T):function(t,e,n,i){var s=e&g,a=hs(t);return function e(){for(var o=-1,l=arguments.length,c=-1,u=i.length,h=r(u+l),f=this&&this!==Me&&this instanceof e?a:t;++c<u;)h[c]=i[c];for(;l--;)h[c++]=arguments[++o];return Ve(f,s?n:this,h)}}(t,e,n,i);else var S=function(t,e,n){var r=e&g,i=hs(t);return function e(){return(this&&this!==Me&&this instanceof e?i:t).apply(r?n:this,arguments)}}(t,e,n);return sa((m?$i:na)(S,T),t,e)}function Ts(t,e,n,r){return t===s||fo(t,oe[n])&&!ue.call(r,n)?e:t}function Ss(t,e,n,r,i,a){return So(t)&&So(e)&&(a.set(e,t),mi(t,e,s,Ss,a),a.delete(e)),t}function $s(t){return Oo(t)?s:t}function Rs(t,e,n,r,i,a){var o=n&v,l=t.length,c=e.length;if(l!=c&&!(o&&c>l))return!1;var u=a.get(t);if(u&&a.get(e))return u==e;var h=-1,f=!0,d=n&m?new xr:s;for(a.set(t,e),a.set(e,t);++h<l;){var p=t[h],g=e[h];if(r)var _=o?r(g,p,h,e,t,a):r(p,g,h,t,e,a);if(_!==s){if(_)continue;f=!1;break}if(d){if(!rn(e,function(t,e){if(!yn(d,e)&&(p===t||i(p,t,n,r,a)))return d.push(e)})){f=!1;break}}else if(p!==g&&!i(p,g,n,r,a)){f=!1;break}}return a.delete(t),a.delete(e),f}function js(t){return ia(ta(t,s,ga),t+"")}function Os(t){return Zr(t,il,Fs)}function As(t){return Zr(t,sl,Bs)}var Ms=ir?function(t){return ir.get(t)}:Ll;function Is(t){for(var e=t.name+"",n=sr[e],r=ue.call(sr,e)?n.length:0;r--;){var i=n[r],s=i.func;if(null==s||s==t)return i.name}return e}function Ls(t){return(ue.call(pr,"placeholder")?pr:t).placeholder}function Es(){var t=pr.iteratee||Ol;return t=t===Ol?ci:t,arguments.length?t(arguments[0],arguments[1]):t}function zs(t,e){var n,r,i=t.__data__;return("string"==(r=typeof(n=e))||"number"==r||"symbol"==r||"boolean"==r?"__proto__"!==n:null===n)?i["string"==typeof e?"string":"hash"]:i.map}function Ds(t){for(var e=il(t),n=e.length;n--;){var r=e[n],i=t[r];e[n]=[r,i,Zs(i)]}return e}function Ns(t,e){var n=function(t,e){return null==t?s:t[e]}(t,e);return li(n)?n:s}var Fs=Bn?function(t){return null==t?[]:(t=ee(t),Ye(Bn(t),function(e){return Ie.call(t,e)}))}:Ul,Bs=Bn?function(t){for(var e=[];t;)tn(e,Fs(t)),t=Oe(t);return e}:Ul,Us=Qr;function Hs(t,e,n){for(var r=-1,i=(e=Gi(e,t)).length,s=!1;++r<i;){var a=ca(e[r]);if(!(s=null!=t&&n(t,a)))break;t=t[a]}return s||++r!=i?s:!!(i=null==t?0:t.length)&&To(i)&&Ws(a,i)&&(go(t)||mo(t))}function qs(t){return"function"!=typeof t.constructor||Ks(t)?{}:vr(Oe(t))}function Vs(t){return go(t)||mo(t)||!!(ze&&t&&t[ze])}function Ws(t,e){var n=typeof t;return!!(e=null==e?I:e)&&("number"==n||"symbol"!=n&&Jt.test(t))&&t>-1&&t%1==0&&t<e}function Gs(t,e,n){if(!So(n))return!1;var r=typeof e;return!!("number"==r?yo(n)&&Ws(e,n.length):"string"==r&&e in n)&&fo(n[e],t)}function Js(t,e){if(go(t))return!1;var n=typeof t;return!("number"!=n&&"symbol"!=n&&"boolean"!=n&&null!=t&&!Lo(t))||jt.test(t)||!Rt.test(t)||null!=e&&t in ee(e)}function Xs(t){var e=Is(t),n=pr[e];if("function"!=typeof n||!(e in _r.prototype))return!1;if(t===n)return!0;var r=Ms(n);return!!r&&t===r[0]}(Zn&&Us(new Zn(new ArrayBuffer(1)))!=ct||Qn&&Us(new Qn)!=Y||tr&&"[object Promise]"!=Us(tr.resolve())||er&&Us(new er)!=nt||nr&&Us(new nr)!=at)&&(Us=function(t){var e=Qr(t),n=e==Q?t.constructor:s,r=n?ua(n):"";if(r)switch(r){case ar:return ct;case or:return Y;case lr:return"[object Promise]";case cr:return nt;case ur:return at}return e});var Ys=le?ko:Hl;function Ks(t){var e=t&&t.constructor;return t===("function"==typeof e&&e.prototype||oe)}function Zs(t){return t==t&&!So(t)}function Qs(t,e){return function(n){return null!=n&&n[t]===e&&(e!==s||t in ee(n))}}function ta(t,e,n){return e=Wn(e===s?t.length-1:e,0),function(){for(var i=arguments,s=-1,a=Wn(i.length-e,0),o=r(a);++s<a;)o[s]=i[e+s];s=-1;for(var l=r(e+1);++s<e;)l[s]=i[s];return l[e]=n(o),Ve(t,this,l)}}function ea(t,e){return e.length<2?t:Kr(t,Oi(e,0,-1))}var na=aa($i),ra=Dn||function(t,e){return Me.setTimeout(t,e)},ia=aa(Ri);function sa(t,e,n){var r=e+"";return ia(t,function(t,e){var n=e.length;if(!n)return t;var r=n-1;return e[r]=(n>1?"& ":"")+e[r],e=e.join(n>2?", ":" "),t.replace(zt,"{\n/* [wrapped with "+e+"] */\n")}(r,function(t,e){return Ge(F,function(n){var r="_."+n[0];e&n[1]&&!Ke(t,r)&&t.push(r)}),t.sort()}(function(t){var e=t.match(Dt);return e?e[1].split(Nt):[]}(r),n)))}function aa(t){var e=0,n=0;return function(){var r=Jn(),i=j-(r-n);if(n=r,i>0){if(++e>=R)return arguments[0]}else e=0;return t.apply(s,arguments)}}function oa(t,e){var n=-1,r=t.length,i=r-1;for(e=e===s?r:e;++n<e;){var a=xi(n,i),o=t[a];t[a]=t[n],t[n]=o}return t.length=e,t}var la=function(t){var e=ao(t,function(t){return n.size===u&&n.clear(),t}),n=e.cache;return e}(function(t){var e=[];return 46===t.charCodeAt(0)&&e.push(""),t.replace(Ot,function(t,n,r,i){e.push(r?i.replace(Bt,"$1"):n||t)}),e});function ca(t){if("string"==typeof t||Lo(t))return t;var e=t+"";return"0"==e&&1/t==-M?"-0":e}function ua(t){if(null!=t){try{return ce.call(t)}catch(t){}try{return t+""}catch(t){}}return""}function ha(t){if(t instanceof _r)return t.clone();var e=new gr(t.__wrapped__,t.__chain__);return e.__actions__=rs(t.__actions__),e.__index__=t.__index__,e.__values__=t.__values__,e}var fa=ki(function(t,e){return wo(t)?Nr(t,Vr(e,1,wo,!0)):[]}),da=ki(function(t,e){var n=xa(e);return wo(n)&&(n=s),wo(t)?Nr(t,Vr(e,1,wo,!0),Es(n,2)):[]}),pa=ki(function(t,e){var n=xa(e);return wo(n)&&(n=s),wo(t)?Nr(t,Vr(e,1,wo,!0),s,n):[]});function va(t,e,n){var r=null==t?0:t.length;if(!r)return-1;var i=null==n?0:Bo(n);return i<0&&(i=Wn(r+i,0)),on(t,Es(e,3),i)}function ma(t,e,n){var r=null==t?0:t.length;if(!r)return-1;var i=r-1;return n!==s&&(i=Bo(n),i=n<0?Wn(r+i,0):Gn(i,r-1)),on(t,Es(e,3),i,!0)}function ga(t){return null!=t&&t.length?Vr(t,1):[]}function _a(t){return t&&t.length?t[0]:s}var ya=ki(function(t){var e=Qe(t,Vi);return e.length&&e[0]===t[0]?ri(e):[]}),wa=ki(function(t){var e=xa(t),n=Qe(t,Vi);return e===xa(n)?e=s:n.pop(),n.length&&n[0]===t[0]?ri(n,Es(e,2)):[]}),ba=ki(function(t){var e=xa(t),n=Qe(t,Vi);return(e="function"==typeof e?e:s)&&n.pop(),n.length&&n[0]===t[0]?ri(n,s,e):[]});function xa(t){var e=null==t?0:t.length;return e?t[e-1]:s}var Ca=ki(ka);function ka(t,e){return t&&t.length&&e&&e.length?wi(t,e):t}var Pa=js(function(t,e){var n=null==t?0:t.length,r=Ir(t,e);return bi(t,Qe(e,function(t){return Ws(t,n)?+t:t}).sort(ts)),r});function Ta(t){return null==t?t:Kn.call(t)}var Sa=ki(function(t){return Di(Vr(t,1,wo,!0))}),$a=ki(function(t){var e=xa(t);return wo(e)&&(e=s),Di(Vr(t,1,wo,!0),Es(e,2))}),Ra=ki(function(t){var e=xa(t);return e="function"==typeof e?e:s,Di(Vr(t,1,wo,!0),s,e)});function ja(t){if(!t||!t.length)return[];var e=0;return t=Ye(t,function(t){if(wo(t))return e=Wn(t.length,e),!0}),mn(e,function(e){return Qe(t,fn(e))})}function Oa(t,e){if(!t||!t.length)return[];var n=ja(t);return null==e?n:Qe(n,function(t){return Ve(e,s,t)})}var Aa=ki(function(t,e){return wo(t)?Nr(t,e):[]}),Ma=ki(function(t){return Hi(Ye(t,wo))}),Ia=ki(function(t){var e=xa(t);return wo(e)&&(e=s),Hi(Ye(t,wo),Es(e,2))}),La=ki(function(t){var e=xa(t);return e="function"==typeof e?e:s,Hi(Ye(t,wo),s,e)}),Ea=ki(ja);var za=ki(function(t){var e=t.length,n=e>1?t[e-1]:s;return Oa(t,n="function"==typeof n?(t.pop(),n):s)});function Da(t){var e=pr(t);return e.__chain__=!0,e}function Na(t,e){return e(t)}var Fa=js(function(t){var e=t.length,n=e?t[0]:0,r=this.__wrapped__,i=function(e){return Ir(e,t)};return!(e>1||this.__actions__.length)&&r instanceof _r&&Ws(n)?((r=r.slice(n,+n+(e?1:0))).__actions__.push({func:Na,args:[i],thisArg:s}),new gr(r,this.__chain__).thru(function(t){return e&&!t.length&&t.push(s),t})):this.thru(i)});var Ba=ss(function(t,e,n){ue.call(t,n)?++t[n]:Mr(t,n,1)});var Ua=fs(va),Ha=fs(ma);function qa(t,e){return(go(t)?Ge:Fr)(t,Es(e,3))}function Va(t,e){return(go(t)?Je:Br)(t,Es(e,3))}var Wa=ss(function(t,e,n){ue.call(t,n)?t[n].push(e):Mr(t,n,[e])});var Ga=ki(function(t,e,n){var i=-1,s="function"==typeof e,a=yo(t)?r(t.length):[];return Fr(t,function(t){a[++i]=s?Ve(e,t,n):ii(t,e,n)}),a}),Ja=ss(function(t,e,n){Mr(t,n,e)});function Xa(t,e){return(go(t)?Qe:di)(t,Es(e,3))}var Ya=ss(function(t,e,n){t[n?0:1].push(e)},function(){return[[],[]]});var Ka=ki(function(t,e){if(null==t)return[];var n=e.length;return n>1&&Gs(t,e[0],e[1])?e=[]:n>2&&Gs(e[0],e[1],e[2])&&(e=[e[0]]),_i(t,Vr(e,1),[])}),Za=zn||function(){return Me.Date.now()};function Qa(t,e,n){return e=n?s:e,e=t&&null==e?t.length:e,Ps(t,k,s,s,s,s,e)}function to(t,e){var n;if("function"!=typeof e)throw new ie(l);return t=Bo(t),function(){return--t>0&&(n=e.apply(this,arguments)),t<=1&&(e=s),n}}var eo=ki(function(t,e,n){var r=g;if(n.length){var i=$n(n,Ls(eo));r|=x}return Ps(t,r,e,n,i)}),no=ki(function(t,e,n){var r=g|_;if(n.length){var i=$n(n,Ls(no));r|=x}return Ps(e,r,t,n,i)});function ro(t,e,n){var r,i,a,o,c,u,h=0,f=!1,d=!1,p=!0;if("function"!=typeof t)throw new ie(l);function v(e){var n=r,a=i;return r=i=s,h=e,o=t.apply(a,n)}function m(t){var n=t-u;return u===s||n>=e||n<0||d&&t-h>=a}function g(){var t=Za();if(m(t))return _(t);c=ra(g,function(t){var n=e-(t-u);return d?Gn(n,a-(t-h)):n}(t))}function _(t){return c=s,p&&r?v(t):(r=i=s,o)}function y(){var t=Za(),n=m(t);if(r=arguments,i=this,u=t,n){if(c===s)return function(t){return h=t,c=ra(g,e),f?v(t):o}(u);if(d)return c=ra(g,e),v(u)}return c===s&&(c=ra(g,e)),o}return e=Ho(e)||0,So(n)&&(f=!!n.leading,a=(d="maxWait"in n)?Wn(Ho(n.maxWait)||0,e):a,p="trailing"in n?!!n.trailing:p),y.cancel=function(){c!==s&&Yi(c),h=0,r=u=i=c=s},y.flush=function(){return c===s?o:_(Za())},y}var io=ki(function(t,e){return Dr(t,1,e)}),so=ki(function(t,e,n){return Dr(t,Ho(e)||0,n)});function ao(t,e){if("function"!=typeof t||null!=e&&"function"!=typeof e)throw new ie(l);var n=function(){var r=arguments,i=e?e.apply(this,r):r[0],s=n.cache;if(s.has(i))return s.get(i);var a=t.apply(this,r);return n.cache=s.set(i,a)||s,a};return n.cache=new(ao.Cache||br),n}function oo(t){if("function"!=typeof t)throw new ie(l);return function(){var e=arguments;switch(e.length){case 0:return!t.call(this);case 1:return!t.call(this,e[0]);case 2:return!t.call(this,e[0],e[1]);case 3:return!t.call(this,e[0],e[1],e[2])}return!t.apply(this,e)}}ao.Cache=br;var lo=Ji(function(t,e){var n=(e=1==e.length&&go(e[0])?Qe(e[0],gn(Es())):Qe(Vr(e,1),gn(Es()))).length;return ki(function(r){for(var i=-1,s=Gn(r.length,n);++i<s;)r[i]=e[i].call(this,r[i]);return Ve(t,this,r)})}),co=ki(function(t,e){var n=$n(e,Ls(co));return Ps(t,x,s,e,n)}),uo=ki(function(t,e){var n=$n(e,Ls(uo));return Ps(t,C,s,e,n)}),ho=js(function(t,e){return Ps(t,P,s,s,s,e)});function fo(t,e){return t===e||t!=t&&e!=e}var po=ws(ti),vo=ws(function(t,e){return t>=e}),mo=si(function(){return arguments}())?si:function(t){return $o(t)&&ue.call(t,"callee")&&!Ie.call(t,"callee")},go=r.isArray,_o=Ne?gn(Ne):function(t){return $o(t)&&Qr(t)==lt};function yo(t){return null!=t&&To(t.length)&&!ko(t)}function wo(t){return $o(t)&&yo(t)}var bo=Un||Hl,xo=Fe?gn(Fe):function(t){return $o(t)&&Qr(t)==V};function Co(t){if(!$o(t))return!1;var e=Qr(t);return e==G||e==W||"string"==typeof t.message&&"string"==typeof t.name&&!Oo(t)}function ko(t){if(!So(t))return!1;var e=Qr(t);return e==J||e==X||e==H||e==tt}function Po(t){return"number"==typeof t&&t==Bo(t)}function To(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=I}function So(t){var e=typeof t;return null!=t&&("object"==e||"function"==e)}function $o(t){return null!=t&&"object"==typeof t}var Ro=Be?gn(Be):function(t){return $o(t)&&Us(t)==Y};function jo(t){return"number"==typeof t||$o(t)&&Qr(t)==K}function Oo(t){if(!$o(t)||Qr(t)!=Q)return!1;var e=Oe(t);if(null===e)return!0;var n=ue.call(e,"constructor")&&e.constructor;return"function"==typeof n&&n instanceof n&&ce.call(n)==pe}var Ao=Ue?gn(Ue):function(t){return $o(t)&&Qr(t)==et};var Mo=He?gn(He):function(t){return $o(t)&&Us(t)==nt};function Io(t){return"string"==typeof t||!go(t)&&$o(t)&&Qr(t)==rt}function Lo(t){return"symbol"==typeof t||$o(t)&&Qr(t)==it}var Eo=qe?gn(qe):function(t){return $o(t)&&To(t.length)&&!!Te[Qr(t)]};var zo=ws(fi),Do=ws(function(t,e){return t<=e});function No(t){if(!t)return[];if(yo(t))return Io(t)?Mn(t):rs(t);if(De&&t[De])return function(t){for(var e,n=[];!(e=t.next()).done;)n.push(e.value);return n}(t[De]());var e=Us(t);return(e==Y?Tn:e==nt?jn:dl)(t)}function Fo(t){return t?(t=Ho(t))===M||t===-M?(t<0?-1:1)*L:t==t?t:0:0===t?t:0}function Bo(t){var e=Fo(t),n=e%1;return e==e?n?e-n:e:0}function Uo(t){return t?Lr(Bo(t),0,z):0}function Ho(t){if("number"==typeof t)return t;if(Lo(t))return E;if(So(t)){var e="function"==typeof t.valueOf?t.valueOf():t;t=So(e)?e+"":e}if("string"!=typeof t)return 0===t?t:+t;t=t.replace(It,"");var n=Vt.test(t);return n||Gt.test(t)?je(t.slice(2),n?2:8):qt.test(t)?E:+t}function qo(t){return is(t,sl(t))}function Vo(t){return null==t?"":zi(t)}var Wo=as(function(t,e){if(Ks(e)||yo(e))is(e,il(e),t);else for(var n in e)ue.call(e,n)&&Rr(t,n,e[n])}),Go=as(function(t,e){is(e,sl(e),t)}),Jo=as(function(t,e,n,r){is(e,sl(e),t,r)}),Xo=as(function(t,e,n,r){is(e,il(e),t,r)}),Yo=js(Ir);var Ko=ki(function(t,e){t=ee(t);var n=-1,r=e.length,i=r>2?e[2]:s;for(i&&Gs(e[0],e[1],i)&&(r=1);++n<r;)for(var a=e[n],o=sl(a),l=-1,c=o.length;++l<c;){var u=o[l],h=t[u];(h===s||fo(h,oe[u])&&!ue.call(t,u))&&(t[u]=a[u])}return t}),Zo=ki(function(t){return t.push(s,Ss),Ve(ol,s,t)});function Qo(t,e,n){var r=null==t?s:Kr(t,e);return r===s?n:r}function tl(t,e){return null!=t&&Hs(t,e,ni)}var el=vs(function(t,e,n){null!=e&&"function"!=typeof e.toString&&(e=de.call(e)),t[e]=n},Sl(jl)),nl=vs(function(t,e,n){null!=e&&"function"!=typeof e.toString&&(e=de.call(e)),ue.call(t,e)?t[e].push(n):t[e]=[n]},Es),rl=ki(ii);function il(t){return yo(t)?kr(t):ui(t)}function sl(t){return yo(t)?kr(t,!0):hi(t)}var al=as(function(t,e,n){mi(t,e,n)}),ol=as(function(t,e,n,r){mi(t,e,n,r)}),ll=js(function(t,e){var n={};if(null==t)return n;var r=!1;e=Qe(e,function(e){return e=Gi(e,t),r||(r=e.length>1),e}),is(t,As(t),n),r&&(n=Er(n,f|d|p,$s));for(var i=e.length;i--;)Ni(n,e[i]);return n});var cl=js(function(t,e){return null==t?{}:function(t,e){return yi(t,e,function(e,n){return tl(t,n)})}(t,e)});function ul(t,e){if(null==t)return{};var n=Qe(As(t),function(t){return[t]});return e=Es(e),yi(t,n,function(t,n){return e(t,n[0])})}var hl=ks(il),fl=ks(sl);function dl(t){return null==t?[]:_n(t,il(t))}var pl=us(function(t,e,n){return e=e.toLowerCase(),t+(n?vl(e):e)});function vl(t){return Cl(Vo(t).toLowerCase())}function ml(t){return(t=Vo(t))&&t.replace(Xt,xn).replace(ye,"")}var gl=us(function(t,e,n){return t+(n?"-":"")+e.toLowerCase()}),_l=us(function(t,e,n){return t+(n?" ":"")+e.toLowerCase()}),yl=cs("toLowerCase");var wl=us(function(t,e,n){return t+(n?"_":"")+e.toLowerCase()});var bl=us(function(t,e,n){return t+(n?" ":"")+Cl(e)});var xl=us(function(t,e,n){return t+(n?" ":"")+e.toUpperCase()}),Cl=cs("toUpperCase");function kl(t,e,n){return t=Vo(t),(e=n?s:e)===s?function(t){return Ce.test(t)}(t)?function(t){return t.match(be)||[]}(t):function(t){return t.match(Ft)||[]}(t):t.match(e)||[]}var Pl=ki(function(t,e){try{return Ve(t,s,e)}catch(t){return Co(t)?t:new Zt(t)}}),Tl=js(function(t,e){return Ge(e,function(e){e=ca(e),Mr(t,e,eo(t[e],t))}),t});function Sl(t){return function(){return t}}var $l=ds(),Rl=ds(!0);function jl(t){return t}function Ol(t){return ci("function"==typeof t?t:Er(t,f))}var Al=ki(function(t,e){return function(n){return ii(n,t,e)}}),Ml=ki(function(t,e){return function(n){return ii(t,n,e)}});function Il(t,e,n){var r=il(e),i=Yr(e,r);null!=n||So(e)&&(i.length||!r.length)||(n=e,e=t,t=this,i=Yr(e,il(e)));var s=!(So(n)&&"chain"in n&&!n.chain),a=ko(t);return Ge(i,function(n){var r=e[n];t[n]=r,a&&(t.prototype[n]=function(){var e=this.__chain__;if(s||e){var n=t(this.__wrapped__);return(n.__actions__=rs(this.__actions__)).push({func:r,args:arguments,thisArg:t}),n.__chain__=e,n}return r.apply(t,tn([this.value()],arguments))})}),t}function Ll(){}var El=gs(Qe),zl=gs(Xe),Dl=gs(rn);function Nl(t){return Js(t)?fn(ca(t)):function(t){return function(e){return Kr(e,t)}}(t)}var Fl=ys(),Bl=ys(!0);function Ul(){return[]}function Hl(){return!1}var ql=ms(function(t,e){return t+e},0),Vl=xs("ceil"),Wl=ms(function(t,e){return t/e},1),Gl=xs("floor");var Jl,Xl=ms(function(t,e){return t*e},1),Yl=xs("round"),Kl=ms(function(t,e){return t-e},0);return pr.after=function(t,e){if("function"!=typeof e)throw new ie(l);return t=Bo(t),function(){if(--t<1)return e.apply(this,arguments)}},pr.ary=Qa,pr.assign=Wo,pr.assignIn=Go,pr.assignInWith=Jo,pr.assignWith=Xo,pr.at=Yo,pr.before=to,pr.bind=eo,pr.bindAll=Tl,pr.bindKey=no,pr.castArray=function(){if(!arguments.length)return[];var t=arguments[0];return go(t)?t:[t]},pr.chain=Da,pr.chunk=function(t,e,n){e=(n?Gs(t,e,n):e===s)?1:Wn(Bo(e),0);var i=null==t?0:t.length;if(!i||e<1)return[];for(var a=0,o=0,l=r(Nn(i/e));a<i;)l[o++]=Oi(t,a,a+=e);return l},pr.compact=function(t){for(var e=-1,n=null==t?0:t.length,r=0,i=[];++e<n;){var s=t[e];s&&(i[r++]=s)}return i},pr.concat=function(){var t=arguments.length;if(!t)return[];for(var e=r(t-1),n=arguments[0],i=t;i--;)e[i-1]=arguments[i];return tn(go(n)?rs(n):[n],Vr(e,1))},pr.cond=function(t){var e=null==t?0:t.length,n=Es();return t=e?Qe(t,function(t){if("function"!=typeof t[1])throw new ie(l);return[n(t[0]),t[1]]}):[],ki(function(n){for(var r=-1;++r<e;){var i=t[r];if(Ve(i[0],this,n))return Ve(i[1],this,n)}})},pr.conforms=function(t){return function(t){var e=il(t);return function(n){return zr(n,t,e)}}(Er(t,f))},pr.constant=Sl,pr.countBy=Ba,pr.create=function(t,e){var n=vr(t);return null==e?n:Ar(n,e)},pr.curry=function t(e,n,r){var i=Ps(e,w,s,s,s,s,s,n=r?s:n);return i.placeholder=t.placeholder,i},pr.curryRight=function t(e,n,r){var i=Ps(e,b,s,s,s,s,s,n=r?s:n);return i.placeholder=t.placeholder,i},pr.debounce=ro,pr.defaults=Ko,pr.defaultsDeep=Zo,pr.defer=io,pr.delay=so,pr.difference=fa,pr.differenceBy=da,pr.differenceWith=pa,pr.drop=function(t,e,n){var r=null==t?0:t.length;return r?Oi(t,(e=n||e===s?1:Bo(e))<0?0:e,r):[]},pr.dropRight=function(t,e,n){var r=null==t?0:t.length;return r?Oi(t,0,(e=r-(e=n||e===s?1:Bo(e)))<0?0:e):[]},pr.dropRightWhile=function(t,e){return t&&t.length?Bi(t,Es(e,3),!0,!0):[]},pr.dropWhile=function(t,e){return t&&t.length?Bi(t,Es(e,3),!0):[]},pr.fill=function(t,e,n,r){var i=null==t?0:t.length;return i?(n&&"number"!=typeof n&&Gs(t,e,n)&&(n=0,r=i),function(t,e,n,r){var i=t.length;for((n=Bo(n))<0&&(n=-n>i?0:i+n),(r=r===s||r>i?i:Bo(r))<0&&(r+=i),r=n>r?0:Uo(r);n<r;)t[n++]=e;return t}(t,e,n,r)):[]},pr.filter=function(t,e){return(go(t)?Ye:qr)(t,Es(e,3))},pr.flatMap=function(t,e){return Vr(Xa(t,e),1)},pr.flatMapDeep=function(t,e){return Vr(Xa(t,e),M)},pr.flatMapDepth=function(t,e,n){return n=n===s?1:Bo(n),Vr(Xa(t,e),n)},pr.flatten=ga,pr.flattenDeep=function(t){return null!=t&&t.length?Vr(t,M):[]},pr.flattenDepth=function(t,e){return null!=t&&t.length?Vr(t,e=e===s?1:Bo(e)):[]},pr.flip=function(t){return Ps(t,T)},pr.flow=$l,pr.flowRight=Rl,pr.fromPairs=function(t){for(var e=-1,n=null==t?0:t.length,r={};++e<n;){var i=t[e];r[i[0]]=i[1]}return r},pr.functions=function(t){return null==t?[]:Yr(t,il(t))},pr.functionsIn=function(t){return null==t?[]:Yr(t,sl(t))},pr.groupBy=Wa,pr.initial=function(t){return null!=t&&t.length?Oi(t,0,-1):[]},pr.intersection=ya,pr.intersectionBy=wa,pr.intersectionWith=ba,pr.invert=el,pr.invertBy=nl,pr.invokeMap=Ga,pr.iteratee=Ol,pr.keyBy=Ja,pr.keys=il,pr.keysIn=sl,pr.map=Xa,pr.mapKeys=function(t,e){var n={};return e=Es(e,3),Jr(t,function(t,r,i){Mr(n,e(t,r,i),t)}),n},pr.mapValues=function(t,e){var n={};return e=Es(e,3),Jr(t,function(t,r,i){Mr(n,r,e(t,r,i))}),n},pr.matches=function(t){return pi(Er(t,f))},pr.matchesProperty=function(t,e){return vi(t,Er(e,f))},pr.memoize=ao,pr.merge=al,pr.mergeWith=ol,pr.method=Al,pr.methodOf=Ml,pr.mixin=Il,pr.negate=oo,pr.nthArg=function(t){return t=Bo(t),ki(function(e){return gi(e,t)})},pr.omit=ll,pr.omitBy=function(t,e){return ul(t,oo(Es(e)))},pr.once=function(t){return to(2,t)},pr.orderBy=function(t,e,n,r){return null==t?[]:(go(e)||(e=null==e?[]:[e]),go(n=r?s:n)||(n=null==n?[]:[n]),_i(t,e,n))},pr.over=El,pr.overArgs=lo,pr.overEvery=zl,pr.overSome=Dl,pr.partial=co,pr.partialRight=uo,pr.partition=Ya,pr.pick=cl,pr.pickBy=ul,pr.property=Nl,pr.propertyOf=function(t){return function(e){return null==t?s:Kr(t,e)}},pr.pull=Ca,pr.pullAll=ka,pr.pullAllBy=function(t,e,n){return t&&t.length&&e&&e.length?wi(t,e,Es(n,2)):t},pr.pullAllWith=function(t,e,n){return t&&t.length&&e&&e.length?wi(t,e,s,n):t},pr.pullAt=Pa,pr.range=Fl,pr.rangeRight=Bl,pr.rearg=ho,pr.reject=function(t,e){return(go(t)?Ye:qr)(t,oo(Es(e,3)))},pr.remove=function(t,e){var n=[];if(!t||!t.length)return n;var r=-1,i=[],s=t.length;for(e=Es(e,3);++r<s;){var a=t[r];e(a,r,t)&&(n.push(a),i.push(r))}return bi(t,i),n},pr.rest=function(t,e){if("function"!=typeof t)throw new ie(l);return ki(t,e=e===s?e:Bo(e))},pr.reverse=Ta,pr.sampleSize=function(t,e,n){return e=(n?Gs(t,e,n):e===s)?1:Bo(e),(go(t)?Tr:Ti)(t,e)},pr.set=function(t,e,n){return null==t?t:Si(t,e,n)},pr.setWith=function(t,e,n,r){return r="function"==typeof r?r:s,null==t?t:Si(t,e,n,r)},pr.shuffle=function(t){return(go(t)?Sr:ji)(t)},pr.slice=function(t,e,n){var r=null==t?0:t.length;return r?(n&&"number"!=typeof n&&Gs(t,e,n)?(e=0,n=r):(e=null==e?0:Bo(e),n=n===s?r:Bo(n)),Oi(t,e,n)):[]},pr.sortBy=Ka,pr.sortedUniq=function(t){return t&&t.length?Li(t):[]},pr.sortedUniqBy=function(t,e){return t&&t.length?Li(t,Es(e,2)):[]},pr.split=function(t,e,n){return n&&"number"!=typeof n&&Gs(t,e,n)&&(e=n=s),(n=n===s?z:n>>>0)?(t=Vo(t))&&("string"==typeof e||null!=e&&!Ao(e))&&!(e=zi(e))&&Pn(t)?Xi(Mn(t),0,n):t.split(e,n):[]},pr.spread=function(t,e){if("function"!=typeof t)throw new ie(l);return e=null==e?0:Wn(Bo(e),0),ki(function(n){var r=n[e],i=Xi(n,0,e);return r&&tn(i,r),Ve(t,this,i)})},pr.tail=function(t){var e=null==t?0:t.length;return e?Oi(t,1,e):[]},pr.take=function(t,e,n){return t&&t.length?Oi(t,0,(e=n||e===s?1:Bo(e))<0?0:e):[]},pr.takeRight=function(t,e,n){var r=null==t?0:t.length;return r?Oi(t,(e=r-(e=n||e===s?1:Bo(e)))<0?0:e,r):[]},pr.takeRightWhile=function(t,e){return t&&t.length?Bi(t,Es(e,3),!1,!0):[]},pr.takeWhile=function(t,e){return t&&t.length?Bi(t,Es(e,3)):[]},pr.tap=function(t,e){return e(t),t},pr.throttle=function(t,e,n){var r=!0,i=!0;if("function"!=typeof t)throw new ie(l);return So(n)&&(r="leading"in n?!!n.leading:r,i="trailing"in n?!!n.trailing:i),ro(t,e,{leading:r,maxWait:e,trailing:i})},pr.thru=Na,pr.toArray=No,pr.toPairs=hl,pr.toPairsIn=fl,pr.toPath=function(t){return go(t)?Qe(t,ca):Lo(t)?[t]:rs(la(Vo(t)))},pr.toPlainObject=qo,pr.transform=function(t,e,n){var r=go(t),i=r||bo(t)||Eo(t);if(e=Es(e,4),null==n){var s=t&&t.constructor;n=i?r?new s:[]:So(t)&&ko(s)?vr(Oe(t)):{}}return(i?Ge:Jr)(t,function(t,r,i){return e(n,t,r,i)}),n},pr.unary=function(t){return Qa(t,1)},pr.union=Sa,pr.unionBy=$a,pr.unionWith=Ra,pr.uniq=function(t){return t&&t.length?Di(t):[]},pr.uniqBy=function(t,e){return t&&t.length?Di(t,Es(e,2)):[]},pr.uniqWith=function(t,e){return e="function"==typeof e?e:s,t&&t.length?Di(t,s,e):[]},pr.unset=function(t,e){return null==t||Ni(t,e)},pr.unzip=ja,pr.unzipWith=Oa,pr.update=function(t,e,n){return null==t?t:Fi(t,e,Wi(n))},pr.updateWith=function(t,e,n,r){return r="function"==typeof r?r:s,null==t?t:Fi(t,e,Wi(n),r)},pr.values=dl,pr.valuesIn=function(t){return null==t?[]:_n(t,sl(t))},pr.without=Aa,pr.words=kl,pr.wrap=function(t,e){return co(Wi(e),t)},pr.xor=Ma,pr.xorBy=Ia,pr.xorWith=La,pr.zip=Ea,pr.zipObject=function(t,e){return qi(t||[],e||[],Rr)},pr.zipObjectDeep=function(t,e){return qi(t||[],e||[],Si)},pr.zipWith=za,pr.entries=hl,pr.entriesIn=fl,pr.extend=Go,pr.extendWith=Jo,Il(pr,pr),pr.add=ql,pr.attempt=Pl,pr.camelCase=pl,pr.capitalize=vl,pr.ceil=Vl,pr.clamp=function(t,e,n){return n===s&&(n=e,e=s),n!==s&&(n=(n=Ho(n))==n?n:0),e!==s&&(e=(e=Ho(e))==e?e:0),Lr(Ho(t),e,n)},pr.clone=function(t){return Er(t,p)},pr.cloneDeep=function(t){return Er(t,f|p)},pr.cloneDeepWith=function(t,e){return Er(t,f|p,e="function"==typeof e?e:s)},pr.cloneWith=function(t,e){return Er(t,p,e="function"==typeof e?e:s)},pr.conformsTo=function(t,e){return null==e||zr(t,e,il(e))},pr.deburr=ml,pr.defaultTo=function(t,e){return null==t||t!=t?e:t},pr.divide=Wl,pr.endsWith=function(t,e,n){t=Vo(t),e=zi(e);var r=t.length,i=n=n===s?r:Lr(Bo(n),0,r);return(n-=e.length)>=0&&t.slice(n,i)==e},pr.eq=fo,pr.escape=function(t){return(t=Vo(t))&&Pt.test(t)?t.replace(Ct,Cn):t},pr.escapeRegExp=function(t){return(t=Vo(t))&&Mt.test(t)?t.replace(At,"\\$&"):t},pr.every=function(t,e,n){var r=go(t)?Xe:Ur;return n&&Gs(t,e,n)&&(e=s),r(t,Es(e,3))},pr.find=Ua,pr.findIndex=va,pr.findKey=function(t,e){return an(t,Es(e,3),Jr)},pr.findLast=Ha,pr.findLastIndex=ma,pr.findLastKey=function(t,e){return an(t,Es(e,3),Xr)},pr.floor=Gl,pr.forEach=qa,pr.forEachRight=Va,pr.forIn=function(t,e){return null==t?t:Wr(t,Es(e,3),sl)},pr.forInRight=function(t,e){return null==t?t:Gr(t,Es(e,3),sl)},pr.forOwn=function(t,e){return t&&Jr(t,Es(e,3))},pr.forOwnRight=function(t,e){return t&&Xr(t,Es(e,3))},pr.get=Qo,pr.gt=po,pr.gte=vo,pr.has=function(t,e){return null!=t&&Hs(t,e,ei)},pr.hasIn=tl,pr.head=_a,pr.identity=jl,pr.includes=function(t,e,n,r){t=yo(t)?t:dl(t),n=n&&!r?Bo(n):0;var i=t.length;return n<0&&(n=Wn(i+n,0)),Io(t)?n<=i&&t.indexOf(e,n)>-1:!!i&&ln(t,e,n)>-1},pr.indexOf=function(t,e,n){var r=null==t?0:t.length;if(!r)return-1;var i=null==n?0:Bo(n);return i<0&&(i=Wn(r+i,0)),ln(t,e,i)},pr.inRange=function(t,e,n){return e=Fo(e),n===s?(n=e,e=0):n=Fo(n),function(t,e,n){return t>=Gn(e,n)&&t<Wn(e,n)}(t=Ho(t),e,n)},pr.invoke=rl,pr.isArguments=mo,pr.isArray=go,pr.isArrayBuffer=_o,pr.isArrayLike=yo,pr.isArrayLikeObject=wo,pr.isBoolean=function(t){return!0===t||!1===t||$o(t)&&Qr(t)==q},pr.isBuffer=bo,pr.isDate=xo,pr.isElement=function(t){return $o(t)&&1===t.nodeType&&!Oo(t)},pr.isEmpty=function(t){if(null==t)return!0;if(yo(t)&&(go(t)||"string"==typeof t||"function"==typeof t.splice||bo(t)||Eo(t)||mo(t)))return!t.length;var e=Us(t);if(e==Y||e==nt)return!t.size;if(Ks(t))return!ui(t).length;for(var n in t)if(ue.call(t,n))return!1;return!0},pr.isEqual=function(t,e){return ai(t,e)},pr.isEqualWith=function(t,e,n){var r=(n="function"==typeof n?n:s)?n(t,e):s;return r===s?ai(t,e,s,n):!!r},pr.isError=Co,pr.isFinite=function(t){return"number"==typeof t&&Hn(t)},pr.isFunction=ko,pr.isInteger=Po,pr.isLength=To,pr.isMap=Ro,pr.isMatch=function(t,e){return t===e||oi(t,e,Ds(e))},pr.isMatchWith=function(t,e,n){return n="function"==typeof n?n:s,oi(t,e,Ds(e),n)},pr.isNaN=function(t){return jo(t)&&t!=+t},pr.isNative=function(t){if(Ys(t))throw new Zt(o);return li(t)},pr.isNil=function(t){return null==t},pr.isNull=function(t){return null===t},pr.isNumber=jo,pr.isObject=So,pr.isObjectLike=$o,pr.isPlainObject=Oo,pr.isRegExp=Ao,pr.isSafeInteger=function(t){return Po(t)&&t>=-I&&t<=I},pr.isSet=Mo,pr.isString=Io,pr.isSymbol=Lo,pr.isTypedArray=Eo,pr.isUndefined=function(t){return t===s},pr.isWeakMap=function(t){return $o(t)&&Us(t)==at},pr.isWeakSet=function(t){return $o(t)&&Qr(t)==ot},pr.join=function(t,e){return null==t?"":qn.call(t,e)},pr.kebabCase=gl,pr.last=xa,pr.lastIndexOf=function(t,e,n){var r=null==t?0:t.length;if(!r)return-1;var i=r;return n!==s&&(i=(i=Bo(n))<0?Wn(r+i,0):Gn(i,r-1)),e==e?function(t,e,n){for(var r=n+1;r--;)if(t[r]===e)return r;return r}(t,e,i):on(t,un,i,!0)},pr.lowerCase=_l,pr.lowerFirst=yl,pr.lt=zo,pr.lte=Do,pr.max=function(t){return t&&t.length?Hr(t,jl,ti):s},pr.maxBy=function(t,e){return t&&t.length?Hr(t,Es(e,2),ti):s},pr.mean=function(t){return hn(t,jl)},pr.meanBy=function(t,e){return hn(t,Es(e,2))},pr.min=function(t){return t&&t.length?Hr(t,jl,fi):s},pr.minBy=function(t,e){return t&&t.length?Hr(t,Es(e,2),fi):s},pr.stubArray=Ul,pr.stubFalse=Hl,pr.stubObject=function(){return{}},pr.stubString=function(){return""},pr.stubTrue=function(){return!0},pr.multiply=Xl,pr.nth=function(t,e){return t&&t.length?gi(t,Bo(e)):s},pr.noConflict=function(){return Me._===this&&(Me._=ve),this},pr.noop=Ll,pr.now=Za,pr.pad=function(t,e,n){t=Vo(t);var r=(e=Bo(e))?An(t):0;if(!e||r>=e)return t;var i=(e-r)/2;return _s(Fn(i),n)+t+_s(Nn(i),n)},pr.padEnd=function(t,e,n){t=Vo(t);var r=(e=Bo(e))?An(t):0;return e&&r<e?t+_s(e-r,n):t},pr.padStart=function(t,e,n){t=Vo(t);var r=(e=Bo(e))?An(t):0;return e&&r<e?_s(e-r,n)+t:t},pr.parseInt=function(t,e,n){return n||null==e?e=0:e&&(e=+e),Xn(Vo(t).replace(Lt,""),e||0)},pr.random=function(t,e,n){if(n&&"boolean"!=typeof n&&Gs(t,e,n)&&(e=n=s),n===s&&("boolean"==typeof e?(n=e,e=s):"boolean"==typeof t&&(n=t,t=s)),t===s&&e===s?(t=0,e=1):(t=Fo(t),e===s?(e=t,t=0):e=Fo(e)),t>e){var r=t;t=e,e=r}if(n||t%1||e%1){var i=Yn();return Gn(t+i*(e-t+Re("1e-"+((i+"").length-1))),e)}return xi(t,e)},pr.reduce=function(t,e,n){var r=go(t)?en:pn,i=arguments.length<3;return r(t,Es(e,4),n,i,Fr)},pr.reduceRight=function(t,e,n){var r=go(t)?nn:pn,i=arguments.length<3;return r(t,Es(e,4),n,i,Br)},pr.repeat=function(t,e,n){return e=(n?Gs(t,e,n):e===s)?1:Bo(e),Ci(Vo(t),e)},pr.replace=function(){var t=arguments,e=Vo(t[0]);return t.length<3?e:e.replace(t[1],t[2])},pr.result=function(t,e,n){var r=-1,i=(e=Gi(e,t)).length;for(i||(i=1,t=s);++r<i;){var a=null==t?s:t[ca(e[r])];a===s&&(r=i,a=n),t=ko(a)?a.call(t):a}return t},pr.round=Yl,pr.runInContext=t,pr.sample=function(t){return(go(t)?Pr:Pi)(t)},pr.size=function(t){if(null==t)return 0;if(yo(t))return Io(t)?An(t):t.length;var e=Us(t);return e==Y||e==nt?t.size:ui(t).length},pr.snakeCase=wl,pr.some=function(t,e,n){var r=go(t)?rn:Ai;return n&&Gs(t,e,n)&&(e=s),r(t,Es(e,3))},pr.sortedIndex=function(t,e){return Mi(t,e)},pr.sortedIndexBy=function(t,e,n){return Ii(t,e,Es(n,2))},pr.sortedIndexOf=function(t,e){var n=null==t?0:t.length;if(n){var r=Mi(t,e);if(r<n&&fo(t[r],e))return r}return-1},pr.sortedLastIndex=function(t,e){return Mi(t,e,!0)},pr.sortedLastIndexBy=function(t,e,n){return Ii(t,e,Es(n,2),!0)},pr.sortedLastIndexOf=function(t,e){if(null!=t&&t.length){var n=Mi(t,e,!0)-1;if(fo(t[n],e))return n}return-1},pr.startCase=bl,pr.startsWith=function(t,e,n){return t=Vo(t),n=null==n?0:Lr(Bo(n),0,t.length),e=zi(e),t.slice(n,n+e.length)==e},pr.subtract=Kl,pr.sum=function(t){return t&&t.length?vn(t,jl):0},pr.sumBy=function(t,e){return t&&t.length?vn(t,Es(e,2)):0},pr.template=function(t,e,n){var r=pr.templateSettings;n&&Gs(t,e,n)&&(e=s),t=Vo(t),e=Jo({},e,r,Ts);var i,a,o=Jo({},e.imports,r.imports,Ts),l=il(o),c=_n(o,l),u=0,h=e.interpolate||Yt,f="__p += '",d=ne((e.escape||Yt).source+"|"+h.source+"|"+(h===$t?Ut:Yt).source+"|"+(e.evaluate||Yt).source+"|$","g"),p="//# sourceURL="+("sourceURL"in e?e.sourceURL:"lodash.templateSources["+ ++Pe+"]")+"\n";t.replace(d,function(e,n,r,s,o,l){return r||(r=s),f+=t.slice(u,l).replace(Kt,kn),n&&(i=!0,f+="' +\n__e("+n+") +\n'"),o&&(a=!0,f+="';\n"+o+";\n__p += '"),r&&(f+="' +\n((__t = ("+r+")) == null ? '' : __t) +\n'"),u=l+e.length,e}),f+="';\n";var v=e.variable;v||(f="with (obj) {\n"+f+"\n}\n"),f=(a?f.replace(yt,""):f).replace(wt,"$1").replace(bt,"$1;"),f="function("+(v||"obj")+") {\n"+(v?"":"obj || (obj = {});\n")+"var __t, __p = ''"+(i?", __e = _.escape":"")+(a?", __j = Array.prototype.join;\nfunction print() { __p += __j.call(arguments, '') }\n":";\n")+f+"return __p\n}";var m=Pl(function(){return Qt(l,p+"return "+f).apply(s,c)});if(m.source=f,Co(m))throw m;return m},pr.times=function(t,e){if((t=Bo(t))<1||t>I)return[];var n=z,r=Gn(t,z);e=Es(e),t-=z;for(var i=mn(r,e);++n<t;)e(n);return i},pr.toFinite=Fo,pr.toInteger=Bo,pr.toLength=Uo,pr.toLower=function(t){return Vo(t).toLowerCase()},pr.toNumber=Ho,pr.toSafeInteger=function(t){return t?Lr(Bo(t),-I,I):0===t?t:0},pr.toString=Vo,pr.toUpper=function(t){return Vo(t).toUpperCase()},pr.trim=function(t,e,n){if((t=Vo(t))&&(n||e===s))return t.replace(It,"");if(!t||!(e=zi(e)))return t;var r=Mn(t),i=Mn(e);return Xi(r,wn(r,i),bn(r,i)+1).join("")},pr.trimEnd=function(t,e,n){if((t=Vo(t))&&(n||e===s))return t.replace(Et,"");if(!t||!(e=zi(e)))return t;var r=Mn(t);return Xi(r,0,bn(r,Mn(e))+1).join("")},pr.trimStart=function(t,e,n){if((t=Vo(t))&&(n||e===s))return t.replace(Lt,"");if(!t||!(e=zi(e)))return t;var r=Mn(t);return Xi(r,wn(r,Mn(e))).join("")},pr.truncate=function(t,e){var n=S,r=$;if(So(e)){var i="separator"in e?e.separator:i;n="length"in e?Bo(e.length):n,r="omission"in e?zi(e.omission):r}var a=(t=Vo(t)).length;if(Pn(t)){var o=Mn(t);a=o.length}if(n>=a)return t;var l=n-An(r);if(l<1)return r;var c=o?Xi(o,0,l).join(""):t.slice(0,l);if(i===s)return c+r;if(o&&(l+=c.length-l),Ao(i)){if(t.slice(l).search(i)){var u,h=c;for(i.global||(i=ne(i.source,Vo(Ht.exec(i))+"g")),i.lastIndex=0;u=i.exec(h);)var f=u.index;c=c.slice(0,f===s?l:f)}}else if(t.indexOf(zi(i),l)!=l){var d=c.lastIndexOf(i);d>-1&&(c=c.slice(0,d))}return c+r},pr.unescape=function(t){return(t=Vo(t))&&kt.test(t)?t.replace(xt,In):t},pr.uniqueId=function(t){var e=++he;return Vo(t)+e},pr.upperCase=xl,pr.upperFirst=Cl,pr.each=qa,pr.eachRight=Va,pr.first=_a,Il(pr,(Jl={},Jr(pr,function(t,e){ue.call(pr.prototype,e)||(Jl[e]=t)}),Jl),{chain:!1}),pr.VERSION="4.17.5",Ge(["bind","bindKey","curry","curryRight","partial","partialRight"],function(t){pr[t].placeholder=pr}),Ge(["drop","take"],function(t,e){_r.prototype[t]=function(n){n=n===s?1:Wn(Bo(n),0);var r=this.__filtered__&&!e?new _r(this):this.clone();return r.__filtered__?r.__takeCount__=Gn(n,r.__takeCount__):r.__views__.push({size:Gn(n,z),type:t+(r.__dir__<0?"Right":"")}),r},_r.prototype[t+"Right"]=function(e){return this.reverse()[t](e).reverse()}}),Ge(["filter","map","takeWhile"],function(t,e){var n=e+1,r=n==O||3==n;_r.prototype[t]=function(t){var e=this.clone();return e.__iteratees__.push({iteratee:Es(t,3),type:n}),e.__filtered__=e.__filtered__||r,e}}),Ge(["head","last"],function(t,e){var n="take"+(e?"Right":"");_r.prototype[t]=function(){return this[n](1).value()[0]}}),Ge(["initial","tail"],function(t,e){var n="drop"+(e?"":"Right");_r.prototype[t]=function(){return this.__filtered__?new _r(this):this[n](1)}}),_r.prototype.compact=function(){return this.filter(jl)},_r.prototype.find=function(t){return this.filter(t).head()},_r.prototype.findLast=function(t){return this.reverse().find(t)},_r.prototype.invokeMap=ki(function(t,e){return"function"==typeof t?new _r(this):this.map(function(n){return ii(n,t,e)})}),_r.prototype.reject=function(t){return this.filter(oo(Es(t)))},_r.prototype.slice=function(t,e){t=Bo(t);var n=this;return n.__filtered__&&(t>0||e<0)?new _r(n):(t<0?n=n.takeRight(-t):t&&(n=n.drop(t)),e!==s&&(n=(e=Bo(e))<0?n.dropRight(-e):n.take(e-t)),n)},_r.prototype.takeRightWhile=function(t){return this.reverse().takeWhile(t).reverse()},_r.prototype.toArray=function(){return this.take(z)},Jr(_r.prototype,function(t,e){var n=/^(?:filter|find|map|reject)|While$/.test(e),r=/^(?:head|last)$/.test(e),i=pr[r?"take"+("last"==e?"Right":""):e],a=r||/^find/.test(e);i&&(pr.prototype[e]=function(){var e=this.__wrapped__,o=r?[1]:arguments,l=e instanceof _r,c=o[0],u=l||go(e),h=function(t){var e=i.apply(pr,tn([t],o));return r&&f?e[0]:e};u&&n&&"function"==typeof c&&1!=c.length&&(l=u=!1);var f=this.__chain__,d=!!this.__actions__.length,p=a&&!f,v=l&&!d;if(!a&&u){e=v?e:new _r(this);var m=t.apply(e,o);return m.__actions__.push({func:Na,args:[h],thisArg:s}),new gr(m,f)}return p&&v?t.apply(this,o):(m=this.thru(h),p?r?m.value()[0]:m.value():m)})}),Ge(["pop","push","shift","sort","splice","unshift"],function(t){var e=se[t],n=/^(?:push|sort|unshift)$/.test(t)?"tap":"thru",r=/^(?:pop|shift)$/.test(t);pr.prototype[t]=function(){var t=arguments;if(r&&!this.__chain__){var i=this.value();return e.apply(go(i)?i:[],t)}return this[n](function(n){return e.apply(go(n)?n:[],t)})}}),Jr(_r.prototype,function(t,e){var n=pr[e];if(n){var r=n.name+"";(sr[r]||(sr[r]=[])).push({name:e,func:n})}}),sr[ps(s,_).name]=[{name:"wrapper",func:s}],_r.prototype.clone=function(){var t=new _r(this.__wrapped__);return t.__actions__=rs(this.__actions__),t.__dir__=this.__dir__,t.__filtered__=this.__filtered__,t.__iteratees__=rs(this.__iteratees__),t.__takeCount__=this.__takeCount__,t.__views__=rs(this.__views__),t},_r.prototype.reverse=function(){if(this.__filtered__){var t=new _r(this);t.__dir__=-1,t.__filtered__=!0}else(t=this.clone()).__dir__*=-1;return t},_r.prototype.value=function(){var t=this.__wrapped__.value(),e=this.__dir__,n=go(t),r=e<0,i=n?t.length:0,s=function(t,e,n){for(var r=-1,i=n.length;++r<i;){var s=n[r],a=s.size;switch(s.type){case"drop":t+=a;break;case"dropRight":e-=a;break;case"take":e=Gn(e,t+a);break;case"takeRight":t=Wn(t,e-a)}}return{start:t,end:e}}(0,i,this.__views__),a=s.start,o=s.end,l=o-a,c=r?o:a-1,u=this.__iteratees__,h=u.length,f=0,d=Gn(l,this.__takeCount__);if(!n||!r&&i==l&&d==l)return Ui(t,this.__actions__);var p=[];t:for(;l--&&f<d;){for(var v=-1,m=t[c+=e];++v<h;){var g=u[v],_=g.iteratee,y=g.type,w=_(m);if(y==A)m=w;else if(!w){if(y==O)continue t;break t}}p[f++]=m}return p},pr.prototype.at=Fa,pr.prototype.chain=function(){return Da(this)},pr.prototype.commit=function(){return new gr(this.value(),this.__chain__)},pr.prototype.next=function(){this.__values__===s&&(this.__values__=No(this.value()));var t=this.__index__>=this.__values__.length;return{done:t,value:t?s:this.__values__[this.__index__++]}},pr.prototype.plant=function(t){for(var e,n=this;n instanceof mr;){var r=ha(n);r.__index__=0,r.__values__=s,e?i.__wrapped__=r:e=r;var i=r;n=n.__wrapped__}return i.__wrapped__=t,e},pr.prototype.reverse=function(){var t=this.__wrapped__;if(t instanceof _r){var e=t;return this.__actions__.length&&(e=new _r(this)),(e=e.reverse()).__actions__.push({func:Na,args:[Ta],thisArg:s}),new gr(e,this.__chain__)}return this.thru(Ta)},pr.prototype.toJSON=pr.prototype.valueOf=pr.prototype.value=function(){return Ui(this.__wrapped__,this.__actions__)},pr.prototype.first=pr.prototype.head,De&&(pr.prototype[De]=function(){return this}),pr}();Me._=Ln,(i=function(){return Ln}.call(e,n,e,r))===s||(r.exports=i)}).call(this)}).call(e,n("DuR2"),n("3IRH")(t))},Mk6O:function(t,e,n){var r,i;i=function(t){var e=["N","E","A","D"];function n(t,e){t.super_=e,t.prototype=Object.create(e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}})}function r(t,e){Object.defineProperty(this,"kind",{value:t,enumerable:!0}),e&&e.length&&Object.defineProperty(this,"path",{value:e,enumerable:!0})}function i(t,e,n){i.super_.call(this,"E",t),Object.defineProperty(this,"lhs",{value:e,enumerable:!0}),Object.defineProperty(this,"rhs",{value:n,enumerable:!0})}function s(t,e){s.super_.call(this,"N",t),Object.defineProperty(this,"rhs",{value:e,enumerable:!0})}function a(t,e){a.super_.call(this,"D",t),Object.defineProperty(this,"lhs",{value:e,enumerable:!0})}function o(t,e,n){o.super_.call(this,"A",t),Object.defineProperty(this,"index",{value:e,enumerable:!0}),Object.defineProperty(this,"item",{value:n,enumerable:!0})}function l(t,e,n){var r=t.slice((n||e)+1||t.length);return t.length=e<0?t.length+e:e,t.push.apply(t,r),t}function c(t){var e=typeof t;return"object"!==e?e:t===Math?"math":null===t?"null":Array.isArray(t)?"array":"[object Date]"===Object.prototype.toString.call(t)?"date":"function"==typeof t.toString&&/^\/.*\//.test(t.toString())?"regexp":"object"}function u(t){var e=0;if(0===t.length)return e;for(var n=0;n<t.length;n++){var r=t.charCodeAt(n);e=(e<<5)-e+r,e&=e}return e}function h(t){var e=0,n=c(t);if("array"===n){t.forEach(function(t){e+=h(t)});var r="[type: array, hash: "+e+"]";return e+u(r)}if("object"===n){for(var i in t)if(t.hasOwnProperty(i)){var s="[ type: object, key: "+i+", value hash: "+h(t[i])+"]";e+=u(s)}return e}var a="[ type: "+n+" ; value: "+t+"]";return e+u(a)}function f(t,e,n,r,l,u,d,p){n=n||[],l=l||[],d=d||[];var v=l.slice(0);if(void 0!==u&&null!==u){if(r){if("function"==typeof r&&r(v,u))return;if("object"==typeof r){if(r.prefilter&&r.prefilter(v,u))return;if(r.normalize){var m=r.normalize(v,u,t,e);m&&(t=m[0],e=m[1])}}}v.push(u)}"regexp"===c(t)&&"regexp"===c(e)&&(t=t.toString(),e=e.toString());var g,_,y,w,b=typeof t,x=typeof e,C="undefined"!==b||d&&d.length>0&&d[d.length-1].lhs&&Object.getOwnPropertyDescriptor(d[d.length-1].lhs,u),k="undefined"!==x||d&&d.length>0&&d[d.length-1].rhs&&Object.getOwnPropertyDescriptor(d[d.length-1].rhs,u);if(!C&&k)n.push(new s(v,e));else if(!k&&C)n.push(new a(v,t));else if(c(t)!==c(e))n.push(new i(v,t,e));else if("date"===c(t)&&t-e!=0)n.push(new i(v,t,e));else if("object"===b&&null!==t&&null!==e){for(g=d.length-1;g>-1;--g)if(d[g].lhs===t){w=!0;break}if(w)t!==e&&n.push(new i(v,t,e));else{if(d.push({lhs:t,rhs:e}),Array.isArray(t)){for(p&&(t.sort(function(t,e){return h(t)-h(e)}),e.sort(function(t,e){return h(t)-h(e)})),g=e.length-1,_=t.length-1;g>_;)n.push(new o(v,g,new s(void 0,e[g--])));for(;_>g;)n.push(new o(v,_,new a(void 0,t[_--])));for(;g>=0;--g)f(t[g],e[g],n,r,v,g,d,p)}else{var P=Object.keys(t),T=Object.keys(e);for(g=0;g<P.length;++g)y=P[g],(w=T.indexOf(y))>=0?(f(t[y],e[y],n,r,v,y,d,p),T[w]=null):f(t[y],void 0,n,r,v,y,d,p);for(g=0;g<T.length;++g)(y=T[g])&&f(void 0,e[y],n,r,v,y,d,p)}d.length=d.length-1}}else t!==e&&("number"===b&&isNaN(t)&&isNaN(e)||n.push(new i(v,t,e)))}function d(t,e,n,r,i){var s=[];if(f(t,e,s,r,null,null,null,i),n)for(var a=0;a<s.length;++a)n(s[a]);return s}function p(t,e,n,r){var i=r?function(t){t&&r.push(t)}:void 0,s=d(t,e,i,n);return r||(s.length?s:void 0)}function v(t,n,r){if(void 0===r&&n&&~e.indexOf(n.kind)&&(r=n),t&&r&&r.kind){for(var i=t,s=-1,a=r.path?r.path.length-1:0;++s<a;)void 0===i[r.path[s]]&&(i[r.path[s]]=void 0!==r.path[s+1]&&"number"==typeof r.path[s+1]?[]:{}),i=i[r.path[s]];switch(r.kind){case"A":r.path&&void 0===i[r.path[s]]&&(i[r.path[s]]=[]),function t(e,n,r){if(r.path&&r.path.length){var i,s=e[n],a=r.path.length-1;for(i=0;i<a;i++)s=s[r.path[i]];switch(r.kind){case"A":t(s[r.path[i]],r.index,r.item);break;case"D":delete s[r.path[i]];break;case"E":case"N":s[r.path[i]]=r.rhs}}else switch(r.kind){case"A":t(e[n],r.index,r.item);break;case"D":e=l(e,n);break;case"E":case"N":e[n]=r.rhs}return e}(r.path?i[r.path[s]]:i,r.index,r.item);break;case"D":delete i[r.path[s]];break;case"E":case"N":i[r.path[s]]=r.rhs}}}n(i,r),n(s,r),n(a,r),n(o,r),Object.defineProperties(p,{diff:{value:p,enumerable:!0},orderIndependentDiff:{value:function(t,e,n,r){var i=r?function(t){t&&r.push(t)}:void 0,s=d(t,e,i,n,!0);return r||(s.length?s:void 0)},enumerable:!0},observableDiff:{value:d,enumerable:!0},orderIndependentObservableDiff:{value:function(t,e,n,r,i,s,a){return f(t,e,n,r,i,s,a,!0)},enumerable:!0},orderIndepHash:{value:h,enumerable:!0},applyDiff:{value:function(t,e,n){t&&e&&d(t,e,function(r){n&&!n(t,e,r)||v(t,e,r)})},enumerable:!0},applyChange:{value:v,enumerable:!0},revertChange:{value:function(t,e,n){if(t&&e&&n&&n.kind){var r,i,s=t;for(i=n.path.length-1,r=0;r<i;r++)void 0===s[n.path[r]]&&(s[n.path[r]]={}),s=s[n.path[r]];switch(n.kind){case"A":!function t(e,n,r){if(r.path&&r.path.length){var i,s=e[n],a=r.path.length-1;for(i=0;i<a;i++)s=s[r.path[i]];switch(r.kind){case"A":t(s[r.path[i]],r.index,r.item);break;case"D":case"E":s[r.path[i]]=r.lhs;break;case"N":delete s[r.path[i]]}}else switch(r.kind){case"A":t(e[n],r.index,r.item);break;case"D":case"E":e[n]=r.lhs;break;case"N":e=l(e,n)}return e}(s[n.path[r]],n.index,n.item);break;case"D":case"E":s[n.path[r]]=n.lhs;break;case"N":delete s[n.path[r]]}}},enumerable:!0},isConflict:{value:function(){return"undefined"!=typeof $conflict},enumerable:!0}}),p.DeepDiff=p,t&&(t.DeepDiff=p);return p}(this),void 0===(r=function(){return i}.call(e,n,e,t))||(t.exports=r)},NmLI:function(t,e,n){t.exports=n.p+"static/img/打点.4615a77.svg"},OMJi:function(t,e,n){(function(t,r){var i=/%[sdj%]/g;e.format=function(t){if(!g(t)){for(var e=[],n=0;n<arguments.length;n++)e.push(o(arguments[n]));return e.join(" ")}n=1;for(var r=arguments,s=r.length,a=String(t).replace(i,function(t){if("%%"===t)return"%";if(n>=s)return t;switch(t){case"%s":return String(r[n++]);case"%d":return Number(r[n++]);case"%j":try{return JSON.stringify(r[n++])}catch(t){return"[Circular]"}default:return t}}),l=r[n];n<s;l=r[++n])v(l)||!w(l)?a+=" "+l:a+=" "+o(l);return a},e.deprecate=function(n,i){if(_(t.process))return function(){return e.deprecate(n,i).apply(this,arguments)};if(!0===r.noDeprecation)return n;var s=!1;return function(){if(!s){if(r.throwDeprecation)throw new Error(i);r.traceDeprecation?console.trace(i):console.error(i),s=!0}return n.apply(this,arguments)}};var s,a={};function o(t,n){var r={seen:[],stylize:c};return arguments.length>=3&&(r.depth=arguments[2]),arguments.length>=4&&(r.colors=arguments[3]),p(n)?r.showHidden=n:n&&e._extend(r,n),_(r.showHidden)&&(r.showHidden=!1),_(r.depth)&&(r.depth=2),_(r.colors)&&(r.colors=!1),_(r.customInspect)&&(r.customInspect=!0),r.colors&&(r.stylize=l),u(r,t,r.depth)}function l(t,e){var n=o.styles[e];return n?"["+o.colors[n][0]+"m"+t+"["+o.colors[n][1]+"m":t}function c(t,e){return t}function u(t,n,r){if(t.customInspect&&n&&C(n.inspect)&&n.inspect!==e.inspect&&(!n.constructor||n.constructor.prototype!==n)){var i=n.inspect(r,t);return g(i)||(i=u(t,i,r)),i}var s=function(t,e){if(_(e))return t.stylize("undefined","undefined");if(g(e)){var n="'"+JSON.stringify(e).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return t.stylize(n,"string")}if(m(e))return t.stylize(""+e,"number");if(p(e))return t.stylize(""+e,"boolean");if(v(e))return t.stylize("null","null")}(t,n);if(s)return s;var a=Object.keys(n),o=function(t){var e={};return t.forEach(function(t,n){e[t]=!0}),e}(a);if(t.showHidden&&(a=Object.getOwnPropertyNames(n)),x(n)&&(a.indexOf("message")>=0||a.indexOf("description")>=0))return h(n);if(0===a.length){if(C(n)){var l=n.name?": "+n.name:"";return t.stylize("[Function"+l+"]","special")}if(y(n))return t.stylize(RegExp.prototype.toString.call(n),"regexp");if(b(n))return t.stylize(Date.prototype.toString.call(n),"date");if(x(n))return h(n)}var c,w="",k=!1,P=["{","}"];(d(n)&&(k=!0,P=["[","]"]),C(n))&&(w=" [Function"+(n.name?": "+n.name:"")+"]");return y(n)&&(w=" "+RegExp.prototype.toString.call(n)),b(n)&&(w=" "+Date.prototype.toUTCString.call(n)),x(n)&&(w=" "+h(n)),0!==a.length||k&&0!=n.length?r<0?y(n)?t.stylize(RegExp.prototype.toString.call(n),"regexp"):t.stylize("[Object]","special"):(t.seen.push(n),c=k?function(t,e,n,r,i){for(var s=[],a=0,o=e.length;a<o;++a)S(e,String(a))?s.push(f(t,e,n,r,String(a),!0)):s.push("");return i.forEach(function(i){i.match(/^\d+$/)||s.push(f(t,e,n,r,i,!0))}),s}(t,n,r,o,a):a.map(function(e){return f(t,n,r,o,e,k)}),t.seen.pop(),function(t,e,n){if(t.reduce(function(t,e){return 0,e.indexOf("\n")>=0&&0,t+e.replace(/\u001b\[\d\d?m/g,"").length+1},0)>60)return n[0]+(""===e?"":e+"\n ")+" "+t.join(",\n  ")+" "+n[1];return n[0]+e+" "+t.join(", ")+" "+n[1]}(c,w,P)):P[0]+w+P[1]}function h(t){return"["+Error.prototype.toString.call(t)+"]"}function f(t,e,n,r,i,s){var a,o,l;if((l=Object.getOwnPropertyDescriptor(e,i)||{value:e[i]}).get?o=l.set?t.stylize("[Getter/Setter]","special"):t.stylize("[Getter]","special"):l.set&&(o=t.stylize("[Setter]","special")),S(r,i)||(a="["+i+"]"),o||(t.seen.indexOf(l.value)<0?(o=v(n)?u(t,l.value,null):u(t,l.value,n-1)).indexOf("\n")>-1&&(o=s?o.split("\n").map(function(t){return"  "+t}).join("\n").substr(2):"\n"+o.split("\n").map(function(t){return"   "+t}).join("\n")):o=t.stylize("[Circular]","special")),_(a)){if(s&&i.match(/^\d+$/))return o;(a=JSON.stringify(""+i)).match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(a=a.substr(1,a.length-2),a=t.stylize(a,"name")):(a=a.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),a=t.stylize(a,"string"))}return a+": "+o}function d(t){return Array.isArray(t)}function p(t){return"boolean"==typeof t}function v(t){return null===t}function m(t){return"number"==typeof t}function g(t){return"string"==typeof t}function _(t){return void 0===t}function y(t){return w(t)&&"[object RegExp]"===k(t)}function w(t){return"object"==typeof t&&null!==t}function b(t){return w(t)&&"[object Date]"===k(t)}function x(t){return w(t)&&("[object Error]"===k(t)||t instanceof Error)}function C(t){return"function"==typeof t}function k(t){return Object.prototype.toString.call(t)}function P(t){return t<10?"0"+t.toString(10):t.toString(10)}e.debuglog=function(t){if(_(s)&&(s=Object({NODE_ENV:"production"}).NODE_DEBUG||""),t=t.toUpperCase(),!a[t])if(new RegExp("\\b"+t+"\\b","i").test(s)){var n=r.pid;a[t]=function(){var r=e.format.apply(e,arguments);console.error("%s %d: %s",t,n,r)}}else a[t]=function(){};return a[t]},e.inspect=o,o.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},o.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"},e.isArray=d,e.isBoolean=p,e.isNull=v,e.isNullOrUndefined=function(t){return null==t},e.isNumber=m,e.isString=g,e.isSymbol=function(t){return"symbol"==typeof t},e.isUndefined=_,e.isRegExp=y,e.isObject=w,e.isDate=b,e.isError=x,e.isFunction=C,e.isPrimitive=function(t){return null===t||"boolean"==typeof t||"number"==typeof t||"string"==typeof t||"symbol"==typeof t||void 0===t},e.isBuffer=n("fC4T");var T=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function S(t,e){return Object.prototype.hasOwnProperty.call(t,e)}e.log=function(){var t,n;console.log("%s - %s",(t=new Date,n=[P(t.getHours()),P(t.getMinutes()),P(t.getSeconds())].join(":"),[t.getDate(),T[t.getMonth()],n].join(" ")),e.format.apply(e,arguments))},e.inherits=n("LC74"),e._extend=function(t,e){if(!e||!w(e))return t;for(var n=Object.keys(e),r=n.length;r--;)t[n[r]]=e[n[r]];return t}}).call(e,n("DuR2"),n("W2nU"))},Qar8:function(t,e,n){t.exports=n.p+"static/img/多边形.838184f.svg"},SfvY:function(t,e,n){"use strict";var r,i=n("I9+T"),s=n("k5KV"),a=n.n(s),o=n("jyVo"),l={props:["slice","record","roilist","curRois","centerRegion","penColor","position","content","companyid","showMppGuide","cellArea","showLayer","moveStatus","radius","filled","currentAngle","hiddenPen","hiddenPickTool"],data(){return{mpp:this.slice.mppx||.242042,scale:1,fullPage:!1,osd:null,company:this.$props.companyid||Object(o.r)().company,viewport:null,paper:null,selectedTool:"choose",dataMapPath:{},offsetWidth:0,offsetHeight:0,showRoi:!0,saved:!1,showLabel:!0,knew:!1,drawMpp:!1,userMpp:null,deg:0,layers:[null,null,null,null,null,null],showPenTool:!1,pentool:"freepen",scope:null,pointAble:["ki67","er","pr","pdl1","tagging","fish","ki67hot","her2","np","cd30"].includes(this.slice.toolType),reverseAble:!1,showRadius:!1,newRadius:this.radius,segmentsList:[],areaTimeLoop:null,continueRoi:null}},methods:{adjustSegment(){Object.keys(this.curRois).length?this.selectedTool="pickTool":this.$message.warning("请先选择一个调整对象")},toNumber(){this.newRadius=this.newRadius.replace(/[^\.\d]/g,"")},checkTool(t){this.showPenTool=!1,this.pentool=t,this.selectedTool=t},chooseTool(){this.pentool==this.selectedTool&&(this.showPenTool=!this.showPenTool),this.selectedTool=this.pentool},rotate(){this.deg+=90,this.$refs.rotate.style.transform=`rotate(${this.deg}deg)`},drawCell(){this.$emit("closeMppGuide",!0),this.drawMpp=!0,this.selectedTool="rectangle"},convertPoint(t,e){return this.paper.view.viewToProject(new this.paper.Point(t,e))},initOSD(){let t=OpenSeadragon({element:this.$refs.osd,tileSources:{height:this.slice.height,width:this.slice.width,tileSize:this.slice.tileSize||1024,getTileUrl:(t,e,n)=>`/aipath/api/files/slice?x=${e}&y=${n}&z=${t}&caseid=${this.record.id}&fileid=${this.slice.id}&companyid=${this.company}&filename=${encodeURIComponent(this.slice.filename||this.slice.name)}`},minZoomLevel:.001,maxZoomLevel:1e4,visibilityRatio:.01,toolbar:this.$refs.hideToolbar,mouseNavEnabled:!1,animationTime:.8,maxImageCacheCount:12,immediately:!0,showNavigator:!0,navigatorPosition:"TOP_LEFT",navigatorAutoFade:!1});this.osd=t,this.viewport=t.viewport,this.$emit("viewer",this.viewport),t.activateImagingHelper(),t.addHandler("open",()=>{this.paper=new paper.PaperScope,this.paper.activate(),this.paper.setup(this.$refs.canvas);let e=this.slice.mppx?2:5;this.paper.settings.handleSize=8,this.paper.settings.hitTolerance=e,this.layers[0]=new this.paper.Layer,this.layers[1]=new this.paper.Layer,this.layers[2]=new this.paper.Layer,this.layers[3]=new this.paper.Layer,this.layers[4]=new this.paper.Layer,this.layers[5]=new this.paper.Layer,this.roilistChange(this.roilist||[],[]),this.resized(),this.position.zoom?this.update(this.position,!0):this.buttonClick("home");let n=null;t.addHandler("update-viewport",()=>{let t=this.slice.width,{x:e,y:r}=this.viewport.getBounds(!0).getCenter();this.paper.view.rotation=this.currentAngle||0,this.paper.view.setCenter(e*t,r*t);let i=this.viewport.getZoom(!0);this.paper.view.zoom=this.viewport.viewportToImageZoom(i),clearTimeout(n),n=setTimeout(()=>{this.getRoi()},400)}),t.addHandler("animation-start",()=>{"pdl1"!=this.slice.toolType&&"np"!=this.slice.toolType||this.$emit("changeMoveStatus","moveStart")}),t.addHandler("animation-finish",()=>{let t=this.slice.width/this.slice.height,e=this.paper.view.getCenter().x/this.slice.width,n=this.paper.view.getCenter().y/this.slice.height/t;this.position.offx.toFixed(10)===e.toFixed(10)&&this.position.offy.toFixed(10)===n.toFixed(10)||this.move(e,n)})}),this.$refs.osd.addEventListener("contextmenu",this.contextmenu),window.addEventListener("resize",this.resize)},getRoi(){if(!this.paper.view)return;let t=parseInt(this.convertPoint(0,0).x),e=parseInt(this.convertPoint(0,0).y);if(this.$refs.osd){let t=this.$refs.osd.querySelector(".openseadragon-canvas").querySelector("canvas");var n=parseInt(this.convertPoint(t.width,t.height).x),r=parseInt(this.convertPoint(t.width,t.height).y)}let i=this.osd.world.getItemAt(0).lastDrawn,s=Math.max(...i.map(t=>t.level));this.$emit("getRoi",{x1:t,x2:n,y1:e,y2:r,z:s}),"pdl1"!=this.slice.toolType&&"np"!=this.slice.toolType||this.$emit("changeMoveStatus","moveEnd")},move(t,e,n){this.$emit("position","number"==typeof t?t:this.position.offx,"number"==typeof e?e:this.position.offy,"number"==typeof n?n:this.position.zoom)},update(t=this.position,e){this.viewport.zoomTo(t.zoom,"",e),this.viewport.panTo({x:t.offx,y:t.offy},e)},resize(){setTimeout(t=>this.resized(this.position.zoom/this.scale),0)},resized(t){this.offsetWidth=this.$refs.osd.offsetWidth,this.offsetHeight=this.$refs.osd.offsetHeight,this.paper.view.viewSize=[this.offsetWidth,this.offsetHeight],this.scale=this.mpp*this.slice.width*Math.min(this.offsetHeight/this.offsetWidth,1)/22e3,this.move(null,null,t?t*this.scale:null),t&&t*this.scale!=this.position.zoom||setTimeout(this.update,80)},navstart(t){if(t.button)return;let e=this.$refs.navigator;var n=t=>{t=c(t),this.move(t.offsetX/e.clientWidth,t.offsetY/e.clientHeight*this.slice.height/this.slice.width)},r=()=>{e.removeEventListener("mousemove",n),e.removeEventListener("touchmove",n),window.removeEventListener("mouseup",r)};e.addEventListener("mousemove",n),e.addEventListener("touchmove",n),window.addEventListener("mouseup",r),n(t)},handleFullScreen(){this.fullPage=!this.fullPage,this.$parent.$parent.fullPage=this.fullPage,this.resize()},buttonClick(t){switch(t){case"zoom-in":this.move(null,null,2*this.position.zoom);break;case"zoom-out":this.move(null,null,this.position.zoom/2);break;case"home":let e=this.slice.width/this.slice.height;this.move(.5,.5/e,Math.min(this.offsetHeight/this.offsetWidth*e,1));break;case"original":this.move(null,null,this.slice.width/this.offsetWidth);break;default:this.move(null,null,t)}},path2data:t=>({x:t.map(t=>t.point.x),y:t.map(t=>t.point.y)}),equal(t,e){if(t.length!==e.length)return!1;for(let n=0;n<t.length;n++)if(t[n].image!==e[n].image)return!1;return!0},roilistChange(t,e){let n={},r={};t.map(t=>{n[t.id]=t}),e.map(t=>{r[t.id]=t});let i=e.filter(t=>!a.a.equals(t,n[t.id])),s=t.filter(t=>!a.a.equals(t,r[t.id]));for(let t of i)this.dataMapPath[t.id]&&!this.curRois[t.id]&&(this.dataMapPath[t.id].text&&(this.dataMapPath[t.id].text.remove(),this.dataMapPath[t.id].rectangle.remove()),this.dataMapPath[t.id].path.remove(),delete this.dataMapPath[t.id]);let o=s.length,l=0,c=200;var u=this;o>0&&function t(){let e=l+c>s.length?s.length:l+c;if(!(l>o)){for(var n=l;n<e;n++)u.newRoi(s[n]);l+=c,t()}}(),this.setLayer(),this.roilist.forEach(t=>{this.showRoi?this.dataMapPath[t.id].path.selected=!!this.curRois[t.id]:this.dataMapPath[t.id].path.selected=!1,this.curRois[t.id]&&(clearTimeout(this.areaTimeLoop),this.drawArea(t))})},setLayer(){let t=Object.values(this.dataMapPath);var e={};let n=[...new Set(t.map(t=>t.data.mark_type))].map(t=>(e[t]=[],t));t.map(t=>{n.filter(e=>e==t.data.mark_type).length&&e[t.data.mark_type].push(t.path)}),Object.keys(e).length&&(this.layers[0].children=null,this.layers[1].children=e[3],this.layers[2].children=e[1],this.layers[3].children=e[2],this.layers[4].children=e[4],this.layers[5].children=e[5])},spliceArray(t){for(var e=void 0,n=0;n<t.x.length-1;n++){var r=t.x[n+1]-t.x[n],i=(t.y[n+1]-t.y[n])/r;(isNaN(e)&&isNaN(i)||i==e)&&(t.x.splice(n,1),t.y.splice(n,1),n--),e=i}return t},newRoi(t={editable:1,path:{x:[],y:[]}}){t=a.a.clone(t);let e,n={};if(this.paper.activate(),t.path.x.length>4&&(t.path=this.spliceArray(t.path)),e="spot"==t.method?new this.paper.Path.Circle({center:[4===t.path.x.length?t.path.x[1]:t.path.x[0],t.path.y[0]],radius:t.radius,strokeScaling:!1,fillColor:t.fillColor||"rgba(0,0,0,0.001)",strokeColor:t.strokeColor||null,owner:t,strokeWidth:3}):new this.paper.Path({segments:t.path.x.map((e,n)=>({x:e,y:t.path.y[n]})),strokeWidth:t.width||3,fillColor:t.fillColor||("secectMulty"==t.method?"rgba(255,255,255,0.5)":"rgba(0,0,0,0.001)"),strokeColor:t.strokeColor,strokeScaling:!1,owner:t,closed:!0,dashArray:t.dashed?[10,5]:[0,0]}),Object.assign(n,{path:e,dragCenter:!1,dragVertex:!1,dragEdge:!1,resetDragStatus(){this.dragCenter=this.dragVertex=this.dragEdge=!1}}),"freepen"==t.method||"freepenReverse"==t.method){var r=this;n.drag=function(t){this.dragVertex?(this.segment.point.x+=t.x,this.segment.point.y+=t.y):this.dragCenter&&(this.path.position.x+=t.x,this.path.position.y+=t.y)},n.checkPath=function(t,e){if(this.segment=null,this.resetDragStatus(),"segment"==e.type){this.segment=e.segment;let t=e.item;"pickTool"===r.selectedTool&&t.smooth({type:"catmull-rom",factor:.5,from:this.segment.previous.index,to:this.segment.next.index}),this.dragVertex=!0}else"fill"==e.type&&(this.dragCenter=!0)}}else if("rectangle"==t.method||"rectangleReverse"==t.method||"secectMulty"==t.method){r=this;n.drag=function(t){let e=(t,e)=>Math.abs(t-e)<1e-4;if(this.dragVertex){let n=this.segment.point.x,r=this.segment.point.y,i=n+t.x,s=r+t.y;this.path.segments.map(t=>{t.point.x=e(t.point.x,n)?i:t.point.x,t.point.y=e(t.point.y,r)?s:t.point.y})}else this.dragEdge?(e(this.editPt1.x,this.editPt2.x)&&(this.editPt1.x+=t.x,this.editPt2.x+=t.x),e(this.editPt1.y,this.editPt2.y)&&(this.editPt1.y+=t.y,this.editPt2.y+=t.y)):this.dragCenter&&this.path.segments.map(e=>{e.point.x+=t.x,e.point.y+=t.y})},n.checkPath=function(t,e){if(this.segment=this.editPt1=this.editPt2=null,this.resetDragStatus(),"segment"==e.type)this.segment=e.segment,this.dragVertex=!0;else if("stroke"==e.type){let t=e.location;this.editPt1=t.curve.point1,this.editPt2=t.curve.point2,this.dragEdge=!0}else"fill"==e.type&&(this.dragCenter=!0)}}else"spot"==t.method&&(n.drag=function(t){this.path.position.x+=t.x,this.path.position.y+=t.y,n.text&&(n.text.position.x+=t.x,n.text.position.y+=t.y,n.rectangle.position.x+=t.x,n.rectangle.position.y+=t.y)},n.checkPath=function(t,e){this.segment=null,this.resetDragStatus(),"segment"==e.type?(this.segment=e.segment,this.dragVertex=!0):"fill"==e.type&&(this.dragCenter=!0)});return n.data=t,n.path.visible=this.showRoi,n.path.selected=this.showRoi,this.dataMapPath[t.id]=n,n},drawText(t,e,n){let r=this.viewport.viewportToImageZoom(this.position.zoom);t.text=new this.paper.PointText({point:e,content:n,fillColor:"white",justification:"center",fontSize:14/r});let i={x:t.text.bounds.left-4/r,y:t.text.bounds.top-4/r},s={x:t.text.bounds.right+4/r,y:t.text.bounds.bottom+4/r};t.rectangle=new this.paper.Path.Rectangle(i,s,4/r),t.rectangle.fillColor="rgba(0,0,0,0.5)",this.paper.project.activeLayer.addChild(t.text),this.showRoi||(t.text.visible=!1,t.rectangle.visible=!1)},drawArea(t){this.paper.activate();let e=this.dataMapPath[t.id];e&&e.text&&(e.text.remove(),e.rectangle.remove());let n=this.viewport.viewportToImageZoom(this.position.zoom),r=0,i="";if(t.doctorDiagnosis){let e=t.doctorDiagnosis;Array.isArray(e)?(r=e.length,i=(e=e.map(t=>t.replace(";",">"))).join("\n")):(r=1,i=e.replace(";",">"))}if(t.cell_type){let e=t.cell_type;Array.isArray(e)?(r+=e.length,i+=(e=e.map(t=>t.replace(";",">"))).join("\n")):(r+=1,i+=e.replace(";",">"))}if("spot"==t.method){if(!i)return;let s={x:t.path.x.length>1?t.path.x[1]:t.path.x[0],y:(t.path.y.length>1?t.path.y[1]:t.path.y[0]-t.radius)-16.8*r/n};this.drawText(e,s,i)}else{let s=(t.path.x[0]+t.path.x[1])/2,a=Math.min.apply(null,t.path.y.map(t=>t));"freepen"!=t.method&&"freepenReverse"!=t.method||(a=Math.min.apply(null,t.path.y.map(t=>t)),s=t.path.x[t.path.y.findIndex(e=>e==Math.min.apply(null,t.path.y.map(t=>t)))]);let o="面积:"+Math.round(Math.abs(e.path.area)*Math.pow(this.mpp,2))+"μm²",l={x:s,y:a-(16.8*r+16)/n},c=i?o+"\n"+i:o;this.drawText(e,l,c)}},contextmenu(t){let e=this.convertPoint(t.offsetX,t.offsetY),n=this.paper.project.hitTest(e,{stroke:!0,segments:!0,fill:!0});if(!n)return;let r=n.item.owner.path,i=Math.max.apply(null,r.x.map(t=>t)),s=Math.max.apply(null,r.y.map(t=>t));"freepen"!=n.item.owner.method&&"freepenReverse"!=n.item.owner.method||(i=Math.max.apply(null,r.x.map(t=>t)),s=r.y[r.x.findIndex(t=>t==Math.max.apply(null,r.x.map(t=>t)))]);let a=this.paper.view.projectToView(new this.paper.Point(i,s));n&&(this.$emit("contextmenu",t,n.item.owner,a),this.selectedTool="choose")},keydown(t){let e=t.key;if("INPUT"!=t.target.nodeName)switch(e){case"Enter":if(this.continueRoi){let t=this.continueRoi.data.id;this.drawRoi(this.continueRoi),this.dataMapPath[t].path.remove(),delete this.dataMapPath[t],this.continueRoi=null}break;case"ArrowUp":t.ctrlKey||t.metaKey||this.move(null,this.position.offy-.95*this.viewport.getBounds().height);break;case"ArrowDown":t.ctrlKey||t.metaKey||this.move(null,this.position.offy+.95*this.viewport.getBounds().height);break;case"ArrowLeft":t.ctrlKey||t.metaKey||this.move(this.position.offx-.95*this.viewport.getBounds().width);break;case"ArrowRight":t.ctrlKey||t.metaKey||this.move(this.position.offx+.95*this.viewport.getBounds().width);break;case"Escape":if(this.continueRoi){let t=this.continueRoi.data.id;this.dataMapPath[t].path.remove(),delete this.dataMapPath[t],this.continueRoi=null}else this.fullPage&&this.handleFullScreen();break;case"F":case"f":this.selectedTool="freepen",this.pentool="freepen";break;case"R":case"r":this.selectedTool="rectangle",this.pentool="rectangle";break;case"P":case"p":this.selectedTool="dottingTool",this.pentool="dottingTool";break;case"D":case"d":this.selectedTool="continueTool",this.pentool="continueTool";break;case" ":this.selectedTool="choose";break;case"=":this.buttonClick("zoom-in");break;case"-":this.buttonClick("zoom-out");break;case"1":this.buttonClick("home");break;case"2":this.buttonClick(2*this.scale);break;case"3":this.buttonClick(4*this.scale);break;case"4":this.buttonClick(10*this.scale);break;case"5":this.buttonClick(20*this.scale);break;case"6":this.buttonClick(40*this.scale);break;case"7":this.buttonClick("original");break;case"8":this.handleFullScreen();break;case"Escape":this.fullPage&&this.handleFullScreen();break;case"A":case"a":if(t.ctrlKey||t.metaKey){t.preventDefault();let e=this.convertPoint(0,0),n=this.convertPoint(this.offsetWidth,this.offsetHeight),r=this.roilist.filter(t=>t.path.x.every(t=>t>e.x&&t<n.x)&&t.path.y.every(t=>t>e.y&&t<n.y));r.length&&this.$emit("curROI",r,!1)}}},wheel(t){if("dottingTool"==this.selectedTool)return;let e=t.wheelDeltaY>0?1.2:1/1.2;var n=this.viewport.pointFromPixel(new OpenSeadragon.Point(t.offsetX,t.offsetY)),r=this.position;this.move((r.offx-n.x)/e+n.x,(r.offy-n.y)/e+n.y,r.zoom*e)},getDistance(t,e){var n=Math.abs(e.pageX-t.pageX),r=Math.abs(e.pageY-t.pageY);return Math.sqrt(n*n+r*r)},isInPolygon(t,e){var n,r,i,s,a=0,o=e.length;for(i=e[0],n=1;n<=o;n++)s=e[n%o],t[0]>Math.min(i[0],s[0])&&t[0]<=Math.max(i[0],s[0])&&t[1]<=Math.max(i[1],s[1])&&i[0]!=s[0]&&(r=(t[0]-i[0])*(s[1]-i[1])/(s[0]-i[0])+i[1],(i[1]==s[1]||t[1]<=r)&&a++),i=s;return a%2!=0},mouseDown(t){this.$refs.osd.querySelector(".openseadragon-canvas").focus(),t.preventDefault(),this.$emit("mousedown");let e=c(t);var n,r,i=t=>{var i=c(t,this.$refs.osd);if(new paper.Point(d.x-i.x,d.y-i.y).length>5&&(p=!0),m)if(t.touches&&2==t.touches.length){let e=this.viewport.deltaPointsFromPixels(new paper.Point((f.touches[0].clientX+f.touches[1].clientX-t.touches[0].clientX-t.touches[1].clientX)/2,(f.touches[0].clientY+f.touches[1].clientY-t.touches[0].clientY-t.touches[1].clientY)/2)),n=Math.hypot(f.touches[0].clientX-f.touches[1].clientX,f.touches[0].clientY-f.touches[1].clientY),r=Math.hypot(t.touches[0].clientX-t.touches[1].clientX,t.touches[0].clientY-t.touches[1].clientY);this.move(this.position.offx+e.x,this.position.offy+e.y,this.position.zoom*r/n)}else{let t=this.viewport.deltaPointsFromPixels(new paper.Point(h.x-i.x,h.y-i.y));this.move(this.position.offx+t.x,this.position.offy+t.y)}else{let t=this.convertPoint(i.x-e.x+e.offsetX,i.y-e.y+e.offsetY);switch(this.selectedTool){case"choose":for(let t in this.curRois){var s=this.dataMapPath[t];if(this.curRoi.owner.id==t)if(0!=this.curRois[t].editable)if(s.dragVertex||s.dragEdge||"ki67hot"===this.slice.toolType&&"grey"===this.curRois[t].strokeColor||s.dragCenter&&"spot"===s.data.method){let t=this.convertPoint(0,0),e=this.convertPoint(i.x-h.x,i.y-h.y);e.x-=t.x,e.y-=t.y,s.drag(e)}else m=!0;else m=!0}break;case"pickTool":for(let t in this.curRois){s=this.dataMapPath[t];if(this.curRoi&&this.curRoi.owner.id==t){if(this.curRoi.segments.filter(t=>t.point.selected).length<3)return;if(0!=this.curRois[t].editable){let t=this.convertPoint(0,0),e=this.convertPoint(i.x-h.x,i.y-h.y);e.x-=t.x,e.y-=t.y,s.drag(e)}}}break;case"freepen":case"freepenReverse":case"secectMulty":this.curRoi.path.closed=!1,this.curRoi.path.fullySelected=!1,this.curRoi.path.add(t);break;case"continueTool":{let e=this.continueRoi.path.segments.length,n=this.continueRoi.path.segments[e-1].point,r=Math.sqrt(Math.pow(n.x-t.x,2)+Math.pow(n.y-t.y,2));console.log(r),r>10&&(this.continueRoi.path.closed=!1,this.continueRoi.path.add(t));break}case"rectangle":case"rectangleReverse":{let e=this.curRoi.path.segments[0].point;this.curRoi.path.removeSegments(),this.curRoi.path.addSegments([e,new this.paper.Point(t.x,e.y),t,new this.paper.Point(e.x,t.y)]);break}case"measure":{r&&r.remove(),n&&n.remove(),this.paper.activate(),(r=new this.paper.Path([v,t])).strokeWidth=2,r.strokeScaling=!1,r.strokeColor="#e4141b";let e=new this.paper.Point({x:t.x-v.x,y:t.y-v.y}),i=e.normalize(10/this.paper.view.zoom).rotate(Math.abs(e.angle)>90?90:-90);(n=new this.paper.PointText({point:{x:(t.x+v.x)/2+i.x,y:(v.y+t.y)/2+i.y},content:Math.round(100*e.length*this.mpp)/100+"μm",justification:"center",fontSize:14/this.paper.view.zoom})).rotate(Math.abs(e.angle)>90?180+e.angle:e.angle)}}this.paper.view.draw()}h={x:i.x,y:i.y},f=t},s=!1,l=t=>{if(t.cancelBubble=!0,t.preventDefault(),s=!0,window.removeEventListener("mousemove",i),window.removeEventListener("touchmove",i),window.removeEventListener("mouseup",l),window.removeEventListener("touchend",l),this.$refs.osd.removeEventListener("touchstart",_),t=t.changedTouches?u(t.changedTouches[0],this.$refs.osd):t,p){if(m)return;switch(this.selectedTool){case"freepen":case"rectangle":case"freepenReverse":case"rectangleReverse":this.drawRoi(this.curRoi,t.shiftKey,"removePath");break;case"secectMulty":{let t=this.curRoi.data;t.path=this.path2data(this.curRoi.path.segments);let e=t.path.x.map((e,n)=>[e,t.path.y[n]]),n=this.roilist.filter(t=>t.path.x.some((n,r)=>this.isInPolygon([n,t.path.y[r]],e)));if(this.curRoi.path.remove(),this.curRoi=null,n.length){this.scope={x:t.path.x,y:t.path.y};let e=this.slice.toolType;switch(this.slice.toolType){case"pdl1db":e="human";break;case"fish":e="fishTissue"}Object(o.b)(`slice/selectCount?companyid=${Object(o.r)().company}`,{caseid:this.record.id,fileid:this.slice.id,scope:JSON.stringify(this.scope),template_id:"tagging"==this.slice.toolType?this.slice.templateId:null,ai_type:e}).then(({data:t})=>{this.$message({showClose:!0,message:`已选中${t.select_count}个（可能包含隐藏标注）`,type:"warning",duration:3e3}),this.$emit("curROI",n,!1)}).catch(t=>{this.$alert(t.message,"提示",{confirmTextButtom:"确定"})})}else this.scope=null,this.$emit("curROI",null,!1);this.selectedTool="choose";break}case"choose":{let t=Object.assign({},Object.values(this.curRois)[0]),e=this.path2data(this.dataMapPath[t.id].path.segments),n=("spot"===t.method&&e.x.length>1?e.x[1]:e.x[0])-t.path.x[0],r=e.y[0]-t.path.y[0];this.scope&&(this.scope.offset=[n,r]),Object.values(this.curRois).map(t=>{t.path=this.path2data(this.dataMapPath[t.id].path.segments)}),this.$emit("curROI",Object.values(this.curRois),!1),a.a.equals(t.path,e)||this.$emit("roiChanged","path"),this.curRoi=null;break}case"pickTool":this.curRoi&&(this.dataMapPath[this.curRoi.owner.id].path.flatten(0),this.segmentsList=[],Object.values(this.curRois).map(t=>{t.path=this.path2data(this.dataMapPath[t.id].path.segments)}),this.$emit("curROI",Object.values(this.curRois),!1),this.$emit("roiChanged","path"),this.curRoi=null);break;case"measure":r.remove(),n.remove(),this.selectedTool="choose"}}else{let n=this.convertPoint(t.offsetX,t.offsetY);if("choose"==this.selectedTool){let e=this.getMinRoi(n);if(e){if(!e.item.owner)return;this.scope=null,"grey"==e.item.owner.strokeColor&&"ki67hot"==this.slice.toolType||this.$emit("curROI",e.item.owner,t.shiftKey),(t={offsetX:t.offsetX,offsetY:t.offsetY,type:t.type}).preventDefault||(t.preventDefault=(t=>0)),t.currentTarget=this.$refs.osd,this.$emit("contextmenu",t,e.item.owner)}else this.scope=null,this.$emit("curROI",null,t.shiftKey,0),this.curROI=null}else if("freepen"==this.selectedTool||"rectangle"==this.selectedTool||"freepenReverse"==this.selectedTool||"rectangleReverse"==this.selectedTool||"secectMulty"==this.selectedTool)delete this.dataMapPath[this.curRoi.id],this.curRoi.path.remove(),this.curRoi=null;else if("point"==this.selectedTool)this.$emit("clickDraw",n);else if("dottingTool"==this.selectedTool)if(this.polygonRoi){let n=this.convertPoint(t.x-e.x+e.offsetX,t.y-e.y+e.offsetY),r=this.polygonRoi.path.segments[0].point;if(Math.sqrt(Math.pow(r.x-n.x,2)+Math.pow(r.y-n.y,2))<8)return this.polygonRoi.path.closed=!0,this.polygonRoi.path.selected=!0,void this.drawRoi(this.polygonRoi);this.polygonRoi.path.closed=!1,this.polygonRoi.path.selected=!0,this.polygonRoi.path.add(n)}else this.polygonRoi=this.newRoi({path:{x:[n.x],y:[n.y]},method:"freepen",strokeColor:"yellow"})}if("continueTool"==this.selectedTool){let n=this.convertPoint(t.x-e.x+e.offsetX,t.y-e.y+e.offsetY),r=this.continueRoi.path.segments[0].point,i=Math.sqrt(Math.pow(r.x-n.x,2)+Math.pow(r.y-n.y,2)),s=this.continueRoi.path.segments.length;if(i<8&&s>3){let t=this.continueRoi.data.id;return this.continueRoi.path.closed=!0,this.drawRoi(this.continueRoi),this.dataMapPath[t].path.remove(),delete this.dataMapPath[t],void(this.continueRoi=null)}this.continueRoi.path.add(n),this.continueRoi.path.closed=!1}};if(e.button)return;let h={x:e.x,y:e.y},f=t,d=h,p=!1,v=this.convertPoint(e.offsetX,e.offsetY),m=!1;switch(this.selectedTool){case"choose":{let e=this.getMinRoi(v,"ki67hot"),n=Object.values(this.curRois).map(t=>this.dataMapPath[t.id]);n.some(t=>t.path==(e&&e.item))?(this.curRoi=e.item,n.map(t=>{t.checkPath(null,e)})):t.touches&&("stylus"==t.touches[0].touchType||t.touches[0].force<1)?(this.selectedTool="freepen",this.curRoi=this.newRoi({path:{x:[v.x],y:[v.y]},method:"freepen",strokeColor:this.penColor})):m=!0;break}case"pickTool":{let t=this.paper.project.hitTest(v,{fill:!0,stroke:!0,segments:!0});if(!t||!t.item.owner)return;if(t&&this.curRois[t.item.owner.id]&&"segment"===t.type&&"freepen"===t.item.owner.method&&0!=t.item.owner.editable){let e=t.segment,n=t.item,r=n.segments.filter(t=>t.point.selected).length;if(!this.segmentsList.length&&r<3)e.point.selected=!0,this.segmentsList.push(e);else if(1===this.segmentsList.length&&this.segmentsList[0].index!==e.index){e.point.selected=!0,this.segmentsList.push(e);let t=n.lastSegment.index,r=Math.min(this.segmentsList[0].index,this.segmentsList[1].index),i=Math.max(this.segmentsList[0].index,this.segmentsList[1].index),s=Math.abs(r-i),a=t-s+1,o=new paper.Point((this.segmentsList[0].point.x+this.segmentsList[1].point.x)/2,(this.segmentsList[0].point.y+this.segmentsList[1].point.y)/2);if(a>s){let t=n.segments.slice(r+1,i);for(var g=0;g<t.length;g++)n.removeSegment(t[g].index);n.insert(r+1,o),n.segments[r+1].point.selected=!0}else{let e=n.segments.slice(0,r),s=n.segments.slice(i+1,t+1),a=e.concat(s);for(let t=0;t<a.length;t++)n.removeSegment(a[t].index);n.insert(n.segments.length,o),n.segments[n.segments.length-1].point.selected=!0}this.segmentsList=[];let l=this.paper.project.hitTest(o,{fill:!0,stroke:!0,segments:!0});this.curRoi=l.item,this.dataMapPath[l.item.owner.id].checkPath(null,l)}}break}case"freepen":case"rectangle":case"secectMulty":this.curRoi=this.newRoi({path:{x:[v.x],y:[v.y]},method:this.selectedTool,strokeColor:this.drawMpp?"yellow":"secectMulty"==this.selectedTool?"#E3E9EF":this.penColor});break;case"continueTool":this.continueRoi||(this.continueRoi=this.newRoi({path:{x:[v.x],y:[v.y]},method:"freepen",strokeColor:this.penColor,mark_type:1,id:Math.floor(1e5*Math.random())}),this.curRoi=this.continueRoi);break;case"freepenReverse":case"rectangleReverse":this.curRoi=this.newRoi({path:{x:[v.x],y:[v.y]},method:this.selectedTool,strokeColor:"#E3E9EF",dashed:!0});break;case"point":let e=this.paper.project.hitTest(v,{fill:!0,stroke:!0,segments:!0});this.$emit("parentId",e?e.item.owner.id:null)}window.addEventListener("touchmove",i),window.addEventListener("mousemove",i),window.addEventListener("mouseup",l),window.addEventListener("touchend",l);var _=t=>{s||l(t)};this.$refs.osd.addEventListener("touchstart",_)},getMinRoi(t,e){let n=this.paper.project.hitTestAll(t,{fill:!0,stroke:!0,segments:!0});"ki67hot"!==this.slice.toolType||e||(n=n.filter(t=>"grey"!==t.item.owner.strokeColor));let r=null;if(n.length){let t=n.map(t=>Math.abs(t.item.area)),e=t[0],s=0;for(var i=0;i<t.length;i++)e>t[i]&&(e=t[i],s=i);r=n[s]}return r},dblclick(t){this.$refs.osd.querySelector(".openseadragon-canvas").focus();let e=this.convertPoint(t.offsetX,t.offsetY),n=this.getMinRoi(e,"ki67hot");n&&"grey"===n.item.owner.strokeColor&&"ki67hot"===this.slice.toolType&&this.$emit("curROI",n.item.owner)},drawRoi(t,e,n){let r=t.data;r.path=this.path2data(t.path.segments),delete this.dataMapPath[t.id],this.drawMpp?(this.userMpp=Math.sqrt((this.cellArea||200)/t.path.area).toFixed(4),"NaN"===this.userMpp||"Infinity"===this.userMpp?(this.$alert("您画的roi太小,请选择矩形工具重新画一个"),t.path.remove(),t=null):(this.mpp=this.userMpp,this.drawMpp=!1,this.knew=!0)):(n&&t.path.remove(),t=null,this.$emit("draw",r,e),this.scope=null),this.selectedTool="choose"},calculateAngle(t,e,n,r){var i=180*Math.atan2(r-e,n-t)/Math.PI;return i<0&&i<0?360+i:i},mousemoveNew(t){let e=this.convertPoint(t.offsetX,t.offsetY);r&&r.remove(),"pickTool"!==this.selectedTool&&"choose"!==this.selectedTool||(r=new this.paper.Path.Circle({center:[e.x,e.y],radius:this.slice.mppx?10:20,fillColor:"yellow"}),this.layers[0].children=[r]);var n=this.dataMapPath["1735489060899790848"].path.getIntersections(r);if(n.length){let t=n[0].point.x,r=n[1].point.x,i=n[0].point.y,s=n[1].point.y;const a=(({x:t,y:e},{x:n,y:r})=>{const i=t*n+e*r,s=t*r-e*n;return(Math.atan2(s,i)/Math.PI*180+360)%360})({x:r-e.x,y:s-e.y},{x:t-e.x,y:i-e.y});console.log(a)}}},created(){this.curRoi=null,this.polygonRoi=null},mounted(){this.initOSD(),this.$refs.osd.addEventListener("touchstart",this.mouseDown)},beforeDestroy(){window.removeEventListener("resize",this.resize),setTimeout(()=>{this.paper.view.remove(),this.osd.destroy()},800)},watch:{radius(t){this.newRadius=t},position:{handler(t){this.update(t)},deep:!0},selectedTool:{handler(t){switch(t){case"choose":case"pickTool":this.$refs.osd.querySelector(".openseadragon-canvas").style.cursor="pointer";break;case"freepen":case"rectangle":case"measure":case"point":case"freepenReverse":case"rectangleReverse":case"secectMulty":case"dottingTool":case"continueTool":this.$refs.osd.querySelector(".openseadragon-canvas").style.cursor="crosshair"}},deep:!0},"position.zoom":function(){setTimeout(t=>{for(let t in this.curRois)this.drawArea(this.curRois[t])},90)},showRoi(t){t?this.$emit("changeShowLayer",!0):this.$emit("changeShowLayer",!1);for(let e in this.dataMapPath)this.dataMapPath[e].path.visible=!!t,this.dataMapPath[e].path.selected=this.curRois[e]&&t,this.dataMapPath[e].text&&(this.dataMapPath[e].text.visible=!!t,this.dataMapPath[e].rectangle.visible=!!t)},roilist(t,e){this.roilistChange(t,e),this.polygonRoi=null},centerRegion([t,e,n,r]){let i,s=1.5*(n-t),a=1.5*(r-e),o=this.slice.width,l=(t+n)/2,c=(e+r)/2;i=s/a>this.offsetWidth/this.offsetHeight?o/s:o/a*this.offsetHeight/this.offsetWidth,this.slice.toolType&&(this.slice.toolType.includes("tct")||this.slice.toolType.includes("lct")||"dna"===this.slice.toolType)||"bm"===this.slice.toolType?this.move(l/o,c/o,Math.max(40*this.scale,this.position.zoom)):this.move(l/o,c/o,Math.min(i,this.position.zoom))},curRois(t,e){this.roilist.forEach(e=>{this.showRoi?(this.dataMapPath[e.id].path.selected=!!t[e.id],!t[e.id]||0==t[e.id].editable||3==t[e.id].mark_type&&"grey"==t[e.id].strokeColor||this.paper.project.activeLayer.addChild(this.dataMapPath[e.id].path)):this.dataMapPath[e.id].path.selected=!1,this.dataMapPath[e.id].path.visible=!!this.showRoi});for(let t in this.dataMapPath)this.dataMapPath[t].text&&(this.dataMapPath[t].text.remove(),this.dataMapPath[t].rectangle.remove());for(let e in t)t[e]&&this.roilist.length&&this.drawArea(t[e]);Object.keys(t).toString()!=Object.keys(e).toString()&&(this.segmentsList=[])}},components:{"v-attactments":i.a}};function c(t,e=t.currentTarget){return t.touches?u(t.touches[0],e):t}function u(t,e){for(var n={x:0,y:0};e.offsetParent;)n.x+=e.offsetLeft,n.y+=e.offsetTop,e=e.offsetParent;return{offsetX:t.clientX-n.x,offsetY:t.clientY-n.y,x:t.clientX,y:t.clientY,shiftKey:t.shiftKey}}var h={render:function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{staticClass:"osd",class:{"fixed-fullpage":t.fullPage},on:{keydown:t.keydown}},[t._t("default"),t._v(" "),r("div",{ref:"osd",staticClass:"osd",on:{mousedown:t.mouseDown,mousewheel:t.wheel,dblclick:t.dblclick}}),t._v(" "),r("div",{staticClass:"btm_left"},[r("div",{staticClass:"zoom-in",attrs:{title:t.$t("analyze.zoomin")},on:{click:function(e){return t.buttonClick("zoom-in")}}}),t._v(" "),r("p",{staticClass:"showzoom",attrs:{title:t.position.zoom/t.scale+"X"}},[t._v(t._s((t.position.zoom/t.scale).toFixed(1))+"X")]),t._v(" "),r("div",{staticClass:"zoom-out",attrs:{title:t.$t("analyze.zoomout")},on:{click:function(e){return t.buttonClick("zoom-out")}}}),t._v(" "),r("div",{ref:"home",staticClass:"home",attrs:{title:t.$t("analyze.home")},on:{click:function(e){return t.buttonClick("home")}}}),t._v(" "),r("div",{attrs:{title:t.$t("analyze.2x")},on:{click:function(e){return t.buttonClick(2*t.scale)}}},[t._v("2X")]),t._v(" "),r("div",{attrs:{title:t.$t("analyze.4x")},on:{click:function(e){return t.buttonClick(4*t.scale)}}},[t._v("4X")]),t._v(" "),r("div",{attrs:{title:t.$t("analyze.10x")},on:{click:function(e){return t.buttonClick(10*t.scale)}}},[t._v("10X")]),t._v(" "),r("div",{attrs:{title:t.$t("analyze.20x")},on:{click:function(e){return t.buttonClick(20*t.scale)}}},[t._v("20X")]),t._v(" "),r("div",{attrs:{title:t.$t("analyze.40x")},on:{click:function(e){return t.buttonClick(40*t.scale)}}},[t._v("40X")]),t._v(" "),r("div",{attrs:{title:t.$t("analyze.original")},on:{click:function(e){return t.buttonClick("original")}}},[t._v("1:1")]),t._v(" "),r("div",{staticClass:"full-page",class:{"exit-full-page":t.fullPage},attrs:{title:t.fullPage?t.$t("analyze.exitfullpage"):t.$t("analyze.fullpage")},on:{click:function(e){return t.handleFullScreen()}}})]),t._v(" "),r("div",{staticClass:"btm",attrs:{tabindex:"0"},on:{click:function(e){t.showPenTool=!1},keydown:t.keydown}},[r("div",{staticClass:"show-roi",class:{bigContent:!t.showRoi},attrs:{title:t.$t("analyze.showRoi")},on:{click:function(e){t.showRoi=!t.showRoi}}}),t._v(" "),"tagging"==t.slice.toolType?r("div",{staticClass:"show-radius",class:{bigContent:t.showRadius},attrs:{title:"设置半径"},on:{click:function(e){t.showRadius=!t.showRadius}}}):t._e(),t._v(" "),t.showRadius?r("div",{staticClass:"radius",on:{click:function(t){t.stopPropagation()}}},[t._v("\n            标注点半径:\n            "),r("el-input",{ref:"radius",staticClass:"small-input",on:{blur:function(e){t.$emit("setRadius",e)}},nativeOn:{keyup:function(e){return t.toNumber(e)}},model:{value:t.newRadius,callback:function(e){t.newRadius=e},expression:"newRadius"}})],1):t._e(),t._v(" "),"tagging"==t.slice.toolType?r("div",{staticClass:"fill",class:{bigContent:!t.filled},attrs:{title:t.filled?"设为空心":"设为实心"},on:{click:function(e){return t.$emit("showBg")}}}):t._e(),t._v(" "),r("div",{staticClass:"secect-multy",class:{bigContent:"secectMulty"==t.selectedTool},attrs:{title:"多选"},on:{click:function(e){t.selectedTool="secectMulty"}}}),t._v(" "),t.hiddenPen?t._e():r("div",{class:["freepen"==t.selectedTool||"rectangle"==t.selectedTool||"point"==t.selectedTool||"freepenReverse"==t.selectedTool||"dottingTool"==t.selectedTool||"continueTool"==t.selectedTool||"rectangleReverse"==t.selectedTool?"bigContent":"",t.pentool],on:{click:function(e){return e.stopPropagation(),t.chooseTool(e)}}},[r("span",{staticClass:"triangle",on:{click:function(e){e.stopPropagation(),t.showPenTool=!t.showPenTool}}})]),t._v(" "),r("div",{staticClass:"drag",class:{bigContent:"choose"==t.selectedTool},attrs:{title:t.$t("analyze.choose")},on:{click:function(e){t.selectedTool="choose"}}}),t._v(" "),r("div",{staticClass:"measure-tool",class:{bigContent:"measure"==t.selectedTool},attrs:{title:t.$t("analyze.measure")},on:{click:function(e){t.selectedTool="measure"}}}),t._v(" "),t.hiddenPickTool?t._e():r("div",{staticClass:"pick-tool",class:{bigContent:"pickTool"==t.selectedTool},attrs:{title:"轮廓调整"},on:{click:t.adjustSegment}}),t._v(" "),r("v-attactments",{attrs:{record:t.record}})],1),t._v(" "),r("ul",{directives:[{name:"show",rawName:"v-show",value:t.showPenTool,expression:"showPenTool"}],staticClass:"pens"},[r("li",{class:{"li-bg":"freepen"==t.selectedTool},on:{click:function(e){return t.checkTool("freepen")}}},[r("img",{staticStyle:{left:"12px"},attrs:{src:n("aRHw"),width:"40"}}),t._v("自由ROI")]),t._v(" "),r("li",{class:{"li-bg":"continueTool"==t.selectedTool},on:{click:function(e){return t.checkTool("continueTool")}}},[r("img",{attrs:{src:n("rxv/"),width:"23"}}),t._v("自由ROI（续标）")]),t._v(" "),r("li",{class:{"li-bg":"rectangle"==t.selectedTool},on:{click:function(e){return t.checkTool("rectangle")}}},[r("img",{attrs:{src:n("jdSn"),width:"23"}}),t._v("矩形ROI")]),t._v(" "),r("li",{class:{"li-bg":"dottingTool"==t.selectedTool},on:{click:function(e){return t.checkTool("dottingTool")}}},[r("img",{attrs:{src:n("Qar8"),width:"23"}}),t._v("多边形ROI")]),t._v(" "),r("li",{class:{"li-bg":"point"==t.selectedTool,"disable-tool":!t.pointAble},on:{click:function(e){return t.checkTool("point")}}},[t.pointAble?r("span",[r("img",{attrs:{src:n("NmLI"),width:"25"}}),t._v("\n                打点\n            ")]):r("span",{staticClass:"grey"},[r("img",{attrs:{src:n("Tcqk"),width:"25"}}),t._v("\n                打点\n            ")])]),t._v(" "),r("li",{class:{"li-bg":"freepenReverse"==t.selectedTool,"disable-tool":!t.reverseAble},on:{click:function(e){return t.checkTool("freepenReverse")}}},[t.reverseAble?r("span",[r("img",{attrs:{src:n("4jrt"),width:"25"}}),t._v("\n                自由排除区域\n            ")]):r("span",{staticClass:"grey"},[r("img",{attrs:{src:n("FcKU"),width:"21"}}),t._v("\n                自由排除区域\n            ")])]),t._v(" "),r("li",{class:{"li-bg":"rectangleReverse"==t.selectedTool,"disable-tool":!t.reverseAble},on:{click:function(e){return t.checkTool("rectangleReverse")}}},[t.reverseAble?r("span",[r("img",{attrs:{src:n("iEaZ"),width:"25"}}),t._v("\n                矩形排除区域\n            ")]):r("span",{staticClass:"grey"},[r("img",{attrs:{src:n("vhYd"),width:"21"}}),t._v("\n                矩形排除区域\n            ")])])]),t._v(" "),r("div",{ref:"hideToolbar",staticStyle:{display:"none"}}),t._v(" "),r("canvas",{ref:"canvas",staticClass:"canvas"}),t._v(" "),t.saved?r("div",{staticClass:"saved"},[t._v("保存成功")]):t._e(),t._v(" "),t.showLabel?r("img",{ref:"rotate",staticClass:"label",attrs:{title:"点击旋转",src:"/aipath/api/files/getLabel?caseid="+t.record.id+"&fileid="+t.slice.id+"&companyid="+t.company},on:{click:t.rotate,error:function(e){t.showLabel=!1}}}):t._e(),t._v(" "),t.showMppGuide?r("div",{staticClass:"mpp-box"},[r("h2",[t._v("请框选出一个中等大小细胞核。如示例图:")]),t._v(" "),r("img",{attrs:{src:n("T4+n"),alt:"图例"}}),t._v(" "),r("span",{on:{click:function(e){return t.drawCell()}}},[t._v("我知道了")]),t._v(" "),r("div",{staticClass:"closeBtn",on:{click:function(e){return t.$emit("closeMppGuide",!0)}}},[r("img",{attrs:{src:n("YPLu"),alt:"关闭",width:"19"}})])]):t._e(),t._v(" "),t.knew?r("div",{staticClass:"knew"},[r("h2",[t._v("确认开始处理？")]),t._v(" "),r("div",{staticClass:"confirm-buttons"},[r("span",{staticClass:"finishdraw",on:{click:function(e){t.$emit("changeMpp",t.userMpp),t.curRoi.path.remove(),t.curRoi=null,t.knew=!1}}},[t._v("\n            确认")]),t._v(" "),r("span",{on:{click:function(e){t.$emit("changeMpp",!1),t.curRoi.path.remove(),t.curRoi=null,t.knew=!1}}},[t._v("\n            取消")])])]):t._e()],2)},staticRenderFns:[]};var f=n("VU/8")(l,h,!1,function(t){n("X92p"),n("V2TN")},"data-v-2957051a",null);e.a=f.exports},"T4+n":function(t,e,n){t.exports=n.p+"static/img/图例.cf250fc.jpg"},Tcqk:function(t,e,n){t.exports=n.p+"static/img/打点-d.7dec91a.svg"},V2TN:function(t,e){},X92p:function(t,e){},XA3p:function(t,e,n){t.exports=n.p+"static/img/提醒.1ae81ce.svg"},YPLu:function(t,e,n){t.exports=n.p+"static/img/关闭.a9102f6.png"},aJOx:function(t,e){},aRHw:function(t,e,n){t.exports=n.p+"static/img/自由笔.d194396.svg"},aeYY:function(t,e,n){"use strict";n("jyVo");var r={data(){return{isActive:null,showLeft:!1,showRight:!0,company:this.record&&this.record.companyid,startIndex:0}},computed:{slideLength(){return Math.min(this.startIndex+10,this.record.slices.length)}},methods:{loadImg(){for(let t=Math.max(0,this.startIndex);t<Math.min(this.record.slices.length,this.slideLength);t++)this.$refs.num[t].style.backgroundImage="url(/aipath/api/files/thumbnail?caseid="+encodeURIComponent(this.record.id)+"&fileid="+this.record.slices[t].id+"&companyid="+this.company+")"},rollover(t){this.isActive=t,this.$refs.num[t].style.left=310*t-39+"px"},rollout(t){this.isActive=null,this.$refs.num[t].style.left=310*t+"px"},goLeft(){var t=this.$refs.inner.style.left.substring(0,this.$refs.inner.style.left.length-2);t&&t<38&&(this.$refs.inner.style.left=this.$refs.inner.offsetLeft+620+"px",t=this.$refs.inner.style.left.substring(0,this.$refs.inner.style.left.length-2),this.startIndex-=4,this.loadImg(),this.showRight=!0),t&&t>0&&(this.$refs.inner.style.left="48px",this.showLeft=!1)},goRight(){var t=this.$refs.inner.style.left.substring(0,this.$refs.inner.style.left.length-2);this.width()+Number(t)>930&&(this.$refs.inner.style.left=this.$refs.inner.offsetLeft-620+"px",t=this.$refs.inner.style.left.substring(0,this.$refs.inner.style.left.length-2),this.startIndex+=4,this.loadImg(),this.showLeft=!0),this.width()+Number(t)<931&&(this.showRight=!1)},width(){return this.record?310*this.record.slices.length:0}},mounted(){this.showRight=this.width()>this.$refs.outer.offsetWidth;document.querySelector(".outer");this.record&&this.record.slices&&this.loadImg()},watch:{"record.slices":function(t){if(t){let t=this.record?310*this.record.slices.length:0;this.showRight=t>this.$refs.outer.offsetWidth}else this.showRight=!1,this.showLeft=!1}},props:["record"]},i={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{ref:"outer",staticClass:"outer"},[t.record&&t.showLeft?n("div",{staticClass:"left",on:{click:function(e){return t.goLeft()}}}):t._e(),t._v(" "),t.record?n("div",{ref:"inner",staticClass:"inner"},t._l(t.record.slices,function(e,r){return n("div",{key:r,ref:"num",refInFor:!0,staticClass:"images",class:{active:r==t.isActive},style:"left:"+310*r+"px;background-size:contain;",on:{dblclick:function(n){return t.$emit("click",e.id)},mouseover:function(e){return t.rollover(r)},mouseout:function(e){return t.rollout(r)}}},[n("div",[n("p",[t._v(t._s(e.name))]),t._v(" "),e.stain?n("p",[t._v(t._s(e.stain))]):t._e()])])}),0):t._e(),t._v(" "),t.record&&t.showRight?n("div",{staticClass:"right",on:{click:function(e){return t.goRight()}}}):t._e()])},staticRenderFns:[]};var s=n("VU/8")(r,i,!1,function(t){n("DsNH")},"data-v-0e80590e",null);e.a=s.exports},cp6Q:function(t,e){},d0PZ:function(t,e,n){"use strict";e.a=function(t,e){return i.MessageBox.prompt("","自定义标签名称",{inputPlaceholder:"不超过20字符",inputErrorMessage:"不超过20字符",inputValidator:t=>{if(a(t)>20)return!1},customClass:"add-label-prompt"}).then(({value:n})=>Object(r.c)("slice/addLabel",{name:n,ids:JSON.stringify(t),caseids:JSON.stringify(e)}).then(()=>{i.Message.success("添加标签成功")}).catch(t=>(i.Message.error(t.message),Promise.reject(t))))},e.c=function(t,e,n){return i.MessageBox.alert("确定删除吗？","操作确认",{showClose:!1,showCancelButton:!0}).then(()=>Object(r.c)("slice/delLabel",{names:JSON.stringify(n),id:t,caseid:e}).then(()=>{i.Message.success("删除标签成功")}).catch(t=>(i.Message.error(t.message),Promise.reject(t))))},e.b=function(t,e,n){if(!t)return"";if(e<=0)return"";n||(n="");for(var r=0,i=0;i<t.length;i++)if(t.charCodeAt(i)>255?r+=2:r++,r>e)return t.substring(0,i)+n;return t},e.d=a;var r=n("jyVo"),i=n("zL8q"),s=(n.n(i),n("9HLs"));n.n(s);function a(t){for(var e=0,n=t.length,r=-1,i=0;i<n;i++)e+=(r=t.charCodeAt(i))>=0&&r<=128?1:2;return e}},fC4T:function(t,e){t.exports=function(t){return t&&"object"==typeof t&&"function"==typeof t.copy&&"function"==typeof t.fill&&"function"==typeof t.readUInt8}},gxuG:function(t,e){},i1en:function(t,e,n){t.exports=n.p+"static/img/存储.f7c365f.svg"},iEaZ:function(t,e,n){t.exports=n.p+"static/img/矩形排除.e7e2699.svg"},iP0Q:function(t,e){},"igz+":function(t,e){},jdSn:function(t,e,n){t.exports=n.p+"static/img/矩形.2e64410.svg"},k5KV:function(t,e,n){(function(){var e,r,i=[].slice;r=n("rdLu"),n("OMJi").puts,e={isPlainObject:function(t){return null!=(null!=t?t.constructor:void 0)&&"Object"===t.constructor.name},clone:function(t){var n,i,s,a,o;if(r.isArray(t)){for(n=[],a=0,o=t.length;a<o;a++)s=t[a],n.push(e.clone(s));return n}if(e.isPlainObject(t)){for(i in n={},t)s=t[i],n[i]=e.clone(s);return n}return t},equals:function(t,n){var i,s,a,o,l;if(t===n)return!0;if(r.isArray(t)){if(!r.isArray(n)||t.length!==n.length)return!1;for(i=o=0,l=t.length;0<=l?o<l:o>l;i=0<=l?++o:--o)if(!e.equals(t[i],n[i]))return!1;return!0}if(e.isPlainObject(t)){if(a=r.size(t),!e.isPlainObject(n)||a!==r.size(n))return!1;for(s in t)if(!e.equals(t[s],n[s]))return!1;return!0}return!1},extend:function(){var t,n,r,s,a,o;for(t=arguments[0],a=0,o=(s=2<=arguments.length?i.call(arguments,1):[]).length;a<o;a++)for(n in r=s[a])e.isPlainObject(t[n])&&e.isPlainObject(r[n])?e.extend(t[n],r[n]):t[n]=e.clone(r[n]);return t},select:function(t,n,i){var s,a,o,l;if(null==i&&(i=[]),o=[],n(t))o.push({path:i,value:t});else if(r.isObject(t))for(a in t)l=t[a],(s=r.clone(i)).push(a),o=o.concat(e.select(l,n,s));return o},set:function(t,e,n){var i,s,a;for(i=(e=r.clone(e)).pop(),s=0,a=e.length;s<a;s++)t=t[e[s]];return t[i]=n},transform:function(t,n,i){var s,a,o,l,c;if(n(t))return i(t);if(r.isArray(t)){for(a=[],l=0,c=t.length;l<c;l++)o=t[l],a.push(e.transform(o,n,i));return a}if(e.isPlainObject(t)){for(s in a={},t)o=t[s],a[s]=e.transform(o,n,i);return a}return t}},t.exports=e}).call(this)},kh4U:function(t,e){},kzvN:function(t,e){},l7ju:function(t,e){},qlG4:function(t,e,n){"use strict";var r=n("DoYF"),i=n("zL8q");n.n(i);const s=new r.a(i.Dialog,{visibilityEventName:"update:visible",visibilityValueName:"visible"});e.a=s},rdLu:function(t,e,n){(function(){var n=this,r=n._,i={},s=Array.prototype,a=Object.prototype,o=Function.prototype,l=s.push,c=s.slice,u=s.concat,h=a.toString,f=a.hasOwnProperty,d=s.forEach,p=s.map,v=s.reduce,m=s.reduceRight,g=s.filter,_=s.every,y=s.some,w=s.indexOf,b=s.lastIndexOf,x=Array.isArray,C=Object.keys,k=o.bind,P=function(t){return t instanceof P?t:this instanceof P?void(this._wrapped=t):new P(t)};void 0!==t&&t.exports&&(e=t.exports=P),e._=P,P.VERSION="1.4.4";var T=P.each=P.forEach=function(t,e,n){if(null!=t)if(d&&t.forEach===d)t.forEach(e,n);else if(t.length===+t.length){for(var r=0,s=t.length;r<s;r++)if(e.call(n,t[r],r,t)===i)return}else for(var a in t)if(P.has(t,a)&&e.call(n,t[a],a,t)===i)return};P.map=P.collect=function(t,e,n){var r=[];return null==t?r:p&&t.map===p?t.map(e,n):(T(t,function(t,i,s){r[r.length]=e.call(n,t,i,s)}),r)};var S="Reduce of empty array with no initial value";P.reduce=P.foldl=P.inject=function(t,e,n,r){var i=arguments.length>2;if(null==t&&(t=[]),v&&t.reduce===v)return r&&(e=P.bind(e,r)),i?t.reduce(e,n):t.reduce(e);if(T(t,function(t,s,a){i?n=e.call(r,n,t,s,a):(n=t,i=!0)}),!i)throw new TypeError(S);return n},P.reduceRight=P.foldr=function(t,e,n,r){var i=arguments.length>2;if(null==t&&(t=[]),m&&t.reduceRight===m)return r&&(e=P.bind(e,r)),i?t.reduceRight(e,n):t.reduceRight(e);var s=t.length;if(s!==+s){var a=P.keys(t);s=a.length}if(T(t,function(o,l,c){l=a?a[--s]:--s,i?n=e.call(r,n,t[l],l,c):(n=t[l],i=!0)}),!i)throw new TypeError(S);return n},P.find=P.detect=function(t,e,n){var r;return $(t,function(t,i,s){if(e.call(n,t,i,s))return r=t,!0}),r},P.filter=P.select=function(t,e,n){var r=[];return null==t?r:g&&t.filter===g?t.filter(e,n):(T(t,function(t,i,s){e.call(n,t,i,s)&&(r[r.length]=t)}),r)},P.reject=function(t,e,n){return P.filter(t,function(t,r,i){return!e.call(n,t,r,i)},n)},P.every=P.all=function(t,e,n){e||(e=P.identity);var r=!0;return null==t?r:_&&t.every===_?t.every(e,n):(T(t,function(t,s,a){if(!(r=r&&e.call(n,t,s,a)))return i}),!!r)};var $=P.some=P.any=function(t,e,n){e||(e=P.identity);var r=!1;return null==t?r:y&&t.some===y?t.some(e,n):(T(t,function(t,s,a){if(r||(r=e.call(n,t,s,a)))return i}),!!r)};P.contains=P.include=function(t,e){return null!=t&&(w&&t.indexOf===w?-1!=t.indexOf(e):$(t,function(t){return t===e}))},P.invoke=function(t,e){var n=c.call(arguments,2),r=P.isFunction(e);return P.map(t,function(t){return(r?e:t[e]).apply(t,n)})},P.pluck=function(t,e){return P.map(t,function(t){return t[e]})},P.where=function(t,e,n){return P.isEmpty(e)?n?null:[]:P[n?"find":"filter"](t,function(t){for(var n in e)if(e[n]!==t[n])return!1;return!0})},P.findWhere=function(t,e){return P.where(t,e,!0)},P.max=function(t,e,n){if(!e&&P.isArray(t)&&t[0]===+t[0]&&t.length<65535)return Math.max.apply(Math,t);if(!e&&P.isEmpty(t))return-1/0;var r={computed:-1/0,value:-1/0};return T(t,function(t,i,s){var a=e?e.call(n,t,i,s):t;a>=r.computed&&(r={value:t,computed:a})}),r.value},P.min=function(t,e,n){if(!e&&P.isArray(t)&&t[0]===+t[0]&&t.length<65535)return Math.min.apply(Math,t);if(!e&&P.isEmpty(t))return 1/0;var r={computed:1/0,value:1/0};return T(t,function(t,i,s){var a=e?e.call(n,t,i,s):t;a<r.computed&&(r={value:t,computed:a})}),r.value},P.shuffle=function(t){var e,n=0,r=[];return T(t,function(t){e=P.random(n++),r[n-1]=r[e],r[e]=t}),r};var R=function(t){return P.isFunction(t)?t:function(e){return e[t]}};P.sortBy=function(t,e,n){var r=R(e);return P.pluck(P.map(t,function(t,e,i){return{value:t,index:e,criteria:r.call(n,t,e,i)}}).sort(function(t,e){var n=t.criteria,r=e.criteria;if(n!==r){if(n>r||void 0===n)return 1;if(n<r||void 0===r)return-1}return t.index<e.index?-1:1}),"value")};var j=function(t,e,n,r){var i={},s=R(e||P.identity);return T(t,function(e,a){var o=s.call(n,e,a,t);r(i,o,e)}),i};P.groupBy=function(t,e,n){return j(t,e,n,function(t,e,n){(P.has(t,e)?t[e]:t[e]=[]).push(n)})},P.countBy=function(t,e,n){return j(t,e,n,function(t,e){P.has(t,e)||(t[e]=0),t[e]++})},P.sortedIndex=function(t,e,n,r){for(var i=(n=null==n?P.identity:R(n)).call(r,e),s=0,a=t.length;s<a;){var o=s+a>>>1;n.call(r,t[o])<i?s=o+1:a=o}return s},P.toArray=function(t){return t?P.isArray(t)?c.call(t):t.length===+t.length?P.map(t,P.identity):P.values(t):[]},P.size=function(t){return null==t?0:t.length===+t.length?t.length:P.keys(t).length},P.first=P.head=P.take=function(t,e,n){if(null!=t)return null==e||n?t[0]:c.call(t,0,e)},P.initial=function(t,e,n){return c.call(t,0,t.length-(null==e||n?1:e))},P.last=function(t,e,n){if(null!=t)return null==e||n?t[t.length-1]:c.call(t,Math.max(t.length-e,0))},P.rest=P.tail=P.drop=function(t,e,n){return c.call(t,null==e||n?1:e)},P.compact=function(t){return P.filter(t,P.identity)};var O=function(t,e,n){return T(t,function(t){P.isArray(t)?e?l.apply(n,t):O(t,e,n):n.push(t)}),n};P.flatten=function(t,e){return O(t,e,[])},P.without=function(t){return P.difference(t,c.call(arguments,1))},P.uniq=P.unique=function(t,e,n,r){P.isFunction(e)&&(r=n,n=e,e=!1);var i=n?P.map(t,n,r):t,s=[],a=[];return T(i,function(n,r){(e?r&&a[a.length-1]===n:P.contains(a,n))||(a.push(n),s.push(t[r]))}),s},P.union=function(){return P.uniq(u.apply(s,arguments))},P.intersection=function(t){var e=c.call(arguments,1);return P.filter(P.uniq(t),function(t){return P.every(e,function(e){return P.indexOf(e,t)>=0})})},P.difference=function(t){var e=u.apply(s,c.call(arguments,1));return P.filter(t,function(t){return!P.contains(e,t)})},P.zip=function(){for(var t=c.call(arguments),e=P.max(P.pluck(t,"length")),n=new Array(e),r=0;r<e;r++)n[r]=P.pluck(t,""+r);return n},P.object=function(t,e){if(null==t)return{};for(var n={},r=0,i=t.length;r<i;r++)e?n[t[r]]=e[r]:n[t[r][0]]=t[r][1];return n},P.indexOf=function(t,e,n){if(null==t)return-1;var r=0,i=t.length;if(n){if("number"!=typeof n)return t[r=P.sortedIndex(t,e)]===e?r:-1;r=n<0?Math.max(0,i+n):n}if(w&&t.indexOf===w)return t.indexOf(e,n);for(;r<i;r++)if(t[r]===e)return r;return-1},P.lastIndexOf=function(t,e,n){if(null==t)return-1;var r=null!=n;if(b&&t.lastIndexOf===b)return r?t.lastIndexOf(e,n):t.lastIndexOf(e);for(var i=r?n:t.length;i--;)if(t[i]===e)return i;return-1},P.range=function(t,e,n){arguments.length<=1&&(e=t||0,t=0),n=arguments[2]||1;for(var r=Math.max(Math.ceil((e-t)/n),0),i=0,s=new Array(r);i<r;)s[i++]=t,t+=n;return s},P.bind=function(t,e){if(t.bind===k&&k)return k.apply(t,c.call(arguments,1));var n=c.call(arguments,2);return function(){return t.apply(e,n.concat(c.call(arguments)))}},P.partial=function(t){var e=c.call(arguments,1);return function(){return t.apply(this,e.concat(c.call(arguments)))}},P.bindAll=function(t){var e=c.call(arguments,1);return 0===e.length&&(e=P.functions(t)),T(e,function(e){t[e]=P.bind(t[e],t)}),t},P.memoize=function(t,e){var n={};return e||(e=P.identity),function(){var r=e.apply(this,arguments);return P.has(n,r)?n[r]:n[r]=t.apply(this,arguments)}},P.delay=function(t,e){var n=c.call(arguments,2);return setTimeout(function(){return t.apply(null,n)},e)},P.defer=function(t){return P.delay.apply(P,[t,1].concat(c.call(arguments,1)))},P.throttle=function(t,e){var n,r,i,s,a=0,o=function(){a=new Date,i=null,s=t.apply(n,r)};return function(){var l=new Date,c=e-(l-a);return n=this,r=arguments,c<=0?(clearTimeout(i),i=null,a=l,s=t.apply(n,r)):i||(i=setTimeout(o,c)),s}},P.debounce=function(t,e,n){var r,i;return function(){var s=this,a=arguments,o=n&&!r;return clearTimeout(r),r=setTimeout(function(){r=null,n||(i=t.apply(s,a))},e),o&&(i=t.apply(s,a)),i}},P.once=function(t){var e,n=!1;return function(){return n?e:(n=!0,e=t.apply(this,arguments),t=null,e)}},P.wrap=function(t,e){return function(){var n=[t];return l.apply(n,arguments),e.apply(this,n)}},P.compose=function(){var t=arguments;return function(){for(var e=arguments,n=t.length-1;n>=0;n--)e=[t[n].apply(this,e)];return e[0]}},P.after=function(t,e){return t<=0?e():function(){if(--t<1)return e.apply(this,arguments)}},P.keys=C||function(t){if(t!==Object(t))throw new TypeError("Invalid object");var e=[];for(var n in t)P.has(t,n)&&(e[e.length]=n);return e},P.values=function(t){var e=[];for(var n in t)P.has(t,n)&&e.push(t[n]);return e},P.pairs=function(t){var e=[];for(var n in t)P.has(t,n)&&e.push([n,t[n]]);return e},P.invert=function(t){var e={};for(var n in t)P.has(t,n)&&(e[t[n]]=n);return e},P.functions=P.methods=function(t){var e=[];for(var n in t)P.isFunction(t[n])&&e.push(n);return e.sort()},P.extend=function(t){return T(c.call(arguments,1),function(e){if(e)for(var n in e)t[n]=e[n]}),t},P.pick=function(t){var e={},n=u.apply(s,c.call(arguments,1));return T(n,function(n){n in t&&(e[n]=t[n])}),e},P.omit=function(t){var e={},n=u.apply(s,c.call(arguments,1));for(var r in t)P.contains(n,r)||(e[r]=t[r]);return e},P.defaults=function(t){return T(c.call(arguments,1),function(e){if(e)for(var n in e)null==t[n]&&(t[n]=e[n])}),t},P.clone=function(t){return P.isObject(t)?P.isArray(t)?t.slice():P.extend({},t):t},P.tap=function(t,e){return e(t),t};var A=function(t,e,n,r){if(t===e)return 0!==t||1/t==1/e;if(null==t||null==e)return t===e;t instanceof P&&(t=t._wrapped),e instanceof P&&(e=e._wrapped);var i=h.call(t);if(i!=h.call(e))return!1;switch(i){case"[object String]":return t==String(e);case"[object Number]":return t!=+t?e!=+e:0==t?1/t==1/e:t==+e;case"[object Date]":case"[object Boolean]":return+t==+e;case"[object RegExp]":return t.source==e.source&&t.global==e.global&&t.multiline==e.multiline&&t.ignoreCase==e.ignoreCase}if("object"!=typeof t||"object"!=typeof e)return!1;for(var s=n.length;s--;)if(n[s]==t)return r[s]==e;n.push(t),r.push(e);var a=0,o=!0;if("[object Array]"==i){if(o=(a=t.length)==e.length)for(;a--&&(o=A(t[a],e[a],n,r)););}else{var l=t.constructor,c=e.constructor;if(l!==c&&!(P.isFunction(l)&&l instanceof l&&P.isFunction(c)&&c instanceof c))return!1;for(var u in t)if(P.has(t,u)&&(a++,!(o=P.has(e,u)&&A(t[u],e[u],n,r))))break;if(o){for(u in e)if(P.has(e,u)&&!a--)break;o=!a}}return n.pop(),r.pop(),o};P.isEqual=function(t,e){return A(t,e,[],[])},P.isEmpty=function(t){if(null==t)return!0;if(P.isArray(t)||P.isString(t))return 0===t.length;for(var e in t)if(P.has(t,e))return!1;return!0},P.isElement=function(t){return!(!t||1!==t.nodeType)},P.isArray=x||function(t){return"[object Array]"==h.call(t)},P.isObject=function(t){return t===Object(t)},T(["Arguments","Function","String","Number","Date","RegExp"],function(t){P["is"+t]=function(e){return h.call(e)=="[object "+t+"]"}}),P.isArguments(arguments)||(P.isArguments=function(t){return!(!t||!P.has(t,"callee"))}),P.isFunction=function(t){return"function"==typeof t},P.isFinite=function(t){return isFinite(t)&&!isNaN(parseFloat(t))},P.isNaN=function(t){return P.isNumber(t)&&t!=+t},P.isBoolean=function(t){return!0===t||!1===t||"[object Boolean]"==h.call(t)},P.isNull=function(t){return null===t},P.isUndefined=function(t){return void 0===t},P.has=function(t,e){return f.call(t,e)},P.noConflict=function(){return n._=r,this},P.identity=function(t){return t},P.times=function(t,e,n){for(var r=Array(t),i=0;i<t;i++)r[i]=e.call(n,i);return r},P.random=function(t,e){return null==e&&(e=t,t=0),t+Math.floor(Math.random()*(e-t+1))};var M={escape:{"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","/":"&#x2F;"}};M.unescape=P.invert(M.escape);var I={escape:new RegExp("["+P.keys(M.escape).join("")+"]","g"),unescape:new RegExp("("+P.keys(M.unescape).join("|")+")","g")};P.each(["escape","unescape"],function(t){P[t]=function(e){return null==e?"":(""+e).replace(I[t],function(e){return M[t][e]})}}),P.result=function(t,e){if(null==t)return null;var n=t[e];return P.isFunction(n)?n.call(t):n},P.mixin=function(t){T(P.functions(t),function(e){var n=P[e]=t[e];P.prototype[e]=function(){var t=[this._wrapped];return l.apply(t,arguments),N.call(this,n.apply(P,t))}})};var L=0;P.uniqueId=function(t){var e=++L+"";return t?t+e:e},P.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var E=/(.)^/,z={"'":"'","\\":"\\","\r":"r","\n":"n","\t":"t","\u2028":"u2028","\u2029":"u2029"},D=/\\|'|\r|\n|\t|\u2028|\u2029/g;P.template=function(t,e,n){var r;n=P.defaults({},n,P.templateSettings);var i=new RegExp([(n.escape||E).source,(n.interpolate||E).source,(n.evaluate||E).source].join("|")+"|$","g"),s=0,a="__p+='";t.replace(i,function(e,n,r,i,o){return a+=t.slice(s,o).replace(D,function(t){return"\\"+z[t]}),n&&(a+="'+\n((__t=("+n+"))==null?'':_.escape(__t))+\n'"),r&&(a+="'+\n((__t=("+r+"))==null?'':__t)+\n'"),i&&(a+="';\n"+i+"\n__p+='"),s=o+e.length,e}),a+="';\n",n.variable||(a="with(obj||{}){\n"+a+"}\n"),a="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+a+"return __p;\n";try{r=new Function(n.variable||"obj","_",a)}catch(t){throw t.source=a,t}if(e)return r(e,P);var o=function(t){return r.call(this,t,P)};return o.source="function("+(n.variable||"obj")+"){\n"+a+"}",o},P.chain=function(t){return P(t).chain()};var N=function(t){return this._chain?P(t).chain():t};P.mixin(P),T(["pop","push","reverse","shift","sort","splice","unshift"],function(t){var e=s[t];P.prototype[t]=function(){var n=this._wrapped;return e.apply(n,arguments),"shift"!=t&&"splice"!=t||0!==n.length||delete n[0],N.call(this,n)}}),T(["concat","join","slice"],function(t){var e=s[t];P.prototype[t]=function(){return N.call(this,e.apply(this._wrapped,arguments))}}),P.extend(P.prototype,{chain:function(){return this._chain=!0,this},value:function(){return this._wrapped}})}).call(this)},"rxv/":function(t,e,n){t.exports=n.p+"static/img/连续标注.79e1054.svg"},scHV:function(t,e,n){"use strict";e.a=a;var r=n("7+uW"),i=n("jyVo");const s=r.default.observable({modes:[]});function a(){return Object(i.d)("manage/getAiPattern").then(t=>{s.modes=t.data})}const o={data:()=>({params_tct_lct_reg:/(t|l)ct/}),computed:{modes:()=>s.modes,modesByAiType(){const t={};return s.modes.forEach(e=>{const n=e.aiType;t[n]?t[n].push(e):t[n]=[e]}),t}},methods:{getAiTypeModes(t){return this.modes.filter(e=>e.aiType===t)},getModes:a}};e.b=o},tOHu:function(t,e,n){"use strict";var r=n("jyVo"),i=n("SfvY"),s={methods:{checkall(){let t=this.roilist.every(t=>!!t.image);this.roilist.forEach(e=>this.$set(e,"image",t?0:1)),this.$emit("closecontextmenu")},del(t){this.$confirm(this.$t("analaysisPanel.delete"),{confirmButtonText:this.$t("confirm.confirm"),cancelButtonText:this.$t("confirm.quit"),type:"warning"}).then(()=>this.$emit("delRoi",t),t=>t)},noEmoji(t){t.target.value=t.target.value.replace(/[^\u0020-\u007E\u00A0-\u00BE\u2E80-\uA4CF\uF900-\uFAFF\uFE30-\uFE4F\uFF00-\uFFEF\u0080-\u009F\u2000-\u201f\u2026\u2022\u20ac\r\n]/g,"")}},props:["roilist","currentRois"],watch:{slices:{handler(t){console.log(t)},deep:!0}}},a={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"roi"},[n("div",{staticClass:"top"},[n("div",{staticClass:"left"},[n("div",[n("span",{staticClass:"uncheck",class:{checked:!!t.roilist.length&&t.roilist.every(function(t){return!!t.image})},on:{click:t.checkall}}),t._v("\n                ROI\n            ")])]),t._v(" "),n("div",{staticClass:"center"},[t._v("\n            "+t._s(t.$t("slice.remark"))+"\n        ")]),t._v(" "),n("div",{staticClass:"right"},[t._v("\n            "+t._s(t.$t("analyze.opration"))+"\n        ")])]),t._v(" "),n("div",{staticClass:"rois"},t._l(t.roilist,function(e,r){return n("div",{key:r,staticClass:"row",class:{curRoi:t.currentRois[e.id]},on:{click:function(n){t.$emit("curROI",e,n.shiftKey),t.$emit("closecontextmenu")}}},[n("div",{staticClass:"left"},[n("div",[n("span",{staticClass:"uncheck",class:{checked:e.image},on:{click:function(n){n.stopPropagation(),t.$set(e,"image",1-(e.image||0)),t.$emit("closecontextmenu")}}}),t._v("\n                    "+t._s(r+1)+"\n                ")])]),t._v(" "),n("div",{staticClass:"center"},[n("input",{directives:[{name:"model",rawName:"v-model.lazy",value:e.remark,expression:"roi.remark",modifiers:{lazy:!0}}],attrs:{type:"text",placeholder:t.$t("slice.input"),maxlength:"300",title:e.remark},domProps:{value:e.remark},on:{keydown:function(e){if(!e.type.indexOf("key")&&t._k(e.keyCode,"delete",[8,46],e.key,["Backspace","Delete","Del"]))return null;e.stopPropagation()},input:t.noEmoji,change:function(n){return t.$set(e,"remark",n.target.value)}}})]),t._v(" "),n("div",{staticClass:"right"},[n("em",{attrs:{title:t.$t("upload.delete")},on:{click:function(n){return n.stopPropagation(),t.del(e)}}})])])}),0)])},staticRenderFns:[]};var o=n("VU/8")(s,a,!1,function(t){n("uvd6")},"data-v-4066a7c6",null).exports,l={props:["slice","record","companyid"],data(){return{startTime:new Date,loopHandler:0,auto:"one",centerRegion:null,curRois:{},showbutton:!0,radio:null,position:{offx:this.slice.position?this.slice.position.offx:.5,offy:this.slice.position?this.slice.position.offy:.5*this.slice.height/this.slice.width,zoom:this.slice.position?this.slice.position.zoom:null},lineup:null,showMppGuide:!1,drawMpp:null}},computed:{userInfo:()=>Object(r.r)()},methods:{keypress(t){},noEmoji(t){t.target.value=t.target.value.replace(/[^\u0020-\u007E\u00A0-\u00BE\u2E80-\uA4CF\uF900-\uFAFF\uFE30-\uFE4F\uFF00-\uFFEF\u0080-\u009F\u2000-\u201f\u2026\u2022\u20ac\r\n]/g,"")},curROIChange(t,e){var n;t?t.length?n=t:e&&this.curRois[t.id]?(delete this.curRois[t.id],n=[]):n=[t]:n=[],this.curRois=Object.assign({},e&&this.curRois,...n.map(t=>({[t.id]:t})))},roiChanged(){for(var t in this.curRois)this.curRois[t]=Object.assign({},this.curRois[t]);var e=Object.assign({},this.curRois);this.$set(this.slice,"roilist",this.slice.roilist.map(t=>{var n=e[t.id];return n?(delete e[t.id],n):t}).concat(Object.values(e))),this.slice.tct&&(this.slice.tct.result=this.slice.tct.result.filter(t=>!this.curRois[t.id]))},listChangeCurrent(){var t=[].concat.apply([],Object.values(this.curRois).map(t=>t.path.x)),e=[].concat.apply([],Object.values(this.curRois).map(t=>t.path.y));t.length?this.centerRegion=[Math.min.apply(null,t),Math.min.apply(null,e),Math.max.apply(null,t),Math.max.apply(null,e)]:this.centerRegion=null,this.$refs.osd.scope=null},draw(t){t.id=(Math.random()+"").substr(2,6),this.slice.roilist=[...this.slice.roilist,t]},async delCurRoi(t){let e={};t?(e={[t.id]:t},this.curRois[t.id]&&(delete this.curRois[t.id],this.curRois=Object.assign({},this.curRois))):(e=this.curRois,await this.$confirm(this.$t("analaysisPanel.delete"),{confirmButtonText:this.$t("confirm.confirm"),cancelButtonText:this.$t("confirm.quit"),type:"warning"}),this.curRois={}),this.slice.tct&&(this.slice.tct.result=this.slice.tct.result.filter(t=>!e[t.id])),this.slice.roilist=this.slice.roilist.filter(t=>!e[t.id])},getAlgorithmResult(t=this.record.id,e=this.slice.id,n=this.slice.filename){Object(r.b)("ai/getresult?companyid="+this.companyid,{caseid:t,fileid:e,filename:n,type:"tct",other:""}).then(t=>{if(this.lineup=t.data.rank,t.data.done){if(this.showbutton=!0,this.loopHandler=0,this.slice.tct&&0==this.slice.tct.result.length){var e="u";if(-1==t.data.rank){var n=t.data.result.cells&&t.data.result.cells.slice(0,30).map(t=>({id:(Math.random()+"").substr(2,6),path:{x:t.contourPoints.slice(0,-1).map(t=>t[0]),y:t.contourPoints.slice(0,-1).map(t=>t[1])}}));this.$set(this.slice.tct,"result",n);try{e=t.data.result.diagnosis[0].toLowerCase()}catch(t){}}this.$set(this.slice.tct,"diagnosis",{n:"negative",p:"positive",u:"unsure"}[e]||"unsure"),this.$set(this.slice,"type","tct"),this.updateRecord()}}else this.showbutton=!1,this.loopHandler=setTimeout(()=>{this.getAlgorithmResult()},5e3)})},startAnalyze(t=this.record.id,e=this.slice.id,n=this.slice.filename){this.$set(this.slice,"tct",{}),this.$set(this.slice.tct,"result",[]),this.slice.started=!0,this.record.started=!0,this.$set(this.slice.tct,"diagnosis",null),this.showbutton=!1,this.auto="one",Object.values(this.curRois).map(t=>this.slice.roilist.every(e=>t.id!=e.id)&&this.slice.tct.result.every(e=>t.id!=e.id)?delete this.curRois[t.id]:""),Object(r.b)("ai/start?companyid="+this.companyid,{caseid:t,fileid:e,filename:n,type:"tct",other:""}).then(t=>{this.getAlgorithmResult(),this.slice.tct.taskid=t.data.task_id}).catch(t=>console.log(t)),this.updateRecord()},updateRecord(){this.$emit("save","auto")},keydown(t){"Delete"!=t.key&&"Backspace"!=t.key||!Object.keys(this.curRois).length||this.delCurRoi()},async recheck(t){let e={negative:"阴性",positive:"阳性",unsure:"不合格"}[t];await this.$confirm("确定结果为 "+e+" 吗","提示",{confirmButtonText:"确定并关闭",cancelButtonText:"再看看",type:"warning",closeOnClickModal:!1}),this.$set(this.slice.tct,"check",t),await Object(r.b)("ai/edit?companyid="+this.companyid,{caseid:this.record.id,fileid:this.slice.id,filename:this.slice.filename,type:"tct",result:t});try{this.record.companyid||await Object(r.b)("check/save",{companyid:this.companyid,caseid:this.record.id,airesult:this.slice.tct.diagnosis,docresult:t,spent:(new Date-this.startTime)/1e3})}catch(t){return void this.$confirm(t.message,"提示",{confirmButtonText:"确定",type:"warning",showCancelButton:!1,closeOnClickModal:!1,callback:t=>this.$emit("save","close")})}this.record.started=!0,this.record.analy=e,this.$emit("save","close")}},mounted(){this.slice.started&&this.slice.tct&&null===this.slice.tct.diagnosis&&this.getAlgorithmResult(),window.addEventListener("online",()=>{this.showbutton||this.getAlgorithmResult()})},watch:{"slice.id":{handler(){clearTimeout(this.loopHandler),this.loopHandler=0}},drawMpp:{handler(t){t&&(this.$set(this.slice,"mppx",t),this.$set(this.slice,"mppy",t),this.$emit("save","auto"),this.startAnalyze())}}},beforeDestroy(){clearTimeout(this.loopHandler),this.loopHandler=0},components:{"v-dragon":i.a,"v-roi":o}},c={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"cnt",staticStyle:{width:"100%"},attrs:{tabIndex:0},on:{keydown:t.keydown,keypress:t.keypress}},[n("div",{staticClass:"analyright"},[n("v-dragon",{staticClass:"dragon",attrs:{record:t.record,slice:t.slice,roilist:this.slice.roilist.map(function(t){return Object.assign({method:"rectangle"},t,{color:"yellow"})}).concat((this.slice.tct?this.slice.tct.result:[]).map(function(t){return Object.assign({},t,{color:"red",method:"rectangle",editable:!0,selectable:!1})})),curRois:t.curRois,penColor:"yellow",centerRegion:t.centerRegion,position:t.position,companyid:t.companyid,showMppGuide:t.showMppGuide,cellArea:1962},on:{curROI:t.curROIChange,roiChanged:t.roiChanged,draw:t.draw,delRoi:function(e){return t.delCurRoi(e)},position:function(e,n,r){t.$set(t.position,"offx",e),t.$set(t.position,"offy",n),t.$set(t.position,"zoom",r),t.$set(t.slice,"position",t.position)},closeMppGuide:function(e){t.showMppGuide=!1},changeMpp:function(e){return t.drawMpp=e}}})],1),t._v(" "),n("div",{staticClass:"analylist"},[n("h2",[n("span",{class:"one"==t.auto?"auto":"",on:{click:function(e){t.auto="one"}}},[t._v(t._s(t.$t("analyze.airoi")))]),t._v(" "),n("span",{class:"two"==t.auto?"auto":"",on:{click:function(e){t.auto="two"}}},[t._v(t._s(t.$t("analyze.roi")))]),t._v(" "),t.record.companyid?n("span",{staticClass:"close",on:{click:function(e){return t.$emit("save","close")}}},[t._v("关闭")]):t._e()]),t._v(" "),this.slice.tct&&"one"==t.auto?n("v-roi",{staticClass:"automanualroi",attrs:{roilist:this.slice.tct?this.slice.tct.result:[],currentRois:t.curRois},on:{curROI:function(e,n){return t.curROIChange(e,n)+t.listChangeCurrent()},delRoi:function(e){return t.delCurRoi(e)}}}):t._e(),t._v(" "),"two"==t.auto?n("v-roi",{staticClass:"manualroi",attrs:{roilist:t.slice.roilist,currentRois:t.curRois},on:{curROI:function(e,n){return t.curROIChange(e,n)+t.listChangeCurrent()},delRoi:function(e){return t.delCurRoi(e)}}}):t._e(),t._v(" "),t.showbutton||"one"!=t.auto?t._e():n("div",{staticClass:"loding"},[n("div",{staticClass:"video"},[n("img",{attrs:{src:"/static/video/loading.gif"}}),t._v(" "),0==t.lineup?n("div",{staticClass:"lineup"},[t._v("正在处理...")]):t._e(),t._v(" "),t.lineup>0?n("div",{staticClass:"lineup"},[t._v(t._s(t.$t("slice.lineup"))+" "),n("span",{staticStyle:{color:"#4C9FFA","font-size":"18px","font-weight":"bolder"}},[t._v(t._s(t.lineup))]),t._v(" "+t._s(t.$t("slice.position")))]):t._e()])]),t._v(" "),this.slice.tct||"one"!=t.auto?t._e():n("div",{staticClass:"ifshowtables"},[t._v(t._s(t.$t("slice.noanalysis")))]),t._v(" "),this.slice.tct&&"one"==t.auto?n("div",{staticClass:"tctbtm"},[n("div",{staticClass:"AiResult"},[n("div",[t._v("\n                    "+t._s(t.$t("slice.AiResult"))+"\n                ")]),t._v(" "),n("div",{class:{error:"unsure"==this.slice.tct.diagnosis}},[t._v("\n                    "+t._s({negative:"阴性",positive:"阳性",unsure:"不合格"}[t.slice.tct.check||t.slice.tct.diagnosis])+"\n                    ")])]),t._v(" "),n("div",{staticClass:"confidence"},[n("div",[t._v(t._s(t.$t("slice.confidence")))]),t._v(" "),t._m(0)]),t._v(" "),n("div",{staticClass:"interactive"},[n("div",[t._v("反馈")]),t._v(" "),n("el-radio-group",{staticClass:"radios",attrs:{value:t.slice.tct.check},on:{input:t.recheck}},[n("el-radio",{attrs:{label:"positive"}},[t._v("阳性")]),t._v(" "),n("el-radio",{attrs:{label:"negative"}},[t._v("阴性")]),t._v(" "),n("el-radio",{attrs:{label:"unsure"}},[t._v("不合格")])],1)],1)]):t._e(),t._v(" "),"two"==t.auto?n("div",{staticClass:"opinio"},[n("h1",[t._v("\n                "+t._s(t.$t("analyze.point"))+"\n            ")]),t._v(" "),n("textarea",{directives:[{name:"model",rawName:"v-model",value:t.record.opinion,expression:"record.opinion"}],attrs:{placeholder:t.$t("report.pointremind"),maxlength:"300"},domProps:{value:t.record.opinion},on:{input:[function(e){e.target.composing||t.$set(t.record,"opinion",e.target.value)},t.noEmoji]}})]):t._e()],1)])},staticRenderFns:[function(){var t=this.$createElement,e=this._self._c||t;return e("div",[e("div",[this._v("100%")])])}]};var u=n("VU/8")(l,c,!1,function(t){n("E82G"),n("1O0Z")},"data-v-764b7a1c",null).exports,h={props:["record","companyid"],data(){return{company:this.companyid,currentRoiIndex:"",curAI:null,fullPage:!1,startIndex:0}},computed:{curSlice(){let t=this.record.slices.find(t=>t.id==this.record.slice)||this.record.slices.filter(t=>1==t.state)[0]||null;return t&&(this.curAI=t.toolType||"human",t.roilist=t.roilist||[]),t}},mounted(){},methods:{keydown(t){let e=this.record.slices.filter(t=>1==t.state);if((t.ctrlKey||t.metaKey)&&this.curSlice&&("ArrowUp"==t.key||"ArrowDown"==t.key)){this.$refs.container.focus();let n=e.indexOf(this.curSlice);n=n+t.keyCode-39,n=Math.max(n,0),n=Math.min(n,e.length-1),this.$set(this.record,"slice",e[n].id)}},save(t){this.$emit("save",t)}},watch:{curAI(t){this.curSlice.toolType=t}},components:{tct:u}},f={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return this.record.slices.filter(function(t){return 1==t.state}).length?n("div",{ref:"container",staticClass:"container",attrs:{tabIndex:1},on:{keydown:t.keydown}},[t.curSlice?n("div",{key:t.curSlice.id,staticClass:"analy"},[n(t.curAI,{tag:"component",attrs:{record:t.record,slice:t.curSlice,companyid:t.company},on:{save:function(e){return t.save(e)}}})],1):t._e()]):t._e()},staticRenderFns:[]};var d=n("VU/8")(h,f,!1,function(t){n("vOVi")},"data-v-7d80b79a",null).exports,p=n("k5KV"),v=n.n(p),m=n("Mk6O"),g=n.n(m),_={props:["data","showBatch","companyid"],data(){if(!this.data.oldRecord){var t=this.data.record.slices.map((t,e)=>t.width?t:Object(r.b)("files/getInfo?companyid="+(this.companyid||Object(r.r)().company),{caseid:this.data.record.id,fileid:t.id}).then(n=>this.$set(this.data.record.slices,e,Object.assign({},t,n.data,{name:t.name}))).catch(t=>1));Promise.all(t).then(t=>this.oldRecord=v.a.clone(this.data.record))}return this.data.record.stage=2,{company:this.companyid||Object(r.r)().company,record:this.data.record,oldRecord:this.data.oldRecord,transition:"",saved:!1}},watch:{"record.stage":function(t,e){this.transition=e<t?"right2left":"left2right"}},methods:{nav(t){this.record.stage=t},prev(){this.nav(this.record.stage-1)},next(){this.nav(this.record.stage+1)},cleanRecord:t=>Object.assign({},t,{slices:t.slices.filter(t=>1==t.state).map(({id:t,name:e,filename:n})=>({id:t,name:e,filename:n})),attachments:t.attachments.filter(t=>1==t.state)}),async save(t){await Promise.all(this.record.slices.filter(t=>1==t.state).filter((t,e)=>{var n=this.oldRecord.slices.find(e=>e.id==t.id);return!n||!v.a.equals(n,t)}).map((t,e)=>Object(r.b)("files/saveInfo?companyid="+this.company,{caseid:this.record.id,fileid:t.id,content:JSON.stringify(t)}).then(t=>{if(!0,0==t.code)return 1;throw"保存切片失败"})));var e=this.cleanRecord(this.record),n=this.cleanRecord(this.oldRecord);g()(n,e)&&await Object(r.b)("records/update?companyid="+this.company,{id:e.id,content:JSON.stringify(e)}),this.oldRecord=this.data.oldRecord=v.a.clone(this.record),t&&"close"==t&&this.$emit("closing")},async onclose(){let t=Object.assign({},this.oldRecord);delete t.stage;let e=Object.assign({},this.record);if(delete e.stage,!v.a.equals(t,e))try{await this.$confirm(this.$t("detail.sureclose"),{confirmButtonText:this.$t("confirm.confirm"),cancelButtonText:this.$t("confirm.quit"),type:"warning"})}catch(t){return}[...this.record.slices,...this.record.attachments].forEach(t=>1!=t.state&&(t.deleted=!0)),this.$emit("closing")}},components:{analyze:d}},y={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"blackback",attrs:{id:"id"+t.data.id}},[n("div",{staticClass:"body"},[t.oldRecord?n("transition",{attrs:{name:t.transition}},[n(["basic","file","analyze","report"][t.record.stage],{tag:"component",attrs:{showBatch:t.showBatch,record:t.record,companyid:t.company},on:{next:t.next,prev:t.prev,save:t.save}})],1):t._e()],1),t._v(" "),t.saved?n("div",{staticClass:"saved"},[t._v("保存成功")]):t._e()])},staticRenderFns:[]};var w=n("VU/8")(_,y,!1,function(t){n("+I/B")},"data-v-e09ce776",null);e.a=w.exports},uGx8:function(t,e){},uvd6:function(t,e){},vOVi:function(t,e){},vhYd:function(t,e,n){t.exports=n.p+"static/img/矩形排除-d.95f3983.svg"}});